from mlflow.environment_variables import (
MLFLOW_ALLOW_FILE_URI_AS_MODEL_VERSION_SOURCE,
MLFLOW_DEPLOYMENTS_TARGET,
)
from mlflow.utils.uri import is_file_uri, is_local_uri, validate_path_is_safe, validate_query_string
# There might be file URIs that are local but can bypass the above check. To prevent this, we
# disallow using file URIs as model version sources by default unless it's explicitly allowed
# by setting the MLFLOW_ALLOW_FILE_URI_AS_MODEL_VERSION_SOURCE environment variable to True.
if not MLFLOW_ALLOW_FILE_URI_AS_MODEL_VERSION_SOURCE.get() and is_file_uri(source):
raise MlflowException(
f"Invalid model version source: '{source}'. MLflow tracking server doesn't allow using "
"a file URI as a model version source for security reasons. To disable this check, set "
f"the {MLFLOW_ALLOW_FILE_URI_AS_MODEL_VERSION_SOURCE} environment variable to "
"True.",
INVALID_PARAMETER_VALUE,
)
