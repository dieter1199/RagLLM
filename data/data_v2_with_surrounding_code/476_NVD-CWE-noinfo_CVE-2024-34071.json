{
    "cve_id": "CVE-2024-34071",
    "cve_description": "Umbraco is an ASP.NET CMS used by more than 730.000 websites. Umbraco has an endpoint that is vulnerable to open redirects. The endpoint is protected so it requires the user to be signed into backoffice before the vulnerable is exposed. This vulnerability has been patched in version(s) 8.18.14, 10.8.6, 12.3.10 and 13.3.1.",
    "cve_publish_date": "2024-05-21T14:15Z",
    "cwe_id": "NVD-CWE-noinfo",
    "cwe_name": "Insufficient Information",
    "cwe_description": "There is insufficient information about the issue to classify it; details are unkown or unspecified.",
    "commit_message": "Merge pull request from GHSA-j74q-mv2c-rxmp",
    "type_of_change": "Modification",
    "changes": [
        {
            "filename_of_changes": "ImagesController.cs",
            "code_language": "C#",
            "number_of_lines_added_for_mitigation": "2",
            "number_of_lines_deleted_vulnerable_to_cve": "1",
            "Code_with_highlighted_vulnerability_lines": [
                "// Line 116:         if (imageUrl is not null)",
                "// Line 117:         {",
                "// Line 118:             return new RedirectResult(imageUrl, false);",
                "// Line 119:         }",
                "// Line 120: ",
                "// Line 121:         return NotFound();",
                "// Line 122:     }",
                "// Line 123: ",
                "// Line 124:     private bool IsAllowed(string encodedImagePath)",
                "// Line 125:     {",
                "// vulnerable line: 126: if(Uri.IsWellFormedUriString(encodedImagePath, UriKind.Relative))",
                "// Line 127:         {",
                "// Line 128:             return true;",
                "// Line 129:         }",
                "// Line 130: ",
                "// Line 131:         var builder = new UriBuilder(encodedImagePath);",
                "// Line 132: ",
                "// Line 133:         foreach (var allowedMediaHost in _contentSettings.AllowedMediaHosts)",
                "// Line 134:         {",
                "// Line 135:             if (string.Equals(builder.Host, allowedMediaHost, StringComparison.InvariantCultureIgnoreCase))",
                "// Line 136:             {"
            ]
        },
        {
            "filename_of_changes": "ImagesController.cs",
            "code_language": "C#",
            "number_of_lines_added_for_mitigation": "2",
            "number_of_lines_deleted_vulnerable_to_cve": "1",
            "Code_with_highlighted_vulnerability_lines": [
                "// Line 115:         if (imageUrl is not null)",
                "// Line 116:         {",
                "// Line 117:             return new RedirectResult(imageUrl, false);",
                "// Line 118:         }",
                "// Line 119: ",
                "// Line 120:         return NotFound();",
                "// Line 121:     }",
                "// Line 122: ",
                "// Line 123:     private bool IsAllowed(string encodedImagePath)",
                "// Line 124:     {",
                "// vulnerable line: 125: if(Uri.IsWellFormedUriString(encodedImagePath, UriKind.Relative))",
                "// Line 126:         {",
                "// Line 127:             return true;",
                "// Line 128:         }",
                "// Line 129: ",
                "// Line 130:         var builder = new UriBuilder(encodedImagePath);",
                "// Line 131: ",
                "// Line 132:         foreach (var allowedMediaHost in _contentSettings.AllowedMediaHosts)",
                "// Line 133:         {",
                "// Line 134:             if (string.Equals(builder.Host, allowedMediaHost, StringComparison.InvariantCultureIgnoreCase))",
                "// Line 135:             {"
            ]
        },
        {
            "filename_of_changes": "PreviewController.cs",
            "code_language": "C#",
            "number_of_lines_added_for_mitigation": "2",
            "number_of_lines_deleted_vulnerable_to_cve": "2",
            "Code_with_highlighted_vulnerability_lines": [
                "// Line 145:         return new EmptyResult();",
                "// Line 146:     }",
                "// Line 147: ",
                "// Line 148:     public ActionResult End(string? redir = null)",
                "// Line 149:     {",
                "// Line 150:         _cookieManager.ExpireCookie(Constants.Web.PreviewCookieName);",
                "// Line 151: ",
                "// Line 152:         // Expire Client-side cookie that determines whether the user has accepted to be in Preview Mode when visiting the website.",
                "// Line 153:         _cookieManager.ExpireCookie(Constants.Web.AcceptPreviewCookieName);",
                "// Line 154: ",
                "// vulnerable line: 155: if (Uri.IsWellFormedUriString(redir, UriKind.Relative)",
                "// vulnerable line: 156: && redir.StartsWith(\"//\") == false",
                "// Line 157:             && Uri.TryCreate(redir, UriKind.Relative, out Uri? url))",
                "// Line 158:         {",
                "// Line 159:             return Redirect(url.ToString());",
                "// Line 160:         }",
                "// Line 161: ",
                "// Line 162:         return Redirect(\"/\");",
                "// Line 163:     }",
                "// Line 164: }"
            ]
        },
        {
            "filename_of_changes": "WebPath.cs",
            "code_language": "C#",
            "number_of_lines_added_for_mitigation": "24",
            "number_of_lines_deleted_vulnerable_to_cve": "0",
            "Code_with_highlighted_vulnerability_lines": []
        }
    ]
}