{
    "cve_id": "CVE-2022-36028",
    "cve_description": "Greenlight is an end-user interface for BigBlueButton servers. Versions prior to 2.13.0 have an open redirect vulnerability in the Login page due to unchecked the value of the `return_to` cookie. Versions 2.13.0 contains a patch for the issue.\n",
    "cve_publish_date": "2024-04-25T21:15Z",
    "cwe_id": "NVD-CWE-noinfo",
    "cwe_name": "Insufficient Information",
    "cwe_description": "There is insufficient information about the issue to classify it; details are unkown or unspecified.",
    "commit_message": "Added additional check when redirecting with return_to (#3631)\n\n* Added additional check when redirecting with return_to\r\n\r\n* Fixed test",
    "type_of_change": "Modification",
    "changes": [
        {
            "filename_of_changes": "authenticator.rb",
            "code_language": "Ruby",
            "number_of_lines_added_for_mitigation": "3",
            "number_of_lines_deleted_vulnerable_to_cve": "1",
            "Code_with_highlighted_vulnerability_lines": [
                "// Line 43:       redirect_to admins_path",
                "// Line 44:     elsif user.activated?",
                "// Line 45:       # Dont redirect to any of these urls",
                "// Line 46:       dont_redirect_to = [root_url, signin_url, ldap_signin_url, ldap_callback_url, signup_url, unauthorized_url,",
                "// Line 47:                           internal_error_url, not_found_url]",
                "// Line 48: ",
                "// Line 49:       unless ENV['OAUTH2_REDIRECT'].nil?",
                "// Line 50:         dont_redirect_to.push(File.join(ENV['OAUTH2_REDIRECT'], \"auth\", \"openid_connect\", \"callback\"))",
                "// Line 51:       end",
                "// Line 52: ",
                "// vulnerable line: 53: url = if cookies[:return_to] && !dont_redirect_to.include?(cookies[:return_to])",
                "// Line 54:         cookies[:return_to]",
                "// Line 55:       elsif user.role.get_permission(\"can_create_rooms\")",
                "// Line 56:         user.main_room",
                "// Line 57:       else",
                "// Line 58:         cant_create_rooms_path",
                "// Line 59:       end",
                "// Line 60: ",
                "// Line 61:       # Delete the cookie if it exists",
                "// Line 62:       cookies.delete :return_to if cookies[:return_to]",
                "// Line 63: "
            ]
        },
        {
            "filename_of_changes": "sessions_controller_spec.rb",
            "code_language": "Ruby",
            "number_of_lines_added_for_mitigation": "1",
            "number_of_lines_deleted_vulnerable_to_cve": "1",
            "Code_with_highlighted_vulnerability_lines": [
                "// Line 164: ",
                "// Line 165:       expect(@request.session[:user_id]).to be_nil",
                "// Line 166:       expect(flash[:alert]).to eq(I18n.t(\"registration.banned.fail\"))",
                "// Line 167:       expect(response).to redirect_to(root_path)",
                "// Line 168:     end",
                "// Line 169: ",
                "// Line 170:     it \"redirects the user to the page they clicked sign in from\" do",
                "// Line 171:       user = create(:user, provider: \"greenlight\",",
                "// Line 172:         password: \"Example1!\", password_confirmation: 'example')",
                "// Line 173: ",
                "// vulnerable line: 174: url = Faker::Internet.domain_name",
                "// Line 175: ",
                "// Line 176:       @request.cookies[:return_to] = url",
                "// Line 177: ",
                "// Line 178:       post :create, params: {",
                "// Line 179:         session: {",
                "// Line 180:           email: user.email,",
                "// Line 181:           password: 'Example1!',",
                "// Line 182:         },",
                "// Line 183:       }",
                "// Line 184: "
            ]
        }
    ]
}