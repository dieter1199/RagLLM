{
    "cve_id": "CVE-2024-29898",
    "cve_description": "CreateWiki is Miraheze's MediaWiki extension for requesting & creating wikis. An oversight during the writing of the patch for CVE-2024-29897 may have exposed suppressed wiki requests to private wikis that added Special:RequestWikiQueue to the read whitelist to users without the `(read)` permission. This vulnerability is fixed in 8f8442ed5299510ea3e58416004b9334134c149c.",
    "cve_publish_date": "2024-03-28T14:15Z",
    "cwe_id": "NVD-CWE-noinfo",
    "cwe_name": "Insufficient Information",
    "cwe_description": "There is insufficient information about the issue to classify it; details are unkown or unspecified.",
    "commit_message": "Remove checks for `(read)` (#497)\n\nUnnecessary checks, since if the user doesn't have this perm it should\r\nnot be able to reach the special pages or APIs to begin with.",
    "type_of_change": "Modification",
    "changes": [
        {
            "filename_of_changes": "RequestWikiRequestViewer.php",
            "code_language": "PHP",
            "number_of_lines_added_for_mitigation": "1",
            "number_of_lines_deleted_vulnerable_to_cve": "1",
            "Code_with_highlighted_vulnerability_lines": [
                "// Line 37:             3 => 'suppressrevision',",
                "// Line 38:         ];",
                "// Line 39: ",
                "// Line 40:         // Gets user from request",
                "// Line 41:         $userR = $context->getUser();",
                "// Line 42: ",
                "// Line 43:         // if request isn't found, it doesn't exist",
                "// Line 44:         // but if we can't view the request, it also doesn't exist",
                "// Line 45:         $permissionManager = MediaWikiServices::getInstance()->getPermissionManager();",
                "// Line 46: ",
                "// vulnerable line: 47: if ( $visibilityConds[$request->visibility] !== 'read' && $permissionManager->userHasRight( $userR, 'read' ) ) {",
                "// Line 48:             if ( !$permissionManager->userHasAllRights( $userR, 'createwiki', $visibilityConds[$request->visibility] ) ) {",
                "// Line 49:                 $context->getOutput()->addHTML( Html::errorBox( wfMessage( 'requestwiki-unknown' )->escaped() ) );",
                "// Line 50: ",
                "// Line 51:                 return [];",
                "// Line 52:             }",
                "// Line 53:         }",
                "// Line 54: ",
                "// Line 55:         $formDescriptor = [",
                "// Line 56:             'sitename' => [",
                "// Line 57:                 'label-message' => 'requestwikiqueue-request-label-sitename',"
            ]
        },
        {
            "filename_of_changes": "RestWikiRequest.php",
            "code_language": "PHP",
            "number_of_lines_added_for_mitigation": "1",
            "number_of_lines_deleted_vulnerable_to_cve": "1",
            "Code_with_highlighted_vulnerability_lines": [
                "// Line 61:         if ( $wikiRequest ) {",
                "// Line 62:             $wikiRequestVisibility = $visibilityConds[$wikiRequest->cw_visibility];",
                "// Line 63: ",
                "// Line 64:             /*",
                "// Line 65:              * CreateWiki is enabled globally on all wikis in the farm.",
                "// Line 66:              *",
                "// Line 67:              * Require both (createwiki) and the required permission to prevent suppressed requests from",
                "// Line 68:              * being revealed to local suppressors/sysops",
                "// Line 69:              */",
                "// Line 70: ",
                "// vulnerable line: 71: if ( $wikiRequestVisibility !== 'read' && $this->getAuthority()->isAllowed( 'read' ) ) {",
                "// Line 72:                 if ( !$this->getAuthority()->isAllowedAll( 'createwiki', $wikiRequestVisibility ) ) {",
                "// Line 73:                     // User does not have permission to view this request",
                "// Line 74:                     return $this->getResponseFactory()->createHttpError( 404, ['message' => 'Request not found'] );",
                "// Line 75:                 }",
                "// Line 76:             }",
                "// Line 77:             $response = [",
                "// Line 78:                 'comment' => $wikiRequest->cw_comment,",
                "// Line 79:                 'dbname' => $wikiRequest->cw_dbname,",
                "// Line 80:                 'language' => $wikiRequest->cw_language,",
                "// Line 81:                 'sitename' => $wikiRequest->cw_sitename,"
            ]
        }
    ]
}