{
    "cve_id": "CVE-2024-32871",
    "cve_description": "Pimcore is an Open Source Data & Experience Management Platform. The Pimcore thumbnail generation can be used to flood the server with large files. By changing the file extension or scaling factor of the requested thumbnail, attackers can create files that are much larger in file size than the original. This vulnerability is fixed in 11.2.4.",
    "cve_publish_date": "2024-06-04T15:15Z",
    "cwe_id": "CWE-770",
    "cwe_name": "Allocation of Resources Without Limits or Throttling",
    "cwe_description": "The product allocates a reusable resource or group of resources on behalf of an actor without imposing any restrictions on the size or number of resources that can be allocated, in violation of the intended security policy for that actor.",
    "commit_message": "Merge pull request from GHSA-277c-5vvj-9pwx\n\n* Introduce allowed formats and max scale factor\n\n* Add documentation, upgrade notes and use floatNode for max_scale_factor\n\n* Update to max_scaling_factor\n\n* Cast format to lower\n\n* Fix typo",
    "type_of_change": "Modification",
    "changes": [
        {
            "filename_of_changes": "Configuration.php",
            "code_language": "PHP",
            "number_of_lines_added_for_mitigation": "12",
            "number_of_lines_deleted_vulnerable_to_cve": "0",
            "Code_with_highlighted_vulnerability_lines": []
        },
        {
            "filename_of_changes": "ImageThumbnail.php",
            "code_language": "PHP",
            "number_of_lines_added_for_mitigation": "8",
            "number_of_lines_deleted_vulnerable_to_cve": "0",
            "Code_with_highlighted_vulnerability_lines": []
        },
        {
            "filename_of_changes": "ImageThumbnail.php",
            "code_language": "PHP",
            "number_of_lines_added_for_mitigation": "7",
            "number_of_lines_deleted_vulnerable_to_cve": "1",
            "Code_with_highlighted_vulnerability_lines": [
                "// Line 68:             'pathReference' => $pathReference,",
                "// Line 69:             'frontendPath' => $path,",
                "// Line 70:         ]);",
                "// Line 71:         \\Pimcore::getEventDispatcher()->dispatch($event, FrontendEvents::ASSET_VIDEO_IMAGE_THUMBNAIL);",
                "// Line 72:         $path = $event->getArgument('frontendPath');",
                "// Line 73: ",
                "// Line 74:         return $path;",
                "// Line 75:     }",
                "// Line 76: ",
                "// Line 77:     /**",
                "// vulnerable line: 78: * @throws \\Exception",
                "// Line 79:      *",
                "// Line 80:      * @internal",
                "// Line 81:      */",
                "// Line 82:     public function generate(bool $deferredAllowed = true): void",
                "// Line 83:     {",
                "// Line 84:         $deferred = $deferredAllowed && $this->deferred;",
                "// Line 85:         $generated = false;",
                "// Line 86: ",
                "// Line 87:         if ($this->asset && empty($this->pathReference)) {",
                "// Line 88:             $cs = $this->asset->getCustomSetting('image_thumbnail_time');",
                "// Line 194:         if (!empty($selector) && $thumbnailConfig === null) {",
                "// Line 195:             throw new Model\\ExceptionotFoundException('Thumbnail definition \"' . (is_string($selector) ? $selector : '') . '\" does not exist');",
                "// Line 196:         }",
                "// Line 197: ",
                "// Line 198:         return $thumbnailConfig;",
                "// Line 199:     }",
                "// Line 200: ",
                "// Line 201:     /**",
                "// Line 202:      *",
                "// Line 203:      *",
                "// vulnerable line: 204: * @throws \\Exception",
                "// Line 205:      */",
                "// Line 206:     public function getMedia(string $name, int $highRes = 1): ?Image\\ThumbnailInterface",
                "// Line 207:     {",
                "// Line 208:         $thumbConfig = $this->getConfig();",
                "// Line 209:         if ($thumbConfig instanceof Image\\Thumbnail\\Config) {",
                "// Line 210:             $mediaConfigs = $thumbConfig->getMedias();",
                "// Line 211: ",
                "// Line 212:             if (isset($mediaConfigs[$name])) {",
                "// Line 213:                 $thumbConfigRes = clone $thumbConfig;",
                "// Line 214:                 $thumbConfigRes->selectMedia($name);"
            ]
        },
        {
            "filename_of_changes": "ImageThumbnailTrait.php",
            "code_language": "PHP",
            "number_of_lines_added_for_mitigation": "25",
            "number_of_lines_deleted_vulnerable_to_cve": "0",
            "Code_with_highlighted_vulnerability_lines": []
        },
        {
            "filename_of_changes": "Thumbnail.php",
            "code_language": "PHP",
            "number_of_lines_added_for_mitigation": "12",
            "number_of_lines_deleted_vulnerable_to_cve": "0",
            "Code_with_highlighted_vulnerability_lines": []
        },
        {
            "filename_of_changes": "ThumbnailFormatNotSupportedException.php",
            "code_language": "PHP",
            "number_of_lines_added_for_mitigation": "23",
            "number_of_lines_deleted_vulnerable_to_cve": "0",
            "Code_with_highlighted_vulnerability_lines": []
        },
        {
            "filename_of_changes": "ThumbnailMaxScalingFactorException.php",
            "code_language": "PHP",
            "number_of_lines_added_for_mitigation": "23",
            "number_of_lines_deleted_vulnerable_to_cve": "0",
            "Code_with_highlighted_vulnerability_lines": []
        }
    ]
}