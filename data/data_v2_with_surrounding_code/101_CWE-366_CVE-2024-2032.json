{
    "cve_id": "CVE-2024-2032",
    "cve_description": "A race condition vulnerability exists in zenml-io/zenml versions up to and including 0.55.3, which allows for the creation of multiple users with the same username when requests are sent in parallel. This issue was fixed in version 0.55.5. The vulnerability arises due to insufficient handling of concurrent user creation requests, leading to data inconsistencies and potential authentication problems. Specifically, concurrent processes may overwrite or corrupt user data, complicating user identification and posing security risks. This issue is particularly concerning for APIs that rely on usernames as input parameters, such as PUT /api/v1/users/test_race, where it could lead to further complications.",
    "cve_publish_date": "2024-06-06T19:15Z",
    "cwe_id": "CWE-366",
    "cwe_name": "Race Condition within a Thread",
    "cwe_description": "If two threads of execution use a resource simultaneously, there exists the possibility that resources may be used while invalid, in turn making the state of execution undefined.",
    "commit_message": "Uniquely constrained users table (#2483)\n\n* use db constrains for users\r\n\r\n* lint a bit\r\n\r\n* coderabbitai\r\n\r\n* set rate limits for login api\r\n\r\n* Revert \"set rate limits for login api\"\r\n\r\nThis reverts commit 78ce40e738e73ce7d9398c73559f3d29a502c24f.\r\n\r\n* bring checks back\r\n\r\n* Auto-update of Starter template\r\n\r\n* Auto-update of NLP template\r\n\r\n* review suggestions\r\n\r\n* resolve branching\r\n\r\n* Auto-update of Starter template\r\n\r\n* Auto-update of NLP template\r\n\r\n* lint\r\n\r\n---------\r\n\r\nCo-authored-by: GitHub Actions <actions@github.com>",
    "type_of_change": "Modification",
    "changes": [
        {
            "filename_of_changes": "test_zen_store.py",
            "code_language": "Python",
            "number_of_lines_added_for_mitigation": "3",
            "number_of_lines_deleted_vulnerable_to_cve": "2",
            "Code_with_highlighted_vulnerability_lines": [
                "// Line 415: ):",
                "// Line 416:     \"\"\"Tests creating a user with an existing username fails in parallel mode.\"\"\"",
                "// Line 417: ",
                "// Line 418:     def silent_create_user(user_request: UserRequest):",
                "// Line 419:         \"\"\"This function attempts to create a user and silently passes",
                "// Line 420:         if a duplicate user exists. This is used to simulate race",
                "// Line 421:         conditions in parallel user creation.",
                "// Line 422:         \"\"\"",
                "// Line 423:         try:",
                "// Line 424:             clean_client.zen_store.create_user(user_request)",
                "// vulnerable line: 425: except EntityExistsError:",
                "// Line 426:             pass",
                "// Line 427: ",
                "// Line 428:     user_name = \"test_user\"",
                "// Line 429:     password = \"P@ssw0rd\"",
                "// Line 430:     count = 100",
                "// Line 431: ",
                "// Line 432:     threads: List[Thread] = []",
                "// Line 433:     for _ in range(count):",
                "// Line 434:         t = Thread(",
                "// Line 435:             target=silent_create_user,",
                "// Line 456:         service_account_request: ServiceAccountRequest,",
                "// Line 457:     ):",
                "// Line 458:         \"\"\"This function attempts to create a service account and silently",
                "// Line 459:         passes if a duplicate user exists. This is used to simulate race",
                "// Line 460:         conditions in parallel user creation.",
                "// Line 461:         \"\"\"",
                "// Line 462:         try:",
                "// Line 463:             clean_client.zen_store.create_service_account(",
                "// Line 464:                 service_account_request",
                "// Line 465:             )",
                "// vulnerable line: 466: except EntityExistsError:",
                "// Line 467:             pass",
                "// Line 468: ",
                "// Line 469:     user_name = \"test_user\"",
                "// Line 470:     count = 100",
                "// Line 471: ",
                "// Line 472:     threads: List[Thread] = []",
                "// Line 473:     for _ in range(count):",
                "// Line 474:         t = Thread(",
                "// Line 475:             target=silent_create_service_account,",
                "// Line 476:             args=(ServiceAccountRequest(name=user_name, active=True),),"
            ]
        },
        {
            "filename_of_changes": "user_schemas.py",
            "code_language": "Python",
            "number_of_lines_added_for_mitigation": "2",
            "number_of_lines_deleted_vulnerable_to_cve": "1",
            "Code_with_highlighted_vulnerability_lines": [
                "// Line 10: #  distributed under the License is distributed on an \"AS IS\" BASIS,",
                "// Line 11: #  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express",
                "// Line 12: #  or implied. See the License for the specific language governing",
                "// Line 13: #  permissions and limitations under the License.",
                "// Line 14: \"\"\"SQLModel implementation of user tables.\"\"\"",
                "// Line 15: ",
                "// Line 16: from datetime import datetime",
                "// Line 17: from typing import TYPE_CHECKING, Any, List, Optional",
                "// Line 18: from uuid import UUID",
                "// Line 19: ",
                "// vulnerable line: 20: from sqlalchemy import TEXT, Column",
                "// Line 21: from sqlmodel import Field, Relationship",
                "// Line 22: ",
                "// Line 23: from zenml.models import (",
                "// Line 24:     ServiceAccountRequest,",
                "// Line 25:     ServiceAccountResponse,",
                "// Line 26:     ServiceAccountResponseBody,",
                "// Line 27:     ServiceAccountResponseMetadata,",
                "// Line 28:     ServiceAccountUpdate,",
                "// Line 29:     UserRequest,",
                "// Line 30:     UserResponse,"
            ]
        }
    ]
}