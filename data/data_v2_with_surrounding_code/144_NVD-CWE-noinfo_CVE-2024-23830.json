{
    "cve_id": "CVE-2024-23830",
    "cve_description": "MantisBT is an open source issue tracker. Prior to version 2.26.1, an unauthenticated attacker who knows a user's email address and username can hijack the user's account by poisoning the link in the password reset notification message. A patch is available in version 2.26.1. As a workaround, define `$g_path` as appropriate in `config_inc.php`.",
    "cve_publish_date": "2024-02-20T22:15Z",
    "cwe_id": "NVD-CWE-noinfo",
    "cwe_name": "Insufficient Information",
    "cwe_description": "There is insufficient information about the issue to classify it; details are unkown or unspecified.",
    "commit_message": "Merge pull request from GHSA-mcqj-7p29-9528\n\n* Address host header injection vulnerability\n\n$g_path is empty by default, and should be defined in config_inc.php.\nNot doing so is a security risk, as the path will then be set based on\nheaders from the HTTP request, exposing the system to Host Header\ninjection attacks.\n\nDocument the risk in PHPDoc and Admin Guide.\n\nMove the code that initializes $g_path's default value from\nconfig_defaults_inc.php to a function in core.php.\n\nDetect if $g_path was defaulted, and if yes alert the user in:\n- Login Page (if $g_admin_checks == ON)\n- Admin Checks\n\nFixes #19381, CVE-2024-23830, GHSA-mcqj-7p29-9528\n\n* Remove dead code\n\n* Use OWASP as reference for host header injection\n\n* Link to OWASP reference page from admin guide\n\n* Invalid $g_path at install time is a hard fail\n\nEmpty $g_path remains just a warning about the security risk.\nRequest and set $g_path at install time\n\nThis is an improvement on the original patch for CVE-2024-23830.\n\nThe admin is now able to set $g_path when installing MantisBT. A default\nvalue is provided, based on the URL used to perform the installation\n(using the same logic that is applied when $g_path is empty).\n\nA check of the provided URL is performed during install stage 2, and an\nerror is reported if it is invalid. If an empty $g_path is given, then\nwe only display a warning about the security risk.\n\nThe URL is then stored as $g_path in the generated config_inc.php file\nat stage 5.\n\nThis greatly reduces the risk of the admin forgetting to set $g_path\nmanually, while still allowing them to set it to empty should they want\nto.\n\nFixes #19381\n\n* Add Reset button to path input\n\nReuse the existing functionality implemented for database prefix/suffix,\nwith the following changes\n\n- Rename `reset-prefix` selector class to `reset` to be more generic\n- Add Reset functionality markup to path input including default value\n- Add title attribute to Reset buttons\n- Adapt initialization logic to only set the default value for the\n  table-prefix fields",
    "type_of_change": "Modification",
    "changes": [
        {
            "filename_of_changes": "check_paths_inc.php",
            "code_language": "PHP",
            "number_of_lines_added_for_mitigation": "12",
            "number_of_lines_deleted_vulnerable_to_cve": "0",
            "Code_with_highlighted_vulnerability_lines": []
        },
        {
            "filename_of_changes": "login_page.php",
            "code_language": "PHP",
            "number_of_lines_added_for_mitigation": "9",
            "number_of_lines_deleted_vulnerable_to_cve": "2",
            "Code_with_highlighted_vulnerability_lines": [
                "// Line 154: ",
                "// Line 155:     /**",
                "// Line 156:      * Display Warnings for enabled debugging / developer settings",
                "// Line 157:      * @param string $p_type    Message Type.",
                "// Line 158:      * @param string $p_setting Setting.",
                "// Line 159:      * @param string $p_value   Value.",
                "// Line 160:      * @return string",
                "// Line 161:      */",
                "// Line 162:     function debug_setting_message ( $p_type, $p_setting, $p_value ) {",
                "// Line 163:         return sprintf( lang_get( 'warning_change_setting' ), $p_setting, $p_value )",
                "// vulnerable line: 164: . sprintf( lang_get( 'word_separator' ) )",
                "// vulnerable line: 165: . sprintf( lang_get( \"warning_{$p_type}_hazard\" ) );",
                "// Line 166:     }",
                "// Line 167: ",
                "// Line 168:     $t_config = 'show_detailed_errors';",
                "// Line 169:     if( config_get_global( $t_config ) != OFF ) {",
                "// Line 170:         $t_warnings[] = debug_setting_message( 'security', $t_config, 'OFF' );",
                "// Line 171:     }",
                "// Line 172: ",
                "// Line 173:     # since admin directory and db_upgrade lists are available check for missing db upgrades",
                "// Line 174:     # if db version is 0, we do not have a valid database.",
                "// Line 175:     $t_db_version = config_get( 'database_version', 0, ALL_USERS, ALL_PROJECTS );"
            ]
        }
    ]
}