{
    "cve_id": "CVE-2024-28187",
    "cve_description": "SOY CMS is an open source CMS (content management system) that allows you to build blogs and online shops. SOY CMS versions prior to 3.14.2 are vulnerable to an OS Command Injection vulnerability within the file upload feature when accessed by an administrator. The vulnerability enables the execution of arbitrary OS commands through specially crafted file names containing a semicolon, affecting the jpegoptim functionality. This vulnerability has been patched in version 3.14.2. Users are advised to upgrade. There are no known workarounds for this vulnerability.",
    "cve_publish_date": "2024-03-11T20:15Z",
    "cwe_id": "NVD-CWE-noinfo",
    "cwe_name": "Insufficient Information",
    "cwe_description": "There is insufficient information about the issue to classify it; details are unkown or unspecified.",
    "commit_message": "[Fix]OS Command Injection via file upload. https://github.com/inunosinsi/soycms/issues/21",
    "type_of_change": "Modification",
    "changes": [
        {
            "filename_of_changes": "SearchAction.class.php",
            "code_language": "PHP",
            "number_of_lines_added_for_mitigation": "2",
            "number_of_lines_deleted_vulnerable_to_cve": "1",
            "Code_with_highlighted_vulnerability_lines": [
                "// Line 54:             $freeword = array();",
                "// Line 55:             $keywordCounts = 0;",
                "// Line 56:             $freewordQuery = array();",
                "// Line 57: ",
                "// Line 58:             foreach(array(\"title\",\"content\",\"more\") as $column){",
                "// Line 59:                 $freeword = array();",
                "// Line 60:                 foreach($keywords as $keyword){",
                "// Line 61: ",
                "// Line 62:                     $bind_key = ':freeword'.$keywordCounts;",
                "// Line 63: ",
                "// vulnerable line: 64: if($keyword[0] == \"-\"){",
                "// Line 65:                         $keyword = substr($keyword,1);",
                "// Line 66:                         $freeword[] = 'Entry.'.$column.\" not like \".$bind_key.\"\";",
                "// Line 67:                     }else{",
                "// Line 68:                         $freeword[] = 'Entry.'.$column.\" like \".$bind_key.\"\";",
                "// Line 69:                     }",
                "// Line 70: ",
                "// Line 71:                     $binds[$bind_key] = '%'.$keyword.'%';",
                "// Line 72:                     $keywordCounts ++;",
                "// Line 73:                 }",
                "// Line 74: "
            ]
        },
        {
            "filename_of_changes": "UploadFileAction.class.php",
            "code_language": "PHP",
            "number_of_lines_added_for_mitigation": "2",
            "number_of_lines_deleted_vulnerable_to_cve": "2",
            "Code_with_highlighted_vulnerability_lines": [
                "// Line 156:                                 $responseObject->imageHeight = $imageSize[\"height\"] * $this->maxWidth / $imageSize[\"width\"];",
                "// Line 157:                             }",
                "// Line 158:                         }",
                "// Line 159:                     }",
                "// Line 160: ",
                "// Line 161:                     //jpegoptim",
                "// Line 162:                     $ext = trim(trim(substr($_FILES['file'][\"type\"], strpos($_FILES['file'][\"type\"], \"/\")), \"/\"));",
                "// Line 163:                     switch($ext){",
                "// Line 164:                         case \"jpeg\":",
                "// Line 165:                             exec(\"jpegoptim -V\", $out);",
                "// vulnerable line: 166: if(isset($out) && count($out)){",
                "// vulnerable line: 167: exec(\"jpegoptim --strip-all \" . $filepath);",
                "// Line 168:                             }",
                "// Line 169:                             break;",
                "// Line 170:                     }",
                "// Line 171:                 }",
                "// Line 172:             }else{",
                "// Line 173:                 $responseObject->result = false;",
                "// Line 174:                 $responseObject->message = \"ファイル移動で原因不明のエラーが発生しました\";",
                "// Line 175:                 $responseObject->errorCode = 2;",
                "// Line 176:             }",
                "// Line 177:         }"
            ]
        }
    ]
}