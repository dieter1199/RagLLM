{
    "cve_id": "CVE-2024-34081",
    "cve_description": "MantisBT (Mantis Bug Tracker) is an open source issue tracker.  Improper escaping of a custom field's name allows an attacker to inject HTML and, if CSP settings permit, achieve execution of arbitrary JavaScript when resolving or closing issues (`bug_change_status_page.php`) belonging to a project linking said custom field, viewing issues (`view_all_bug_page.php`) when the custom field is displayed as a column, or printing issues (`print_all_bug_page.php`) when the custom field is displayed as a column. Version 2.26.2 contains a patch for the issue. As a workaround, ensure Custom Field Names do not contain HTML tags.",
    "cve_publish_date": "2024-05-14T15:38Z",
    "cwe_id": "NVD-CWE-noinfo",
    "cwe_name": "Insufficient Information",
    "cwe_description": "There is insufficient information about the issue to classify it; details are unkown or unspecified.",
    "commit_message": "Proper escaping of Custom Field name for display\n\nFixes XSS vulnerability on\n- bug_change_status_page.php (resolving and closing issues)\n- view_all_bug_page.php & print_all_bug_page.php (when the custom field\n  is selected as a column for display/print)\n\nFixes #34432, CVE-2024-34081",
    "type_of_change": "Modification",
    "changes": [
        {
            "filename_of_changes": "bug_change_status_page.php",
            "code_language": "PHP",
            "number_of_lines_added_for_mitigation": "1",
            "number_of_lines_deleted_vulnerable_to_cve": "1",
            "Code_with_highlighted_vulnerability_lines": [
                "// Line 296: ",
                "// Line 297:         if( !$t_show_custom_field ) {",
                "// Line 298:             continue;",
                "// Line 299:         }",
                "// Line 300: ",
                "// Line 301:         $t_has_write_access = custom_field_has_write_access( $t_id, $f_bug_id );",
                "// Line 302: ?>",
                "// Line 303:     <tr>",
                "// Line 304:         <th class=\"category\">",
                "// Line 305:             <?php if( $t_require && $t_has_write_access ) {?><span class=\"required\">*</span><?php } ?>",
                "// vulnerable line: 306: <?php echo lang_get_defaulted( $t_def['name'] ) ?>",
                "// Line 307:         </th>",
                "// Line 308:         <td>",
                "// Line 309: <?php",
                "// Line 310:             if( $t_has_write_access ) {",
                "// Line 311:                 print_custom_field_input( $t_def, $f_bug_id, $t_require );",
                "// Line 312:             } elseif( custom_field_has_read_access( $t_id, $f_bug_id ) ) {",
                "// Line 313:                 print_custom_field_value( $t_def, $t_id, $f_bug_id );",
                "// Line 314:             }",
                "// Line 315: ?>",
                "// Line 316:         </td>"
            ]
        },
        {
            "filename_of_changes": "print_api.php",
            "code_language": "PHP",
            "number_of_lines_added_for_mitigation": "6",
            "number_of_lines_deleted_vulnerable_to_cve": "1",
            "Code_with_highlighted_vulnerability_lines": [
                "// Line 1340:                 } else {",
                "// Line 1341:                     $p_dir = 'ASC';",
                "// Line 1342:                 }",
                "// Line 1343:             } else {",
                "// Line 1344:                 # Otherwise always start with ascending",
                "// Line 1345:                 $p_dir = 'ASC';",
                "// Line 1346:             }",
                "// Line 1347:             $t_sort_field = rawurlencode( $p_sort_field );",
                "// Line 1348:             $t_print_parameter = ( $p_columns_target == COLUMNS_TARGET_PRINT_PAGE ) ? '&print=1' : '';",
                "// Line 1349:             $t_filter_parameter = filter_is_temporary( $g_filter ) ? filter_get_temporary_key_param( $g_filter ) . '&' : '';",
                "// vulnerable line: 1350: print_link( 'view_all_set.php?' . $t_filter_parameter . 'sort_add=' . $t_sort_field . '&dir_add=' . $p_dir . '&type=' . FILTER_ACTION_PARSE_ADD . $t_print_parameter, $p_string );",
                "// Line 1351:             break;",
                "// Line 1352:         default:",
                "// Line 1353:             echo $p_string;",
                "// Line 1354:     }",
                "// Line 1355: }",
                "// Line 1356: ",
                "// Line 1357: /**",
                "// Line 1358:  * Print manage user sort link",
                "// Line 1359:  * @param string  $p_page          The page within mantis to link to.",
                "// Line 1360:  * @param string  $p_string        The displayed text of the link."
            ]
        }
    ]
}