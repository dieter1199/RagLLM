{
    "cve_id": "CVE-2023-48296",
    "cve_description": "OroPlatform is a PHP Business Application Platform (BAP).  Navigation history, most viewed and favorite navigation items are returned to storefront user in JSON navigation response if ID of storefront user matches ID of back-office user. This vulnerability is fixed in 5.1.4.\n",
    "cve_publish_date": "2024-03-25T19:15Z",
    "cwe_id": "NVD-CWE-noinfo",
    "cwe_name": "Insufficient Information",
    "cwe_description": "There is insufficient information about the issue to classify it; details are unkown or unspecified.",
    "commit_message": "BB-22832: Multifile attribute is shown on product visibility page in back-office - 5.1 (#36428)",
    "type_of_change": "Modification",
    "changes": [
        {
            "filename_of_changes": "AttributeFormViewListener.php",
            "code_language": "PHP",
            "number_of_lines_added_for_mitigation": "1",
            "number_of_lines_deleted_vulnerable_to_cve": "10",
            "Code_with_highlighted_vulnerability_lines": [
                "// Line 1: <?php",
                "// Line 2: ",
                "// Line 3: namespace Oro\\Bundle\\ProductBundle\\EventListener;",
                "// Line 4: ",
                "// vulnerable line: 5: use Oro\\Bundle\\AttachmentBundle\\Helper\\FieldConfigHelper;",
                "// Line 6: use Oro\\Bundle\\CMSBundle\\DBAL\\Types\\WYSIWYGType;",
                "// Line 7: use Oro\\Bundle\\EntityConfigBundle\\Attribute\\Entity\\AttributeGroup;",
                "// Line 8: use Oro\\Bundle\\EntityConfigBundle\\Entity\\FieldConfigModel;",
                "// Line 9: use Oro\\Bundle\\EntityConfigBundle\\EventListener\\AttributeFormViewListener as BaseAttributeFormViewListener;",
                "// Line 10: use Oro\\Bundle\\EntityConfigBundle\\Manager\\AttributeManager;",
                "// Line 11: use Oro\\Bundle\\EntityConfigBundle\\Provider\\ConfigProvider;",
                "// Line 12: use Oro\\Bundle\\ProductBundle\\Entity\\Product;",
                "// Line 13: use Oro\\BundleIBundle\\Event\\BeforeListRenderEvent;",
                "// Line 14: use Oro\\BundleIBundle\\View\\ScrollData;",
                "// Line 15: use Symfony\\Component\\Form\\FormView;",
                "// Line 124:                 if (!$this->isSeparateGroup($attribute->getType())) {",
                "// Line 125:                     continue;",
                "// Line 126:                 }",
                "// Line 127: ",
                "// Line 128:                 $config = $this->entityConfigProvider->getConfig(Product::class, $attribute->getFieldName());",
                "// Line 129: ",
                "// Line 130:                 $scrollData->addNamedBlock(",
                "// Line 131:                     $attribute->getFieldName(),",
                "// Line 132:                     $this->translator->trans((string) $config->get('label')),",
                "// Line 133:                     ++$priority",
                "// vulnerable line: 134: );",
                "// Line 135:             }",
                "// Line 136:         }",
                "// Line 137:     }",
                "// Line 138: ",
                "// Line 139:     /**",
                "// Line 140:      * {@inheritdoc}",
                "// Line 141:      */",
                "// Line 142:     protected function addAttributeEditBlocks(BeforeListRenderEvent $event, AttributeGroup $group, array $attributes)",
                "// Line 143:     {",
                "// Line 144:         parent::addAttributeEditBlocks($event, $group, $attributes);",
                "// Line 183:      * @param object $entity",
                "// Line 184:      * @param FieldConfigModel $attribute",
                "// Line 185:      * @return string",
                "// Line 186:      */",
                "// Line 187:     protected function renderAttributeViewData(Environment $twig, $entity, FieldConfigModel $attribute)",
                "// Line 188:     {",
                "// Line 189:         if ($this->isSeparateGroup($attribute->getType())) {",
                "// Line 190:             return $twig->render(",
                "// Line 191:                 '@OroEntityConfig/Attribute/attributeCollapsibleView.html.twig',",
                "// Line 192:                 ['entity' => $entity, 'field' => $attribute]",
                "// vulnerable line: 193: );",
                "// Line 194:         }",
                "// Line 195: ",
                "// Line 196:         return parent::renderAttributeViewData($twig, $entity, $attribute);",
                "// Line 197:     }",
                "// Line 198: ",
                "// Line 199:     protected function isSeparateGroup(?string $type): bool",
                "// Line 200:     {",
                "// vulnerable line: 201: return in_array(",
                "// vulnerable line: 202: (string)$type,",
                "// vulnerable line: 203: [",
                "// vulnerable line: 204: WYSIWYGType::TYPE,",
                "// vulnerable line: 205: FieldConfigHelper::MULTI_FILE_TYPE,",
                "// vulnerable line: 206: FieldConfigHelper::MULTI_IMAGE_TYPE",
                "// vulnerable line: 207: ],",
                "// vulnerable line: 208: true",
                "// vulnerable line: 209: );",
                "// Line 210:     }",
                "// Line 211: }"
            ]
        },
        {
            "filename_of_changes": "AttributeFormViewListenerTest.php",
            "code_language": "PHP",
            "number_of_lines_added_for_mitigation": "10",
            "number_of_lines_deleted_vulnerable_to_cve": "13",
            "Code_with_highlighted_vulnerability_lines": [
                "// Line 136:         $label = $this->getEntity(LocalizedFallbackValue::class, ['string' => 'Group1Title']);",
                "// Line 137:         $group1 = $this->getEntity(AttributeGroupStub::class, ['code' => 'group1', 'label' => $label]);",
                "// Line 138: ",
                "// Line 139:         $attributeVisible = $this->getEntity(",
                "// Line 140:             FieldConfigModel::class,",
                "// Line 141:             [",
                "// Line 142:                 'id' => 1,",
                "// Line 143:                 'fieldName' => 'someField',",
                "// Line 144:                 'data' => [",
                "// Line 145:                     'view' => ['is_displayable' => true],",
                "// vulnerable line: 146: 'form' => ['is_enabled' => true]",
                "// Line 147:                 ]",
                "// Line 148:             ]",
                "// Line 149:         );",
                "// Line 150: ",
                "// Line 151:         $inventoryStatus = $this->getEntity(FieldConfigModel::class, ['id' => 1, 'fieldName' => 'inventory_status']);",
                "// Line 152:         $images = $this->getEntity(FieldConfigModel::class, ['id' => 1, 'fieldName' => 'images']);",
                "// Line 153:         $productPriceAttributesPrices =",
                "// Line 154:             $this->getEntity(FieldConfigModel::class, ['id' => 1, 'fieldName' => 'productPriceAttributesPrices']);",
                "// Line 155:         $shortDescription = $this->getEntity(FieldConfigModel::class, ['id' => 1, 'fieldName' => 'shortDescriptions']);",
                "// Line 156:         $descriptions = $this->getEntity(FieldConfigModel::class, ['id' => 1, 'fieldName' => 'descriptions']);",
                "// Line 157:         $wysiwyg = $this->getEntity(",
                "// Line 158:             FieldConfigModel::class,",
                "// Line 159:             ['id' => 1, 'fieldName' => 'wysiwyg', 'type' => WYSIWYGType::TYPE, 'data' => [",
                "// Line 160:                 'view' => ['is_displayable' => true],",
                "// vulnerable line: 161: 'form' => ['is_enabled' => true]",
                "// Line 162:             ]]",
                "// Line 163:         );",
                "// Line 164: ",
                "// Line 165:         return [",
                "// Line 166:             'move attribute field to other group not allowed (inventory_status)' => [",
                "// Line 167:                 'groupsData' => [",
                "// Line 168:                     ['group' => $group1, 'attributes' => [$inventoryStatus]],",
                "// Line 169:                 ],",
                "// Line 170:                 'scrollData' => [",
                "// Line 171:                     ScrollData::DATA_BLOCKS => [",
                "// Line 435:                         'wysiwyg' => [",
                "// Line 436:                             'title' => 'translated wysiwyg field label',",
                "// Line 437:                             'useSubBlockDivider' => true,",
                "// Line 438:                             'subblocks' => [",
                "// Line 439:                                 [",
                "// Line 440:                                     'data' => [",
                "// Line 441:                                         'wysiwyg' => 'expected template data'",
                "// Line 442:                                     ],",
                "// Line 443:                                 ],",
                "// Line 444:                             ],",
                "// vulnerable line: 445: 'priority' => 501,",
                "// Line 446:                         ],",
                "// Line 447:                     ],",
                "// Line 448:                 ],",
                "// Line 449:             ],",
                "// Line 450:             'move multiFile attribute field to own group' => [",
                "// Line 451:                 'groupsData' => [",
                "// Line 452:                     [",
                "// Line 453:                         'group' => $this->getEntity(",
                "// Line 454:                             AttributeGroupStub::class,",
                "// Line 455:                             [",
                "// Line 495:                             'title' => 'Group1Title',",
                "// Line 496:                             'useSubBlockDivider' => true,",
                "// Line 497:                             'subblocks' => [",
                "// Line 498:                                 [",
                "// Line 499:                                     'data' => [",
                "// Line 500:                                         'someField' => 'field template'",
                "// Line 501:                                     ],",
                "// Line 502:                                 ],",
                "// Line 503:                             ],",
                "// Line 504:                         ],",
                "// vulnerable line: 505: 'multiFileField' => [",
                "// vulnerable line: 506: 'title' => 'translated multiFile field label',",
                "// Line 507:                             'useSubBlockDivider' => true,",
                "// Line 508:                             'subblocks' => [",
                "// Line 509:                                 [",
                "// Line 510:                                     'data' => [",
                "// Line 511:                                         'multiFileField' => 'expected template data'",
                "// Line 512:                                     ],",
                "// Line 513:                                 ],",
                "// Line 514:                             ],",
                "// vulnerable line: 515: 'priority' => 501,",
                "// Line 516:                         ],",
                "// Line 517:                     ],",
                "// Line 518:                 ],",
                "// Line 519:             ],",
                "// Line 520:             'move multiImage attribute field to own group' => [",
                "// Line 521:                 'groupsData' => [",
                "// Line 522:                     [",
                "// Line 523:                         'group' => $this->getEntity(",
                "// Line 524:                             AttributeGroupStub::class,",
                "// Line 525:                             [",
                "// Line 565:                             'title' => 'Group1Title',",
                "// Line 566:                             'useSubBlockDivider' => true,",
                "// Line 567:                             'subblocks' => [",
                "// Line 568:                                 [",
                "// Line 569:                                     'data' => [",
                "// Line 570:                                         'someField' => 'field template'",
                "// Line 571:                                     ],",
                "// Line 572:                                 ],",
                "// Line 573:                             ],",
                "// Line 574:                         ],",
                "// vulnerable line: 575: 'multiImageField' => [",
                "// vulnerable line: 576: 'title' => 'translated multiImage field label',",
                "// Line 577:                             'useSubBlockDivider' => true,",
                "// Line 578:                             'subblocks' => [",
                "// Line 579:                                 [",
                "// Line 580:                                     'data' => [",
                "// Line 581:                                         'multiImageField' => 'expected template data'",
                "// Line 582:                                     ],",
                "// Line 583:                                 ],",
                "// Line 584:                             ],",
                "// vulnerable line: 585: 'priority' => 501,",
                "// Line 586:                         ],",
                "// Line 587:                     ],",
                "// Line 588:                 ],",
                "// Line 589:             ],",
                "// Line 590:         ];",
                "// Line 591:     }",
                "// Line 592: ",
                "// Line 593:     /**",
                "// Line 594:      * @dataProvider editDataProvider",
                "// Line 595:      */",
                "// Line 636:         $label = $this->getEntity(LocalizedFallbackValue::class, ['string' => 'Group1Title']);",
                "// Line 637:         $group1 = $this->getEntity(AttributeGroupStub::class, ['code' => 'group1', 'label' => $label]);",
                "// Line 638: ",
                "// Line 639:         $attributeVisible = $this->getEntity(",
                "// Line 640:             FieldConfigModel::class,",
                "// Line 641:             [",
                "// Line 642:                 'id' => 1,",
                "// Line 643:                 'fieldName' => 'someField',",
                "// Line 644:                 'data' => [",
                "// Line 645:                     'view' => ['is_displayable' => true],",
                "// vulnerable line: 646: 'form' => ['is_enabled' => true]",
                "// Line 647:                 ]",
                "// Line 648:             ]",
                "// Line 649:         );",
                "// Line 650: ",
                "// Line 651:         $inventoryStatus = $this->getEntity(FieldConfigModel::class, ['id' => 1, 'fieldName' => 'inventory_status']);",
                "// Line 652:         $images = $this->getEntity(FieldConfigModel::class, ['id' => 1, 'fieldName' => 'images']);",
                "// Line 653:         $productPriceAttributesPrices =",
                "// Line 654:             $this->getEntity(FieldConfigModel::class, ['id' => 1, 'fieldName' => 'productPriceAttributesPrices']);",
                "// Line 655:         $wysiwyg = $this->getEntity(",
                "// Line 656:             FieldConfigModel::class,",
                "// Line 657:             ['id' => 1, 'fieldName' => 'wysiwyg', 'type' => WYSIWYGType::TYPE, 'data' => [",
                "// Line 658:                 'view' => ['is_displayable' => true],",
                "// vulnerable line: 659: 'form' => ['is_enabled' => true]",
                "// Line 660:             ]]",
                "// Line 661:         );",
                "// Line 662: ",
                "// Line 663:         return [",
                "// Line 664:             'move attribute field to other group not allowed (inventory_status)' => [",
                "// Line 665:                 'groupsData' => [",
                "// Line 666:                     ['group' => $group1, 'attributes' => [$inventoryStatus]],",
                "// Line 667:                 ],",
                "// Line 668:                 'scrollData' => [",
                "// Line 669:                     ScrollData::DATA_BLOCKS => [",
                "// Line 864:                         'wysiwyg' => [",
                "// Line 865:                             'title' => 'translated wysiwyg field label',",
                "// Line 866:                             'useSubBlockDivider' => true,",
                "// Line 867:                             'subblocks' => [",
                "// Line 868:                                 [",
                "// Line 869:                                     'data' => [",
                "// Line 870:                                         'wysiwyg' => 'expected template data'",
                "// Line 871:                                     ],",
                "// Line 872:                                 ],",
                "// Line 873:                             ],",
                "// vulnerable line: 874: 'priority' => 501,",
                "// Line 875:                         ],",
                "// Line 876:                     ],",
                "// Line 877:                 ],",
                "// Line 878:             ],",
                "// Line 879:             'move multiFile attribute field to own group' => [",
                "// Line 880:                 'groupsData' => [",
                "// Line 881:                     [",
                "// Line 882:                         'group' => $this->getEntity(",
                "// Line 883:                             AttributeGroupStub::class,",
                "// Line 884:                             [",
                "// Line 925:                             'title' => 'Group1Title',",
                "// Line 926:                             'useSubBlockDivider' => true,",
                "// Line 927:                             'subblocks' => [",
                "// Line 928:                                 [",
                "// Line 929:                                     'data' => [",
                "// Line 930:                                         'someField' => 'field template'",
                "// Line 931:                                     ],",
                "// Line 932:                                 ],",
                "// Line 933:                             ],",
                "// Line 934:                         ],",
                "// vulnerable line: 935: 'multiFileField' => [",
                "// vulnerable line: 936: 'title' => 'translated multiFile field label',",
                "// Line 937:                             'useSubBlockDivider' => true,",
                "// Line 938:                             'subblocks' => [",
                "// Line 939:                                 [",
                "// Line 940:                                     'data' => [",
                "// Line 941:                                         'multiFileField' => 'expected template data'",
                "// Line 942:                                     ],",
                "// Line 943:                                 ],",
                "// Line 944:                             ],",
                "// vulnerable line: 945: 'priority' => 501,",
                "// Line 946:                         ],",
                "// Line 947:                     ],",
                "// Line 948:                 ],",
                "// Line 949:             ],",
                "// Line 950:             'move multiImage attribute field to own group' => [",
                "// Line 951:                 'groupsData' => [",
                "// Line 952:                     [",
                "// Line 953:                         'group' => $this->getEntity(",
                "// Line 954:                             AttributeGroupStub::class,",
                "// Line 955:                             [",
                "// Line 996:                             'title' => 'Group1Title',",
                "// Line 997:                             'useSubBlockDivider' => true,",
                "// Line 998:                             'subblocks' => [",
                "// Line 999:                                 [",
                "// Line 1000:                                     'data' => [",
                "// Line 1001:                                         'someField' => 'field template'",
                "// Line 1002:                                     ],",
                "// Line 1003:                                 ],",
                "// Line 1004:                             ],",
                "// Line 1005:                         ],",
                "// vulnerable line: 1006: 'multiImageField' => [",
                "// vulnerable line: 1007: 'title' => 'translated multiImage field label',",
                "// Line 1008:                             'useSubBlockDivider' => true,",
                "// Line 1009:                             'subblocks' => [",
                "// Line 1010:                                 [",
                "// Line 1011:                                     'data' => [",
                "// Line 1012:                                         'multiImageField' => 'expected template data'",
                "// Line 1013:                                     ],",
                "// Line 1014:                                 ],",
                "// Line 1015:                             ],",
                "// vulnerable line: 1016: 'priority' => 501,",
                "// Line 1017:                         ],",
                "// Line 1018:                     ],",
                "// Line 1019:                 ],",
                "// Line 1020:             ],",
                "// Line 1021:         ];",
                "// Line 1022:     }",
                "// Line 1023: }"
            ]
        },
        {
            "filename_of_changes": "ProductMultiFileBlockListener.php",
            "code_language": "PHP",
            "number_of_lines_added_for_mitigation": "25",
            "number_of_lines_deleted_vulnerable_to_cve": "0",
            "Code_with_highlighted_vulnerability_lines": []
        }
    ]
}