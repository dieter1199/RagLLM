{
    "cve_id": "CVE-2023-45197",
    "cve_description": "The file upload plugin in Adminer and AdminerEvo allows an attacker to upload a file with a table name of “..” to the root of the Adminer directory. The attacker can effectively guess the name of the uploaded file and execute it. Adminer is no longer supported, but this issue was fixed in AdminerEvo version 4.8.3.",
    "cve_publish_date": "2024-06-21T15:15Z",
    "cwe_id": "CWE-434",
    "cwe_name": "Unrestricted Upload of File with Dangerous Type",
    "cwe_description": "The product allows the upload or transfer of dangerous file types that are automatically processed within its environment.",
    "commit_message": "Plugin file-upload generate temp filename no extension + prevent file to be located elsewhere then under upload path",
    "type_of_change": "Modification",
    "changes": [
        {
            "filename_of_changes": "file-upload.php",
            "code_language": "PHP",
            "number_of_lines_added_for_mitigation": "14",
            "number_of_lines_deleted_vulnerable_to_cve": "4",
            "Code_with_highlighted_vulnerability_lines": [
                "// Line 28:         }",
                "// Line 29:     }",
                "// Line 30: ",
                "// Line 31:     function processInput($field, $value, $function = \"\") {",
                "// Line 32:         if (preg_match('~(.*)_path$~', $field[\"field\"], $regs)) {",
                "// Line 33:             $table = ($_GET[\"edit\"] != \"\" ? $_GET[\"edit\"] : $_GET[\"select\"]);",
                "// Line 34:             $name = \"fields-$field[field]\";",
                "// Line 35:             if ($_FILES[$name][\"error\"] || !preg_match(\"~(\\.($this->extensions))?\\$~\", $_FILES[$name][\"name\"], $regs2)) {",
                "// Line 36:                 return false;",
                "// Line 37:             }",
                "// vulnerable line: 38: //! unlink old",
                "// vulnerable line: 39: $filename = uniqid() . $regs2[0];",
                "// vulnerable line: 40: if (!move_uploaded_file($_FILES[$name][\"tmp_name\"], \"$this->uploadPath$table/$regs[1]-$filename\")) {",
                "// Line 41:                 return false;",
                "// Line 42:             }",
                "// Line 43:             return q($filename);",
                "// Line 44:         }",
                "// Line 45:     }",
                "// Line 46: ",
                "// Line 47:     function selectVal($val, &$link, $field, $original) {",
                "// Line 48:         if ($val != \"\" && preg_match('~(.*)_path$~', $field[\"field\"], $regs)) {",
                "// Line 49:             $link = \"$this->displayPath$_GET[select]/$regs[1]-$val\";",
                "// Line 50:         }"
            ]
        }
    ]
}