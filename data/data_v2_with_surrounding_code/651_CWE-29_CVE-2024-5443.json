{
    "cve_id": "CVE-2024-5443",
    "cve_description": "CVE-2024-4320 describes a vulnerability in the parisneo/lollms software, specifically within the `ExtensionBuilder().build_extension()` function. The vulnerability arises from the `/mount_extension` endpoint, where a path traversal issue allows attackers to navigate beyond the intended directory structure. This is facilitated by the `data.category` and `data.folder` parameters accepting empty strings (`\"\"`), which, due to inadequate input sanitization, can lead to the construction of a `package_path` that points to the root directory. Consequently, if an attacker can create a `config.yaml` file in a controllable path, this path can be appended to the `extensions` list and trigger the execution of `__init__.py` in the current directory, leading to remote code execution. The vulnerability affects versions up to 5.9.0, and has been addressed in version 9.8.",
    "cve_publish_date": "2024-06-22T17:15Z",
    "cwe_id": "CWE-29",
    "cwe_name": "Path Traversal: '\\..\\filename'",
    "cwe_description": "The product uses external input to construct a pathname that should be within a restricted directory, but it does not properly neutralize '\\..\\filename' (leading backslash dot dot) sequences that can resolve to a location that is outside of that directory.",
    "commit_message": "extensions removed",
    "type_of_change": "Modification",
    "changes": [
        {
            "filename_of_changes": "elf.py",
            "code_language": "Python",
            "number_of_lines_added_for_mitigation": "0",
            "number_of_lines_deleted_vulnerable_to_cve": "2",
            "Code_with_highlighted_vulnerability_lines": [
                "// Line 41:     if args.port:",
                "// Line 42:         config.port=args.port",
                "// Line 43: ",
                "// Line 44:     LOLLMSElfServer.build_instance(config=config, lollms_paths=lollms_paths, socketio=sio)",
                "// Line 45:     from lollms.server.endpoints.lollms_binding_files_server import router as lollms_binding_files_server_router",
                "// Line 46:     from lollms.server.endpoints.lollms_infos import router as lollms_infos_router",
                "// Line 47:     from lollms.server.endpoints.lollms_hardware_infos import router as lollms_hardware_infos_router",
                "// Line 48:     from lollms.server.endpoints.lollms_binding_infos import router as lollms_binding_infos_router",
                "// Line 49:     from lollms.server.endpoints.lollms_models_infos import router as lollms_models_infos_router",
                "// Line 50:     from lollms.server.endpoints.lollms_personalities_infos import router as lollms_personalities_infos_router",
                "// vulnerable line: 51: from lollms.server.endpoints.lollms_extensions_infos import router as lollms_extensions_infos_router",
                "// Line 52: ",
                "// Line 53:     from lollms.server.endpoints.lollms_configuration_infos import router as lollms_configuration_infos_router",
                "// Line 54:     ",
                "// Line 55: ",
                "// Line 56:     ",
                "// Line 57:     from lollms.server.endpoints.lollms_generator import router as lollms_generator_router",
                "// Line 58:     ",
                "// Line 59: ",
                "// Line 60:     from lollms.server.events.lollms_generation_events import add_events as lollms_generation_events_add",
                "// Line 61:     from lollms.server.events.lollms_personality_events import add_events as lollms_personality_events_add",
                "// Line 62:     from lollms.server.events.lollms_model_events import add_events as lollms_model_events_add",
                "// Line 63:     #from lollms.server.events.lollms_rag_events import add_events as lollms_rag_events_add",
                "// Line 64:     ",
                "// Line 65: ",
                "// Line 66:     app.include_router(lollms_binding_files_server_router)",
                "// Line 67:     app.include_router(lollms_infos_router)",
                "// Line 68:     app.include_router(lollms_hardware_infos_router)",
                "// Line 69:     app.include_router(lollms_binding_infos_router)",
                "// Line 70:     app.include_router(lollms_models_infos_router)",
                "// Line 71:     app.include_router(lollms_personalities_infos_router)",
                "// vulnerable line: 72: app.include_router(lollms_extensions_infos_router)",
                "// Line 73:     ",
                "// Line 74:     ",
                "// Line 75:     app.include_router(lollms_generator_router)",
                "// Line 76: ",
                "// Line 77:     app.include_router(lollms_configuration_infos_router)",
                "// Line 78:     ",
                "// Line 79: ",
                "// Line 80: ",
                "// Line 81:     lollms_generation_events_add(sio)",
                "// Line 82:     lollms_personality_events_add(sio)"
            ]
        },
        {
            "filename_of_changes": "media.py",
            "code_language": "Python",
            "number_of_lines_added_for_mitigation": "4",
            "number_of_lines_deleted_vulnerable_to_cve": "2",
            "Code_with_highlighted_vulnerability_lines": [
                "// Line 239:                 self.silence_counter += 1",
                "// Line 240:                 self.current_silence_duration += frames",
                "// Line 241:             else:",
                "// Line 242:                 self.silence_counter = 0",
                "// Line 243:                 self.current_silence_duration = 0",
                "// Line 244:                 self.sound_frames += frames",
                "// Line 245: ",
                "// Line 246:             if self.current_silence_duration > self.longest_silence_duration:",
                "// Line 247:                 self.longest_silence_duration = self.current_silence_duration",
                "// Line 248: ",
                "// vulnerable line: 249: if self.silence_counter > (self.rate / frames * self.silence_duration):",
                "// Line 250:                 ASCIIColors.red(\"Silence counter reached threshold\")",
                "// Line 251:                 trimmed_frames = self._trim_silence(self.frames)",
                "// Line 252:                 sound_percentage = self._calculate_sound_percentage(trimmed_frames)",
                "// Line 253:                 ASCIIColors.red(f\"Sound percentage {sound_percentage}\")",
                "// Line 254:                 if sound_percentage >= self.sound_threshold_percentage:",
                "// Line 255:                     self._save_wav(self.frames)",
                "// Line 256:                 self.frames = []",
                "// Line 257:                 self.silence_counter = 0",
                "// Line 258:                 self.total_frames = 0",
                "// Line 259:                 self.sound_frames = 0",
                "// Line 260:             else:",
                "// Line 261:                 ASCIIColors.red(f\"Appending data\")",
                "// Line 262:                 ASCIIColors.yellow(f\"silence_counter: {self.silence_counter}\")",
                "// vulnerable line: 263: print(f\"silence duration: {self.rate / frames * self.silence_duration}\")",
                "// Line 264:                 self.frames.append(indata.copy())",
                "// Line 265:         else:",
                "// Line 266:             self.frames = []",
                "// Line 267:             self.silence_counter = 0",
                "// Line 268:             self.current_silence_duration = 0",
                "// Line 269:             self.longest_silence_duration = 0",
                "// Line 270:             self.sound_frames = 0",
                "// Line 271:             self.audio_values = []",
                "// Line 272: ",
                "// Line 273:             self.max_audio_value = 0"
            ]
        }
    ]
}