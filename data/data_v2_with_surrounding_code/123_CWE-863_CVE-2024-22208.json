{
    "cve_id": "CVE-2024-22208",
    "cve_description": "phpMyFAQ is an Open Source FAQ web application for PHP 8.1+ and MySQL, PostgreSQL and other databases. The 'sharing FAQ' functionality allows any unauthenticated actor to misuse the phpMyFAQ application to send arbitrary emails to a large range of targets. The phpMyFAQ application has a functionality where anyone can share a FAQ item to others. The front-end of this functionality allows any phpMyFAQ articles to be shared with 5 email addresses. Any unauthenticated actor can perform this action. There is a CAPTCHA in place, however the amount of people you email with a single request is not limited to 5 by the backend. An attacker can thus solve a single CAPTCHA and send thousands of emails at once. An attacker can utilize the target application's email server to send phishing messages. This can get the server on a blacklist, causing all emails to end up in spam. It can also lead to reputation damages. This issue has been patched in version 3.2.5.",
    "cve_publish_date": "2024-02-05T21:15Z",
    "cwe_id": "CWE-863",
    "cwe_name": "Incorrect Authorization",
    "cwe_description": "The product performs an authorization check when an actor attempts to access a resource or perform an action, but it does not correctly perform the check. This allows attackers to bypass intended access restrictions.",
    "commit_message": "fix: only allow 5 mails per user, don't allow the user to change the URL",
    "type_of_change": "Modification",
    "changes": [
        {
            "filename_of_changes": "api.service.php",
            "code_language": "PHP",
            "number_of_lines_added_for_mitigation": "19",
            "number_of_lines_deleted_vulnerable_to_cve": "3",
            "Code_with_highlighted_vulnerability_lines": [
                "// Line 771:             $response->setData(['error' => Translation::get('err_sendMail')]);",
                "// Line 772:         }",
                "// Line 773:         break;",
                "// Line 774: ",
                "// Line 775:     // Send mails to friends",
                "// Line 776:     case 'sendtofriends':",
                "// Line 777:         $postData = json_decode(file_get_contents('php://input'), true, 512, JSON_THROW_ON_ERROR);",
                "// Line 778: ",
                "// Line 779:         $author = trim((string) Filter::filterVar($postData['name'], FILTER_SANITIZE_SPECIAL_CHARS));",
                "// Line 780:         $email = Filter::filterVar($postData['email'], FILTER_VALIDATE_EMAIL);",
                "// vulnerable line: 781: $link = trim((string) Filter::filterVar($postData['link'], FILTER_VALIDATE_URL));",
                "// Line 782:         $attached = trim((string) Filter::filterVar($postData['message'], FILTER_SANITIZE_SPECIAL_CHARS));",
                "// Line 783:         $mailto = Filter::filterArray($postData['mailto[]']);",
                "// Line 784: ",
                "// Line 785:         if (",
                "// Line 786:             !is_null($author) && !is_null($email) && is_array($mailto) &&",
                "// Line 787:             $stopWords->checkBannedWord(Strings::htmlspecialchars($attached))",
                "// Line 788:         ) {",
                "// Line 789: ",
                "// Line 790:             foreach ($mailto as $recipient) {",
                "// Line 791:                 $recipient = trim(strip_tags((string) $recipient));",
                "// Line 801:                     $mailer->subject = Translation::get('msgS2FMailSubject') . $author;",
                "// Line 802:                     $mailer->message = sprintf(",
                "// Line 803:                         \"%s",
                "// Line 804: ",
                "// Line 805: %s",
                "// Line 806: %s",
                "// Line 807: ",
                "// Line 808: %s\",",
                "// Line 809:                         $faqConfig->get('main.send2friendText'),",
                "// Line 810:                         Translation::get('msgS2FText2'),",
                "// vulnerable line: 811: $link,",
                "// vulnerable line: 812: $attached",
                "// Line 813:                     );",
                "// Line 814: ",
                "// Line 815:                     // Send the email",
                "// Line 816:                     $result = $mailer->send();",
                "// Line 817:                     unset($mailer);",
                "// Line 818:                     usleep(250);",
                "// Line 819:                 }",
                "// Line 820:             }",
                "// Line 821: ",
                "// Line 822:             $response->setStatusCode(Response::HTTP_OK);"
            ]
        },
        {
            "filename_of_changes": "send2friend.php",
            "code_language": "PHP",
            "number_of_lines_added_for_mitigation": "2",
            "number_of_lines_deleted_vulnerable_to_cve": "0",
            "Code_with_highlighted_vulnerability_lines": []
        }
    ]
}