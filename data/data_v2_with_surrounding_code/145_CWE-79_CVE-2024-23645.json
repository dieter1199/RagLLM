{
    "cve_id": "CVE-2024-23645",
    "cve_description": "GLPI is a Free Asset and IT Management Software package. A malicious URL can be used to execute XSS on reports pages.  Upgrade to 10.0.12.\n",
    "cve_publish_date": "2024-02-01T18:15Z",
    "cwe_id": "CWE-79",
    "cwe_name": "Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting')",
    "cwe_description": "The product does not neutralize or incorrectly neutralizes user-controllable input before it is placed in output that is used as a web page that is served to other users.",
    "commit_message": "Sanitize parameters and encode special chars",
    "type_of_change": "Modification",
    "changes": [
        {
            "filename_of_changes": "Stat.php",
            "code_language": "PHP",
            "number_of_lines_added_for_mitigation": "1",
            "number_of_lines_deleted_vulnerable_to_cve": "1",
            "Code_with_highlighted_vulnerability_lines": [
                "// Line 2149:      * @param string  $date1    First date",
                "// Line 2150:      * @param string  $date2    Second date",
                "// Line 2151:      * @param boolean $display  Whether to display directly; defauts to true",
                "// Line 2152:      *",
                "// Line 2153:      * @return void|string",
                "// Line 2154:      */",
                "// Line 2155:     public function displaySearchForm($itemtype, $date1, $date2, $display = true)",
                "// Line 2156:     {",
                "// Line 2157:         $out = \"<form method='get' name='form' action='stat.global.php'><div class='center'>\";",
                "// Line 2158:        // Keep it at first parameter",
                "// vulnerable line: 2159: $out .= \"<input type='hidden' name='itemtype' value='$itemtype'>\";",
                "// Line 2160: ",
                "// Line 2161:         $out .= \"<table class='tab_cadre'>\";",
                "// Line 2162:         $out .= \"<tr class='tab_bg_2'><td class='right'>\" . __('Start date') . \"</td><td>\";",
                "// Line 2163:         $out .= Html::showDateField(",
                "// Line 2164:             'date1',",
                "// Line 2165:             [",
                "// Line 2166:                 'value'   => $date1,",
                "// Line 2167:                 'display' => false",
                "// Line 2168:             ]",
                "// Line 2169:         );"
            ]
        },
        {
            "filename_of_changes": "stat.global.php",
            "code_language": "PHP",
            "number_of_lines_added_for_mitigation": "6",
            "number_of_lines_deleted_vulnerable_to_cve": "0",
            "Code_with_highlighted_vulnerability_lines": []
        },
        {
            "filename_of_changes": "stat.graph.php",
            "code_language": "PHP",
            "number_of_lines_added_for_mitigation": "10",
            "number_of_lines_deleted_vulnerable_to_cve": "1",
            "Code_with_highlighted_vulnerability_lines": []
        },
        {
            "filename_of_changes": "stat.location.php",
            "code_language": "PHP",
            "number_of_lines_added_for_mitigation": "15",
            "number_of_lines_deleted_vulnerable_to_cve": "5",
            "Code_with_highlighted_vulnerability_lines": [
                "// Line 44: ",
                "// Line 45: include('../inc/includes.php');",
                "// Line 46: ",
                "// Line 47: Html::header(__('Statistics'), '', \"helpdesk\", \"stat\");",
                "// Line 48: ",
                "// Line 49: Session::checkRight(\"statistic\", READ);",
                "// Line 50: ",
                "// Line 51: ",
                "// Line 52: if (empty($_GET[\"showgraph\"])) {",
                "// Line 53:     $_GET[\"showgraph\"] = 0;",
                "// vulnerable line: 54: }",
                "// Line 55: ",
                "// Line 56: if (empty($_GET[\"date1\"]) && empty($_GET[\"date2\"])) {",
                "// Line 57:     $year          = date(\"Y\") - 1;",
                "// Line 58:     $_GET[\"date1\"] = date(\"Y-m-d\", mktime(1, 0, 0, date(\"m\"), date(\"d\"), $year));",
                "// Line 59:     $_GET[\"date2\"] = date(\"Y-m-d\");",
                "// vulnerable line: 60: }",
                "// Line 61: ",
                "// Line 62: if (",
                "// Line 63:     !empty($_GET[\"date1\"])",
                "// Line 64:     && !empty($_GET[\"date2\"])",
                "// Line 65:     && (strcmp($_GET[\"date2\"], $_GET[\"date1\"]) < 0)",
                "// Line 66: ) {",
                "// Line 67:     $tmp           = $_GET[\"date1\"];",
                "// Line 68:     $_GET[\"date1\"] = $_GET[\"date2\"];",
                "// Line 69:     $_GET[\"date2\"] = $tmp;",
                "// vulnerable line: 70: }",
                "// Line 71: ",
                "// Line 72: if (!isset($_GET[\"start\"])) {",
                "// Line 73:     $_GET[\"start\"] = 0;",
                "// vulnerable line: 74: }",
                "// vulnerable line: 75: // Why this test ?? For me it's doing nothing",
                "// vulnerable line: 76: if (isset($_GET[\"dropdown\"])) {",
                "// vulnerable line: 77: $_GET[\"dropdown\"] = $_GET[\"dropdown\"];",
                "// vulnerable line: 78: }",
                "// Line 79: ",
                "// Line 80: if (empty($_GET[\"dropdown\"])) {",
                "// Line 81:     $_GET[\"dropdown\"] = \"ComputerType\";",
                "// vulnerable line: 82: }",
                "// Line 83: ",
                "// Line 84: if (!isset($_GET['itemtype'])) {",
                "// Line 85:     $_GET['itemtype'] = 'Ticket';",
                "// vulnerable line: 86: }",
                "// Line 87: ",
                "// Line 88: $stat = new Stat();",
                "// Line 89: Stat::title();",
                "// Line 90: ",
                "// Line 91: echo \"<form method='get' name='form' action='stat.location.php'>\";",
                "// Line 92: // keep it first param",
                "// vulnerable line: 93: echo \"<input type='hidden' name='itemtype' value='\" . $_GET['itemtype'] . \"'>\";",
                "// Line 94: ",
                "// Line 95: echo \"<table class='tab_cadre_fixe' ><tr class='tab_bg_2'><td rowspan='2' width='30%'>\";",
                "// Line 96: $values = [_n('Dropdown', 'Dropdowns', Session::getPluralNumber()) => ['ComputerType'    => _n('Type', 'Types', 1),",
                "// Line 97:     'ComputerModel'   => _n('Model', 'Models', 1),",
                "// Line 98:     'OperatingSystem' => OperatingSystem::getTypeName(1),",
                "// Line 99:     'Location'        => Location::getTypeName(1)",
                "// Line 100: ],",
                "// Line 101: ];",
                "// Line 102: $devices = Dropdown::getDeviceItemTypes();",
                "// Line 103: foreach ($devices as $label => $dp) {",
                "// Line 104:     foreach ($dp as $i => $name) {",
                "// Line 105:         $values[$label][$i] = $name;",
                "// vulnerable line: 106: }",
                "// vulnerable line: 107: }",
                "// Line 108: ",
                "// Line 109: Dropdown::showFromArray('dropdown', $values, ['value' => $_GET[\"dropdown\"]]);",
                "// Line 110: ",
                "// Line 111: echo \"</td>\";",
                "// Line 112: ",
                "// Line 113: echo \"<td class='right'>\" . __('Start date') . \"</td><td>\";",
                "// Line 114: Html::showDateField(\"date1\", ['value' => $_GET[\"date1\"]]);",
                "// Line 115: echo \"</td>\";",
                "// Line 116: echo \"<td class='right'>\" . __('Show graphics') . \"</td>\";",
                "// Line 117: echo \"<td rowspan='2' class='center'>\";",
                "// Line 127: // form using GET method : CRSF not needed",
                "// Line 128: echo \"</form>\";",
                "// Line 129: ",
                "// Line 130: if (",
                "// Line 131:     empty($_GET[\"dropdown\"])",
                "// Line 132:     || !($item = getItemForItemtype($_GET[\"dropdown\"]))",
                "// Line 133: ) {",
                "// Line 134:    // Do nothing",
                "// Line 135:     Html::footer();",
                "// Line 136:     exit();",
                "// vulnerable line: 137: }",
                "// Line 138: ",
                "// Line 139: ",
                "// Line 140: if (!($item instanceof CommonDevice)) {",
                "// Line 141:    // echo \"Dropdown\";",
                "// Line 142:     $type = \"comp_champ\";",
                "// Line 143: ",
                "// Line 144:     $val = Stat::getItems($_GET['itemtype'], $_GET[\"date1\"], $_GET[\"date2\"], $_GET[\"dropdown\"]);",
                "// Line 145:     $params = ['type'     => $type,",
                "// Line 146:         'dropdown' => $_GET[\"dropdown\"],",
                "// Line 147:         'date1'    => $_GET[\"date1\"],",
                "// Line 152:    //   echo \"Device\";",
                "// Line 153:     $type  = \"device\";",
                "// Line 154: ",
                "// Line 155:     $val = Stat::getItems($_GET['itemtype'], $_GET[\"date1\"], $_GET[\"date2\"], $_GET[\"dropdown\"]);",
                "// Line 156:     $params = ['type'     => $type,",
                "// Line 157:         'dropdown' => $_GET[\"dropdown\"],",
                "// Line 158:         'date1'    => $_GET[\"date1\"],",
                "// Line 159:         'date2'    => $_GET[\"date2\"],",
                "// Line 160:         'start'    => $_GET[\"start\"]",
                "// Line 161:     ];",
                "// vulnerable line: 162: }",
                "// Line 163: ",
                "// Line 164: Html::printPager(",
                "// Line 165:     $_GET['start'],",
                "// Line 166:     count($val),",
                "// Line 167:     $CFG_GLPI['root_doc'] . '/front/stat.location.php',",
                "// Line 168:     Toolbox::append_params(",
                "// Line 169:         [",
                "// Line 170:             'date1'    => $_GET['date1'],",
                "// Line 171:             'date2'    => $_GET['date2'],",
                "// Line 172:             'itemtype' => $_GET['itemtype'],",
                "// Line 197:         'start'    => $_GET['start'],",
                "// Line 198:         'val'      => $val,",
                "// Line 199:         'value2' => $_GET['dropdown'],",
                "// Line 200:     ];",
                "// Line 201: ",
                "// Line 202:     $stat->displayPieGraphFromData(new StatDataOpened($data_params));",
                "// Line 203:     $stat->displayPieGraphFromData(new StatDataSolved($data_params));",
                "// Line 204:     $stat->displayPieGraphFromData(new StatDataLate($data_params));",
                "// Line 205:     $stat->displayPieGraphFromData(new StatDataClosed($data_params));",
                "// Line 206:     $stat->displayPieGraphFromData(new StatDataOpenSatisfaction($data_params));",
                "// vulnerable line: 207: }",
                "// Line 208: ",
                "// Line 209: Html::footer();"
            ]
        },
        {
            "filename_of_changes": "stat.tracking.php",
            "code_language": "PHP",
            "number_of_lines_added_for_mitigation": "14",
            "number_of_lines_deleted_vulnerable_to_cve": "2",
            "Code_with_highlighted_vulnerability_lines": [
                "// Line 58: ",
                "// Line 59: if (empty($_GET[\"showgraph\"])) {",
                "// Line 60:     $_GET[\"showgraph\"] = 0;",
                "// Line 61: }",
                "// Line 62: ",
                "// Line 63: if (empty($_GET[\"value2\"])) {",
                "// Line 64:     $_GET[\"value2\"] = 0;",
                "// Line 65: }",
                "// Line 66: ",
                "// Line 67: if (empty($_GET[\"date1\"]) && empty($_GET[\"date2\"])) {",
                "// vulnerable line: 68: $year              = date(\"Y\") - 1;",
                "// Line 69:     $_GET[\"date1\"] = date(\"Y-m-d\", mktime(1, 0, 0, date(\"m\"), date(\"d\"), $year));",
                "// Line 70:     $_GET[\"date2\"] = date(\"Y-m-d\");",
                "// Line 71: }",
                "// Line 72: ",
                "// Line 73: if (",
                "// Line 74:     !empty($_GET[\"date1\"])",
                "// Line 75:     && !empty($_GET[\"date2\"])",
                "// Line 76:     && (strcmp($_GET[\"date2\"], $_GET[\"date1\"]) < 0)",
                "// Line 77: ) {",
                "// Line 78:     $tmp           = $_GET[\"date1\"];"
            ]
        }
    ]
}