{
    "cve_id": "CVE-2023-48220",
    "cve_description": "Decidim is a participatory democracy framework. Starting in version 0.4.rc3 and prior to version 2.0.9 of the `devise_invitable` gem, the invites feature allows users to accept the invitation for an unlimited amount of time through the password reset functionality. This issue creates vulnerable dependencies starting in version 0.0.1.alpha3 and prior to versions 0.26.9, 0.27.5, and 0.28.0 of the `decidim,` `decidim-admin`, and `decidim-system` gems. When using the password reset functionality, the `devise_invitable` gem always accepts the pending invitation if the user has been invited. The only check done is if the user has been invited but the code does not ensure that the pending invitation is still valid as defined by the `invite_for` expiry period. Decidim sets this configuration to `2.weeks` so this configuration should be respected. The bug is in the `devise_invitable` gem and should be fixed there and the dependency should be upgraded in Decidim once the fix becomes available. `devise_invitable` to version `2.0.9` and above fix this issue. Versions 0.26.9, 0.27.5, and 0.28.0 of the `decidim,` `decidim-admin`, and `decidim-system` gems contain this fix. As a workaround, invitations can be cancelled directly from the database.",
    "cve_publish_date": "2024-02-20T18:15Z",
    "cwe_id": "NVD-CWE-noinfo",
    "cwe_name": "Insufficient Information",
    "cwe_description": "There is insufficient information about the issue to classify it; details are unkown or unspecified.",
    "commit_message": "Add Organization admin engine",
    "type_of_change": "Modification",
    "changes": [
        {
            "filename_of_changes": "Gemfile",
            "code_language": "Ruby",
            "number_of_lines_added_for_mitigation": "2",
            "number_of_lines_deleted_vulnerable_to_cve": "0",
            "Code_with_highlighted_vulnerability_lines": []
        },
        {
            "filename_of_changes": "Gemfile",
            "code_language": "Ruby",
            "number_of_lines_added_for_mitigation": "17",
            "number_of_lines_deleted_vulnerable_to_cve": "0",
            "Code_with_highlighted_vulnerability_lines": []
        },
        {
            "filename_of_changes": "Gemfile",
            "code_language": "Ruby",
            "number_of_lines_added_for_mitigation": "1",
            "number_of_lines_deleted_vulnerable_to_cve": "0",
            "Code_with_highlighted_vulnerability_lines": []
        },
        {
            "filename_of_changes": "Rakefile",
            "code_language": "Ruby",
            "number_of_lines_added_for_mitigation": "1",
            "number_of_lines_deleted_vulnerable_to_cve": "1",
            "Code_with_highlighted_vulnerability_lines": [
                "// Line 1: # frozen_string_literal: true",
                "// Line 2: require \"bundler/gem_tasks\"",
                "// Line 3: require \"rspec/core/rake_task\"",
                "// Line 4: ",
                "// Line 5: begin",
                "// Line 6:   require \"decidim/testing_support/common_rake\"",
                "// Line 7: rescue LoadError",
                "// Line 8:   raise \"Could not find decidim/testing_support/common_rake. You need to run this command using Bundler.\"",
                "// Line 9: end",
                "// Line 10: ",
                "// vulnerable line: 11: DECIDIM_GEMS = %w(core system).freeze",
                "// Line 12: ",
                "// Line 13: RSpec::Core::RakeTask.new(:spec)",
                "// Line 14: ",
                "// Line 15: task default: :test",
                "// Line 16: ",
                "// Line 17: desc \"Runs all tests in all Decidim engines\"",
                "// Line 18: task :test do",
                "// Line 19:   DECIDIM_GEMS.each do |gem_name|",
                "// Line 20:     Dir.chdir(\"#{File.dirname(__FILE__)}/decidim-#{gem_name}\") do",
                "// Line 21:       sh \"rake\""
            ]
        },
        {
            "filename_of_changes": "_links.html.erb",
            "code_language": "Ruby",
            "number_of_lines_added_for_mitigation": "25",
            "number_of_lines_deleted_vulnerable_to_cve": "0",
            "Code_with_highlighted_vulnerability_lines": []
        },
        {
            "filename_of_changes": "_login_items.html.erb",
            "code_language": "Ruby",
            "number_of_lines_added_for_mitigation": "8",
            "number_of_lines_deleted_vulnerable_to_cve": "0",
            "Code_with_highlighted_vulnerability_lines": []
        },
        {
            "filename_of_changes": "action_mailer.rb",
            "code_language": "Ruby",
            "number_of_lines_added_for_mitigation": "5",
            "number_of_lines_deleted_vulnerable_to_cve": "0",
            "Code_with_highlighted_vulnerability_lines": []
        },
        {
            "filename_of_changes": "admin.rb",
            "code_language": "Ruby",
            "number_of_lines_added_for_mitigation": "12",
            "number_of_lines_deleted_vulnerable_to_cve": "0",
            "Code_with_highlighted_vulnerability_lines": []
        },
        {
            "filename_of_changes": "admin_tasks.rake",
            "code_language": "Ruby",
            "number_of_lines_added_for_mitigation": "5",
            "number_of_lines_deleted_vulnerable_to_cve": "0",
            "Code_with_highlighted_vulnerability_lines": []
        },
        {
            "filename_of_changes": "application_controller.rb",
            "code_language": "Ruby",
            "number_of_lines_added_for_mitigation": "9",
            "number_of_lines_deleted_vulnerable_to_cve": "0",
            "Code_with_highlighted_vulnerability_lines": []
        },
        {
            "filename_of_changes": "application_helper.rb",
            "code_language": "Ruby",
            "number_of_lines_added_for_mitigation": "12",
            "number_of_lines_deleted_vulnerable_to_cve": "0",
            "Code_with_highlighted_vulnerability_lines": []
        },
        {
            "filename_of_changes": "application_helper.rb",
            "code_language": "Ruby",
            "number_of_lines_added_for_mitigation": "0",
            "number_of_lines_deleted_vulnerable_to_cve": "4",
            "Code_with_highlighted_vulnerability_lines": [
                "// Line 1: # frozen_string_literal: true",
                "// Line 2: module Decidim",
                "// Line 3:   module System",
                "// Line 4:     # Custom helpers, scoped to the system panel.",
                "// Line 5:     #",
                "// Line 6:     module ApplicationHelper",
                "// Line 7:       def title",
                "// Line 8:         \"Decidim\"",
                "// vulnerable line: 9: end",
                "// Line 10: ",
                "// vulnerable line: 11: def field_name(model, field)",
                "// vulnerable line: 12: st \"models.#{model}.fields.#{field}\"",
                "// vulnerable line: 13: end",
                "// vulnerable line: 14: end",
                "// vulnerable line: 15: end",
                "// vulnerable line: 16: end"
            ]
        },
        {
            "filename_of_changes": "application_job.rb",
            "code_language": "Ruby",
            "number_of_lines_added_for_mitigation": "9",
            "number_of_lines_deleted_vulnerable_to_cve": "0",
            "Code_with_highlighted_vulnerability_lines": []
        },
        {
            "filename_of_changes": "application_mailer.rb",
            "code_language": "Ruby",
            "number_of_lines_added_for_mitigation": "11",
            "number_of_lines_deleted_vulnerable_to_cve": "0",
            "Code_with_highlighted_vulnerability_lines": []
        },
        {
            "filename_of_changes": "application_record.rb",
            "code_language": "Ruby",
            "number_of_lines_added_for_mitigation": "10",
            "number_of_lines_deleted_vulnerable_to_cve": "0",
            "Code_with_highlighted_vulnerability_lines": []
        },
        {
            "filename_of_changes": "capybara.rb",
            "code_language": "Ruby",
            "number_of_lines_added_for_mitigation": "17",
            "number_of_lines_deleted_vulnerable_to_cve": "0",
            "Code_with_highlighted_vulnerability_lines": []
        },
        {
            "filename_of_changes": "current_organization.rb",
            "code_language": "Ruby",
            "number_of_lines_added_for_mitigation": "28",
            "number_of_lines_deleted_vulnerable_to_cve": "0",
            "Code_with_highlighted_vulnerability_lines": []
        },
        {
            "filename_of_changes": "current_organization_spec.rb",
            "code_language": "Ruby",
            "number_of_lines_added_for_mitigation": "30",
            "number_of_lines_deleted_vulnerable_to_cve": "0",
            "Code_with_highlighted_vulnerability_lines": []
        },
        {
            "filename_of_changes": "dashboard_controller.rb",
            "code_language": "Ruby",
            "number_of_lines_added_for_mitigation": "9",
            "number_of_lines_deleted_vulnerable_to_cve": "0",
            "Code_with_highlighted_vulnerability_lines": []
        },
        {
            "filename_of_changes": "database_cleaner.rb",
            "code_language": "Ruby",
            "number_of_lines_added_for_mitigation": "12",
            "number_of_lines_deleted_vulnerable_to_cve": "0",
            "Code_with_highlighted_vulnerability_lines": []
        },
        {
            "filename_of_changes": "decidim.gemspec",
            "code_language": "Ruby",
            "number_of_lines_added_for_mitigation": "1",
            "number_of_lines_deleted_vulnerable_to_cve": "0",
            "Code_with_highlighted_vulnerability_lines": []
        },
        {
            "filename_of_changes": "decidim.rb",
            "code_language": "Ruby",
            "number_of_lines_added_for_mitigation": "1",
            "number_of_lines_deleted_vulnerable_to_cve": "0",
            "Code_with_highlighted_vulnerability_lines": []
        },
        {
            "filename_of_changes": "decidim_devise_mailer.rb",
            "code_language": "Ruby",
            "number_of_lines_added_for_mitigation": "11",
            "number_of_lines_deleted_vulnerable_to_cve": "0",
            "Code_with_highlighted_vulnerability_lines": []
        },
        {
            "filename_of_changes": "devise.rb",
            "code_language": "Ruby",
            "number_of_lines_added_for_mitigation": "2",
            "number_of_lines_deleted_vulnerable_to_cve": "2",
            "Code_with_highlighted_vulnerability_lines": [
                "// Line 12:   # by default. You can change it below and use your own secret key.",
                "// Line 13:   # config.secret_key = 'e1f4e9899fb5e8b3123950b19cd0f6d22ecaa8c7fb792b6db5a939edc2b3bab722d06a6a46345ee9bf12caa0178408d6134ea92ed778977b8a7ed1007a0c6dbe'",
                "// Line 14: ",
                "// Line 15:   # ==> Mailer Configuration",
                "// Line 16:   # Configure the e-mail address which will be shown in Devise::Mailer,",
                "// Line 17:   # note that it will be overwritten if you use your own mailer class",
                "// Line 18:   # with default \"from\" parameter.",
                "// Line 19:   config.mailer_sender = \"please-change-me-at-config-initializers-devise@example.com\"",
                "// Line 20: ",
                "// Line 21:   # Configure the class responsible to send e-mails.",
                "// vulnerable line: 22: # config.mailer = 'Devise::Mailer'",
                "// Line 23: ",
                "// Line 24:   # Configure the parent class responsible to send e-mails.",
                "// Line 25:   config.parent_mailer = \"Decidim::ApplicationMailer\"",
                "// Line 26: ",
                "// Line 27:   config.parent_controller = \"Decidim::ApplicationController\"",
                "// Line 28: ",
                "// Line 29:   # ==> ORM configuration",
                "// Line 30:   # Load and configure the ORM. Supports :active_record (default) and",
                "// Line 31:   # :mongoid (bson_ext recommended) by default. Other ORMs may be",
                "// Line 32:   # available as additional gems.",
                "// Line 158:   # config.invited_by_foreign_key = :invited_by_id",
                "// Line 159: ",
                "// Line 160:   # The column name used for counter_cache column. If this is nil,",
                "// Line 161:   # the #invited_by association is declared without counter_cache.",
                "// Line 162:   # Default: nil",
                "// Line 163:   # config.invited_by_counter_cache = :invitations_count",
                "// Line 164: ",
                "// Line 165:   # Auto-login after the user accepts the invite. If this is false,",
                "// Line 166:   # the user will need to manually log in after accepting the invite.",
                "// Line 167:   # Default: true",
                "// vulnerable line: 168: # config.allow_insecure_sign_in_after_accept = false",
                "// Line 169: ",
                "// Line 170:   # ==> Configuration for :confirmable",
                "// Line 171:   # A period that the user is allowed to access the website even without",
                "// Line 172:   # confirming their account. For instance, if set to 2.days, the user will be",
                "// Line 173:   # able to access the website for two days without confirming their account,",
                "// Line 174:   # access will be blocked just in the third day. Default is 0.days, meaning",
                "// Line 175:   # the user cannot access the website without confirming their account.",
                "// Line 176:   # config.allow_unconfirmed_access_for = 2.days",
                "// Line 177: ",
                "// Line 178:   # A period that the user is allowed to confirm their account before their"
            ]
        },
        {
            "filename_of_changes": "edit.html.erb",
            "code_language": "Ruby",
            "number_of_lines_added_for_mitigation": "16",
            "number_of_lines_deleted_vulnerable_to_cve": "0",
            "Code_with_highlighted_vulnerability_lines": []
        },
        {
            "filename_of_changes": "edit.html.erb",
            "code_language": "Ruby",
            "number_of_lines_added_for_mitigation": "23",
            "number_of_lines_deleted_vulnerable_to_cve": "0",
            "Code_with_highlighted_vulnerability_lines": []
        },
        {
            "filename_of_changes": "engine.rb",
            "code_language": "Ruby",
            "number_of_lines_added_for_mitigation": "30",
            "number_of_lines_deleted_vulnerable_to_cve": "0",
            "Code_with_highlighted_vulnerability_lines": []
        },
        {
            "filename_of_changes": "engine.rb",
            "code_language": "Ruby",
            "number_of_lines_added_for_mitigation": "4",
            "number_of_lines_deleted_vulnerable_to_cve": "0",
            "Code_with_highlighted_vulnerability_lines": []
        },
        {
            "filename_of_changes": "factory_girl.rb",
            "code_language": "Ruby",
            "number_of_lines_added_for_mitigation": "3",
            "number_of_lines_deleted_vulnerable_to_cve": "0",
            "Code_with_highlighted_vulnerability_lines": []
        },
        {
            "filename_of_changes": "i18n_spec.rb",
            "code_language": "Ruby",
            "number_of_lines_added_for_mitigation": "18",
            "number_of_lines_deleted_vulnerable_to_cve": "0",
            "Code_with_highlighted_vulnerability_lines": []
        },
        {
            "filename_of_changes": "install_generator.rb",
            "code_language": "Ruby",
            "number_of_lines_added_for_mitigation": "5",
            "number_of_lines_deleted_vulnerable_to_cve": "2",
            "Code_with_highlighted_vulnerability_lines": [
                "// Line 73:         inject_into_file \"config/environments/test.rb\",",
                "// Line 74:                          after: \"config.action_mailer.delivery_method = :test\" do",
                "// Line 75:           \"",
                "// Line 76:   config.action_mailer.default_url_options = { host: \"test.citizencorp.com\" }\"",
                "// Line 77:         end",
                "// Line 78:       end",
                "// Line 79: ",
                "// Line 80:       private",
                "// Line 81: ",
                "// Line 82:       def prepare_database",
                "// vulnerable line: 83: rake \"db:environment:set RAILS_ENV=development\"",
                "// vulnerable line: 84: rake \"db:drop:all\"",
                "// Line 85:         rake \"db:create\"",
                "// Line 86:         rake \"db:migrate\"",
                "// Line 87:         rake \"db:test:prepare\"",
                "// Line 88:       end",
                "// Line 89:     end",
                "// Line 90:   end",
                "// Line 91: end"
            ]
        },
        {
            "filename_of_changes": "invitations_controller.rb",
            "code_language": "Ruby",
            "number_of_lines_added_for_mitigation": "20",
            "number_of_lines_deleted_vulnerable_to_cve": "0",
            "Code_with_highlighted_vulnerability_lines": []
        },
        {
            "filename_of_changes": "new.html.erb",
            "code_language": "Ruby",
            "number_of_lines_added_for_mitigation": "15",
            "number_of_lines_deleted_vulnerable_to_cve": "0",
            "Code_with_highlighted_vulnerability_lines": []
        },
        {
            "filename_of_changes": "password_change.html.erb",
            "code_language": "Ruby",
            "number_of_lines_added_for_mitigation": "3",
            "number_of_lines_deleted_vulnerable_to_cve": "0",
            "Code_with_highlighted_vulnerability_lines": []
        },
        {
            "filename_of_changes": "passwords_controller.rb",
            "code_language": "Ruby",
            "number_of_lines_added_for_mitigation": "8",
            "number_of_lines_deleted_vulnerable_to_cve": "0",
            "Code_with_highlighted_vulnerability_lines": []
        },
        {
            "filename_of_changes": "rails",
            "code_language": "Ruby",
            "number_of_lines_added_for_mitigation": "14",
            "number_of_lines_deleted_vulnerable_to_cve": "0",
            "Code_with_highlighted_vulnerability_lines": []
        },
        {
            "filename_of_changes": "register_organization.rb",
            "code_language": "Ruby",
            "number_of_lines_added_for_mitigation": "3",
            "number_of_lines_deleted_vulnerable_to_cve": "1",
            "Code_with_highlighted_vulnerability_lines": [
                "// Line 37: ",
                "// Line 38:       def create_organization",
                "// Line 39:         Decidim::Organization.create!(name: form.name, host: form.host)",
                "// Line 40:       end",
                "// Line 41: ",
                "// Line 42:       def invite_admin(organization)",
                "// Line 43:         Decidim::User.invite!(",
                "// Line 44:           email: form.organization_admin_email,",
                "// Line 45:           organization: organization,",
                "// Line 46:           roles: [\"admin\"]",
                "// vulnerable line: 47: )",
                "// Line 48:       end",
                "// Line 49:     end",
                "// Line 50:   end",
                "// Line 51: end"
            ]
        },
        {
            "filename_of_changes": "register_organization_spec.rb",
            "code_language": "Ruby",
            "number_of_lines_added_for_mitigation": "7",
            "number_of_lines_deleted_vulnerable_to_cve": "0",
            "Code_with_highlighted_vulnerability_lines": []
        },
        {
            "filename_of_changes": "reset_password_instructions.html.erb",
            "code_language": "Ruby",
            "number_of_lines_added_for_mitigation": "8",
            "number_of_lines_deleted_vulnerable_to_cve": "0",
            "Code_with_highlighted_vulnerability_lines": []
        },
        {
            "filename_of_changes": "routes.rb",
            "code_language": "Ruby",
            "number_of_lines_added_for_mitigation": "4",
            "number_of_lines_deleted_vulnerable_to_cve": "0",
            "Code_with_highlighted_vulnerability_lines": []
        },
        {
            "filename_of_changes": "sessions_controller.rb",
            "code_language": "Ruby",
            "number_of_lines_added_for_mitigation": "8",
            "number_of_lines_deleted_vulnerable_to_cve": "0",
            "Code_with_highlighted_vulnerability_lines": []
        },
        {
            "filename_of_changes": "user.rb",
            "code_language": "Ruby",
            "number_of_lines_added_for_mitigation": "16",
            "number_of_lines_deleted_vulnerable_to_cve": "2",
            "Code_with_highlighted_vulnerability_lines": [
                "// Line 1: # frozen_string_literal: true",
                "// Line 2: module Decidim",
                "// Line 3:   # A User is a citizen that wants to join the platform to participate.",
                "// Line 4:   class User < ApplicationRecord",
                "// Line 5:     devise :invitable, :database_authenticatable, :registerable,",
                "// vulnerable line: 6: :recoverable, :rememberable, :trackable, :validatable",
                "// Line 7: ",
                "// Line 8:     belongs_to :organization, foreign_key: \"decidim_organization_id\", class_name: Decidim::Organization",
                "// Line 9: ",
                "// Line 10:     ROLES = %w(admin moderator official).freeze",
                "// Line 11: ",
                "// Line 12:     validates :organization, presence: true",
                "// vulnerable line: 13: validates :roles, inclusion: { in: ROLES }, allow_blank: true",
                "// Line 14: ",
                "// Line 15:     # Checks if the user is an admin in the organization it belongs to. This",
                "// Line 16:     # should probably be deleted and add a system to authorize actions.",
                "// Line 17:     #",
                "// Line 18:     # Returns Booolean.",
                "// Line 19:     def admin?",
                "// Line 20:       roles.include?(\"admin\")",
                "// Line 21:     end",
                "// Line 22:   end",
                "// Line 23: end"
            ]
        },
        {
            "filename_of_changes": "warden.rb",
            "code_language": "Ruby",
            "number_of_lines_added_for_mitigation": "7",
            "number_of_lines_deleted_vulnerable_to_cve": "0",
            "Code_with_highlighted_vulnerability_lines": []
        },
        {
            "filename_of_changes": "wisper.rb",
            "code_language": "Ruby",
            "number_of_lines_added_for_mitigation": "5",
            "number_of_lines_deleted_vulnerable_to_cve": "0",
            "Code_with_highlighted_vulnerability_lines": []
        }
    ]
}