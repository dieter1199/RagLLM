{
    "cve_id": "CVE-2024-3104",
    "cve_description": "A remote code execution vulnerability exists in mintplex-labs/anything-llm due to improper handling of environment variables. Attackers can exploit this vulnerability by injecting arbitrary environment variables via the `POST /api/system/update-env` endpoint, which allows for the execution of arbitrary code on the host running anything-llm. The vulnerability is present in the latest version of anything-llm, with the latest commit identified as fde905aac1812b84066ff72e5f2f90b56d4c3a59. This issue has been fixed in version 1.0.0. Successful exploitation could lead to code execution on the host, enabling attackers to read and modify data accessible to the user running the service, potentially leading to a denial of service. ",
    "cve_publish_date": "2024-06-06T18:15Z",
    "cwe_id": "CWE-78",
    "cwe_name": "Improper Neutralization of Special Elements used in an OS Command ('OS Command Injection')",
    "cwe_description": "The product constructs all or part of an OS command using externally-influenced input from an upstream component, but it does not neutralize or incorrectly neutralizes special elements that could modify the intended OS command when it is sent to a downstream component.",
    "commit_message": "security: force sanitize env string set by user",
    "type_of_change": "Modification",
    "changes": [
        {
            "filename_of_changes": "updateENV.js",
            "code_language": "JavaScript",
            "number_of_lines_added_for_mitigation": "11",
            "number_of_lines_deleted_vulnerable_to_cve": "3",
            "Code_with_highlighted_vulnerability_lines": [
                "// Line 567: ",
                "// Line 568:   for (const key of protectedKeys) {",
                "// Line 569:     const envValue = process.env?.[key] || null;",
                "// Line 570:     if (!envValue) continue;",
                "// Line 571:     frozenEnvs[key] = process.env?.[key] || null;",
                "// Line 572:   }",
                "// Line 573: ",
                "// Line 574:   var envResult = `# Auto-dump ENV from system call on ${new Date().toTimeString()}",
                "// Line 575: `;",
                "// Line 576:   envResult += Object.entries(frozenEnvs)",
                "// vulnerable line: 577: .map(([key, value]) => {",
                "// vulnerable line: 578: return `${key}='${value}'`;",
                "// vulnerable line: 579: })",
                "// Line 580:     .join(\"",
                "// Line 581: \");",
                "// Line 582: ",
                "// Line 583:   const envPath = path.join(__dirname, \"../../.env\");",
                "// Line 584:   fs.writeFileSync(envPath, envResult, { encoding: \"utf8\", flag: \"w\" });",
                "// Line 585:   return true;",
                "// Line 586: }",
                "// Line 587: ",
                "// Line 588: module.exports = {",
                "// Line 589:   dumpENV,"
            ]
        }
    ]
}