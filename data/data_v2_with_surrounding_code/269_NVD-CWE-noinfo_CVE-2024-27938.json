{
    "cve_id": "CVE-2024-27938",
    "cve_description": "Postal is an open source SMTP server. Postal versions less than 3.0.0 are vulnerable to SMTP Smuggling attacks which may allow incoming e-mails to be spoofed. This, in conjunction with a cooperative outgoing SMTP service, would allow for an incoming e-mail to be received by Postal addressed from a server that a user has 'authorised' to send mail on their behalf but were not the genuine author of the e-mail. Postal is not affected for sending outgoing e-mails as email is re-encoded with `<CR><LF>` line endings when transmitted over SMTP. This issue has been addressed and users should upgrade to Postal v3.0.0 or higher. Once upgraded, Postal will only accept End of DATA sequences which are explicitly `<CR><LF>.<CR><LF>`. If a non-compliant sequence is detected it will be logged to the SMTP server log. There are no workarounds for this issue.",
    "cve_publish_date": "2024-03-11T22:15Z",
    "cwe_id": "NVD-CWE-noinfo",
    "cwe_name": "Insufficient Information",
    "cwe_description": "There is insufficient information about the issue to classify it; details are unkown or unspecified.",
    "commit_message": "feat: only accept RFC-compliant End-of-DATA sequence\n\nPreviously Postal was fairly forgiving about line endings. This requires that the end of data sequence is `<CR><LF>.<CR><LF>`.",
    "type_of_change": "Modification",
    "changes": [
        {
            "filename_of_changes": "client.rb",
            "code_language": "Ruby",
            "number_of_lines_added_for_mitigation": "16",
            "number_of_lines_deleted_vulnerable_to_cve": "3",
            "Code_with_highlighted_vulnerability_lines": [
                "// Line 404:       @receiving_headers = true",
                "// Line 405: ",
                "// Line 406:       received_header = ReceivedHeader.generate(@credential&.server, @helo_name, @ip_address, :smtp)",
                "// Line 407:                                       .force_encoding(\"BINARY\")",
                "// Line 408: ",
                "// Line 409:       @data << \"Received: #{received_header}",
                "// Line 410: \"",
                "// Line 411:       @headers[\"received\"] = [received_header]",
                "// Line 412: ",
                "// Line 413:       handler = proc do |idata|",
                "// vulnerable line: 414: if idata == \".\"",
                "// Line 415:           @logging_enabled = true",
                "// Line 416:           @proc = nil",
                "// Line 417:           finished",
                "// Line 418:         else",
                "// Line 419:           idata = idata.to_s.sub(/\\A\\.\\./, \".\")",
                "// Line 420: ",
                "// Line 421:           if @credential&.server&.log_smtp_data?",
                "// Line 422:             # We want to log if enabled",
                "// Line 423:           else",
                "// Line 424:             log \"Not logging further message data.\"",
                "// Line 425:             @logging_enabled = false",
                "// Line 426:           end",
                "// Line 427: ",
                "// Line 428:           if @receiving_headers",
                "// vulnerable line: 429: if idata.blank?",
                "// Line 430:               @receiving_headers = false",
                "// Line 431:             elsif idata.to_s =~ /^\\s/",
                "// Line 432:               # This is a continuation of a header",
                "// Line 433:               if @header_key && @headers[@header_key.downcase] && @headers[@header_key.downcase].last",
                "// Line 434:                 @headers[@header_key.downcase].last << idata.to_s",
                "// Line 435:               end",
                "// Line 436:             else",
                "// Line 437:               @header_key, value = idata.split(/:\\s*/, 2)",
                "// Line 438:               @headers[@header_key.downcase] ||= []",
                "// Line 439:               @headers[@header_key.downcase] << value"
            ]
        },
        {
            "filename_of_changes": "server.rb",
            "code_language": "Ruby",
            "number_of_lines_added_for_mitigation": "2",
            "number_of_lines_deleted_vulnerable_to_cve": "7",
            "Code_with_highlighted_vulnerability_lines": []
        }
    ]
}