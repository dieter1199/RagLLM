{
    "cve_id": "CVE-2024-34707",
    "cve_description": "Nautobot is a Network Source of Truth and Network Automation Platform. A Nautobot user with admin privileges can modify the `BANNER_TOP`, `BANNER_BOTTOM`, and `BANNER_LOGIN` configuration settings via the `/admin/constance/config/` endpoint. Normally these settings are used to provide custom banner text at the top and bottom of all Nautobot web pages (or specifically on the login page in the case of `BANNER_LOGIN`) but it was reported that an admin user can make use of these settings to inject arbitrary HTML, potentially exposing Nautobot users to security issues such as cross-site scripting (stored XSS). The vulnerability is fixed in Nautobot 1.6.22 and 2.2.4.",
    "cve_publish_date": "2024-05-14T15:39Z",
    "cwe_id": "NVD-CWE-noinfo",
    "cwe_name": "Insufficient Information",
    "cwe_description": "There is insufficient information about the issue to classify it; details are unkown or unspecified.",
    "commit_message": "Add 'javascript' and 'css' to BRANDING_FILEPATHS options. Sanitize BANNER_ content (#5697)\n\n* Add 'javascript' and 'css' to BRANDING_FILEPATHS options. Address GHSA-r2hr-4v48-fjv3",
    "type_of_change": "Modification",
    "changes": [
        {
            "filename_of_changes": "nautobot_config.py.j2",
            "code_language": "Python",
            "number_of_lines_added_for_mitigation": "2",
            "number_of_lines_deleted_vulnerable_to_cve": "0",
            "Code_with_highlighted_vulnerability_lines": []
        },
        {
            "filename_of_changes": "settings.py",
            "code_language": "Python",
            "number_of_lines_added_for_mitigation": "6",
            "number_of_lines_deleted_vulnerable_to_cve": "4",
            "Code_with_highlighted_vulnerability_lines": [
                "// Line 62:     \"mailto\",",
                "// Line 63:     \"sftp\",",
                "// Line 64:     \"ssh\",",
                "// Line 65:     \"tel\",",
                "// Line 66:     \"telnet\",",
                "// Line 67:     \"tftp\",",
                "// Line 68:     \"vnc\",",
                "// Line 69:     \"xmpp\",",
                "// Line 70: ]",
                "// Line 71: ",
                "// vulnerable line: 72: # Banners to display to users. HTML is allowed.",
                "// Line 73: if \"NAUTOBOT_BANNER_BOTTOM\" in os.environ and os.environ[\"NAUTOBOT_BANNER_BOTTOM\"] != \"\":",
                "// Line 74:     BANNER_BOTTOM = os.environ[\"NAUTOBOT_BANNER_BOTTOM\"]",
                "// Line 75: if \"NAUTOBOT_BANNER_LOGIN\" in os.environ and os.environ[\"NAUTOBOT_BANNER_LOGIN\"] != \"\":",
                "// Line 76:     BANNER_LOGIN = os.environ[\"NAUTOBOT_BANNER_LOGIN\"]",
                "// Line 77: if \"NAUTOBOT_BANNER_TOP\" in os.environ and os.environ[\"NAUTOBOT_BANNER_TOP\"] != \"\":",
                "// Line 78:     BANNER_TOP = os.environ[\"NAUTOBOT_BANNER_TOP\"]",
                "// Line 79: ",
                "// Line 80: # Number of days to retain changelog entries. Set to 0 to retain changes indefinitely. Defaults to 90 if not set here.",
                "// Line 81: if \"NAUTOBOT_CHANGELOG_RETENTION\" in os.environ and os.environ[\"NAUTOBOT_CHANGELOG_RETENTION\"] != \"\":",
                "// Line 82:     CHANGELOG_RETENTION = int(os.environ[\"NAUTOBOT_CHANGELOG_RETENTION\"])",
                "// Line 681: }",
                "// Line 682: ",
                "// Line 683: CONSTANCE_CONFIG = {",
                "// Line 684:     \"ALLOW_REQUEST_PROFILING\": ConstanceConfigItem(",
                "// Line 685:         default=False,",
                "// Line 686:         help_text=\"Allow users to enable request profiling on their login session.\",",
                "// Line 687:         field_type=bool,",
                "// Line 688:     ),",
                "// Line 689:     \"BANNER_BOTTOM\": ConstanceConfigItem(",
                "// Line 690:         default=\"\",",
                "// vulnerable line: 691: help_text=\"Custom HTML to display in a banner at the bottom of all pages.\",",
                "// Line 692:     ),",
                "// Line 693:     \"BANNER_LOGIN\": ConstanceConfigItem(",
                "// Line 694:         default=\"\",",
                "// vulnerable line: 695: help_text=\"Custom HTML to display in a banner at the top of the login page.\",",
                "// Line 696:     ),",
                "// Line 697:     \"BANNER_TOP\": ConstanceConfigItem(",
                "// Line 698:         default=\"\",",
                "// vulnerable line: 699: help_text=\"Custom HTML to display in a banner at the top of all pages.\",",
                "// Line 700:     ),",
                "// Line 701:     \"CHANGELOG_RETENTION\": ConstanceConfigItem(",
                "// Line 702:         default=90,",
                "// Line 703:         help_text=\"Number of days to retain object changelog history.",
                "// Line 704: Set this to 0 to retain changes indefinitely.\",",
                "// Line 705:         field_type=int,",
                "// Line 706:     ),",
                "// Line 707:     \"DEVICE_NAME_AS_NATURAL_KEY\": ConstanceConfigItem(",
                "// Line 708:         default=False,",
                "// Line 709:         help_text=\"Device names are not guaranteed globally-unique by Nautobot but in practice they often are. \""
            ]
        }
    ]
}