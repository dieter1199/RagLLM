{
    "cve_id": "CVE-2024-30250",
    "cve_description": "Astro-Shield is an integration to enhance website security with SubResource Integrity hashes, Content-Security-Policy headers, and other techniques. Versions from 1.2.0 to 1.3.1 of Astro-Shield allow bypass to the allow-lists for cross-origin resources by introducing valid `integrity` attributes to the injected code. This implies that the injected SRI hash would be added to the generated CSP header, which would lead the browser to believe that the injected resource is legit. This vulnerability is patched in version 1.3.2.",
    "cve_publish_date": "2024-04-04T15:15Z",
    "cwe_id": "NVD-CWE-noinfo",
    "cwe_name": "Insufficient Information",
    "cwe_description": "There is insufficient information about the issue to classify it; details are unkown or unspecified.",
    "commit_message": "fix: ensure that allowed scripts are in hashes module\n\nSigned-off-by: Andres Correa Casablanca <andreu@kindspells.dev>",
    "type_of_change": "Modification",
    "changes": [
        {
            "filename_of_changes": "astro.config.mjs",
            "code_language": "TypeScript",
            "number_of_lines_added_for_mitigation": "9",
            "number_of_lines_deleted_vulnerable_to_cve": "3",
            "Code_with_highlighted_vulnerability_lines": [
                "// Line 17: const rootDir = new URL('.', import.meta.url).pathname",
                "// Line 18: const sriHashesModule = resolve(rootDir, 'src', 'generated', 'sri.mjs')",
                "// Line 19: ",
                "// Line 20: // https://astro.build/config",
                "// Line 21: export default defineConfig({",
                "// Line 22:     output: 'hybrid',",
                "// Line 23:     trailingSlash: 'always',",
                "// Line 24:     adapter: node({ mode: 'standalone' }),",
                "// Line 25:     integrations: [",
                "// Line 26:         shield({",
                "// vulnerable line: 27: enableStatic_SRI: true,",
                "// vulnerable line: 28: enableMiddleware_SRI: true,",
                "// vulnerable line: 29: sriHashesModule,",
                "// Line 30:             securityHeaders: {",
                "// Line 31:                 contentSecurityPolicy: {",
                "// Line 32:                     cspDirectives: {",
                "// Line 33:                         'default-src': \"'none'\",",
                "// Line 34:                         'frame-ancestors': \"'none'\",",
                "// Line 35:                     },",
                "// Line 36:                 },",
                "// Line 37:             },",
                "// Line 38:         }),",
                "// Line 39:     ],"
            ]
        },
        {
            "filename_of_changes": "core.test.mts",
            "code_language": "TypeScript",
            "number_of_lines_added_for_mitigation": "2",
            "number_of_lines_deleted_vulnerable_to_cve": "2",
            "Code_with_highlighted_vulnerability_lines": [
                "// Line 358:             <body>",
                "// Line 359:                 <script type=\"module\" src=\"/core.mjs\"></script>",
                "// Line 360:             </body>",
                "// Line 361:         </html>`",
                "// Line 362: ",
                "// Line 363:         const expected = `<html>",
                "// Line 364:             <head>",
                "// Line 365:                 <title>My Test Page</title>",
                "// Line 366:             </head>",
                "// Line 367:             <body>",
                "// vulnerable line: 368: <script type=\"module\" src=\"/core.mjs\" integrity=\"sha256-iozyX5cgvSGJZLKhhN7CRl6tn/jC3vYkBm8jfGv4x78=\"></script>",
                "// Line 369:             </body>",
                "// Line 370:         </html>`",
                "// Line 371: ",
                "// Line 372:         const h = getEmptyHashes()",
                "// Line 373:         const updated = await updateStaticPageSriHashes(",
                "// Line 374:             console,",
                "// Line 375:             srcDir,",
                "// Line 376:             'index.html',",
                "// Line 377:             content,",
                "// Line 378:             h,",
                "// Line 379:         )",
                "// Line 380: ",
                "// Line 381:         expect(updated).toEqual(expected)",
                "// Line 382:         expect(h.extScriptHashes.size).toBe(1)",
                "// Line 383:         expect(",
                "// Line 384:             h.extScriptHashes.has(",
                "// vulnerable line: 385: 'sha256-iozyX5cgvSGJZLKhhN7CRl6tn/jC3vYkBm8jfGv4x78=',",
                "// Line 386:             ),",
                "// Line 387:         ).toBe(true)",
                "// Line 388:         expect(h.inlineScriptHashes.size).toBe(0)",
                "// Line 389:         expect(h.inlineStyleHashes.size).toBe(0)",
                "// Line 390:         expect(h.extStyleHashes.size).toBe(0)",
                "// Line 391:     })",
                "// Line 392: ",
                "// Line 393:     it('adds sri hash to external script (cross origin)', async () => {",
                "// Line 394:         const remoteScript =",
                "// Line 395:             'https://raw.githubusercontent.com/KindSpells/astro-shield/ae9521048f2129f633c075b7f7ef24e11bbd1884/main.mjs'"
            ]
        }
    ]
}