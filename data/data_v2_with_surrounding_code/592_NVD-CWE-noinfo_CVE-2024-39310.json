{
    "cve_id": "CVE-2024-39310",
    "cve_description": "The Basil recipe theme for WordPress is vulnerable to Persistent Cross-Site Scripting (XSS) via the `post_title` parameter in versions up to, and including, 2.0.4 due to insufficient input sanitization and output escaping. This vulnerability allows authenticated attackers with contributor-level access and above to inject arbitrary web scripts in pages that will execute whenever a user accesses a compromised page. Because the of the default WordPress validation, it is not possible to insert the payload directly but if the Cooked plugin is installed, it is possible to create a recipe post type (cp_recipe) and inject the payload in the title field. Version 2.0.5 contains a patch for the issue.",
    "cve_publish_date": "2024-07-01T22:15Z",
    "cwe_id": "NVD-CWE-noinfo",
    "cwe_name": "Insufficient Information",
    "cwe_description": "There is insufficient information about the issue to classify it; details are unkown or unspecified.",
    "commit_message": "Fix for advisories/GHSA-cr7v-8v2h-49vx",
    "type_of_change": "Modification",
    "changes": [
        {
            "filename_of_changes": "functions.php",
            "code_language": "PHP",
            "number_of_lines_added_for_mitigation": "6",
            "number_of_lines_deleted_vulnerable_to_cve": "6",
            "Code_with_highlighted_vulnerability_lines": [
                "// Line 1: <?php",
                "// Line 2: ",
                "// Line 3: global $bx_options;",
                "// Line 4: ",
                "// Line 5: /* Theme Specific Defaults */",
                "// Line 6: define( 'BX_THEME_SLUG', 'basil' );",
                "// vulnerable line: 7: define( 'BX_THEME_VERSION', '2.0.4' );",
                "// vulnerable line: 8: define( 'BASIL_CP_VERSION', '1.7.5.8' );",
                "// Line 9: ",
                "// Line 10: /* Theme Framework Defaults */",
                "// Line 11: define( 'BX_BASE_DIR', trailingslashit( get_template_directory() ) );",
                "// Line 12: define( 'BX_BASE_URL', trailingslashit( get_template_directory_uri() ) );",
                "// Line 13: define( 'BX_FW_DIR', trailingslashit( BX_BASE_DIR . '_framework' ) );",
                "// Line 14: define( 'BX_FW_URL', trailingslashit( BX_BASE_URL . '_framework' ) );",
                "// Line 15: define( 'BX_THEME_DIR', trailingslashit( BX_BASE_DIR . '_theme' ) );",
                "// Line 16: define( 'BX_THEME_URL', trailingslashit( BX_BASE_URL . '_theme' ) );",
                "// Line 17: ",
                "// Line 18: // Theme Updates",
                "// Line 93:     $_post_types = array();",
                "// Line 94: ",
                "// Line 95:     if ( !empty($post_types) ):",
                "// Line 96:         foreach( $post_types as $name => $post_type ):",
                "// Line 97:             $_post_types[] = $name;",
                "// Line 98:         endforeach;",
                "// Line 99:     endif;",
                "// Line 100: ",
                "// Line 101:     if ( isset($bx_page_settings['sidebar']) && $bx_page_settings['sidebar'] ):",
                "// Line 102:         if ( $bx_page_settings['sidebar'] == 'disabled' ):",
                "// vulnerable line: 103: return false;",
                "// Line 104:         else:",
                "// Line 105:             $basil_sidebar['sidebar'] = $bx_page_settings['sidebar'];",
                "// Line 106:             $basil_sidebar['original'] = $basil_sidebar['sidebar'];",
                "// Line 107:         endif;",
                "// Line 108:     else:",
                "// Line 109:         $basil_sidebar['sidebar'] = ( is_page() ? 'sidebar-2' : 'sidebar-1' );",
                "// Line 110:         $basil_sidebar['original'] = $basil_sidebar['sidebar'];",
                "// Line 111:     endif;",
                "// Line 112: ",
                "// Line 113:     if ( $basil_sidebar['sidebar'] && class_exists('CustomSidebars') ):",
                "// Line 132:             $basil_sidebar['sidebar'] = 'sidebar-' . $post_type_name;",
                "// Line 133:             $basil_sidebar['original'] = $basil_sidebar['sidebar'];",
                "// Line 134:         endif;",
                "// Line 135: ",
                "// Line 136:     endif;",
                "// Line 137: ",
                "// Line 138:     if ( is_active_sidebar( $basil_sidebar['sidebar'] ) ) {",
                "// Line 139:         return $basil_sidebar;",
                "// Line 140:     }",
                "// Line 141: ",
                "// vulnerable line: 142: return false;",
                "// Line 143: }",
                "// Line 144: ",
                "// Line 145: function basil_page_banner() {",
                "// Line 146: ",
                "// Line 147:     global $bx_options,$post,$bx_page_settings;",
                "// Line 148:     $blog_id = get_option( 'page_for_posts' );",
                "// Line 149: ",
                "// Line 150:     if ( is_home() && $blog_id ):",
                "// Line 151:         $post = get_post( $blog_id, object );",
                "// Line 152:         setup_postdata( $post );",
                "// Line 203:     global $wp_query;",
                "// Line 204: ",
                "// Line 205:     if ( !in_the_loop() && is_search() ):",
                "// Line 206:         if ( have_posts() ) :",
                "// Line 207:             echo $before . sprintf( esc_html__('Search Results for: %s', 'basil' ), '<span>' . get_search_query() . '</span>' ) . $after;",
                "// Line 208:         else :",
                "// Line 209:             echo $before . esc_html__( 'Nothing Found', 'basil' ) . $after;",
                "// Line 210:         endif;",
                "// Line 211:     else:",
                "// Line 212: ",
                "// vulnerable line: 213: global $bx_options,$post;",
                "// Line 214: ",
                "// Line 215:         if ( empty($post) )",
                "// Line 216:             return;",
                "// Line 217: ",
                "// Line 218:         $default_option = ( isset( $bx_options['basil_page_title'] ) ? $bx_options['basil_page_title'] : 'enabled' );",
                "// Line 219:         $bx_page_settings = get_post_meta( $post->ID, '_basil_page_settings', true);",
                "// Line 220:         $title_setting = ( isset( $bx_page_settings['title'] ) && $bx_page_settings['title'] ? $bx_page_settings['title'] : false );",
                "// Line 221: ",
                "// Line 222:         if ( !in_the_loop() && is_archive() ):",
                "// Line 223:             if ( $title_setting == 'enabled' || !$title_setting && $default_option == 'enabled' ):",
                "// vulnerable line: 224: the_archive_title( $before, $after );",
                "// Line 225:             endif;",
                "// Line 226:         elseif ( $title_setting == 'enabled' || !$title_setting && $default_option == 'enabled' ):",
                "// vulnerable line: 227: the_title( $before, $after );",
                "// Line 228:         endif;",
                "// Line 229: ",
                "// Line 230:     endif;",
                "// vulnerable line: 231: return false;",
                "// Line 232: ",
                "// Line 233: }",
                "// Line 234: ",
                "// Line 235: function basil_page_thumbnail() {",
                "// Line 236: ",
                "// vulnerable line: 237: global $bx_options,$post;",
                "// Line 238: ",
                "// Line 239:     if ( $bx_options['basil_page_thumbnail_layout'] == 'inline' ):",
                "// Line 240: ",
                "// Line 241:         if ( has_post_thumbnail() ):",
                "// Line 242:             $thumbnail = apply_filters( 'basil_page_thumbnail_url', bx_post_thumbnail( 'basil_page_thumbnail' ) );",
                "// Line 243:             do_action( 'basil_before_page_thumbnail' );",
                "// Line 244:             echo '<div class=\"basil-page-thumbnail' . ( $bx_options['basil_page_thumbnail_style'] != 'disabled' ? ' ' . $bx_options['basil_page_thumbnail_style'] : '' ) . '\">';",
                "// Line 245:             echo $thumbnail;",
                "// Line 246:             echo '</div>';",
                "// Line 247:             do_action( 'basil_after_page_thumbnail' );",
                "// Line 357:         ) );",
                "// Line 358: ",
                "// Line 359:         $all_the_cats = count( $all_the_cats );",
                "// Line 360:         set_transient( 'basil_categories', $all_the_cats );",
                "// Line 361: ",
                "// Line 362:     }",
                "// Line 363: ",
                "// Line 364:     if ( $all_the_cats > 1 ) {",
                "// Line 365:         return true;",
                "// Line 366:     } else {",
                "// vulnerable line: 367: return false;",
                "// Line 368:     }",
                "// Line 369: }",
                "// Line 370: "
            ]
        }
    ]
}