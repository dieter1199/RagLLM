{
    "cve_id": "CVE-2024-24539",
    "cve_description": "FusionPBX before 5.2.0 does not validate a session.",
    "cve_publish_date": "2024-03-18T03:15Z",
    "cwe_id": "NVD-CWE-noinfo",
    "cwe_name": "Insufficient Information",
    "cwe_description": "There is insufficient information about the issue to classify it; details are unkown or unspecified.",
    "commit_message": "Security - validate session",
    "type_of_change": "Modification",
    "changes": [
        {
            "filename_of_changes": "authentication.php",
            "code_language": "PHP",
            "number_of_lines_added_for_mitigation": "4",
            "number_of_lines_deleted_vulnerable_to_cve": "1",
            "Code_with_highlighted_vulnerability_lines": [
                "// Line 229:                     $_SESSION[\"user_uuid\"] = $result[\"user_uuid\"];",
                "// Line 230:                     $_SESSION[\"context\"] = $result['domain_name'];",
                "// Line 231: ",
                "// Line 232:                 //user session array",
                "// Line 233:                     $_SESSION[\"user\"][\"domain_uuid\"] = $result[\"domain_uuid\"];",
                "// Line 234:                     $_SESSION[\"user\"][\"domain_name\"] = $result[\"domain_name\"];",
                "// Line 235:                     $_SESSION[\"user\"][\"user_uuid\"] = $result[\"user_uuid\"];",
                "// Line 236:                     $_SESSION[\"user\"][\"username\"] = $result[\"username\"];",
                "// Line 237:                     $_SESSION[\"user\"][\"contact_uuid\"] = $result[\"contact_uuid\"];",
                "// Line 238: ",
                "// vulnerable line: 239: //get the groups assigned to the user ",
                "// Line 240:                     $group = new groups;",
                "// Line 241:                     $group->session($result[\"domain_uuid\"], $result[\"user_uuid\"]);",
                "// Line 242: ",
                "// Line 243:                 //get the permissions assigned to the user through the assigned groups",
                "// Line 244:                     $permission = new permissions;",
                "// Line 245:                     $permission->session($result[\"domain_uuid\"], $_SESSION[\"groups\"]);",
                "// Line 246: ",
                "// Line 247:                 //get the domains",
                "// Line 248:                     if (file_exists($_SERVER[\"PROJECT_ROOT\"].\"/app/domains/app_config.php\") && !is_cli()){",
                "// Line 249:                         require_once \"app/domains/resources/domains.php\";"
            ]
        },
        {
            "filename_of_changes": "check_auth.php",
            "code_language": "PHP",
            "number_of_lines_added_for_mitigation": "13",
            "number_of_lines_deleted_vulnerable_to_cve": "2",
            "Code_with_highlighted_vulnerability_lines": [
                "// Line 30: //add multi-lingual support",
                "// Line 31:     $language = new text;",
                "// Line 32:     $text = $language->get(null, 'resources');",
                "// Line 33: ",
                "// Line 34: //for compatibility require this library if less than version 5.5",
                "// Line 35:     if (version_compare(phpversion(), '5.5', '<')) {",
                "// Line 36:         require_once \"resources/functions/password.php\";",
                "// Line 37:     }",
                "// Line 38: ",
                "// Line 39: //start the session",
                "// vulnerable line: 40: if (function_exists('session_start')) { ",
                "// Line 41:         if (!isset($_SESSION)) {",
                "// Line 42:             session_start();",
                "// Line 43:         }",
                "// Line 44:     }",
                "// Line 45: ",
                "// Line 46: //regenerate sessions to avoid session id attacks such as session fixation",
                "// Line 47:     if (array_key_exists('security',$_SESSION) && $_SESSION['security']['session_rotate']['boolean'] == \"true\") {",
                "// Line 48:         $_SESSION['session']['last_activity'] = time();",
                "// Line 49:         if (!isset($_SESSION['session']['created'])) {",
                "// Line 50:             $_SESSION['session']['created'] = time();",
                "// Line 64: ",
                "// Line 65: //set the domain_uuid variable from the session",
                "// Line 66:     if (!empty($_SESSION[\"domain_uuid\"])) {",
                "// Line 67:         $domain_uuid = $_SESSION[\"domain_uuid\"];",
                "// Line 68:     }",
                "// Line 69: ",
                "// Line 70: //define variables",
                "// Line 71:     if (!isset($_SESSION['template_content'])) { $_SESSION[\"template_content\"] = null; }",
                "// Line 72: ",
                "// Line 73: //if the session is not authorized then verify the identity",
                "// vulnerable line: 74: if (!isset($_SESSION['authorized']) || (isset($_SESSION['authorized']) && !$_SESSION['authorized'])) {",
                "// Line 75: ",
                "// Line 76:         //clear the menu",
                "// Line 77:             unset($_SESSION[\"menu\"]);",
                "// Line 78: ",
                "// Line 79:         //clear the template only if the template has not been assigned by the superadmin",
                "// Line 80:             if (empty($_SESSION['domain']['template']['name'])) {",
                "// Line 81:                 $_SESSION[\"template_content\"] = '';",
                "// Line 82:             }",
                "// Line 83: ",
                "// Line 84:         //validate the username and password"
            ]
        }
    ]
}