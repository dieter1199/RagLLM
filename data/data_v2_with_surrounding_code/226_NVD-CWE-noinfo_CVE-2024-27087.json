{
    "cve_id": "CVE-2024-27087",
    "cve_description": "Kirby is a content management system. The new link field introduced in Kirby 4 allows several different link types that each validate the entered link to the relevant URL format. It also includes a \"Custom\" link type for advanced use cases that don't fit any of the pre-defined link formats.  As the \"Custom\" link type is meant to be flexible, it also allows the javascript: URL scheme. In some use cases this can be intended, but it can also be misused by attackers to execute arbitrary JavaScript code when a user or visitor clicks on a link that is generated from the contents of the link field. This vulnerability is patched in 4.1.1.\n\n",
    "cve_publish_date": "2024-02-26T17:15Z",
    "cwe_id": "NVD-CWE-noinfo",
    "cwe_name": "Insufficient Information",
    "cwe_description": "There is insufficient information about the issue to classify it; details are unkown or unspecified.",
    "commit_message": "Link field: Donâ€™t allow custom type by default\n\nhttps://github.com/getkirby/kirby/security/advisories/GHSA-63h4-w25c-3qv4",
    "type_of_change": "Modification",
    "changes": [
        {
            "filename_of_changes": "LinkFieldTest.php",
            "code_language": "PHP",
            "number_of_lines_added_for_mitigation": "1",
            "number_of_lines_deleted_vulnerable_to_cve": "2",
            "Code_with_highlighted_vulnerability_lines": [
                "// Line 19:         $this->assertNull($field->after());",
                "// Line 20:         $this->assertNull($field->before());",
                "// Line 21:         $this->assertNull($field->icon());",
                "// Line 22:         $this->assertNull($field->placeholder());",
                "// Line 23:         $this->assertSame([",
                "// Line 24:             'url',",
                "// Line 25:             'page',",
                "// Line 26:             'file',",
                "// Line 27:             'email',",
                "// Line 28:             'tel',",
                "// vulnerable line: 29: 'anchor',",
                "// vulnerable line: 30: 'custom'",
                "// Line 31:         ], $field->options());",
                "// Line 32:     }",
                "// Line 33: }"
            ]
        },
        {
            "filename_of_changes": "link.php",
            "code_language": "PHP",
            "number_of_lines_added_for_mitigation": "1",
            "number_of_lines_deleted_vulnerable_to_cve": "2",
            "Code_with_highlighted_vulnerability_lines": [
                "// Line 15:         /**",
                "// Line 16:          * @values 'anchor', 'url, 'page, 'file', 'email', 'tel', 'custom'",
                "// Line 17:          */",
                "// Line 18:         'options' => function (array|null $options = null): array {",
                "// Line 19:             return $options ?? [",
                "// Line 20:                 'url',",
                "// Line 21:                 'page',",
                "// Line 22:                 'file',",
                "// Line 23:                 'email',",
                "// Line 24:                 'tel',",
                "// vulnerable line: 25: 'anchor',",
                "// vulnerable line: 26: 'custom'",
                "// Line 27:             ];",
                "// Line 28:         },",
                "// Line 29:         'value' => function (string|null $value = null) {",
                "// Line 30:             return $value ?? '';",
                "// Line 31:         }",
                "// Line 32:     ],",
                "// Line 33:     'methods' => [",
                "// Line 34:         'activeTypes' => function () {",
                "// Line 35:             return array_filter($this->availableTypes(), function (string $type) {",
                "// Line 36:                 return in_array($type, $this->props['options']) === true;"
            ]
        }
    ]
}