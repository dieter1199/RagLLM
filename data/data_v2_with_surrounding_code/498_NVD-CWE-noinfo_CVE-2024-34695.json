{
    "cve_id": "CVE-2024-34695",
    "cve_description": "WOWS Karma is a reputation system for Wargaming's World of Warships. A user is able to click multiple times on \"create\" on a post creation prompt before the modal closes, which triggers sending several post creation API requests at once. Due to timing, sending multiple posts simultaneously requests bypasses the cooldown validation, however are not refreshing a user's metrics more than once, due to concurrent karma updates. This issue is fixed in 0.17.4.1.",
    "cve_publish_date": "2024-05-14T15:39Z",
    "cwe_id": "NVD-CWE-noinfo",
    "cwe_name": "Insufficient Information",
    "cwe_description": "There is insufficient information about the issue to classify it; details are unkown or unspecified.",
    "commit_message": "feat(api): Add UserAtomicLock middleware to request pipeline\n\n- Added `UserAtomicLock` attribute to the `CreatePost` action in `PostController.cs`\n- Registered `UserAtomicLockMiddleware` as a singleton in `Startup.cs`\n- Added `app.UseMiddleware<UserAtomicLockMiddleware>()` in the HTTP request pipeline",
    "type_of_change": "Modification",
    "changes": [
        {
            "filename_of_changes": "PostController.cs",
            "code_language": "C#",
            "number_of_lines_added_for_mitigation": "1",
            "number_of_lines_deleted_vulnerable_to_cve": "1",
            "Code_with_highlighted_vulnerability_lines": [
                "// Line 189:     /// Submits a new post for creation.",
                "// Line 190:     /// </summary>",
                "// Line 191:     /// <param name=\"postDto\">Post object to submit</param>",
                "// Line 192:     /// <param name=\"replay\">Optional replay file to attach to post</param>",
                "// Line 193:     /// <param name=\"ignoreChecks\">Bypass API Validation for post creation (Admin only)</param>",
                "// Line 194:     /// <response code=\"201\">Post was successfuly created.</response>",
                "// Line 195:     /// <response code=\"400\">Post contents validation has failed.</response>",
                "// Line 196:     /// <response code=\"422\">Attached replay is invalid.</response>",
                "// Line 197:     /// <response code=\"403\">Restrictions are in effect for one of the targeted accounts.</response>",
                "// Line 198:     /// <response code=\"404\">One of the targeted accounts was not found.</response>",
                "// vulnerable line: 199: [HttpPost, Authorize(RequireNoPlatformBans)]",
                "// Line 200:     [ProducesResponseType(201), ProducesResponseType(400), ProducesResponseType(422), ProducesResponseType(typeof(string), 403), ProducesResponseType(typeof(string), 404)]",
                "// Line 201:     public async Task<IActionResult> CreatePost(",
                "// Line 202:         [FromForm] string postDto, ",
                "// Line 203:         [FromServices] ReplaysIngestService replaysIngestService,",
                "// Line 204:         IFormFile? replay = null, ",
                "// Line 205:         [FromQuery] bool ignoreChecks = false)",
                "// Line 206:     {",
                "// Line 207:         PlayerPostDTO post;",
                "// Line 208:             ",
                "// Line 209:         try"
            ]
        },
        {
            "filename_of_changes": "Startup.cs",
            "code_language": "C#",
            "number_of_lines_added_for_mitigation": "5",
            "number_of_lines_deleted_vulnerable_to_cve": "2",
            "Code_with_highlighted_vulnerability_lines": [
                "// Line 3: using Microsoft.AspNetCore.HttpOverrides;",
                "// Line 4: using Microsoft.AspNetCore.ResponseCompression;",
                "// Line 5: using Microsoft.EntityFrameworkCore;",
                "// Line 6: using Microsoft.Extensions.Primitives;",
                "// Line 7: using Microsoft.IdentityModel.Tokens;",
                "// Line 8: using Microsoft.OpenApi.Models;",
                "// Line 9: using Nodsoft.WowsReplaysUnpack;",
                "// Line 10: using System.IdentityModel.Tokens.Jwt;",
                "// Line 11: using System.Net;",
                "// Line 12: using System.Reflection;",
                "// vulnerable line: 13: using System.Text;",
                "// Line 14: using Hangfire;",
                "// Line 15: using Hangfire.PostgreSql;",
                "// Line 16: using Hangfire.Tags.PostgreSql;",
                "// Line 17: using Microsoft.AspNetCore.Authorization;",
                "// Line 18: using Newtonsoft.Json;",
                "// Line 19: using Nodsoft.Wargaming.Api.Client;",
                "// Line 20: using Nodsoft.Wargaming.Api.Client.Clients;",
                "// Line 21: using Nodsoft.Wargaming.Api.Client.Clients.Wows;",
                "// Line 22: using Nodsoft.Wargaming.Api.Common;",
                "// Line 23: using Nodsoft.WowsReplaysUnpack.ExtendedData;"
            ]
        }
    ]
}