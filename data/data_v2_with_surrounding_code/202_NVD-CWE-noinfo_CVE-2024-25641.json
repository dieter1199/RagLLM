{
    "cve_id": "CVE-2024-25641",
    "cve_description": "Cacti provides an operational monitoring and fault management framework. Prior to version 1.2.27, an arbitrary file write vulnerability, exploitable through the \"Package Import\" feature, allows authenticated users having the \"Import Templates\" permission to execute arbitrary PHP code on the web server. The vulnerability is located within the `import_package()` function defined into the `/lib/import.php` script. The function blindly trusts the filename and file content provided within the XML data, and writes such files into the Cacti base path (or even outside, since path traversal sequences are not filtered). This can be exploited to write or overwrite arbitrary files on the web server, leading to execution of arbitrary PHP code or other security impacts. Version 1.2.27 contains a patch for this issue.",
    "cve_publish_date": "2024-05-14T15:05Z",
    "cwe_id": "NVD-CWE-noinfo",
    "cwe_name": "Insufficient Information",
    "cwe_description": "There is insufficient information about the issue to classify it; details are unkown or unspecified.",
    "commit_message": "Merge pull request from GHSA-7cmj-g5qc-pj88",
    "type_of_change": "Modification",
    "changes": [
        {
            "filename_of_changes": "import.php",
            "code_language": "PHP",
            "number_of_lines_added_for_mitigation": "14",
            "number_of_lines_deleted_vulnerable_to_cve": "3",
            "Code_with_highlighted_vulnerability_lines": [
                "// Line 522: ",
                "// Line 523:     foreach ($data['files']['file'] as $f) {",
                "// Line 524:         $fdata = base64_decode($f['data'], true);",
                "// Line 525:         $name  = $f['name'];",
                "// Line 526: ",
                "// Line 527:         if (strpos($name, 'scripts/') !== false || strpos($name, 'resource/') !== false) {",
                "// Line 528:             $filename = CACTI_PATH_BASE . \"/$name\";",
                "// Line 529: ",
                "// Line 530:             if (!$preview) {",
                "// Line 531:                 if (!cacti_sizeof($import_files) || in_array($name, $import_files, true)) {",
                "// vulnerable line: 532: cacti_log('Writing file: ' . $filename, false, 'IMPORT', POLLER_VERBOSITY_MEDIUM);",
                "// Line 533: ",
                "// vulnerable line: 534: if ((is_writeable(dirname($filename)) && !file_exists($filename)) || is_writable($filename)) {",
                "// Line 535:                         $file = fopen($filename, 'wb');",
                "// Line 536: ",
                "// Line 537:                         if (is_resource($file)) {",
                "// Line 538:                             fwrite($file , $fdata, strlen($fdata));",
                "// Line 539:                             fclose($file);",
                "// Line 540:                             clearstatcache();",
                "// Line 541:                             $filestatus[$filename] = __('written');",
                "// Line 542:                         } else {",
                "// Line 543:                             $filestatus[$filename] = __('could not open');",
                "// Line 544:                         }",
                "// Line 556:                 }",
                "// Line 557:             } else {",
                "// Line 558:                 cacti_log('Previewing file: ' . $filename, false, 'IMPORT', POLLER_VERBOSITY_MEDIUM);",
                "// Line 559: ",
                "// Line 560:                 $new = md5($fdata);",
                "// Line 561: ",
                "// Line 562:                 if (file_exists($filename)) {",
                "// Line 563:                     $existing = md5_file($filename);",
                "// Line 564:                 }",
                "// Line 565: ",
                "// vulnerable line: 566: if (is_writeable(dirname($filename))) {",
                "// Line 567:                     if (file_exists($filename) && is_writable($filename)) {",
                "// Line 568:                         if ($new == $existing) {",
                "// Line 569:                             $filestatus[$filename] = 'writable, identical';",
                "// Line 570:                         } else {",
                "// Line 571:                             $filestatus[$filename] = 'writable, differences';",
                "// Line 572:                         }",
                "// Line 573:                     } elseif (file_exists($filename) && is_writeable($filename)) {",
                "// Line 574:                         $filestatus[$filename] = 'writable, new';",
                "// Line 575:                     } elseif (file_exists($filename) && !is_writeable($filename)) {",
                "// Line 576:                         if ($new == $existing) {"
            ]
        },
        {
            "filename_of_changes": "package_import.php",
            "code_language": "PHP",
            "number_of_lines_added_for_mitigation": "2",
            "number_of_lines_deleted_vulnerable_to_cve": "0",
            "Code_with_highlighted_vulnerability_lines": []
        }
    ]
}