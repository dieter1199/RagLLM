{
    "cve_id": "CVE-2024-36399",
    "cve_description": "Kanboard is project management software that focuses on the Kanban methodology. The vuln is in app/Controller/ProjectPermissionController.php function addUser(). The users permission to add users to a project only get checked on the URL parameter project_id. If the user is authorized to add users to this project the request gets processed. The users permission for the POST BODY parameter project_id does not get checked again while processing. An attacker with the 'Project Manager' on a single project may take over any other project. The vulnerability is fixed in 1.2.37.",
    "cve_publish_date": "2024-06-06T16:15Z",
    "cwe_id": "NVD-CWE-noinfo",
    "cwe_name": "Insufficient Information",
    "cwe_description": "There is insufficient information about the issue to classify it; details are unkown or unspecified.",
    "commit_message": "Add CSRF check and remove project_id form value for addUser/addGroup actions",
    "type_of_change": "Modification",
    "changes": [
        {
            "filename_of_changes": "ProjectPermissionController.php",
            "code_language": "PHP",
            "number_of_lines_added_for_mitigation": "5",
            "number_of_lines_deleted_vulnerable_to_cve": "1",
            "Code_with_highlighted_vulnerability_lines": [
                "// Line 68:     {",
                "// Line 69:         $project = $this->getProject();",
                "// Line 70:         $values = $this->request->getValues();",
                "// Line 71: ",
                "// Line 72:         if (empty($values['user_id']) && ! empty($values['external_id']) && ! empty($values['external_id_column'])) {",
                "// Line 73:             $values['user_id'] = $this->userModel->getOrCreateExternalUserId($values['username'], $values['name'], $values['external_id_column'], $values['external_id']);",
                "// Line 74:         }",
                "// Line 75: ",
                "// Line 76:         if (empty($values['user_id'])) {",
                "// Line 77:             $this->flash->failure(t('User not found.'));",
                "// vulnerable line: 78: } elseif ($this->projectUserRoleModel->addUser($values['project_id'], $values['user_id'], $values['role'])) {",
                "// Line 79:             $this->flash->success(t('Project updated successfully.'));",
                "// Line 80:         } else {",
                "// Line 81:             $this->flash->failure(t('Unable to update this project.'));",
                "// Line 82:         }",
                "// Line 83: ",
                "// Line 84:         $this->response->redirect($this->helper->url->to('ProjectPermissionController', 'index', array('project_id' => $project['id'])));",
                "// Line 85:     }",
                "// Line 86: ",
                "// Line 87:     /**",
                "// Line 88:      * Revoke user access"
            ]
        },
        {
            "filename_of_changes": "groups.php",
            "code_language": "PHP",
            "number_of_lines_added_for_mitigation": "0",
            "number_of_lines_deleted_vulnerable_to_cve": "1",
            "Code_with_highlighted_vulnerability_lines": [
                "// Line 30:                 </td>",
                "// Line 31:             </tr>",
                "// Line 32:         <?php endforeach ?>",
                "// Line 33:     </table>",
                "// Line 34: <?php endif ?>",
                "// Line 35: ",
                "// Line 36: <?php if ($project['is_private'] == 0): ?>",
                "// Line 37:     <div class=\"panel\">",
                "// Line 38:         <form method=\"post\" action=\"<?= $this->url->href('ProjectPermissionController', 'addGroup', array('project_id' => $project['id'])) ?>\" autocomplete=\"off\" class=\"form-inline\">",
                "// Line 39:             <?= $this->form->csrf() ?>",
                "// vulnerable line: 40: <?= $this->form->hidden('project_id', array('project_id' => $project['id'])) ?>",
                "// Line 41:             <?= $this->form->hidden('group_id', $values) ?>",
                "// Line 42:             <?= $this->form->hidden('external_id', $values) ?>",
                "// Line 43: ",
                "// Line 44:             <?= $this->form->label(t('Group Name'), 'name') ?>",
                "// Line 45:             <?= $this->form->text('name', $values, $errors, array(",
                "// Line 46:                 'required',",
                "// Line 47:                 'placeholder=\"'.t('Enter group name...').'\"',",
                "// Line 48:                 'title=\"'.t('Enter group name...').'\"',",
                "// Line 49:                 'data-dst-field=\"group_id\"',",
                "// Line 50:                 'data-dst-extra-fields=\"external_id\"',"
            ]
        },
        {
            "filename_of_changes": "users.php",
            "code_language": "PHP",
            "number_of_lines_added_for_mitigation": "0",
            "number_of_lines_deleted_vulnerable_to_cve": "1",
            "Code_with_highlighted_vulnerability_lines": [
                "// Line 28:                 </td>",
                "// Line 29:             </tr>",
                "// Line 30:         <?php endforeach ?>",
                "// Line 31:     </table>",
                "// Line 32: <?php endif ?>",
                "// Line 33: ",
                "// Line 34: <?php if ($project['is_private'] == 0): ?>",
                "// Line 35:     <div class=\"panel\">",
                "// Line 36:         <form method=\"post\" action=\"<?= $this->url->href('ProjectPermissionController', 'addUser', array('project_id' => $project['id'])) ?>\" autocomplete=\"off\" class=\"form-inline\">",
                "// Line 37:             <?= $this->form->csrf() ?>",
                "// vulnerable line: 38: <?= $this->form->hidden('project_id', array('project_id' => $project['id'])) ?>",
                "// Line 39:             <?= $this->form->hidden('user_id', $values) ?>",
                "// Line 40:             <?= $this->form->hidden('username', $values) ?>",
                "// Line 41:             <?= $this->form->hidden('external_id', $values) ?>",
                "// Line 42:             <?= $this->form->hidden('external_id_column', $values) ?>",
                "// Line 43: ",
                "// Line 44:             <?= $this->form->label(t('Name'), 'name') ?>",
                "// Line 45:             <?= $this->form->text('name', $values, $errors, array(",
                "// Line 46:                     'required',",
                "// Line 47:                     'placeholder=\"'.t('Enter user name...').'\"',",
                "// Line 48:                     'title=\"'.t('Enter user name...').'\"',"
            ]
        }
    ]
}