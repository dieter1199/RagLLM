{
    "cve_id": "CVE-2024-34070",
    "cve_description": "Froxlor is open source server administration software. Prior to 2.1.9, a Stored Blind Cross-Site Scripting (XSS) vulnerability was identified in the Failed Login Attempts Logging Feature of the Froxlor Application. An unauthenticated User can inject malicious scripts in the loginname parameter on the Login attempt, which will then be executed when viewed by the Administrator in the System Logs.  By exploiting this vulnerability, the attacker can perform various malicious actions such as forcing the Administrator to execute actions without their knowledge or consent. For instance, the attacker can force the Administrator to add a new administrator controlled by the attacker, thereby giving the attacker full control over the application. This vulnerability is fixed in 2.1.9.\n",
    "cve_publish_date": "2024-05-14T15:38Z",
    "cwe_id": "NVD-CWE-noinfo",
    "cwe_name": "Insufficient Information",
    "cwe_description": "There is insufficient information about the issue to classify it; details are unkown or unspecified.",
    "commit_message": "Merge pull request from GHSA-x525-54hf-xr53\n\n* do not log unvalidated user-input to mysql-log (if enabled)\n\nSigned-off-by: Michael Kaufmann <d00p@froxlor.org>\n\n* clean log-text to only allow a subset of special characters\n\nSigned-off-by: Michael Kaufmann <d00p@froxlor.org>\n\n* clean log-text when selecting from database to avoid possible previously added malicious entries\n\nSigned-off-by: Michael Kaufmann <d00p@froxlor.org>\n\n---------\n\nSigned-off-by: Michael Kaufmann <d00p@froxlor.org>",
    "type_of_change": "Modification",
    "changes": [
        {
            "filename_of_changes": "FroxlorLogger.php",
            "code_language": "PHP",
            "number_of_lines_added_for_mitigation": "3",
            "number_of_lines_deleted_vulnerable_to_cve": "0",
            "Code_with_highlighted_vulnerability_lines": []
        },
        {
            "filename_of_changes": "SysLog.php",
            "code_language": "PHP",
            "number_of_lines_added_for_mitigation": "2",
            "number_of_lines_deleted_vulnerable_to_cve": "0",
            "Code_with_highlighted_vulnerability_lines": []
        },
        {
            "filename_of_changes": "index.php",
            "code_language": "PHP",
            "number_of_lines_added_for_mitigation": "3",
            "number_of_lines_deleted_vulnerable_to_cve": "3",
            "Code_with_highlighted_vulnerability_lines": [
                "// Line 241: ",
                "// Line 242:             if ($row && $row['admin'] == $loginname) {",
                "// Line 243:                 $table = \"`\" . TABLE_PANEL_ADMINS . \"`\";",
                "// Line 244:                 $uid = 'adminid';",
                "// Line 245:                 $adminsession = '1';",
                "// Line 246:             } else {",
                "// Line 247:                 // Log failed login",
                "// Line 248:                 $rstlog = FroxlorLogger::getInstanceOf([",
                "// Line 249:                     'loginname' => $_SERVER['REMOTE_ADDR']",
                "// Line 250:                 ]);",
                "// vulnerable line: 251: $rstlog->logAction(FroxlorLogger::LOGIN_ACTION, LOG_WARNING, \"Unknown user '\" . $loginname . \"' tried to login.\");",
                "// Line 252: ",
                "// Line 253:                 Response::redirectTo('index.php', [",
                "// Line 254:                     'showmessage' => '2'",
                "// Line 255:                 ]);",
                "// Line 256:                 exit();",
                "// Line 257:             }",
                "// Line 258:         }",
                "// Line 259: ",
                "// Line 260:         $userinfo_stmt = Database::prepare(\"SELECT * FROM $table",
                "// Line 261:             WHERE `loginname`= :loginname\");",
                "// Line 298:                 WHERE `$uid`= :uid\");",
                "// Line 299:             Database::pexecute($stmt, [",
                "// Line 300:                 \"lastlogin_fail\" => time(),",
                "// Line 301:                 \"uid\" => $userinfo[$uid]",
                "// Line 302:             ]);",
                "// Line 303: ",
                "// Line 304:             // Log failed login",
                "// Line 305:             $rstlog = FroxlorLogger::getInstanceOf([",
                "// Line 306:                 'loginname' => $_SERVER['REMOTE_ADDR']",
                "// Line 307:             ]);",
                "// vulnerable line: 308: $rstlog->logAction(FroxlorLogger::LOGIN_ACTION, LOG_WARNING, \"User '\" . $loginname . \"' tried to login with wrong password.\");",
                "// Line 309: ",
                "// Line 310:             unset($userinfo);",
                "// Line 311:             Response::redirectTo('index.php', [",
                "// Line 312:                 'showmessage' => '2'",
                "// Line 313:             ]);",
                "// Line 314:             exit();",
                "// Line 315:         }",
                "// Line 316: ",
                "// Line 317:         // 2FA activated",
                "// Line 318:         if (Settings::Get('2fa.enabled') == '1' && $userinfo['type_2fa'] > 0) {",
                "// Line 619: ",
                "// Line 620:                             $mail->ClearAddresses();",
                "// Line 621:                             Response::redirectTo('index.php', [",
                "// Line 622:                                 'showmessage' => '1'",
                "// Line 623:                             ]);",
                "// Line 624:                             exit();",
                "// Line 625:                         } else {",
                "// Line 626:                             $rstlog = FroxlorLogger::getInstanceOf([",
                "// Line 627:                                 'loginname' => 'password_reset'",
                "// Line 628:                             ]);",
                "// vulnerable line: 629: $rstlog->logAction(FroxlorLogger::USR_ACTION, LOG_WARNING, \"User '\" . $loginname . \"' requested to set a new password, but was not found in database!\");",
                "// Line 630:                             $message = lng('login.usernotfound');",
                "// Line 631:                         }",
                "// Line 632: ",
                "// Line 633:                         unset($user);",
                "// Line 634:                     }",
                "// Line 635:                 }",
                "// Line 636:             } else {",
                "// Line 637:                 $message = lng('pwdreminder.notallowed');",
                "// Line 638:             }",
                "// Line 639:         }"
            ]
        }
    ]
}