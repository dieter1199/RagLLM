{
    "cve_id": "CVE-2024-32461",
    "cve_description": "LibreNMS is an open-source, PHP/MySQL/SNMP-based network monitoring system. A SQL injection vulnerability in POST /search/search=packages in LibreNMS prior to version 24.4.0 allows a user with global read privileges to execute SQL commands via the package parameter. With this vulnerability, an attacker can exploit a SQL injection time based vulnerability to extract all data from the database, such as administrator credentials. Version 24.4.0 contains a patch for the vulnerability.\n",
    "cve_publish_date": "2024-04-22T22:15Z",
    "cwe_id": "NVD-CWE-noinfo",
    "cwe_name": "Insufficient Information",
    "cwe_description": "There is insufficient information about the issue to classify it; details are unkown or unspecified.",
    "commit_message": "Fix SQL injection issues in packages search (#15950)\n\nhttps://github.com/librenms/librenms/security/advisories/GHSA-cwx6-cx7x-4q34",
    "type_of_change": "Modification",
    "changes": [
        {
            "filename_of_changes": "packages.inc.php",
            "code_language": "PHP",
            "number_of_lines_added_for_mitigation": "4",
            "number_of_lines_deleted_vulnerable_to_cve": "4",
            "Code_with_highlighted_vulnerability_lines": [
                "// Line 36:     <div class=\"form-group\">",
                "// Line 37:         <label for=\"version\">Arch</label>",
                "// Line 38:         <input type=\"text\" name=\"arch\" id=\"arch\" size=20 value=\"<?php echo htmlspecialchars($_POST['arch']); ?>\" class=\"form-control input-sm\" placeholder=\"Any\" />",
                "// Line 39:     </div>",
                "// Line 40:     <button type=\"submit\" class=\"btn btn-default input-sm\">Search</button>",
                "// Line 41: </form>",
                "// Line 42: <?php",
                "// Line 43: print_optionbar_end();",
                "// Line 44: ",
                "// Line 45: if (isset($_POST['results_amount']) && $_POST['results_amount'] > 0) {",
                "// vulnerable line: 46: $results = $_POST['results'];",
                "// Line 47: } else {",
                "// Line 48:     $results = 50;",
                "// Line 49: }",
                "// Line 50: ",
                "// Line 51: ?>",
                "// Line 52: <form method=\"post\" action=\"search/search=packages/\" id=\"result_form\">",
                "// Line 53:     <?php echo csrf_field() ?>",
                "// Line 54:     <table class=\"table table-hover table-condensed table-striped\">",
                "// Line 55:         <tr>",
                "// Line 56:             <td colspan=\"3\"><strong>Packages</strong></td>",
                "// Line 63:                         echo ' selected';",
                "// Line 64:                     }",
                "// Line 65:                     echo \">$option</option>\";",
                "// Line 66:                 }",
                "// Line 67:                 ?>",
                "// Line 68:             </select></td>",
                "// Line 69:         </tr>",
                "// Line 70: <?php",
                "// Line 71: ",
                "// Line 72: $count_query = 'SELECT COUNT(*) FROM ( ';",
                "// vulnerable line: 73: $full_query = '';",
                "// Line 74: $query = 'SELECT packages.name FROM packages,devices ';",
                "// Line 75: $param = [];",
                "// Line 76: ",
                "// Line 77: if (! Auth::user()->hasGlobalRead()) {",
                "// Line 78:     $device_ids = Permissions::devicesForUser()->toArray() ?: [0];",
                "// Line 79:     $where .= ' AND `D`.`device_id` IN ' . dbGenPlaceholders(count($device_ids));",
                "// Line 80:     $param = array_merge($param, $device_ids);",
                "// Line 81: }",
                "// Line 82: ",
                "// vulnerable line: 83: $query .= \" WHERE packages.device_id = devices.device_id AND packages.name LIKE '%\" . $_POST['package'] . \"%' $sql_where GROUP BY packages.name\";",
                "// Line 84: ",
                "// Line 85: $where = '';",
                "// Line 86: $ver = '';",
                "// Line 87: $opt = '';",
                "// Line 88: ",
                "// Line 89: if (! empty($_POST['arch'])) {",
                "// Line 90:     $where .= ' AND packages.arch = ?';",
                "// Line 91:     $param[] = $_POST['arch'];",
                "// Line 92: }",
                "// Line 93: ",
                "// Line 100: $query .= $where . ' ORDER BY packages.name, packages.arch, packages.version';",
                "// Line 101: $count = dbFetchCell($count_query, $param);",
                "// Line 102: ",
                "// Line 103: if (! isset($_POST['page_number']) && $_POST['page_number'] < 1) {",
                "// Line 104:     $page_number = 1;",
                "// Line 105: } else {",
                "// Line 106:     $page_number = $_POST['page_number'];",
                "// Line 107: }",
                "// Line 108: ",
                "// Line 109: $start = ($page_number - 1) * $results;",
                "// vulnerable line: 110: $full_query = $full_query . $query . \" LIMIT $start,$results\";",
                "// Line 111: ",
                "// Line 112: ?>",
                "// Line 113:         <tr>",
                "// Line 114:             <th>Package</th>",
                "// Line 115:             <th>Version</th>",
                "// Line 116:             <th>Arch</th>",
                "// Line 117:             <th>Device</th>",
                "// Line 118:         </tr>",
                "// Line 119: <?php",
                "// Line 120: "
            ]
        }
    ]
}