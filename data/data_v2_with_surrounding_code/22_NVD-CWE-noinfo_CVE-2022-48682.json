{
    "cve_id": "CVE-2022-48682",
    "cve_description": "In deletefiles in FDUPES before 2.2.0, a TOCTOU race condition allows arbitrary file deletion via a symlink.",
    "cve_publish_date": "2024-04-26T01:15Z",
    "cwe_id": "NVD-CWE-noinfo",
    "cwe_name": "Insufficient Information",
    "cwe_description": "There is insufficient information about the issue to classify it; details are unkown or unspecified.",
    "commit_message": "Call stat() before deleting any file to ensure it's still the same file.",
    "type_of_change": "Modification",
    "changes": [
        {
            "filename_of_changes": "fdupes.c",
            "code_language": "C",
            "number_of_lines_added_for_mitigation": "7",
            "number_of_lines_deleted_vulnerable_to_cve": "4",
            "Code_with_highlighted_vulnerability_lines": [
                "// Line 1046: ",
                "// Line 1047:       if (file1)",
                "// Line 1048:         fclose(file1);",
                "// Line 1049:     }",
                "// Line 1050:     else",
                "// Line 1051:     {",
                "// Line 1052:       ismatch = 1;",
                "// Line 1053:     }",
                "// Line 1054: ",
                "// Line 1055:     if (ismatch) {",
                "// vulnerable line: 1056: if (remove(dupelist[x]->d_name) == 0) {",
                "// Line 1057:         printf(\"   [-] %s",
                "// Line 1058: \", dupelist[x]->d_name);",
                "// Line 1059: ",
                "// Line 1060:         if (loginfo)",
                "// Line 1061:           log_file_deleted(loginfo, dupelist[x]->d_name);",
                "// Line 1062:       }",
                "// Line 1063:       else {",
                "// Line 1064:         printf(\"   [!] %s \", dupelist[x]->d_name);",
                "// Line 1065:         printf(\"-- unable to delete file!",
                "// Line 1066: \");",
                "// Line 1205:     log_begin_set(loginfo);",
                "// Line 1206: ",
                "// Line 1207:   printf(\"   [+] %s",
                "// Line 1208: \", to_keep->d_name);",
                "// Line 1209: ",
                "// Line 1210:   if (loginfo)",
                "// Line 1211:     log_file_remaining(loginfo, to_keep->d_name);",
                "// Line 1212: ",
                "// Line 1213:   if (matchconfirmed)",
                "// Line 1214:   {",
                "// vulnerable line: 1215: if (remove(to_delete->d_name) == 0) {",
                "// Line 1216:       printf(\"   [-] %s",
                "// Line 1217: \", to_delete->d_name);",
                "// Line 1218: ",
                "// Line 1219:       if (loginfo)",
                "// Line 1220:         log_file_deleted(loginfo, to_delete->d_name);",
                "// Line 1221:     } else {",
                "// Line 1222:       printf(\"   [!] %s \", to_delete->d_name);",
                "// Line 1223:       printf(\"-- unable to delete file!",
                "// Line 1224: \");",
                "// Line 1225: "
            ]
        },
        {
            "filename_of_changes": "ncurses-commands.c",
            "code_language": "C",
            "number_of_lines_added_for_mitigation": "2",
            "number_of_lines_deleted_vulnerable_to_cve": "1",
            "Code_with_highlighted_vulnerability_lines": [
                "// Line 773:               fclose(file2);",
                "// Line 774: ",
                "// Line 775:             if (file1)",
                "// Line 776:               fclose(file1);",
                "// Line 777:           }",
                "// Line 778:           else",
                "// Line 779:           {",
                "// Line 780:             ismatch = 1;",
                "// Line 781:           }",
                "// Line 782: ",
                "// vulnerable line: 783: if (ismatch && remove(groups[g].files[f].file->d_name) == 0)",
                "// Line 784:           {",
                "// Line 785:             set_file_action(&groups[g].files[f], FILEACTION_DELIST, deletiontally);",
                "// Line 786: ",
                "// Line 787:             deletedbytes += groups[g].files[f].file->size;",
                "// Line 788:             ++totaldeleted;",
                "// Line 789: ",
                "// Line 790:             if (loginfo)",
                "// Line 791:               log_file_deleted(loginfo, groups[g].files[f].file->d_name);",
                "// Line 792:           }",
                "// Line 793:           else"
            ]
        }
    ]
}