{
    "cve_id": "CVE-2024-24474",
    "cve_description": "QEMU before 8.2.0 has an integer underflow, and resultant buffer overflow, via a TI command when an expected non-DMA transfer length is less than the length of the available FIFO data. This occurs in esp_do_nodma in hw/scsi/esp.c because of an underflow of async_len.",
    "cve_publish_date": "2024-02-20",
    "cwe_id": "NVD-CWE-noinfo",
    "commit_message": "esp: restrict non-DMA transfer length to that of available data\n\nIn the case where a SCSI layer transfer is incorrectly terminated, it is\npossible for a TI command to cause a SCSI buffer overflow due to the\nexpected transfer data length being less than the available data in the\nFIFO. When this occurs the unsigned async_len variable underflows and\nbecomes a large offset which writes past the end of the allocated SCSI\nbuffer.\n\nRestrict the non-DMA transfer length to be the smallest of the expected\ntransfer length and the available FIFO data to ensure that it is no longer\npossible for the SCSI buffer overflow to occur.\n\nSigned-off-by: Mark Cave-Ayland <mark.cave-ayland@ilande.co.uk>\nResolves: https://gitlab.com/qemu-project/qemu/-/issues/1810\nReviewed-by: Thomas Huth <thuth@redhat.com>\nMessage-ID: <20230913204410.65650-3-mark.cave-ayland@ilande.co.uk>\nSigned-off-by: Paolo Bonzini <pbonzini@redhat.com>",
    "type_of_change": "Modification",
    "filename_of_changes": "esp.c",
    "code_language": "C",
    "number_of_lines_added_for_mitigation": "2",
    "number_of_lines_deleted_vulnerable_to_cve": "1",
    "vulnerable_lines": [
        "// Line_Reference 762:         len = MIN(fifo8_num_used(&s->fifo), ESP_FIFO_SZ);"
    ]
}