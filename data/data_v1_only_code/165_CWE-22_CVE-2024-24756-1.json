{
    "cve_id": "CVE-2024-24756",
    "cve_description": "Crafatar serves Minecraft avatars based on the skin for use in external applications. Files outside of the `lib/public/` directory can be requested from the server. Instances running behind Cloudflare (including crafatar.com) are not affected. Instances using the Docker container as shown in the README are affected, but only files within the container can be read. By default, all of the files within the container can also be found in this repository and are not confidential. This vulnerability is patched in 2.1.5.",
    "cve_publish_date": "2024-02-01",
    "cwe_id": "CWE-22",
    "cwe_name": "Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal')",
    "cwe_description": "The product uses external input to construct a pathname that is intended to identify a file or directory that is located underneath a restricted parent directory, but the product does not properly neutralize special elements within the pathname that can cause the pathname to resolve to a location that is outside of the restricted directory.",
    "commit_message": "improve URL parsing\n\nuses `new URL()` and `decodeURI()` instead of `url.parse()`\nalso checks that the requested file is in a subdirectory of `public/` before serving the file\n\nfixes path traversal vulnerability GHSA-5cxq-25mp-q5f2",
    "type_of_change": "Modification",
    "filename_of_changes": "avatars.js",
    "code_language": "JavaScript",
    "number_of_lines_added_for_mitigation": "7",
    "number_of_lines_deleted_vulnerable_to_cve": "9",
    "vulnerable_lines": [
        "// Line_Reference 17:       var parsed = req.url;",
        "// Line_Reference 18:       delete parsed.query.default;",
        "// Line_Reference 19:       delete parsed.search;",
        "// Line_Reference 20:       parsed.path_list[1] = def;",
        "// Line_Reference 21:       parsed.pathname = \"/\" + parsed.path_list.join(\"/\");",
        "// Line_Reference 22:       var newUrl = url.format(parsed);",
        "// Line_Reference 56:   var size = parseInt(req.url.query.size) || config.avatars.default_size;",
        "// Line_Reference 57:   var def = req.url.query.default;",
        "// Line_Reference 58:   var overlay = Object.prototype.hasOwnProperty.call(req.url.query, \"overlay\") || Object.prototype.hasOwnProperty.call(req.url.query, \"helm\");"
    ]
}