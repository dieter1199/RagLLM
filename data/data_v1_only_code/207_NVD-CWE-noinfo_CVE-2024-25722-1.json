{
    "cve_id": "CVE-2024-25722",
    "cve_description": "qanything_kernel/connector/database/mysql/mysql_client.py in qanything.ai QAnything before 1.2.0 allows SQL Injection.",
    "cve_publish_date": "2024-02-11",
    "cwe_id": "NVD-CWE-noinfo",
    "commit_message": "fix: Prevent SQL injection attacks.",
    "type_of_change": "Modification",
    "filename_of_changes": "mysql_client.py",
    "code_language": "Python",
    "number_of_lines_added_for_mitigation": "28",
    "number_of_lines_deleted_vulnerable_to_cve": "21",
    "vulnerable_lines": [
        "// Line_Reference 134:         kb_ids_str = ','.join(\"'{}'\".format(str(x)) for x in kb_ids)",
        "// Line_Reference 135:         query = \"SELECT kb_id FROM KnowledgeBase WHERE kb_id IN ({}) AND deleted = 0 AND user_id = %s\".format(kb_ids_str)",
        "// Line_Reference 136:         result = self.execute_query_(query, (user_id,), fetch=True)",
        "// Line_Reference 166: ",
        "// Line_Reference 173:             batch_file_names = file_names[i:i+batch_size]",
        "// Line_Reference 174:             file_names_str = ','.join(\"'{}'\".format(str(x).replace(\"'\", \"\\\\'\")) for x in batch_file_names)",
        "// Line_Reference 181:             \"\"\".format(file_names_str)",
        "// Line_Reference 182: ",
        "// Line_Reference 183:             # 这里假设 execute_query_ 是一个可以执行SQL查询并提交或获取结果的方法",
        "// Line_Reference 184:             batch_result = self.execute_query_(query, (kb_id, user_id), fetch=True)",
        "// Line_Reference 185:             debug_logger.info(\"check_file_exist_by_name batch {}: {}\".format(i//batch_size, batch_result))",
        "// Line_Reference 214:         kb_ids_str = ','.join(\"'{}'\".format(str(x)) for x in kb_ids)",
        "// Line_Reference 215:         query = \"SELECT user_id, kb_id, kb_name FROM KnowledgeBase WHERE kb_id IN ({}) AND deleted = 0\".format(kb_ids_str)",
        "// Line_Reference 216:         return self.execute_query_(query, (), fetch=True)",
        "// Line_Reference 220:         # 删除知识库",
        "// Line_Reference 221:         kb_ids_str = ','.join(\"'{}'\".format(str(x)) for x in kb_ids)",
        "// Line_Reference 222:         query = \"UPDATE KnowledgeBase SET deleted = 1 WHERE user_id = %s AND kb_id IN ({})\".format(kb_ids_str)",
        "// Line_Reference 223:         self.execute_query_(query, (user_id,), commit=True)",
        "// Line_Reference 224:         # 删除知识库下面的文件",
        "// Line_Reference 225:         query = \"\"\"UPDATE File SET deleted = 1 WHERE kb_id IN ({}) AND kb_id IN (SELECT kb_id FROM KnowledgeBase WHERE user_id = %s)\"\"\".format(kb_ids_str)",
        "// Line_Reference 226:         self.execute_query_(query, (user_id,), commit=True)"
    ]
}