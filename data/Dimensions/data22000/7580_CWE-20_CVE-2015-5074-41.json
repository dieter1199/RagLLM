{
    "cve_id": "CVE-2015-5074",
    "cve_description": "Incomplete blacklist vulnerability in the FileUploadsFilter class in protected/components/filters/FileUploadsFilter.php in X2Engine X2CRM before 5.0.9 allows remote authenticated users to execute arbitrary PHP code by uploading a file with a .pht extension.",
    "cve_publish_date": "2015-09-29",
    "cwe_id": "CWE-20",
    "cwe_name": "Improper Input Validation",
    "cwe_description": "The product receives input or data, but it does\n        not validate or incorrectly validates that the input has the\n        properties that are required to process the data safely and\n        correctly.",
    "commit_message": "Release v5.0.9; see CHANGELOG for details.",
    "type_of_change": "Modification",
    "filename_of_changes": "SiteController.php",
    "code_language": "PHP",
    "number_of_lines_added_for_mitigation": "12",
    "number_of_lines_deleted_vulnerable_to_cve": "46",
    "vulnerable_lines": [
        "// Line_Reference 1596:             echo $model->addTags($_POST['Tag']);",
        "// Line_Reference 1597:             exit;",
        "// Line_Reference 1598:             if ($model !== null && $model->addTags($_POST['Tag'])) {",
        "// Line_Reference 1599:                 echo 'true';",
        "// Line_Reference 1600:                 return;",
        "// Line_Reference 1949:      *  Remove a widget from the page and put it in the widgets menu",
        "// Line_Reference 1952:         if (isset($_POST['name'])) {",
        "// Line_Reference 1957:             // the widget could be in any of the blocks in the page, so check all of them",
        "// Line_Reference 1958:             foreach ($layout as $b => &$block) {",
        "// Line_Reference 1959:                 if (isset($block[$name])) {",
        "// Line_Reference 1960:                     if ($b == 'right') {",
        "// Line_Reference 1961:                         $layout['hiddenRight'][$name] = $block[$name];",
        "// Line_Reference 1962:                     } else {",
        "// Line_Reference 1963:                         $layout['hidden'][$name] = $block[$name];",
        "// Line_Reference 1964:                     }",
        "// Line_Reference 1965:                     unset($block[$name]);",
        "// Line_Reference 1966:                     Yii::app()->params->profile->saveLayout($layout);",
        "// Line_Reference 1967:                     break;",
        "// Line_Reference 1968:                 }",
        "// Line_Reference 1969:             }",
        "// Line_Reference 1970: ",
        "// Line_Reference 1971:             // make a list of hidden widgets, using <li>, to send back to the browser",
        "// Line_Reference 1972:             $list = \"\";",
        "// Line_Reference 1973:             foreach ($layout['hidden'] as $name => $widget) {",
        "// Line_Reference 1974:                 $list .= \"<li><span class=\\\"x2-widget-menu-item\\\" id=\\\"$name\\\">{$widget['title']}</span></li>\";",
        "// Line_Reference 1975:             }",
        "// Line_Reference 1976:             foreach ($layout['hiddenRight'] as $name => $widget) {",
        "// Line_Reference 1977:                 $list .= \"<li><span class=\\\"x2-widget-menu-item right\\\" id=\\\"$name\\\">{$widget['title']}</span></li>\";",
        "// Line_Reference 2016:             } else {",
        "// Line_Reference 2017: ",
        "// Line_Reference 2018:                 foreach ($layout['hidden'] as $key => $widget) {",
        "// Line_Reference 2019:                     if ($key == $name) {",
        "// Line_Reference 2020:                         $widget['minimize'] = false; // un-minimize widgets when we show them",
        "// Line_Reference 2021:                         $layout[$block][$key] = $widget;",
        "// Line_Reference 2022:                         unset($layout['hidden'][$key]);",
        "// Line_Reference 2023:                         Yii::app()->params->profile->saveLayout($layout);",
        "// Line_Reference 2024:                         Yii::app()->clientScript->scriptMap['*.js'] = false;",
        "// Line_Reference 2025:                         $this->renderPartial('application.components.views.centerWidget', array(",
        "// Line_Reference 2026:                             'widget' => $widget,",
        "// Line_Reference 2027:                             'name' => $name,",
        "// Line_Reference 2028:                             'modelType' => $modelType,",
        "// Line_Reference 2029:                             'moduleName' => $moduleName,",
        "// Line_Reference 2030:                             'modelId' => $modelId), false, true);",
        "// Line_Reference 2031:                         break;",
        "// Line_Reference 2032:                     }",
        "// Line_Reference 2033:                 }"
    ]
}
