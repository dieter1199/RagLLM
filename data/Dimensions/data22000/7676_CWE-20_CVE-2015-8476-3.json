{
    "cve_id": "CVE-2015-8476",
    "cve_description": "Multiple CRLF injection vulnerabilities in PHPMailer before 5.2.14 allow attackers to inject arbitrary SMTP commands via CRLF sequences in an (1) email address to the validateAddress function in class.phpmailer.php or (2) SMTP command to the sendCommand function in class.smtp.php, a different vulnerability than CVE-2012-0796.",
    "cve_publish_date": "2015-12-16",
    "cwe_id": "CWE-20",
    "cwe_name": "Improper Input Validation",
    "cwe_description": "The product receives input or data, but it does\n        not validate or incorrectly validates that the input has the\n        properties that are required to process the data safely and\n        correctly.",
    "commit_message": "Add test for line breaks in addresses vulnerability\nDon't allow line breaks in addresses\nDon't allow line breaks in SMTP commands\nRearrange tests so slowest tests run last",
    "type_of_change": "Modification",
    "filename_of_changes": "phpmailerTest.php",
    "code_language": "PHP",
    "number_of_lines_added_for_mitigation": "75",
    "number_of_lines_deleted_vulnerable_to_cve": "69",
    "vulnerable_lines": [
        "// Line_Reference 364:             '\"Fred Bloggs\"@iana.org',",
        "// Line_Reference 470:             'test@example.com',",
        "// Line_Reference 1828: ",
        "// Line_Reference 1829:     /**",
        "// Line_Reference 1830:      * Use a fake POP3 server to test POP-before-SMTP auth.",
        "// Line_Reference 1831:      * With a known-good login",
        "// Line_Reference 1832:      */",
        "// Line_Reference 1833:     public function testPopBeforeSmtpGood()",
        "// Line_Reference 1834:     {",
        "// Line_Reference 1835:         //Start a fake POP server",
        "// Line_Reference 1836:         $pid = shell_exec('nohup ./runfakepopserver.sh >/dev/null 2>/dev/null & printf \"%u\" $!');",
        "// Line_Reference 1837:         $this->pids[] = $pid;",
        "// Line_Reference 1838: ",
        "// Line_Reference 1839:         sleep(2);",
        "// Line_Reference 1840:         //Test a known-good login",
        "// Line_Reference 1841:         $this->assertTrue(",
        "// Line_Reference 1842:             POP3::popBeforeSmtp('localhost', 1100, 10, 'user', 'test', $this->Mail->SMTPDebug),",
        "// Line_Reference 1843:             'POP before SMTP failed'",
        "// Line_Reference 1844:         );",
        "// Line_Reference 1845:         //Kill the fake server",
        "// Line_Reference 1846:         shell_exec('kill -TERM '.escapeshellarg($pid));",
        "// Line_Reference 1847:         sleep(2);",
        "// Line_Reference 1848:     }",
        "// Line_Reference 1849: ",
        "// Line_Reference 1850:     /**",
        "// Line_Reference 1851:      * Use a fake POP3 server to test POP-before-SMTP auth.",
        "// Line_Reference 1852:      * With a known-bad login",
        "// Line_Reference 1853:      */",
        "// Line_Reference 1854:     public function testPopBeforeSmtpBad()",
        "// Line_Reference 1855:     {",
        "// Line_Reference 1856:         //Start a fake POP server on a different port",
        "// Line_Reference 1857:         //so we don't inadvertently connect to the previous instance",
        "// Line_Reference 1858:         $pid = shell_exec('nohup ./runfakepopserver.sh 1101 >/dev/null 2>/dev/null & printf \"%u\" $!');",
        "// Line_Reference 1859:         $this->pids[] = $pid;",
        "// Line_Reference 1860: ",
        "// Line_Reference 1861:         sleep(2);",
        "// Line_Reference 1862:         //Test a known-bad login",
        "// Line_Reference 1863:         $this->assertFalse(",
        "// Line_Reference 1864:             POP3::popBeforeSmtp('localhost', 1101, 10, 'user', 'xxx', $this->Mail->SMTPDebug),",
        "// Line_Reference 1865:             'POP before SMTP should have failed'",
        "// Line_Reference 1866:         );",
        "// Line_Reference 1867:         shell_exec('kill -TERM '.escapeshellarg($pid));",
        "// Line_Reference 1868:         sleep(2);",
        "// Line_Reference 1869:     }",
        "// Line_Reference 1870: ",
        "// Line_Reference 1871:     /**",
        "// Line_Reference 1872:      * Test SMTP host connections.",
        "// Line_Reference 1873:      * This test can take a long time, so run it last",
        "// Line_Reference 1874:      */",
        "// Line_Reference 1875:     public function testSmtpConnect()",
        "// Line_Reference 1877:         $this->Mail->SMTPDebug = 4; //Show connection-level errors",
        "// Line_Reference 1878:         $this->assertTrue($this->Mail->smtpConnect(), 'SMTP single connect failed');",
        "// Line_Reference 1879:         $this->Mail->smtpClose();",
        "// Line_Reference 1880:         $this->Mail->Host = \"ssl://localhost:12345;tls://localhost:587;10.10.10.10:54321;localhost:12345;10.10.10.10\";",
        "// Line_Reference 1881:         $this->assertFalse($this->Mail->smtpConnect(), 'SMTP bad multi-connect succeeded');",
        "// Line_Reference 1882:         $this->Mail->smtpClose();",
        "// Line_Reference 1883:         $this->Mail->Host = \"localhost:12345;10.10.10.10:54321;\" . $_REQUEST['mail_host'];",
        "// Line_Reference 1884:         $this->assertTrue($this->Mail->smtpConnect(), 'SMTP multi-connect failed');",
        "// Line_Reference 1885:         $this->Mail->smtpClose();",
        "// Line_Reference 1886:         $this->Mail->Host = \" localhost:12345 ; \" . $_REQUEST['mail_host'] . ' ';",
        "// Line_Reference 1887:         $this->assertTrue($this->Mail->smtpConnect(), 'SMTP hosts with stray spaces failed');",
        "// Line_Reference 1888:         $this->Mail->smtpClose();",
        "// Line_Reference 1889:         $this->Mail->Host = $_REQUEST['mail_host'];",
        "// Line_Reference 1890:         //Need to pick a harmless option so as not cause problems of its own! socket:bind doesn't work with Travis-CI",
        "// Line_Reference 1891:         $this->assertTrue(",
        "// Line_Reference 1892:             $this->Mail->smtpConnect(array('ssl' => array('verify_depth' => 10))),",
        "// Line_Reference 1893:             'SMTP connect with options failed'",
        "// Line_Reference 1894:         );",
        "// Line_Reference 2049:  * These values can also be set using a file called testbootstrap.php (not in svn) in the same folder as this script"
    ]
}
