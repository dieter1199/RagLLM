{
    "cve_id": "CVE-2015-4410",
    "cve_description": "The Moped::BSON::ObjecId.legal? method in rubygem-moped before commit dd5a7c14b5d2e466f7875d079af71ad19774609b allows remote attackers to cause a denial of service (worker resource consumption) or perform a cross-site scripting (XSS) attack via a crafted string.",
    "cve_publish_date": "2020-02-20",
    "cwe_id": "CWE-20",
    "cwe_name": "Improper Input Validation",
    "cwe_description": "The product receives input or data, but it does\n        not validate or incorrectly validates that the input has the\n        properties that are required to process the data safely and\n        correctly.",
    "commit_message": "Merge Replica Set Refactor\n\n* Removes Server, and Socket; replaced with Node, and Connection.\n\n  Replica sets are now much more robustly supported, including failover\n  and discovery.\n\n* Refactors specs.\n\n  Internal APIs are now tested with integration specs through the public\n  APIs.\n\n* More documentation.",
    "type_of_change": "Modification",
    "filename_of_changes": "object_id.rb",
    "code_language": "Ruby",
    "number_of_lines_added_for_mitigation": "31",
    "number_of_lines_deleted_vulnerable_to_cve": "51",
    "vulnerable_lines": [
        "// Line_Reference 11:       attr_reader :data",
        "// Line_Reference 12: ",
        "// Line_Reference 16:           data = []",
        "// Line_Reference 18:           new data",
        "// Line_Reference 22:           !!str.match(/^[0-9a-f]{24}$/i)",
        "// Line_Reference 24:       end",
        "// Line_Reference 26:       def initialize(data = nil, time = nil)",
        "// Line_Reference 27:         if data",
        "// Line_Reference 28:           @data = data",
        "// Line_Reference 29:         elsif time",
        "// Line_Reference 30:           @data = @@generator.generate(time.to_i)",
        "// Line_Reference 31:         else",
        "// Line_Reference 32:           @data = @@generator.next",
        "// Line_Reference 46:         @@string_format % data",
        "// Line_Reference 53:         Time.at(@data.pack(\"C4\").unpack(\"N\")[0]).utc",
        "// Line_Reference 58:           new io.read(12).unpack('C*')",
        "// Line_Reference 60: ",
        "// Line_Reference 67:         io << data.pack('C12')",
        "// Line_Reference 75:           @machine_id = Digest::MD5.digest(Socket.gethostname).unpack(\"C3\")",
        "// Line_Reference 78:           @last_timestamp = nil",
        "// Line_Reference 82:         # Return object id data based on the current time, incrementing a",
        "// Line_Reference 83:         # counter for object ids generated in the same second.",
        "// Line_Reference 85:           now = Time.new.to_i",
        "// Line_Reference 86: ",
        "// Line_Reference 87:           counter = @mutex.synchronize do",
        "// Line_Reference 88:             last_timestamp, @last_timestamp = @last_timestamp, now",
        "// Line_Reference 89: ",
        "// Line_Reference 90:             if last_timestamp == now",
        "// Line_Reference 91:               @counter += 1",
        "// Line_Reference 92:             else",
        "// Line_Reference 93:               @counter = 0",
        "// Line_Reference 94:             end",
        "// Line_Reference 97:           generate(now, counter)",
        "// Line_Reference 100:         # Generate object id data for a given time using the provided +inc+.",
        "// Line_Reference 101:         def generate(time, inc = 0)",
        "// Line_Reference 102:           pid = Process.pid % 0xFFFF",
        "// Line_Reference 103: ",
        "// Line_Reference 104:           [",
        "// Line_Reference 105:             time >> 24 & 0xFF, # 4 bytes time (network order)",
        "// Line_Reference 106:             time >> 16 & 0xFF,",
        "// Line_Reference 107:             time >> 8  & 0xFF,",
        "// Line_Reference 108:             time       & 0xFF,",
        "// Line_Reference 109:             @machine_id[0],   # 3 bytes machine",
        "// Line_Reference 110:             @machine_id[1],",
        "// Line_Reference 111:             @machine_id[2],",
        "// Line_Reference 112:             pid  >> 8  & 0xFF, # 2 bytes process id",
        "// Line_Reference 113:             pid        & 0xFF,",
        "// Line_Reference 114:             inc  >> 16 & 0xFF, # 3 bytes increment",
        "// Line_Reference 115:             inc  >> 8  & 0xFF,",
        "// Line_Reference 116:             inc        & 0xFF,",
        "// Line_Reference 117:           ]"
    ]
}
