{
    "cve_id": "CVE-2023-2034",
    "cve_description": "Unrestricted Upload of File with Dangerous Type in GitHub repository froxlor/froxlor prior to 2.0.14.",
    "cve_publish_date": "2023-04-14",
    "cwe_id": "CWE-434",
    "cwe_name": "Unrestricted Upload of File with Dangerous Type",
    "cwe_description": "The product allows the upload or transfer of dangerous file types that are automatically processed within its environment.",
    "commit_message": "better validation for uploaded/imported image files\n\nSigned-off-by: Michael Kaufmann <d00p@froxlor.org>",
    "type_of_change": "Modification",
    "filename_of_changes": "SImExporter.php",
    "code_language": "PHP",
    "number_of_lines_added_for_mitigation": "24",
    "number_of_lines_deleted_vulnerable_to_cve": "35",
    "vulnerable_lines": [
        "// Line_Reference 193: \t\t\t\t\t\t$img_data = base64_decode($value);",
        "// Line_Reference 194: \t\t\t\t\t\t$img_filename = Froxlor::getInstallDir() . '/' . str_replace('../', '',",
        "// Line_Reference 195: \t\t\t\t\t\t\t\texplode('?', $_data[$index_split[0] . '.' . $index_split[1]], 2)[0]);",
        "// Line_Reference 196: ",
        "// Line_Reference 197: \t\t\t\t\t\tfile_put_contents($img_filename, $img_data);",
        "// Line_Reference 198: ",
        "// Line_Reference 199: \t\t\t\t\t\tif (function_exists('finfo_open')) {",
        "// Line_Reference 200: \t\t\t\t\t\t\t$finfo = finfo_open(FILEINFO_MIME_TYPE);",
        "// Line_Reference 201: \t\t\t\t\t\t\t$mimetype = finfo_file($finfo, $img_filename);",
        "// Line_Reference 202: \t\t\t\t\t\t\tfinfo_close($finfo);",
        "// Line_Reference 203: \t\t\t\t\t\t} else {",
        "// Line_Reference 204: \t\t\t\t\t\t\t$mimetype = mime_content_type($img_filename);",
        "// Line_Reference 205: \t\t\t\t\t\t}",
        "// Line_Reference 206: \t\t\t\t\t\tif (empty($mimetype)) {",
        "// Line_Reference 207: \t\t\t\t\t\t\t$mimetype = 'application/octet-stream';",
        "// Line_Reference 208: \t\t\t\t\t\t}",
        "// Line_Reference 209: \t\t\t\t\t\tif (!in_array($mimetype, ['image/jpeg', 'image/jpg', 'image/png', 'image/gif'])) {",
        "// Line_Reference 210: \t\t\t\t\t\t\t@unlink($img_filename);",
        "// Line_Reference 211: \t\t\t\t\t\t\tthrow new Exception(\"Uploaded file is not a valid image\");",
        "// Line_Reference 212: \t\t\t\t\t\t}",
        "// Line_Reference 213: ",
        "// Line_Reference 214: \t\t\t\t\t\t$spl = explode('.', $img_filename);",
        "// Line_Reference 215: \t\t\t\t\t\t$file_extension = strtolower(array_pop($spl));",
        "// Line_Reference 216: \t\t\t\t\t\tunset($spl);",
        "// Line_Reference 217: ",
        "// Line_Reference 218: \t\t\t\t\t\tif (!in_array($file_extension, [",
        "// Line_Reference 219: \t\t\t\t\t\t\t'jpeg',",
        "// Line_Reference 220: \t\t\t\t\t\t\t'jpg',",
        "// Line_Reference 221: \t\t\t\t\t\t\t'png',",
        "// Line_Reference 222: \t\t\t\t\t\t\t'gif'",
        "// Line_Reference 223: \t\t\t\t\t\t])) {",
        "// Line_Reference 224: \t\t\t\t\t\t\t@unlink($img_filename);",
        "// Line_Reference 225: \t\t\t\t\t\t\tthrow new Exception(\"Invalid file-extension, use one of: jpeg, jpg, png, gif\");",
        "// Line_Reference 227: ",
        "// Line_Reference 228: \t\t\t\t\t\tSettings::Set($index, $value);"
    ]
}
