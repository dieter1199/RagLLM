{
    "cve_id": "CVE-2020-26210",
    "cve_description": "In BookStack before version 0.30.4, a user with permissions to edit a page could add an attached link which would execute untrusted JavaScript code when clicked by a viewer of the page. Dangerous content may remain in the database after this update. If you think this could have been exploited the linked advisory provides a SQL query to test. As a workaround, page edit permissions could be limited to only those that are trusted until you can upgrade although this will not address existing exploitation of this vulnerability. The issue is fixed in version 0.30.4.",
    "cve_publish_date": "2020-11-03",
    "cwe_id": "CWE-79",
    "cwe_name": "Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting')",
    "cwe_description": "The product does not neutralize or incorrectly neutralizes user-controllable input before it is placed in output that is used as a web page that is served to other users.",
    "commit_message": "Prevented possible XSS via link attachments\n\nThis filters out potentially malicious javascript: or data: uri's coming\nthrough to be attached to attachments.\nAdded tests to cover.\n\nThanks to Yassine ABOUKIR (@yassineaboukir on twitter) for reporting this\nvulnerability.",
    "type_of_change": "Modification",
    "filename_of_changes": "AttachmentTest.php",
    "code_language": "PHP",
    "number_of_lines_added_for_mitigation": "65",
    "number_of_lines_deleted_vulnerable_to_cve": "19",
    "vulnerable_lines": [
        "// Line_Reference 12:      * @param $fileName",
        "// Line_Reference 13:      * @return \\Illuminate\\Http\\UploadedFile",
        "// Line_Reference 15:     protected function getTestFile($fileName)",
        "// Line_Reference 17:         return new \\Illuminate\\Http\\UploadedFile(base_path('tests/test-data/test-file.txt'), $fileName, 'text/plain', 55, null, true);",
        "// Line_Reference 22:      * @param $name",
        "// Line_Reference 23:      * @param int $uploadedTo",
        "// Line_Reference 24:      * @return \\Illuminate\\Foundation\\Testing\\TestResponse",
        "// Line_Reference 26:     protected function uploadFile($name, $uploadedTo = 0)",
        "// Line_Reference 38:         $fileService = $this->app->make(\\BookStack\\Uploads\\AttachmentService::class);",
        "// Line_Reference 148:         $this->call('POST', 'attachments/link', [",
        "// Line_Reference 149:             'attachment_link_url' => 'https://example.com',",
        "// Line_Reference 150:             'attachment_link_name' => 'Example Attachment Link',",
        "// Line_Reference 151:             'attachment_link_uploaded_to' => $page->id,",
        "// Line_Reference 152:         ]);",
        "// Line_Reference 153: ",
        "// Line_Reference 154:         $attachmentId = Attachment::first()->id;",
        "// Line_Reference 155: ",
        "// Line_Reference 156:         $update = $this->call('PUT', 'attachments/' . $attachmentId, [",
        "// Line_Reference 162:             'id' => $attachmentId,"
    ]
}
