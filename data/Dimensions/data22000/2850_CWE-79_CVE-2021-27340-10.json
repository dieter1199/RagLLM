{
    "cve_id": "CVE-2021-27340",
    "cve_description": "OpenSIS Community Edition version <= 7.6 is affected by a reflected XSS vulnerability in EmailCheck.php via the \"opt\" parameter.",
    "cve_publish_date": "2021-09-16",
    "cwe_id": "CWE-79",
    "cwe_name": "Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting')",
    "cwe_description": "The product does not neutralize or incorrectly neutralizes user-controllable input before it is placed in output that is used as a web page that is served to other users.",
    "commit_message": "Commit with security and bug fixes",
    "type_of_change": "ModificationType.ADD",
    "filename_of_changes": "Configuration.php",
    "code_language": "PHP",
    "number_of_lines_added_for_mitigation": "92",
    "number_of_lines_deleted_vulnerable_to_cve": "72",
    "vulnerable_lines": [
        "// Line_Reference 99:     $sem_total += $sem_val;",
        "// Line_Reference 120:     } else {",
        "// Line_Reference 121:         echo '<div class=\"alert alert-danger alert-styled-left alert-bordered\">' . _totalMustBe . ' <span class=\"text-bold\">100%</span>!</div>';",
        "// Line_Reference 146: echo '<h5 class=\"text-primary\">' . _general . '</h5>';",
        "// Line_Reference 150: echo '<h6><b>' . _scoreRounding . '</b></h6>';",
        "// Line_Reference 152: echo '<label class=\"radio-inline\"><INPUT type=radio name=values[ROUNDING] value=UP' . (($programconfig['ROUNDING'] == 'UP') ? ' CHECKED' : '') . '>' . _up . '</label>';",
        "// Line_Reference 153: echo '<label class=\"radio-inline\"><INPUT type=radio name=values[ROUNDING] value=DOWN' . (($programconfig['ROUNDING'] == 'DOWN') ? ' CHECKED' : '') . '>' . _down . '</label>';",
        "// Line_Reference 154: echo '<label class=\"radio-inline\"><INPUT type=radio name=values[ROUNDING] value=NORMAL' . (($programconfig['ROUNDING'] == 'NORMAL') ? ' CHECKED' : '') . '>' . _normal . '</label>';",
        "// Line_Reference 155: echo '<label class=\"radio-inline\"><INPUT type=radio name=values[ROUNDING] value=\\'\\'' . (($programconfig['ROUNDING'] == '') ? ' CHECKED' : '') . '>' . _none . '</label>';",
        "// Line_Reference 161: echo '<h6><b>' . _assignmentSorting . '</b></h6>';",
        "// Line_Reference 163: echo '<label class=\"radio-inline\"><input type=radio name=values[ASSIGNMENT_SORTING] value=ASSIGNMENT_ID' . (($programconfig['ASSIGNMENT_SORTING'] == 'ASSIGNMENT_ID') ? ' CHECKED' : '') . '>' . _newestFirst . '</label>';",
        "// Line_Reference 164: echo '<label class=\"radio-inline\"><INPUT type=radio name=values[ASSIGNMENT_SORTING] value=DUE_DATE' . (($programconfig['ASSIGNMENT_SORTING'] == 'DUE_DATE') ? ' CHECKED' : '') . '>' . _dueDate . '</label>';",
        "// Line_Reference 165: echo '<label class=\"radio-inline\"><INPUT type=radio name=values[ASSIGNMENT_SORTING] value=ASSIGNED_DATE' . (($programconfig['ASSIGNMENT_SORTING'] == 'ASSIGNED_DATE') ? ' CHECKED' : '') . '>' . _assignedDate . '</label>';",
        "// Line_Reference 166: echo '<label class=\"radio-inline\"><INPUT type=radio name=values[ASSIGNMENT_SORTING] value=UNGRADED' . (($programconfig['ASSIGNMENT_SORTING'] == 'UNGRADED') ? ' CHECKED' : '') . '>' . _ungraded . '</label>';",
        "// Line_Reference 170: echo '<label class=\"checkbox-inline\"><INPUT type=checkbox name=values[WEIGHT] value=Y' . (($programconfig['WEIGHT'] == 'Y') ? ' CHECKED' : '') . '>' . _weightGrades . '</label>';",
        "// Line_Reference 171: echo '<label class=\"checkbox-inline\"><INPUT type=checkbox name=values[DEFAULT_ASSIGNED] value=Y' . (($programconfig['DEFAULT_ASSIGNED'] == 'Y') ? ' CHECKED' : '') . '>' . _assignedDateDefaultsToToday . '</label>';",
        "// Line_Reference 174: echo '<label class=\"checkbox-inline\"><INPUT type=checkbox name=values[DEFAULT_DUE] value=Y' . (($programconfig['DEFAULT_DUE'] == 'Y') ? ' CHECKED' : '') . '>' . _dueDateDefaultsToToday . '</label>';",
        "// Line_Reference 175: echo '<label class=\"checkbox-inline\"><INPUT type=checkbox name=values[ELIGIBILITY_CUMULITIVE] value=Y' . (($programconfig['ELIGIBILITY_CUMULITIVE'] == 'Y') ? ' CHECKED' : '') . '>' . _calulateExtracurricularUsingCumulativeSemesterGrades . '</label>';",
        "// Line_Reference 182: echo '<div class=\"col-md-2\"><INPUT class=\"form-control\" type=text name=values[ANOMALOUS_MAX] value=\"' . ($programconfig['ANOMALOUS_MAX'] != '' ? $programconfig['ANOMALOUS_MAX'] : '100') . '\" size=3 maxlength=3></div><label class=\"col-md-10 control-label\">% ' . _allowedMaximumPercentInAnomalousGrades . '</label>';",
        "// Line_Reference 186: echo '<div class=\"col-md-2\"><INPUT class=\"form-control\" type=text name=values[LATENCY] value=\"' . round($programconfig['LATENCY']) . '\" size=3 maxlength=3></div><label class=\"col-md-10 control-label\">' . _daysUntilUngradedAssignmentGradeAppearsInParentStudentGradebookViews . '</label>';",
        "// Line_Reference 195:     echo '</SELECT></div><label class=\"col-md-10 control-label\">' . _defaultCommentCode . '</label>';",
        "// Line_Reference 205:     echo '<legend><b>' . _scoreBreakoffPoints . '</b></legend>';",
        "// Line_Reference 228: if ($quarters) {",
        "// Line_Reference 230: } else {",
        "// Line_Reference 235: if ($semesters) {",
        "// Line_Reference 237: } else {",
        "// Line_Reference 245: echo '<h5 class=\"text-primary\">' . _finalGradingPercentages . '</h5>';",
        "// Line_Reference 259:                 $table .= '<TD>' . $qtrs['TITLE'] . ' ' . _exam . '</TD>';",
        "// Line_Reference 264:             $table .= '<TD><INPUT class=\"form-control\" type=text name=values[Q-' . $qtrs['MARKING_PERIOD_ID'] . '] value=\"' . $programconfig['Q-' . $qtrs['MARKING_PERIOD_ID']] . '\" class= \"mp_per\" size=6 maxlength=6 onkeydown=\"return numberOnlyMod(event, this);\"></TD>';",
        "// Line_Reference 268:                 $table .= '<TD><INPUT class=\"form-control\" type=text name=values[Q-E' . $qtrs['MARKING_PERIOD_ID'] . '] value=\"' . $programconfig['Q-E' . $qtrs['MARKING_PERIOD_ID']] . '\" class= \"mp_per\" size=6 maxlength=6 onkeydown=\"return numberOnlyMod(event, this);\"></TD>';",
        "// Line_Reference 272:                 $table .= '<TD style=\"width: 150px;vertical-align: middle;text-align:center;\"><div class=\"text-danger\" style=\"width: 150px; white-space: nowrap;\">' . _totalNot_100 . '!</div></TD>';",
        "// Line_Reference 287: ",
        "// Line_Reference 288:             if (empty(!$quarters)) {",
        "// Line_Reference 289:                 foreach ($quarters[$sem['MARKING_PERIOD_ID']] as $qtr) {",
        "// Line_Reference 290:                     if ($qtr['DOES_GRADES'] == 'Y') {",
        "// Line_Reference 294:             } else {",
        "// Line_Reference 298: ",
        "// Line_Reference 301:                 $table .= '<TD>' . $sem['TITLE'] . ' ' . _exam . '</TD>';",
        "// Line_Reference 302: ",
        "// Line_Reference 305: ",
        "// Line_Reference 306: ",
        "// Line_Reference 307:             if (empty(!$quarters)) {",
        "// Line_Reference 309:                     if ($qtr['DOES_GRADES'] == 'Y') {",
        "// Line_Reference 314:             } else {",
        "// Line_Reference 320: ",
        "// Line_Reference 326: ",
        "// Line_Reference 328:                 $table .= '<TD style=\"width: 150px;vertical-align: middle;text-align:center;\"><div class=\"text-danger\">' . _totalNot_100 . '!</div></TD>';",
        "// Line_Reference 337:     if (!empty($semesters) && $year[1]['DOES_EXAM'] == '') {",
        "// Line_Reference 339:     } else {",
        "// Line_Reference 343:     $table = '<TABLE style=\"' . $year_tab_style . '\" class=\"table table-bordered table-striped\"><tbody>';",
        "// Line_Reference 345:     //    foreach ($semesters as $sem) {",
        "// Line_Reference 346:     //        foreach ($quarters[$sem['MARKING_PERIOD_ID']] as $qtr)",
        "// Line_Reference 347:     ////            $table .= '<TD style=\"white-space:nowrap\">' . $qtr['TITLE'] . '</TD>';",
        "// Line_Reference 348:     //        if ($sem['DOES_GRADES'] == 'Y')",
        "// Line_Reference 349:     //            $table .= '<TD style=\"white-space:nowrap\">' . $sem['TITLE'] . '</TD>';",
        "// Line_Reference 350:     ////        if ($sem['DOES_EXAM'] == 'Y')",
        "// Line_Reference 351:     ////            $table .= '<TD style=\"white-space:nowrap\">' . $sem['TITLE'] . ' Exam</TD>';",
        "// Line_Reference 352:     //    }",
        "// Line_Reference 353: ",
        "// Line_Reference 356:             // foreach($quarters[$sem['MARKING_PERIOD_ID']] as $qtr)",
        "// Line_Reference 357:             // \t$table .= '<TD style=\"white-space:nowrap\">'.$qtr['TITLE'].'</TD>';",
        "// Line_Reference 360:             // if($sem['DOES_EXAM']=='Y')",
        "// Line_Reference 361:             // \t$table .= '<TD style=\"white-space:nowrap\">'.$sem['TITLE'].' Exam</TD>';",
        "// Line_Reference 363:     } else {",
        "// Line_Reference 369:         $table .= '<TD>' . $year[1]['TITLE'] . ' ' . _exam . '</TD>';",
        "// Line_Reference 370: ",
        "// Line_Reference 373: ",
        "// Line_Reference 397:                 $table .= '<TD><INPUT type=text class=\"form-control\" name=values[FY-' . $sem['MARKING_PERIOD_ID'] . '] value=\"' . $programconfig['FY-' . $sem['MARKING_PERIOD_ID']] . '\" class= \"mp_per\" size=6 maxlength=6 onkeydown=\"return numberOnlyMod(event, this);\"></TD>';",
        "// Line_Reference 407:         $table .= '<TD><INPUT type=text class=\"form-control\"  name=values[FY-' . $year[1]['MARKING_PERIOD_ID'] . '] value=\"' . $programconfig['FY-' . $year[1]['MARKING_PERIOD_ID']] . '\" class= \"mp_per\" size=6 maxlength=6 onkeydown=\"return numberOnlyMod(event, this);\"></TD>';",
        "// Line_Reference 413:         $table .= '<TD><INPUT type=text class=\"form-control\" name=values[FY-E' . $year[1]['MARKING_PERIOD_ID'] . '] value=\"' . $programconfig['FY-E' . $year[1]['MARKING_PERIOD_ID']] . '\" size=6 maxlength=6></TD>';",
        "// Line_Reference 418:         $table .= '<TD style=\"white-space:nowrap; width: 150px;vertical-align: middle;text-align:center;\"><div class=\"text-danger\">' . _totalNot_100 . '!</div></TD>';",
        "// Line_Reference 426: echo '<br/><INPUT type=submit value=' . _save . ' class=\"btn btn-primary\" onclick=\"self_disable(this);\">';"
    ]
}
