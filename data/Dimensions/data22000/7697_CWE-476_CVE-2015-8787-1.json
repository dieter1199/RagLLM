{
    "cve_id": "CVE-2015-8787",
    "cve_description": "The nf_nat_redirect_ipv4 function in net/netfilter/nf_nat_redirect.c in the Linux kernel before 4.4 allows remote attackers to cause a denial of service (NULL pointer dereference and system crash) or possibly have unspecified other impact by sending certain IPv4 packets to an incompletely configured interface, a related issue to CVE-2003-1604.",
    "cve_publish_date": "2016-02-08",
    "cwe_id": "CWE-476",
    "cwe_name": "NULL Pointer Dereference",
    "cwe_description": "The product dereferences a pointer that it expects to be valid but is NULL.",
    "commit_message": "netfilter: nf_nat_redirect: add missing NULL pointer check\n\nCommit 8b13eddfdf04cbfa561725cfc42d6868fe896f56 (\"netfilter: refactor NAT\nredirect IPv4 to use it from nf_tables\") has introduced a trivial logic\nchange which can result in the following crash.\n\nBUG: unable to handle kernel NULL pointer dereference at 0000000000000030\nIP: [<ffffffffa033002d>] nf_nat_redirect_ipv4+0x2d/0xa0 [nf_nat_redirect]\nPGD 3ba662067 PUD 3ba661067 PMD 0\nOops: 0000 [#1] SMP\nModules linked in: ipv6(E) xt_REDIRECT(E) nf_nat_redirect(E) xt_tcpudp(E) iptable_nat(E) nf_conntrack_ipv4(E) nf_defrag_ipv4(E) nf_nat_ipv4(E) nf_nat(E) nf_conntrack(E) ip_tables(E) x_tables(E) binfmt_misc(E) xfs(E) libcrc32c(E) evbug(E) evdev(E) psmouse(E) i2c_piix4(E) i2c_core(E) acpi_cpufreq(E) button(E) ext4(E) crc16(E) jbd2(E) mbcache(E) dm_mirror(E) dm_region_hash(E) dm_log(E) dm_mod(E)\nCPU: 0 PID: 2536 Comm: ip Tainted: G            E   4.1.7-15.23.amzn1.x86_64 #1\nHardware name: Xen HVM domU, BIOS 4.2.amazon 05/06/2015\ntask: ffff8800eb438000 ti: ffff8803ba664000 task.ti: ffff8803ba664000\n[...]\nCall Trace:\n <IRQ>\n [<ffffffffa0334065>] redirect_tg4+0x15/0x20 [xt_REDIRECT]\n [<ffffffffa02e2e99>] ipt_do_table+0x2b9/0x5e1 [ip_tables]\n [<ffffffffa0328045>] iptable_nat_do_chain+0x25/0x30 [iptable_nat]\n [<ffffffffa031777d>] nf_nat_ipv4_fn+0x13d/0x1f0 [nf_nat_ipv4]\n [<ffffffffa0328020>] ? iptable_nat_ipv4_fn+0x20/0x20 [iptable_nat]\n [<ffffffffa031785e>] nf_nat_ipv4_in+0x2e/0x90 [nf_nat_ipv4]\n [<ffffffffa03280a5>] iptable_nat_ipv4_in+0x15/0x20 [iptable_nat]\n [<ffffffff81449137>] nf_iterate+0x57/0x80\n [<ffffffff814491f7>] nf_hook_slow+0x97/0x100\n [<ffffffff814504d4>] ip_rcv+0x314/0x400\n\nunsigned int\nnf_nat_redirect_ipv4(struct sk_buff *skb,\n...\n{\n...\n\t\trcu_read_lock();\n\t\tindev = __in_dev_get_rcu(skb->dev);\n\t\tif (indev != NULL) {\n\t\t\tifa = indev->ifa_list;\n\t\t\tnewdst = ifa->ifa_local; <---\n\t\t}\n\t\trcu_read_unlock();\n...\n}\n\nBefore the commit, 'ifa' had been always checked before access. After the\ncommit, however, it could be accessed even if it's NULL. Interestingly,\nthis was once fixed in 2003.\n\nhttp://marc.info/?l=netfilter-devel&m=106668497403047&w=2\n\nIn addition to the original one, we have seen the crash when packets that\nneed to be redirected somehow arrive on an interface which hasn't been\nyet fully configured.\n\nThis change just reverts the logic to the old behavior to avoid the crash.\n\nFixes: 8b13eddfdf04 (\"netfilter: refactor NAT redirect IPv4 to use it from nf_tables\")\nSigned-off-by: Munehisa Kamata <kamatam@amazon.com>\nSigned-off-by: Pablo Neira Ayuso <pablo@netfilter.org>",
    "type_of_change": "Modification",
    "filename_of_changes": "nf_nat_redirect.c",
    "code_language": "C",
    "number_of_lines_added_for_mitigation": "1",
    "number_of_lines_deleted_vulnerable_to_cve": "1",
    "vulnerable_lines": [
        "// Line_Reference 58: \t\tif (indev != NULL) {"
    ]
}
