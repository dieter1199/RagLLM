{
    "cve_id": "CVE-2017-1000083",
    "cve_description": "backend/comics/comics-document.c (aka the comic book backend) in GNOME Evince before 3.24.1 allows remote attackers to execute arbitrary commands via a .cbt file that is a TAR archive containing a filename beginning with a \"--\" command-line option substring, as demonstrated by a --checkpoint-action=exec=bash at the beginning of the filename.",
    "cve_publish_date": "2017-09-05",
    "cwe_id": "NVD-CWE-noinfo",
    "cwe_name": "Insufficient Information",
    "cwe_description": "There is insufficient information about the issue to classify it; details are unkown or unspecified.",
    "commit_message": "comics: Remove support for tar and tar-like commands\n\nWhen handling tar files, or using a command with tar-compatible syntax,\nto open comic-book archives, both the archive name (the name of the\ncomics file) and the filename (the name of a page within the archive)\nare quoted to not be interpreted by the shell.\n\nBut the filename is completely with the attacker's control and can start\nwith \"--\" which leads to tar interpreting it as a command line flag.\n\nThis can be exploited by creating a CBT file (a tar archive with the\n.cbt suffix) with an embedded file named something like this:\n\"--checkpoint-action=exec=bash -c 'touch ~/hacked;'.jpg\"\n\nCBT files are infinitely rare (CBZ is usually used for DRM-free\ncommercial releases, CBR for those from more dubious provenance), so\nremoving support is the easiest way to avoid the bug triggering. All\nthis code was rewritten in the development release for GNOME 3.26 to not\nshell out to any command, closing off this particular attack vector.\n\nThis also removes the ability to use libarchive's bsdtar-compatible\nbinary for CBZ (ZIP), CB7 (7zip), and CBR (RAR) formats. The first two\nare already supported by unzip and 7zip respectively. libarchive's RAR\nsupport is limited, so unrar is a requirement anyway.\n\nDiscovered by Felix Wilhelm from the Google Security Team.\n\nhttps://bugzilla.gnome.org/show_bug.cgi?id=784630",
    "type_of_change": "Modification",
    "filename_of_changes": "comics-document.c",
    "code_language": "C",
    "number_of_lines_added_for_mitigation": "1",
    "number_of_lines_deleted_vulnerable_to_cve": "39",
    "vulnerable_lines": [
        "// Line_Reference 59: \tP7ZIP,",
        "// Line_Reference 60: \tTAR",
        "// Line_Reference 120: ",
        "// Line_Reference 121:         /* tar */",
        "// Line_Reference 122: \t{\"%s -xOf\"          , \"%s -tf %s\"      , NULL             , FALSE, NO_OFFSET}",
        "// Line_Reference 367: \t\tcomics_document->selected_command =",
        "// Line_Reference 368: \t\t\t\tg_find_program_in_path (\"bsdtar\");",
        "// Line_Reference 369: \t\tif (comics_document->selected_command) {",
        "// Line_Reference 370: \t\t\tcomics_document->command_usage = TAR;",
        "// Line_Reference 371: \t\t\treturn TRUE;",
        "// Line_Reference 372: \t\t}",
        "// Line_Reference 373: ",
        "// Line_Reference 399: \t\tcomics_document->selected_command =",
        "// Line_Reference 400: \t\t\t\tg_find_program_in_path (\"bsdtar\");",
        "// Line_Reference 401: \t\tif (comics_document->selected_command) {",
        "// Line_Reference 402: \t\t\tcomics_document->command_usage = TAR;",
        "// Line_Reference 403: \t\t\treturn TRUE;",
        "// Line_Reference 404: \t\t}",
        "// Line_Reference 428: \t\tcomics_document->selected_command =",
        "// Line_Reference 429: \t\t\t\tg_find_program_in_path (\"bsdtar\");",
        "// Line_Reference 430: \t\tif (comics_document->selected_command) {",
        "// Line_Reference 431: \t\t\tcomics_document->command_usage = TAR;",
        "// Line_Reference 432: \t\t\treturn TRUE;",
        "// Line_Reference 433: \t\t}",
        "// Line_Reference 434: \t} else if (g_content_type_is_a (mime_type, \"application/x-cbt\") ||",
        "// Line_Reference 435: \t\t   g_content_type_is_a (mime_type, \"application/x-tar\")) {",
        "// Line_Reference 436: \t\t/* tar utility (Tape ARchive) */",
        "// Line_Reference 437: \t\tcomics_document->selected_command =",
        "// Line_Reference 438: \t\t\t\tg_find_program_in_path (\"tar\");",
        "// Line_Reference 439: \t\tif (comics_document->selected_command) {",
        "// Line_Reference 440: \t\t\tcomics_document->command_usage = TAR;",
        "// Line_Reference 441: \t\t\treturn TRUE;",
        "// Line_Reference 442: \t\t}",
        "// Line_Reference 443: \t\tcomics_document->selected_command =",
        "// Line_Reference 444: \t\t\t\tg_find_program_in_path (\"bsdtar\");",
        "// Line_Reference 445: \t\tif (comics_document->selected_command) {",
        "// Line_Reference 446: \t\t\tcomics_document->command_usage = TAR;",
        "// Line_Reference 447: \t\t\treturn TRUE;",
        "// Line_Reference 448: \t\t}"
    ]
}
