{
    "cve_id": "CVE-2016-8869",
    "cve_description": "The register method in the UsersModelRegistration class in controllers/user.php in the Users component in Joomla! before 3.6.4 allows remote attackers to gain privileges by leveraging incorrect use of unfiltered data when registering on a site.",
    "cve_publish_date": "2016-11-04",
    "cwe_id": "CWE-20",
    "cwe_name": "Improper Input Validation",
    "cwe_description": "The product receives input or data, but it does\n        not validate or incorrectly validates that the input has the\n        properties that are required to process the data safely and\n        correctly.",
    "commit_message": "Prepare 3.6.4 Stable Release",
    "type_of_change": "Modification",
    "filename_of_changes": "user.php",
    "code_language": "PHP",
    "number_of_lines_added_for_mitigation": "0",
    "number_of_lines_deleted_vulnerable_to_cve": "81",
    "vulnerable_lines": [
        "// Line_Reference 286: \t/**",
        "// Line_Reference 287: \t * Method to register a user.",
        "// Line_Reference 288: \t *",
        "// Line_Reference 289: \t * @return  boolean",
        "// Line_Reference 290: \t *",
        "// Line_Reference 291: \t * @since   1.6",
        "// Line_Reference 292: \t */",
        "// Line_Reference 293: \tpublic function register()",
        "// Line_Reference 294: \t{",
        "// Line_Reference 295: \t\tJSession::checkToken('post') or jexit(JText::_('JINVALID_TOKEN'));",
        "// Line_Reference 296: ",
        "// Line_Reference 297: \t\t// Get the application",
        "// Line_Reference 298: \t\t$app = JFactory::getApplication();",
        "// Line_Reference 299: ",
        "// Line_Reference 300: \t\t// Get the form data.",
        "// Line_Reference 301: \t\t$data = $this->input->post->get('user', array(), 'array');",
        "// Line_Reference 302: ",
        "// Line_Reference 303: \t\t// Get the model and validate the data.",
        "// Line_Reference 304: \t\t$model  = $this->getModel('Registration', 'UsersModel');",
        "// Line_Reference 305: ",
        "// Line_Reference 306: \t\t$form = $model->getForm();",
        "// Line_Reference 307: ",
        "// Line_Reference 308: \t\tif (!$form)",
        "// Line_Reference 309: \t\t{",
        "// Line_Reference 310: \t\t\tJError::raiseError(500, $model->getError());",
        "// Line_Reference 311: ",
        "// Line_Reference 312: \t\t\treturn false;",
        "// Line_Reference 313: \t\t}",
        "// Line_Reference 314: ",
        "// Line_Reference 315: \t\t$return = $model->validate($form, $data);",
        "// Line_Reference 316: ",
        "// Line_Reference 317: \t\t// Check for errors.",
        "// Line_Reference 318: \t\tif ($return === false)",
        "// Line_Reference 319: \t\t{",
        "// Line_Reference 320: \t\t\t// Get the validation messages.",
        "// Line_Reference 321: \t\t\t$errors = $model->getErrors();",
        "// Line_Reference 322: ",
        "// Line_Reference 323: \t\t\t// Push up to three validation messages out to the user.",
        "// Line_Reference 324: \t\t\tfor ($i = 0, $n = count($errors); $i < $n && $i < 3; $i++)",
        "// Line_Reference 325: \t\t\t{",
        "// Line_Reference 326: \t\t\t\tif ($errors[$i] instanceof Exception)",
        "// Line_Reference 327: \t\t\t\t{",
        "// Line_Reference 328: \t\t\t\t\t$app->enqueueMessage($errors[$i]->getMessage(), 'notice');",
        "// Line_Reference 329: ",
        "// Line_Reference 330: \t\t\t\t\tcontinue;",
        "// Line_Reference 331: \t\t\t\t}",
        "// Line_Reference 332: ",
        "// Line_Reference 333: \t\t\t\t$app->enqueueMessage($errors[$i], 'notice');",
        "// Line_Reference 334: \t\t\t}",
        "// Line_Reference 335: ",
        "// Line_Reference 336: \t\t\t// Save the data in the session.",
        "// Line_Reference 337: \t\t\t$app->setUserState('users.registration.form.data', $data);",
        "// Line_Reference 338: ",
        "// Line_Reference 339: \t\t\t// Redirect back to the registration form.",
        "// Line_Reference 340: \t\t\t$this->setRedirect('index.php?option=com_users&view=registration');",
        "// Line_Reference 341: ",
        "// Line_Reference 342: \t\t\treturn false;",
        "// Line_Reference 343: \t\t}",
        "// Line_Reference 344: ",
        "// Line_Reference 345: \t\t// Finish the registration.",
        "// Line_Reference 346: \t\t$return = $model->register($data);",
        "// Line_Reference 347: ",
        "// Line_Reference 348: \t\t// Check for errors.",
        "// Line_Reference 349: \t\tif ($return === false)",
        "// Line_Reference 350: \t\t{",
        "// Line_Reference 351: \t\t\t// Save the data in the session.",
        "// Line_Reference 352: \t\t\t$app->setUserState('users.registration.form.data', $data);",
        "// Line_Reference 353: ",
        "// Line_Reference 354: \t\t\t// Redirect back to the registration form.",
        "// Line_Reference 355: \t\t\t$message = JText::sprintf('COM_USERS_REGISTRATION_SAVE_FAILED', $model->getError());",
        "// Line_Reference 356: \t\t\t$this->setRedirect('index.php?option=com_users&view=registration', $message, 'error');",
        "// Line_Reference 357: ",
        "// Line_Reference 358: \t\t\treturn false;",
        "// Line_Reference 359: \t\t}",
        "// Line_Reference 360: ",
        "// Line_Reference 361: \t\t// Flush the data from the session.",
        "// Line_Reference 362: \t\t$app->setUserState('users.registration.form.data', null);",
        "// Line_Reference 363: ",
        "// Line_Reference 364: \t\treturn true;",
        "// Line_Reference 365: \t}",
        "// Line_Reference 366: "
    ]
}
