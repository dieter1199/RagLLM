{
    "cve_id": "CVE-2024-32983",
    "cve_description": "Misskey is an open source, decentralized microblogging platform. Misskey doesn't perform proper normalization on the JSON structures of incoming signed ActivityPub activity objects before processing them, allowing threat actors to spoof the contents of signed activities and impersonate the authors of the original activities. This vulnerability is fixed in 2024.5.0.",
    "cve_publish_date": "2024-06-03",
    "cwe_id": "NVD-CWE-noinfo",
    "cwe_name": "Insufficient Information",
    "cwe_description": "There is insufficient information about the issue to classify it; details are unkown or unspecified.",
    "commit_message": "Merge pull request from GHSA-2vxv-pv3m-3wvj\n\n* fix: normalize incoming signed activities\n\n* Tweak style\n\n* Update CHANGELOG.md\n\n* Log compacted activity as well\n\n---------\n\nCo-authored-by: syuilo <4439005+syuilo@users.noreply.github.com>",
    "type_of_change": "Modification",
    "filename_of_changes": "InboxProcessorService.ts",
    "code_language": "TypeScript",
    "number_of_lines_added_for_mitigation": "32",
    "number_of_lines_deleted_vulnerable_to_cve": "12",
    "vulnerable_lines": [
        "// Line_Reference 24: import { LdSignatureService } from '@/core/activitypub/LdSignatureService.js';",
        "// Line_Reference 41: \t\tprivate ldSignatureService: LdSignatureService,",
        "// Line_Reference 55: \t\tconst activity = job.data.activity;",
        "// Line_Reference 113: \t\t\tif (activity.signature) {",
        "// Line_Reference 114: \t\t\t\tif (activity.signature.type !== 'RsaSignature2017') {",
        "// Line_Reference 115: \t\t\t\t\tthrow new Bull.UnrecoverableError(`skip: unsupported LD-signature type ${activity.signature.type}`);",
        "// Line_Reference 118: \t\t\t\t// activity.signature.creator: https://example.oom/users/user#main-key",
        "// Line_Reference 120: \t\t\t\tif (activity.signature.creator) {",
        "// Line_Reference 121: \t\t\t\t\tconst candicate = activity.signature.creator.replace(/#.*/, '');",
        "// Line_Reference 126: \t\t\t\tauthUser = await this.apDbResolverService.getAuthUserFromKeyId(activity.signature.creator);",
        "// Line_Reference 136: \t\t\t\tconst ldSignature = this.ldSignatureService.use();",
        "// Line_Reference 137: \t\t\t\tconst verified = await ldSignature.verifyRsaSignature2017(activity, authUser.key.keyPem).catch(() => false);"
    ]
}
