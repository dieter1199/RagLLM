{
    "cve_id": "CVE-2024-1995",
    "cve_description": "The Smart Custom Fields plugin for WordPress is vulnerable to unauthorized access of data due to a missing capability check on the relational_posts_search() function in all versions up to, and including, 4.2.2. This makes it possible for authenticated attackers, with subscrber-level access and above, to retrieve post content that is password protected and/or private.",
    "cve_publish_date": "2024-03-20",
    "cwe_id": "NVD-CWE-noinfo",
    "cwe_name": "Insufficient Information",
    "cwe_description": "There is insufficient information about the issue to classify it; details are unkown or unspecified.",
    "commit_message": "Security fix",
    "type_of_change": "Modification",
    "filename_of_changes": "class.field-related-posts.php",
    "code_language": "PHP",
    "number_of_lines_added_for_mitigation": "90",
    "number_of_lines_deleted_vulnerable_to_cve": "61",
    "vulnerable_lines": [
        "// Line_Reference 84: \t\t\t$post_type = explode( ',', $post_types );",
        "// Line_Reference 85: \t\t\t$args      = array(",
        "// Line_Reference 86: \t\t\t\t'post_type'      => $post_type,",
        "// Line_Reference 87: \t\t\t\t'order'          => 'ASC',",
        "// Line_Reference 88: \t\t\t\t'orderby'        => 'ID',",
        "// Line_Reference 89: \t\t\t\t'posts_per_page' => -1,",
        "// Line_Reference 90: \t\t\t\t'post_status'    => 'any',",
        "// Line_Reference 91: \t\t\t);",
        "// Line_Reference 93: \t\t\t$click_count = filter_input( INPUT_POST, 'click_count' );",
        "// Line_Reference 94: \t\t\tif ( $click_count ) {",
        "// Line_Reference 95: \t\t\t\t$posts_per_page = get_option( 'posts_per_page' );",
        "// Line_Reference 96: \t\t\t\t$offset         = $click_count * $posts_per_page;",
        "// Line_Reference 97: \t\t\t\t$args           = array_merge(",
        "// Line_Reference 98: \t\t\t\t\t$args,",
        "// Line_Reference 99: \t\t\t\t\tarray(",
        "// Line_Reference 100: \t\t\t\t\t\t'offset'         => $offset,",
        "// Line_Reference 101: \t\t\t\t\t\t'posts_per_page' => $posts_per_page,",
        "// Line_Reference 102: \t\t\t\t\t)",
        "// Line_Reference 103: \t\t\t\t);",
        "// Line_Reference 106: \t\t\t$s = filter_input( INPUT_POST, 's' );",
        "// Line_Reference 107: \t\t\tif ( $s ) {",
        "// Line_Reference 108: \t\t\t\t$args = array_merge(",
        "// Line_Reference 109: \t\t\t\t\t$args,",
        "// Line_Reference 110: \t\t\t\t\tarray(",
        "// Line_Reference 111: \t\t\t\t\t\t's' => $s,",
        "// Line_Reference 112: \t\t\t\t\t)",
        "// Line_Reference 114: \t\t\t}",
        "// Line_Reference 116: \t\t\t$field_name = sanitize_text_field( filter_input( INPUT_POST, 'field_name' ) );",
        "// Line_Reference 118: \t\t\t/**",
        "// Line_Reference 119: \t\t\t * This filter will be always applied when it queries posts in related posts field.",
        "// Line_Reference 120: \t\t\t */",
        "// Line_Reference 121: \t\t\t$args = apply_filters( SCF_Config::PREFIX . 'custom_related_posts_args', $args, $field_name, $post_type );",
        "// Line_Reference 123: \t\t\t/**",
        "// Line_Reference 124: \t\t\t * This filter will only be applied when getting posts via ajax call, therefore it won't be applied for the first load.",
        "// Line_Reference 125: \t\t\t */",
        "// Line_Reference 126: \t\t\t$args = apply_filters( SCF_Config::PREFIX . 'custom_related_posts_args_ajax_call', $args, $field_name, $post_type );",
        "// Line_Reference 128: \t\t\t$_posts = get_posts( $args );",
        "// Line_Reference 147: \t\tif ( ! $post_type ) {",
        "// Line_Reference 148: \t\t\t$post_type = array( 'post' );",
        "// Line_Reference 149: \t\t}",
        "// Line_Reference 150: \t\tif ( ! preg_match( '/^\\d+$/', $limit ) ) {",
        "// Line_Reference 151: \t\t\t$limit = '';",
        "// Line_Reference 152: \t\t}",
        "// Line_Reference 155: \t\t$args = array(",
        "// Line_Reference 156: \t\t\t'post_type'      => $post_type,",
        "// Line_Reference 157: \t\t\t'order'          => 'ASC',",
        "// Line_Reference 158: \t\t\t'orderby'        => 'ID',",
        "// Line_Reference 159: \t\t\t'posts_per_page' => $posts_per_page,",
        "// Line_Reference 160: \t\t\t'post_status'    => 'any',",
        "// Line_Reference 161: \t\t);",
        "// Line_Reference 163: \t\t/**",
        "// Line_Reference 164: \t\t * This filter will be always applied when it queries posts in related posts field.",
        "// Line_Reference 165: \t\t */",
        "// Line_Reference 166: \t\t$args = apply_filters( SCF_Config::PREFIX . 'custom_related_posts_args', $args, $name, $post_type );",
        "// Line_Reference 167: \t\t/**",
        "// Line_Reference 168: \t\t * This filter will only be applied in the first load, therefore it won't be applied when getting posts via ajax call.",
        "// Line_Reference 169: \t\t */",
        "// Line_Reference 170: \t\t$args = apply_filters( SCF_Config::PREFIX . 'custom_related_posts_args_first_load', $args, $name, $post_type );",
        "// Line_Reference 171: ",
        "// Line_Reference 172: \t\t// Get posts to show in the first load.",
        "// Line_Reference 173: \t\t$choices_posts = get_posts( $args );"
    ]
}
