@query_op = query_operation.dup
@get_more_op = Protocol::GetMore.new(
@query_op.database,
@query_op.collection,
0,
@query_op.limit
)
@kill_cursor_op = Protocol::KillCursors.new([0])
documents = query @query_op
return kill if limited? && @get_more_op.limit <= 0
documents = query @get_more_op
def query(operation)
reply = session.query operation
@get_more_op.limit -= reply.count if limited?
@get_more_op.cursor_id = reply.cursor_id
@kill_cursor_op.cursor_ids = [reply.cursor_id]
@query_op.limit > 0
@get_more_op.cursor_id != 0
session.execute kill_cursor_op