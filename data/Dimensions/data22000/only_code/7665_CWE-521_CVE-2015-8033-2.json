} elseif (gps('reset')) {
pagetop(gTxt('login'), $message);
$stay = (cs('txp_login') and !gps('logout') ? 1 : 0);
$reset = gps('reset');
if (cs('txp_login') and strpos(cs('txp_login'), ',')) {
if ($c_userid and strlen($c_hash) == 32) { // Cookie exists.
} elseif ($p_userid and $p_password) { // Incoming login vars.
substr(md5($nonce), - 10).$name,
} elseif ($p_reset) { // Reset request.
} elseif (gps('reset')) {
$message = '';
} elseif (gps('confirm')) {
$confirm = pack('H*', gps('confirm'));
$name    = substr($confirm, 5);
$nonce   = safe_field("nonce", 'txp_users', "name = '".doSlash($name)."'");
if ($nonce and $confirm === pack('H*', substr(md5($nonce), 0, 10)).$name) {
include_once txpath.'/lib/txplib_admin.php';
$message = reset_author_pass($name);
