session_start();
DrawHeader(''._selectedUser.' : ' . $RET[1]['FIRST_NAME'] . '&nbsp;' . $RET[1]['LAST_NAME'], '<span class="heading-text"><A HREF=Modules.php?modname=' . $_REQUEST['modname'] . '&search_modfunc=list&next_modname=users/User.php&ajax=true&bottom_back=true&return_session=true' . ($_REQUEST['profile'] == 'none' ? '&profile=none' : '') . ' target=body><i class="icon-square-left"></i> '._backToUserList.'</A></span><div class="btn-group heading-btn"><A HREF=Side.php?staff_id=new&modcat=' . $_REQUEST['modcat'] . ' class="btn btn-danger btn-xs">'._deselect.'</A></div>');
DrawHeader(''._selectedUser.' : ' . $RET[1]['FIRST_NAME'] . '&nbsp;' . $RET[1]['LAST_NAME'], '<div class="btn-group heading-btn"><A HREF=Side.php?staff_id=new&modcat=' . $_REQUEST['modcat'] . ' class="btn btn-danger btn-xs">'._deselect.'</A></div>');
$can_edit_RET = DBGet(DBQuery('SELECT MODNAME FROM profile_exceptions WHERE PROFILE_ID=\'' . User('PROFILE_ID') . '\' AND MODNAME=\'' . 'users/User.php&category_id=' . $_REQUEST[category_id] . '\' AND CAN_EDIT=\'' . 'Y' . '\''));
$can_edit_RET = DBGet(DBQuery('SELECT MODNAME FROM profile_exceptions WHERE PROFILE_ID=\'' . $profile_id_mod . '\' AND MODNAME=\'' . 'users/User.php&category_id=' . $_REQUEST[category_id] . '\' AND CAN_EDIT=\'' . 'Y' . '\''), array(), array('MODNAME'));
if(count($_REQUEST['staff'])>0){
$disp_error = '';
if ($_REQUEST['modfunc'] == 'update') {
// print_r($_REQUEST);
$flag = 0;
$qry = 'UPDATE people SET ';
// print_r($_REQUEST['people']);
foreach ($_REQUEST['staff'] as $in => $d) {
$field_id = explode('_', $in);
$field_id = $field_id[1];
$check_stat = DBGet(DBQuery('SELECT TITLE,REQUIRED FROM people_fields WHERE ID=\'' . $field_id . '\' '));
if ($check_stat[1]['REQUIRED'] == 'Y') {
if ($d != '') {
$qry.=' ' . $in . '=\'' . str_replace("'", "''", str_replace("\'", "'", $d)) . '\',';
$flag++;
$disp_error = '<div class="alert alert-danger">' . $check_stat[1]['TITLE'] . ' is required.</div>';
}
} else {
if ($d != '')
$qry.=' ' . $in . '=\'' . str_replace("'", "''", str_replace("\'", "'", $d)) . '\',';
else
$qry.=' ' . $in . '=NULL,';
$flag++;
}
if ($flag > 0) {
$qry = substr($qry, 0, -1) . ' WHERE STAFF_ID=' . $_REQUEST['staff_id'];
DBQuery($qry);
}
if (count($_REQUEST['people']) > 0) {
$up_sql.=$pi . "='" . str_replace("'", "''", str_replace("\'", "'", $pd)) . "',";
$up_sql.=" WHERE STAFF_ID=" . $_REQUEST['staff_id'];
if (count($_REQUEST['people']) > 0) {
$up_sql.=$pi . "='" . str_replace("'", "''", str_replace("\'", "'", $pd)) . "',";
$up_sql.=" WHERE STAFF_ID=" . $_REQUEST['staff_id'];
if (count($_REQUEST['student_addres']) > 0) {
$up_sql.=$pi . "='" . str_replace("'", "''", str_replace("\'", "'", $pd)) . "',";
$up_sql.=" WHERE PEOPLE_ID=" . $_REQUEST['staff_id'];
$str.="||" . $m_custom_val;
$qry.=' ' . $in . '=\'' . str_replace("'", "''", str_replace("\'", "'", $d)) . '\',';
$qry.=' ' . $in . '=\'' . str_replace("'", "''", str_replace("\'", "'", $d)) . '\',';
$qry.=' ' . $in . '=NULL,';
DrawBC(""._users." > Add a User");
DrawBC(""._users." > " . ProgramTitle());
//            echo '<script language=JavaScript>parent.side.location="' . $_SESSION['Side_PHP_SELF'] . '?modcat="+parent.side.document.forms[0].modcat.value;</script>';
}
elseif (basename($_SERVER['PHP_SELF']) != 'index.php') {
$delete_button = '<INPUT type=button class="btn btn-danger" value='._delete.' onclick="window.location=\'Modules.php?modname=' . $_REQUEST['modname'] . '&modfunc=delete\'">';
// echo "$category[TITLE]<br>";
switch ($category['TITLE'] ) {
$categoryTitle = $category['TITLE'] ;
$_openSIS['selected_tab'] .='&staff_id=' . $_REQUEST['staff_id'];
$_openSIS['selected_tab'] .=($_REQUEST['profile'] == 'none' ? '&profile=none' : '');
$submit_btn = SubmitButton(_save, '', 'id="saveUserBtn" class="btn btn-primary pull-right" onclick="return formcheck_user_user_mod(' . $_SESSION[staff_school_chkbox_id] . ', this);"');
?>
