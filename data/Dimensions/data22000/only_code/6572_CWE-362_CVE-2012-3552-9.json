struct ip_options *opt = NULL;
if (inet->opt)
icsk->icsk_ext_hdr_len -= inet->opt->optlen;
icsk->icsk_ext_hdr_len += opt->optlen;
opt = xchg(&inet->opt, opt);
kfree(opt);
struct ip_options * opt = (struct ip_options *)optbuf;
if (inet->opt)
memcpy(optbuf, inet->opt,
sizeof(struct ip_options)+
inet->opt->optlen);