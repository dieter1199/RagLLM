"encoding/json"
apiv1 "github.com/usememos/memos/server/route/api/v1"
systemSettingStorageServiceID, err := dataStore.GetWorkspaceSetting(ctx, &store.FindWorkspaceSetting{Name: apiv1.SystemSettingStorageServiceIDName.String()})
return nil, errors.Wrap(err, "Failed to find SystemSettingStorageServiceIDName")
storageServiceID := apiv1.DefaultStorage
if systemSettingStorageServiceID != nil {
err = json.Unmarshal([]byte(systemSettingStorageServiceID.Value), &storageServiceID)
if err != nil {
return nil, errors.Wrap(err, "Failed to unmarshal storage service id")
}
storage, err := dataStore.GetStorage(ctx, &store.FindStorage{ID: &storageServiceID})
return nil, errors.Wrap(err, "Failed to find StorageServiceID")
return nil, nil // storage not configured - not an error, just return empty ref
storageMessage, err := apiv1.ConvertStorageFromStore(storage)
if err != nil {
return nil, errors.Wrap(err, "Failed to ConvertStorageFromStore")
}
if storageMessage.Type != apiv1.StorageS3 {
s3Config := storageMessage.Config.S3Config
URLPrefix: s3Config.URLPrefix,
URLSuffix: s3Config.URLSuffix,
