var execSync = require('child_process').execSync;
patternedFilenameWithoutTheFilename = pattern.replace(new RegExp(path.sep+'[^'+path.sep+']*$'), '')
.replace(/\{z\}/, '' + zoom);
.then(()=>{
var command = 'convert ' + inPath +
' -crop ' + tileSize + 'x' + tileSize +
' -set filename:tile "' + patternedFilename + '"' +
' -quality ' + quality + ' +repage +adjoin' +
' "' + outPath + '/%[filename:tile]' + dotExtension + '"' ;
execSync(command);
});
execSync('convert ' + inPath + ' ' + inPathMpc);
execSync('convert ' + inPathMpc + ' -resize 50% -quality ' + quality + ' ' + newInPath);
.then(()=>tileRec(inPath, outPath, zoom, tileSize, tempDir, pattern, zoomToDisplay, options.invertZoom, quality))
.then(()=>rimraf(tempDir));