<?php
* Authors:	Liran Tal <liran@enginx.com>
//include the dompdf class
require_once("dompdf/dompdf_config.inc.php");
//include the Pear Mail classes for sending out emails
@require_once('Mail.php');
@require_once('Mail/mime.php');
$base = dirname(__FILE__);
global $base;
$html = prepareNotificationTemplate($customerInfo);
$pdfDocument = createPDF($html);
file_put_contents("$base/out4.pdf", $pdfDocument);
return $pdfDocument;
global $base;
if (empty($customerInfo['business_email']))
return;
$headers = array(	"From"	=>	$from,
"Subject"	=>	"User Invoice Notification",
"Reply-To"=> $from
);
$mime = new Mail_mime();
$mime->setTXTBody("Notification letter of service");
$mime->addAttachment($pdfDocument, "application/pdf", "invoice.pdf", false, 'base64');
$body = $mime->get();
$headers = $mime->headers($headers);
$mail =& Mail::factory("smtp", $smtpInfo);
$mail->send($customerInfo['business_email'], $headers, $body);
global $base;
$notification_template = "$base/templates/user_invoice_details.html";
/**
* createPDF()
* creates a PDF document for a given html file
*
* @param 		string			the html file to convert to pdf
* @return 		string			returns the pdf in binary/string stream
*/
function createPDF($html) {
global $base;
// instansiate the pdf document
$dompdf = new DOMPDF();
$dompdf->set_base_path("$base/templates/");
$dompdf->load_html($html);
$dompdf->render();
$notification_pdf = $dompdf->output();
return $notification_pdf;
}
