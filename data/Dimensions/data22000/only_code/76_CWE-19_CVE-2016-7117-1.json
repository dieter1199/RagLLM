out_put:
fput_light(sock->file, fput_needed);
return datagrams;
if (datagrams != 0) {
* We may return less entries than requested (vlen) if the
* sock is non block and there aren't enough datagrams...
if (err != -EAGAIN) {
/*
* ... or  if recvmsg returns an error after we
* received some datagrams, where we record the
* error to return on the next call or if the
* app asks about it using getsockopt(SO_ERROR).
*/
sock->sk->sk_err = -err;
}
return datagrams;
return err;
