{
    "cve_id": "CVE-2015-8966",
    "cve_description": "arch/arm/kernel/sys_oabi-compat.c in the Linux kernel before 4.4 allows local users to gain privileges via a crafted (1) F_OFD_GETLK, (2) F_OFD_SETLK, or (3) F_OFD_SETLKW command in an fcntl64 system call.",
    "cve_publish_date": "2016-12-08",
    "cwe_id": "CWE-264",
    "cwe_name": "Permissions, Privileges, and Access Controls",
    "cwe_description": "Weaknesses in this category are related to the management of permissions, privileges, and other security features that are used to perform access control.",
    "commit_message": "[PATCH] arm: fix handling of F_OFD_... in oabi_fcntl64()\n\nCc: stable@vger.kernel.org # 3.15+\nReviewed-by: Jeff Layton <jeff.layton@primarydata.com>\nSigned-off-by: Al Viro <viro@zeniv.linux.org.uk>",
    "type_of_change": "Modification",
    "filename_of_changes": "sys_oabi-compat.c",
    "code_language": "C",
    "number_of_lines_added_for_mitigation": "37",
    "number_of_lines_deleted_vulnerable_to_cve": "36",
    "vulnerable_lines": [
        "// Line_Reference 196: asmlinkage long sys_oabi_fcntl64(unsigned int fd, unsigned int cmd,",
        "// Line_Reference 199: \tstruct oabi_flock64 user;",
        "// Line_Reference 201: \tmm_segment_t fs = USER_DS; /* initialized to kill a warning */",
        "// Line_Reference 202: \tunsigned long local_arg = arg;",
        "// Line_Reference 203: \tint ret;",
        "// Line_Reference 212: \t\tif (copy_from_user(&user, (struct oabi_flock64 __user *)arg,",
        "// Line_Reference 213: \t\t\t\t   sizeof(user)))",
        "// Line_Reference 214: \t\t\treturn -EFAULT;",
        "// Line_Reference 215: \t\tkernel.l_type\t= user.l_type;",
        "// Line_Reference 216: \t\tkernel.l_whence\t= user.l_whence;",
        "// Line_Reference 217: \t\tkernel.l_start\t= user.l_start;",
        "// Line_Reference 218: \t\tkernel.l_len\t= user.l_len;",
        "// Line_Reference 219: \t\tkernel.l_pid\t= user.l_pid;",
        "// Line_Reference 220: \t\tlocal_arg = (unsigned long)&kernel;",
        "// Line_Reference 221: \t\tfs = get_fs();",
        "// Line_Reference 222: \t\tset_fs(KERNEL_DS);",
        "// Line_Reference 223: \t}",
        "// Line_Reference 224: ",
        "// Line_Reference 225: \tret = sys_fcntl64(fd, cmd, local_arg);",
        "// Line_Reference 227: \tswitch (cmd) {",
        "// Line_Reference 228: \tcase F_GETLK64:",
        "// Line_Reference 229: \t\tif (!ret) {",
        "// Line_Reference 230: \t\t\tuser.l_type\t= kernel.l_type;",
        "// Line_Reference 231: \t\t\tuser.l_whence\t= kernel.l_whence;",
        "// Line_Reference 232: \t\t\tuser.l_start\t= kernel.l_start;",
        "// Line_Reference 233: \t\t\tuser.l_len\t= kernel.l_len;",
        "// Line_Reference 234: \t\t\tuser.l_pid\t= kernel.l_pid;",
        "// Line_Reference 235: \t\t\tif (copy_to_user((struct oabi_flock64 __user *)arg,",
        "// Line_Reference 236: \t\t\t\t\t &user, sizeof(user)))",
        "// Line_Reference 237: \t\t\t\tret = -EFAULT;",
        "// Line_Reference 238: \t\t}",
        "// Line_Reference 239: \tcase F_SETLK64:",
        "// Line_Reference 240: \tcase F_SETLKW64:",
        "// Line_Reference 241: \t\tset_fs(fs);",
        "// Line_Reference 243: ",
        "// Line_Reference 244: \treturn ret;"
    ]
}
