{
    "cve_id": "CVE-2023-0337",
    "cve_description": "Cross-site Scripting (XSS) - Reflected in GitHub repository lirantal/daloradius prior to master-branch.",
    "cve_publish_date": "2023-01-17",
    "cwe_id": "CWE-79",
    "cwe_name": "Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting')",
    "cwe_description": "The product does not neutralize or incorrectly neutralizes user-controllable input before it is placed in output that is used as a web page that is served to other users.",
    "commit_message": "Fixed acct and hs management (#341)\n\n* Fixed bugs in some accounting related feature\r\n\r\n* Fixed hs management ui components",
    "type_of_change": "Modification",
    "filename_of_changes": "acct-maintenance-delete.php",
    "code_language": "PHP",
    "number_of_lines_added_for_mitigation": "160",
    "number_of_lines_deleted_vulnerable_to_cve": "93",
    "vulnerable_lines": [
        "// Line_Reference 23: ",
        "// Line_Reference 28: ",
        "// Line_Reference 29:     isset($_REQUEST['enddate']) ? $enddate = $_REQUEST['enddate'] : $enddate = \"\";",
        "// Line_Reference 30:     isset($_REQUEST['startdate']) ? $startdate = $_REQUEST['startdate'] : $startdate = \"\";",
        "// Line_Reference 31:     isset($_REQUEST['username']) ? $username = $_REQUEST['username'] : $username = \"\";",
        "// Line_Reference 32: ",
        "// Line_Reference 33:     $logAction =  \"\";",
        "// Line_Reference 36:     if (isset($_POST['submit'])) {",
        "// Line_Reference 37: ",
        "// Line_Reference 38:         if ( (trim($startdate) != \"\") || (trim($enddate) != \"\") || (trim($username) != \"\") ) {",
        "// Line_Reference 40:             include 'library/opendb.php';",
        "// Line_Reference 41: ",
        "// Line_Reference 42:             $deleteUsername = \"\";",
        "// Line_Reference 43:             if (trim($username) != \"\")",
        "// Line_Reference 44:                 $deleteUsername = \" AND Username='$username'\";",
        "// Line_Reference 45: ",
        "// Line_Reference 46:             $deleteEnddate = \"\";",
        "// Line_Reference 47:             if (trim($enddate) != \"\")",
        "// Line_Reference 48:                 $deleteEnddate = \" AND AcctStartTime<'\".$dbSocket->escapeSimple($enddate).\"'\";",
        "// Line_Reference 49: ",
        "// Line_Reference 50:             $deleteStartdate = \"\";",
        "// Line_Reference 51:             if (trim($startdate) != \"\")",
        "// Line_Reference 52:                 $deleteStartdate = \" AND AcctStartTime>'\".$dbSocket->escapeSimple($startdate).\"'\";",
        "// Line_Reference 53: ",
        "// Line_Reference 54: ",
        "// Line_Reference 55:             $sql = \"DELETE FROM \".$configValues['CONFIG_DB_TBL_RADACCT'].",
        "// Line_Reference 56:                 \" WHERE 1=1\".",
        "// Line_Reference 57:                 \" $deleteStartdate\".",
        "// Line_Reference 58:                 \" $deleteEnddate\".",
        "// Line_Reference 59:                 \" $deleteUsername \";",
        "// Line_Reference 60:             $res = $dbSocket->query($sql);",
        "// Line_Reference 61:             $logDebugSQL .= $sql . \"\\n\";",
        "// Line_Reference 62: ",
        "// Line_Reference 63:             $successMsg = \"Deleted records between <b>$startdate</b> to <b>$enddate</b> for user <b>$username</b>\";",
        "// Line_Reference 64:             $logAction .= \"Successfully deleted records between [$startdate] and [$enddate] for user [$username] on page: \";",
        "// Line_Reference 65: ",
        "// Line_Reference 66:             include 'library/closedb.php';",
        "// Line_Reference 67: ",
        "// Line_Reference 68:         }  else {",
        "// Line_Reference 69:             $failureMsg = \"no username, ending date or starting date was provided, please at least one of those\";",
        "// Line_Reference 70:             $logAction .= \"Failed deleting records from database, missing fields on page: \";",
        "// Line_Reference 72: ",
        "// Line_Reference 75: ",
        "// Line_Reference 76:     include_once('library/config_read.php');",
        "// Line_Reference 77:     $log = \"visited page: \";",
        "// Line_Reference 78: ",
        "// Line_Reference 79:     include_once(\"lang/main.php\");",
        "// Line_Reference 81:     include(\"library/layout.php\");",
        "// Line_Reference 94: ?>",
        "// Line_Reference 95: ",
        "// Line_Reference 96: ",
        "// Line_Reference 97: <form action=\"<?php echo $_SERVER['PHP_SELF']; ?>\" method=\"post\">",
        "// Line_Reference 98:     <fieldset>",
        "// Line_Reference 99: ",
        "// Line_Reference 100:         <h302> <?php echo t('title','DeleteRecords') ?> </h302>",
        "// Line_Reference 101:         <br/>",
        "// Line_Reference 102: ",
        "// Line_Reference 103:         <label for='username' class='form'><?php echo t('all','Username')?></label>",
        "// Line_Reference 104:         <input name='username' type='text' id='username' value='<?php echo $username ?>' tabindex=100 />",
        "// Line_Reference 105:         <br />",
        "// Line_Reference 106: ",
        "// Line_Reference 107:         <label for='startdate' class='form'><?php echo t('all','StartingDate')?></label>",
        "// Line_Reference 108:         <input name='startdate' type='text' id='startdate' value='<?php echo $startdate ?>' tabindex=100 />",
        "// Line_Reference 109:         <img src=\"library/js_date/calendar.gif\" onclick=",
        "// Line_Reference 110:         \"showChooser(this, 'startdate', 'chooserSpan', 1950, <?php echo date('Y', time());?>, 'Y-m-d H:i:s', true);\" >",
        "// Line_Reference 111:         <br />",
        "// Line_Reference 112: ",
        "// Line_Reference 113:         <label for='enddate' class='form'><?php echo t('all','EndingDate')?></label>",
        "// Line_Reference 114:         <input name='enddate' type='text' id='enddate' value='<?php echo $enddate ?>' tabindex=100 />",
        "// Line_Reference 115:         <img src=\"library/js_date/calendar.gif\" onclick=",
        "// Line_Reference 116:         \"showChooser(this, 'enddate', 'chooserSpan', 1950, <?php echo date('Y', time());?>, 'Y-m-d H:i:s', true);\" >",
        "// Line_Reference 117:         <br />",
        "// Line_Reference 118: ",
        "// Line_Reference 119:         <br/><br/>",
        "// Line_Reference 120:         <hr><br/>",
        "// Line_Reference 121:         <input type=\"submit\" name=\"submit\" value=\"<?php echo t('buttons','apply') ?>\" tabindex=1000 class='button' />",
        "// Line_Reference 122: ",
        "// Line_Reference 123:     </fieldset>",
        "// Line_Reference 125:     <div id=\"chooserSpan\" class=\"dateChooser select-free\"",
        "// Line_Reference 126:         style=\"display: none; visibility: hidden; width: 160px;\">",
        "// Line_Reference 127:     </div>",
        "// Line_Reference 129: </form>",
        "// Line_Reference 131:         </div><!-- #contentnorightbar -->",
        "// Line_Reference 132: ",
        "// Line_Reference 133:         <div id=\"footer\">",
        "// Line_Reference 134: <?php",
        "// Line_Reference 136:     include('page-footer.php');",
        "// Line_Reference 138:         </div><!-- #footer -->",
        "// Line_Reference 139:     </div>",
        "// Line_Reference 140: </div>",
        "// Line_Reference 141: ",
        "// Line_Reference 142: </body>",
        "// Line_Reference 143: </html>"
    ]
}
