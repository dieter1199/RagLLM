{
    "cve_id": "CVE-2019-20892",
    "cve_description": "net-snmp before 5.8.1.pre1 has a double free in usm_free_usmStateReference in snmplib/snmpusm.c via an SNMPv3 GetBulk request. NOTE: this affects net-snmp packages shipped to end users by multiple Linux distributions, but might not affect an upstream release.",
    "cve_publish_date": "2020-06-25",
    "cwe_id": "CWE-415",
    "cwe_name": "Double Free",
    "cwe_description": "The product calls free() twice on the same memory address, potentially leading to modification of unexpected memory locations.",
    "commit_message": "libsnmp, USM: Introduce a reference count in struct usmStateReference\n\nThis patch fixes https://sourceforge.net/p/net-snmp/bugs/2956/.",
    "type_of_change": "Modification",
    "filename_of_changes": "snmpusm.c",
    "code_language": "C",
    "number_of_lines_added_for_mitigation": "48",
    "number_of_lines_deleted_vulnerable_to_cve": "25",
    "vulnerable_lines": [
        "// Line_Reference 283:     struct usmStateReference *retval = (struct usmStateReference *)",
        "// Line_Reference 284:         calloc(1, sizeof(struct usmStateReference));",
        "// Line_Reference 292:     struct usmStateReference *old_ref = (struct usmStateReference *) old;",
        "// Line_Reference 293: ",
        "// Line_Reference 294:     if (old_ref) {",
        "// Line_Reference 295: ",
        "// Line_Reference 296:         if (old_ref->usr_name_length)",
        "// Line_Reference 297:             SNMP_FREE(old_ref->usr_name);",
        "// Line_Reference 298:         if (old_ref->usr_engine_id_length)",
        "// Line_Reference 299:             SNMP_FREE(old_ref->usr_engine_id);",
        "// Line_Reference 300:         if (old_ref->usr_auth_protocol_length)",
        "// Line_Reference 301:             SNMP_FREE(old_ref->usr_auth_protocol);",
        "// Line_Reference 302:         if (old_ref->usr_priv_protocol_length)",
        "// Line_Reference 303:             SNMP_FREE(old_ref->usr_priv_protocol);",
        "// Line_Reference 304: ",
        "// Line_Reference 305:         if (old_ref->usr_auth_key_length && old_ref->usr_auth_key) {",
        "// Line_Reference 306:             SNMP_ZERO(old_ref->usr_auth_key, old_ref->usr_auth_key_length);",
        "// Line_Reference 307:             SNMP_FREE(old_ref->usr_auth_key);",
        "// Line_Reference 308:         }",
        "// Line_Reference 309:         if (old_ref->usr_priv_key_length && old_ref->usr_priv_key) {",
        "// Line_Reference 310:             SNMP_ZERO(old_ref->usr_priv_key, old_ref->usr_priv_key_length);",
        "// Line_Reference 311:             SNMP_FREE(old_ref->usr_priv_key);",
        "// Line_Reference 312:         }",
        "// Line_Reference 314:         SNMP_ZERO(old_ref, sizeof(*old_ref));",
        "// Line_Reference 315:         SNMP_FREE(old_ref);"
    ]
}
