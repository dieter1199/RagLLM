{
    "cve_id": "CVE-2024-31981",
    "cve_description": "XWiki Platform is a generic wiki platform. Starting in version 3.0.1 and prior to versions 4.10.20, 15.5.4, and 15.10-rc-1, remote code execution is possible via PDF export templates. This vulnerability has been patched in XWiki 14.10.20, 15.5.4 and 15.10-rc-1. If PDF templates are not typically used on the instance, an administrator can create the document `XWiki.PDFClass` and block its edition, after making sure that it does not contain a `style` attribute. Otherwise, there are no known workarounds aside from upgrading.",
    "cve_publish_date": "2024-04-10",
    "cwe_id": "NVD-CWE-noinfo",
    "cwe_name": "Insufficient Information",
    "cwe_description": "There is insufficient information about the issue to classify it; details are unkown or unspecified.",
    "commit_message": "XWIKI-21337: Apply PDF templates with the rights of their authors",
    "type_of_change": "Modification",
    "filename_of_changes": "PdfExportImplTest.java",
    "code_language": "Java",
    "number_of_lines_added_for_mitigation": "151",
    "number_of_lines_deleted_vulnerable_to_cve": "30",
    "vulnerable_lines": [
        "// Line_Reference 25: import org.xwiki.model.reference.DocumentReferenceResolver;",
        "// Line_Reference 26: import org.xwiki.model.reference.EntityReferenceSerializer;",
        "// Line_Reference 47:     org.xwiki.xml.internal.XMLReaderFactoryComponent.class,",
        "// Line_Reference 50: public class PdfExportImplTest",
        "// Line_Reference 55:     /**",
        "// Line_Reference 56:      * Verify that PDF Export can apply some CSS on the XHTML when that XHTML already has some style defined and in",
        "// Line_Reference 57:      * shorthand notation.",
        "// Line_Reference 58:      */",
        "// Line_Reference 59:     @Test",
        "// Line_Reference 60:     public void applyCSSWhenExistingStyleDefinedUsingShorthandNotation() throws Exception",
        "// Line_Reference 62:         this.oldcore.getMocker().registerMockComponent(DocumentReferenceResolver.TYPE_STRING, \"currentmixed\");",
        "// Line_Reference 63:         this.oldcore.getMocker().registerMockComponent(EntityReferenceSerializer.TYPE_STRING);",
        "// Line_Reference 64:         this.oldcore.getMocker().registerMockComponent(DocumentAccessBridge.class);",
        "// Line_Reference 65:         this.oldcore.getMocker().registerMockComponent(DocumentAccessBridge.class);",
        "// Line_Reference 68:         this.oldcore.getMocker().registerMockComponent(VelocityManager.class);",
        "// Line_Reference 70: ",
        "// Line_Reference 71:         PdfExportImpl pdfExport = new PdfExportImpl();",
        "// Line_Reference 78:         String html = \"<?xml version=\\\"1.0\\\" encoding=\\\"UTF-8\\\"?>\\n\"",
        "// Line_Reference 80:                 + \"\\\"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd\\\">\\n\"",
        "// Line_Reference 101:         String css = \"span { color:red; }\";",
        "// Line_Reference 103:         XWikiContext xcontext = this.oldcore.getXWikiContext();",
        "// Line_Reference 105:         when(doc.getExternalURL(\"view\", xcontext)).thenReturn(\"http://localhost:8080/export\");",
        "// Line_Reference 106:         xcontext.setDoc(doc);",
        "// Line_Reference 116:                 + \"\\\"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd\\\">\"",
        "// Line_Reference 117:                 + \"<html xmlns=\\\"http://www.w3.org/1999/xhtml\\\"><head>\\n\"",
        "// Line_Reference 127:                 + \"      <p><span style=\\\"color: #f00; background-color: #fff; background-image: none; \"",
        "// Line_Reference 128:                 + \"background-position: 0% 0%; background-size: auto auto; background-origin: padding-box; \"",
        "// Line_Reference 129:                 + \"background-clip: border-box; background-repeat: repeat repeat; \"",
        "// Line_Reference 130:                 + \"background-attachment: scroll; \\\">Hello Cl√©ment</span></p>\\n\"",
        "// Line_Reference 136:         assertEquals(expected, pdfExport.applyCSS(html, css, xcontext));"
    ]
}
