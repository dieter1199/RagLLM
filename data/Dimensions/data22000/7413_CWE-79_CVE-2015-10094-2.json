{
    "cve_id": "CVE-2015-10094",
    "cve_description": "A vulnerability was found in Fastly Plugin up to 0.97 on WordPress. It has been rated as problematic. Affected by this issue is the function post of the file lib/api.php. The manipulation of the argument url leads to cross site scripting. The attack may be launched remotely. Upgrading to version 0.98 is able to address this issue. The patch is identified as d7fe42538f4d4af500e3af9678b6b06fba731656. It is recommended to upgrade the affected component. VDB-222326 is the identifier assigned to this vulnerability.",
    "cve_publish_date": "2023-03-06",
    "cwe_id": "CWE-79",
    "cwe_name": "Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting')",
    "cwe_description": "The product does not neutralize or incorrectly neutralizes user-controllable input before it is placed in output that is used as a web page that is served to other users.",
    "commit_message": "Version 0.98 - CSRF/XSS Security Fixes\n\nBumps version to 0.98. Addresses potential XSS/CSRF security issues in plugin.\n\nChanges admin.php to use the esc_attr() and esc_url() on the Fastly\noption values prior to outputting them in the context of the HTML to be\nrendered in the admin panel. While it appears that the values of these\noptions could not be set from an unprivileged context we should be\nescaping them prior to rendering irregardless.\n\nPreviously the FastlyAdmin::ajaxSetPage() and FastlyAdmin::ajaxSignUp()\nhandlers in lib/admin.php were not enforcing the presence of a CSRF\ntoken. This commit also modifies these handlers to use the\nwp_verify_nonce() function. The static/fastly.js AJAX posts were\nmodified to supply a wp_create_nonce() token injected into the scripts\ncontext by wp_localize_script(). The wp_register_script() and associated\ncalls were moved to a wp_enqueue_scripts event handler in order to\nensure that wp_create_nonce() is defined/loaded at the time we try to\nuse it.\n\nChanges all calls to update_option() with dynamic content to use\nesc_sql() on the data before passing it to update_option() to avoid\npotential for SQLi.\n\nThanks to Zack Tollman for the original vulnerability reports.\n\n\n\n\ngit-svn-id: https://plugins.svn.wordpress.org/fastly/trunk@1081712 b8457f37-d9ea-0310-8a92-e5e31aec5664",
    "type_of_change": "Modification",
    "filename_of_changes": "fastly.php",
    "code_language": "PHP",
    "number_of_lines_added_for_mitigation": "68",
    "number_of_lines_deleted_vulnerable_to_cve": "68",
    "vulnerable_lines": [
        "// Line_Reference 1: <?php",
        "// Line_Reference 2: ",
        "// Line_Reference 3: /*",
        "// Line_Reference 4: Plugin Name: Fastly",
        "// Line_Reference 5: Plugin URI: http://fastly.com/",
        "// Line_Reference 6: Description: Configuration and cache purging for the Fastly CDN.",
        "// Line_Reference 7: Author: Fastly.com",
        "// Line_Reference 8: Version: 0.97",
        "// Line_Reference 9: Author URI: http://fastly.com/",
        "// Line_Reference 10: */",
        "// Line_Reference 11: ",
        "// Line_Reference 12: /**",
        "// Line_Reference 13:  * Main plugin code.",
        "// Line_Reference 14:  * @package Fastly",
        "// Line_Reference 15:  * @version 0.97",
        "// Line_Reference 16:  * @author Ryan Sandor Richards",
        "// Line_Reference 17:  * @copyright 2011 Fastly.com, All Rights Reserved",
        "// Line_Reference 18:  */",
        "// Line_Reference 19: ",
        "// Line_Reference 20: // Basic plugin definitions",
        "// Line_Reference 21: define('FASTLY_VERSION', '0.97');",
        "// Line_Reference 22: define('FASTLY_PLUGIN_URL', plugin_dir_url( __FILE__ ));",
        "// Line_Reference 23: ",
        "// Line_Reference 24: // Includes",
        "// Line_Reference 25: include_once dirname( __FILE__ ) . '/lib/purge.php';",
        "// Line_Reference 26: include_once dirname( __FILE__ ) . '/lib/admin.php';",
        "// Line_Reference 27: include_once dirname( __FILE__ ) . '/lib/api.php';",
        "// Line_Reference 28: ",
        "// Line_Reference 29: // Check for JSON support",
        "// Line_Reference 30: if (!function_exists('json_decode')) {",
        "// Line_Reference 31:   require_once dirname( __FILE__ ) . '/lib/JSON.php';",
        "// Line_Reference 32:   define('FASTLY_JSON', false);",
        "// Line_Reference 33: }",
        "// Line_Reference 34: ",
        "// Line_Reference 35: // Plugin Options",
        "// Line_Reference 36: add_option('fastly_hostname', '');",
        "// Line_Reference 37: add_option('fastly_api_key', '');",
        "// Line_Reference 38: add_option('fastly_service_id', '');",
        "// Line_Reference 39: add_option('fastly_api_hostname', 'https://api.fastly.com');",
        "// Line_Reference 40: add_option('fastly_api_port', null);",
        "// Line_Reference 41: add_option('fastly_page', 'welcome');",
        "// Line_Reference 42: add_option('fastly_log_purges', '0');",
        "// Line_Reference 43: ",
        "// Line_Reference 44: // Setup Purging",
        "// Line_Reference 45: new FastlyPurge();",
        "// Line_Reference 46: ",
        "// Line_Reference 47: // Setup admin (if needed)",
        "// Line_Reference 48: if (is_admin()) {",
        "// Line_Reference 49:   new FastlyAdmin();",
        "// Line_Reference 50: }",
        "// Line_Reference 51: ",
        "// Line_Reference 52: // Custom action links for the plugin.",
        "// Line_Reference 53: function fastly_action_links($links, $file) {",
        "// Line_Reference 54:   static $this_plugin;",
        "// Line_Reference 55:   if (!$this_plugin) {",
        "// Line_Reference 56:     $this_plugin = plugin_basename(__FILE__);",
        "// Line_Reference 57:   }",
        "// Line_Reference 58:   if ($file == $this_plugin) {",
        "// Line_Reference 59:     $settings_link = '<a href=\"' . get_bloginfo('wpurl') . '/wp-admin/options-general.php?page=fastly-admin-panel\">Settings</a>';",
        "// Line_Reference 60:     array_unshift($links, $settings_link);",
        "// Line_Reference 61:   }",
        "// Line_Reference 62:   return $links;",
        "// Line_Reference 63: }",
        "// Line_Reference 64: add_filter('plugin_action_links', 'fastly_action_links', 10, 2);",
        "// Line_Reference 65: ",
        "// Line_Reference 66: // \"Look out honey, cause I'm using technology...\" - Iggy Pop",
        "// Line_Reference 67: ",
        "// Line_Reference 68: ?>"
    ]
}
