{
    "cve_id": "CVE-2015-10102",
    "cve_description": "A vulnerability, which was classified as critical, has been found in Freshdesk Plugin 1.7 on WordPress. Affected by this issue is some unknown functionality. The manipulation leads to open redirect. The attack may be launched remotely. Upgrading to version 1.8 is able to address this issue. The patch is identified as 2aaecd4e0c7c6c1dc4e6a593163d5f7aa0fa5d5b. It is recommended to upgrade the affected component. VDB-226118 is the identifier assigned to this vulnerability.",
    "cve_publish_date": "2023-04-17",
    "cwe_id": "CWE-601",
    "cwe_name": "URL Redirection to Untrusted Site ('Open Redirect')",
    "cwe_description": "A web application accepts a user-controlled input that specifies a link to an external site, and uses that link in a Redirect. This simplifies phishing attacks.",
    "commit_message": "Security fix for open redirect vulnerability\n\ngit-svn-id: https://plugins.svn.wordpress.org/freshdesk-support/trunk@1175214 b8457f37-d9ea-0310-8a92-e5e31aec5664",
    "type_of_change": "Modification",
    "filename_of_changes": "freshdesk-ext.php",
    "code_language": "PHP",
    "number_of_lines_added_for_mitigation": "71",
    "number_of_lines_deleted_vulnerable_to_cve": "35",
    "vulnerable_lines": [
        "// Line_Reference 4:   @version 1.7",
        "// Line_Reference 11:   Version: 1.7",
        "// Line_Reference 49: \tif ( $_REQUEST['wp-submit'] == \"Log In\" && is_a( $user, 'WP_User' ) ) {",
        "// Line_Reference 51: \t\t$freshdesk_options = get_option( 'freshdesk_options' );",
        "// Line_Reference 55: \t\t$ssl_url = $fd_redirect_to.\"/login/sso?name=\".urlencode($user->data->display_name).\"&email=\".urlencode($user->data->user_email).\"&timestamp=\".time().\"&hash=\".urlencode($hash_key);",
        "// Line_Reference 160: \tif ( ! preg_match(\"/\\b(?:(?:https?):\\/\\/|www\\.)[-a-z0-9+&@#\\/%?=~_|!:,.;]*[-a-z0-9+&@#\\/%=~_|]/i\", $url ) ) {",
        "// Line_Reference 161: \t\t$url ='';",
        "// Line_Reference 172: \t\t\t'Domain url cannot be blank', // error message",
        "// Line_Reference 201: \t$settings = array( 'freshdesk_domain_url' => $url, 'freshdesk_enable_sso' => $enable_sso, 'freshdesk_sso_key' => $sso_secret, 'freshdesk_api_key' => $api_key, 'freshdesk_enable_feedback' => $enable_feedback );",
        "// Line_Reference 243: \t\t\t$freshdesk_options = get_option( 'freshdesk_options' );",
        "// Line_Reference 255: \t\t\t\t$url = freshdesk_sso_login_url( $user_name, $user_email ,$hash_key );",
        "// Line_Reference 260: \t\t\t\t$domain = ( $_REQUEST['host_url'] ) ? get_domain_protocol().\"://\".$_REQUEST['host_url'] : $freshdesk_options['freshdesk_domain_url']; // Redirect to the host url if host url option is present with the request.",
        "// Line_Reference 268: \t\t\t$redirect_url = wp_login_url();",
        "// Line_Reference 269: \t\t\t// Sometimes we get the http referer and some times don't so to find if it is coming from Freshdesk we do a two condition check and if one is satisfied then Freshdesk is the referer.",
        "// Line_Reference 270: \t\t\t// Condition-1) Host url is a substring of http referer",
        "// Line_Reference 271: \t\t\t// Condition-2) Host url exists and the http_referer is empty because request from within wordpress seems to always have a referer.",
        "// Line_Reference 272: \t\t\t$condition_one = ( strpos($_SERVER['HTTP_REFERER'], $_REQUEST['host_url']) !== FALSE ) ? TRUE : FALSE;",
        "// Line_Reference 273: \t\t\t$condition_two = ( $_REQUEST['host_url'] && empty( $_SERVER['HTTP_REFERER'] ) );",
        "// Line_Reference 274: \t\t\tif ( $condition_one || $condition_two ) {",
        "// Line_Reference 275: \t\t\t\t$redirect_url = get_domain_protocol().\"://\".$_REQUEST['host_url'];",
        "// Line_Reference 276: \t\t\t}",
        "// Line_Reference 278: \t\t\theader( 'Location: '.$redirect_url );",
        "// Line_Reference 305: function get_domain_protocol() {",
        "// Line_Reference 306: \t$freshdesk_options= get_option( 'freshdesk_options' );",
        "// Line_Reference 307: \t$domain_url = $freshdesk_options['freshdesk_domain_url'];",
        "// Line_Reference 308: \t$temp_array = explode( \":\", $domain_url );",
        "// Line_Reference 309: \t$protocol = $temp_array[0];",
        "// Line_Reference 310: \treturn $protocol;",
        "// Line_Reference 311: }",
        "// Line_Reference 312: ",
        "// Line_Reference 313: function freshdesk_sso_login_url($user_name,$email,$hash_key){",
        "// Line_Reference 314: \t$host_url = $_GET['host_url'];",
        "// Line_Reference 315: \t$protocol = get_domain_protocol().\"://\";",
        "// Line_Reference 316: \t$domain = (empty($host_url) === true) ? $domain_url : $host_url; // Take the domain_url if host_url is null.",
        "// Line_Reference 317: \treturn $protocol.$domain.\"/login/sso?name=\".urlencode($user_name).\"&email=\".urlencode($email).\"&timestamp=\".time().\"&hash=\".urlencode($hash_key);"
    ]
}
