{
    "cve_id": "CVE-2022-39252",
    "cve_description": "matrix-rust-sdk is an implementation of a Matrix client-server library in Rust, and matrix-sdk-crypto is the Matrix encryption library. Prior to version 0.6, when a user requests a room key from their devices, the software correctly remembers the request. When the user receives a forwarded room key, the software accepts it without checking who the room key came from. This allows homeservers to try to insert room keys of questionable validity, potentially mounting an impersonation attack. Version 0.6 fixes this issue.",
    "cve_publish_date": "2022-09-29",
    "cwe_id": "CWE-287",
    "cwe_name": "Improper Authentication",
    "cwe_description": "When an actor claims to have a given identity, the product does not prove or insufficiently proves that the claim is correct.",
    "commit_message": "fix(crypto): Only accept forwarded room keys from our own trusted devices",
    "type_of_change": "Modification",
    "filename_of_changes": "olm_machine.py",
    "code_language": "Python",
    "number_of_lines_added_for_mitigation": "37",
    "number_of_lines_deleted_vulnerable_to_cve": "17",
    "vulnerable_lines": [
        "// Line_Reference 1185:     # This function is copyrighted under the Apache 2.0 license Zil0",
        "// Line_Reference 1186:     def _handle_forwarded_room_key_event(",
        "// Line_Reference 1188:         sender,  # type: str",
        "// Line_Reference 1189:         sender_key,  # type: str",
        "// Line_Reference 1190:         payload,  # type: Dict[Any, Any]",
        "// Line_Reference 1191:     ):",
        "// Line_Reference 1192:         # type: (...) -> Union[ForwardedRoomKeyEvent, BadEventType, None]",
        "// Line_Reference 1193:         event = ForwardedRoomKeyEvent.from_dict(payload, sender, sender_key)",
        "// Line_Reference 1194: ",
        "// Line_Reference 1195:         if isinstance(event, (BadEvent, UnknownBadEvent)):",
        "// Line_Reference 1196:             return event",
        "// Line_Reference 1197: ",
        "// Line_Reference 1202:             return None",
        "// Line_Reference 1203: ",
        "// Line_Reference 1204:         if event.session_id not in self.outgoing_key_requests:",
        "// Line_Reference 1208:             return None",
        "// Line_Reference 1244:         key_request = self.outgoing_key_requests.pop(key_request.request_id)"
    ]
}
