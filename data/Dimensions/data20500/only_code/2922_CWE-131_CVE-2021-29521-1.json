int num_batches = is_1d ? 1 : shape.flat<int64>()(0);