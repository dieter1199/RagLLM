nfs4_state_set_mode_locked(struct nfs4_state *state, mode_t mode)
if (state->state == mode)
if ((mode & FMODE_WRITE) != (state->state & FMODE_WRITE)) {
if (mode & FMODE_WRITE)
state->state = mode;
static void __nfs4_close(struct path *path, struct nfs4_state *state, mode_t mode, int wait)
int newstate;
switch (mode & (FMODE_READ | FMODE_WRITE)) {
void nfs4_close_state(struct path *path, struct nfs4_state *state, mode_t mode)
__nfs4_close(path, state, mode, 0);
void nfs4_close_sync(struct path *path, struct nfs4_state *state, mode_t mode)
__nfs4_close(path, state, mode, 1);