var contra = require('contra'),
path = require('path'),
fUtils = require('./files'),
cp = require('child_process');
var gitApp = 'git', gitExtra = { env: process.env };
if (typeof str === 'string') {
return str.replace(/(["$`\\])/g, '\\$1');
cp.exec(gitApp + ' ' + [ 'ls-files', '-m' ].join(' '), gitExtra, function (er, stdout, stderr) {
var lines = stdout.trim().split('\n').filter(function (line) {
var file = path.basename(line.replace(/.{1,2}\s+/, ''));
return line.trim() && !line.match(/^\?\? /) && !fUtils.isPackageFile(line);
}).map(function (line) {
return line.trim()
});
return callback(new Error('Git working directory not clean.\n'+lines.join('\n')));
cp.exec(gitApp + ' checkout -- .', gitExtra, callback);
message = message.replace('%s', newVer).replace('"', '').replace("'", '');
files = files.map(function (file) {
return '"' + escapeQuotes(file) + '"';
}).join(' ');
cp.exec(gitApp + ' add ' + files, gitExtra, done);
cp.exec([gitApp, 'commit', '-m', '"' + message + '"'].join(' '), gitExtra, done);
[
gitApp, 'tag', '-a', tagName, '-m', '"' + message + '"'
].join(' '),
gitExtra, done
}
