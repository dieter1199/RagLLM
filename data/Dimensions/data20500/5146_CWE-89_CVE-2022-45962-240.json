{
    "cve_id": "CVE-2022-45962",
    "cve_description": "Open Solutions for Education, Inc openSIS Community Edition v8.0 and earlier is vulnerable to SQL Injection via CalendarModal.php.",
    "cve_publish_date": "2023-02-13",
    "cwe_id": "CWE-89",
    "cwe_name": "Improper Neutralization of Special Elements used in an SQL Command ('SQL Injection')",
    "cwe_description": "The product constructs all or part of an SQL command using externally-influenced input from an upstream component, but it does not neutralize or incorrectly neutralizes special elements that could modify the intended SQL command when it is sent to a downstream component. Without sufficient removal or quoting of SQL syntax in user-controllable inputs, the generated SQL query can cause those inputs to be interpreted as SQL instead of ordinary user data.",
    "commit_message": "Version 9.0 release\n\nOlder version shifted to branch: Version_8.0",
    "type_of_change": "ModificationType.ADD",
    "filename_of_changes": "GoalInc.php",
    "code_language": "PHP",
    "number_of_lines_added_for_mitigation": "92",
    "number_of_lines_deleted_vulnerable_to_cve": "88",
    "vulnerable_lines": [
        "// Line_Reference 41: $gid = $_REQUEST[goal_id];",
        "// Line_Reference 42: $tabl = $_REQUEST[tabl];",
        "// Line_Reference 47:            // $_REQUEST['tables'][$id]['START_DATE'] = $_REQUEST['day_tables'][$id]['START_DATE'] . '-' . $_REQUEST['month_tables'][$id]['START_DATE'] . '-' . $_REQUEST['year_tables'][$id]['START_DATE'];",
        "// Line_Reference 48:             $_REQUEST['tables'][$id]['START_DATE'] =$_REQUEST['year_tables'][$id]['START_DATE']. '-' . $_REQUEST['month_tables'][$id]['START_DATE'] . '-' .$_REQUEST['day_tables'][$id]['START_DATE'] ;",
        "// Line_Reference 55: //            $_REQUEST['tables'][$id]['END_DATE'] = $_REQUEST['day_tables'][$id]['END_DATE'] . '-' . $_REQUEST['month_tables'][$id]['END_DATE'] . '-' . $_REQUEST['year_tables'][$id]['END_DATE'];",
        "// Line_Reference 56:            $_REQUEST['tables'][$id]['END_DATE'] =$_REQUEST['year_tables'][$id]['END_DATE'] . '-' . $_REQUEST['month_tables'][$id]['END_DATE'] . '-' .$_REQUEST['day_tables'][$id]['END_DATE']  ;",
        "// Line_Reference 95:     $where = array('student_goal' => 'GOAL_ID',",
        "// Line_Reference 97:         'course_periods' => 'COURSE_PERIOD_ID');",
        "// Line_Reference 127: ",
        "// Line_Reference 128:                 if ($table_name!='student_goal_progress' && ((strtotime($start_date) > strtotime($end_date) && $start_date != \"\" && $end_date != \"\") || (strtotime($row_s_date[1]['START_DATE']) > strtotime($end_date) && $row_s_date[1]['START_DATE'] != \"\" && $end_date != \"\") || (strtotime($start_date) > strtotime($row_s_date[1]['END_DATE']) && $start_date != \"\" && $row_s_date[1]['END_DATE'] != \"\") || (strtotime($row_s_date[1]['START_DATE']) > strtotime($row_s_date[1]['END_DATE']) && $row_s_date[1]['START_DATE'] != \"\" && $row_s_date[1]['END_DATE'] != \"\") || (strtotime($start_date) < strtotime($school_start_dt) || strtotime($start_date) > strtotime($school_end_dt)) || (strtotime($end_date) < strtotime($school_start_dt) || strtotime($end_date) > strtotime($school_end_dt)))) {",
        "// Line_Reference 129:                 {",
        "// Line_Reference 130:                     ShowErr(_dataNotSavedBecauseStartAndEndDateIsNotValid);",
        "// Line_Reference 131:                 }",
        "// Line_Reference 133: ",
        "// Line_Reference 145:                                 echo '<p style=color:red> '._progressEntryDateShouldBeBetweenGoalsStartDate.','._endDate.'</p>';",
        "// Line_Reference 148:                             }",
        "// Line_Reference 149:                             else",
        "// Line_Reference 150:                                 $sql.= 'START_DATE=\\'' . str_replace(\"'\", \"\\'\", $_REQUEST['tables'][$id]['START_DATE']) . '\\',';",
        "// Line_Reference 151:                         }",
        "// Line_Reference 152:                         else",
        "// Line_Reference 153:                             $sql.= 'START_DATE=\\'' . str_replace(\"'\", \"\\'\", $_REQUEST['tables'][$id]['START_DATE']) . '\\',';",
        "// Line_Reference 159:                                 $sql.= $column . '=\\'' . singleQuoteReplace('', '', $value) . '\\',';  // linux",
        "// Line_Reference 167:                         $sql.='START_DATE=\\'' . $row_s_date['START_DATE'] . '\\',';",
        "// Line_Reference 169:                         $sql.='END_DATE=\\'' . $row_s_date['END_DATE'] . '\\',';",
        "// Line_Reference 173:                         $sql.='START_DATE=\\'' . $start_date . '\\',';",
        "// Line_Reference 175:                         $sql.='END_DATE=\\'' . $end_date . '\\',';",
        "// Line_Reference 205:                     $id = DBGet(DBQuery('SHOW TABLE STATUS LIKE \\'student_goal\\''));",
        "// Line_Reference 206:                     $id[1]['ID'] = $id[1]['AUTO_INCREMENT'];",
        "// Line_Reference 209:                     $_REQUEST['goal_id'] = $id[1]['ID'];",
        "// Line_Reference 211: ",
        "// Line_Reference 212: ",
        "// Line_Reference 213:                     $id = DBGet(DBQuery('SHOW TABLE STATUS LIKE \\'student_goal_progress\\''));",
        "// Line_Reference 214:                     $id[1]['ID'] = $id[1]['AUTO_INCREMENT'];",
        "// Line_Reference 216:                     $values = '\\'' . $_REQUEST[hgoal] . '\\',\\'' . UserStudentID() . '\\',\\'' . $start_date . '\\',';",
        "// Line_Reference 217:                     $_REQUEST['progress_id'] = $id[1]['ID'];",
        "// Line_Reference 218: ",
        "// Line_Reference 219: ",
        "// Line_Reference 220:                     $chk_dt = DBGet(DBQuery('SELECT START_DATE,END_DATE from student_goal WHERE goal_id = ' . clean_param($_REQUEST[hgoal], PARAM_INT)));",
        "// Line_Reference 234:                         $values .= '\\'' . str_replace(\"'\", \"''\", singleQuoteReplace('', '',$value)) . '\\','; // linux",
        "// Line_Reference 239:                 $sql.='(' . substr($fields, 0, -1) . ') values(' . substr($values, 0, -1) . ')';",
        "// Line_Reference 243:                             ShowErr(''._progressEntryDateShouldBeBetweenGoalsStartDate.''._endDate.'');",
        "// Line_Reference 244: ",
        "// Line_Reference 261:                 }",
        "// Line_Reference 290:         DrawBC(\"\"._students.\" > \" . ProgramTitle());",
        "// Line_Reference 314: \t\t\t\t\t\tWHERE sgp.GOAL_ID=sg.GOAL_ID AND sgp.PROGRESS_ID=\\'' . $_REQUEST[progress_id] . '\\'';",
        "// Line_Reference 326: \t\t\t\t\t\tWHERE PROGRESS_ID=\\'' . $_REQUEST[progress_id] . '\\'';",
        "// Line_Reference 336: \t\t\t\t\t\tWHERE GOAL_ID=\\'' . $_REQUEST[goal_id] . '\\' ORDER BY GOAL_TITLE';",
        "// Line_Reference 359:                 $sql_gid = 'SELECT GOAL_ID FROM student_goal_progress WHERE PROGRESS_ID=\\'' . $_REQUEST[progress_id] . '\\'';",
        "// Line_Reference 382: ",
        "// Line_Reference 383: ",
        "// Line_Reference 391:                     $header .= \"<div class=\\\"col-md-6 text-right\\\"><a class=\\\"btn btn-danger btn-labeled btn-sm\\\" href='Modules.php?modname=students/Student.php&include=GoalInc&category_id=5&action=delete&gid=\" . $row_gid[1][\"GOAL_ID\"] . \"&pid=\" . $_REQUEST[progress_id] . \"'><b><i class=\\\"icon-cross\\\"></i></b> \"._deleteThisProgress.\"</a></div>\"; // DateInput is copied from schoolsetup/MarkingPeriods.php line 295",
        "// Line_Reference 395: ",
        "// Line_Reference 397:             $header .= '<div class=\"col-md-6\"><div class=\"form-group\">' . SelectInput($RET['GOAL_ID'] ? $RET['GOAL_ID'] : $_REQUEST['goal_id'], 'tables[student_goal_progress][' . $_REQUEST['progress_id'] . '][GOAL_ID]', _goalTitle, $options, false).'</div></div>'; // DateInput is copied from schoolsetup/MarkingPeriods.php line 295",
        "// Line_Reference 401:             $header .= '<input type=\"hidden\" name=\"hgoal\" value=\"' . $_REQUEST[goal_id] . '\" />';",
        "// Line_Reference 402: ",
        "// Line_Reference 403: ",
        "// Line_Reference 405:             $header .= '<div class=\"col-md-6\"><div class=\"form-group\"><label class=\"control-label text-right col-lg-4\">'._dateOfEntry.'</label><div class=\"col-lg-8\">' . DateInputAY($RET['START_DATE']!=\"\" ? $RET['START_DATE'] : \"\", 'tables[' . $_REQUEST['progress_id'] . '][START_DATE]', 1) . '</div></div></div>'; // DateInput is copied from schoolsetup/MarkingPeriods.php line 295",
        "// Line_Reference 406:             $options = array('0-10%' => '0-10%',",
        "// Line_Reference 407:              '11-20%' => '11-20%',",
        "// Line_Reference 408:              '21-30%' => '21-30%',",
        "// Line_Reference 409:              '31-40%' => '31-40%',",
        "// Line_Reference 410:              '41-50%' => '41-50%',",
        "// Line_Reference 411:              '51-60%' => '51-60%',",
        "// Line_Reference 412:              '61-70%' => '61-70%',",
        "// Line_Reference 413:              '71-80%' => '71-80%',",
        "// Line_Reference 414:              '81-90%' => '81-90%',",
        "// Line_Reference 415:              '91-100%' => '91-100%',",
        "// Line_Reference 419: ",
        "// Line_Reference 420:             $header .= '<div class=\"row\">';",
        "// Line_Reference 421:             $header .= '<div class=\"col-md-12\"><div class=\"form-group\"><label class=\"control-label text-right col-lg-2\">'._progressAssessment.'</label><div class=\"col-lg-10\">' . TextAreaInput($RET['PROGRESS_DESCRIPTION'], 'tables[student_goal_progress][' . $_REQUEST['progress_id'] . '][PROGRESS_DESCRIPTION]', '', 'rows=10 cols=57', 'true', '200px') . '<input type=\"hidden\" name=\"tabl\" id=\"tabl\" value=\"student_goal_progress\"></div></div></div>';",
        "// Line_Reference 424: ",
        "// Line_Reference 431: \t\t\t\t\t\tWHERE GOAL_ID=\\'' . $_REQUEST[goal_id] . '\\' and SYEAR=\\'' . UserSyear() . '\\'';",
        "// Line_Reference 470: ",
        "// Line_Reference 473:                     $header .= \"<div class=\\\"col-md-6 text-right\\\"><a class=\\\"btn btn-danger btn-labeled btn-sm\\\" href='Modules.php?modname=students/Student.php&include=GoalInc&category_id=5&action=delete_goal&gid=\" . $_REQUEST['goal_id'] . \"'><b><i class=\\\"icon-cross\\\"></i></b> \"._deleteThisGoal.\"</a></div>\"; // DateInput is copied from schoolsetup/MarkingPeriods.php line 295",
        "// Line_Reference 477: ",
        "// Line_Reference 478:             $header .= '<div class=\"row\">';",
        "// Line_Reference 479:             if ($_REQUEST[goal_id] . trim() != '')",
        "// Line_Reference 480:                 $header .= '<div class=\"col-md-6\"><div class=\"form-group\"><label class=\"control-label col-lg-4 text-right\">'._beginDate.'</label><div class=\"col-lg-8\"><input type=\"hidden\" name=\"goalId\" id=\"goalId\" value=\"' . $_REQUEST[goal_id] . '\" />' . DateInputAY($RET['START_DATE']!=\"\" ? $RET['START_DATE'] : \"\", 'tables[' . $_REQUEST['goal_id'] . '][START_DATE]', 2) . '</div></div></div>'; // DateInput is copied from schoolsetup/MarkingPeriods.php line 295",
        "// Line_Reference 482:                 $header .= '<div class=\"col-md-6\"><div class=\"form-group\"><label class=\"control-label col-lg-4 text-right\">'._beginDate.'</label><div class=\"col-lg-8\"><input type=\"hidden\" name=\"goalId\" id=\"goalId\" value=\"new\" />' . DateInputAY($RET['START_DATE']!=\"\" ? $RET['START_DATE'] : \"\", 'tables[' . $_REQUEST['goal_id'] . '][START_DATE]', 2) . '</div></div></div>'; // DateInput is copied from schoolsetup/MarkingPeriods.php line 295",
        "// Line_Reference 484:             $header .= '<div class=\"col-md-6\"><div class=\"form-group\"><label class=\"control-label col-lg-4 text-right\">'._endDate.'</label><div class=\"col-lg-8\">' . DateInputAY($RET['END_DATE']!=\"\" ? $RET['END_DATE'] : \"\", 'tables[' . $_REQUEST['goal_id'] . '][END_DATE]', 3) . '</div></div></div>'; // DateInput is copied from schoolsetup/MarkingPeriods.php line 296",
        "// Line_Reference 486: ",
        "// Line_Reference 488:             $header .= '<div class=\"col-md-12\"><div class=\"form-group\"><label class=\"control-label col-lg-2 text-right\">'._goalDescription.'</label><div class=\"col-lg-10\">' . TextAreaInput($RET['GOAL_DESCRIPTION'], 'tables[student_goal][' . $_REQUEST['goal_id'] . '][GOAL_DESCRIPTION]', '', 'rows=10 cols=70', 'true', '200px') . '<input type=\"hidden\" name=\"tabl\" id=\"tabl\" value=\"student_goal\"></div></div></div>';",
        "// Line_Reference 490: ",
        "// Line_Reference 498:     $LO_options = array('save' =>false, 'search' =>false);",
        "// Line_Reference 516:     $columns = array('GOAL_TITLE' =>_goals);",
        "// Line_Reference 529:         $sql_goal = DBQuery('SELECT GOAL_ID FROM student_goal WHERE GOAL_ID=\\'' . $_REQUEST[goal_id] . '\\' and SYEAR=\\'' . UserSyear() . '\\'');",
        "// Line_Reference 546:         $columns = array('PROGRESS_NAME' =>_progresses);",
        "// Line_Reference 572: ?>"
    ]
}
