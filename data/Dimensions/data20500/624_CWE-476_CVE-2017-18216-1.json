{
    "cve_id": "CVE-2017-18216",
    "cve_description": "In fs/ocfs2/cluster/nodemanager.c in the Linux kernel before 4.15, local users can cause a denial of service (NULL pointer dereference and BUG) because a required mutex is not used.",
    "cve_publish_date": "2018-03-05",
    "cwe_id": "CWE-476",
    "cwe_name": "NULL Pointer Dereference",
    "cwe_description": "The product dereferences a pointer that it expects to be valid but is NULL.",
    "commit_message": "ocfs2: subsystem.su_mutex is required while accessing the item->ci_parent\n\nThe subsystem.su_mutex is required while accessing the item->ci_parent,\notherwise, NULL pointer dereference to the item->ci_parent will be\ntriggered in the following situation:\n\nadd node                     delete node\nsys_write\n vfs_write\n  configfs_write_file\n   o2nm_node_store\n    o2nm_node_local_write\n                             do_rmdir\n                              vfs_rmdir\n                               configfs_rmdir\n                                mutex_lock(&subsys->su_mutex);\n                                unlink_obj\n                                 item->ci_group = NULL;\n                                 item->ci_parent = NULL;\n\t to_o2nm_cluster_from_node\n\t  node->nd_item.ci_parent->ci_parent\n\t  BUG since of NULL pointer dereference to nd_item.ci_parent\n\nMoreover, the o2nm_cluster also should be protected by the\nsubsystem.su_mutex.\n\n[alex.chen@huawei.com: v2]\n  Link: http://lkml.kernel.org/r/59EEAA69.9080703@huawei.com\nLink: http://lkml.kernel.org/r/59E9B36A.10700@huawei.com\nSigned-off-by: Alex Chen <alex.chen@huawei.com>\nReviewed-by: Jun Piao <piaojun@huawei.com>\nReviewed-by: Joseph Qi <jiangqi903@gmail.com>\nCc: Mark Fasheh <mfasheh@versity.com>\nCc: Joel Becker <jlbec@evilplan.org>\nCc: Junxiao Bi <junxiao.bi@oracle.com>\nSigned-off-by: Andrew Morton <akpm@linux-foundation.org>\nSigned-off-by: Linus Torvalds <torvalds@linux-foundation.org>",
    "type_of_change": "Modification",
    "filename_of_changes": "nodemanager.c",
    "code_language": "C",
    "number_of_lines_added_for_mitigation": "55",
    "number_of_lines_deleted_vulnerable_to_cve": "8",
    "vulnerable_lines": [
        "// Line_Reference 184: \treturn to_o2nm_cluster(node->nd_item.ci_parent->ci_parent);",
        "// Line_Reference 197: \tstruct o2nm_cluster *cluster = to_o2nm_cluster_from_node(node);",
        "// Line_Reference 272: \tstruct o2nm_cluster *cluster = to_o2nm_cluster_from_node(node);",
        "// Line_Reference 318: \tstruct o2nm_cluster *cluster = to_o2nm_cluster_from_node(node);",
        "// Line_Reference 339: \t    cluster->cl_local_node != node->nd_num)",
        "// Line_Reference 340: \t\treturn -EBUSY;",
        "// Line_Reference 346: \t\t\treturn ret;",
        "// Line_Reference 361: \treturn count;"
    ]
}
