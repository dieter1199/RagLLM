{
    "cve_id": "CVE-2011-3346",
    "cve_description": "Buffer overflow in hw/scsi-disk.c in the SCSI subsystem in QEMU before 0.15.2, as used by Xen, might allow local guest users with permission to access the CD-ROM to cause a denial of service (guest crash) via a crafted SAI READ CAPACITY SCSI command.  NOTE: this is only a vulnerability when root has manually modified certain permissions or ACLs.",
    "cve_publish_date": "2014-04-01",
    "cwe_id": "CWE-119",
    "cwe_name": "Improper Restriction of Operations within the Bounds of a Memory Buffer",
    "cwe_description": "The product performs operations on a memory buffer, but it reads from or writes to a memory location outside the buffer's intended boundary. This may result in read or write operations on unexpected memory locations that could be linked to other variables, data structures, or internal program data.",
    "commit_message": "scsi-disk: commonize iovec creation between reads and writes\n\nAlso, consistently use qiov.size instead of iov.iov_len.\n\nSigned-off-by: Paolo Bonzini <pbonzini@redhat.com>\nSigned-off-by: Kevin Wolf <kwolf@redhat.com>",
    "type_of_change": "Modification",
    "filename_of_changes": "scsi-disk.c",
    "code_language": "C",
    "number_of_lines_added_for_mitigation": "18",
    "number_of_lines_deleted_vulnerable_to_cve": "24",
    "vulnerable_lines": [
        "// Line_Reference 128:     DPRINTF(\"Data ready tag=0x%x len=%zd\\n\", r->req.tag, r->iov.iov_len);",
        "// Line_Reference 130:     n = r->iov.iov_len / 512;",
        "// Line_Reference 133:     scsi_req_data(&r->req, r->iov.iov_len);",
        "// Line_Reference 184:     n = r->sector_count;",
        "// Line_Reference 185:     if (n > SCSI_DMA_BUF_SIZE / 512)",
        "// Line_Reference 186:         n = SCSI_DMA_BUF_SIZE / 512;",
        "// Line_Reference 187: ",
        "// Line_Reference 191:     r->iov.iov_len = n * 512;",
        "// Line_Reference 192:     qemu_iovec_init_external(&r->qiov, &r->iov, 1);",
        "// Line_Reference 193: ",
        "// Line_Reference 242:     uint32_t len;",
        "// Line_Reference 256:     n = r->iov.iov_len / 512;",
        "// Line_Reference 262:         len = r->sector_count * 512;",
        "// Line_Reference 263:         if (len > SCSI_DMA_BUF_SIZE) {",
        "// Line_Reference 264:             len = SCSI_DMA_BUF_SIZE;",
        "// Line_Reference 265:         }",
        "// Line_Reference 266:         r->iov.iov_len = len;",
        "// Line_Reference 267:         DPRINTF(\"Write complete tag=0x%x more=%d\\n\", r->req.tag, len);",
        "// Line_Reference 268:         scsi_req_data(&r->req, len);",
        "// Line_Reference 287:     n = r->iov.iov_len / 512;",
        "// Line_Reference 292:         qemu_iovec_init_external(&r->qiov, &r->iov, 1);",
        "// Line_Reference 293: ",
        "// Line_Reference 296:                                    scsi_write_complete, r);",
        "// Line_Reference 301:         /* Invoke completion routine to fetch data from host.  */"
    ]
}
