{
    "cve_id": "CVE-2023-1754",
    "cve_description": "Improper Neutralization of Input During Web Page Generation in GitHub repository thorsten/phpmyfaq prior to 3.1.12.",
    "cve_publish_date": "2023-03-31",
    "cwe_id": "CWE-79",
    "cwe_name": "Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting')",
    "cwe_description": "The product does not neutralize or incorrectly neutralizes user-controllable input before it is placed in output that is used as a web page that is served to other users.",
    "commit_message": "fix: added missing conversion to HTML entities, removed obsolete code",
    "type_of_change": "Modification",
    "filename_of_changes": "group.php",
    "code_language": "PHP",
    "number_of_lines_added_for_mitigation": "5",
    "number_of_lines_deleted_vulnerable_to_cve": "72",
    "vulnerable_lines": [
        "// Line_Reference 174:               <?= $PMF_LANG['ad_group_deleteGroup'] ?> \"<?= $groupData['name'] ?>\"",
        "// Line_Reference 229:     $groupName = Filter::filterInput(INPUT_POST, 'group_name', FILTER_UNSAFE_RAW, '');",
        "// Line_Reference 230:     $groupDescription = Filter::filterInput(INPUT_POST, 'group_description', FILTER_UNSAFE_RAW, '');",
        "// Line_Reference 239:     if ($groupName == '') {",
        "// Line_Reference 339: // Import LDAP groups",
        "// Line_Reference 340: /*",
        "// Line_Reference 341: if ('import-ldap-groups' === $groupAction && $user->perm->hasPermission($user->getUserId(), 'addgroup')) {",
        "// Line_Reference 342:     $user = new CurrentUser($faqConfig);",
        "// Line_Reference 343:     $message = '';",
        "// Line_Reference 344:     $messages = [];",
        "// Line_Reference 345: ",
        "// Line_Reference 346:     // Temporary data",
        "// Line_Reference 347:     $groupName = 'LDAP Group';",
        "// Line_Reference 348:     $groupDescription = 'This is a LDAP group import demo';",
        "// Line_Reference 349:     $groupAutoJoin = false;",
        "// Line_Reference 350: ",
        "// Line_Reference 351:     $csrfOkay = true;",
        "// Line_Reference 352:     $csrfToken = Filter::filterInput(INPUT_POST, 'csrf', FILTER_UNSAFE_RAW);",
        "// Line_Reference 353: ",
        "// Line_Reference 354:     if (!isset($_SESSION['phpmyfaq_csrf_token']) || $_SESSION['phpmyfaq_csrf_token'] !== $csrfToken) {",
        "// Line_Reference 355:         $csrfOkay = false;",
        "// Line_Reference 356:     }",
        "// Line_Reference 357: ",
        "// Line_Reference 358:     // check group name",
        "// Line_Reference 359:     if ($groupName == '') {",
        "// Line_Reference 360:         $messages[] = $PMF_LANG['ad_group_error_noName'];",
        "// Line_Reference 361:     }",
        "// Line_Reference 362: ",
        "// Line_Reference 363:     // ok, let's go",
        "// Line_Reference 364:     if (count($messages) == 0 && $csrfOkay) {",
        "// Line_Reference 365:         // create group",
        "// Line_Reference 366:         $groupData = [",
        "// Line_Reference 367:             'name' => $groupName,",
        "// Line_Reference 368:             'description' => $groupDescription,",
        "// Line_Reference 369:             'auto_join' => $groupAutoJoin,",
        "// Line_Reference 370:         ];",
        "// Line_Reference 371: ",
        "// Line_Reference 372:         if ($user->perm->addGroup($groupData) <= 0) {",
        "// Line_Reference 373:             $messages[] = $PMF_LANG['ad_adus_dberr'];",
        "// Line_Reference 374:         }",
        "// Line_Reference 375:     }",
        "// Line_Reference 376: ",
        "// Line_Reference 377:     // no errors, show list",
        "// Line_Reference 378:     if (count($messages) == 0) {",
        "// Line_Reference 379:         $groupAction = $defaultGroupAction;",
        "// Line_Reference 380:         $message = sprintf('<p class=\"alert alert-success\">%s</p>', $PMF_LANG['ad_group_suc']);",
        "// Line_Reference 381:         // display error messages and show form again",
        "// Line_Reference 382:     } else {",
        "// Line_Reference 383:         $groupAction = 'import-ldap-groups';",
        "// Line_Reference 384:         $message = '<p class=\"alert alert-danger\">';",
        "// Line_Reference 385:         foreach ($messages as $err) {",
        "// Line_Reference 386:             $message .= $err . '<br>';",
        "// Line_Reference 387:         }",
        "// Line_Reference 388:         $message .= '</p>';",
        "// Line_Reference 389:     }",
        "// Line_Reference 390: }",
        "// Line_Reference 391: */",
        "// Line_Reference 392: ",
        "// Line_Reference 419:       <!--",
        "// Line_Reference 420:       <div class=\"card mb-4\">",
        "// Line_Reference 421:         <div class=\"card-header py-3\">",
        "// Line_Reference 422:           <form id=\"group-import-ldap-groups\" method=\"post\"",
        "// Line_Reference 423:                 name=\"group-import-ldap-groups\" action=\"?action=group&amp;group_action=import-ldap-groups\">",
        "// Line_Reference 424:             <input type=\"hidden\" name=\"csrf\" value=\"<?= $currentUser->getCsrfTokenFromSession() ?>\">",
        "// Line_Reference 425:             <button class=\"btn btn-success\" type=\"submit\">",
        "// Line_Reference 426:               Import LDAP groups",
        "// Line_Reference 427:             </button>",
        "// Line_Reference 428:           </form>",
        "// Line_Reference 429:         </div>",
        "// Line_Reference 430:       </div>",
        "// Line_Reference 431:       -->",
        "// Line_Reference 432: "
    ]
}
