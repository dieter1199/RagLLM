{
    "cve_id": "CVE-2021-21240",
    "cve_description": "httplib2 is a comprehensive HTTP client library for Python. In httplib2 before version 0.19.0, a malicious server which responds with long series of \"\\xa0\" characters in the \"www-authenticate\" header may cause Denial of Service (CPU burn while parsing header) of the httplib2 client accessing said server. This is fixed in version 0.19.0 which contains a new implementation of auth headers parsing using the pyparsing library.",
    "cve_publish_date": "2021-02-08",
    "cwe_id": "CWE-400",
    "cwe_name": "Uncontrolled Resource Consumption",
    "cwe_description": "The product does not properly control the allocation and maintenance of a limited resource, thereby enabling an actor to influence the amount of resources consumed, eventually leading to the exhaustion of available resources.",
    "commit_message": "parse auth headers using pyparsing instead of regexp\n\nFixes CPU burn DoS by cubic complexity of whitespace matching in\nWWW_AUTH_RELAXED (default) regexp.",
    "type_of_change": "Modification",
    "filename_of_changes": "test_auth.py",
    "code_language": "Python",
    "number_of_lines_added_for_mitigation": "83",
    "number_of_lines_deleted_vulnerable_to_cve": "129",
    "vulnerable_lines": [
        "// Line_Reference 29:     handler = tests.http_reflect_with_auth(",
        "// Line_Reference 30:         allow_scheme=\"basic\", allow_credentials=((\"joe\", password),)",
        "// Line_Reference 31:     )",
        "// Line_Reference 44:     handler = tests.http_reflect_with_auth(",
        "// Line_Reference 45:         allow_scheme=\"basic\", allow_credentials=((\"joe\", password),)",
        "// Line_Reference 46:     )",
        "// Line_Reference 65:     handler = tests.http_reflect_with_auth(",
        "// Line_Reference 66:         allow_scheme=\"basic\", allow_credentials=allowed",
        "// Line_Reference 67:     )",
        "// Line_Reference 84:     handler = tests.http_reflect_with_auth(",
        "// Line_Reference 85:         allow_scheme=\"digest\", allow_credentials=((\"joe\", password),)",
        "// Line_Reference 86:     )",
        "// Line_Reference 102:         allow_scheme=\"digest\",",
        "// Line_Reference 103:         allow_credentials=((\"joe\", password),),",
        "// Line_Reference 104:         out_renew_nonce=grenew_nonce,",
        "// Line_Reference 109:         info = httplib2._parse_www_authenticate(response1, \"authentication-info\")",
        "// Line_Reference 111:         assert info.get(\"digest\", {}).get(\"nc\") == \"00000001\", info",
        "// Line_Reference 114:         info2 = httplib2._parse_www_authenticate(response2, \"authentication-info\")",
        "// Line_Reference 115:         assert info2.get(\"digest\", {}).get(\"nc\") == \"00000002\", info2",
        "// Line_Reference 118:         info3 = httplib2._parse_www_authenticate(response3, \"authentication-info\")",
        "// Line_Reference 120:         assert info3.get(\"digest\", {}).get(\"nc\") == \"00000001\", info3",
        "// Line_Reference 139:         info = httplib2._parse_www_authenticate(",
        "// Line_Reference 140:             requests[0][1].headers, \"www-authenticate\"",
        "// Line_Reference 141:         )",
        "// Line_Reference 147:         info2 = httplib2._parse_www_authenticate(",
        "// Line_Reference 148:             requests[2][1].headers, \"www-authenticate\"",
        "// Line_Reference 149:         )",
        "// Line_Reference 163:             {",
        "// Line_Reference 164:                 \"www-authenticate\": 'Test realm=\"test realm\" , foo=foo ,bar=\"bar\", baz=baz,qux=qux'",
        "// Line_Reference 165:             },",
        "// Line_Reference 166:             {",
        "// Line_Reference 167:                 \"test\": {",
        "// Line_Reference 168:                     \"realm\": \"test realm\",",
        "// Line_Reference 169:                     \"foo\": \"foo\",",
        "// Line_Reference 170:                     \"bar\": \"bar\",",
        "// Line_Reference 171:                     \"baz\": \"baz\",",
        "// Line_Reference 172:                     \"qux\": \"qux\",",
        "// Line_Reference 173:                 }",
        "// Line_Reference 174:             },",
        "// Line_Reference 180:         (",
        "// Line_Reference 181:             {\"www-authenticate\": 'Test realm=\"a \\\\\"test\\\\\" realm\"'},",
        "// Line_Reference 182:             {\"test\": {\"realm\": 'a \"test\" realm'}},",
        "// Line_Reference 183:         ),",
        "// Line_Reference 185:         (",
        "// Line_Reference 186:             {\"www-authenticate\": 'Basic realm=\"me\", algorithm=\"MD5\"'},",
        "// Line_Reference 187:             {\"basic\": {\"realm\": \"me\", \"algorithm\": \"MD5\"}},",
        "// Line_Reference 188:         ),",
        "// Line_Reference 189:         (",
        "// Line_Reference 190:             {\"www-authenticate\": 'Basic realm=\"me\", algorithm=MD5'},",
        "// Line_Reference 191:             {\"basic\": {\"realm\": \"me\", \"algorithm\": \"MD5\"}},",
        "// Line_Reference 192:         ),",
        "// Line_Reference 193:         (",
        "// Line_Reference 194:             {\"www-authenticate\": 'Basic realm=\"me\",other=\"fred\" '},",
        "// Line_Reference 195:             {\"basic\": {\"realm\": \"me\", \"other\": \"fred\"}},",
        "// Line_Reference 196:         ),",
        "// Line_Reference 199:             {",
        "// Line_Reference 200:                 \"www-authenticate\": 'Digest realm=\"digest1\", qop=\"auth,auth-int\", nonce=\"7102dd2\", opaque=\"e9517f\"'",
        "// Line_Reference 201:             },",
        "// Line_Reference 202:             {",
        "// Line_Reference 203:                 \"digest\": {",
        "// Line_Reference 204:                     \"realm\": \"digest1\",",
        "// Line_Reference 205:                     \"qop\": \"auth,auth-int\",",
        "// Line_Reference 206:                     \"nonce\": \"7102dd2\",",
        "// Line_Reference 207:                     \"opaque\": \"e9517f\",",
        "// Line_Reference 208:                 }",
        "// Line_Reference 209:             },",
        "// Line_Reference 211:         # multiple schema choice",
        "// Line_Reference 213:             {",
        "// Line_Reference 214:                 \"www-authenticate\": 'Digest realm=\"multi-d\", nonce=\"8b11d0f6\", opaque=\"cc069c\" Basic realm=\"multi-b\" '",
        "// Line_Reference 215:             },",
        "// Line_Reference 216:             {",
        "// Line_Reference 217:                 \"digest\": {\"realm\": \"multi-d\", \"nonce\": \"8b11d0f6\", \"opaque\": \"cc069c\"},",
        "// Line_Reference 218:                 \"basic\": {\"realm\": \"multi-b\"},",
        "// Line_Reference 219:             },",
        "// Line_Reference 221:         # FIXME",
        "// Line_Reference 222:         # comma between schemas (glue for multiple headers with same name)",
        "// Line_Reference 223:         # ({'www-authenticate': 'Digest realm=\"2-comma-d\", qop=\"auth-int\", nonce=\"c0c8ff1\", Basic realm=\"2-comma-b\"'},",
        "// Line_Reference 224:         #  {'digest': {'realm': '2-comma-d', 'qop': 'auth-int', 'nonce': 'c0c8ff1'},",
        "// Line_Reference 225:         #   'basic': {'realm': '2-comma-b'}}),",
        "// Line_Reference 226:         # FIXME",
        "// Line_Reference 228:         # ({'www-authenticate': 'Digest realm=\"com3d\", Basic realm=\"com3b\", WSSE realm=\"com3w\", profile=\"token\"'},",
        "// Line_Reference 229:         #  {'digest': {'realm': 'com3d'}, 'basic': {'realm': 'com3b'}, 'wsse': {'realm': 'com3w', profile': 'token'}}),",
        "// Line_Reference 240:             {",
        "// Line_Reference 241:                 \"www-authenticate\": 'Digest realm=\"myrealm\", nonce=\"KBAA=3\", algorithm=MD5, qop=\"auth\", stale=true'",
        "// Line_Reference 242:             },",
        "// Line_Reference 243:             {",
        "// Line_Reference 244:                 \"digest\": {",
        "// Line_Reference 245:                     \"realm\": \"myrealm\",",
        "// Line_Reference 246:                     \"nonce\": \"KBAA=3\",",
        "// Line_Reference 247:                     \"algorithm\": \"MD5\",",
        "// Line_Reference 248:                     \"qop\": \"auth\",",
        "// Line_Reference 249:                     \"stale\": \"true\",",
        "// Line_Reference 250:                 }",
        "// Line_Reference 251:             },",
        "// Line_Reference 262:         assert httplib2._parse_www_authenticate(headers) == info",
        "// Line_Reference 267: def test_parse_www_authenticate_malformed():",
        "// Line_Reference 269:     with tests.assert_raises(httplib2.MalformedHeader):",
        "// Line_Reference 270:         httplib2._parse_www_authenticate(",
        "// Line_Reference 271:             {",
        "// Line_Reference 272:                 \"www-authenticate\": 'OAuth \"Facebook Platform\" \"invalid_token\" \"Invalid OAuth access token.\"'",
        "// Line_Reference 273:             }",
        "// Line_Reference 274:         )",
        "// Line_Reference 282:     response = {",
        "// Line_Reference 283:         \"www-authenticate\": 'Digest realm=\"myrealm\", nonce=\"KBAA=35\", algorithm=MD5, qop=\"auth\"'",
        "// Line_Reference 284:     }",
        "// Line_Reference 287:     d = httplib2.DigestAuthentication(",
        "// Line_Reference 288:         credentials, host, request_uri, headers, response, content, None",
        "// Line_Reference 289:     )",
        "// Line_Reference 294:         'nonce=\"KBAA=35\", uri=\"/test/digest/\"'",
        "// Line_Reference 295:         + ', algorithm=MD5, response=\"de6d4a123b80801d0e94550411b6283f\", '",
        "// Line_Reference 307:         \"www-authenticate\": 'Digest realm=\"myrealm\", nonce=\"30352fd\", algorithm=MD5, '",
        "// Line_Reference 308:         'qop=\"auth\", opaque=\"atestopaque\"'",
        "// Line_Reference 312:     d = httplib2.DigestAuthentication(",
        "// Line_Reference 313:         credentials, host, request_uri, headers, response, content, None",
        "// Line_Reference 314:     )",
        "// Line_Reference 332:     response[\"www-authenticate\"] = (",
        "// Line_Reference 333:         'Digest realm=\"myrealm\", nonce=\"bd669f\", '",
        "// Line_Reference 334:         'algorithm=MD5, qop=\"auth\", stale=true'",
        "// Line_Reference 335:     )",
        "// Line_Reference 338:     d = httplib2.DigestAuthentication(",
        "// Line_Reference 339:         credentials, host, request_uri, headers, response, content, None",
        "// Line_Reference 340:     )",
        "// Line_Reference 351:     response[\"www-authenticate\"] = (",
        "// Line_Reference 352:         'Digest realm=\"myrealm\", nonce=\"barney\", '",
        "// Line_Reference 353:         'algorithm=MD5, qop=\"auth\", stale=true'",
        "// Line_Reference 354:     )",
        "// Line_Reference 357:     d = httplib2.DigestAuthentication(",
        "// Line_Reference 358:         credentials, host, request_uri, headers, response, content, None",
        "// Line_Reference 359:     )"
    ]
}
