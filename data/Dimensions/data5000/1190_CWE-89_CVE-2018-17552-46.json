{
    "cve_id": "CVE-2018-17552",
    "cve_description": "SQL Injection in login.php in Naviwebs Navigate CMS 2.8 allows remote attackers to bypass authentication via the navigate-user cookie.",
    "cve_publish_date": "2018-10-03",
    "cwe_id": "CWE-89",
    "cwe_name": "Improper Neutralization of Special Elements used in an SQL Command ('SQL Injection')",
    "cwe_description": "The product constructs all or part of an SQL command using externally-influenced input from an upstream component, but it does not neutralize or incorrectly neutralizes special elements that could modify the intended SQL command when it is sent to a downstream component. Without sufficient removal or quoting of SQL syntax in user-controllable inputs, the generated SQL query can cause those inputs to be interpreted as SQL instead of ordinary user data.",
    "commit_message": "* security fix: replace string filtering by parameterization in almost all queries",
    "type_of_change": "Modification",
    "filename_of_changes": "products.php",
    "code_language": "PHP",
    "number_of_lines_added_for_mitigation": "169",
    "number_of_lines_deleted_vulnerable_to_cve": "99",
    "vulnerable_lines": [
        "// Line_Reference 40:                     $tag = $_REQUEST['tag'];",
        "// Line_Reference 41:                     $lang = $_REQUEST['lang'];",
        "// Line_Reference 42: ",
        "// Line_Reference 50:                                     AND d.lang = '.protect($lang).'",
        "// Line_Reference 51:                                     AND d.website = '.$website->id.'",
        "// Line_Reference 54:                                  WHERE website = ' . $website->id . '",
        "// Line_Reference 57:                                    AND lang = ' . protect($lang) . '",
        "// Line_Reference 58:                                    AND FIND_IN_SET('.protect($tag).', text) > 0",
        "// Line_Reference 60:                         ORDER BY p.id DESC",
        "// Line_Reference 61:                     ');",
        "// Line_Reference 109: \t\t\t\t\t$where      =   ' p.website = '.$website->id;",
        "// Line_Reference 156: \t\t\t\t\t$sql = ' SELECT SQL_CALC_FOUND_ROWS",
        "// Line_Reference 157: \t\t\t\t\t                p.*, d.text as title, d.lang as language,",
        "// Line_Reference 158:                                     u.username as author_username,",
        "// Line_Reference 159:                                     (   SELECT COUNT(*)",
        "// Line_Reference 160:                                         FROM nv_comments cm",
        "// Line_Reference 161:                                         WHERE cm.object_type = \"product\"",
        "// Line_Reference 162:                                           AND cm.object_id = p.id",
        "// Line_Reference 163:                                           AND cm.website = '.$website->id.'",
        "// Line_Reference 164:                                     ) as comments",
        "// Line_Reference 165: \t\t\t\t\t\t\t   FROM nv_products p",
        "// Line_Reference 166: \t\t\t\t\t\t  LEFT JOIN nv_webdictionary d",
        "// Line_Reference 167: \t\t\t\t\t\t  \t\t \t ON p.id = d.node_id",
        "// Line_Reference 168: \t\t\t\t\t\t\t\t \tAND d.node_type = \"product\"",
        "// Line_Reference 169: \t\t\t\t\t\t\t\t\tAND d.subtype = \"title\"",
        "// Line_Reference 170: \t\t\t\t\t\t\t\t\tAND d.lang = '.protect($website->languages_list[0]).'",
        "// Line_Reference 171: \t\t\t\t\t\t\t\t\tAND d.website = '.$website->id.'",
        "// Line_Reference 172: \t\t\t\t\t\t  LEFT JOIN nv_users u",
        "// Line_Reference 173: \t\t\t\t\t\t  \t\t\t ON u.id = p.author",
        "// Line_Reference 174: \t\t\t\t\t\t\t  WHERE '.$where.'",
        "// Line_Reference 175: \t\t\t\t\t\t   ORDER BY '.$orderby.'",
        "// Line_Reference 176: \t\t\t\t\t\t\t  LIMIT '.$max.'",
        "// Line_Reference 177: \t\t\t\t\t\t\t OFFSET '.$offset;",
        "// Line_Reference 178: ",
        "// Line_Reference 179: \t\t\t\t\tif(!$DB->query($sql, 'array'))",
        "// Line_Reference 180: \t\t\t\t\t\tthrow new Exception($DB->get_last_error());",
        "// Line_Reference 461: \t\t\t$DB->query('SELECT id, date_created, autosave",
        "// Line_Reference 462: \t\t\t\t\t\t  FROM nv_webdictionary_history",
        "// Line_Reference 463: \t\t\t\t\t\t WHERE node_type = \"product\"",
        "// Line_Reference 464: \t\t\t\t\t\t   AND subtype = '.protect('section-'.$_REQUEST['section']).'",
        "// Line_Reference 465: \t\t\t\t\t\t   AND lang = '.protect($_GET['lang']).'",
        "// Line_Reference 466: \t\t\t\t\t\t   AND node_id = '.protect($_REQUEST['id']).'",
        "// Line_Reference 467: \t\t\t\t\t\t   AND website = '.$website->id.'",
        "// Line_Reference 468: \t\t\t\t      ORDER BY date_created DESC',",
        "// Line_Reference 469: \t\t\t\t\t\t'array');",
        "// Line_Reference 493: \t\t\t\t   AND lang = '.protect($_REQUEST['lang']).'",
        "// Line_Reference 494: \t\t\t\t   AND website = '.$website->id.'",
        "// Line_Reference 495: \t\t\t\t   AND text LIKE '.protect('%'.$_REQUEST['title'].'%').'",
        "// Line_Reference 498: \t\t\t\t'array'",
        "// Line_Reference 513: \t\t\t\t$DB->query('SELECT text",
        "// Line_Reference 514: \t\t\t\t\t\t\t  FROM nv_webdictionary_history",
        "// Line_Reference 515: \t\t\t\t\t\t\t WHERE node_type = \"product\"",
        "// Line_Reference 516: \t\t\t\t\t\t\t   AND website = '.$website->id.'",
        "// Line_Reference 517: \t\t\t\t\t\t\t   AND id = '.protect($_REQUEST['id']),",
        "// Line_Reference 518: \t\t\t\t\t\t\t'array');",
        "// Line_Reference 525: \t\t\t\t$DB->query('SELECT text",
        "// Line_Reference 526: \t\t\t\t\t\t\t  FROM nv_webdictionary",
        "// Line_Reference 527: \t\t\t\t\t\t\t WHERE node_type = \"product\"",
        "// Line_Reference 528: \t\t\t\t\t\t\t   AND subtype = '.protect('section-'.$_REQUEST['section']).'",
        "// Line_Reference 529: \t\t\t\t\t\t\t   AND lang = '.protect($_REQUEST['lang']).'",
        "// Line_Reference 530: \t\t\t\t\t\t\t   AND website = '.$website->id.'",
        "// Line_Reference 531: \t\t\t\t\t\t\t   AND node_id = '.protect($_REQUEST['node_id']),",
        "// Line_Reference 532: \t\t\t\t\t\t\t'array');",
        "// Line_Reference 539: \t\t\t\t$DB->query('SELECT text",
        "// Line_Reference 540: \t\t\t\t\t\t\t  FROM nv_webdictionary",
        "// Line_Reference 541: \t\t\t\t\t\t\t WHERE node_type = \"property-product\"",
        "// Line_Reference 542: \t\t\t\t\t\t\t   AND subtype = '.protect('property-'.$_REQUEST['section'].'-'.$_REQUEST['lang']).'",
        "// Line_Reference 543: \t\t\t\t\t\t\t   AND lang = '.protect($_REQUEST['lang']).'",
        "// Line_Reference 544: \t\t\t\t\t\t\t   AND website = '.$website->id.'",
        "// Line_Reference 545: \t\t\t\t\t\t\t   AND node_id = '.protect($_REQUEST['node_id']),",
        "// Line_Reference 546: \t\t\t\t\t\t\t'array');",
        "// Line_Reference 605: \t\t\t$path = $_REQUEST['path'];",
        "// Line_Reference 606: ",
        "// Line_Reference 610:                  WHERE path = '.protect($path).'",
        "// Line_Reference 611:                    AND website = '.$website->id",
        "// Line_Reference 626:                  WHERE sku = '.protect($sku).'",
        "// Line_Reference 627:                    AND website = '.$website->id",
        "// Line_Reference 645: \t\t\t\t WHERE username LIKE '.protect('%'.$_REQUEST['username'].'%').'",
        "// Line_Reference 648: \t\t\t\t'array",
        "// Line_Reference 649: \t\t\t');",
        "// Line_Reference 673:             $template_filter = '';",
        "// Line_Reference 674: ",
        "// Line_Reference 675: \t        if(!empty($_REQUEST['template']))",
        "// Line_Reference 676:                 $template_filter = ' AND nvp.template = '.protect($_REQUEST['template']).' ';",
        "// Line_Reference 677: ",
        "// Line_Reference 685: ",
        "// Line_Reference 693: \t\t\t\t   AND nvw.website = '.$website->id.'",
        "// Line_Reference 695: \t\t\t\t   AND ( nvw.text LIKE ' . protect('%' . $text . '%') . '",
        "// Line_Reference 696: \t\t\t\t        OR",
        "// Line_Reference 697: \t\t\t\t        ( nvp.id LIKE  ' . protect('%' . $text . '%') . '",
        "// Line_Reference 698: \t\t\t\t          AND",
        "// Line_Reference 699: \t\t\t\t          nvw.lang = '.protect($website->languages_published[0]).'",
        "// Line_Reference 700: \t\t\t\t        )",
        "// Line_Reference 707:             $DB->query($sql, 'array');",
        "// Line_Reference 740: \t\t\t\t         nvb.name LIKE ' . protect('%' . $text . '%') . '    OR",
        "// Line_Reference 741: \t\t\t\t         nvb.id LIKE   ' . protect('%' . $text . '%') . '",
        "// Line_Reference 747:             $DB->query($sql, 'array');",
        "// Line_Reference 2113:                  WHERE nvc.website = '.protect($website->id).'",
        "// Line_Reference 2115:                    AND nvc.object_id = '.protect($item->id).'"
    ]
}
