{
    "cve_id": "CVE-2018-18386",
    "cve_description": "drivers/tty/n_tty.c in the Linux kernel before 4.14.11 allows local attackers (who are able to access pseudo terminals) to hang/block further usage of any pseudo terminal devices due to an EXTPROC versus ICANON confusion in TIOCINQ.",
    "cve_publish_date": "2018-10-17",
    "cwe_id": "CWE-704",
    "cwe_name": "Incorrect Type Conversion or Cast",
    "cwe_description": "The product does not correctly convert an object, resource, or structure from one type to a different type.",
    "commit_message": "n_tty: fix EXTPROC vs ICANON interaction with TIOCINQ (aka FIONREAD)\n\nWe added support for EXTPROC back in 2010 in commit 26df6d13406d (\"tty:\nAdd EXTPROC support for LINEMODE\") and the intent was to allow it to\noverride some (all?) ICANON behavior.  Quoting from that original commit\nmessage:\n\n         There is a new bit in the termios local flag word, EXTPROC.\n         When this bit is set, several aspects of the terminal driver\n         are disabled.  Input line editing, character echo, and mapping\n         of signals are all disabled.  This allows the telnetd to turn\n         off these functions when in linemode, but still keep track of\n         what state the user wants the terminal to be in.\n\nbut the problem turns out that \"several aspects of the terminal driver\nare disabled\" is a bit ambiguous, and you can really confuse the n_tty\nlayer by setting EXTPROC and then causing some of the ICANON invariants\nto no longer be maintained.\n\nThis fixes at least one such case (TIOCINQ) becoming unhappy because of\nthe confusion over whether ICANON really means ICANON when EXTPROC is set.\n\nThis basically makes TIOCINQ match the case of read: if EXTPROC is set,\nwe ignore ICANON.  Also, make sure to reset the ICANON state ie EXTPROC\nchanges, not just if ICANON changes.\n\nFixes: 26df6d13406d (\"tty: Add EXTPROC support for LINEMODE\")\nReported-by: Tetsuo Handa <penguin-kernel@i-love.sakura.ne.jp>\nReported-by: syzkaller <syzkaller@googlegroups.com>\nCc: Jiri Slaby <jslaby@suse.com>\nSigned-off-by: Linus Torvalds <torvalds@linux-foundation.org>\nSigned-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>",
    "type_of_change": "Modification",
    "filename_of_changes": "n_tty.c",
    "code_language": "C",
    "number_of_lines_added_for_mitigation": "2",
    "number_of_lines_deleted_vulnerable_to_cve": "2",
    "vulnerable_lines": [
        "// Line_Reference 1765: \tif (!old || (old->c_lflag ^ tty->termios.c_lflag) & ICANON) {",
        "// Line_Reference 2428: \t\tif (L_ICANON(tty))"
    ]
}
