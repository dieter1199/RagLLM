{
    "cve_id": "CVE-2021-27340",
    "cve_description": "OpenSIS Community Edition version <= 7.6 is affected by a reflected XSS vulnerability in EmailCheck.php via the \"opt\" parameter.",
    "cve_publish_date": "2021-09-16",
    "cwe_id": "CWE-79",
    "cwe_name": "Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting')",
    "cwe_description": "The product does not neutralize or incorrectly neutralizes user-controllable input before it is placed in output that is used as a web page that is served to other users.",
    "commit_message": "Commit with security and bug fixes",
    "type_of_change": "ModificationType.ADD",
    "filename_of_changes": "CopySchool.php",
    "code_language": "PHP",
    "number_of_lines_added_for_mitigation": "39",
    "number_of_lines_deleted_vulnerable_to_cve": "35",
    "vulnerable_lines": [
        "// Line_Reference 275:            case 'courses':",
        "// Line_Reference 276:            $get_ts_grade=DBGet(DBQuery('SELECT * FROM school_gradelevels WHERE SCHOOL_ID=\\''.$id.'\\' '));",
        "// Line_Reference 277:            $get_cs_grade=DBGet(DBQuery('SELECT * FROM school_gradelevels WHERE  SCHOOL_ID=\\''.UserSchool().'\\' '));",
        "// Line_Reference 278:            $get_ts_subjects=DBGet(DBQuery('SELECT * FROM course_subjects WHERE SYEAR=\\'' . UserSyear() . '\\' AND SCHOOL_ID=\\'' .$id. '\\''));",
        "// Line_Reference 279:            $get_cs_subjects=DBGet(DBQuery('SELECT * FROM course_subjects WHERE SYEAR=\\'' . UserSyear() . '\\' AND SCHOOL_ID=\\'' . UserSchool() . '\\''));",
        "// Line_Reference 280:            foreach($get_cs_subjects as $gcsi=>$gcsd)",
        "// Line_Reference 281:            {",
        "// Line_Reference 282:                $get_course=DBGet(DBQuery('SELECT SYEAR,TITLE,SHORT_NAME,GRADE_LEVEL FROM courses WHERE SYEAR=\\'' . UserSyear() . '\\' AND SCHOOL_ID=\\'' . UserSchool() . '\\' AND SUBJECT_ID=\\''.$gcsd['SUBJECT_ID'].'\\''));",
        "// Line_Reference 283:                foreach($get_course as $gc)",
        "// Line_Reference 284:                {",
        "// Line_Reference 285:                    $sql_columns=array('SUBJECT_ID','SCHOOL_ID');",
        "// Line_Reference 286:                    $sql_values=array($get_ts_subjects[$gcsi]['SUBJECT_ID'],$id);",
        "// Line_Reference 287:                    foreach($gc as $gcc=>$gcd)",
        "// Line_Reference 288:                    {",
        "// Line_Reference 289:                        if($gcd!='' && $gcc!='GRADE_LEVEL')",
        "// Line_Reference 290:                        {",
        "// Line_Reference 291:                        $sql_columns[]=$gcc;",
        "// Line_Reference 292:                        $sql_values[]=\"'\".$gcd.\"'\";",
        "// Line_Reference 293:                        }",
        "// Line_Reference 294:                        if($gcd!='' && $gcc=='GRADE_LEVEL')",
        "// Line_Reference 295:                        {",
        "// Line_Reference 296:                            foreach($get_cs_grade as $gcsgi=>$gcsgd)",
        "// Line_Reference 297:                            {",
        "// Line_Reference 298:                             if($gcd==$gcsd['ID'])",
        "// Line_Reference 300: ",
        "// Line_Reference 301:                             $sql_columns[]='GRADE_LEVEL';",
        "// Line_Reference 302:                             $sql_values[]=\"'\".$get_ts_grade[$gcsgi]['ID'].\"'\";",
        "// Line_Reference 303: ",
        "// Line_Reference 305:                            }",
        "// Line_Reference 306:                        }",
        "// Line_Reference 307:                    }",
        "// Line_Reference 308:                    DBQuery('INSERT INTO courses ('.implode(',',$sql_columns).') VALUES ('.(implode(',',$sql_values)).')');",
        "// Line_Reference 309:                }",
        "// Line_Reference 310:            }",
        "// Line_Reference 311:            break;"
    ]
}
