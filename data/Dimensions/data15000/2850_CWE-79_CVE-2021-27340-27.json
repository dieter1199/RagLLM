{
    "cve_id": "CVE-2021-27340",
    "cve_description": "OpenSIS Community Edition version <= 7.6 is affected by a reflected XSS vulnerability in EmailCheck.php via the \"opt\" parameter.",
    "cve_publish_date": "2021-09-16",
    "cwe_id": "CWE-79",
    "cwe_name": "Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting')",
    "cwe_description": "The product does not neutralize or incorrectly neutralizes user-controllable input before it is placed in output that is used as a web page that is served to other users.",
    "commit_message": "Commit with security and bug fixes",
    "type_of_change": "ModificationType.ADD",
    "filename_of_changes": "ResetUserInfo.php",
    "code_language": "PHP",
    "number_of_lines_added_for_mitigation": "165",
    "number_of_lines_deleted_vulnerable_to_cve": "174",
    "vulnerable_lines": [
        "// Line_Reference 37: function db_start()",
        "// Line_Reference 38: {",
        "// Line_Reference 43:             $connection = new mysqli($DatabaseServer, $DatabaseUsername, $DatabasePassword, $DatabaseName, $DatabasePort);",
        "// Line_Reference 54:         db_show_error(\"\", \"\" . _couldNotConnectToDatabase . \": $DatabaseServer\", $errormessage);",
        "// Line_Reference 62: function DBQuery($sql)",
        "// Line_Reference 63: {",
        "// Line_Reference 102: function db_fetch_row($result)",
        "// Line_Reference 103: {",
        "// Line_Reference 121: function db_seq_nextval($seqname)",
        "// Line_Reference 122: {",
        "// Line_Reference 131: function db_case($array)",
        "// Line_Reference 132: {",
        "// Line_Reference 149:             $string .= \"$value\";",
        "// Line_Reference 151:                 $string .= \" ELSE \";",
        "// Line_Reference 153:                 $string .= \" END \";",
        "// Line_Reference 155:                 $string .= \" WHEN $array[0]=\";",
        "// Line_Reference 157:                 $string .= \" THEN \";",
        "// Line_Reference 166: function db_properties($table)",
        "// Line_Reference 167: {",
        "// Line_Reference 192: function db_show_error($sql, $failnote, $additional = '')",
        "// Line_Reference 193: {",
        "// Line_Reference 270:             echo '<script>window.location.href=\"ForgotPass.php\"</script>';",
        "// Line_Reference 274:             echo '<script>window.location.href=\"ForgotPass.php\"</script>';",
        "// Line_Reference 278:             echo '<script>window.location.href=\"ForgotPass.php\"</script>';",
        "// Line_Reference 288:                 echo '<script>window.location.href=\"ForgotPass.php\"</script>';",
        "// Line_Reference 298:             echo '<script>window.location.href=\"ForgotPass.php\"</script>';",
        "// Line_Reference 302:             echo '<script>window.location.href=\"ForgotPass.php\"</script>';",
        "// Line_Reference 311:                 echo '<script>window.location.href=\"ForgotPass.php\"</script>';",
        "// Line_Reference 320:             echo '<script>window.location.href=\"ForgotPass.php\"</script>';",
        "// Line_Reference 324:             echo '<script>window.location.href=\"ForgotPass.php\"</script>';",
        "// Line_Reference 333:                 echo '<script>window.location.href=\"ForgotPass.php\"</script>';",
        "// Line_Reference 344:             echo '<script>window.location.href=\"ForgotPass.php\"</script>';",
        "// Line_Reference 348:             echo '<script>window.location.href=\"ForgotPass.php\"</script>';",
        "// Line_Reference 352:             echo '<script>window.location.href=\"ForgotPass.php\"</script>';",
        "// Line_Reference 361:                 echo '<script>window.location.href=\"ForgotPass.php\"</script>';",
        "// Line_Reference 365:                 echo '<script>window.location.href=\"index.php\"</script>';",
        "// Line_Reference 373:             echo '<script>window.location.href=\"ForgotPass.php\"</script>';",
        "// Line_Reference 377:             echo '<script>window.location.href=\"ForgotPass.php\"</script>';",
        "// Line_Reference 385:                 echo '<script>window.location.href=\"ForgotPass.php\"</script>';",
        "// Line_Reference 389:                 echo '<script>window.location.href=\"index.php\"</script>';",
        "// Line_Reference 396:             echo '<script>window.location.href=\"ForgotPass.php\"</script>';",
        "// Line_Reference 400:             echo '<script>window.location.href=\"ForgotPass.php\"</script>';",
        "// Line_Reference 408:                 echo '<script>window.location.href=\"ForgotPass.php\"</script>';",
        "// Line_Reference 412:                 echo '<script>window.location.href=\"index.php\"</script>';",
        "// Line_Reference 430:         echo '<script>window.location.href=\"index.php\"</script>';",
        "// Line_Reference 437: <head>",
        "// Line_Reference 438:     <meta charset=\"utf-8\">",
        "// Line_Reference 439:     <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\">",
        "// Line_Reference 440:     <meta name=\"viewport\" content=\"width=device-width, initial-scale=1\">",
        "// Line_Reference 441:     <title>openSIS Student Information System</title>",
        "// Line_Reference 442:     <link rel=\"shortcut icon\" href=\"favicon.ico\">",
        "// Line_Reference 443:     <meta http-equiv=\"Content-Type\" content=\"text/html; charset=utf-8\" />",
        "// Line_Reference 444:     <link href=\"styles/fonts/font-awesome/css/font-awesome.min.css\" rel=\"stylesheet\">",
        "// Line_Reference 445:     <link rel=\"stylesheet\" type=\"text/css\" href=\"assets/css/bootstrap.min.css\">",
        "// Line_Reference 446:     <link rel=\"stylesheet\" type=\"text/css\" href=\"assets/css/login.css\">",
        "// Line_Reference 447:     <script src='js/Ajaxload.js'></script>",
        "// Line_Reference 448:     <script src='js/Validation.js'></script>",
        "// Line_Reference 449:     <script src='js/Validator.js'></script>",
        "// Line_Reference 450:     <script src='js/ForgotPass.js'></script>",
        "// Line_Reference 451:     <script type='text/javascript'>",
        "// Line_Reference 452:         function init(param, param2) {",
        "// Line_Reference 453:             calendar.set('date_' + param);",
        "// Line_Reference 454:             document.getElementById('date_' + param).click();",
        "// Line_Reference 455:         }",
        "// Line_Reference 456:     </script>",
        "// Line_Reference 457: ",
        "// Line_Reference 458:     <script src=\"assets/js/core/libraries/jquery.min.js\"></script>",
        "// Line_Reference 459:     <script src=\"assets/js/core/libraries/bootstrap.min.js\"></script>",
        "// Line_Reference 460:     <script type=\"text/javascript\">",
        "// Line_Reference 461:         $(document).ready(function() {",
        "// Line_Reference 462: ",
        "// Line_Reference 463:             var monthNames = [\"Jan\", \"Feb\", \"Mar\", \"Apr\", \"May\", \"Jun\", \"Jul\", \"Aug\", \"Sep\", \"Oct\", \"Nov\", \"Dec\"];",
        "// Line_Reference 464:             var dayNames = [\"Sunday\", \"Monday\", \"Tuesday\", \"Wednesday\", \"Thursday\", \"Friday\", \"Saturday\"]",
        "// Line_Reference 467:             var newDate = new Date();",
        "// Line_Reference 469:             newDate.setDate(newDate.getDate());",
        "// Line_Reference 471:             $('#Date').html(dayNames[newDate.getDay()] + \", \" + monthNames[newDate.getMonth()] + ' ' + newDate.getDate() + ', ' + newDate.getFullYear());",
        "// Line_Reference 475:             setInterval(function() {",
        "// Line_Reference 476:                 // Create a newDate() object and extract the minutes of the current time on the visitor's",
        "// Line_Reference 477:                 var minutes = new Date().getMinutes();",
        "// Line_Reference 478:                 // Add a leading zero to the minutes value",
        "// Line_Reference 479:                 $(\"#min\").html((minutes < 10 ? \"0\" : \"\") + minutes);",
        "// Line_Reference 480:             }, 1000);",
        "// Line_Reference 482:             setInterval(function() {",
        "// Line_Reference 483:                 // Create a newDate() object and extract the hours of the current time on the visitor's",
        "// Line_Reference 484:                 var hours = new Date().getHours();",
        "// Line_Reference 485:                 // Add a leading zero to the hours value",
        "// Line_Reference 486:                 $(\"#hours\").html((hours < 10 ? \"0\" : \"\") + hours);",
        "// Line_Reference 487:             }, 1000);",
        "// Line_Reference 488:         });",
        "// Line_Reference 489:     </script>",
        "// Line_Reference 490:     <!--custom script-->",
        "// Line_Reference 491:     <script src=\"js/custom.js\"></script>",
        "// Line_Reference 492: </head>",
        "// Line_Reference 494: <body>",
        "// Line_Reference 496:     <div class=\"clock\">",
        "// Line_Reference 497:         <ul>",
        "// Line_Reference 498:             <li id=\"hours\"></li>",
        "// Line_Reference 499:             <li id=\"point\">:</li>",
        "// Line_Reference 500:             <li id=\"min\"></li>",
        "// Line_Reference 501:         </ul>",
        "// Line_Reference 502:         <div id=\"Date\"></div>",
        "// Line_Reference 503:     </div>",
        "// Line_Reference 504:     <section class=\"login\">",
        "// Line_Reference 505:         <div class=\"login-wrapper\">",
        "// Line_Reference 507:             <div class=\"panel\">",
        "// Line_Reference 509:                 <div class=\"panel-heading\">",
        "// Line_Reference 510:                     <div class=\"logo\">",
        "// Line_Reference 511:                         <img src=\"assets/images/opensis_logo.png\" alt=\"openSIS\" />",
        "// Line_Reference 513:                     <h3>Forgot Password</h3>",
        "// Line_Reference 514:                 </div>",
        "// Line_Reference 515:                 <div class=\"panel-body\">",
        "// Line_Reference 516:                     <form name=\"f1\" method=\"post\" class=\"text-left\" action=\"\">",
        "// Line_Reference 517: ",
        "// Line_Reference 518:                         <?php if ($flag == 'stu_pass') { ?>",
        "// Line_Reference 519:                             <input type=\"hidden\" name=\"user_info\" value=\"<?php echo cryptor($stu_info[1]['STUDENT_ID'], 'ENC', '') . ',' . cryptor('3', 'ENC', '') . ',' . $_REQUEST['uname']; ?>\" />",
        "// Line_Reference 520:                         <?php",
        "// Line_Reference 521:                         }",
        "// Line_Reference 522:                         if ($flag == 'stf_pass') {",
        "// Line_Reference 523:                         ?>",
        "// Line_Reference 524:                             <input type=\"hidden\" name=\"user_info\" value=\"<?php echo cryptor($stf_info[1]['STAFF_ID'], 'ENC', '') . ',' . cryptor($stf_info[1]['PROFILE_ID'], 'ENC', '') . ',' . $_REQUEST['uname']; ?>\" />",
        "// Line_Reference 525:                         <?php",
        "// Line_Reference 526:                         }",
        "// Line_Reference 527:                         if ($flag == 'par_pass') {",
        "// Line_Reference 528:                         ?>",
        "// Line_Reference 529:                             <input type=\"hidden\" name=\"user_info\" value=\"<?php echo cryptor($par_info[1]['STAFF_ID'], 'ENC', '') . ',' . cryptor($par_info[1]['PROFILE_ID'], 'ENC', '') . ',' . $_REQUEST['uname']; ?>\" />",
        "// Line_Reference 530:                         <?php",
        "// Line_Reference 531:                         }",
        "// Line_Reference 532:                         if ($flag == 'submited_value') {",
        "// Line_Reference 533:                         ?>",
        "// Line_Reference 534:                             <input type=\"hidden\" name=\"user_info\" value=\"<?php echo $_REQUEST['user_info']; ?>\" />",
        "// Line_Reference 535:                         <?php",
        "// Line_Reference 536:                         }",
        "// Line_Reference 537:                         ?>",
        "// Line_Reference 538: ",
        "// Line_Reference 539:                         <div id=\"divErr\">",
        "// Line_Reference 540:                             <?php",
        "// Line_Reference 541:                             if ($_SESSION['err_msg_mod'] != '')",
        "// Line_Reference 542:                                 echo $_SESSION['err_msg_mod'];",
        "// Line_Reference 543:                             unset($_SESSION['err_msg_mod']);",
        "// Line_Reference 545:                         </div>",
        "// Line_Reference 546:                         <p>Password must be minimum 8 characters long with at least one capital, one numeric and one special character. Example: S@mple123</p>",
        "// Line_Reference 547:                         <div class=\"form-group\">",
        "// Line_Reference 548:                             <!--                                <label class=\"control-label\">Enter new password</label>-->",
        "// Line_Reference 549:                             <input type=\"password\" name=\"new_pass\" id=\"new_pass\" class=\"form-control\" placeholder=\"Enter new password\" AUTOCOMPLETE=\"off\" onkeyup=\"forgotpasswordStrength(this.value);",
        "// Line_Reference 552:                                                                                             if ($flag == 'stu_pass')",
        "// Line_Reference 553:                                                                                                 echo 3;",
        "// Line_Reference 554:                                                                                             else if ($flag == 'stf_pass')",
        "// Line_Reference 555:                                                                                                 echo $stf_info[1]['PROFILE_ID'];",
        "// Line_Reference 556:                                                                                             else",
        "// Line_Reference 557:                                                                                                 echo $par_info[1]['PROFILE_ID'];",
        "// Line_Reference 558:                                                                                             ?>);\" />",
        "// Line_Reference 559:                             <p id=\"passwordStrength\" class=\"p-5\"></p>",
        "// Line_Reference 560:                         </div>",
        "// Line_Reference 561: ",
        "// Line_Reference 562:                         <div class=\"form-group\">",
        "// Line_Reference 563:                             <!--                                <label class=\"control-label\">Re-enter new password</label>-->",
        "// Line_Reference 564:                             <input type=\"password\" name=\"ver_pass\" id=\"ver_pass\" class=\"form-control\" placeholder=\"Re-enter new password\" AUTOCOMPLETE=\"off\" onkeyup=\"passwordMatch();\" />",
        "// Line_Reference 565:                             <p id=passwordMatch></p>",
        "// Line_Reference 566:                         </div>",
        "// Line_Reference 567: ",
        "// Line_Reference 568:                         <div class=\"text-center\">",
        "// Line_Reference 569:                             <input type=\"submit\" name=\"save\" class=\"btn btn-primary\" value=\"Update\" onClick=\"return pass_check();\" />",
        "// Line_Reference 570:                             <a class=\"btn btn-default\" href=\"ForgotPass.php\" style=\"text-decoration:none;color:black;font-weight:bold\">Cancel</a>",
        "// Line_Reference 571:                         </div>",
        "// Line_Reference 572: ",
        "// Line_Reference 573:                     </form>",
        "// Line_Reference 575:             </div>",
        "// Line_Reference 577:             <footer>",
        "// Line_Reference 578:                 Copyright &copy; Open Solutions for Education, Inc. (<a href=\"http://www.os4ed.com\">OS4Ed</a>).",
        "// Line_Reference 579:             </footer>",
        "// Line_Reference 580:         </div>",
        "// Line_Reference 581:     </section>",
        "// Line_Reference 582: </body>",
        "// Line_Reference 584: </html>"
    ]
}
