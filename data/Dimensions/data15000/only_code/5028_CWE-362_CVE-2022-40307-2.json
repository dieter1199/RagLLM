/**
* efi_capsule_flush - called by file close or file flush
* @file: file pointer
* @id: not used
*
*	If a capsule is being partially uploaded then calling this function
*	will be treated as upload termination and will free those completed
*	buffer pages and -ECANCELED will be returned.
**/
static int efi_capsule_flush(struct file *file, fl_owner_t id)
{
int ret = 0;
struct capsule_info *cap_info = file->private_data;
if (cap_info->index > 0) {
pr_err("capsule upload not complete\n");
efi_free_all_buff_pages(cap_info);
ret = -ECANCELED;
}
return ret;
}
.flush = efi_capsule_flush,
