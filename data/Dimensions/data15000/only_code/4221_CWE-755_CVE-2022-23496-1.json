private static final Set<String> CHROMIUM = new HashSet<>();
static {
CHROMIUM.add("Chromium");
CHROMIUM.add("Chrome");
List<Brand> fullVersionList = clientHints.getFullVersionList();
if (fullVersionList != null && !fullVersionList.isEmpty()) {
String version;
String majorVersion;
String agentName;
for (Brand brand : fullVersionList) {
String[] versionSplits;
switch (brand.getName()) {
case "Chromium":
version = brand.getVersion();
versionSplits = version.split("\\.");
if (versionSplits.length == 4) {
if (!"0".equals(versionSplits[1])) {
continue;
}
}
version = versionSplits[0] + '.' + versionSplits[1];
majorVersion = versionSplits[0];
overrideValue(userAgent.get(LAYOUT_ENGINE_NAME), "Blink");
overrideValue(userAgent.get(LAYOUT_ENGINE_VERSION), version);
overrideValue(userAgent.get(LAYOUT_ENGINE_NAME_VERSION), "Blink " + version);
overrideValue(userAgent.get(LAYOUT_ENGINE_VERSION_MAJOR), majorVersion);
overrideValue(userAgent.get(LAYOUT_ENGINE_NAME_VERSION_MAJOR), "Blink "+ majorVersion);
if (fullVersionList.size() == 1) { // NOTE: The grease was filtered out !
// So we have "Chromium" and not "Chrome" or "Edge" or something else
if (CHROMIUM.contains(userAgent.getValue(AGENT_NAME))) {
agentName = "Chromium";
version = brand.getVersion();
overrideValue(userAgent.get(AGENT_NAME), agentName);
overrideValue(userAgent.get(AGENT_VERSION), version);
overrideValue(userAgent.get(AGENT_NAME_VERSION), agentName + " " + version);
overrideValue(userAgent.get(AGENT_VERSION_MAJOR), majorVersion);
overrideValue(userAgent.get(AGENT_NAME_VERSION_MAJOR), agentName + " " + majorVersion);
}
}
break;
case "Google Chrome":
case "Chrome":
agentName = "Chrome";
version = brand.getVersion();
versionSplits = version.split("\\.");
if (versionSplits.length == 4) {
if (!"0".equals(versionSplits[1])) {
continue;
}
}
majorVersion = versionSplits[0];
overrideValue(userAgent.get(AGENT_NAME), agentName);
overrideValue(userAgent.get(AGENT_VERSION), version);
overrideValue(userAgent.get(AGENT_NAME_VERSION), agentName + " " + version);
overrideValue(userAgent.get(AGENT_VERSION_MAJOR), majorVersion);
overrideValue(userAgent.get(AGENT_NAME_VERSION_MAJOR), agentName + " " + majorVersion);
break;
case "Microsoft Edge":
case "Edge":
agentName = "Edge";
version = brand.getVersion();
versionSplits = version.split("\\.");
if (versionSplits.length == 4) {
if (!"0".equals(versionSplits[1])) {
continue;
}
}
majorVersion = versionSplits[0];
overrideValue(userAgent.get(AGENT_NAME), agentName);
overrideValue(userAgent.get(AGENT_VERSION), version);
overrideValue(userAgent.get(AGENT_NAME_VERSION), agentName + " " + version);
overrideValue(userAgent.get(AGENT_VERSION_MAJOR), majorVersion);
overrideValue(userAgent.get(AGENT_NAME_VERSION_MAJOR), agentName + " " + majorVersion);
break;
default:
// Ignore
}
}
} else {
// No full versions available, only the major versions
ArrayList<Brand> brands = clientHints.getBrands();
if (brands == null) {
return;
}
if (brands.size() == 1) { // NOTE: The grease was filtered out !
Brand brand = brands.get(0);
if ("Chromium".equals(brand.getName())) {
// So we have "Chromium" and not "Chrome", "Edge", "Opera" or something else
String version = brand.getVersion();
// NOTE: No full version available, only the major version
// We trust the Client hints more than the version we derived from the User-Agent.
overrideValue(userAgent.get(LAYOUT_ENGINE_NAME), "Blink");
overrideValue(userAgent.get(LAYOUT_ENGINE_VERSION), version);
overrideValue(userAgent.get(LAYOUT_ENGINE_NAME_VERSION), "Blink " + version);
overrideValue(userAgent.get(LAYOUT_ENGINE_VERSION_MAJOR), version);
overrideValue(userAgent.get(LAYOUT_ENGINE_NAME_VERSION_MAJOR), "Blink " + version);
// So we have "Chromium" and not "Chrome" or "Edge" or something else
if (CHROMIUM.contains(userAgent.getValue(AGENT_NAME))) {
overrideValue(userAgent.get(AGENT_VERSION), version);
overrideValue(userAgent.get(AGENT_NAME_VERSION), "Chromium " + version);
overrideValue(userAgent.get(AGENT_VERSION_MAJOR), version);
overrideValue(userAgent.get(AGENT_NAME_VERSION_MAJOR), "Chromium " + version);
for (Brand brand : brands) {
String[] versionSplits;
switch (brand.getName()) {
case "Microsoft Edge":
case "Edge":
MutableAgentField agentName = userAgent.get(AGENT_NAME);
if (agentName.getValue().equals("Edge")) {
continue;
}
String version = brand.getVersion();
versionSplits = version.split("\\.");
if (versionSplits.length == 4) {
if (!"0".equals(versionSplits[1])) {
continue;
}
}
String majorVersion = versionSplits[0];
overrideValue(agentName, "Edge");
overrideValue(userAgent.get(AGENT_VERSION), version);
overrideValue(userAgent.get(AGENT_NAME_VERSION), "Edge " + version);
overrideValue(userAgent.get(AGENT_VERSION_MAJOR), majorVersion);
overrideValue(userAgent.get(AGENT_NAME_VERSION_MAJOR), "Edge " + majorVersion);
break;
default:
