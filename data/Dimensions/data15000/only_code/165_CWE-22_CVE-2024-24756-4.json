var filename = path.join(__dirname, "public", req.url.path_list.join("/"));
fs.access(filename, function(fs_err) {
if (!fs_err) {
fs.readFile(filename, function(err, data) {
body: data,
type: mime.getType(filename),
err: err,
});
} else {
callback({
body: "Not found",
status: -2,
code: 404,
});
}
});
// splits a URL path into an Array
// the path is resolved and decoded
// remove double and trailing slashes
pathname = pathname.replace(/\/\/+/g, "/").replace(/(.)\/$/, "$1");
for (var i = 0; i < list.length; i++) {
// URL decode
list[i] = querystring.unescape(list[i]);
}
req.url = url.parse(req.url, true);
req.url.query = req.url.query || {};
