{
    "cve_id": "CVE-2022-0374",
    "cve_description": "Cross-site Scripting (XSS) - Stored in Packagist remdex/livehelperchat prior to 3.93v.",
    "cve_publish_date": "2022-01-26",
    "cwe_id": "CWE-79",
    "cwe_name": "Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting')",
    "cwe_description": "The product does not neutralize or incorrectly neutralizes user-controllable input before it is placed in output that is used as a web page that is served to other users.",
    "commit_message": "fx #1734",
    "type_of_change": "Modification",
    "filename_of_changes": "msg_obj_list_admin.tpl.php",
    "code_language": "PHP",
    "number_of_lines_added_for_mitigation": "6",
    "number_of_lines_deleted_vulnerable_to_cve": "43",
    "vulnerable_lines": [
        "// Line_Reference 1: <?php",
        "// Line_Reference 2: ",
        "// Line_Reference 3: $lastOperatorChanged = false;",
        "// Line_Reference 4: $lastOperatorId = false;",
        "// Line_Reference 5: $lastOperatorNick = '';",
        "// Line_Reference 6: ",
        "// Line_Reference 7: foreach ($messages as $msg) :",
        "// Line_Reference 8: ",
        "// Line_Reference 9: if ($lastOperatorId !== false && ($lastOperatorId != $msg->user_id || $lastOperatorNick != $msg->name_support)) {",
        "// Line_Reference 10:     $lastOperatorChanged = true;",
        "// Line_Reference 11:     $lastOperatorNick = $msg->name_support;",
        "// Line_Reference 12: } else {",
        "// Line_Reference 13:     $lastOperatorChanged = false;",
        "// Line_Reference 15: ",
        "// Line_Reference 16: $lastOperatorId = $msg->user_id;",
        "// Line_Reference 17: ",
        "// Line_Reference 18:     if ($msg->meta_msg != '') {",
        "// Line_Reference 19:         $metaMessageData = json_decode($msg->meta_msg, true); $messageId = $msg->id;",
        "// Line_Reference 20:     } else if (isset($metaMessageData)) {",
        "// Line_Reference 21:         unset($metaMessageData);",
        "// Line_Reference 22:     }",
        "// Line_Reference 23: ",
        "// Line_Reference 25: <?php if ($msg->user_id == -1) : ?>",
        "// Line_Reference 26: \t<div class=\"message-row system-response\" id=\"msg-<?php echo $msg->id?>\"><div class=\"msg-date\"><?php echo date(erLhcoreClassModule::$dateDateHourFormat,$msg->time);?></div><i><span class=\"usr-tit sys-tit\"><?php echo erTranslationClassLhTranslation::getInstance()->getTranslation('chat/syncadmin','System assistant')?></span><?php echo erLhcoreClassBBCode::make_clickable(htmlspecialchars($msg->msg))?></i></div>",
        "// Line_Reference 27: <?php else : ?>",
        "// Line_Reference 28:     <?php if ($msg->msg != '' ||",
        "// Line_Reference 29:         isset($metaMessageData['content']['text_conditional']) ||",
        "// Line_Reference 30:         isset($metaMessageData['content']['chat_operation']) ||",
        "// Line_Reference 31:         isset($metaMessageData['content']['html']['content']) ||",
        "// Line_Reference 32:         isset($metaMessageData['content']['button_message'])",
        "// Line_Reference 33:     ) : ?>",
        "// Line_Reference 34:         <div class=\"message-row<?php echo $msg->user_id == 0 ? ' response' : ' message-admin'.($lastOperatorChanged == true ? ' operator-changes' : '')?>\" id=\"msg-<?php echo $msg->id?>\"><div class=\"msg-date\"><?php echo date(erLhcoreClassModule::$dateDateHourFormat,$msg->time);?></div><span class=\"usr-tit<?php echo $msg->user_id == 0 ? ' vis-tit' : ' op-tit'?>\"><?php if ($msg->user_id == 0) : ?><i class=\"material-icons\"><?php echo ($chat->device_type == 0 ? 'computer' : ($chat->device_type == 1 ? 'smartphone' : 'tablet'))?></i><?php endif;?><?php echo $msg->user_id == 0 ? htmlspecialchars($chat->nick) : htmlspecialchars($msg->name_support) ?></span>",
        "// Line_Reference 35:             <?php $msgBody = $msg->msg; $paramsMessageRender = array('sender' => $msg->user_id, 'html_as_text' => true);?>",
        "// Line_Reference 36:             <?php include(erLhcoreClassDesign::designtpl('lhchat/lists/msg_body.tpl.php'));?>",
        "// Line_Reference 37: ",
        "// Line_Reference 38:             <?php if (isset($metaMessageData)) : ?>",
        "// Line_Reference 39:                 <?php include(erLhcoreClassDesign::designtpl('lhgenericbot/message/meta_render_admin.tpl.php'));?>",
        "// Line_Reference 40:             <?php endif; ?>",
        "// Line_Reference 41: ",
        "// Line_Reference 42:         </div>",
        "// Line_Reference 43:     <?php endif;?>",
        "// Line_Reference 44: <?php endif;?>",
        "// Line_Reference 45: <?php endforeach;?>"
    ]
}
