** $Id: struct.c,v 1.4 2012/07/04 18:54:29 roberto Exp $
** i/In - signed/unsigned integer with size `n' (default is size of int)
** cn - sequence of `n' chars (from/to a string); when packing, n==0 means
static int getnum (lua_State *L, const char **fmt, int df) {
if (a > (INT_MAX / 10) || a * 10 > (INT_MAX - (**fmt - '0')))
luaL_error(L, "integral size overflow");
case 'c': return getnum(L, fmt, 1);
int sz = getnum(L, fmt, sizeof(int));
int a = getnum(L, fmt, MAXALIGN);
lua_settop(L, 2);
luaL_checkstack(L, 1, "too many results");
lua_pushnumber(L, res);
lua_pushnumber(L, f);
lua_pushnumber(L, d);
if (!lua_isnumber(L, -1))
luaL_error(L, "format `c0' needs a previous size");
lua_pop(L, 1);
luaL_argcheck(L, pos+size <= ld, 2, "data string too short");
lua_pushlstring(L, data+pos, size);
lua_pushlstring(L, data+pos, size - 1);
lua_pushinteger(L, pos + 1);
return lua_gettop(L) - 2;
* Copyright (C) 2010-2012 Lua.org, PUC-Rio.  All rights reserved.