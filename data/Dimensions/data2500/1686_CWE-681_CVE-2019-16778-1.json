{
    "cve_id": "CVE-2019-16778",
    "cve_description": "In TensorFlow before 1.15, a heap buffer overflow in UnsortedSegmentSum can be produced when the Index template argument is int32. In this case data_size and num_segments fields are truncated from int64 to int32 and can produce negative numbers, resulting in accessing out of bounds heap memory. This is unlikely to be exploitable and was detected and fixed internally in TensorFlow 1.15 and 2.0.",
    "cve_publish_date": "2019-12-16",
    "cwe_id": "CWE-681",
    "cwe_name": "Incorrect Conversion between Numeric Types",
    "cwe_description": "When converting from one data type to another, such as long to integer, data can be omitted or translated in a way that produces unexpected values. If the resulting values are used in a sensitive context, then dangerous behaviors may occur.",
    "commit_message": "Fix heap buffer overflow in UnsortedSegmentSum.\n\nWhen Index=int32, data_size and num_segments were truncated from int64 to int32. This truncation can produce negative numbers, which causes UnsortedSegmentFunctor to access out of bounds memory.\n\nAlso:\n- Switches some indexing calculations to int64 to avoid signed integer overflow when either the input or output tensors have more than 2**31 - 1 elements.\n- Fixes a range check error in the GPU kernel. The segment ID was checked against an upper bound measured in elements, not segments.\nPiperOrigin-RevId: 256451663",
    "type_of_change": "Modification",
    "filename_of_changes": "segment_reduction_ops.cc",
    "code_language": "C++",
    "number_of_lines_added_for_mitigation": "9",
    "number_of_lines_deleted_vulnerable_to_cve": "10",
    "vulnerable_lines": [
        "// Line_Reference 379:   void operator()(OpKernelContext* ctx, const Index num_segments,",
        "// Line_Reference 380:                   const TensorShape& segment_ids_shape,",
        "// Line_Reference 382:                   const Index data_size, const T* data,",
        "// Line_Reference 385:     if (data_size == 0) {",
        "// Line_Reference 390:     auto data_flat = typename TTypes<T, 2>::ConstTensor(data, N, data_size / N);",
        "// Line_Reference 400:       reduction(data_flat.template chip<0>(i), output.template chip<0>(j));",
        "// Line_Reference 488:     const Index output_rows = internal::SubtleMustCopy(static_cast<Index>(",
        "// Line_Reference 502:     auto data_ptr = data.template flat<T>().data();",
        "// Line_Reference 503:     reduction_functor_(context, output_rows, segment_ids.shape(), segment_flat,",
        "// Line_Reference 504:                        data.NumElements(), data_ptr, output_flat);"
    ]
}
