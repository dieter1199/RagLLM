{
    "cve_id": "CVE-2024-25410",
    "cve_description": "flusity-CMS 2.33 is vulnerable to Unrestricted Upload of File with Dangerous Type in update_setting.php.",
    "cve_publish_date": "2024-02-26",
    "cwe_id": "NVD-CWE-noinfo",
    "commit_message": "Update update_setting.php\n\nSigned-off-by: Darius Jakaitis <105962203+flusity@users.noreply.github.com>",
    "type_of_change": "Modification",
    "filename_of_changes": "update_setting.php",
    "code_language": "PHP",
    "number_of_lines_added_for_mitigation": "22",
    "number_of_lines_deleted_vulnerable_to_cve": "25",
    "vulnerable_lines": [
        "// Line_Reference 11: require_once $_SERVER['DOCUMENT_ROOT'] . '/security/config.php';",
        "// Line_Reference 18:  $db = getDBConnection($config);",
        "// Line_Reference 26: if (isset($_POST['site_title'], $_POST['meta_description'], $_POST['footer_text'], $_POST['pretty_url'], $_POST['bilingualism'], $_POST['language'],",
        "// Line_Reference 27:  $_POST['posts_per_page'], $_POST['registration_enabled'], $_POST['session_lifetime'], $_POST['default_keywords'])) {",
        "// Line_Reference 30:     $target_dir = ROOT_PATH. \"/uploads/\";",
        "// Line_Reference 36:         $unique_code = bin2hex(random_bytes(8));",
        "// Line_Reference 38:         $new_filename = $filename_parts['filename'] . '_' . $unique_code . '.' . $filename_parts['extension'];",
        "// Line_Reference 39:         $target_file = $target_dir . basename($new_filename);",
        "// Line_Reference 40:         $brand_icone = $new_filename; // Use the new filename",
        "// Line_Reference 41: ",
        "// Line_Reference 42:         if (!in_array($uploaded_file['type'], $allowed_file_types)) {",
        "// Line_Reference 43:             $_SESSION['error_message'] = t(\"Invalid file type.\");",
        "// Line_Reference 44: ",
        "// Line_Reference 45:         }",
        "// Line_Reference 47:         if ($uploaded_file['size'] > $max_file_size) {",
        "// Line_Reference 49: ",
        "// Line_Reference 50:         }",
        "// Line_Reference 51: ",
        "// Line_Reference 52:         if (move_uploaded_file($uploaded_file[\"tmp_name\"], $target_file)) {",
        "// Line_Reference 53:             $file_url = $_SERVER['REQUEST_SCHEME'] . \"://\" . $_SERVER['HTTP_HOST'] . \"/uploads/\" . $new_filename;",
        "// Line_Reference 54:             saveFileToDatabase($db, $prefix, $new_filename, $file_url);",
        "// Line_Reference 55:             $_SESSION['success_message'] = \"File\" .\" \". basename($uploaded_file[\"name\"]) . \" \" .t(\"file uploaded successfully.\");",
        "// Line_Reference 57:             $_SESSION['error_message'] = t(\"Error loading file.\");",
        "// Line_Reference 58: ",
        "// Line_Reference 95: ?>"
    ]
}
