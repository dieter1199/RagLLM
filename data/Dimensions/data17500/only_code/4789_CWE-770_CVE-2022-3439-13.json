def test_change_password_too_many_attemps(self):
# When udating user's password with wrong current password 5 times
for _i in range(1, 5):
self._set_password('wrong', "pr3j5Dwi", "pr3j5Dwi")
self.assertStatus(200)
self.assertInBody("Wrong current password.")
# Then user session is cleared and user is redirect to login page
self._set_password('wrong', "pr3j5Dwi", "pr3j5Dwi")
self.assertStatus(303)
self.assertHeaderItemValue('Location', self.baseurl + '/login/')
# Then a warning message is displayed on login page
self.getPage('/login/')
self.assertStatus(200)
self.assertInBody('You were logged out because you entered the wrong password too many times.')
