$exceptions_RET = DBGet(DBQuery('SELECT PROFILE_ID,MODNAME,CAN_USE,CAN_EDIT FROM profile_exceptions WHERE PROFILE_ID=\'' . $_REQUEST[profile_id] . '\''), array(), array('MODNAME'));
$profile_RET = DBGet(DBQuery('SELECT PROFILE FROM user_profiles WHERE ID=\'' . $_REQUEST[profile_id] . '\''));
$profile_RET = DBGet(DBQuery('SELECT TITLE FROM user_profiles WHERE ID=\'' . $_REQUEST[profile_id] . '\''));
if (DeletePromptBigString("delete <i>$profile</i>?,<br/>users of that profile will retain their permissions as a custom set which can be modified on a per-user basis through the User Permissions program.")) {
if (!count($exceptions_RET[$modname]) && ($_REQUEST['can_edit'][str_replace('.', '_', $modname)] || $_REQUEST['can_use'][str_replace('.', '_', $modname)])) {
DBQuery('INSERT INTO profile_exceptions (PROFILE_ID,MODNAME) values(\'' . $_REQUEST[profile_id] . '\',\'' . $modname . '\')');
} elseif (count($exceptions_RET[$modname]) && !$_REQUEST['can_edit'][str_replace('.', '_', $modname)] && !$_REQUEST['can_use'][str_replace('.', '_', $modname)])
DBQuery('DELETE FROM profile_exceptions WHERE PROFILE_ID=\'' . $_REQUEST[profile_id] . '\' AND MODNAME=\'' . $modname . '\'');
$update .= ' WHERE PROFILE_ID=\'' . $_REQUEST[profile_id] . '\' AND MODNAME=\'' . $modname . '\';';
$exceptions_RET = DBGet(DBQuery('SELECT MODNAME,CAN_USE,CAN_EDIT FROM profile_exceptions WHERE PROFILE_ID=\'' . $_REQUEST[profile_id] . '\''), array(), array('MODNAME'));
$id = DBGet(DBQuery('SHOW TABLE STATUS LIKE \'' . 'user_profiles' . '\''));
$id[1]['ID'] = $id[1]['AUTO_INCREMENT'];
$id = $id[1]['ID'];
$_REQUEST['profile_id'] = $id;
echo '<TR><TD width=20 align=right class="p-10">' . (AllowEdit() && $id > 4 && $id != 0 ? '<a href="Modules.php?modname='.$_REQUEST[modname].'&modfunc=delete&profile_id='.$id.'" class="btn btn-default btn-xs p-5"><i class="icon-cross2"></i></a>' : '') . '</TD><TD onclick="document.location.href=\'Modules.php?modname=' . $_REQUEST['modname'] . '&profile_id=' . $id . '\';">';
if (count($values)) {
