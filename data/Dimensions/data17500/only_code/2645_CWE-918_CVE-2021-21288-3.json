context "with a URL with internationalized domain name" do
let(:uri) { "http://ドメイン名例.jp/#{CGI.escape(filename)}" }
before do
stub_request(:get, 'http://xn--eckwd4c7cu47r2wf.jp/test.jpg').to_return(body: file)
end
it "converts to Punycode URI" do
expect(subject.process_uri(uri).to_s).to eq 'http://xn--eckwd4c7cu47r2wf.jp/test.jpg'
end
it "downloads a file" do
expect(subject.download(uri).file.read).to eq file
end
end
it "raises an error when trying to download a local file" do
expect { subject.download('/etc/passwd') }.to raise_error(CarrierWave::DownloadError)
end
stub_request(:get, another_uri).to_return(body: file)
