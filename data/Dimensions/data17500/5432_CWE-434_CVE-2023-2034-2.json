{
    "cve_id": "CVE-2023-2034",
    "cve_description": "Unrestricted Upload of File with Dangerous Type in GitHub repository froxlor/froxlor prior to 2.0.14.",
    "cve_publish_date": "2023-04-14",
    "cwe_id": "CWE-434",
    "cwe_name": "Unrestricted Upload of File with Dangerous Type",
    "cwe_description": "The product allows the upload or transfer of dangerous file types that are automatically processed within its environment.",
    "commit_message": "better validation for uploaded/imported image files\n\nSigned-off-by: Michael Kaufmann <d00p@froxlor.org>",
    "type_of_change": "Modification",
    "filename_of_changes": "Store.php",
    "code_language": "PHP",
    "number_of_lines_added_for_mitigation": "24",
    "number_of_lines_deleted_vulnerable_to_cve": "33",
    "vulnerable_lines": [
        "// Line_Reference 418: \t\t\t\tif (function_exists('finfo_open')) {",
        "// Line_Reference 419: \t\t\t\t\t$finfo = finfo_open(FILEINFO_MIME_TYPE);",
        "// Line_Reference 420: \t\t\t\t\t$mimetype = finfo_file($finfo, $_FILES[$fieldname]['tmp_name']);",
        "// Line_Reference 421: \t\t\t\t\tfinfo_close($finfo);",
        "// Line_Reference 422: \t\t\t\t} else {",
        "// Line_Reference 423: \t\t\t\t\t$mimetype = mime_content_type($_FILES[$fieldname]['tmp_name']);",
        "// Line_Reference 424: \t\t\t\t}",
        "// Line_Reference 425: \t\t\t\tif (empty($mimetype)) {",
        "// Line_Reference 426: \t\t\t\t\t$mimetype = 'application/octet-stream';",
        "// Line_Reference 427: \t\t\t\t}",
        "// Line_Reference 428: \t\t\t\tif (!in_array($mimetype, ['image/jpeg', 'image/jpg', 'image/png', 'image/gif'])) {",
        "// Line_Reference 429: \t\t\t\t\tthrow new \\Exception(\"Uploaded file is not a valid image\");",
        "// Line_Reference 430: \t\t\t\t}",
        "// Line_Reference 431: ",
        "// Line_Reference 432: \t\t\t\t// Determine file extension",
        "// Line_Reference 433: \t\t\t\t$spl = explode('.', $_FILES[$fieldname]['name']);",
        "// Line_Reference 434: \t\t\t\t$file_extension = strtolower(array_pop($spl));",
        "// Line_Reference 435: \t\t\t\tunset($spl);",
        "// Line_Reference 436: ",
        "// Line_Reference 437: \t\t\t\tif (!in_array($file_extension, [",
        "// Line_Reference 438: \t\t\t\t\t'jpeg',",
        "// Line_Reference 439: \t\t\t\t\t'jpg',",
        "// Line_Reference 440: \t\t\t\t\t'png',",
        "// Line_Reference 441: \t\t\t\t\t'gif'",
        "// Line_Reference 442: \t\t\t\t])) {",
        "// Line_Reference 443: \t\t\t\t\tthrow new Exception(\"Invalid file-extension, use one of: jpeg, jpg, png, gif\");",
        "// Line_Reference 444: \t\t\t\t}",
        "// Line_Reference 445: ",
        "// Line_Reference 446: \t\t\t\t// Move file",
        "// Line_Reference 447: \t\t\t\tif (!move_uploaded_file($_FILES[$fieldname]['tmp_name'], $path . $fielddata['image_name'] . '.' . $file_extension)) {",
        "// Line_Reference 448: \t\t\t\t\tthrow new Exception(\"Unable to save image to img folder\");",
        "// Line_Reference 450: ",
        "// Line_Reference 451: \t\t\t\t$save_to = 'img/' . $fielddata['image_name'] . '.' . $file_extension . '?v=' . time();"
    ]
}
