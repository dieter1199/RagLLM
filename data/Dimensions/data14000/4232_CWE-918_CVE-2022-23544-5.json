{
    "cve_id": "CVE-2022-23544",
    "cve_description": "MeterSphere is a one-stop open source continuous testing platform, covering test management, interface testing, UI testing and performance testing. Versions prior to 2.5.0 are subject to a Server-Side Request Forgery that leads to Cross-Site Scripting. A Server-Side request forgery in `IssueProxyResourceService::getMdImageByUrl` allows an attacker to access internal resources, as well as executing JavaScript code in the context of Metersphere's origin by a victim of a reflected XSS. This vulnerability has been fixed in v2.5.0. There are no known workarounds.",
    "cve_publish_date": "2022-12-28",
    "cwe_id": "CWE-918",
    "cwe_name": "Server-Side Request Forgery (SSRF)",
    "cwe_description": "The web server receives a URL or similar request from an upstream component and retrieves the contents of this URL, but it does not sufficiently ensure that the request is being sent to the expected destination.",
    "commit_message": "fix(测试跟踪): 缺陷平台请求转发添加白名单",
    "type_of_change": "Modification",
    "filename_of_changes": "IssuesService.java",
    "code_language": "Java",
    "number_of_lines_added_for_mitigation": "0",
    "number_of_lines_deleted_vulnerable_to_cve": "32",
    "vulnerable_lines": [
        "// Line_Reference 62: import jodd.util.CollectionUtil;",
        "// Line_Reference 700:         //处理MD图片链接内容",
        "// Line_Reference 701:         handleJiraIssueMdUrl(request.getWorkspaceId(), request.getProjectId(), issues);",
        "// Line_Reference 792:     private void handleJiraIssueMdUrl(String workPlaceId, String projectId, List<IssuesDao> issues) {",
        "// Line_Reference 793:         issues.forEach(issue -> {",
        "// Line_Reference 794:             if (StringUtils.isNotEmpty(issue.getDescription()) && issue.getDescription().contains(\"platform=Jira&\")) {",
        "// Line_Reference 795:                 issue.setDescription(replaceJiraMdUrlParam(issue.getDescription(), workPlaceId, projectId));",
        "// Line_Reference 796:             }",
        "// Line_Reference 797:             if (StringUtils.isNotEmpty(issue.getCustomFields()) && issue.getCustomFields().contains(\"platform=Jira&\")) {",
        "// Line_Reference 798:                 issue.setCustomFields(replaceJiraMdUrlParam(issue.getCustomFields(), workPlaceId, projectId));",
        "// Line_Reference 799:             }",
        "// Line_Reference 800:             if (CollectionUtils.isNotEmpty(issue.getFields())) {",
        "// Line_Reference 801:                 issue.getFields().forEach(field -> {",
        "// Line_Reference 802:                     if (StringUtils.isNotEmpty(field.getTextValue()) && field.getTextValue().contains(\"platform=Jira&\")) {",
        "// Line_Reference 803:                         field.setTextValue(replaceJiraMdUrlParam(field.getTextValue(), workPlaceId, projectId));",
        "// Line_Reference 804:                     }",
        "// Line_Reference 805:                     if (StringUtils.isNotEmpty(field.getValue()) && field.getValue().contains(\"platform=Jira&\")) {",
        "// Line_Reference 806:                         field.setValue(replaceJiraMdUrlParam(field.getValue(), workPlaceId, projectId));",
        "// Line_Reference 807:                     }",
        "// Line_Reference 808:                 });",
        "// Line_Reference 809:             }",
        "// Line_Reference 810:         });",
        "// Line_Reference 811:     }",
        "// Line_Reference 812: ",
        "// Line_Reference 813:     private String replaceJiraMdUrlParam(String url, String workspaceId, String projectId) {",
        "// Line_Reference 814:         if (url.contains(\"&workspace_id=\")) {",
        "// Line_Reference 815:             return url;",
        "// Line_Reference 816:         }",
        "// Line_Reference 817:         return url.replaceAll(\"platform=Jira&\",",
        "// Line_Reference 818:                 \"platform=Jira&workspace_id=\" + workspaceId + \"&\");",
        "// Line_Reference 819:     }",
        "// Line_Reference 820: "
    ]
}
