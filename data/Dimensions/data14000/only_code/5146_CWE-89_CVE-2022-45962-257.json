if(!$_SESSION['STAFF_ID'] && !$_SESSION['STUDENT_ID'] && (strpos($_SERVER['PHP_SELF'],'index.php'))===false)
{
header('Location: index.php');
exit;
}
if(!$_openSIS['Menu'])
{
foreach($openSISModules as $module=>$include)
if($include)
if($profile!='student')
if(User('PROFILE_ID')!='')
{
$can_use_RET = DBGet(DBQuery("SELECT MODNAME FROM profile_exceptions WHERE PROFILE_ID='".User('PROFILE_ID')."' AND CAN_USE='Y'"),array(),array('MODNAME'));
}  else
{
$profile_id_mod=DBGet(DBQuery("SELECT PROFILE_ID FROM staff WHERE USER_ID='".User('STAFF_ID')));
$profile_id_mod=$profile_id_mod[1]['PROFILE_ID'];
if($profile_id_mod!='')
$can_use_RET = DBGet(DBQuery("SELECT MODNAME FROM profile_exceptions WHERE PROFILE_ID='".$profile_id_mod."' AND CAN_USE='Y'"),array(),array('MODNAME'));
}
else
{
$can_use_RET = DBGet(DBQuery("SELECT MODNAME FROM profile_exceptions WHERE PROFILE_ID='3' AND CAN_USE='Y'"),array(),array('MODNAME'));
foreach($menu as $modcat=>$profiles)
{
$menuprof = $menu;
foreach($programs as $program=>$title)
{
if(!is_numeric($program))
{
if($can_use_RET[$program] && ($profile!='admin' || !$exceptions[$modcat][$program] || AllowEdit($program)))
}
else
{
}
if(User('PROFILE')=='student')
?>
