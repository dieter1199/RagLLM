ext ||=
if File.exist?(path_or_url)
File.extname(path_or_url)
else
File.extname(URI(path_or_url).path)
end
Kernel.open(path_or_url, "rb", options) do |file|
read(file, ext)