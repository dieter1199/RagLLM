{
    "cve_id": "CVE-2022-39302",
    "cve_description": "Ree6 is a moderation bot. This vulnerability would allow other server owners to create configurations such as \"Better-Audit-Logging\" which contain a channel from another server as a target. This would mean you could send log messages to another Guild channel and bypass raid and webhook protections. A specifically crafted log message could allow spamming and mass advertisements. This issue has been patched in version 1.9.9. There are currently no known workarounds.",
    "cve_publish_date": "2022-10-14",
    "cwe_id": "CWE-863",
    "cwe_name": "Incorrect Authorization",
    "cwe_description": "The product performs an authorization check when an actor attempts to access a resource or perform an action, but it does not correctly perform the check. This allows attackers to bypass intended access restrictions.",
    "commit_message": "Removed News-Channel.\nFixed Cross-Server Channel Exploit.\nFixed Temporal-Voice setup.",
    "type_of_change": "Modification",
    "filename_of_changes": "OtherEvents.java",
    "code_language": "Java",
    "number_of_lines_added_for_mitigation": "1",
    "number_of_lines_deleted_vulnerable_to_cve": "71",
    "vulnerable_lines": [
        "// Line_Reference 867:                     case \"news\" -> {",
        "// Line_Reference 868:                         optionList.add(SelectOption.of(\"Setup\", \"newsSetup\"));",
        "// Line_Reference 869: ",
        "// Line_Reference 870:                         if (Main.getInstance().getSqlConnector().getSqlWorker().isNewsSetup(event.getGuild().getId()))",
        "// Line_Reference 871:                             optionList.add(SelectOption.of(\"Delete\", \"newsDelete\"));",
        "// Line_Reference 872: ",
        "// Line_Reference 873:                         optionList.add(SelectOption.of(\"Back to Menu\", \"backToSetupMenu\"));",
        "// Line_Reference 874: ",
        "// Line_Reference 875:                         embedBuilder.setDescription(\"You can set up our own Ree6-News!\\nBy setting up Ree6-News on a specific channel you will get a Message in the given Channel, when ever Ree6 gets an update!\");",
        "// Line_Reference 876: ",
        "// Line_Reference 877:                         event.editMessageEmbeds(embedBuilder.build()).setActionRow(new SelectMenuImpl(\"setupNewsMenu\", \"Select your Action\", 1, 1, false, optionList)).queue();",
        "// Line_Reference 878:                     }",
        "// Line_Reference 879: ",
        "// Line_Reference 889:                         if (Main.getInstance().getSqlConnector().getSqlWorker().isNewsSetup(event.getGuild().getId()))",
        "// Line_Reference 1223:             case \"setupNewsMenu\" -> {",
        "// Line_Reference 1224: ",
        "// Line_Reference 1225:                 if (checkPerms(event.getMember(), event.getChannel())) {",
        "// Line_Reference 1226:                     return;",
        "// Line_Reference 1227:                 }",
        "// Line_Reference 1228: ",
        "// Line_Reference 1229:                 EmbedBuilder embedBuilder = new EmbedBuilder(event.getMessage().getEmbeds().get(0));",
        "// Line_Reference 1230: ",
        "// Line_Reference 1231:                 List<SelectOption> optionList = new ArrayList<>();",
        "// Line_Reference 1232: ",
        "// Line_Reference 1233:                 switch (event.getInteraction().getValues().get(0)) {",
        "// Line_Reference 1234: ",
        "// Line_Reference 1235:                     case \"backToSetupMenu\" -> sendDefaultChoice(event);",
        "// Line_Reference 1236: ",
        "// Line_Reference 1237:                     case \"newsSetup\" -> {",
        "// Line_Reference 1238:                         for (TextChannel channel : event.getGuild().getTextChannels()) {",
        "// Line_Reference 1239:                             optionList.add(SelectOption.of(channel.getName(), channel.getId()));",
        "// Line_Reference 1240:                         }",
        "// Line_Reference 1241: ",
        "// Line_Reference 1242:                         embedBuilder.setDescription(\"Which Channel do you want to use as News-Channel?\");",
        "// Line_Reference 1243: ",
        "// Line_Reference 1244:                         event.editMessageEmbeds(embedBuilder.build()).setActionRow(new SelectMenuImpl(\"setupNewsChannel\", \"Select a Channel!\", 1, 1, false, optionList)).queue();",
        "// Line_Reference 1245:                     }",
        "// Line_Reference 1246: ",
        "// Line_Reference 1247:                     default -> {",
        "// Line_Reference 1248:                         if (event.getMessage().getEmbeds().isEmpty() || event.getMessage().getEmbeds().get(0) == null)",
        "// Line_Reference 1249:                             return;",
        "// Line_Reference 1250: ",
        "// Line_Reference 1251:                         embedBuilder.setDescription(\"You somehow selected a Invalid Option? Are you a Wizard?\");",
        "// Line_Reference 1252:                         event.editMessageEmbeds(embedBuilder.build()).queue();",
        "// Line_Reference 1253:                     }",
        "// Line_Reference 1254:                 }",
        "// Line_Reference 1255:             }",
        "// Line_Reference 1256: ",
        "// Line_Reference 1257:             case \"setupNewsChannel\" -> {",
        "// Line_Reference 1258:                 if (checkPerms(event.getMember(), event.getChannel())) {",
        "// Line_Reference 1259:                     return;",
        "// Line_Reference 1260:                 }",
        "// Line_Reference 1261: ",
        "// Line_Reference 1262:                 EmbedBuilder embedBuilder = new EmbedBuilder(event.getMessage().getEmbeds().get(0));",
        "// Line_Reference 1263: ",
        "// Line_Reference 1264:                 TextChannel textChannel = event.getGuild().getTextChannelById(event.getInteraction().getValues().get(0));",
        "// Line_Reference 1265: ",
        "// Line_Reference 1266:                 if (textChannel != null) {",
        "// Line_Reference 1267:                     textChannel.createWebhook(\"Ree6-News\").queue(webhook -> {",
        "// Line_Reference 1268:                         Main.getInstance().getSqlConnector().getSqlWorker().setNewsWebhook(event.getGuild().getId(), webhook.getId(), webhook.getToken());",
        "// Line_Reference 1269:                         embedBuilder.setDescription(\"Successfully changed the News-Channel, nice work!\");",
        "// Line_Reference 1270:                         embedBuilder.setColor(Color.GREEN);",
        "// Line_Reference 1271:                         event.editMessageEmbeds(embedBuilder.build()).setComponents(new ArrayList<>()).queue();",
        "// Line_Reference 1272:                     });",
        "// Line_Reference 1273:                 } else {",
        "// Line_Reference 1274:                     embedBuilder.setDescription(\"The given Channel doesn't exists, how did you select it? Are you a Wizard?\");",
        "// Line_Reference 1275:                     event.editMessageEmbeds(embedBuilder.build()).queue();",
        "// Line_Reference 1276:                 }",
        "// Line_Reference 1277:             }",
        "// Line_Reference 1278: ",
        "// Line_Reference 1301:         optionList.add(SelectOption.of(\"News-channel\", \"news\"));"
    ]
}
