{
    "cve_id": "CVE-2021-27340",
    "cve_description": "OpenSIS Community Edition version <= 7.6 is affected by a reflected XSS vulnerability in EmailCheck.php via the \"opt\" parameter.",
    "cve_publish_date": "2021-09-16",
    "cwe_id": "CWE-79",
    "cwe_name": "Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting')",
    "cwe_description": "The product does not neutralize or incorrectly neutralizes user-controllable input before it is placed in output that is used as a web page that is served to other users.",
    "commit_message": "Commit with security and bug fixes",
    "type_of_change": "ModificationType.ADD",
    "filename_of_changes": "HackingLogFnc.php",
    "code_language": "PHP",
    "number_of_lines_added_for_mitigation": "35",
    "number_of_lines_deleted_vulnerable_to_cve": "30",
    "vulnerable_lines": [
        "// Line_Reference 29: function HackingLog()",
        "// Line_Reference 30: {",
        "// Line_Reference 31: \techo \"\" . _youReNotAllowedToUseThisProgram . \"! \" . _thisAttemptedViolationHasBeenLoggedAndYourIpAddressWasCaptured . \".\";",
        "// Line_Reference 32: \tWarehouse('footer');",
        "// Line_Reference 33: ",
        "// Line_Reference 34: \tif ($_SERVER['HTTP_X_FORWARDED_FOR']) {",
        "// Line_Reference 35: \t\t$ip = $_SERVER['HTTP_X_FORWARDED_FOR'];",
        "// Line_Reference 36: \t} else {",
        "// Line_Reference 37: \t\t$ip = $_SERVER['REMOTE_ADDR'];",
        "// Line_Reference 38: \t}",
        "// Line_Reference 39: ",
        "// Line_Reference 40: \tif ($openSISNotifyAddress)",
        "// Line_Reference 41: \t\tmail($openSISNotifyAddress, 'HACKING ATTEMPT', \"INSERT INTO hacking_log (HOST_NAME,IP_ADDRESS,LOGIN_DATE,VERSION,PHP_SELF,DOCUMENT_ROOT,SCRIPT_NAME,MODNAME,USERNAME) values('$_SERVER[SERVER_NAME]','$ip','\" . date('Y-m-d') . \"','$openSISVersion','$_SERVER[PHP_SELF]','$_SERVER[DOCUMENT_ROOT]','$_SERVER[SCRIPT_NAME]','$_REQUEST[modname]','\" . User('USERNAME') . \"')\");",
        "// Line_Reference 42: ",
        "// Line_Reference 43: ",
        "// Line_Reference 44: ",
        "// Line_Reference 45: \tif (false && function_exists('query')) {",
        "// Line_Reference 46: ",
        "// Line_Reference 47: \t\tif ($_SERVER['HTTP_X_FORWARDED_FOR']) {",
        "// Line_Reference 48: \t\t\t$ip = $_SERVER['HTTP_X_FORWARDED_FOR'];",
        "// Line_Reference 49: \t\t} else {",
        "// Line_Reference 50: \t\t\t$ip = $_SERVER['REMOTE_ADDR'];",
        "// Line_Reference 51: \t\t}",
        "// Line_Reference 52: ",
        "// Line_Reference 53: \t\t$connection = new mysqli('os4ed.com', 'openSIS_log', 'openSIS_log', 'openSIS_log');",
        "// Line_Reference 54: ",
        "// Line_Reference 55: \t\t$connection->query(\"INSERT INTO hacking_log (HOST_NAME,IP_ADDRESS,LOGIN_DATE,VERSION,PHP_SELF,DOCUMENT_ROOT,SCRIPT_NAME,MODNAME,USERNAME) values('$_SERVER[SERVER_NAME]','$ip','\" . date('Y-m-d') . \"','$openSISVersion','$_SERVER[PHP_SELF]','$_SERVER[DOCUMENT_ROOT]','$_SERVER[SCRIPT_NAME]','\" . optional_param('modname', '', PARAM_CLEAN) . \"','\" . User('USERNAME') . \"')\");",
        "// Line_Reference 56: \t\tmysqli_close($link);",
        "// Line_Reference 57: \t}",
        "// Line_Reference 58: }"
    ]
}
