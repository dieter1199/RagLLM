{
    "cve_id": "CVE-2021-27340",
    "cve_description": "OpenSIS Community Edition version <= 7.6 is affected by a reflected XSS vulnerability in EmailCheck.php via the \"opt\" parameter.",
    "cve_publish_date": "2021-09-16",
    "cwe_id": "CWE-79",
    "cwe_name": "Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting')",
    "cwe_description": "The product does not neutralize or incorrectly neutralizes user-controllable input before it is placed in output that is used as a web page that is served to other users.",
    "commit_message": "Commit with security and bug fixes",
    "type_of_change": "ModificationType.ADD",
    "filename_of_changes": "SearchForStudentsInc.php",
    "code_language": "PHP",
    "number_of_lines_added_for_mitigation": "8",
    "number_of_lines_deleted_vulnerable_to_cve": "45",
    "vulnerable_lines": [
        "// Line_Reference 1007:         echo '<input type=\"submit\" class=\"btn btn-primary\" value=\"'._applyFilter.'\" onclick=\"self_disable(this);\" /> &nbsp; <input class=\"btn btn-default\" value=\"'._reset.'\" type=\"RESET\">';",
        "// Line_Reference 1020:             echo '&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a HREF=javascript:void(0) data-toggle=\"modal\" data-target=\"#modal_filter_edit\" class=\"text-pink display-inline-block\" onClick=\"\"><i class=\"fa fa-filter\"></i> '._editFilters.'</a>';",
        "// Line_Reference 1032:         //////////////Modal For Editing Filter/////////////////",
        "// Line_Reference 1043:         echo '<div class=\"modal-body\">';",
        "// Line_Reference 1046:         // if (clean_param($_REQUEST['modfunc'], PARAM_ALPHAMOD) == 'remove' && $_REQUEST['filter_id']!='') {",
        "// Line_Reference 1047:         //         if (DeletePrompt_Filter('filter')) {",
        "// Line_Reference 1048:         //             $filter_id = paramlib_validation($colmn = FILTER_ID, $_REQUEST['filter_id']);",
        "// Line_Reference 1049:         //             DBQuery('DELETE FROM filters WHERE FILTER_ID=\\'' . $filter_id . '\\'');",
        "// Line_Reference 1050:         //             DBQuery('DELETE FROM filter_fields WHERE FILTER_ID=\\'' . $filter_id . '\\'');",
        "// Line_Reference 1051:         //             unset($_REQUEST['modfunc']);",
        "// Line_Reference 1052:         //         }",
        "// Line_Reference 1053:         // }",
        "// Line_Reference 1054: ",
        "// Line_Reference 1055:         if ($_REQUEST['modfunc'] != 'remove') {",
        "// Line_Reference 1056: ",
        "// Line_Reference 1057:             $sql = 'SELECT FILTER_ID, FILTER_NAME,NULL AS REMOVE_LINK,NULL AS MODIFY_LINK FROM filters WHERE SCHOOL_ID IN ('.UserSchool().',0) AND SHOW_TO IN ('. UserID().',0)';",
        "// Line_Reference 1058:             $F = DBQuery($sql);",
        "// Line_Reference 1059: ",
        "// Line_Reference 1060:             $filters_RET = DBGet($F);",
        "// Line_Reference 1061: ",
        "// Line_Reference 1062:             $columns2 = array('REMOVE_LINK' => '',",
        "// Line_Reference 1063:                 'FILTER_NAME' => 'Filter Name',",
        "// Line_Reference 1064:                 'MODIFY_LINK' => '',",
        "// Line_Reference 1065:             );",
        "// Line_Reference 1066: ",
        "// Line_Reference 1067:             $filter_counter=1;",
        "// Line_Reference 1068:             foreach($filters_RET as $key)",
        "// Line_Reference 1069:             {",
        "// Line_Reference 1070:                 $filter_remove_link='<a class=\"btn btn-primary btn-icon btn-xs legitRipple\" href=\"Modules.php?modname=students/StudentFilters.php&amp;modfunc=remove&amp;filter_id='.$key['FILTER_ID'].'\" onclick=\"hide_filter_modal();\"><i class=\"icon-cross2 \"></i></a>';",
        "// Line_Reference 1071: ",
        "// Line_Reference 1072:                 $filter_modify_link='<a class=\"btn btn-primary btn-xs display-inline-block\" href=\"Modules.php?modname=students/StudentFilters.php&amp;modfunc=filter_edit&amp;filter_id='.$key['FILTER_ID'].'\" onClick=\"hide_filter_modal()\">Edit</a>';",
        "// Line_Reference 1073: ",
        "// Line_Reference 1074:                 $filters_RET[$filter_counter]['REMOVE_LINK'] = $filter_remove_link;",
        "// Line_Reference 1075:                 $filters_RET[$filter_counter]['MODIFY_LINK'] = $filter_modify_link;",
        "// Line_Reference 1076:                 $filter_counter++;",
        "// Line_Reference 1077:             }",
        "// Line_Reference 1078: ",
        "// Line_Reference 1079:             // echo \"<pre>\"; print_r($filters_RET); echo \"</pre>\";",
        "// Line_Reference 1080:             ListOutput($filters_RET, $columns2, _filter, _filters, false, array(), array('search' =>false));",
        "// Line_Reference 1081:         }",
        "// Line_Reference 1084:         // echo '<div class=\"modal-footer text-center\">';",
        "// Line_Reference 1085:         // echo '<input type=\"submit\" class=\"btn btn-primary display-inline-block\" value=\"'._save.'\">';",
        "// Line_Reference 1086:         // echo '</div>'; //.modal-footer",
        "// Line_Reference 1092:         //////////////End of Modal/////////////////////////",
        "// Line_Reference 1095:         //////////////Modal For Filter Save////////////////////"
    ]
}
