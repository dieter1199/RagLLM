{
    "cve_id": "CVE-2018-17552",
    "cve_description": "SQL Injection in login.php in Naviwebs Navigate CMS 2.8 allows remote attackers to bypass authentication via the navigate-user cookie.",
    "cve_publish_date": "2018-10-03",
    "cwe_id": "CWE-89",
    "cwe_name": "Improper Neutralization of Special Elements used in an SQL Command ('SQL Injection')",
    "cwe_description": "The product constructs all or part of an SQL command using externally-influenced input from an upstream component, but it does not neutralize or incorrectly neutralizes special elements that could modify the intended SQL command when it is sent to a downstream component. Without sufficient removal or quoting of SQL syntax in user-controllable inputs, the generated SQL query can cause those inputs to be interpreted as SQL instead of ordinary user data.",
    "commit_message": "* security fix: replace string filtering by parameterization in almost all queries",
    "type_of_change": "Modification",
    "filename_of_changes": "property.class.php",
    "code_language": "PHP",
    "number_of_lines_added_for_mitigation": "185",
    "number_of_lines_deleted_vulnerable_to_cve": "53",
    "vulnerable_lines": [
        "// Line_Reference 487:                 $element = ' AND element = '.protect($element);",
        "// Line_Reference 491:             if($DB->query('",
        "// Line_Reference 492:                    SELECT *",
        "// Line_Reference 493:                    FROM nv_properties",
        "// Line_Reference 494:                    WHERE template = '.protect($code).'",
        "// Line_Reference 495:                    '.$element.'",
        "// Line_Reference 496:                      AND website = '.$website_id.'",
        "// Line_Reference 497:                    ORDER BY position ASC, id ASC'",
        "// Line_Reference 498:                 )",
        "// Line_Reference 499:             )",
        "// Line_Reference 745:                     ' code = '.protect($code).' AND website = '.$website->id",
        "// Line_Reference 776:                 $block_group_id = $DB->query_single('id', 'nv_block_groups', ' blocks LIKE '.protect('%'.$item_uid.'%').' AND website = '.$website->id);",
        "// Line_Reference 785:                 $block_group_id = $DB->query_single('MAX(id)', 'nv_block_groups', ' code = '.protect($object_id).' AND website = '.$website->id);",
        "// Line_Reference 811:  \t\t\t WHERE element = '.protect($object_type).'",
        "// Line_Reference 812: \t\t\t   AND node_id = '.protect($object_id).",
        "// Line_Reference 813: \t\t\t   (empty($item_uid)? '' : ' AND ( node_uid = '.protect($item_uid).' OR node_uid = \"\" OR node_uid IS NULL )').'",
        "// Line_Reference 814: \t\t\t   AND website = '.$website->id,",
        "// Line_Reference 815:             'array'",
        "// Line_Reference 885:                 $block_group_id = $DB->query_single('MAX(id)', 'nv_block_groups', ' code = '.protect($code).' AND website = '.$website->id);",
        "// Line_Reference 915:                 $block_group_id = $DB->query_single('MAX(id)', 'nv_block_groups', ' code = '.protect($object_id).' AND website = '.$website->id);",
        "// Line_Reference 978:                     WHERE property_id = '.protect($property->id).'",
        "// Line_Reference 979:                       AND element = '.protect($object_type).'",
        "// Line_Reference 980:                       AND node_id = '.protect($object_id).",
        "// Line_Reference 981:                       (empty($object_uid)? '' : ' AND node_uid = '.protect($object_uid)).'",
        "// Line_Reference 982:                       AND website = '.$website->id",
        "// Line_Reference 1081:                 $block_group_id = $DB->query_single('MAX(id)', 'nv_block_groups', ' code = '.protect($code).' AND website = '.$ws->id);",
        "// Line_Reference 1209:                 \t  WHERE property_id = '.protect($property->id).'",
        "// Line_Reference 1210:                         AND element = '.protect($property_object_type).'",
        "// Line_Reference 1211:                         AND node_id = '.protect($object_id).",
        "// Line_Reference 1212:                         (empty($node_uid)? '' : ' AND node_uid = '.protect($node_uid)).'",
        "// Line_Reference 1213:                         AND website = '.$ws->id",
        "// Line_Reference 1278:                   WHERE website = '.$website_id.'",
        "// Line_Reference 1279:                     AND element = '.protect($element_type).'",
        "// Line_Reference 1280:                     AND node_id = '.intval($element_id).'",
        "// Line_Reference 1281:         ');",
        "// Line_Reference 1290:         $DB->query('SELECT name",
        "// Line_Reference 1291: \t\t\t\t\tFROM nv_countries",
        "// Line_Reference 1292: \t\t \t\t\tWHERE lang = '.protect($lang).'",
        "// Line_Reference 1293: \t\t\t\t\t  AND country_code = '.protect($code));",
        "// Line_Reference 1313: \t\t$DB->query('SELECT '.$code.' AS country_code, name",
        "// Line_Reference 1314: \t\t\t\t\tFROM nv_countries",
        "// Line_Reference 1315: \t\t \t\t\tWHERE lang = '.protect($lang).'",
        "// Line_Reference 1316: \t\t\t\t\tORDER BY name ASC');",
        "// Line_Reference 1349:             $country_query = ' AND r.country = '.protect($country_id);",
        "// Line_Reference 1373:         $DB->query('SELECT name",
        "// Line_Reference 1374: \t\t\t\t\tFROM nv_countries_regions",
        "// Line_Reference 1375: \t\t \t\t\tWHERE `numeric` = '.protect($code));",
        "// Line_Reference 1490:             WHERE website = '.protect($website->id).'",
        "// Line_Reference 1491:               AND property_id = '.protect($property).'",
        "// Line_Reference 1492:               AND value = '.protect($value),",
        "// Line_Reference 1493:             'object');",
        "// Line_Reference 1505:         $DB->query('SELECT * FROM nv_properties WHERE website = '.protect($website->id), 'object');",
        "// Line_Reference 1510:         $DB->query('SELECT * FROM nv_properties_items WHERE website = '.protect($website->id), 'object');"
    ]
}
