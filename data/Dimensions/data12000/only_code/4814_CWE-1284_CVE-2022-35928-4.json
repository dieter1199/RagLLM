* Copyright (C) 2007-2017
if (ftty == NULL)
{
return AESCRYPT_READPWD_FOPEN;
}
if (tty < 0)
{
return AESCRYPT_READPWD_FILENO;
}
if (ftty != stderr)
fclose(ftty);
if (ftty != stderr)
fclose(ftty);
if (ftty != stderr)
fclose(ftty);
match = strcmp((char*)pwd, (char*)pwd_confirm);
if (match != 0)
{
/* For security reasons, erase the password */
memset_secure(pwd, 0, MAX_PASSWD_BUF);
return AESCRYPT_READPWD_NOMATCH;
}
chars_read = passwd_to_utf16(
pwd,
chars_read,
MAX_PASSWD_LEN,
buffer);
ret = MultiByteToWideChar(
CP_ACP,
0,
(LPCSTR)in_passwd,
-1,
(LPWSTR)out_passwd,
max_length / 2
);
for (i=0;i<length+1;i++) {
out_passwd[i*2] = in_passwd[i];
out_passwd[i*2+1] = 0;
return length*2;
