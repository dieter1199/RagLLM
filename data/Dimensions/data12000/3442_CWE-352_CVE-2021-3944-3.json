{
    "cve_id": "CVE-2021-3944",
    "cve_description": "bookstack is vulnerable to Cross-Site Request Forgery (CSRF)",
    "cve_publish_date": "2021-12-02",
    "cwe_id": "CWE-352",
    "cwe_name": "Cross-Site Request Forgery (CSRF)",
    "cwe_description": "The web application does not, or can not, sufficiently verify whether a well-formed, valid, consistent request was intentionally provided by the user who submitted the request.",
    "commit_message": "Prevented auto-login from direct email confirmation actions\n\nWas done for convenience but could potentially be exploited by an\nattacker using signing up via one of these routes, then forwarding\nan email confirmation to another user so they unknowingly utilise\nan account someone else controls.\n\nTweaks the flow of confirming email, and the user invite flow.\n\nFor #3050",
    "type_of_change": "Modification",
    "filename_of_changes": "UserInviteController.php",
    "code_language": "PHP",
    "number_of_lines_added_for_mitigation": "3",
    "number_of_lines_deleted_vulnerable_to_cve": "7",
    "vulnerable_lines": [
        "// Line_Reference 5: use BookStack\\Auth\\Access\\LoginService;",
        "// Line_Reference 19:     protected $loginService;",
        "// Line_Reference 25:     public function __construct(UserInviteService $inviteService, LoginService $loginService, UserRepo $userRepo)",
        "// Line_Reference 31:         $this->loginService = $loginService;",
        "// Line_Reference 76:         $this->showSuccessNotification(trans('auth.user_invite_success', ['appName' => setting('app-name')]));",
        "// Line_Reference 77:         $this->loginService->login($user, auth()->getDefaultDriver());",
        "// Line_Reference 79:         return redirect('/');"
    ]
}
