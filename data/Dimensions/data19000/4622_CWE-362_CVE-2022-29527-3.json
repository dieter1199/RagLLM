{
    "cve_id": "CVE-2022-29527",
    "cve_description": "Amazon AWS amazon-ssm-agent before 3.1.1208.0 creates a world-writable sudoers file, which allows local attackers to inject Sudo rules and escalate privileges to root. This occurs in certain situations involving a race condition.",
    "cve_publish_date": "2022-04-20",
    "cwe_id": "CWE-362",
    "cwe_name": "Concurrent Execution using Shared Resource with Improper Synchronization ('Race Condition')",
    "cwe_description": "The product contains a code sequence that can run concurrently with other code, and the code sequence requires temporary, exclusive access to a shared resource, but a timing window exists in which the shared resource can be modified by another code sequence that is operating concurrently.",
    "commit_message": "Create ssm-agent-users sudoer file with constrained file permission\n\ncr: https://code.amazon.com/reviews/CR-67315538",
    "type_of_change": "Modification",
    "filename_of_changes": "utility_unix.go",
    "code_language": "Go",
    "number_of_lines_added_for_mitigation": "12",
    "number_of_lines_deleted_vulnerable_to_cve": "11",
    "vulnerable_lines": [
        "// Line_Reference 40: \tsudoersFile     = \"/etc/sudoers.d/ssm-agent-users\"",
        "// Line_Reference 41: \tsudoersFileMode = 0440",
        "// Line_Reference 42: \tfs_ioc_getflags = uintptr(0x80086601)",
        "// Line_Reference 43: \tfs_ioc_setflags = uintptr(0x40086602)",
        "// Line_Reference 44: \tFS_APPEND_FL    = 0x00000020 /* writes to file may only append */",
        "// Line_Reference 45: \tFS_RESET_FL     = 0x00000000 /* reset file property */",
        "// Line_Reference 109: \t// Create a sudoers file for ssm-user",
        "// Line_Reference 110: \tfile, err := os.Create(sudoersFile)",
        "// Line_Reference 135: \tfileMode := os.FileMode(sudoersFileMode)",
        "// Line_Reference 137: \t\tlog.Errorf(\"Failed to change mode of %s to %d: %v\", sudoersFile, sudoersFileMode, err)",
        "// Line_Reference 140: \tlog.Infof(\"Successfully changed mode of %s to %d\", sudoersFile, sudoersFileMode)"
    ]
}
