{
    "cve_id": "CVE-2018-1091",
    "cve_description": "In the flush_tmregs_to_thread function in arch/powerpc/kernel/ptrace.c in the Linux kernel before 4.13.5, a guest kernel crash can be triggered from unprivileged userspace during a core dump on a POWER host due to a missing processor feature check and an erroneous use of transactional memory (TM) instructions in the core dump path, leading to a denial of service.",
    "cve_publish_date": "2018-03-27",
    "cwe_id": "CWE-119",
    "cwe_name": "Improper Restriction of Operations within the Bounds of a Memory Buffer",
    "cwe_description": "The product performs operations on a memory buffer, but it reads from or writes to a memory location outside the buffer's intended boundary. This may result in read or write operations on unexpected memory locations that could be linked to other variables, data structures, or internal program data.",
    "commit_message": "powerpc/tm: Flush TM only if CPU has TM feature\n\nCommit cd63f3c (\"powerpc/tm: Fix saving of TM SPRs in core dump\")\nadded code to access TM SPRs in flush_tmregs_to_thread(). However\nflush_tmregs_to_thread() does not check if TM feature is available on\nCPU before trying to access TM SPRs in order to copy live state to\nthread structures. flush_tmregs_to_thread() is indeed guarded by\nCONFIG_PPC_TRANSACTIONAL_MEM but it might be the case that kernel\nwas compiled with CONFIG_PPC_TRANSACTIONAL_MEM enabled and ran on\na CPU without TM feature available, thus rendering the execution\nof TM instructions that are treated by the CPU as illegal instructions.\n\nThe fix is just to add proper checking in flush_tmregs_to_thread()\nif CPU has the TM feature before accessing any TM-specific resource,\nreturning immediately if TM is no available on the CPU. Adding\nthat checking in flush_tmregs_to_thread() instead of in places\nwhere it is called, like in vsr_get() and vsr_set(), is better because\navoids the same problem cropping up elsewhere.\n\nCc: stable@vger.kernel.org # v4.13+\nFixes: cd63f3c (\"powerpc/tm: Fix saving of TM SPRs in core dump\")\nSigned-off-by: Gustavo Romero <gromero@linux.vnet.ibm.com>\nReviewed-by: Cyril Bur <cyrilbur@gmail.com>\nSigned-off-by: Michael Ellerman <mpe@ellerman.id.au>",
    "type_of_change": "Modification",
    "filename_of_changes": "ptrace.c",
    "code_language": "C",
    "number_of_lines_added_for_mitigation": "1",
    "number_of_lines_deleted_vulnerable_to_cve": "1",
    "vulnerable_lines": [
        "// Line_Reference 134: \tif (tsk != current)"
    ]
}
