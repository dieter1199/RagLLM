if (buf->offset < aoffset) {
debug_print("%s", "End of buffer\n");