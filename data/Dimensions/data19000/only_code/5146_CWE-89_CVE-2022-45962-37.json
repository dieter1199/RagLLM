error_reporting(0);
if($value=='LANGUAGE')
$value='LANGUAGE_ID';
if($value=='ETHNICITY')
$value='ETHNICITY_ID';
$id = DBGet(DBQuery("SHOW TABLE STATUS LIKE 'students'"));
$student_id[1]['STUDENT_ID'] = $id[1]['AUTO_INCREMENT'];
$student_id = $student_id[1]['STUDENT_ID'];
$err_msg=array();
$student_columns = array('STUDENT_ID');
$student_values = array($student_id);
if ($arr_v[$array_index[$students_v]] != '') {
if ($students_v == 'BIRTHDATE' || $students_v == 'ESTIMATED_GRAD_DATE' ) {
}elseif($students_v == 'LANGUAGE_ID'){
if(is_numeric($arr_v[$array_index[$students_v]]))
{
$student_values[] = "'".$arr_v[$array_index[$students_v]]."'";
}
else
{
$lang_id= DBGet(DBQuery('SELECT language_id FROM `language` WHERE LANGUAGE_NAME =\''. $arr_v[$array_index[$students_v]] . '\''));
$student_values[] = "'".$lang_id[1]['LANGUAGE_ID']."'";
}elseif($students_v == 'ETHNICITY_ID'){
if(is_numeric($arr_v[$array_index[$students_v]]))
{
$student_values[] = "'".$arr_v[$array_index[$students_v]]."'";
else
{
$lang_id= DBGet(DBQuery('SELECT ethnicity_id FROM `ethnicity` WHERE ethnicity_name =\''. $arr_v[$array_index[$students_v]] . '\''));
$student_values[] = "'".$lang_id[1]['ETHNICITY_ID']."'";
}
}
else {
if ($students_v == 'FIRST_NAME' || $students_v == 'LAST_NAME' || $students_v == 'EMAIL' || $students_v == 'BIRTHDATE' )
$check_query[] = $students_v . '=' . "'" .($students_v=='BIRTHDATE'?fromExcelToLinux(singleQuoteReplace("", "", $arr_v[$array_index[$students_v]])):singleQuoteReplace("", "", $arr_v[$array_index[$students_v]]) ). "'";
$check_query_alt_id[]= $students_v . '=' . "'" .(singleQuoteReplace("", "", $arr_v[$array_index[$students_v]]) ). "'";
$check_query_username[]= $username . '=' . "'" .(singleQuoteReplace("", "", $arr_v[$array_index[$username]]) ). "'";
if ($check_exist != 0){
$err_msg[0]= 'duplicate student';
$check_exist_al= DBGet(DBQuery('SELECT COUNT(*) as REC_EXISTS FROM students WHERE ' . implode(" ",$check_query_alt_id)));
$check_exist_alt= $check_exist_al[1]['REC_EXISTS'];
if ($check_exist_alt != 0){
$err_msg[1]= 'duplicate alternet id';
$check_exist_al_username= DBGet(DBQuery('SELECT COUNT(*) as REC_EXISTS FROM login_authentication WHERE ' . implode(" ",$check_query_username)));
$check_exist_alt_username= $check_exist_al_username[1]['REC_EXISTS'];
if ($check_exist_alt_username != 0){
$err_msg[2]= 'duplicate username';
if ( $check_exist == 0 && $check_exist_alt == 0 && $check_exist_alt_username == 0) {
$enrollment_columns+=array('CALENDAR_ID');
$enrollment_values+=array($calendar_id[1]['CALENDAR_ID']);
$la_values[] = "'" . md5(str_replace("'", "", $arr_v[$array_index['PASSWORD']])) . "'";
if(count($err_msg)==1){
$msg='';
foreach($err_msg as $key=>$val)
{
$msg=$val;
}
echo '<div class="col-xs-12 text-danger"><i class="icon-info22"></i> Possible cause for rejection is '.$msg.' found.</div>';
if(count($err_msg)==2){
$msg='';
foreach($err_msg as $key=>$val)
{
$msg.= $val.' and ';
}
$msg=substr($val,0,-5);
echo '<div class="col-xs-12 text-danger"><i class="icon-info22"></i> Possible causes for rejection are '.$msg.' found.</div>';
if(count($err_msg)==3){
$msg='';
foreach($err_msg as $key=>$val)
{
$msg.= $val.' and ';
}
$msg=substr($val,0,-5);
echo '<div class="col-xs-12 text-danger"><i class="icon-info22"></i> Possible causes for rejection are '.$msg.' found.</div>';
}
$id = DBGet(DBQuery("SHOW TABLE STATUS LIKE 'staff'"));
$staff_id[1]['STAFF_ID'] = $id[1]['AUTO_INCREMENT'];
$staff_id = $staff_id[1]['STAFF_ID'];
$err_msg=array();
$staff_columns = array('STAFF_ID', 'CURRENT_SCHOOL_ID');
$staff_values = array($staff_id, UserSchool());
$arr_v[$array_index[$staff_v]]=strtolower($arr_v[$array_index[$staff_v]]);
if ($staff_v == 'BIRTHDATE'){
$staff_values[] = "'" .fromExcelToLinux(singleQuoteReplace("", "", $arr_v[$array_index[$staff_v]])) . "'";
}else{
$staff_values[] = "'" . singleQuoteReplace("", "", $arr_v[$array_index[$staff_v]]) . "'";
}
$check_query[] = $staff_v . '=' . "'" .fromExcelToLinux(singleQuoteReplace("", "", $arr_v[$array_index[$staff_v]])) . "'";
if($staff_v == 'ALTERNATE_ID')
$check_query_alt_id[] = $staff_v . '=' . "'" . singleQuoteReplace("", "", $arr_v[$array_index[$staff_v]]) . "'";
if ($username == 'USERNAME')
$check_query_username[]= $username . '=' . "'" .(singleQuoteReplace("", "", $arr_v[$array_index[$username]]) ). "'";
}
if ($check_exist != 0){
$err_msg[0]= 'duplicate staff';
}
if (count($check_query_alt_id) > 0) {
if ($check_exist_alt != 0){
$err_msg[1]= 'duplicate alternet id';
if (count($check_query_username) > 0) {
$check_exist_al_username= DBGet(DBQuery('SELECT COUNT(*) as REC_EXISTS FROM login_authentication WHERE ' . implode(" ",$check_query_username)));
$check_exist_alt_username= $check_exist_al_username[1]['REC_EXISTS'];
if ($check_exist_alt_username != 0){
$err_msg[2]= 'duplicate username';
}
}
$la_values[] = "'" . md5(str_replace("'", "", $arr_v[$array_index['PASSWORD']])) . "'";
$la_values[] = "'" . md5(trim(strtolower(str_replace("'", "", str_replace(" ", "", $arr_v[$array_index['FIRST_NAME']]))) . $staff_id)) . "'";
if(count($err_msg)==1){
$msg='';
foreach($err_msg as $key=>$val)
{
$msg=$val;
}
echo '<div class="col-xs-12 text-danger"><i class="icon-info22"></i> Possible cause for rejection is '.$msg.' found.</div>';
if(count($err_msg)==2){
$msg='';
foreach($err_msg as $key=>$val)
{
$msg.= $val.' and ';
}
$msg=substr($val,0,-5);
echo '<div class="col-xs-12 text-danger"><i class="icon-info22"></i> Possible causes for rejection are '.$msg.' found.</div>';
if(count($err_msg)==3){
$msg='';
foreach($err_msg as $key=>$val)
{
$msg.= $val.' and ';
}
$msg=substr($val,0,-5);
echo '<div class="col-xs-12 text-danger"><i class="icon-info22"></i> Possible causes for rejection are '.$msg.' found.</div>';
}
function fromExcelToLinux($excel_time) {
?>
