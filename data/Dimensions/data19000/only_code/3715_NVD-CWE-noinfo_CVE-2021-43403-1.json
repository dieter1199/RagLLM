Portions created by the Initial Developer are Copyright (C) 2008-2019
if (!isset($_POST['line_number']) || $_POST['line_number'] == '') { $_POST['line_number'] = 0; }
if (!isset($_POST['sort']) || $_POST['sort'] == '') { $_POST['sort'] = "asc"; }
if (!isset($_POST['size']) || strlen($_POST['size']) == 0) { $_POST['size'] = "32"; }
if (!isset($_POST['filter'])) { $_POST['filter'] = ""; }
if (!isset($_POST['log_file']) || substr($_POST['log_file'],0,14) != "freeswitch.log") { $_POST['log_file'] = "freeswitch.log"; }
if (isset($_GET['n']) && substr($_GET['n'],0,14) == "freeswitch.log") {
$dir = $_SESSION['switch']['log']['dir'];
$filename = $_GET['n'];
session_cache_limiter('public');
$fd = fopen($dir."/".$filename, "rb");
header("Content-Type: binary/octet-stream");
header("Content-Length: " . filesize($tmp."/".$filename));
header('Content-Disposition: attachment; filename="'.$filename.'"');
fpassthru($fd);
exit;
$files = scandir($_SESSION['switch']['log']['dir']);
foreach($files as $file) if (substr($file,0,14) == "freeswitch.log") {
$selected = ($file == $_POST['log_file']) ? "selected='selected'" : "";
echo "			<option value='".$file."'".$selected.">".$file."</option>";
echo button::create(['type'=>'button','label'=>$text['button-download'],'icon'=>$_SESSION['theme']['button_icon_download'],'style'=>'margin-left: 15px;','link'=>'log_viewer.php?a=download&n='.$_POST['log_file']]);
if (substr($_POST['log_file'],0,14) == "freeswitch.log") {
$log_file = $_SESSION['switch']['log']['dir']."/".$_POST['log_file'];
}
?>