{
    "cve_id": "CVE-2020-14067",
    "cve_description": "The install_from_hash functionality in Navigate CMS 2.9 does not consider the .phtml extension when examining files within a ZIP archive that may contain PHP code, in check_upload in lib/packages/extensions/extension.class.php and lib/packages/themes/theme.class.php.",
    "cve_publish_date": "2020-06-15",
    "cwe_id": "CWE-434",
    "cwe_name": "Unrestricted Upload of File with Dangerous Type",
    "cwe_description": "The product allows the upload or transfer of dangerous file types that are automatically processed within its environment.",
    "commit_message": "* themes,extensions: secure \"install_from_hash\" functionality",
    "type_of_change": "Modification",
    "filename_of_changes": "themes.php",
    "code_language": "PHP",
    "number_of_lines_added_for_mitigation": "46",
    "number_of_lines_deleted_vulnerable_to_cve": "26",
    "vulnerable_lines": [
        "// Line_Reference 119:                 $tmp_file = sys_get_temp_dir() . DIRECTORY_SEPARATOR . $query['code'] . '.zip';",
        "// Line_Reference 120:                 @core_file_curl($url, $tmp_file);",
        "// Line_Reference 121:                 if(@filesize($tmp_file) == 0)",
        "// Line_Reference 123:                     @unlink($tmp_file);",
        "// Line_Reference 124:                     // core file curl failed, try using file_get_contents...",
        "// Line_Reference 125:                     $tmp = @file_get_contents($url);",
        "// Line_Reference 126:                     if(!empty($tmp))",
        "// Line_Reference 127:                     {",
        "// Line_Reference 128:                         @file_put_contents($tmp_file, $tmp);",
        "// Line_Reference 129:                     }",
        "// Line_Reference 130:                     unset($tmp);",
        "// Line_Reference 133:                 if(@filesize($tmp_file) > 0)",
        "// Line_Reference 135:                     // uncompress ZIP and copy it to the themes dir",
        "// Line_Reference 136:                     @mkdir(NAVIGATE_PATH.'/themes/'.$query['code']);",
        "// Line_Reference 138:                     $zip = new ZipArchive();",
        "// Line_Reference 139:                     $zip_open_status = $zip->open($tmp_file);",
        "// Line_Reference 140:                     if($zip_open_status === TRUE)",
        "// Line_Reference 142:                         $zip->extractTo(NAVIGATE_PATH.'/themes/'.$query['code']);",
        "// Line_Reference 143:                         $zip->close();",
        "// Line_Reference 144: ",
        "// Line_Reference 145:                         $layout->navigate_notification(t(374, \"Item installed successfully.\"), false);",
        "// Line_Reference 147:                     else // zip extraction failed",
        "// Line_Reference 149:                         $layout->navigate_notification('ERROR '.$zip_open_status, true, true);",
        "// Line_Reference 150:                         $error = true;",
        "// Line_Reference 172:                             title: \"'.t(56, \"Unexpected error\").'\"",
        "// Line_Reference 177:             // don't break, we want to show the themes grid right now (theme_upload by browser upload won't trigger)"
    ]
}
