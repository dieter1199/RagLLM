{
    "cve_id": "CVE-2018-6558",
    "cve_description": "The pam_fscrypt module in fscrypt before 0.2.4 may incorrectly restore primary and supplementary group IDs to the values associated with the root user, which allows attackers to gain privileges via a successful login through certain applications that use Linux-PAM (aka pam).",
    "cve_publish_date": "2018-08-23",
    "cwe_id": "NVD-CWE-noinfo",
    "cwe_name": "Insufficient Information",
    "cwe_description": "There is insufficient information about the issue to classify it; details are unkown or unspecified.",
    "commit_message": "Ensure setting user privileges is reversible\n\nThis change makes sure after dropping then elevating privileges for a\nprocess, the euid, guid, and groups are all the same as they were\noriginally. This significantly simplifies the privilege logic.\n\nThis fixes CVE-2018-6558, which allowed an unprivleged user to gain\nmembership in the root group (gid 0) due to the groups not being\nproperly reset in the process.",
    "type_of_change": "Modification",
    "filename_of_changes": "pam.go",
    "code_language": "Go",
    "number_of_lines_added_for_mitigation": "16",
    "number_of_lines_deleted_vulnerable_to_cve": "17",
    "vulnerable_lines": [
        "// Line_Reference 38: \t\"github.com/google/fscrypt/util\"",
        "// Line_Reference 43: \thandle *C.pam_handle_t",
        "// Line_Reference 44: \tstatus C.int",
        "// Line_Reference 45: \t// OrigUser is the user who invoked the PAM module (usually root)",
        "// Line_Reference 46: \tOrigUser *user.User",
        "// Line_Reference 47: \t// PamUser is the user who the PAM module is for",
        "// Line_Reference 65: \tif h.PamUser, err = user.Lookup(C.GoString(pamUsername)); err != nil {",
        "// Line_Reference 66: \t\treturn nil, err",
        "// Line_Reference 67: \t}",
        "// Line_Reference 68: \tif h.OrigUser, err = util.EffectiveUser(); err != nil {",
        "// Line_Reference 69: \t\treturn nil, err",
        "// Line_Reference 70: \t}",
        "// Line_Reference 71: \treturn h, nil",
        "// Line_Reference 143: \treturn security.SetProcessPrivileges(h.PamUser)",
        "// Line_Reference 147: // PAM module (this is usually root). As this error is often ignored in a defer",
        "// Line_Reference 148: // statement, any error is also logged.",
        "// Line_Reference 150: \terr := security.SetProcessPrivileges(h.OrigUser)"
    ]
}
