{
    "cve_id": "CVE-2024-36113",
    "cve_description": "Discourse is an open-source discussion platform. Prior to version 3.2.3 on the `stable` branch, version 3.3.0.beta3 on the `beta` branch, and version 3.3.0.beta4-dev on the `tests-passed` branch, a rogue staff user could suspend other staff users preventing them from logging in to the site. The issue is patched in version 3.2.3 on the `stable` branch, version 3.3.0.beta3 on the `beta` branch, and version 3.3.0.beta4-dev on the `tests-passed` branch. No known workarounds are available.",
    "cve_publish_date": "2024-07-03",
    "cwe_id": "NVD-CWE-noinfo",
    "cwe_name": "Insufficient Information",
    "cwe_description": "There is insufficient information about the issue to classify it; details are unkown or unspecified.",
    "commit_message": "SECURITY: Don't allow suspending staff users via other_user_ids param",
    "type_of_change": "ModificationType.ADD",
    "filename_of_changes": "users_controller.rb",
    "code_language": "Ruby",
    "number_of_lines_added_for_mitigation": "22",
    "number_of_lines_deleted_vulnerable_to_cve": "39",
    "vulnerable_lines": [
        "// Line_Reference 49:     similar_users = User.real.where.not(id: @user.id).where(ip_address: @user.ip_address)",
        "// Line_Reference 147:     all_users.each do |user|",
        "// Line_Reference 148:       user.suspended_till = params[:suspend_until]",
        "// Line_Reference 149:       user.suspended_at = DateTime.now",
        "// Line_Reference 150: ",
        "// Line_Reference 151:       message = params[:message]",
        "// Line_Reference 152: ",
        "// Line_Reference 153:       User.transaction do",
        "// Line_Reference 154:         user.save!",
        "// Line_Reference 155: ",
        "// Line_Reference 156:         user_history =",
        "// Line_Reference 157:           StaffActionLogger.new(current_user).log_user_suspend(",
        "// Line_Reference 158:             user,",
        "// Line_Reference 159:             params[:reason],",
        "// Line_Reference 160:             message: message,",
        "// Line_Reference 161:             post_id: params[:post_id],",
        "// Line_Reference 162:           )",
        "// Line_Reference 163:       end",
        "// Line_Reference 164:       user.logged_out",
        "// Line_Reference 166:       if message.present?",
        "// Line_Reference 167:         Jobs.enqueue(",
        "// Line_Reference 168:           :critical_user_email,",
        "// Line_Reference 169:           type: \"account_suspended\",",
        "// Line_Reference 170:           user_id: user.id,",
        "// Line_Reference 171:           user_history_id: user_history.id,",
        "// Line_Reference 173:       end",
        "// Line_Reference 174: ",
        "// Line_Reference 175:       DiscourseEvent.trigger(",
        "// Line_Reference 176:         :user_suspended,",
        "// Line_Reference 177:         user: user,",
        "// Line_Reference 178:         reason: params[:reason],",
        "// Line_Reference 179:         message: message,",
        "// Line_Reference 180:         user_history: user_history,",
        "// Line_Reference 181:         post_id: params[:post_id],",
        "// Line_Reference 182:         suspended_till: params[:suspend_until],",
        "// Line_Reference 183:         suspended_at: DateTime.now,",
        "// Line_Reference 184:       )",
        "// Line_Reference 192:         full_suspend_reason: user_history.try(:details),",
        "// Line_Reference 372:     guardian.ensure_can_silence_user! @user"
    ]
}
