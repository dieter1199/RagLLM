{
    "cve_id": "CVE-2021-27340",
    "cve_description": "OpenSIS Community Edition version <= 7.6 is affected by a reflected XSS vulnerability in EmailCheck.php via the \"opt\" parameter.",
    "cve_publish_date": "2021-09-16",
    "cwe_id": "CWE-79",
    "cwe_name": "Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting')",
    "cwe_description": "The product does not neutralize or incorrectly neutralizes user-controllable input before it is placed in output that is used as a web page that is served to other users.",
    "commit_message": "Commit with security and bug fixes",
    "type_of_change": "ModificationType.ADD",
    "filename_of_changes": "Transcripts.php",
    "code_language": "PHP",
    "number_of_lines_added_for_mitigation": "38",
    "number_of_lines_deleted_vulnerable_to_cve": "50",
    "vulnerable_lines": [
        "// Line_Reference 210:                                 $get_mp_tp = DBGet(DBQuery('SELECT MP_TYPE FROM marking_periods WHERE MARKING_PERIOD_ID=' . $mp_id[1]['MARKING_PERIOD_ID']));",
        "// Line_Reference 213:                                 $get_mp_tp = DBGet(DBQuery('SELECT MP_TYPE FROM marking_periods WHERE MARKING_PERIOD_ID=' . $mp_id[1]['MARKING_PERIOD_ID']));",
        "// Line_Reference 215:                             $get_mp_tp_m = DBGet(DBQuery('SELECT MP_TYPE FROM marking_periods WHERE MARKING_PERIOD_ID=' . $trec['MP_ID']));",
        "// Line_Reference 217:                             $get_mp_tp_m = DBGet(DBQuery('SELECT MP_TYPE FROM marking_periods WHERE MARKING_PERIOD_ID=' . $trec['MP_ID']));",
        "// Line_Reference 373: ",
        "// Line_Reference 374: \t\t<?php",
        "// Line_Reference 375:                 if($_SESSION['PROFILE'] != 'student')",
        "// Line_Reference 376: \t\t{",
        "// Line_Reference 377: \t\t?>",
        "// Line_Reference 398: \t\t<?php } ?>",
        "// Line_Reference 434:                 $picturehtml = '';",
        "// Line_Reference 435:                 if ($_REQUEST['show_photo']) {",
        "// Line_Reference 436:                     $stu_img_info = DBGet(DBQuery('SELECT * FROM user_file_upload WHERE USER_ID=' . $student_id . ' AND PROFILE_ID=3 AND SCHOOL_ID=' . UserSchool() . ' AND SYEAR=' . UserSyear() . ' AND FILE_INFO=\\'stuimg\\''));",
        "// Line_Reference 437:                     if (count($stu_img_info) > 0) {",
        "// Line_Reference 438:                         $picturehtml = '<td valign=\"top\" align=\"left\" width=30%><img style=\"padding:4px; width:144px; border:1px solid #333333; background-color:#fff;\" src=\"data:image/jpeg;base64,' . base64_encode($stu_img_info[1]['CONTENT']) . '\"></td>';",
        "// Line_Reference 439:                     } else {",
        "// Line_Reference 440:                         $picturehtml = '<td valign=\"top\" align=\"left\" width=30%><img style=\"padding:4px; border:1px solid #333333; background-color:#fff;\" src=\"assets/noimage.jpg\"></td>';",
        "// Line_Reference 441:                     }",
        "// Line_Reference 442:                 }",
        "// Line_Reference 443: ",
        "// Line_Reference 444: ",
        "// Line_Reference 445: ",
        "// Line_Reference 446:                 if ($probation) {",
        "// Line_Reference 447:                     $general_info_html = $general_info_html .",
        "// Line_Reference 448:                             '<tr><td width=\"2%\"></td><td width=\"3%\" style=\"padding-bottom:15px\">Status:</td><td width=\"95%\"> '._academicProbationPleaseBeRemindedOfSectionOfTheAcademicHandbooKIfStudentsFailToRaiseTheirCGPAAboveForTwoConsecutiveSemestersTheDefaultActionIsDismissalFromTheProgram.'.</td></tr>' .",
        "// Line_Reference 449:                             '</table><BR><BR></td></tr>';",
        "// Line_Reference 450:                 } else {",
        "// Line_Reference 451:                     $general_info_html = $general_info_html .",
        "// Line_Reference 452:                             '</table><BR><BR></td></tr>';",
        "// Line_Reference 453:                 }",
        "// Line_Reference 454:                 $student_html = '",
        "// Line_Reference 455:                 <table border=\"0\" style=\"font-family:Arial; font-size:12px;\" cellpadding=\"0\" cellspacing=\"0\"><tr>' . $picturehtml .",
        "// Line_Reference 456:                         '<td width=70% valign=bottom>",
        "// Line_Reference 457:                         <table width=\"100%\" border=\"0\" cellpadding=\"0\" cellspacing=\"0\" style=\"font-family:Arial; font-size:12px;\">",
        "// Line_Reference 458:                         <tr><td valign=bottom><div style=\"font-family:Arial; font-size:13px; padding:0px 12px 0px 12px;\"><div style=\"font-size:18px;\">' . $sinfo['LAST_NAME'] . ', ' . $sinfo['FIRST_NAME'] . ' ' . $sinfo['MIDDLE_NAME'] . '</div>",
        "// Line_Reference 459:                             <div>' . $sinfo['ADDRESS'] . '</div>",
        "// Line_Reference 460:                             <div>' . $sinfo['CITY'] . ', ' . $sinfo['STATE'] . '  ' . $sinfo['ZIPCODE'] . '</div>",
        "// Line_Reference 461:                             <div><b>Phone:</b>  ' . $sinfo['STUDENT_PHONE'] . '</div>",
        "// Line_Reference 462: \t\t\t\t\t\t\t<div><table cellspacing=\"0\" cellpadding=\"3\" border=\"1\"  style=\"font-family:Arial; font-size:13px; border-collapse: collapse; text-align:center\"><tr><td><b>'._dateOfBirthh.'</b></td><td><b>'._gender.'</b></td><td><b>'._grade.'</b></td></tr><tr><td>' . str_replace('-', '/', $sinfo['BIRTHDATE']) . '</td><td>' . $sinfo['GENDER'] . '</td><td>' . $sinfo['GRADE_SHORT'] . '</td></tr></table>' . '</div>",
        "// Line_Reference 463: \t\t\t\t\t\t\t</td>",
        "// Line_Reference 464: ",
        "// Line_Reference 465:                         </tr></table></td></tr><tr><td colspan=\"2\" style=\"padding:6px 0px 6px 0px;\"><table width=\"100%\" cellspacing=\"0\" cellpadding=\"3\" border=\"1\" align=center  style=\"font-family:Arial; font-size:13px; border-collapse: collapse; text-align:center\"><tr><td><b>'._cumulativeGpa.':</b> ' . sprintf(\"%01.2f\", (($tot_qp) / ($total_CGPA_attemted))) . '&nbsp;&nbsp;&nbsp;&nbsp;",
        "// Line_Reference 466: ",
        "// Line_Reference 467:                                 </td></tr><tr><td><b>'._totalCreditAttempted.':</b> ' . sprintf(\"%01.2f\", $total_CGPA_attemted) . '&nbsp;&nbsp;&nbsp;&nbsp;<b>'._totalCreditEarned.':</b> ' . sprintf(\"%01.2f\", $total_credit_earned) . '</td></tr></table></td></tr></table>';",
        "// Line_Reference 468: ",
        "// Line_Reference 469: ",
        "// Line_Reference 470: ",
        "// Line_Reference 471: ",
        "// Line_Reference 472:                 echo '';",
        "// Line_Reference 473:                 echo '<!-- NEW PAGE -->';"
    ]
}
