{
    "cve_id": "CVE-2017-15054",
    "cve_description": "An arbitrary file upload vulnerability, present in TeamPass before 2.1.27.9, allows remote authenticated users to upload arbitrary files leading to Remote Command Execution. To exploit this vulnerability, an authenticated attacker has to tamper with parameters of a request to upload.files.php, in order to select the correct branch and be able to upload any arbitrary file. From there, it can simply access the file to execute code on the server.",
    "cve_publish_date": "2017-11-27",
    "cwe_id": "CWE-434",
    "cwe_name": "Unrestricted Upload of File with Dangerous Type",
    "cwe_description": "The product allows the upload or transfer of dangerous file types that are automatically processed within its environment.",
    "commit_message": "2.1.27\n\nImproved security regarding uploading files\nFixed issue while restoring DB from administration page",
    "type_of_change": "Modification",
    "filename_of_changes": "functions.php",
    "code_language": "PHP",
    "number_of_lines_added_for_mitigation": "89",
    "number_of_lines_deleted_vulnerable_to_cve": "26",
    "vulnerable_lines": [
        "// Line_Reference 191:                             $category_query .= \"select id from \".prefix_table(\"nested_tree\").\" where title LIKE '\".$array_category[$slot].\"' AND parent_id = 0\";",
        "// Line_Reference 193:                             $category_query .= \"select id from \".prefix_table(\"nested_tree\").\" where title LIKE '\".$array_category[$slot].\"' AND parent_id = (\";",
        "// Line_Reference 200:                     $category_query = \"select id from \".prefix_table(\"nested_tree\").\" where title LIKE '\".$array_category[0].\"' AND parent_id = 0\";",
        "// Line_Reference 239:                             $category_query .= \"select id from \".prefix_table(\"nested_tree\").\" where title LIKE '\".$array_category[$slot].\"' AND parent_id = 0\";",
        "// Line_Reference 241:                             $category_query .= \"select id from \".prefix_table(\"nested_tree\").\" where title LIKE '\".$array_category[$slot].\"' AND parent_id = (\";",
        "// Line_Reference 248:                     $category_query = \"select id from \".prefix_table(\"nested_tree\").\" where title LIKE '\".$array_category[0].\"' AND parent_id = 0\";",
        "// Line_Reference 254:                 $response = DB::delete(prefix_table(\"items\"), \"id_tree = (\".$category_query.\") and label LIKE '\".$item.\"'\");",
        "// Line_Reference 385:                 $response = DB::query(\"SELECT fonction_id FROM \".prefix_table(\"users\").\" WHERE login='\".$username.\"'\");",
        "// Line_Reference 395:                     $response = DB::query(\"SELECT folder_id FROM \".prefix_table(\"roles_values\").\" WHERE role_id='\".$role.\"'\");",
        "// Line_Reference 459:                 $response = DB::query(\"SELECT fonction_id FROM \".prefix_table(\"users\").\" WHERE login='\".$username.\"'\");",
        "// Line_Reference 471:                     $response = DB::query(\"SELECT folder_id, type FROM \".prefix_table(\"roles_values\").\" WHERE role_id='\".$role.\"'\");",
        "// Line_Reference 477:                             $response2 = DB::queryFirstRow(\"SELECT title, nlevel FROM \".prefix_table(\"nested_tree\").\" WHERE id='\".$folder_id.\"'\");",
        "// Line_Reference 670:                         DB::query(\"SELECT * FROM \".prefix_table(\"items\").\" WHERE label = %s AND inactif = %i\", addslashes($item_label), \"0\");",
        "// Line_Reference 807:                     \"SELECT id, fonction_id, groupes_interdits, groupes_visibles FROM \".prefix_table(\"users\").\"",
        "// Line_Reference 808:             WHERE login LIKE %ss\",",
        "// Line_Reference 824:                             \"SELECT `valeur` FROM \".prefix_table(\"misc\").\" WHERE type = %s AND intitule = %s\",",
        "// Line_Reference 833:                                 \"SELECT `id` FROM \".prefix_table(\"roles_title\").\" WHERE title = %s\",",
        "// Line_Reference 947:                             DB::query(\"SELECT * FROM \".prefix_table(\"nested_tree\").\" WHERE title = %s\", $params[0]);",
        "// Line_Reference 1038:                         DB::query(\"SELECT * FROM \".prefix_table(\"nested_tree\").\" WHERE id = %i\", $params[3]);",
        "// Line_Reference 1046:                             \"SELECT * FROM \".prefix_table(\"items\").\" WHERE id = %i\",",
        "// Line_Reference 1097:                                             \"SELECT * FROM \".prefix_table(\"tags\").\" WHERE tag = %s AND item_id = %i\",",
        "// Line_Reference 1166:                         $data_folder = DB::queryfirstrow(\"SELECT * FROM \".prefix_table(\"nested_tree\").\" WHERE id = %s\", $GLOBALS['request'][2]);",
        "// Line_Reference 1255:                         \"SELECT `id`, `pw`, `groupes_interdits`, `groupes_visibles`, `fonction_id` FROM \".$pre.\"users WHERE login = %s\",",
        "// Line_Reference 1348:                         \"SELECT `id`, `pw`, `groupes_interdits`, `groupes_visibles`, `fonction_id`, `encrypted_psk` FROM \".$pre.\"users WHERE login = %s\",",
        "// Line_Reference 1466:                         \"SELECT `id`, `pw`, `groupes_interdits`, `groupes_visibles`, `fonction_id` FROM \".$pre.\"users WHERE login = %s\",",
        "// Line_Reference 1599:                         \"SELECT `id`, `pw`, `groupes_interdits`, `groupes_visibles`, `fonction_id`, `encrypted_psk` FROM \".$pre.\"users WHERE login = %s\","
    ]
}
