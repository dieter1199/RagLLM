{
    "cve_id": "CVE-2022-36879",
    "cve_description": "An issue was discovered in the Linux kernel through 5.18.14. xfrm_expand_policies in net/xfrm/xfrm_policy.c can cause a refcount to be dropped twice.",
    "cve_publish_date": "2022-07-27",
    "cwe_id": "NVD-CWE-Other",
    "cwe_name": "Other",
    "cwe_description": "NVD is only using a subset of CWE for mapping instead of the entire CWE, and the weakness type is not covered by that subset.",
    "commit_message": "xfrm: xfrm_policy: fix a possible double xfrm_pols_put() in xfrm_bundle_lookup()\n\nxfrm_policy_lookup() will call xfrm_pol_hold_rcu() to get a refcount of\npols[0]. This refcount can be dropped in xfrm_expand_policies() when\nxfrm_expand_policies() return error. pols[0]'s refcount is balanced in\nhere. But xfrm_bundle_lookup() will also call xfrm_pols_put() with\nnum_pols == 1 to drop this refcount when xfrm_expand_policies() return\nerror.\n\nThis patch also fix an illegal address access. pols[0] will save a error\npoint when xfrm_policy_lookup fails. This lead to xfrm_pols_put to resolve\nan illegal address in xfrm_bundle_lookup's error path.\n\nFix these by setting num_pols = 0 in xfrm_expand_policies()'s error path.\n\nFixes: 80c802f3073e (\"xfrm: cache bundles instead of policies for outgoing flows\")\nSigned-off-by: Hangyu Hua <hbh25y@gmail.com>\nSigned-off-by: Steffen Klassert <steffen.klassert@secunet.com>",
    "type_of_change": "Modification",
    "filename_of_changes": "xfrm_policy.c",
    "code_language": "C",
    "number_of_lines_added_for_mitigation": "4",
    "number_of_lines_deleted_vulnerable_to_cve": "1",
    "vulnerable_lines": [
        "// Line_Reference 2681: \tif (IS_ERR(pols[0]))"
    ]
}
