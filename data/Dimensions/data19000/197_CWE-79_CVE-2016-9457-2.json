{
    "cve_id": "CVE-2016-9457",
    "cve_description": "Revive Adserver before 3.2.3 suffers from Reflected XSS. `www/admin/stats.php` is vulnerable to reflected XSS attacks via multiple parameters that are not properly sanitised or escaped when displayed, such as setPerPage, pageId, bannerid, period_start, period_end, and possibly others.",
    "cve_publish_date": "2017-03-28",
    "cwe_id": "CWE-79",
    "cwe_name": "Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting')",
    "cwe_description": "The product does not neutralize or incorrectly neutralizes user-controllable input before it is placed in output that is used as a web page that is served to other users.",
    "commit_message": "Fix h1 report 107879\n\nReflected XSS\n-------------\n\nJohan Caluwe has reported via HackerOne that www/admin/stats.php was\nvulnerable to reflected XSS attacks via multiple parameters that were not\nproperly sanitised or escaped when displayed, such as \"setPerPage\", \"pageId\",\n\"bannerid\", \"pereiod_start\", \"period_end\" and possibly others.\n\nA CVE-ID has been requested, but not assigned yet.\n\nCWE: CWE-79\nCVSSv2: 5.6 (AV:N/AC:H/Au:S/C:C/I:P/A:N)",
    "type_of_change": "Modification",
    "filename_of_changes": "stats-conversions.php",
    "code_language": "PHP",
    "number_of_lines_added_for_mitigation": "50",
    "number_of_lines_deleted_vulnerable_to_cve": "47",
    "vulnerable_lines": [
        "// Line_Reference 61: $clientId       = MAX_getValue('clientid');",
        "// Line_Reference 62: $campaignId     = MAX_getValue('campaignid');",
        "// Line_Reference 63: $bannerId       = MAX_getValue('bannerid');",
        "// Line_Reference 64: ",
        "// Line_Reference 65: $affiliateId    = MAX_getValue('affiliateid');",
        "// Line_Reference 66: $zoneId         = MAX_getValue('zoneid');",
        "// Line_Reference 67: ",
        "// Line_Reference 68: if (OA_Permission::isAccount(OA_ACCOUNT_ADVERTISER)) {",
        "// Line_Reference 69:     $clientId = $clientid = OA_Permission::getEntityId();",
        "// Line_Reference 70: } elseif (OA_Permission::isAccount(OA_ACCOUNT_TRAFFICKER)) {",
        "// Line_Reference 71:     $affiliateId = $affiliateid = OA_Permission::getEntityId();",
        "// Line_Reference 78:     'campaignid'  => $campaignId,",
        "// Line_Reference 79:     'bannerid'    => $bannerId,",
        "// Line_Reference 80:     'affiliateid' => $affiliateId,",
        "// Line_Reference 81:     'zoneid'      => $zoneId,",
        "// Line_Reference 85: $addUrl = \"entity=conversions&clientid=$clientId&campaignid=$campaignId&bannerid=$bannerId&affiliateid=$affiliateId&zoneid=$zoneId&setPerPage=$setPerPage&pageID=$pageID\";",
        "// Line_Reference 93:     $addUrl .= \"&day={$day}&hour={$hour}&howLong={$howLong}\";",
        "// Line_Reference 100:     $addUrl .= \"&period_preset={$period_preset}&period_start={$period_start}&period_end={$period_end}\";",
        "// Line_Reference 181:     'clientid' => $clientId,",
        "// Line_Reference 182:     'campaignid' => $campaignId,",
        "// Line_Reference 183:     'bannerid' => $bannerId,",
        "// Line_Reference 184:     'affiliateid' => $affiliateId,",
        "// Line_Reference 185:     'zoneid' => $zoneId,",
        "// Line_Reference 202: $aParams['clientid']    = $clientId;",
        "// Line_Reference 203: $aParams['campaignid']  = $campaignId;",
        "// Line_Reference 204: $aParams['bannerid']    = $bannerId;",
        "// Line_Reference 206: if (empty($zoneId) && !empty($affiliateId)) {",
        "// Line_Reference 207:     $aZonesIds = Admin_DA::fromCache('getZonesIdsByAffiliateId', $affiliateId);",
        "// Line_Reference 209: if(!empty($zoneId)) {",
        "// Line_Reference 210:     $aZonesIds = array($zoneId);",
        "// Line_Reference 254:         echo \"<input type='hidden' name='clientid' value='$clientId'>\".\"\\n\";",
        "// Line_Reference 255:         echo \"<input type='hidden' name='campaignid' value='$campaignId'>\".\"\\n\";",
        "// Line_Reference 256:         echo \"<input type='hidden' name='bannerid' value='$bannerId'>\".\"\\n\";",
        "// Line_Reference 257:         echo \"<input type='hidden' name='affiliateid' value='$affiliateId'>\".\"\\n\";",
        "// Line_Reference 258:         echo \"<input type='hidden' name='zoneid' value='$zoneId'>\".\"\\n\";",
        "// Line_Reference 259:         echo \"<input type='hidden' name='day' value='$day'>\".\"\\n\";",
        "// Line_Reference 260:         echo \"<input type='hidden' name='hour' value='$hour'>\".\"\\n\";",
        "// Line_Reference 261:         echo \"<input type='hidden' name='howLong' value='$howLong'>\".\"\\n\";",
        "// Line_Reference 262:         echo \"<input type='hidden' name='period_preset' value='$period_preset'>\".\"\\n\";",
        "// Line_Reference 264:             echo \"<input type='hidden' name='period_start' value='$period_start'>\".\"\\n\";",
        "// Line_Reference 265:             echo \"<input type='hidden' name='period_end' value='$period_end'>\".\"\\n\";",
        "// Line_Reference 269:         echo \"<input type='hidden' name='setPerPage' value='$setPerPage'>\".\"\\n\";",
        "// Line_Reference 270:         echo \"<input type='hidden' name='pageID' value='$pageID'>\".\"\\n\";",
        "// Line_Reference 334:                 echo \"&nbsp;<a href='$pageName?collapse=a$conversionId&$addUrl'><img src='\" . OX::assetPath() . \"/images/triangle-d.gif' align='absmiddle' border='0'></a>&nbsp;\";",
        "// Line_Reference 336:                 echo \"&nbsp;<a href='$pageName?expand=a$conversionId&$addUrl'><img src='\" . OX::assetPath() . \"/images/$phpAds_TextDirection/triangle-l.gif' align='absmiddle' border='0'></a>&nbsp;\";",
        "// Line_Reference 447:             <td colspan='2' align='$phpAds_TextAlignRight' nowrap><img src='\" . OX::assetPath() . \"/images/triangle-d.gif' align='absmiddle' border='0'>&nbsp;<a href='$pageName?$addUrl&amp;expand=all' accesskey='$keyExpandAll'>$strExpandAll</a>&nbsp;&nbsp;|&nbsp;&nbsp;<img src='\" . OX::assetPath() . \"/images/$phpAds_TextDirection/triangle-l.gif' align='absmiddle' border='0'>&nbsp;<a href='$pageName?$addUrl&amp;expand=none' accesskey='$keyCollapseAll'>$strCollapseAll</a>&nbsp;&nbsp;</td>",
        "// Line_Reference 472:     echo \"<form id='setPager' method='get' action='stats.php?\".htmlentities($_SERVER['QUERY_STRING']).\"'>\";"
    ]
}
