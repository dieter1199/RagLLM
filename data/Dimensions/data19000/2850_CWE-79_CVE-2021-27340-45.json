{
    "cve_id": "CVE-2021-27340",
    "cve_description": "OpenSIS Community Edition version <= 7.6 is affected by a reflected XSS vulnerability in EmailCheck.php via the \"opt\" parameter.",
    "cve_publish_date": "2021-09-16",
    "cwe_id": "CWE-79",
    "cwe_name": "Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting')",
    "cwe_description": "The product does not neutralize or incorrectly neutralizes user-controllable input before it is placed in output that is used as a web page that is served to other users.",
    "commit_message": "Commit with security and bug fixes",
    "type_of_change": "ModificationType.ADD",
    "filename_of_changes": "Bottom.php",
    "code_language": "PHP",
    "number_of_lines_added_for_mitigation": "58",
    "number_of_lines_deleted_vulnerable_to_cve": "44",
    "vulnerable_lines": [
        "// Line_Reference 34: $url = validateQueryString(curPageURL());",
        "// Line_Reference 35: if ($url === FALSE) {",
        "// Line_Reference 36: \theader('Location: index.php');",
        "// Line_Reference 37: }",
        "// Line_Reference 39: if (clean_param($_REQUEST['modfunc'], PARAM_ALPHA) == 'print') {",
        "// Line_Reference 40: \t$connection = new mysqli($DatabaseServer, $DatabaseUsername, $DatabasePassword, $DatabaseName, $DatabasePort);",
        "// Line_Reference 43: \t$_REQUEST['_openSIS_PDF'] = mysqli_real_escape_string($connection, optional_param('_openSIS_PDF', '', PARAM_RAW));",
        "// Line_Reference 44: \t$_REQUEST['modname'] = mysqli_real_escape_string($connection, optional_param('modname', '', PARAM_RAW));",
        "// Line_Reference 45: \t$_REQUEST['failed_login'] = mysqli_real_escape_string($connection, optional_param('failed_login', '', PARAM_RAW));",
        "// Line_Reference 46: \tif (strpos($_REQUEST['modname'], '?') !== false)",
        "// Line_Reference 47: \t\t$modname = substr(mysqli_real_escape_string($connection, optional_param('modname', '', PARAM_RAW)), 0, strpos(mysqli_real_escape_string($connection, optional_param('modname', '', PARAM_RAW)), '?'));",
        "// Line_Reference 49: \t\t$modname = mysqli_real_escape_string($connection, optional_param('modname', '', PARAM_RAW));",
        "// Line_Reference 51: \tinclude('modules/' . sqlSecurityFilter($modname));",
        "// Line_Reference 52: \tif ($htmldocPath) {",
        "// Line_Reference 53: \t\tif ($htmldocAssetsPath)",
        "// Line_Reference 54: \t\t\t$html = par_rep('/</?CENTER>/', '', str_replace('assets/', $htmldocAssetsPath, ob_get_contents()));",
        "// Line_Reference 56: \t\t\t$html = par_rep('/</?CENTER>/', '', ob_get_contents());",
        "// Line_Reference 60: \t\t$temphtml = tempnam('', 'html');",
        "// Line_Reference 61: \t\t$temphtml_tmp = substr($temphtml, 0, strrpos($temphtml, \".\")) . 'html';",
        "// Line_Reference 64: \t\t$fp = @fopen($temphtml, \"w+\");",
        "// Line_Reference 66: \t\t\tdie(\"\" . _canTOpen . \" $temphtml\");",
        "// Line_Reference 67: \t\tfputs($fp, '<HTML><BODY>' . $html . '</BODY></HTML>');",
        "// Line_Reference 73: \t\theader(\"Content-Disposition: inline; filename=\\\"\" . ProgramTitle() . \".pdf\\\"\\n\");",
        "// Line_Reference 76: \t\tif ($_REQUEST['expanded_view'] || $_SESSION['orientation'] == 'landscape') {",
        "// Line_Reference 82: \t} else {",
        "// Line_Reference 83: \t\t$html = par_rep('/</?CENTER>/', '', ob_get_contents());",
        "// Line_Reference 85: \t\techo '<HTML><BODY>' . $html . '</BODY></HTML>';",
        "// Line_Reference 87: } else {",
        "// Line_Reference 88: \techo \"",
        "// Line_Reference 90: \t\t<HEAD><TITLE>\" . _openSisSchoolSoftware . \"</TITLE>",
        "// Line_Reference 107: \t//\t\t<link rel=stylesheet type=text/css href=styles/Help.css>",
        "// Line_Reference 108: \techo \"</HEAD>",
        "// Line_Reference 110: ",
        "// Line_Reference 115: \tif ($_REQUEST['modcat'] && $_REQUEST['modname']) {",
        "// Line_Reference 116: \t\techo '<b>' . str_replace('_', ' ', $_REQUEST['modcat']);",
        "// Line_Reference 117: \t\techo ' : ' . $_openSIS['Menu'][$_REQUEST['modcat']][$_REQUEST['modname']];",
        "// Line_Reference 120: \tif ($help[$_REQUEST['modcat']] && !$_REQUEST['modname']) {",
        "// Line_Reference 121: \t\tif ($student == true)",
        "// Line_Reference 122: \t\t\t$help[$_REQUEST['modcat']] = str_replace('your child', 'yourself', str_replace('your child\\'s', 'your', $help[$_REQUEST['modcat']]));",
        "// Line_Reference 123: \t\techo $help[$_REQUEST['modcat']];",
        "// Line_Reference 124: \t} elseif ($help[$_REQUEST['modname']]) {",
        "// Line_Reference 125: \t\tif ($student == true)",
        "// Line_Reference 126: \t\t\t$help[$_REQUEST['modname']] = str_replace('your child', 'yourself', str_replace('your child\\'s', 'your', $help[$_REQUEST['modname']]));",
        "// Line_Reference 129: \t} else"
    ]
}
