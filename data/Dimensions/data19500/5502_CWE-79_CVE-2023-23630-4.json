{
    "cve_id": "CVE-2023-23630",
    "cve_description": "Eta is an embedded JS templating engine that works inside Node, Deno, and the browser. XSS attack - anyone using the Express API is impacted. The problem has been resolved. Users should upgrade to version 2.0.0. As a workaround, don't pass user supplied things directly to `res.render`. \n",
    "cve_publish_date": "2023-02-01",
    "cwe_id": "CWE-79",
    "cwe_name": "Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting')",
    "cwe_description": "The product does not neutralize or incorrectly neutralizes user-controllable input before it is placed in output that is used as a web page that is served to other users.",
    "commit_message": "Don't use data object for Eta configuration (#214)",
    "type_of_change": "Modification",
    "filename_of_changes": "file-handlers.ts",
    "code_language": "TypeScript",
    "number_of_lines_added_for_mitigation": "7",
    "number_of_lines_deleted_vulnerable_to_cve": "35",
    "vulnerable_lines": [
        "// Line_Reference 7: import { copyProps } from \"./utils.js\";",
        "// Line_Reference 18:   /** Express.js settings may be stored here */",
        "// Line_Reference 19:   settings?: {",
        "// Line_Reference 20:     [key: string]: any; // eslint-disable-line @typescript-eslint/no-explicit-any",
        "// Line_Reference 21:   };",
        "// Line_Reference 153:  * - `renderFile(filename, dataAndConfig, [cb])`",
        "// Line_Reference 154:  *   - Eta will merge `dataAndConfig` into `eta.config`",
        "// Line_Reference 169:  * let rendered = await eta.renderFile(\"./template\", {...data, cache: true})",
        "// Line_Reference 195:   However, with Express, configuration options will be passed along with the data.",
        "// Line_Reference 196:   Thus, Express will call renderFile with (filename, dataAndOptions, cb)",
        "// Line_Reference 197:   And we want to also make (filename, data, options, cb) available",
        "// Line_Reference 202:   data = data || {}; // If data is undefined, we don't want accessing data.settings to error",
        "// Line_Reference 219:     // Otherwise, get the config from the data object",
        "// Line_Reference 220:     // And then grab some config options from data.settings",
        "// Line_Reference 221:     // Which is where Express sometimes stores them",
        "// Line_Reference 222:     renderConfig = getConfig(data as PartialConfig) as EtaConfigWithFilename;",
        "// Line_Reference 223:     if (data.settings) {",
        "// Line_Reference 224:       // Pull a few things from known locations",
        "// Line_Reference 225:       if (data.settings.views) {",
        "// Line_Reference 226:         renderConfig.views = data.settings.views;",
        "// Line_Reference 227:       }",
        "// Line_Reference 228:       if (data.settings[\"view cache\"]) {",
        "// Line_Reference 229:         renderConfig.cache = true;",
        "// Line_Reference 230:       }",
        "// Line_Reference 231:       // Undocumented after Express 2, but still usable, esp. for",
        "// Line_Reference 232:       // items that are unsafe to be passed along with data, like `root`",
        "// Line_Reference 233:       const viewOpts = data.settings[\"view options\"];",
        "// Line_Reference 234: ",
        "// Line_Reference 235:       if (viewOpts) {",
        "// Line_Reference 236:         copyProps(renderConfig, viewOpts);",
        "// Line_Reference 237:       }",
        "// Line_Reference 238:     }",
        "// Line_Reference 255:  * - `renderFile(filename, dataAndConfig, [cb])`",
        "// Line_Reference 256:  *   - Eta will merge `dataAndConfig` into `eta.config`",
        "// Line_Reference 271:  * let rendered = await eta.renderFile(\"./template\", {...data, cache: true})"
    ]
}
