{
    "cve_id": "CVE-2022-45962",
    "cve_description": "Open Solutions for Education, Inc openSIS Community Edition v8.0 and earlier is vulnerable to SQL Injection via CalendarModal.php.",
    "cve_publish_date": "2023-02-13",
    "cwe_id": "CWE-89",
    "cwe_name": "Improper Neutralization of Special Elements used in an SQL Command ('SQL Injection')",
    "cwe_description": "The product constructs all or part of an SQL command using externally-influenced input from an upstream component, but it does not neutralize or incorrectly neutralizes special elements that could modify the intended SQL command when it is sent to a downstream component. Without sufficient removal or quoting of SQL syntax in user-controllable inputs, the generated SQL query can cause those inputs to be interpreted as SQL instead of ordinary user data.",
    "commit_message": "Version 9.0 release\n\nOlder version shifted to branch: Version_8.0",
    "type_of_change": "ModificationType.ADD",
    "filename_of_changes": "TeacherReassignment.php",
    "code_language": "PHP",
    "number_of_lines_added_for_mitigation": "40",
    "number_of_lines_deleted_vulnerable_to_cve": "45",
    "vulnerable_lines": [
        "// Line_Reference 44:     PopTable('header', _search );",
        "// Line_Reference 45:     echo \"<FORM name=F1 id=F1 action=Modules.php?modname=\" . strip_tags(trim($_REQUEST[modname])) . \"&modfunc=\" . strip_tags(trim($_REQUEST[modfunc])) . \"&course_modfunc=search method=POST>\";",
        "// Line_Reference 46:     echo '<TABLE><TR><TD><INPUT type=text class=form-control name=search_term value=\"' . strip_tags(trim($_REQUEST['search_term'])) . '\"></TD><TD><INPUT type=submit class=\"btn btn-primary\" value='._search.' onclick=\\'formload_ajax(\"F1\")\\';></TD></TR></TABLE>';",
        "// Line_Reference 60:         ListOutput($subjects_RET, array('TITLE' =>_subject), _subject, _subjects , $link, array(), array('search' =>false, 'save' =>_subject));",
        "// Line_Reference 68:         ListOutput($courses_RET, array('TITLE' =>_course),  _course, _courses, $link, array(), array('search' =>false, 'save' =>_course));",
        "// Line_Reference 76:         ListOutput($periods_RET, array('TITLE' =>_coursePeriod),  _coursePeriod, _coursePeriods, $link, array(), array('search' =>false, 'save' =>_coursePeriod));",
        "// Line_Reference 106:                     if(User('PROFILE') == 'admin' && strtotime($assign_date) <= strtotime(date('Y-m-d'))){",
        "// Line_Reference 115:                                 $p.=$period['SHORT_NAME'];",
        "// Line_Reference 116:                 }",
        "// Line_Reference 118:                                 $d.=$data['DAYS'];",
        "// Line_Reference 123:                         if($cp_data_RET['MARKING_PERIOD_ID'] != '')",
        "// Line_Reference 124:                         {",
        "// Line_Reference 132:                             if($table != 'school_years') {",
        "// Line_Reference 133:                                 $mp_sql = \"SELECT short_name FROM \".$table.\" WHERE marking_period_id=\".$cp_data_RET['MARKING_PERIOD_ID'];",
        "// Line_Reference 144:                         $teacher.=$teacher_RET['FIRST_NAME'];",
        "// Line_Reference 146:                             $teacher.=' ' . $teacher_RET['MIDDLE_NAME'];",
        "// Line_Reference 147:                         $teacher.=' ' . $teacher_RET['LAST_NAME'];",
        "// Line_Reference 149:                         if($mp != '')",
        "// Line_Reference 161:                 // $title_RET = DBGet(DBQuery('SELECT TITLE FROM course_periods WHERE COURSE_PERIOD_ID=\\'' . $id . '\\''));",
        "// Line_Reference 162:                 ####################################Teacher Reassignment New change end#########################################",
        "// Line_Reference 165:                 ShowErrPhp(''._thereIsNoAssociationsInHisCoursePeriodYouCanDeleteItFromSchoolSetUpCourseManager.'');",
        "// Line_Reference 168:             ShowErrPhp(''._assignedDateCanNotBeLesserThanTodaysDate.'');",
        "// Line_Reference 171:         ShowErrPhp(''._pleaseEnterProperDate.'');",
        "// Line_Reference 186:         DrawBC(\"\"._scheduling.\" > \" . ProgramTitle());",
        "// Line_Reference 195: \t\t\t\t\t\tWHERE COURSE_PERIOD_ID=\\'' . $_REQUEST[course_period_id] . '\\'';",
        "// Line_Reference 200: ",
        "// Line_Reference 201:              $status_bar = '';",
        "// Line_Reference 202: ",
        "// Line_Reference 204:                 $status_bar .='<div class=\"alert alert-success alert-styled-left\">",
        "// Line_Reference 205:                             <button type=\"button\" class=\"close\" data-dismiss=\"alert\"><span>Ã—</span><span class=\"sr-only\">'._close.'</span></button>",
        "// Line_Reference 206:                             '._teacherReAssignmentDone.' <a href=\"#\" onclick=\"load_link(\\'Modules.php?modname=' . $_REQUEST['modname'] . '&subject_id=' . $_REQUEST['subject_id'] . '&course_id=' . $_REQUEST['course_id'] . '&course_period_id=' . $_REQUEST['course_period_id'] . '&action=undo\\')\" class=\"btn-undo alert-link m-l-20\">'._undo.'</a>",
        "// Line_Reference 208:             echo \"<FORM name=F2 id=F2 action=Modules.php?modname=\" . strip_tags(trim($_REQUEST[modname])) . \"&subject_id=\" . strip_tags(trim($_REQUEST[subject_id])) . \"&course_id=\" . strip_tags(trim($_REQUEST[course_id])) . \"&course_period_id=\" . strip_tags(trim($_REQUEST[course_period_id])) . \" method=POST>\";",
        "// Line_Reference 217:             $header .= '<div class=\"col-md-3\"><label class=\"control-label\">'._selectNewTeacher.'</label>';",
        "// Line_Reference 224:             $header .= '<div class=\"col-md-3\"><label class=\"control-label\">'._assignDate.'</label>';",
        "// Line_Reference 237:             $LO_options = array('save' =>false, 'search' =>false);",
        "// Line_Reference 238: ",
        "// Line_Reference 239:              $columns = array('TEACHER' => _teacher, 'ASSIGN_DATE' => _assignDate, 'PRE_TEACHER_ID' => _previousTeacher, 'MODIFIED_DATE' => _modifiedDate, 'MODIFIED_BY' => _modifiedBy);",
        "// Line_Reference 255:     $LO_options = array('save' =>false, 'search' =>false);",
        "// Line_Reference 257:     if (!$_REQUEST['subject_id'] || clean_param($_REQUEST['modfunc'], PARAM_ALPHAMOD) == 'choose_course'){",
        "// Line_Reference 260:         echo \"<A HREF=ForWindow.php?modname=$_REQUEST[modname]&modfunc=$_REQUEST[modfunc]&course_modfunc=search><i class=\\\"icon-search4 position-left\\\"></i> \"._searchCourse.\"</A>\";",
        "// Line_Reference 278:     $columns = array('TITLE' =>_subject);",
        "// Line_Reference 305:         $columns = array('TITLE' =>_course);",
        "// Line_Reference 332:             $columns = array('TITLE' =>_coursePeriod);",
        "// Line_Reference 344: ",
        "// Line_Reference 347: ?>"
    ]
}
