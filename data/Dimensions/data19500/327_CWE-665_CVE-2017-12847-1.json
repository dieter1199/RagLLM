{
    "cve_id": "CVE-2017-12847",
    "cve_description": "Nagios Core before 4.3.3 creates a nagios.lock PID file after dropping privileges to a non-root account, which might allow local users to kill arbitrary processes by leveraging access to this non-root account for nagios.lock modification before a root script executes a \"kill `cat /pathname/nagios.lock`\" command.",
    "cve_publish_date": "2017-08-23",
    "cwe_id": "CWE-665",
    "cwe_name": "Improper Initialization",
    "cwe_description": "The product does not initialize or incorrectly initializes a resource, which might leave the resource in an unexpected state when it is accessed or used.",
    "commit_message": "halfway revert hack/configure changes - switch order of daemon_init/drop_privileges",
    "type_of_change": "Modification",
    "filename_of_changes": "nagios.c",
    "code_language": "C",
    "number_of_lines_added_for_mitigation": "16",
    "number_of_lines_deleted_vulnerable_to_cve": "15",
    "vulnerable_lines": [
        "// Line_Reference 615: \t\t\t/* enter daemon mode (unless we're restarting...) */",
        "// Line_Reference 616: \t\t\tif(daemon_mode == TRUE && sigrestart == FALSE) {",
        "// Line_Reference 617: ",
        "// Line_Reference 618: \t\t\t\tresult = daemon_init();",
        "// Line_Reference 619: ",
        "// Line_Reference 620: \t\t\t\t/* we had an error daemonizing, so bail... */",
        "// Line_Reference 621: \t\t\t\tif(result == ERROR) {",
        "// Line_Reference 622: \t\t\t\t\tlogit(NSLOG_PROCESS_INFO | NSLOG_RUNTIME_ERROR, TRUE, \"Bailing out due to failure to daemonize. (PID=%d)\", (int)getpid());",
        "// Line_Reference 623: \t\t\t\t\tcleanup();",
        "// Line_Reference 624: \t\t\t\t\texit(EXIT_FAILURE);",
        "// Line_Reference 625: \t\t\t\t\t}",
        "// Line_Reference 626: ",
        "// Line_Reference 627: \t\t\t\t/* get new PID */",
        "// Line_Reference 628: \t\t\t\tnagios_pid = (int)getpid();",
        "// Line_Reference 629: \t\t\t\t}"
    ]
}
