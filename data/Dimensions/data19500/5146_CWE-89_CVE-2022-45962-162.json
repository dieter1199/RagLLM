{
    "cve_id": "CVE-2022-45962",
    "cve_description": "Open Solutions for Education, Inc openSIS Community Edition v8.0 and earlier is vulnerable to SQL Injection via CalendarModal.php.",
    "cve_publish_date": "2023-02-13",
    "cwe_id": "CWE-89",
    "cwe_name": "Improper Neutralization of Special Elements used in an SQL Command ('SQL Injection')",
    "cwe_description": "The product constructs all or part of an SQL command using externally-influenced input from an upstream component, but it does not neutralize or incorrectly neutralizes special elements that could modify the intended SQL command when it is sent to a downstream component. Without sufficient removal or quoting of SQL syntax in user-controllable inputs, the generated SQL query can cause those inputs to be interpreted as SQL instead of ordinary user data.",
    "commit_message": "Version 9.0 release\n\nOlder version shifted to branch: Version_8.0",
    "type_of_change": "ModificationType.ADD",
    "filename_of_changes": "Validator.php",
    "code_language": "PHP",
    "number_of_lines_added_for_mitigation": "91",
    "number_of_lines_deleted_vulnerable_to_cve": "81",
    "vulnerable_lines": [
        "// Line_Reference 28: \tinclude('RedirectRootInc.php');",
        "// Line_Reference 29: \tinclude'ConfigInc.php';",
        "// Line_Reference 30: \tinclude 'Warehouse.php';",
        "// Line_Reference 31: \t// include('functions/SqlSecurityFnc.php');",
        "// Line_Reference 33: \t$stfid = sqlSecurityFilter($_GET['stfid']);",
        "// Line_Reference 34: \t\t\t $flag = $_GET['u'];",
        "// Line_Reference 35: \t  $usr = substr($flag, -4);",
        "// Line_Reference 36: ",
        "// Line_Reference 37: \t// ------------------------ For Unique Checking ---------------------------------- //",
        "// Line_Reference 38: \t$un = substr($flag, 0, -4);",
        "// Line_Reference 39: \t$un = strtoupper($un);",
        "// Line_Reference 40: \t// ------------------------ For Unique Checking ---------------------------------- //",
        "// Line_Reference 41:          switch ($_GET['validate'])",
        "// Line_Reference 43:             case 'pass':",
        "// Line_Reference 44:                         $res_pass_chk = DBQuery(\"SELECT * FROM login_authentication WHERE password = '\".md5($_GET['password']).\"' AND user_id!='\".$stfid.\"' AND profile_id=0\");",
        "// Line_Reference 45:                         $num_pass = $res_pass_chk->num_rows;",
        "// Line_Reference 46:                         if($num_pass==0)",
        "// Line_Reference 47:                         {",
        "// Line_Reference 48:                             echo 1;",
        "// Line_Reference 49: ",
        "// Line_Reference 50:                         }",
        "// Line_Reference 51:                 break;",
        "// Line_Reference 53:             case 'pass_o':",
        "// Line_Reference 54:                         $res_pass_chk = DBQuery(\"SELECT * FROM login_authentication WHERE password = '\".md5($_GET['password']).\"'  AND profile_id=0\");",
        "// Line_Reference 55:                         $num_pass = $res_pass_chk->num_rows;",
        "// Line_Reference 56:                         if($num_pass==0)",
        "// Line_Reference 57:                         {",
        "// Line_Reference 58:                             echo '1_'.$_GET['opt'];",
        "// Line_Reference 59: ",
        "// Line_Reference 60:                         }",
        "// Line_Reference 61:                         else",
        "// Line_Reference 62:                         {",
        "// Line_Reference 63:                             echo '0_'.$_GET['opt'];",
        "// Line_Reference 64:                         }",
        "// Line_Reference 65:                 break;",
        "// Line_Reference 66:             default :",
        "// Line_Reference 67: \tif($usr == 'user')",
        "// Line_Reference 68: \t{",
        "// Line_Reference 69: ",
        "// Line_Reference 70: \t\t$result = DBGet(DBQuery(\"select username from login_authentication\"));",
        "// Line_Reference 71: ",
        "// Line_Reference 72: \t\t$xyz = 0;",
        "// Line_Reference 73: \t\tforeach ($result as $k => $v)",
        "// Line_Reference 74: \t\t{",
        "// Line_Reference 75: \t\t  $unames[$xyz] = strtoupper($v['USERNAME']); // For Unique Checking.",
        "// Line_Reference 76: \t\t  $xyz++;",
        "// Line_Reference 77: \t\t}",
        "// Line_Reference 78: ",
        "// Line_Reference 79: \t\tif ($un != '')",
        "// Line_Reference 81: \t\t\tif (in_array ($un, $unames))",
        "// Line_Reference 83: \t\t\t\techo '0';",
        "// Line_Reference 84: \t\t\t}",
        "// Line_Reference 85: \t\t\telse",
        "// Line_Reference 87: \t\t\t\techo '1';",
        "// Line_Reference 89: \t\t\texit;",
        "// Line_Reference 91: \t}",
        "// Line_Reference 92: \telse",
        "// Line_Reference 93: \t{",
        "// Line_Reference 94: ",
        "// Line_Reference 95: ",
        "// Line_Reference 96: \t\t$result = DBGet(DBQuery(\"select username from login_authentication\"));",
        "// Line_Reference 97: ",
        "// Line_Reference 98: \t\t$xyz = 0;",
        "// Line_Reference 99: \t\tforeach ($result as $k => $v)",
        "// Line_Reference 101: \t\t  $unames[$xyz] = strtoupper($v['USERNAME']); // For Unique Checking.",
        "// Line_Reference 102: \t\t  $xyz++;",
        "// Line_Reference 103: \t\t}",
        "// Line_Reference 104: ",
        "// Line_Reference 105: \t\tif ($un != '')",
        "// Line_Reference 106: \t\t{\tif(is_array($unames)){",
        "// Line_Reference 107: \t\t\tif (in_array ($un, $unames))",
        "// Line_Reference 109: \t\t\t\techo '0';",
        "// Line_Reference 110: \t\t\t}",
        "// Line_Reference 111: \t\t\telse",
        "// Line_Reference 112: \t\t\t{",
        "// Line_Reference 113: \t\t\t\techo '1';",
        "// Line_Reference 115: \t\t\t}else{",
        "// Line_Reference 116: \t\t\techo '1';",
        "// Line_Reference 118: \t\t\texit;",
        "// Line_Reference 120: \t}",
        "// Line_Reference 121:         }"
    ]
}
