{
    "cve_id": "CVE-2011-1007",
    "cve_description": "Best Practical Solutions RT before 3.8.9 does not perform certain redirect actions upon a login, which allows physically proximate attackers to obtain credentials by resubmitting the login form via the back button of a web browser on an unattended workstation after an RT logout.",
    "cve_publish_date": "2011-02-28",
    "cwe_id": "CWE-255",
    "cwe_name": "Credentials Management Errors",
    "cwe_description": "Weaknesses in this category are related to the management of credentials.",
    "commit_message": "Redirect to the desired page after logging in a user\n\nThis prevents back button attacks in the form of resubmitting form data\nafter the user has logged out of the browser (but not closed it).  See\nalso rt3 #15804.\n\nFor non-homepage hits, the browser now also gets redirected to\n/NoAuth/Login.html to get a login form.\n\nWe use the session to store the next page URL (referenced by a hash),\nsimilar to how action results work.",
    "type_of_change": "Modification",
    "filename_of_changes": "Web.pm",
    "code_language": "Perl",
    "number_of_lines_added_for_mitigation": "161",
    "number_of_lines_deleted_vulnerable_to_cve": "21",
    "vulnerable_lines": [
        "// Line_Reference 210:         # If the user is logging in, let's authenticate",
        "// Line_Reference 211:         if ( defined $ARGS->{user} && defined $ARGS->{pass} ) {",
        "// Line_Reference 212:             AttemptPasswordAuthentication($ARGS);",
        "// Line_Reference 213:         } else {",
        "// Line_Reference 214:             # if no credentials then show him login page",
        "// Line_Reference 215:             $HTML::Mason::Commands::m->comp( '/Elements/Login', %$ARGS );",
        "// Line_Reference 216:             $HTML::Mason::Commands::m->abort;",
        "// Line_Reference 389:                 $m->comp( '/Elements/Login', %$ARGS, Error => HTML::Mason::Commands::loc( 'Cannot create user: [_1]', $msg ) )",
        "// Line_Reference 390:                     if RT->Config->Get('WebFallbackToInternalAuth');;",
        "// Line_Reference 391:                 $m->abort();",
        "// Line_Reference 402:                 $m->comp( '/Elements/Login', %$ARGS, Error => HTML::Mason::Commands::loc('You are not an authorized user') );",
        "// Line_Reference 403:                 $m->abort();",
        "// Line_Reference 409:             $m->comp( '/Elements/Login', %$ARGS, Error => HTML::Mason::Commands::loc('You are not an authorized user') );",
        "// Line_Reference 410:             $m->abort();",
        "// Line_Reference 423:     my $ARGS     = shift;",
        "// Line_Reference 431:         $m->comp( '/Elements/Login', %$ARGS, Error => HTML::Mason::Commands::loc('Your username or password is incorrect'), );",
        "// Line_Reference 433:         $m->abort;",
        "// Line_Reference 436:     $RT::Logger->info(\"Successful login for @{[$ARGS->{user}]} from $ENV{'REMOTE_ADDR'}\");",
        "// Line_Reference 437:     InstantiateNewSession();",
        "// Line_Reference 438:     $HTML::Mason::Commands::session{'CurrentUser'} = $user_obj;",
        "// Line_Reference 439:     $m->callback( %$ARGS, CallbackName => 'SuccessfulLogin', CallbackPage => '/autohandler' );"
    ]
}
