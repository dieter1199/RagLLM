{
    "cve_id": "CVE-2016-6897",
    "cve_description": "Cross-site request forgery (CSRF) vulnerability in the wp_ajax_update_plugin function in wp-admin/includes/ajax-actions.php in WordPress before 4.6 allows remote attackers to hijack the authentication of subscribers for /dev/random read operations by leveraging a late call to the check_ajax_referer function, a related issue to CVE-2016-6896.",
    "cve_publish_date": "2017-01-18",
    "cwe_id": "CWE-352",
    "cwe_name": "Cross-Site Request Forgery (CSRF)",
    "cwe_description": "The web application does not, or can not, sufficiently verify whether a well-formed, valid, consistent request was intentionally provided by the user who submitted the request.",
    "commit_message": "Update/Install: Shiny Updates v2.\n\nGone are the days of isolation and feelings of \"meh\", brought on by The Bleak Screen of Sadness. For a shiny knight has arrived to usher our plugins and themes along their arduous journey of installation, updates, and the inevitable fate of ultimate deletion.\n\nProps swissspidy, adamsilverstein, mapk, afragen, ocean90, ryelle, j-falk, michael-arestad, melchoyce, DrewAPicture, AdamSoucie, ethitter, pento, dd32, kraftbj, Ipstenu, jorbin, afercia, stephdau, paulwilde, jipmoors, khag7, svovaf, jipmoors, obenland.\nFixes #22029, #25828, #31002, #31529, #31530, #31773, #33637, #35032.\n\n\nBuilt from https://develop.svn.wordpress.org/trunk@37714\n\n\ngit-svn-id: http://core.svn.wordpress.org/trunk@37680 1a063a9b-81f0-0310-95a4-ce76da25c4cd",
    "type_of_change": "Modification",
    "filename_of_changes": "plugin-install.php",
    "code_language": "PHP",
    "number_of_lines_added_for_mitigation": "61",
    "number_of_lines_deleted_vulnerable_to_cve": "51",
    "vulnerable_lines": [
        "// Line_Reference 543: \t<div id=\"<?php echo $_tab; ?>-content\" class='<?php echo $_with_banner; ?>'>",
        "// Line_Reference 546: \t\t<?php if ( ! empty( $api->version ) ) { ?>",
        "// Line_Reference 547: \t\t\t<li><strong><?php _e( 'Version:' ); ?></strong> <?php echo $api->version; ?></li>",
        "// Line_Reference 548: \t\t<?php } if ( ! empty( $api->author ) ) { ?>",
        "// Line_Reference 549: \t\t\t<li><strong><?php _e( 'Author:' ); ?></strong> <?php echo links_add_target( $api->author, '_blank' ); ?></li>",
        "// Line_Reference 550: \t\t<?php } if ( ! empty( $api->last_updated ) ) { ?>",
        "// Line_Reference 551: \t\t\t<li><strong><?php _e( 'Last Updated:' ); ?></strong>",
        "// Line_Reference 552: \t\t\t\t<?php printf( __( '%s ago' ), human_time_diff( strtotime( $api->last_updated ) ) ); ?>",
        "// Line_Reference 553: \t\t\t</li>",
        "// Line_Reference 554: \t\t<?php } if ( ! empty( $api->requires ) ) { ?>",
        "// Line_Reference 555: \t\t\t<li><strong><?php _e( 'Requires WordPress Version:' ); ?></strong> <?php printf( __( '%s or higher' ), $api->requires ); ?></li>",
        "// Line_Reference 556: \t\t<?php } if ( ! empty( $api->tested ) ) { ?>",
        "// Line_Reference 557: \t\t\t<li><strong><?php _e( 'Compatible up to:' ); ?></strong> <?php echo $api->tested; ?></li>",
        "// Line_Reference 558: \t\t<?php } if ( ! empty( $api->active_installs ) ) { ?>",
        "// Line_Reference 559: \t\t\t<li><strong><?php _e( 'Active Installs:' ); ?></strong> <?php",
        "// Line_Reference 560: \t\t\t\tif ( $api->active_installs >= 1000000 ) {",
        "// Line_Reference 561: \t\t\t\t\t_ex( '1+ Million', 'Active plugin installs' );",
        "// Line_Reference 562: \t\t\t\t} else {",
        "// Line_Reference 563: \t\t\t\t\techo number_format_i18n( $api->active_installs ) . '+';",
        "// Line_Reference 564: \t\t\t\t}",
        "// Line_Reference 565: \t\t\t?></li>",
        "// Line_Reference 566: \t\t<?php } if ( ! empty( $api->slug ) && empty( $api->external ) ) { ?>",
        "// Line_Reference 567: \t\t\t<li><a target=\"_blank\" href=\"https://wordpress.org/plugins/<?php echo $api->slug; ?>/\"><?php _e( 'WordPress.org Plugin Page &#187;' ); ?></a></li>",
        "// Line_Reference 568: \t\t<?php } if ( ! empty( $api->homepage ) ) { ?>",
        "// Line_Reference 569: \t\t\t<li><a target=\"_blank\" href=\"<?php echo esc_url( $api->homepage ); ?>\"><?php _e( 'Plugin Homepage &#187;' ); ?></a></li>",
        "// Line_Reference 570: \t\t<?php } if ( ! empty( $api->donate_link ) && empty( $api->contributors ) ) { ?>",
        "// Line_Reference 571: \t\t\t<li><a target=\"_blank\" href=\"<?php echo esc_url( $api->donate_link ); ?>\"><?php _e( 'Donate to this plugin &#187;' ); ?></a></li>",
        "// Line_Reference 572: \t\t<?php } ?>",
        "// Line_Reference 575: \t\t<h3><?php _e( 'Average Rating' ); ?></h3>",
        "// Line_Reference 576: \t\t<?php wp_star_rating( array( 'rating' => $api->rating, 'type' => 'percent', 'number' => $api->num_ratings ) ); ?>",
        "// Line_Reference 577: \t\t<p aria-hidden=\"true\" class=\"fyi-description\"><?php printf( _n( '(based on %s rating)', '(based on %s ratings)', $api->num_ratings ), number_format_i18n( $api->num_ratings ) ); ?></p>",
        "// Line_Reference 594: \t\t\t\t\t<span class=\"counter-label\"><a href=\"https://wordpress.org/support/view/plugin-reviews/<?php echo $api->slug; ?>?filter=<?php echo $key; ?>\"",
        "// Line_Reference 595: \t\t\t\t\t\ttarget=\"_blank\" aria-label=\"<?php echo $aria_label; ?>\"><?php printf( _n( '%d star', '%d stars', $key ), $key ); ?></a></span>",
        "// Line_Reference 596: \t\t\t\t\t<span class=\"counter-back\">",
        "// Line_Reference 597: \t\t\t\t\t\t<span class=\"counter-bar\" style=\"width: <?php echo 92 * $_rating; ?>px;\"></span>",
        "// Line_Reference 598: \t\t\t\t\t</span>",
        "// Line_Reference 631: \t\tif ( ! empty( $api->tested ) && version_compare( substr( $GLOBALS['wp_version'], 0, strlen( $api->tested ) ), $api->tested, '>' ) ) {",
        "// Line_Reference 632: \t\t\techo '<div class=\"notice notice-warning notice-alt\"><p>' . __( '<strong>Warning:</strong> This plugin has <strong>not been tested</strong> with your current version of WordPress.' ) . '</p></div>';",
        "// Line_Reference 633: \t\t} elseif ( ! empty( $api->requires ) && version_compare( substr( $GLOBALS['wp_version'], 0, strlen( $api->requires ) ), $api->requires, '<' ) ) {",
        "// Line_Reference 634: \t\t\techo '<div class=\"notice notice-warning notice-alt\"><p>' . __( '<strong>Warning:</strong> This plugin has <strong>not been marked as compatible</strong> with your version of WordPress.' ) . '</p></div>';",
        "// Line_Reference 635: \t\t}",
        "// Line_Reference 637: \t\tforeach ( (array) $api->sections as $section_name => $content ) {",
        "// Line_Reference 638: \t\t\t$content = links_add_base_url( $content, 'https://wordpress.org/plugins/' . $api->slug . '/' );",
        "// Line_Reference 639: \t\t\t$content = links_add_target( $content, '_blank' );",
        "// Line_Reference 641: \t\t\t$san_section = esc_attr( $section_name );",
        "// Line_Reference 643: \t\t\t$display = ( $section_name === $section ) ? 'block' : 'none';",
        "// Line_Reference 645: \t\t\techo \"\\t<div id='section-{$san_section}' class='section' style='display: {$display};'>\\n\";",
        "// Line_Reference 646: \t\t\techo $content;",
        "// Line_Reference 647: \t\t\techo \"\\t</div>\\n\";",
        "// Line_Reference 648: \t\t}",
        "// Line_Reference 658: \t\t\t\t\techo '<a class=\"button button-primary right\" href=\"' . $status['url'] . '\" target=\"_parent\">' . __( 'Install Now' ) . '</a>';"
    ]
}
