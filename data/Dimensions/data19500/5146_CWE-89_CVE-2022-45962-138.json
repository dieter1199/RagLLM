{
    "cve_id": "CVE-2022-45962",
    "cve_description": "Open Solutions for Education, Inc openSIS Community Edition v8.0 and earlier is vulnerable to SQL Injection via CalendarModal.php.",
    "cve_publish_date": "2023-02-13",
    "cwe_id": "CWE-89",
    "cwe_name": "Improper Neutralization of Special Elements used in an SQL Command ('SQL Injection')",
    "cwe_description": "The product constructs all or part of an SQL command using externally-influenced input from an upstream component, but it does not neutralize or incorrectly neutralizes special elements that could modify the intended SQL command when it is sent to a downstream component. Without sufficient removal or quoting of SQL syntax in user-controllable inputs, the generated SQL query can cause those inputs to be interpreted as SQL instead of ordinary user data.",
    "commit_message": "Version 9.0 release\n\nOlder version shifted to branch: Version_8.0",
    "type_of_change": "ModificationType.ADD",
    "filename_of_changes": "Student.php",
    "code_language": "PHP",
    "number_of_lines_added_for_mitigation": "76",
    "number_of_lines_deleted_vulnerable_to_cve": "70",
    "vulnerable_lines": [
        "// Line_Reference 30: DrawBC(\"\"._extracurricular.\" > \" . ProgramTitle());",
        "// Line_Reference 47: if($_REQUEST['search_modfunc']!='list')",
        "// Line_Reference 48: {",
        "// Line_Reference 49: echo '<div id=\"modal_default\" class=\"modal fade\">",
        "// Line_Reference 54:     <h5 class=\"modal-title\">'._chooseCourse.'</h5>",
        "// Line_Reference 58: echo '<center><div id=\"conf_div\"></div></center>';",
        "// Line_Reference 59: echo'<table id=\"resp_table\"><tr><td valign=\"top\">';",
        "// Line_Reference 60: echo '<div>';",
        "// Line_Reference 61:    $sql = \"SELECT SUBJECT_ID,TITLE FROM course_subjects WHERE SCHOOL_ID='\".UserSchool().\"' AND SYEAR='\".UserSyear().\"' ORDER BY TITLE\";",
        "// Line_Reference 62: $QI = DBQuery($sql);",
        "// Line_Reference 63: $subjects_RET = DBGet($QI);",
        "// Line_Reference 65: echo count($subjects_RET). ((count($subjects_RET)==1)?' '._subjectWas.'':' '._subjectsWere.'').' '._found.'.<br>';",
        "// Line_Reference 66: if(count($subjects_RET)>0)",
        "// Line_Reference 67: {",
        "// Line_Reference 68: echo '<table class=\"table table-bordered\"><tr class=\"bg-grey-200\"><th>'._subject.'</th></tr>';",
        "// Line_Reference 69: foreach($subjects_RET as $val)",
        "// Line_Reference 70: {",
        "// Line_Reference 71: echo '<tr><td><a href=javascript:void(0); onclick=\"chooseCpModalSearch('.$val['SUBJECT_ID'].',\\'courses\\')\">'.$val['TITLE'].'</a></td></tr>';",
        "// Line_Reference 72: }",
        "// Line_Reference 73: echo '</table>';",
        "// Line_Reference 74: }",
        "// Line_Reference 75: echo '</div></td>';",
        "// Line_Reference 76: echo '<td valign=\"top\"><div id=\"course_modal\"></div></td>';",
        "// Line_Reference 77: echo '<td valign=\"top\"><div id=\"cp_modal\"></div></td>';",
        "// Line_Reference 78: echo '</tr></table>';",
        "// Line_Reference 79: //         echo '<div id=\"coursem\"><div id=\"cpem\"></div></div>';",
        "// Line_Reference 80: echo' </div>",
        "// Line_Reference 86:     if ($_REQUEST['student_id'])",
        "// Line_Reference 87:         $RET = DBGet(DBQuery('SELECT FIRST_NAME,LAST_NAME,MIDDLE_NAME,NAME_SUFFIX FROM students WHERE STUDENT_ID=\\'' . $_REQUEST['student_id'] . '\\''));",
        "// Line_Reference 88:     else",
        "// Line_Reference 92:         DrawHeaderHome('<div class=\"panel\"><div class=\"panel-heading\"><h6 class=\"panel-title\">'._selectedStudent.' : ' . $RET[1]['FIRST_NAME'] . '&nbsp;' . ($RET[1]['MIDDLE_NAME'] ? $RET[1]['MIDDLE_NAME'] . ' ' : '') . $RET[1]['LAST_NAME'] . '&nbsp;' . $RET[1]['NAME_SUFFIX'] . '</h6> <div class=\"heading-elements\"><span class=\"heading-text\"><A HREF=Modules.php?modname=' . clean_param($_REQUEST['modname'], PARAM_NOTAGS) . '&search_modfunc=list&next_modname=Students/Student.php&ajax=true&bottom_back=true&return_session=true target=body><i class=\"icon-square-left\"></i> '._backToStudentList.'</A></span><div class=\"btn-group heading-btn\"><A HREF=Side.php?student_id=new&modcat=' . clean_param($_REQUEST['modcat'], PARAM_NOTAGS) . ' class=\"btn btn-danger btn-xs\">'.deselect.'</A></div></div></div></div>');",
        "// Line_Reference 94:         DrawHeaderHome('<div class=\"panel\"><div class=\"panel-heading\"><h6 class=\"panel-title\">'._selectedStudent.' : ' . $RET[1]['FIRST_NAME'] . '&nbsp;' . ($RET[1]['MIDDLE_NAME'] ? $RET[1]['MIDDLE_NAME'] . ' ' : '') . $RET[1]['LAST_NAME'] . '&nbsp;' . $RET[1]['NAME_SUFFIX'] . '</h6> <div class=\"heading-elements\"><span class=\"heading-text\"></span><A HREF=Side.php?student_id=new&modcat=' . clean_param($_REQUEST['modcat'], PARAM_NOTAGS) . ' class=\"btn btn-danger btn-xs\">'._deselect.'</A></div></div></div>');",
        "// Line_Reference 99:     foreach ($stu_act_record as $rec_k => $rec_v)",
        "// Line_Reference 100:         foreach ($rec_v as $recr_k => $recr_v)",
        "// Line_Reference 101:             $ret[] = $recr_v;",
        "// Line_Reference 103:     if (in_array($_REQUEST['new_activity'], $ret)) {",
        "// Line_Reference 104:         echo'<p style=color:red>'._duplicateEntryOfActivityIsNotPermissible.'</p>';",
        "// Line_Reference 105:         unset($_REQUEST['modfunc']);",
        "// Line_Reference 107:         if($_REQUEST['new_activity'] != ''){",
        "// Line_Reference 152: //    $end = time();",
        "// Line_Reference 157:         if(isset($end))",
        "// Line_Reference 158:         {",
        "// Line_Reference 160:         }",
        "// Line_Reference 161:         else{",
        "// Line_Reference 175: //    $date_select = \"<OPTION value=$start>\" . date('M d, Y', $start) . ' - ' . date('M d, Y', $end) . '</OPTION>';",
        "// Line_Reference 178: ",
        "// Line_Reference 179:         for ($i = $start; $i <= $end_year; $i+=(60 * 60 * 24 * 7)) {",
        "// Line_Reference 189:     echo '<div class=\"input-group\"><SELECT name=start_date class=form-control>' . $date_select . '</SELECT><span class=\"input-group-btn\"><INPUT type=submit value='._go.' class=\"btn btn-primary\" onclick=\\'formload_ajax(\"elig_stud\");self_disable(this);\\' ></span></div>';",
        "// Line_Reference 194: ",
        "// Line_Reference 197: ",
        "// Line_Reference 202:         $end_date = date('Y-m-d', $dates[0]+(86400*6));",
        "// Line_Reference 205:             $qr.= ' AND ((\\'' . $st_date . '\\' BETWEEN ea.start_date AND ea.end_date) OR (\\'' . date('Y-m-d', $dates[1]) . '\\' BETWEEN ea.start_date AND ea.end_date))';",
        "// Line_Reference 207:             $qr.= ' AND ((\\'' . $st_date . '\\' <= ea.start_date AND ea.end_date) AND (\\'' . $end_date . '\\' >= ea.start_date AND ea.end_date))';",
        "// Line_Reference 208:             // $qr.= ' AND \\'' . $st_date . '\\' BETWEEN ea.start_date AND ea.end_date';",
        "// Line_Reference 209:     }",
        "// Line_Reference 210:     else {",
        "// Line_Reference 213:         $qr.= ' AND \\'' . $st_date . '\\' BETWEEN ea.start_date AND ea.end_date';",
        "// Line_Reference 215:     $qr.= '  AND em.SYEAR=ea.SYEAR AND em.ACTIVITY_ID=ea.ID ORDER BY ea.START_DATE';",
        "// Line_Reference 232:     echo \"<FORM action=Modules.php?modname=\" . strip_tags(trim($_REQUEST[modname])) . \"&modfunc=add&start_date=\" . strip_tags(trim($_REQUEST[start_date])) . \" method=POST>\";",
        "// Line_Reference 233:     $columns = array('TITLE' =>_activity,",
        "// Line_Reference 234:      'START_DATE' =>_starts,",
        "// Line_Reference 235:      'END_DATE' =>_ends,",
        "// Line_Reference 237:     ListOutput($RET, $columns,  _activity, _activities, $link);",
        "// Line_Reference 242:    $RET = DBGet(DBQuery('SELECT e.ELIGIBILITY_CODE,c.TITLE as COURSE_TITLE FROM eligibility e,courses c,course_periods cp WHERE e.STUDENT_ID=\\'' . UserStudentID() . '\\' AND e.SYEAR=\\'' . UserSyear() . '\\' AND e.COURSE_PERIOD_ID=cp.COURSE_PERIOD_ID AND cp.COURSE_ID=c.COURSE_ID AND e.SCHOOL_DATE BETWEEN \\'' . date('Y-m-d', strtotime($start_date)) . '\\' AND \\'' . date('Y-m-d', strtotime($end_date)) . '\\''), array('ELIGIBILITY_CODE' => '_makeLower'));",
        "// Line_Reference 243:     $columns = array('COURSE_TITLE' =>_course,",
        "// Line_Reference 244:      'ELIGIBILITY_CODE' =>_grade,",
        "// Line_Reference 251: ",
        "// Line_Reference 255: function _makeLower($word) {",
        "// Line_Reference 258: ",
        "// Line_Reference 259: ?>"
    ]
}
