{
    "cve_id": "CVE-2013-0178",
    "cve_description": "Insecure temporary file vulnerability in Redis before 2.6 related to /tmp/redis-%p.vm.",
    "cve_publish_date": "2019-11-01",
    "cwe_id": "CWE-20",
    "cwe_name": "Improper Input Validation",
    "cwe_description": "The product receives input or data, but it does\n        not validate or incorrectly validates that the input has the\n        properties that are required to process the data safely and\n        correctly.",
    "commit_message": "initial changes needed to turn the current VM code into a cache system. Tons of work to do still.",
    "type_of_change": "Modification",
    "filename_of_changes": "redis.c",
    "code_language": "C",
    "number_of_lines_added_for_mitigation": "24",
    "number_of_lines_deleted_vulnerable_to_cve": "63",
    "vulnerable_lines": [
        "// Line_Reference 621:     /* Swap a few keys on disk if we are over the memory limit and VM",
        "// Line_Reference 622:      * is enbled. Try to free objects from the free list first. */",
        "// Line_Reference 623:     if (vmCanSwapOut()) {",
        "// Line_Reference 624:         while (server.vm_enabled && zmalloc_used_memory() >",
        "// Line_Reference 625:                 server.vm_max_memory)",
        "// Line_Reference 626:         {",
        "// Line_Reference 627:             int retval = (server.vm_max_threads == 0) ?",
        "// Line_Reference 628:                         vmSwapOneObjectBlocking() :",
        "// Line_Reference 629:                         vmSwapOneObjectThreaded();",
        "// Line_Reference 630:             if (retval == REDIS_ERR && !(loops % 300) &&",
        "// Line_Reference 631:                 zmalloc_used_memory() >",
        "// Line_Reference 632:                 (server.vm_max_memory+server.vm_max_memory/10))",
        "// Line_Reference 633:             {",
        "// Line_Reference 634:                 redisLog(REDIS_WARNING,\"WARNING: vm-max-memory limit exceeded by more than 10%% but unable to swap more objects out!\");",
        "// Line_Reference 635:             }",
        "// Line_Reference 636:             /* Note that when using threade I/O we free just one object,",
        "// Line_Reference 637:              * because anyway when the I/O thread in charge to swap this",
        "// Line_Reference 638:              * object out will finish, the handler of completed jobs",
        "// Line_Reference 639:              * will try to swap more objects if we are still out of memory. */",
        "// Line_Reference 640:             if (retval == REDIS_ERR || server.vm_max_threads > 0) break;",
        "// Line_Reference 641:         }",
        "// Line_Reference 659:     /* Awake clients that got all the swapped keys they requested */",
        "// Line_Reference 660:     if (server.vm_enabled && listLength(server.io_ready_clients)) {",
        "// Line_Reference 671:             server.vm_blocked_clients--;",
        "// Line_Reference 790:     server.vm_enabled = 0;",
        "// Line_Reference 791:     server.vm_swap_file = zstrdup(\"/tmp/redis-%p.vm\");",
        "// Line_Reference 792:     server.vm_page_size = 256;          /* 256 bytes per page */",
        "// Line_Reference 793:     server.vm_pages = 1024*1024*100;    /* 104 millions of pages */",
        "// Line_Reference 794:     server.vm_max_memory = 1024LL*1024*1024*1; /* 1 GB of RAM */",
        "// Line_Reference 795:     server.vm_max_threads = 4;",
        "// Line_Reference 796:     server.vm_blocked_clients = 0;",
        "// Line_Reference 876:         if (server.vm_enabled)",
        "// Line_Reference 914:     if (server.vm_enabled) vmInit();",
        "// Line_Reference 1053:         if (server.vm_enabled && server.vm_max_threads > 0 &&",
        "// Line_Reference 1054:             blockClientOnSwappedKeys(c,cmd)) return REDIS_ERR;",
        "// Line_Reference 1075:         if (server.vm_enabled) unlink(server.vm_swap_file);",
        "// Line_Reference 1188:         \"vm_enabled:%d\\r\\n\"",
        "// Line_Reference 1231:         server.vm_enabled != 0,",
        "// Line_Reference 1258:     if (server.vm_enabled) {",
        "// Line_Reference 1261:             \"vm_conf_max_memory:%llu\\r\\n\"",
        "// Line_Reference 1262:             \"vm_conf_page_size:%llu\\r\\n\"",
        "// Line_Reference 1263:             \"vm_conf_pages:%llu\\r\\n\"",
        "// Line_Reference 1264:             \"vm_stats_used_pages:%llu\\r\\n\"",
        "// Line_Reference 1265:             \"vm_stats_swapped_objects:%llu\\r\\n\"",
        "// Line_Reference 1266:             \"vm_stats_swappin_count:%llu\\r\\n\"",
        "// Line_Reference 1267:             \"vm_stats_swappout_count:%llu\\r\\n\"",
        "// Line_Reference 1268:             \"vm_stats_io_newjobs_len:%lu\\r\\n\"",
        "// Line_Reference 1269:             \"vm_stats_io_processing_len:%lu\\r\\n\"",
        "// Line_Reference 1270:             \"vm_stats_io_processed_len:%lu\\r\\n\"",
        "// Line_Reference 1271:             \"vm_stats_io_active_threads:%lu\\r\\n\"",
        "// Line_Reference 1272:             \"vm_stats_blocked_clients:%lu\\r\\n\"",
        "// Line_Reference 1273:             ,(unsigned long long) server.vm_max_memory,",
        "// Line_Reference 1274:             (unsigned long long) server.vm_page_size,",
        "// Line_Reference 1275:             (unsigned long long) server.vm_pages,",
        "// Line_Reference 1276:             (unsigned long long) server.vm_stats_used_pages,",
        "// Line_Reference 1277:             (unsigned long long) server.vm_stats_swapped_objects,",
        "// Line_Reference 1278:             (unsigned long long) server.vm_stats_swapins,",
        "// Line_Reference 1279:             (unsigned long long) server.vm_stats_swapouts,",
        "// Line_Reference 1280:             (unsigned long) listLength(server.io_newjobs),",
        "// Line_Reference 1281:             (unsigned long) listLength(server.io_processing),",
        "// Line_Reference 1282:             (unsigned long) listLength(server.io_processed),",
        "// Line_Reference 1283:             (unsigned long) server.io_active_threads,",
        "// Line_Reference 1284:             (unsigned long) server.vm_blocked_clients"
    ]
}
