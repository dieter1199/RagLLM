{
    "cve_id": "CVE-2011-3346",
    "cve_description": "Buffer overflow in hw/scsi-disk.c in the SCSI subsystem in QEMU before 0.15.2, as used by Xen, might allow local guest users with permission to access the CD-ROM to cause a denial of service (guest crash) via a crafted SAI READ CAPACITY SCSI command.  NOTE: this is only a vulnerability when root has manually modified certain permissions or ACLs.",
    "cve_publish_date": "2014-04-01",
    "cwe_id": "CWE-119",
    "cwe_name": "Improper Restriction of Operations within the Bounds of a Memory Buffer",
    "cwe_description": "The product performs operations on a memory buffer, but it reads from or writes to a memory location outside the buffer's intended boundary. This may result in read or write operations on unexpected memory locations that could be linked to other variables, data structures, or internal program data.",
    "commit_message": "scsi-disk: lazily allocate bounce buffer\n\nIt will not be needed for reads and writes if the HBA provides a sglist.\nIn addition, this lets scsi-disk refuse commands with an excessive\nallocation length, as well as limit memory on usual well-behaved guests.\n\nSigned-off-by: Paolo Bonzini <pbonzini@redhat.com>\nSigned-off-by: Kevin Wolf <kwolf@redhat.com>",
    "type_of_change": "Modification",
    "filename_of_changes": "scsi-disk.c",
    "code_language": "C",
    "number_of_lines_added_for_mitigation": "33",
    "number_of_lines_deleted_vulnerable_to_cve": "11",
    "vulnerable_lines": [
        "// Line_Reference 81: static int scsi_disk_emulate_command(SCSIDiskReq *r, uint8_t *outbuf);",
        "// Line_Reference 87:     qemu_vfree(r->iov.iov_base);",
        "// Line_Reference 113:     r->iov.iov_len = MIN(r->sector_count * 512, SCSI_DMA_BUF_SIZE);",
        "// Line_Reference 326:                 ret = scsi_disk_emulate_command(r, r->iov.iov_base);",
        "// Line_Reference 841: static int scsi_disk_emulate_command(SCSIDiskReq *r, uint8_t *outbuf)",
        "// Line_Reference 998:     uint8_t *outbuf;",
        "// Line_Reference 1002:     outbuf = (uint8_t *)r->iov.iov_base;",
        "// Line_Reference 1031:         rc = scsi_disk_emulate_command(r, outbuf);",
        "// Line_Reference 1282:     SCSIDiskReq *r;",
        "// Line_Reference 1285:     r = DO_UPCAST(SCSIDiskReq, req, req);",
        "// Line_Reference 1286:     r->iov.iov_base = qemu_blockalign(s->bs, SCSI_DMA_BUF_SIZE);"
    ]
}
