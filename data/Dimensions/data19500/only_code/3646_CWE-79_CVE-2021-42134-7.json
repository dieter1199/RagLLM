from django.utils.html import conditional_escape
safe_fields = []
# Keep a list of fields that are safe to not sanitize from `frontend_context_variables`
if hasattr(self, "Meta") and hasattr(self.Meta, "safe"):
if isinstance(self.Meta.safe, Sequence):
for field_name in self.Meta.safe:
if field_name in frontend_context_variables:
safe_fields.append(field_name)
for (
frontend_context_variable_key,
frontend_context_variable_value,
) in frontend_context_variables.items():
if (
isinstance(frontend_context_variable_value, str)
and frontend_context_variable_key not in safe_fields
):
frontend_context_variables[frontend_context_variable_key] = escape(
frontend_context_variable_value
)
