{
    "cve_id": "CVE-2011-10004",
    "cve_description": "A vulnerability was found in reciply Plugin up to 1.1.7 on WordPress. It has been rated as critical. This issue affects some unknown processing of the file uploadImage.php. The manipulation leads to unrestricted upload. The attack may be initiated remotely. Upgrading to version 1.1.8 is able to address this issue. The identifier of the patch is e3ff616dc08d3aadff9253f1085e13f677d0c676. It is recommended to upgrade the affected component. The identifier VDB-242189 was assigned to this vulnerability.",
    "cve_publish_date": "2023-10-17",
    "cwe_id": "CWE-434",
    "cwe_name": "Unrestricted Upload of File with Dangerous Type",
    "cwe_description": "The product allows the upload or transfer of dangerous file types that are automatically processed within its environment.",
    "commit_message": "Fixed upload vulnerability\n\ngit-svn-id: https://plugins.svn.wordpress.org/reciply/trunk@428303 b8457f37-d9ea-0310-8a92-e5e31aec5664",
    "type_of_change": "Modification",
    "filename_of_changes": "uploadImage.php",
    "code_language": "PHP",
    "number_of_lines_added_for_mitigation": "52",
    "number_of_lines_deleted_vulnerable_to_cve": "35",
    "vulnerable_lines": [
        "// Line_Reference 3: // File version 1.1.7",
        "// Line_Reference 4: $ref = $_SERVER['HTTP_REFERER'];",
        "// Line_Reference 5: ",
        "// Line_Reference 6: // Taille maximum",
        "// Line_Reference 7: $MAX_FILE_SIZE = 400000;",
        "// Line_Reference 8: ",
        "// Line_Reference 9: // Dossier de destination du fichier",
        "// Line_Reference 10: $serverpath = \"images/\";// Path to where images should be uploaded to on the server.",
        "// Line_Reference 11: ",
        "// Line_Reference 12: foreach ($_FILES as $file) {",
        "// Line_Reference 13: $allowed_types = array(\"image/bmp\", \"image/gif\", \"image/pjpeg\", \"image/jpeg\", \"image/jpg\", \"image/png\");",
        "// Line_Reference 14: $fname = $file['name'];",
        "// Line_Reference 15: $ftype = $file['type'];",
        "// Line_Reference 16: $fsize = $file['size'];",
        "// Line_Reference 17: $ftmp =$file['tmp_name'];",
        "// Line_Reference 18: $path = \"$serverpath$fname\";",
        "// Line_Reference 20: ",
        "// Line_Reference 21: // Diverses test afin de savoir si :",
        "// Line_Reference 22: // Le format de fichier correspond  notre tableau array",
        "// Line_Reference 23: if(!in_array($ftype, $allowed_types)){$error = 1;}",
        "// Line_Reference 24: ",
        "// Line_Reference 25: // La taille du fichier n'est pas dpasse",
        "// Line_Reference 26: if($fize > $MAX_FILE_SIZE){$error = 2;}",
        "// Line_Reference 27: ",
        "// Line_Reference 28: // Le fichier n'existe pas dj",
        "// Line_Reference 29: if(file_exists($serverpath.\"m_\".$fname)){$error = 3;}",
        "// Line_Reference 30: ",
        "// Line_Reference 31: // Si tout va bien, c'est bien droul",
        "// Line_Reference 32: if(move_uploaded_file($ftmp,''.$serverpath.''.$fname.'')) {$error = 0;}",
        "// Line_Reference 33: ",
        "// Line_Reference 34: if($fname!=\"\") {",
        "// Line_Reference 35: \t\t\t\theader('refresh: 0; url='.$ref.'&img='.$path.'&f='.$fname.'&target=\"_blank\"');",
        "// Line_Reference 36: \t\t\t\t}",
        "// Line_Reference 37: else {",
        "// Line_Reference 38: \t\theader('refresh: 0; url='.$ref);"
    ]
}
