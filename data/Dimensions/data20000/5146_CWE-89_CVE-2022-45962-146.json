{
    "cve_id": "CVE-2022-45962",
    "cve_description": "Open Solutions for Education, Inc openSIS Community Edition v8.0 and earlier is vulnerable to SQL Injection via CalendarModal.php.",
    "cve_publish_date": "2023-02-13",
    "cwe_id": "CWE-89",
    "cwe_name": "Improper Neutralization of Special Elements used in an SQL Command ('SQL Injection')",
    "cwe_description": "The product constructs all or part of an SQL command using externally-influenced input from an upstream component, but it does not neutralize or incorrectly neutralizes special elements that could modify the intended SQL command when it is sent to a downstream component. Without sufficient removal or quoting of SQL syntax in user-controllable inputs, the generated SQL query can cause those inputs to be interpreted as SQL instead of ordinary user data.",
    "commit_message": "Version 9.0 release\n\nOlder version shifted to branch: Version_8.0",
    "type_of_change": "ModificationType.ADD",
    "filename_of_changes": "SystemPreference.php",
    "code_language": "PHP",
    "number_of_lines_added_for_mitigation": "53",
    "number_of_lines_deleted_vulnerable_to_cve": "56",
    "vulnerable_lines": [
        "// Line_Reference 36: DrawBC(\"\"._schoolSetup.\" > \" . ProgramTitle());",
        "// Line_Reference 38: if(!isset($_REQUEST['page_display'])){",
        "// Line_Reference 46: echo '<div class=\"panel-heading\"><h5 class=\"panel-title\">'._systemPreferences.'</h5></div>';",
        "// Line_Reference 49: echo '<li ' . ((clean_param($_REQUEST['page_display'], PARAM_ALPHAMOD) == 'SystemPreference') ? 'class=\"active\"' : '') . '><a href=\"Modules.php?modname=' . strip_tags(trim($_REQUEST[modname])) . '&page_display=SystemPreference\"><i class=\"icon-watch2\"></i> &nbsp;'._setHalfDayAndFullDayMinutes.'</a></li>';",
        "// Line_Reference 50: echo '<li ' . ((clean_param($_REQUEST['page_display'], PARAM_ALPHAMOD) == 'FAILURE') ? 'class=\"active\"' : '') . '><a href=\"Modules.php?modname=' . strip_tags(trim($_REQUEST[modname])) . '&page_display=FAILURE\"><i class=\"icon-key\"></i> &nbsp;'._setLoginFailureAllowanceCount.'</a></li>';",
        "// Line_Reference 51: echo '<li ' . ((clean_param($_REQUEST['page_display'], PARAM_ALPHAMOD) == 'INACTIVITY') ? 'class=\"active\"' : '') . '><a href=\"Modules.php?modname=' . strip_tags(trim($_REQUEST[modname])) . '&page_display=INACTIVITY\"><i class=\"icon-calendar22\"></i> &nbsp;'._setAllowableUserInactivityDays.'</a></li>';",
        "// Line_Reference 52: echo '<li ' . ((clean_param($_REQUEST['page_display'], PARAM_ALPHAMOD) == 'MAINTENANCE') ? 'class=\"active\"' : '') . '><a href=\"Modules.php?modname=' . strip_tags(trim($_REQUEST[modname])) . '&page_display=MAINTENANCE\"><i class=\"icon-hammer-wrench\"></i> &nbsp;'._putSystemInMaintenanceMode.'</a></li>';",
        "// Line_Reference 53: echo '<li ' . ((clean_param($_REQUEST['page_display'], PARAM_ALPHAMOD) == 'CURRENCY') ? 'class=\"active\"' : '') . '><a href=\"Modules.php?modname=' . strip_tags(trim($_REQUEST[modname])) . '&page_display=CURRENCY\"><i class=\"icon-coins\"></i> &nbsp;'._setCurrency.'</a></li>';",
        "// Line_Reference 54: echo '<li ' . ((clean_param($_REQUEST['page_display'], PARAM_ALPHAMOD) == 'CLASSRANK') ? 'class=\"active\"' : '') . '><a href=\"Modules.php?modname=' . strip_tags(trim($_REQUEST[modname])) . '&page_display=CLASSRANK\"><i class=\"icon-podium\"></i> &nbsp;'._displayClassRank.'</a></li>';",
        "// Line_Reference 55: echo '<li ' . ((clean_param($_REQUEST['page_display'], PARAM_ALPHAMOD) == 'UPDATENOTIFY') ? 'class=\"active\"' : '') . '><a href=\"Modules.php?modname=' . strip_tags(trim($_REQUEST[modname])) . '&page_display=UPDATENOTIFY\"><i class=\"icon-bell3\"></i> &nbsp;'._displayNotifications.'</a></li>';",
        "// Line_Reference 70:                 $value = _NULL;",
        "// Line_Reference 72:                 $value = _NULL;",
        "// Line_Reference 77:     }",
        "// Line_Reference 78:     elseif ((clean_param($_REQUEST['action'], PARAM_ALPHAMOD) == 'insert') && (clean_param($_REQUEST['button'], PARAM_ALPHAMOD) == 'Save') && clean_param($_REQUEST['values'], PARAM_NOTAGS) && $_POST['values'] && User('PROFILE') == 'admin') {",
        "// Line_Reference 94:         echo \"<FORM name=sys_pref id=sys_pref class=\\\"form-horizontal\\\" action=Modules.php?modname=\" . strip_tags(trim($_REQUEST[modname])) . \"&action=insert&page_display=SystemPreference method=POST>\";",
        "// Line_Reference 97:         echo \"<FORM name=sys_pref id=sys_pref class=\\\"form-horizontal\\\" action=Modules.php?modname=\" . strip_tags(trim($_REQUEST[modname])) . \"&action=update&page_display=SystemPreference method=POST>\";",
        "// Line_Reference 100:     echo '<div class=\"form-group\"><div class=\"col-md-12\"><label class=\"control-label text-right text-uppercase\"><b>'._fullDayMinutes.'</b></label>' . TextInput($sys_pref['FULL_DAY_MINUTE'], 'values[FULL_DAY_MINUTE]', '', 'class=form-control') . '</div></div>';",
        "// Line_Reference 101:     echo '<div class=\"form-group\"><div class=\"col-md-12\"><label class=\"control-label text-right text-uppercase\"><b>'._halfDayMinutes.'</b></label>' . TextInput($sys_pref['HALF_DAY_MINUTE'], 'values[HALF_DAY_MINUTE]', '', 'class=form-control') . '</div></div>';",
        "// Line_Reference 102: //    if ($_REQUEST['page_display']) {",
        "// Line_Reference 103: //        echo \"<a href=Modules.php?modname=\" . strip_tags(trim($_REQUEST[modname])) . \" class=\\\"btn btn-default\\\"><i class=\\\"fa fa-arrow-left\\\"></i>&nbsp; Back to System Preference</a>\";",
        "// Line_Reference 104: //    }",
        "// Line_Reference 105:     echo \"<INPUT TYPE=SUBMIT name=button id=button class=\\\"btn btn-primary pull-right\\\" onclick='return formcheck_halfday_fullday(this);'  VALUE=\"._save.\">\";",
        "// Line_Reference 108: ",
        "// Line_Reference 109: } if (clean_param($_REQUEST['page_display'], PARAM_ALPHAMOD) == 'MAINTENANCE') {",
        "// Line_Reference 138:             }",
        "// Line_Reference 139:             else {",
        "// Line_Reference 172:             }",
        "// Line_Reference 173:             else {",
        "// Line_Reference 204:         echo \"<FORM name=maintenance class=no-margin id=maintenance action=Modules.php?modname=\" . strip_tags(trim($_REQUEST[modname])) . \"&modfunc=update&page_display=MAINTENANCE method=POST>\";",
        "// Line_Reference 211:         //echo '<div class=\"panel-heading\">' . CheckboxInputSwitch($maintain['SYSTEM_MAINTENANCE_SWITCH'], 'maintain[SYSTEM_MAINTENANCE_SWITCH]', 'Maintenance Mode') . '</div><hr class=\"no-margin\"/>';",
        "// Line_Reference 218:         $columns = array('MESSAGE' =>_loginMessage, 'DISPLAY' =>_display);",
        "// Line_Reference 219:         ListOutput($login_MESSAGE, $columns,  _message, _messages, $link, true, array('search' =>false));",
        "// Line_Reference 222: //        if ($_REQUEST['page_display']) {",
        "// Line_Reference 223: //            echo \"<a href=Modules.php?modname=\" . strip_tags(trim($_REQUEST[modname])) . \" class=\\\"btn btn-default\\\"><i class=\\\"fa fa-arrow-left\\\"></i>&nbsp; Back to System Preference</a>\";",
        "// Line_Reference 224: //        }",
        "// Line_Reference 230: }if (clean_param($_REQUEST['page_display'], PARAM_ALPHAMOD) == 'INACTIVITY') {",
        "// Line_Reference 235: } if (clean_param($_REQUEST['page_display'], PARAM_ALPHAMOD) == 'FAILURE') {",
        "// Line_Reference 240: } if (clean_param($_REQUEST['page_display'], PARAM_ALPHAMOD) == 'CURRENCY') {",
        "// Line_Reference 245: }if (clean_param($_REQUEST['page_display'], PARAM_ALPHAMOD) == 'CLASSRANK') {",
        "// Line_Reference 264:     echo \"<FORM name=failure class=no-margin id=failure action=Modules.php?modname=\" . strip_tags(trim($_REQUEST[modname])) . \"&modfunc=update&page_display=CLASSRANK method=POST>\";",
        "// Line_Reference 267:     echo '<div class=\"form-group\">' . CheckboxInputSwitch($rank['VALUE'], 'display_rank', _displayClassRank.'?', '', false, 'Yes', 'No', '', 'switch-success') . '</div>';",
        "// Line_Reference 271: //    if ($_REQUEST['page_display']) {",
        "// Line_Reference 272: //        echo \"<a href=Modules.php?modname=\" . strip_tags(trim($_REQUEST[modname])) . \" class=\\\"btn btn-default\\\"><i class=\\\"fa fa-arrow-left\\\"></i>&nbsp; Back to System Preference</a>\";",
        "// Line_Reference 273: //    }",
        "// Line_Reference 279: }if (clean_param($_REQUEST['page_display'], PARAM_ALPHAMOD) == 'UPDATENOTIFY') {",
        "// Line_Reference 310:     echo \"<FORM name=failure id=failure action=Modules.php?modname=\" . strip_tags(trim($_REQUEST[modname])) . \"&modfunc=update&page_display=UPDATENOTIFY method=POST>\";",
        "// Line_Reference 313:     echo '<div class=\"form-group\">' . CheckboxInputSwitch($notify_RET['VALUE'], 'display_notify', _notifyWhenLatestVersionIsAvailable.'?', '', false, 'Yes', 'No', '', 'switch-success') . '</div>';",
        "// Line_Reference 317:     echo '<div class=\"form-group\">' . CheckboxInputSwitch($notify_RET_school['VALUE'], 'display_school_notify', _notifyWhenSchoolSetupIsIncomplete.'?', '', false, 'Yes', 'No', '', 'switch-success') . '</div>';",
        "// Line_Reference 321: //    if ($_REQUEST['page_display']) {",
        "// Line_Reference 322: //        echo \"<a href=Modules.php?modname=\" . strip_tags(trim($_REQUEST[modname])) . \" class=\\\"btn btn-default\\\"><i class=\\\"fa fa-arrow-left\\\"></i>&nbsp; Back to System Preference</a>\";",
        "// Line_Reference 323: //    }",
        "// Line_Reference 334: function _makeContentInput($value, $name) {",
        "// Line_Reference 345: function makeTextInput($value, $name) {",
        "// Line_Reference 363: function _makeRadio($value, $name) {",
        "// Line_Reference 375: ",
        "// Line_Reference 376: ?>"
    ]
}
