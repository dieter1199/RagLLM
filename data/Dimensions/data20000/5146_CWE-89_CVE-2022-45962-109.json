{
    "cve_id": "CVE-2022-45962",
    "cve_description": "Open Solutions for Education, Inc openSIS Community Edition v8.0 and earlier is vulnerable to SQL Injection via CalendarModal.php.",
    "cve_publish_date": "2023-02-13",
    "cwe_id": "CWE-89",
    "cwe_name": "Improper Neutralization of Special Elements used in an SQL Command ('SQL Injection')",
    "cwe_description": "The product constructs all or part of an SQL command using externally-influenced input from an upstream component, but it does not neutralize or incorrectly neutralizes special elements that could modify the intended SQL command when it is sent to a downstream component. Without sufficient removal or quoting of SQL syntax in user-controllable inputs, the generated SQL query can cause those inputs to be interpreted as SQL instead of ordinary user data.",
    "commit_message": "Version 9.0 release\n\nOlder version shifted to branch: Version_8.0",
    "type_of_change": "ModificationType.ADD",
    "filename_of_changes": "ProgressReports.php",
    "code_language": "PHP",
    "number_of_lines_added_for_mitigation": "38",
    "number_of_lines_deleted_vulnerable_to_cve": "22",
    "vulnerable_lines": [
        "// Line_Reference 45:     if (count($config_RET))",
        "// Line_Reference 53:     if (count($_REQUEST['st_arr'])) {",
        "// Line_Reference 61:         if (count($RET)) {",
        "// Line_Reference 113:                         $assignment_type_weight = DBGet(DBQuery('SELECT SUM(FINAL_GRADE_PERCENT) AS FINAL_GRADE_PERCENT FROM gradebook_assignment_types WHERE assignment_type_id IN ('.$assignment_type_ids[1]['ASSIGNMENT_TYPE_IDS'].')'));",
        "// Line_Reference 123:                         $assignment_type_weight = DBGet(DBQuery('SELECT SUM(FINAL_GRADE_PERCENT) AS FINAL_GRADE_PERCENT FROM gradebook_assignment_types WHERE assignment_type_id IN ('.$assignment_type_ids[1]['ASSIGNMENT_TYPE_IDS'].')'));",
        "// Line_Reference 134:                         $sql = 'SELECT a.TITLE,t.TITLE AS ASSIGN_TYP,a.ASSIGNED_DATE,a.DUE_DATE,\\'-1\\' AS ASSIGNMENT_TYPE_ID,\\'1\\' AS FINAL_GRADE_PERCENT,\\'N/A\\' as WEIGHT_GRADE,\\'N/A\\' as ASSIGN_TYP_WG,g.POINTS,a.POINTS AS TOTAL_POINTS,g.COMMENT,g.POINTS AS LETTER_GRADE,g.POINTS AS LETTERWTD_GRADE,CASE WHEN (a.ASSIGNED_DATE IS NULL OR CURRENT_DATE>=a.ASSIGNED_DATE) AND (a.DUE_DATE IS NULL OR CURRENT_DATE>=a.DUE_DATE) THEN \\'Y\\' ELSE NULL END AS DUE FROM gradebook_assignment_types t,gradebook_assignments a LEFT OUTER JOIN gradebook_grades g ON (a.ASSIGNMENT_ID=g.ASSIGNMENT_ID AND g.STUDENT_ID=\\'' . $student[STUDENT_ID] . '\\' AND g.COURSE_PERIOD_ID=\\'' . UserCoursePeriod() . '\\') WHERE  a.ASSIGNMENT_TYPE_ID=t.ASSIGNMENT_TYPE_ID AND (a.COURSE_PERIOD_ID=\\'' . UserCoursePeriod() . '\\' OR a.COURSE_ID=\\'' . $course_id . '\\' AND a.STAFF_ID=\\'' . User('STAFF_ID') . '\\')  AND t.COURSE_ID=\\'' . $course_id . '\\' AND (a.MARKING_PERIOD_ID=\\'' . UserMP() . '\\' OR a.MARKING_PERIOD_ID=\\'' . $fy_mp_id . '\\')';",
        "// Line_Reference 136:                         $sql = 'SELECT a.TITLE,t.TITLE AS ASSIGN_TYP,a.ASSIGNED_DATE,a.DUE_DATE,\\'-1\\' AS ASSIGNMENT_TYPE_ID,\\'1\\' AS FINAL_GRADE_PERCENT,\\'N/A\\' as WEIGHT_GRADE,\\'N/A\\' as ASSIGN_TYP_WG,g.POINTS,a.POINTS AS TOTAL_POINTS,g.COMMENT,g.POINTS AS LETTER_GRADE,g.POINTS AS LETTERWTD_GRADE,CASE WHEN (a.ASSIGNED_DATE IS NULL OR CURRENT_DATE>=a.ASSIGNED_DATE) AND (a.DUE_DATE IS NULL OR CURRENT_DATE>=a.DUE_DATE) THEN \\'Y\\' ELSE NULL END AS DUE FROM gradebook_assignment_types t,gradebook_assignments a LEFT OUTER JOIN gradebook_grades g ON (a.ASSIGNMENT_ID=g.ASSIGNMENT_ID AND g.STUDENT_ID=\\'' . $student[STUDENT_ID] . '\\' AND g.COURSE_PERIOD_ID=\\'' . UserCoursePeriod() . '\\') WHERE  a.ASSIGNMENT_TYPE_ID=t.ASSIGNMENT_TYPE_ID AND (a.COURSE_PERIOD_ID=\\'' . UserCoursePeriod() . '\\' OR a.COURSE_ID=\\'' . $course_id . '\\' AND a.STAFF_ID=\\'' . User('STAFF_ID') . '\\')  AND t.COURSE_ID=\\'' . $course_id . '\\' AND a.MARKING_PERIOD_ID=\\'' . UserMP() . '\\'';",
        "// Line_Reference 143:                 $sql .= ' AND a.DUE_DATE>=\\'' . $student[START_DATE] . '\\' ORDER BY a.ASSIGNMENT_TYPE_ID';",
        "// Line_Reference 147:                 if (count($percent_weights)) {",
        "// Line_Reference 163:                     $tot_weight_grade = '';",
        "// Line_Reference 166:                     if (count($grades_RET)) {",
        "// Line_Reference 185:                             if ($tot_weight_grade == '')",
        "// Line_Reference 194:                 $tot_weight_grade = ($tot_weight_grade / $total_weightage) * 100;",
        "// Line_Reference 222:         echo \"<FORM class=\\\"form-inline\\\" action=ForExport.php?modname=\" . strip_tags(trim($_REQUEST[modname])) . \"&modfunc=save&include_inactive=\" . strip_tags(trim($_REQUEST[include_inactive])) . \"&_openSIS_PDF=true&head_html=Student+Progress+Report method=POST target=_blank>\";",
        "// Line_Reference 241:     $extra['columns_before'] = array('CHECKBOX' => '</A><INPUT type=checkbox value=Y name=controller onclick=\"checkAll(this.form,this.form.controller.checked,\\'st_arr\\');\"><A>');",
        "// Line_Reference 242:   // $extra['columns_before'] = array('CHECKBOX' => '</A><INPUT type=checkbox value=Y name=controller onclick=\"checkAllDtMod(this,\\'st_arr\\');\"><A>');",
        "// Line_Reference 265:                 return '<TABLE border=0 cellspacing=0 cellpadding=0 class=LO_field><TR><TD><font size=-1>' . (rtrim(rtrim($value, '0'), '.') + 0) . '</font></TD><TD><font size=-1>&nbsp;/&nbsp;</font></TD><TD><font size=-1>' . $THIS_RET['TOTAL_POINTS'] . '</font></TD></TR></TABLE>';",
        "// Line_Reference 270:             return '<TABLE border=0 cellspacing=0 cellpadding=0 class=LO_field><TR><TD><font size=-1>' . (rtrim(rtrim($value, '0'), '.') + 0) . '</font></TD><TD><font size=-1>&nbsp;/&nbsp;</font></TD><TD><font size=-1>' . $THIS_RET['TOTAL_POINTS'] . '</font></TD></TR></TABLE>';",
        "// Line_Reference 300:     return '<INPUT type=checkbox name=st_arr[] value=' . $value . '>';",
        "// Line_Reference 302:    // global $THIS_RET;",
        "// Line_Reference 303:   //  return \"<input name=unused_var[$THIS_RET[STUDENT_ID]] value=\" . $THIS_RET[STUDENT_ID] . \"  type='checkbox' id=$THIS_RET[STUDENT_ID] onClick='setHiddenCheckboxStudents(\\\"st_arr[$THIS_RET[STUDENT_ID]]\\\",this,$THIS_RET[STUDENT_ID]);' />\";",
        "// Line_Reference 317: ?>"
    ]
}
