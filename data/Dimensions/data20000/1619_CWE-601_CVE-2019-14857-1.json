{
    "cve_id": "CVE-2019-14857",
    "cve_description": "A flaw was found in mod_auth_openidc before version 2.4.0.1. An open redirect issue exists in URLs with trailing slashes similar to CVE-2019-3877 in mod_auth_mellon.",
    "cve_publish_date": "2019-11-26",
    "cwe_id": "CWE-601",
    "cwe_name": "URL Redirection to Untrusted Site ('Open Redirect')",
    "cwe_description": "A web application accepts a user-controlled input that specifies a link to an external site, and uses that link in a Redirect. This simplifies phishing attacks.",
    "commit_message": "improve validation of the post-logout URL; closes #449\n\n- to avoid an open redirect; thanks AIMOTO Norihito\n- release 2.4.0.1\n\nSigned-off-by: Hans Zandbelt <hans.zandbelt@zmartzone.eu>",
    "type_of_change": "Modification",
    "filename_of_changes": "mod_auth_openidc.c",
    "code_language": "C",
    "number_of_lines_added_for_mitigation": "55",
    "number_of_lines_deleted_vulnerable_to_cve": "38",
    "vulnerable_lines": [
        "// Line_Reference 3053: ",
        "// Line_Reference 3054: \t\tconst char *error_description = NULL;",
        "// Line_Reference 3055: \t\tapr_uri_t uri;",
        "// Line_Reference 3056: ",
        "// Line_Reference 3057: \t\tif (apr_uri_parse(r->pool, url, &uri) != APR_SUCCESS) {",
        "// Line_Reference 3058: \t\t\tconst char *error_description = apr_psprintf(r->pool,",
        "// Line_Reference 3059: \t\t\t\t\t\"Logout URL malformed: %s\", url);",
        "// Line_Reference 3060: \t\t\toidc_error(r, \"%s\", error_description);",
        "// Line_Reference 3061: \t\t\treturn oidc_util_html_send_error(r, c->error_template,",
        "// Line_Reference 3062: \t\t\t\t\t\"Malformed URL\", error_description,",
        "// Line_Reference 3063: \t\t\t\t\tHTTP_INTERNAL_SERVER_ERROR);",
        "// Line_Reference 3064: ",
        "// Line_Reference 3065: \t\t}",
        "// Line_Reference 3066: ",
        "// Line_Reference 3067: \t\tconst char *c_host = oidc_get_current_url_host(r);",
        "// Line_Reference 3068: \t\tif ((uri.hostname != NULL)",
        "// Line_Reference 3069: \t\t\t\t&& ((strstr(c_host, uri.hostname) == NULL)",
        "// Line_Reference 3070: \t\t\t\t\t\t|| (strstr(uri.hostname, c_host) == NULL))) {",
        "// Line_Reference 3071: \t\t\terror_description =",
        "// Line_Reference 3072: \t\t\t\t\tapr_psprintf(r->pool,",
        "// Line_Reference 3073: \t\t\t\t\t\t\t\"logout value \\\"%s\\\" does not match the hostname of the current request \\\"%s\\\"\",",
        "// Line_Reference 3074: \t\t\t\t\t\t\tapr_uri_unparse(r->pool, &uri, 0), c_host);",
        "// Line_Reference 3075: \t\t\toidc_error(r, \"%s\", error_description);",
        "// Line_Reference 3076: \t\t\treturn oidc_util_html_send_error(r, c->error_template,",
        "// Line_Reference 3077: \t\t\t\t\t\"Invalid Request\", error_description,",
        "// Line_Reference 3078: \t\t\t\t\tHTTP_INTERNAL_SERVER_ERROR);",
        "// Line_Reference 3079: \t\t}",
        "// Line_Reference 3080: ",
        "// Line_Reference 3081: \t\t/* validate the URL to prevent HTTP header splitting */",
        "// Line_Reference 3082: \t\tif (((strstr(url, \"\\n\") != NULL) || strstr(url, \"\\r\") != NULL)) {",
        "// Line_Reference 3083: \t\t\terror_description =",
        "// Line_Reference 3084: \t\t\t\t\tapr_psprintf(r->pool,",
        "// Line_Reference 3085: \t\t\t\t\t\t\t\"logout value \\\"%s\\\" contains illegal \\\"\\n\\\" or \\\"\\r\\\" character(s)\",",
        "// Line_Reference 3086: \t\t\t\t\t\t\turl);",
        "// Line_Reference 3087: \t\t\toidc_error(r, \"%s\", error_description);",
        "// Line_Reference 3088: \t\t\treturn oidc_util_html_send_error(r, c->error_template,",
        "// Line_Reference 3089: \t\t\t\t\t\"Invalid Request\", error_description,",
        "// Line_Reference 3090: \t\t\t\t\tHTTP_INTERNAL_SERVER_ERROR);"
    ]
}
