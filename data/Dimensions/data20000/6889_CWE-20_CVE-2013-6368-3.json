{
    "cve_id": "CVE-2013-6368",
    "cve_description": "The KVM subsystem in the Linux kernel through 3.12.5 allows local users to gain privileges or cause a denial of service (system crash) via a VAPIC synchronization operation involving a page-end address.",
    "cve_publish_date": "2013-12-14",
    "cwe_id": "CWE-20",
    "cwe_name": "Improper Input Validation",
    "cwe_description": "The product receives input or data, but it does\n        not validate or incorrectly validates that the input has the\n        properties that are required to process the data safely and\n        correctly.",
    "commit_message": "KVM: x86: Convert vapic synchronization to _cached functions (CVE-2013-6368)\n\nIn kvm_lapic_sync_from_vapic and kvm_lapic_sync_to_vapic there is the\npotential to corrupt kernel memory if userspace provides an address that\nis at the end of a page.  This patches concerts those functions to use\nkvm_write_guest_cached and kvm_read_guest_cached.  It also checks the\nvapic_address specified by userspace during ioctl processing and returns\nan error to userspace if the address is not a valid GPA.\n\nThis is generally not guest triggerable, because the required write is\ndone by firmware that runs before the guest.  Also, it only affects AMD\nprocessors and oldish Intel that do not have the FlexPriority feature\n(unless you disable FlexPriority, of course; then newer processors are\nalso affected).\n\nFixes: b93463aa59d6 ('KVM: Accelerated apic support')\n\nReported-by: Andrew Honig <ahonig@google.com>\nCc: stable@vger.kernel.org\nSigned-off-by: Andrew Honig <ahonig@google.com>\nSigned-off-by: Paolo Bonzini <pbonzini@redhat.com>",
    "type_of_change": "Modification",
    "filename_of_changes": "x86.c",
    "code_language": "C",
    "number_of_lines_added_for_mitigation": "1",
    "number_of_lines_deleted_vulnerable_to_cve": "39",
    "vulnerable_lines": [
        "// Line_Reference 3217: \t\tr = 0;",
        "// Line_Reference 3218: \t\tkvm_lapic_set_vapic_addr(vcpu, va.vapic_addr);",
        "// Line_Reference 5742: static int vapic_enter(struct kvm_vcpu *vcpu)",
        "// Line_Reference 5743: {",
        "// Line_Reference 5744: \tstruct kvm_lapic *apic = vcpu->arch.apic;",
        "// Line_Reference 5745: \tstruct page *page;",
        "// Line_Reference 5746: ",
        "// Line_Reference 5747: \tif (!apic || !apic->vapic_addr)",
        "// Line_Reference 5748: \t\treturn 0;",
        "// Line_Reference 5749: ",
        "// Line_Reference 5750: \tpage = gfn_to_page(vcpu->kvm, apic->vapic_addr >> PAGE_SHIFT);",
        "// Line_Reference 5751: \tif (is_error_page(page))",
        "// Line_Reference 5752: \t\treturn -EFAULT;",
        "// Line_Reference 5753: ",
        "// Line_Reference 5754: \tvcpu->arch.apic->vapic_page = page;",
        "// Line_Reference 5755: \treturn 0;",
        "// Line_Reference 5756: }",
        "// Line_Reference 5757: ",
        "// Line_Reference 5758: static void vapic_exit(struct kvm_vcpu *vcpu)",
        "// Line_Reference 5759: {",
        "// Line_Reference 5760: \tstruct kvm_lapic *apic = vcpu->arch.apic;",
        "// Line_Reference 5761: \tint idx;",
        "// Line_Reference 5762: ",
        "// Line_Reference 5763: \tif (!apic || !apic->vapic_addr)",
        "// Line_Reference 5764: \t\treturn;",
        "// Line_Reference 5765: ",
        "// Line_Reference 5766: \tidx = srcu_read_lock(&vcpu->kvm->srcu);",
        "// Line_Reference 5767: \tkvm_release_page_dirty(apic->vapic_page);",
        "// Line_Reference 5768: \tmark_page_dirty(vcpu->kvm, apic->vapic_addr >> PAGE_SHIFT);",
        "// Line_Reference 5769: \tsrcu_read_unlock(&vcpu->kvm->srcu, idx);",
        "// Line_Reference 5770: }",
        "// Line_Reference 5771: ",
        "// Line_Reference 6072: \tr = vapic_enter(vcpu);",
        "// Line_Reference 6073: \tif (r) {",
        "// Line_Reference 6074: \t\tsrcu_read_unlock(&kvm->srcu, vcpu->srcu_idx);",
        "// Line_Reference 6075: \t\treturn r;",
        "// Line_Reference 6076: \t}",
        "// Line_Reference 6135: \tvapic_exit(vcpu);",
        "// Line_Reference 6136: "
    ]
}
