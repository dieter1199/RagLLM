{
    "cve_id": "CVE-2024-5685",
    "cve_description": "Users with \"User:edit\" and \"Self:api\" permissionsÂ can promote or demote themselves or other users by performing changes to the group's memberships via API call.This issue affects snipe-it: from v4.6.17 through v6.4.1.",
    "cve_publish_date": "2024-06-14",
    "cwe_id": "NVD-CWE-noinfo",
    "cwe_name": "Insufficient Information",
    "cwe_description": "There is insufficient information about the issue to classify it; details are unkown or unspecified.",
    "commit_message": "Re-order gating and refactor group syncing\n\nSigned-off-by: snipe <snipe@snipe.net>",
    "type_of_change": "Modification",
    "filename_of_changes": "UsersController.php",
    "code_language": "PHP",
    "number_of_lines_added_for_mitigation": "7",
    "number_of_lines_deleted_vulnerable_to_cve": "19",
    "vulnerable_lines": [
        "// Line_Reference 478:             // Strip out the superuser permission if the API user isn't a superadmin",
        "// Line_Reference 496:             // Check if the request has groups passed and has a value",
        "// Line_Reference 497:             if ($request->filled('groups')) {",
        "// Line_Reference 502: ",
        "// Line_Reference 503:                 if ($validator->fails()){",
        "// Line_Reference 504:                     return response()->json(Helper::formatStandardApiResponse('error', null, $user->getErrors()));",
        "// Line_Reference 505:                 }",
        "// Line_Reference 507:                 // Only save groups if the user is a superuser",
        "// Line_Reference 508:                 if (Auth::user()->isSuperUser()) {",
        "// Line_Reference 509:                     $user->groups()->sync($request->input('groups'));",
        "// Line_Reference 510:                 }",
        "// Line_Reference 512:             // The groups field has been passed but it is null, so we should blank it out",
        "// Line_Reference 513:             } elseif ($request->has('groups')) {",
        "// Line_Reference 514: ",
        "// Line_Reference 515:                 // Only save groups if the user is a superuser",
        "// Line_Reference 516:                 if (Auth::user()->isSuperUser()) {",
        "// Line_Reference 517:                     $user->groups()->sync($request->input('groups'));",
        "// Line_Reference 519:             }",
        "// Line_Reference 520: "
    ]
}
