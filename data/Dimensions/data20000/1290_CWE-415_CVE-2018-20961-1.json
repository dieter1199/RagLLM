{
    "cve_id": "CVE-2018-20961",
    "cve_description": "In the Linux kernel before 4.16.4, a double free vulnerability in the f_midi_set_alt function of drivers/usb/gadget/function/f_midi.c in the f_midi driver may allow attackers to cause a denial of service or possibly have unspecified other impact.",
    "cve_publish_date": "2019-08-07",
    "cwe_id": "CWE-415",
    "cwe_name": "Double Free",
    "cwe_description": "The product calls free() twice on the same memory address, potentially leading to modification of unexpected memory locations.",
    "commit_message": "USB: gadget: f_midi: fixing a possible double-free in f_midi\n\nIt looks like there is a possibility of a double-free vulnerability on an\nerror path of the f_midi_set_alt function in the f_midi driver. If the\npath is feasible then free_ep_req gets called twice:\n\n         req->complete = f_midi_complete;\n         err = usb_ep_queue(midi->out_ep, req, GFP_ATOMIC);\n            => ...\n             usb_gadget_giveback_request\n               =>\n                 f_midi_complete (CALLBACK)\n                   (inside f_midi_complete, for various cases of status)\n                   free_ep_req(ep, req); // first kfree\n         if (err) {\n                 ERROR(midi, \"%s: couldn't enqueue request: %d\\n\",\n                             midi->out_ep->name, err);\n                 free_ep_req(midi->out_ep, req); // second kfree\n                 return err;\n         }\n\nThe double-free possibility was introduced with commit ad0d1a058eac\n(\"usb: gadget: f_midi: fix leak on failed to enqueue out requests\").\n\nFound by MOXCAFE tool.\n\nSigned-off-by: Tuba Yavuz <tuba@ece.ufl.edu>\nFixes: ad0d1a058eac (\"usb: gadget: f_midi: fix leak on failed to enqueue out requests\")\nAcked-by: Felipe Balbi <felipe.balbi@linux.intel.com>\nCc: stable <stable@vger.kernel.org>\nSigned-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>",
    "type_of_change": "Modification",
    "filename_of_changes": "f_midi.c",
    "code_language": "C",
    "number_of_lines_added_for_mitigation": "2",
    "number_of_lines_deleted_vulnerable_to_cve": "1",
    "vulnerable_lines": [
        "// Line_Reference 407: \t\t\tfree_ep_req(midi->out_ep, req);"
    ]
}
