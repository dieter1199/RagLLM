{
    "cve_id": "CVE-2022-45962",
    "cve_description": "Open Solutions for Education, Inc openSIS Community Edition v8.0 and earlier is vulnerable to SQL Injection via CalendarModal.php.",
    "cve_publish_date": "2023-02-13",
    "cwe_id": "CWE-89",
    "cwe_name": "Improper Neutralization of Special Elements used in an SQL Command ('SQL Injection')",
    "cwe_description": "The product constructs all or part of an SQL command using externally-influenced input from an upstream component, but it does not neutralize or incorrectly neutralizes special elements that could modify the intended SQL command when it is sent to a downstream component. Without sufficient removal or quoting of SQL syntax in user-controllable inputs, the generated SQL query can cause those inputs to be interpreted as SQL instead of ordinary user data.",
    "commit_message": "Version 9.0 release\n\nOlder version shifted to branch: Version_8.0",
    "type_of_change": "ModificationType.ADD",
    "filename_of_changes": "User.php",
    "code_language": "PHP",
    "number_of_lines_added_for_mitigation": "78",
    "number_of_lines_deleted_vulnerable_to_cve": "63",
    "vulnerable_lines": [
        "// Line_Reference 29: session_start();",
        "// Line_Reference 74:             DrawHeader(''._selectedUser.' : ' . $RET[1]['FIRST_NAME'] . '&nbsp;' . $RET[1]['LAST_NAME'], '<span class=\"heading-text\"><A HREF=Modules.php?modname=' . $_REQUEST['modname'] . '&search_modfunc=list&next_modname=users/User.php&ajax=true&bottom_back=true&return_session=true' . ($_REQUEST['profile'] == 'none' ? '&profile=none' : '') . ' target=body><i class=\"icon-square-left\"></i> '._backToUserList.'</A></span><div class=\"btn-group heading-btn\"><A HREF=Side.php?staff_id=new&modcat=' . $_REQUEST['modcat'] . ' class=\"btn btn-danger btn-xs\">'._deselect.'</A></div>');",
        "// Line_Reference 78:             DrawHeader(''._selectedUser.' : ' . $RET[1]['FIRST_NAME'] . '&nbsp;' . $RET[1]['LAST_NAME'], '<div class=\"btn-group heading-btn\"><A HREF=Side.php?staff_id=new&modcat=' . $_REQUEST['modcat'] . ' class=\"btn btn-danger btn-xs\">'._deselect.'</A></div>');",
        "// Line_Reference 122:             $can_edit_RET = DBGet(DBQuery('SELECT MODNAME FROM profile_exceptions WHERE PROFILE_ID=\\'' . User('PROFILE_ID') . '\\' AND MODNAME=\\'' . 'users/User.php&category_id=' . $_REQUEST[category_id] . '\\' AND CAN_EDIT=\\'' . 'Y' . '\\''));",
        "// Line_Reference 127:                 $can_edit_RET = DBGet(DBQuery('SELECT MODNAME FROM profile_exceptions WHERE PROFILE_ID=\\'' . $profile_id_mod . '\\' AND MODNAME=\\'' . 'users/User.php&category_id=' . $_REQUEST[category_id] . '\\' AND CAN_EDIT=\\'' . 'Y' . '\\''), array(), array('MODNAME'));",
        "// Line_Reference 139: ",
        "// Line_Reference 140: ",
        "// Line_Reference 141: ",
        "// Line_Reference 142:             if(count($_REQUEST['staff'])>0){",
        "// Line_Reference 143: ",
        "// Line_Reference 144:                   $disp_error = '';",
        "// Line_Reference 145:             if ($_REQUEST['modfunc'] == 'update') {",
        "// Line_Reference 146:                 // print_r($_REQUEST);",
        "// Line_Reference 147:                 $flag = 0;",
        "// Line_Reference 148:                 $qry = 'UPDATE people SET ';",
        "// Line_Reference 149:                 // print_r($_REQUEST['people']);",
        "// Line_Reference 150:                 foreach ($_REQUEST['staff'] as $in => $d) {",
        "// Line_Reference 152:                     $field_id = explode('_', $in);",
        "// Line_Reference 153:                     $field_id = $field_id[1];",
        "// Line_Reference 154:                     $check_stat = DBGet(DBQuery('SELECT TITLE,REQUIRED FROM people_fields WHERE ID=\\'' . $field_id . '\\' '));",
        "// Line_Reference 155:                     if ($check_stat[1]['REQUIRED'] == 'Y') {",
        "// Line_Reference 156:                         if ($d != '') {",
        "// Line_Reference 157:                             $qry.=' ' . $in . '=\\'' . str_replace(\"'\", \"''\", str_replace(\"\\'\", \"'\", $d)) . '\\',';",
        "// Line_Reference 158:                             $flag++;",
        "// Line_Reference 160:                             $disp_error = '<div class=\"alert alert-danger\">' . $check_stat[1]['TITLE'] . ' is required.</div>';",
        "// Line_Reference 161:                         }",
        "// Line_Reference 162:                     } else {",
        "// Line_Reference 163:                         if ($d != '')",
        "// Line_Reference 164:                             $qry.=' ' . $in . '=\\'' . str_replace(\"'\", \"''\", str_replace(\"\\'\", \"'\", $d)) . '\\',';",
        "// Line_Reference 165:                         else",
        "// Line_Reference 166:                             $qry.=' ' . $in . '=NULL,';",
        "// Line_Reference 168:                         $flag++;",
        "// Line_Reference 170:                 }",
        "// Line_Reference 171:                 if ($flag > 0) {",
        "// Line_Reference 173:                     $qry = substr($qry, 0, -1) . ' WHERE STAFF_ID=' . $_REQUEST['staff_id'];",
        "// Line_Reference 174:                     DBQuery($qry);",
        "// Line_Reference 177:             }",
        "// Line_Reference 178:             if (count($_REQUEST['people']) > 0) {",
        "// Line_Reference 192:                     $up_sql.=$pi . \"='\" . str_replace(\"'\", \"''\", str_replace(\"\\'\", \"'\", $pd)) . \"',\";",
        "// Line_Reference 197:                     $up_sql.=\" WHERE STAFF_ID=\" . $_REQUEST['staff_id'];",
        "// Line_Reference 223:             if (count($_REQUEST['people']) > 0) {",
        "// Line_Reference 229:                     $up_sql.=$pi . \"='\" . str_replace(\"'\", \"''\", str_replace(\"\\'\", \"'\", $pd)) . \"',\";",
        "// Line_Reference 234:                     $up_sql.=\" WHERE STAFF_ID=\" . $_REQUEST['staff_id'];",
        "// Line_Reference 248:             if (count($_REQUEST['student_addres']) > 0) {",
        "// Line_Reference 252:                     $up_sql.=$pi . \"='\" . str_replace(\"'\", \"''\", str_replace(\"\\'\", \"'\", $pd)) . \"',\";",
        "// Line_Reference 257:                     $up_sql.=\" WHERE PEOPLE_ID=\" . $_REQUEST['staff_id'];",
        "// Line_Reference 286:                                 $str.=\"||\" . $m_custom_val;",
        "// Line_Reference 296:                             $qry.=' ' . $in . '=\\'' . str_replace(\"'\", \"''\", str_replace(\"\\'\", \"'\", $d)) . '\\',';",
        "// Line_Reference 303:                             $qry.=' ' . $in . '=\\'' . str_replace(\"'\", \"''\", str_replace(\"\\'\", \"'\", $d)) . '\\',';",
        "// Line_Reference 305:                             $qry.=' ' . $in . '=NULL,';",
        "// Line_Reference 333:             DrawBC(\"\"._users.\" > Add a User\");",
        "// Line_Reference 335:             DrawBC(\"\"._users.\" > \" . ProgramTitle());",
        "// Line_Reference 351: //            echo '<script language=JavaScript>parent.side.location=\"' . $_SESSION['Side_PHP_SELF'] . '?modcat=\"+parent.side.document.forms[0].modcat.value;</script>';",
        "// Line_Reference 372:         }",
        "// Line_Reference 373:         elseif (basename($_SERVER['PHP_SELF']) != 'index.php') {",
        "// Line_Reference 381:                 $delete_button = '<INPUT type=button class=\"btn btn-danger\" value='._delete.' onclick=\"window.location=\\'Modules.php?modname=' . $_REQUEST['modname'] . '&modfunc=delete\\'\">';",
        "// Line_Reference 408:                     // echo \"$category[TITLE]<br>\";",
        "// Line_Reference 409:                 switch ($category['TITLE'] ) {",
        "// Line_Reference 417:                         $categoryTitle = $category['TITLE'] ;",
        "// Line_Reference 433:             $_openSIS['selected_tab'] .='&staff_id=' . $_REQUEST['staff_id'];",
        "// Line_Reference 434:         $_openSIS['selected_tab'] .=($_REQUEST['profile'] == 'none' ? '&profile=none' : '');",
        "// Line_Reference 451:         $submit_btn = SubmitButton(_save, '', 'id=\"saveUserBtn\" class=\"btn btn-primary pull-right\" onclick=\"return formcheck_user_user_mod(' . $_SESSION[staff_school_chkbox_id] . ', this);\"');",
        "// Line_Reference 458: ?>"
    ]
}
