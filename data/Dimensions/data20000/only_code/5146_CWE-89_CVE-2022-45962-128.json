if (strpos($_REQUEST['modname'], 'users/TeacherPrograms.php') !== false)
{
if(empty($_SESSION['staf_search']) && !empty($_SESSION['staf_search_hold']))
{
echo '<div class="form-group"><label class="control-label col-lg-4">'._lastName.'</label><div class="col-lg-8"><INPUT type=text placeholder="'._lastName.'" class=form-control name=last></div></div>';
echo '<div class="form-group"><label class="control-label col-lg-4">'._firstName.'</label><div class="col-lg-8"><INPUT type=text placeholder="'._firstName.'" class=form-control name=first></div></div>';
echo '<div class="form-group"><label class="control-label col-lg-4">'._username.'</label><div class="col-lg-8"><INPUT type=text placeholder="'._username.'" class=form-control name=username></div></div>';
}
else
echo '<div class="form-group"><label class="control-label col-lg-4">'._profile.'</label><div class="col-lg-8"><SELECT class="form-control" name=profile>';
echo '<label class="checkbox-inline"><INPUT class="styled" type=checkbox name=_search_all_schools value=Y' . (Preferences('DEFAULT_ALL_SCHOOLS') == 'Y' ? ' CHECKED' : '') . '> '._searchAllSchools.'</label>';
echo '<label class="checkbox-inline"><INPUT class="styled" type=checkbox name=_dis_user value=Y>'._includeDisabledStaff.'</label>';
echo "<div class=\"text-right\"><INPUT type=SUBMIT class='btn btn-primary' value='"._submit."' onclick=\"self_disable(this);\"> &nbsp; <INPUT type=RESET class=\"btn btn-default\" value='"._reset."'></div>";
if($_REQUEST['_search_all_schools']=='Y')
{
$extra['SELECT'].=',s.STAFF_ID as STF_ID';
$extra['functions']=array('STF_ID'=>makeStaffAllSchool);
//        else
//        {
$extra['SELECT'].=',s.STAFF_ID as CATEGORY,la.LAST_LOGIN';
$extra['functions']=array('CATEGORY'=>StaffCategory);
// }
if (strpos($_REQUEST['modname'], 'users/TeacherPrograms.php') !== false)
{
$extra['WHERE'] .= ' AND s.PROFILE_ID NOT IN(0,1) ';
$staff_RET = GetUserStaffList($extra);
if($_REQUEST['_dis_user']=='Y')
{
$last_log_sql='SELECT DISTINCT CONCAT(s.LAST_NAME,  \' \' ,s.FIRST_NAME) AS FULL_NAME,
((s.PROFILE_ID!=4 AND s.PROFILE_ID!=3) OR s.PROFILE_ID IS NULL) AND '.($_REQUEST['first']?' UPPER(s.FIRST_NAME) LIKE \''.singleQuoteReplace("'","\'",strtoupper($_REQUEST['first'])).'%\' AND ':'').($_REQUEST['last']?' UPPER(s.LAST_NAME) LIKE \''.singleQuoteReplace("'","\'",strtoupper($_REQUEST['last'])).'%\' AND ':'').' ssr.SYEAR=\''.UserSyear().'\'  AND s.STAFF_ID NOT IN (SELECT USER_ID FROM login_authentication WHERE PROFILE_ID NOT IN (3,4)) '.($_REQUEST['username']?' AND s.STAFF_ID IN (SELECT USER_ID FROM login_authentication WHERE UPPER(USERNAME) LIKE \''.singleQuoteReplace("'","\'",strtoupper($_REQUEST['username'])).'%\' AND PROFILE_ID NOT IN (3,4)) ':'');
$last_log=DBGet(DBQuery($last_log_sql));
foreach($last_log as $li=>$ld)
{
$staff_RET[]=$ld;
}
}
$_SESSION['count_stf'] =  count($staff_RET);
$columns = array('FULL_NAME' => $singular, 'STAFF_ID' =>_staffId);
$columns = array('FULL_NAME' =>_name,
'CATEGORY' =>_category,
'PROFILE' =>_profile,
'STAFF_ID' =>_staffId,
'Status' =>_status,
//                $columns = array('FULL_NAME' => 'Staff Member',
// 'CATEGORY' => 'Category',
// 'PROFILE' => 'Profile',
// 'STAFF_ID' =>_staffId,
// 'Status' => 'Status',
// );
$columns = array('FULL_NAME' =>_name,
'CATEGORY' =>_category,
'PROFILE' =>_profile,
'STAFF_ID' =>_staffId,
//                $columns = array('FULL_NAME' => 'Staff Member',  'CATEGORY' => 'Category','PROFILE' => 'Profile', 'STAFF_ID' =>_staffId);
if($_REQUEST['_search_all_schools']=='Y')
{
$columns+= array('STF_ID' => 'School Name');
}
if (($d['END_DATE'] == '0000-00-00' || $d['END_DATE'] >= date('Y-m-d') || $d['END_DATE'] == NULL) && $d['IS_DISABLE'] != 'Y' && $d['PROFILE_ID']!='')
function makeLogin($value) {
$schools=DBGet(DBQuery('SELECT * FROM staff_school_relationship WHERE (END_DATE=\'0000-00-00\' OR END_DATE IS NULL OR END_DATE>=\''.date('y-m-d').'\') AND SYEAR='.UserSyear().' AND STAFF_ID='.$value));
$return_name=array();
foreach($schools as $s)
{
$name=DBGet(DBQuery('SELECT TITLE FROM schools WHERE ID='.$s['SCHOOL_ID']));
$return_name[]=$name[1]['TITLE'];
return implode(',',$return_name);
?>
