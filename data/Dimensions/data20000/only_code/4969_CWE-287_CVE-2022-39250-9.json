import { MatrixEvent } from "../..";
// events which we couldn't decrypt due to unknown sessions / indexes: map from
// senderKey|sessionId to Set of MatrixEvents
// success. We can remove the event from the pending list, if that hasn't
// already happened.
this.removeEventFromPendingList(event);
if (!senderKey) {
logger.error("key event has no sender key (not encrypted?)");
senderKey = content.sender_key;
const extraSessionData: any = {};
if (await this.retryDecryption(senderKey, content.session_id)) {
const extraSessionData: any = {};
this.retryDecryption(session.sender_key, session.session_id);
* @return {Boolean} whether all messages were successfully decrypted
private async retryDecryption(senderKey: string, sessionId: string): Promise<boolean> {
await ev.attemptDecryption(this.crypto, { isRetry: true });
// If decrypted successfully, they'll have been removed from pendingEvents