void ip_options_build(struct sk_buff * skb, struct ip_options * opt,
int ip_options_echo(struct ip_options * dopt, struct sk_buff * skb)
struct ip_options *sopt;
if (sopt->optlen == 0) {
dopt->optlen = 0;
}
unsigned char * start = sptr+sopt->srr;
static struct ip_options *ip_options_get_alloc(const int optlen)
return kzalloc(sizeof(struct ip_options) + ((optlen + 3) & ~3),
static int ip_options_get_finish(struct net *net, struct ip_options **optp,
struct ip_options *opt, int optlen)
opt->__data[optlen++] = IPOPT_END;
opt->optlen = optlen;
if (optlen && ip_options_compile(net, opt, NULL)) {
int ip_options_get_from_user(struct net *net, struct ip_options **optp,
struct ip_options *opt = ip_options_get_alloc(optlen);
if (optlen && copy_from_user(opt->__data, data, optlen)) {
int ip_options_get(struct net *net, struct ip_options **optp,
struct ip_options *opt = ip_options_get_alloc(optlen);
memcpy(opt->__data, data, optlen);