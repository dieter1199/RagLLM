if (rem < len) {
pipe_unlock(pipe);
goto out;
}
pipe_buf_get(pipe, ibuf);
out: