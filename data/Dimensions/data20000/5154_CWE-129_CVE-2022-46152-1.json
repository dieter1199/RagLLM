{
    "cve_id": "CVE-2022-46152",
    "cve_description": "OP-TEE Trusted OS is the secure side implementation of OP-TEE project, a Trusted Execution Environment. Versions prior to 3.19.0, contain an Improper Validation of Array Index vulnerability. The function `cleanup_shm_refs()` is called by both `entry_invoke_command()` and `entry_open_session()`. The commands `OPTEE_MSG_CMD_OPEN_SESSION` and `OPTEE_MSG_CMD_INVOKE_COMMAND` can be executed from the normal world via an OP-TEE SMC. This function is not validating the `num_params` argument, which is only limited to `OPTEE_MSG_MAX_NUM_PARAMS` (127) in the function `get_cmd_buffer()`. Therefore, an attacker in the normal world can craft an SMC call that will cause out-of-bounds reading in `cleanup_shm_refs` and potentially freeing of fake-objects in the function `mobj_put()`. A normal-world attacker with permission to execute SMC instructions may exploit this flaw. Maintainers believe this problem permits local privilege escalation from the normal world to the secure world. Version 3.19.0 contains a fix for this issue. There are no known workarounds.",
    "cve_publish_date": "2022-11-29",
    "cwe_id": "CWE-129",
    "cwe_name": "Improper Validation of Array Index",
    "cwe_description": "The product uses untrusted input when calculating or using an array index, but the product does not validate or incorrectly validates the index to ensure the index references a valid position within the array.",
    "commit_message": "core: tee_entry: fix array out of bounds check in cleanup_shm_refs()\n\ncleanup_shm_refs() can be called with num_params larger than what has\nbeen used by copy_in_params(). If num_params is larger than\nTEE_NUM_PARAMS copy_in_params() will return an error and\ncleanup_shm_refs() is called to clean up.\n\nThis leads to accessing uint64_t saved_attr[TEE_NUM_PARAMS] in\nentry_invoke_command() or entry_open_session() out of bounds and\npossibly also the u[TEE_NUM_PARAMS] array in struct tee_ta_param.\n\nSo fix this by capping num_params TEE_NUM_PARAMS in cleanup_shm_refs().\n\nFixes: b05cd886e06d (\"core: enable non-contiguous temporary reference parameters\")\nReviewed-by: Jerome Forissier <jerome.forissier@linaro.org>\nSigned-off-by: Jens Wiklander <jens.wiklander@linaro.org>",
    "type_of_change": "Modification",
    "filename_of_changes": "entry_std.c",
    "code_language": "C",
    "number_of_lines_added_for_mitigation": "1",
    "number_of_lines_deleted_vulnerable_to_cve": "1",
    "vulnerable_lines": [
        "// Line_Reference 257: \tfor (n = 0; n < num_params; n++) {"
    ]
}
