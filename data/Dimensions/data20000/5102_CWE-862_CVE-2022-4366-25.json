{
    "cve_id": "CVE-2022-4366",
    "cve_description": "Missing Authorization in GitHub repository lirantal/daloradius prior to master branch.",
    "cve_publish_date": "2022-12-08",
    "cwe_id": "CWE-862",
    "cwe_name": "Missing Authorization",
    "cwe_description": "The product does not perform an authorization check when an actor attempts to access a resource or perform an action.",
    "commit_message": "fix: introduced security fixes (#263)\n\n- dologin.php - validating user input and introduced CSRF token check\r\n- logging.php - preventing direct access to this file, which means redirecting to index.php when directly hitting this include file, (repeated for other exten. / include / etc. files), and optimized logging features\r\n- actionMessages.php and errorHandling.php same as logging.php\r\n- library/exten-* files - preventing direct access to these files, generalized the approach of looking for known file locations, improved user input validation (params such as limit, etc.), improved output (escaping logfile output, etc.)\r\n- in library/exten-server_info.php - i also have added new commands for retrieving network information and system distro/version\r\n- opendb.php - general code optimization (TODO prevent direct access to this file)\r\n- sessions.php - introduced new session handling (TODO prevent direct access to this file)\r\n- login.php - removed the default username hardcoded in the form, added the csrf_token\r\n- rep-* - user input validation, code optimization",
    "type_of_change": "Modification",
    "filename_of_changes": "exten-maint-radclient.php",
    "code_language": "PHP",
    "number_of_lines_added_for_mitigation": "90",
    "number_of_lines_deleted_vulnerable_to_cve": "86",
    "vulnerable_lines": [
        "// Line_Reference 18:  *\t\tThis code allows for running the 'radtest' binary tool provided with freeradius",
        "// Line_Reference 19:  *\t\tfor performing a dry-run check to see if a user is able to successfully login",
        "// Line_Reference 20:  *\t\tor that there may be problems connecting.",
        "// Line_Reference 22:  * Authors:\tLiran Tal <liran@enginx.com>",
        "// Line_Reference 23:  *\t\tGiso Kegal <kegel@barum.de>",
        "// Line_Reference 31: // $radiusaddr\t- the server address, this would most likely be the radius server IP Address/Hostname",
        "// Line_Reference 33: // $options\t- the options passed to the radclient program",
        "// Line_Reference 34: // $command\t- the command string that radclient sends (auth, acct, status, coa, disconnect), by default this functions does 'auth'",
        "// Line_Reference 35: function user_auth($options,$user,$pass,$radiusaddr,$radiusport,$secret,$command=\"auth\",$additional=\"\") {",
        "// Line_Reference 36: ",
        "// Line_Reference 37: \t$user = escapeshellarg($user);",
        "// Line_Reference 38: \t$pass = escapeshellarg($pass);",
        "// Line_Reference 39: ",
        "// Line_Reference 40: \t$args = escapeshellarg(\"$radiusaddr:$radiusport\").\" \".escapeshellarg($command).",
        "// Line_Reference 41: \t\t\" \".escapeshellarg($secret);",
        "// Line_Reference 42: \t$query = \"User-Name=$user,User-Password=$pass\";",
        "// Line_Reference 43: ",
        "// Line_Reference 44: \t$radclient = \"radclient\"; \t\t// or you can change this with the full path if the binary radcilent program can not be",
        "// Line_Reference 45: \t\t\t\t\t\t\t\t\t// found within your $PATH variable",
        "// Line_Reference 46: ",
        "// Line_Reference 47: \t$radclient_options = \"-c \".escapeshellarg($options['count']).",
        "// Line_Reference 48: \t\t\t\t\" -n \".escapeshellarg($options['requests']).",
        "// Line_Reference 49: \t\t\t\t\" -r \".escapeshellarg($options['retries']).",
        "// Line_Reference 50: \t\t\t\t\" -t \".escapeshellarg($options['timeout']).",
        "// Line_Reference 51: \t\t\t\t\" \".$options['debug'];",
        "// Line_Reference 52: ",
        "// Line_Reference 53: \tif ($options['dictionary'])",
        "// Line_Reference 54: \t\t$radclient_options .= \" -d \".escapeshellarg($options['dictionary']);",
        "// Line_Reference 55: ",
        "// Line_Reference 56: \t$cmd = \"echo \".escapeshellcmd($query).\" | $radclient $radclient_options $args 2>&1\";",
        "// Line_Reference 57: ",
        "// Line_Reference 58: \t$print_cmd = \"<b>Executed:</b><br/>$cmd<br/><br/><b>Results:</b><br/>\";",
        "// Line_Reference 59: \t$res = shell_exec($cmd);",
        "// Line_Reference 60: ",
        "// Line_Reference 61: \tif ($res == \"\") {",
        "// Line_Reference 62: \t\techo \"<b>Error:</b> Command did not return any results<br/>\";",
        "// Line_Reference 63: \t\techo \"Please check that you have the radclient binary program installed and that",
        "// Line_Reference 64: \t\t\tit is found in your \\$PATH variable<br/>",
        "// Line_Reference 65: \t\t\tYou may also consult the file library/exten-maint-radclient.php for other problems<br/>",
        "// Line_Reference 66: \t\t\";",
        "// Line_Reference 67: \t}",
        "// Line_Reference 68: ",
        "// Line_Reference 69: \t// todo better layout",
        "// Line_Reference 70: \t$output_html = nl2br($res);",
        "// Line_Reference 71: \treturn $print_cmd . $output_html;",
        "// Line_Reference 77: // $nasaddr\t- NAS address to receive the coa or disconnect request packet",
        "// Line_Reference 78: // $nasport\t- NAS Port address (depends on the configuration on the NAS, this may be a different port for either CoA or Disconnect packets).",
        "// Line_Reference 79: function user_disconnect($options,$user,$nasaddr,$nasport=\"3779\",$nassecret,$command=\"disconnect\",$additional=\"\") {",
        "// Line_Reference 80: ",
        "// Line_Reference 81: \t$user = escapeshellarg($user);",
        "// Line_Reference 82: ",
        "// Line_Reference 83: \t$args = escapeshellarg(\"$nasaddr:$nasport\").\" \".escapeshellarg($command).\" \".",
        "// Line_Reference 84: \t\t\tescapeshellarg($nassecret);",
        "// Line_Reference 85: \t$query = \"User-Name=$user\";",
        "// Line_Reference 86: ",
        "// Line_Reference 87: \tif (!empty($additional)) {",
        "// Line_Reference 88: \t\t$query .= ','.$additional;",
        "// Line_Reference 89: \t}",
        "// Line_Reference 90: ",
        "// Line_Reference 91: \t$radclient = \"radclient\"; \t\t// or you can change this with the full path if the binary radcilent program can not be",
        "// Line_Reference 92: \t\t\t\t\t\t// found within your $PATH variable",
        "// Line_Reference 93: ",
        "// Line_Reference 94: \t$radclient_options = \"-c \".escapeshellarg($options['count']).",
        "// Line_Reference 95: \t\t\t\t\" -n \".escapeshellarg($options['requests']).",
        "// Line_Reference 96: \t\t\t\t\" -r \".escapeshellarg($options['retries']).",
        "// Line_Reference 97: \t\t\t\t\" -t \".escapeshellarg($options['timeout']).",
        "// Line_Reference 98: \t\t\t\t\" \".$options['debug'];",
        "// Line_Reference 99: ",
        "// Line_Reference 100: \tif ($options['dictionary'])",
        "// Line_Reference 101: \t\t$radclient_options .= \" -d \".escapeshellarg($options['dictionary']);",
        "// Line_Reference 102: ",
        "// Line_Reference 103: \t$cmd = \"echo \\\"\".escapeshellcmd($query).\"\\\" | $radclient $radclient_options $args 2>&1\";",
        "// Line_Reference 104: \t$print_cmd = \"<b>Executed:</b><br/>$cmd<br/><br/><b>Results:</b><br/>\";",
        "// Line_Reference 105: \t$res = shell_exec($cmd);",
        "// Line_Reference 106: ",
        "// Line_Reference 107: \tif ($res == \"\") {",
        "// Line_Reference 108: \t\techo \"<b>Error:</b> Command did not return any results<br/>\";",
        "// Line_Reference 109: \t\techo \"Please check that you have the radclient binary program installed and that",
        "// Line_Reference 110: \t\t\tit is found in your \\$PATH variable<br/>",
        "// Line_Reference 111: \t\t\tYou may also consult the file library/exten-maint-radclient.php for other problems<br/>",
        "// Line_Reference 112: \t\t\";",
        "// Line_Reference 113: \t}",
        "// Line_Reference 114: ",
        "// Line_Reference 115: \t// todo better layout",
        "// Line_Reference 116: \t$output_html = nl2br($res);",
        "// Line_Reference 117: \treturn $print_cmd . $output_html;"
    ]
}
