{
    "cve_id": "CVE-2021-41245",
    "cve_description": "Combodo iTop is a web based IT Service Management tool. In versions prior to 2.7.6 and 3.0.0, CSRF tokens generated by `privUITransactionFile` aren't properly checked. Versions 2.7.6 and 3.0.0 contain a patch for this issue. As a workaround, use the session implementation by adding in the iTop config file.",
    "cve_publish_date": "2022-04-05",
    "cwe_id": "CWE-352",
    "cwe_name": "Cross-Site Request Forgery (CSRF)",
    "cwe_description": "The web application does not, or can not, sufficiently verify whether a well-formed, valid, consistent request was intentionally provided by the user who submitted the request.",
    "commit_message": "NÂ°4289 Security hardening",
    "type_of_change": "ModificationType.ADD",
    "filename_of_changes": "transaction.class.inc.php",
    "code_language": "PHP",
    "number_of_lines_added_for_mitigation": "67",
    "number_of_lines_deleted_vulnerable_to_cve": "32",
    "vulnerable_lines": [
        "// Line_Reference 220: \t\t$id = basename(tempnam(APPROOT.'data/transactions', static::GetUserPrefix()));",
        "// Line_Reference 221: \t\tself::Info('GetNewTransactionId: Created transaction: '.$id);",
        "// Line_Reference 223: \t\treturn (string)$id;",
        "// Line_Reference 246: \t\tif ($bResult)",
        "// Line_Reference 248: \t\t\tif ($bRemoveTransaction)",
        "// Line_Reference 250: \t\t\t\t$bResult = @unlink($sFilepath);",
        "// Line_Reference 251: \t\t\t\tif (!$bResult)",
        "// Line_Reference 252: \t\t\t\t{",
        "// Line_Reference 253: \t\t\t\t\tself::Error('IsTransactionValid: FAILED to remove transaction '.$id);",
        "// Line_Reference 254: \t\t\t\t}",
        "// Line_Reference 255: \t\t\t\telse",
        "// Line_Reference 256: \t\t\t\t{",
        "// Line_Reference 257: \t\t\t\t\tself::Info('IsTransactionValid: OK. Removed transaction: '.$id);",
        "// Line_Reference 258: \t\t\t\t}",
        "// Line_Reference 261: \t\telse",
        "// Line_Reference 262: \t\t{",
        "// Line_Reference 263: \t\t\tself::Info(\"IsTransactionValid: Transaction '$id' not found. Pending transactions for this user:\\n\".implode(\"\\n\", self::GetPendingTransactions()));",
        "// Line_Reference 264: \t\t}",
        "// Line_Reference 275: \t\t$sFilepath = APPROOT.'data/transactions/'.$id;",
        "// Line_Reference 276: \t\tclearstatcache(true, $sFilepath);",
        "// Line_Reference 277: \t\tif (!file_exists($sFilepath)) {",
        "// Line_Reference 278: \t\t\t$bSuccess = false;",
        "// Line_Reference 279: \t\t\tself::Error(\"RemoveTransaction: Transaction '$id' not found. Pending transactions for this user:\\n\"",
        "// Line_Reference 281: \t\t} else {",
        "// Line_Reference 282: \t\t\t$bSuccess = @unlink($sFilepath);",
        "// Line_Reference 283: \t\t}",
        "// Line_Reference 284: ",
        "// Line_Reference 285: \t\tif (!$bSuccess) {",
        "// Line_Reference 286: \t\t\tself::Error('RemoveTransaction: FAILED to remove transaction '.$id);",
        "// Line_Reference 287: \t\t} else {",
        "// Line_Reference 288: \t\t\tself::Info('RemoveTransaction: OK '.$id);",
        "// Line_Reference 291: \t\treturn $bSuccess;"
    ]
}
