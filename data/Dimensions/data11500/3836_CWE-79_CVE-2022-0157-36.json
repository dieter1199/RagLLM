{
    "cve_id": "CVE-2022-0157",
    "cve_description": "phoronix-test-suite is vulnerable to Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting')",
    "cve_publish_date": "2022-01-10",
    "cwe_id": "CWE-79",
    "cwe_name": "Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting')",
    "cwe_description": "The product does not neutralize or incorrectly neutralizes user-controllable input before it is placed in output that is used as a web page that is served to other users.",
    "commit_message": "phodevi: Input sanitization updates for Phoromatic Server\n\nAlso other code formatting / cleanups while reviewing the code...",
    "type_of_change": "Modification",
    "filename_of_changes": "public.php",
    "code_language": "PHP",
    "number_of_lines_added_for_mitigation": "11",
    "number_of_lines_deleted_vulnerable_to_cve": "53",
    "vulnerable_lines": [
        "// Line_Reference 6: \tCopyright (C) 2008 - 2021, Phoronix Media",
        "// Line_Reference 7: \tCopyright (C) 2008 - 2021, Michael Larabel",
        "// Line_Reference 133: \t\t\t\t$system_name = phoromatic_system_id_to_name($row['SystemID'], $row['AccountID']);",
        "// Line_Reference 139: \t\t\t\t$system_name = phoromatic_system_id_to_name($row['SystemID'], $row['AccountID']) . ': ' . $row['Trigger'];",
        "// Line_Reference 145: \t\t\t\t$system_name = phoromatic_system_id_to_name($row['SystemID'], $row['AccountID']) . ' - ' . phoromatic_schedule_id_to_name($row['ScheduleID']) . ' - ' . $row['Trigger'];",
        "// Line_Reference 158: \t$attribute_options = array(",
        "// Line_Reference 159: \t\t'normalize_results' => 'normalize_result_buffer',",
        "// Line_Reference 160: \t\t'sort_by_performance' => 'sort_result_buffer_values',",
        "// Line_Reference 161: \t\t'sort_by_reverse' => 'reverse_result_buffer',",
        "// Line_Reference 162: \t\t'sort_by_name' => 'sort_result_buffer',",
        "// Line_Reference 163: \t\t'condense_comparison' => 'condense_multi_way',",
        "// Line_Reference 164: \t\t);",
        "// Line_Reference 165: \tforeach($attribute_options as $web_var => $attr_var)",
        "// Line_Reference 166: \t{",
        "// Line_Reference 167: \t\tif(isset($_REQUEST[$web_var]))",
        "// Line_Reference 168: \t\t{",
        "// Line_Reference 169: \t\t\t$extra_attributes[$attr_var] = true;",
        "// Line_Reference 170: \t\t}",
        "// Line_Reference 171: \t}",
        "// Line_Reference 172: ",
        "// Line_Reference 173: \tif(isset($_POST['transpose_comparison']))",
        "// Line_Reference 174: \t{",
        "// Line_Reference 175: \t\t$result_file->invert_multi_way_invert();",
        "// Line_Reference 176: \t}",
        "// Line_Reference 177: \t$intent = null;",
        "// Line_Reference 178: \t$main .= '<h1>' . $result_file->get_title() . '</h1>';",
        "// Line_Reference 179: \t$main .= '<p>' . $result_file->get_description() . '</p>';",
        "// Line_Reference 180: \t$main .= phoromatic_annotate_entry('RESULT', implode(',', $result_ids), 'TOP');",
        "// Line_Reference 181: ",
        "// Line_Reference 182: \tif($result_file->get_system_count() == 1 || ($intent = pts_result_file_analyzer::analyze_result_file_intent($result_file, $intent, true)))",
        "// Line_Reference 183: \t{",
        "// Line_Reference 184: \t\t$table = new pts_ResultFileCompactSystemsTable($result_file, $intent);",
        "// Line_Reference 185: \t}",
        "// Line_Reference 186: \telse",
        "// Line_Reference 187: \t{",
        "// Line_Reference 188: \t\t$table = new pts_ResultFileSystemsTable($result_file);",
        "// Line_Reference 189: \t}",
        "// Line_Reference 190: ",
        "// Line_Reference 191: \t$main .= '<p style=\"text-align: center; overflow: auto;\" class=\"result_object\">' . pts_render::render_graph_inline_embed($table, $result_file, $extra_attributes) . '</p>';",
        "// Line_Reference 192: ",
        "// Line_Reference 193: \t$table = new pts_ResultFileTable($result_file, $intent);",
        "// Line_Reference 194: \t$main .= '<p style=\"text-align: center; overflow: auto;\" class=\"result_object\">' . pts_render::render_graph_inline_embed($table, $result_file, $extra_attributes) . '</p>';",
        "// Line_Reference 195: \t$main .= '<div id=\"pts_results_area\">';",
        "// Line_Reference 196: \tforeach($result_file->get_result_objects((isset($_POST['show_only_changed_results']) ? 'ONLY_CHANGED_RESULTS' : -1)) as $i => $result_object)",
        "// Line_Reference 197: \t{",
        "// Line_Reference 198: \t\t$main .= '<h2><a name=\"r-' . $i . '\"></a><a name=\"' . $result_object->get_comparison_hash(true, false) . '\"></a>' . $result_object->test_profile->get_title() . '</h2>';",
        "// Line_Reference 199: \t\t$main .= phoromatic_annotate_entry('RESULT', implode(',', $result_ids), $result_object->get_comparison_hash(true, false));",
        "// Line_Reference 200: \t\t$main .= '<p style=\"text-align: center; overflow: auto;\">';",
        "// Line_Reference 201: \t\t$main .= pts_render::render_graph_inline_embed($result_object, $result_file, $extra_attributes);",
        "// Line_Reference 202: \t\t$main .= '</p>';",
        "// Line_Reference 203: \t}",
        "// Line_Reference 204: \t$main .= '</div>';",
        "// Line_Reference 288: \t\t$main .= '<a onclick=\"\"><li id=\"result_select_' . $test_result_row['PPRID'] . '\"><input type=\"checkbox\" id=\"result_compare_checkbox_' . $test_result_row['PPRID'] . '\" onclick=\"javascript:phoromatic_checkbox_toggle_result_comparison(\\'' . $test_result_row['PPRID'] . '\\');\" onchange=\"return false;\"></input> <span onclick=\"javascript:phoromatic_window_redirect(\\'public.php?ut=' . $test_result_row['PPRID'] . '\\');\">' . $test_result_row['Title'] . '</span><br /><table><tr><td>' . phoromatic_system_id_to_name($test_result_row['SystemID'], $test_result_row['AccountID']) . '</td><td>' . phoromatic_user_friendly_timedate($test_result_row['UploadTime']) .  '</td><td>' . $test_result_row['TimesViewed'] . ' Times Viewed</td></table></li></a>';"
    ]
}
