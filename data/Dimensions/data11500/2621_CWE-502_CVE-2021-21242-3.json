{
    "cve_id": "CVE-2021-21242",
    "cve_description": "OneDev is an all-in-one devops platform. In OneDev before version 4.0.3, there is a critical vulnerability which can lead to pre-auth remote code execution. AttachmentUploadServlet deserializes untrusted data from the `Attachment-Support` header. This Servlet does not enforce any authentication or authorization checks. This issue may lead to pre-auth remote code execution. This issue was fixed in 4.0.3 by removing AttachmentUploadServlet and not using deserialization",
    "cve_publish_date": "2021-01-15",
    "cwe_id": "CWE-502",
    "cwe_name": "Deserialization of Untrusted Data",
    "cwe_description": "The product deserializes untrusted data without sufficiently verifying that the resulting data will be valid.",
    "commit_message": "Do not use deserialized AttachmentSupport from client side to avoid security vulnerabilities",
    "type_of_change": "Modification",
    "filename_of_changes": "MarkdownEditor.java",
    "code_language": "Java",
    "number_of_lines_added_for_mitigation": "46",
    "number_of_lines_deleted_vulnerable_to_cve": "18",
    "vulnerable_lines": [
        "// Line_Reference 17: import org.apache.commons.lang3.SerializationUtils;",
        "// Line_Reference 44: import org.apache.wicket.util.crypt.Base64;",
        "// Line_Reference 85: \tprivate AbstractPostAjaxBehavior ajaxBehavior;",
        "// Line_Reference 254: \t\tcontainer.add(ajaxBehavior = new AbstractPostAjaxBehavior() {",
        "// Line_Reference 479: \t\tString encodedAttachmentSupport;",
        "// Line_Reference 480: \t\tif (getAttachmentSupport() != null) {",
        "// Line_Reference 481: \t\t\tencodedAttachmentSupport = Base64.encodeBase64String(SerializationUtils.serialize(getAttachmentSupport()));",
        "// Line_Reference 482: \t\t\tencodedAttachmentSupport = StringUtils.deleteWhitespace(encodedAttachmentSupport);",
        "// Line_Reference 483: \t\t\tencodedAttachmentSupport = StringEscapeUtils.escapeEcmaScript(encodedAttachmentSupport);",
        "// Line_Reference 484: \t\t\tencodedAttachmentSupport = \"'\" + encodedAttachmentSupport + \"'\";",
        "// Line_Reference 485: \t\t} else {",
        "// Line_Reference 486: \t\t\tencodedAttachmentSupport = \"undefined\";",
        "// Line_Reference 487: \t\t}",
        "// Line_Reference 488: ",
        "// Line_Reference 489: \t\tString callback = ajaxBehavior.getCallbackFunction(explicit(\"action\"), explicit(\"param1\"), explicit(\"param2\"),",
        "// Line_Reference 500: \t\t\t\tcallback,",
        "// Line_Reference 502: \t\t\t\tencodedAttachmentSupport,",
        "// Line_Reference 503: \t\t\t\tgetAttachmentSupport()!=null?getAttachmentSupport().getAttachmentMaxSize():0,"
    ]
}
