{
    "cve_id": "CVE-2021-4298",
    "cve_description": "A vulnerability classified as critical has been found in Hesburgh Libraries of Notre Dame Sipity. This affects the function SearchCriteriaForWorksParameter of the file app/parameters/sipity/parameters/search_criteria_for_works_parameter.rb. The manipulation leads to sql injection. Upgrading to version 2021.8 is able to address this issue. The patch is named d1704c7363b899ffce65be03a796a0ee5fdbfbdc. It is recommended to upgrade the affected component. The associated identifier of this vulnerability is VDB-217179.",
    "cve_publish_date": "2023-01-02",
    "cwe_id": "CWE-89",
    "cwe_name": "Improper Neutralization of Special Elements used in an SQL Command ('SQL Injection')",
    "cwe_description": "The product constructs all or part of an SQL command using externally-influenced input from an upstream component, but it does not neutralize or incorrectly neutralizes special elements that could modify the intended SQL command when it is sent to a downstream component. Without sufficient removal or quoting of SQL syntax in user-controllable inputs, the generated SQL query can cause those inputs to be interpreted as SQL instead of ordinary user data.",
    "commit_message": "Adding protection against SQL injection\n\nPrior to this commit, the SearchCriteriaForWorksParameter class was to\noptimistic in the additional_attributes it received.  This was \"okay\" in\nthat these attributes were passed from within the application (and not\nfrom user input).\n\nHowever, I wanted to tighten that up further which is why I added the\nchanges to fetch the attributes from a map.\n\nAnd even with all of this, [brakeman][1] identified this as a weak\nchance for SQL injection.  So I also added a config/brakeman.yml file to\nskip over this file. (alas I can't skip over a singular violation)\n\n[1]:https://rubygems.org/gems/brakeman",
    "type_of_change": "Modification",
    "filename_of_changes": "search_criteria_for_works_parameter.rb",
    "code_language": "Ruby",
    "number_of_lines_added_for_mitigation": "21",
    "number_of_lines_deleted_vulnerable_to_cve": "4",
    "vulnerable_lines": [
        "// Line_Reference 71:           table_name = attribute.to_s.pluralize",
        "// Line_Reference 73:             %(LEFT OUTER JOIN #{attr_table_name} AS #{table_name} ON #{table_name}.work_id = #{work_table_name}.id AND #{table_name}.key = \"#{attribute}\")",
        "// Line_Reference 75:           select_fields << \"#{table_name}.value AS #{attribute}\"",
        "// Line_Reference 87:           Models::AdditionalAttribute.sanitize_sql_for_conditions(attribute_name.to_s)"
    ]
}
