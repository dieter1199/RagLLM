{
    "cve_id": "CVE-2021-38725",
    "cve_description": "Fuel CMS 1.5.0 has a brute force vulnerability in fuel/modules/fuel/controllers/Login.php",
    "cve_publish_date": "2021-09-09",
    "cwe_id": "CWE-307",
    "cwe_name": "Improper Restriction of Excessive Authentication Attempts",
    "cwe_description": "The product does not implement sufficient measures to prevent multiple failed authentication attempts within a short time frame, making it more susceptible to brute force attacks.",
    "commit_message": "fix: for issue #581",
    "type_of_change": "Modification",
    "filename_of_changes": "Login.php",
    "code_language": "PHP",
    "number_of_lines_added_for_mitigation": "54",
    "number_of_lines_deleted_vulnerable_to_cve": "27",
    "vulnerable_lines": [
        "// Line_Reference 114: \t\t\t\t\t\t// check if they are no longer in the locked out state and reset variables",
        "// Line_Reference 115: \t\t\t\t\t\tif (isset($user_data['failed_login_timer']) AND (time() - $user_data['failed_login_timer']) > (int)$this->fuel->config('seconds_to_unlock'))",
        "// Line_Reference 116: \t\t\t\t\t\t{",
        "// Line_Reference 117: \t\t\t\t\t\t\t$user_data['failed_login_attempts'] = 0;",
        "// Line_Reference 118: \t\t\t\t\t\t\t$this->session->unset_userdata('failed_login_timer');",
        "// Line_Reference 119: \t\t\t\t\t\t\tunset($user_data['failed_login_timer']);",
        "// Line_Reference 120: \t\t\t\t\t\t}",
        "// Line_Reference 121: \t\t\t\t\t\telse",
        "// Line_Reference 122: \t\t\t\t\t\t{",
        "// Line_Reference 123: \t\t\t\t\t\t\t// add to the number of attempts if it's an invalid login'",
        "// Line_Reference 124: \t\t\t\t\t\t\t$num_attempts = (!isset($user_data['failed_login_attempts'])) ? 0 : $user_data['failed_login_attempts'] + 1;",
        "// Line_Reference 125: \t\t\t\t\t\t\t$user_data['failed_login_attempts'] = $num_attempts;",
        "// Line_Reference 126: \t\t\t\t\t\t}",
        "// Line_Reference 128: \t\t\t\t\t\t// check if they should be locked out",
        "// Line_Reference 129: \t\t\t\t\t\tif (isset($user_data['failed_login_attempts']) AND $user_data['failed_login_attempts'] >= (int)$this->fuel->config('num_logins_before_lock') -1)",
        "// Line_Reference 130: \t\t\t\t\t\t{",
        "// Line_Reference 131: \t\t\t\t\t\t\t$this->fuel_users_model->add_error(lang('error_max_attempts', $this->fuel->config('seconds_to_unlock')));",
        "// Line_Reference 132: \t\t\t\t\t\t\t$user_data['failed_login_timer'] = time();",
        "// Line_Reference 133: \t\t\t\t\t\t\t$this->fuel->logs->write(lang('auth_log_account_lockout', $this->input->post('user_name', TRUE), $this->input->ip_address()), 'debug');",
        "// Line_Reference 134: \t\t\t\t\t\t}",
        "// Line_Reference 135: \t\t\t\t\t\telse",
        "// Line_Reference 136: \t\t\t\t\t\t{",
        "// Line_Reference 137: \t\t\t\t\t\t\t$this->fuel_users_model->add_error(lang('error_invalid_login'));",
        "// Line_Reference 138: \t\t\t\t\t\t\t$this->fuel->logs->write(lang('auth_log_failed_login', $this->input->post('user_name', TRUE), $this->input->ip_address(), ($user_data['failed_login_attempts'] + 1)), 'debug');",
        "// Line_Reference 139: \t\t\t\t\t\t}",
        "// Line_Reference 193: \t\t\tif ($this->input->post('email'))",
        "// Line_Reference 234: \t\t\t\t\t$this->fuel_users_model->add_error(lang('error_invalid_email'));"
    ]
}
