{
    "cve_id": "CVE-2022-0157",
    "cve_description": "phoronix-test-suite is vulnerable to Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting')",
    "cve_publish_date": "2022-01-10",
    "cwe_id": "CWE-79",
    "cwe_name": "Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting')",
    "cwe_description": "The product does not neutralize or incorrectly neutralizes user-controllable input before it is placed in output that is used as a web page that is served to other users.",
    "commit_message": "phodevi: Input sanitization updates for Phoromatic Server\n\nAlso other code formatting / cleanups while reviewing the code...",
    "type_of_change": "Modification",
    "filename_of_changes": "phoromatic_system_claim.php",
    "code_language": "PHP",
    "number_of_lines_added_for_mitigation": "35",
    "number_of_lines_deleted_vulnerable_to_cve": "36",
    "vulnerable_lines": [
        "// Line_Reference 6: \tCopyright (C) 2008 - 2015, Phoronix Media",
        "// Line_Reference 7: \tCopyright (C) 2008 - 2015, Michael Larabel",
        "// Line_Reference 23: ",
        "// Line_Reference 46: if(function_exists('ssh2_connect') && isset($_POST['ip']) && isset($_POST['port']) && isset($_POST['password']) && isset($_POST['username']))",
        "// Line_Reference 47: {",
        "// Line_Reference 48: \t$connection = ssh2_connect($_POST['ip'], $_POST['port']);",
        "// Line_Reference 50: \tif(ssh2_auth_password($connection, $_POST['username'], $_POST['password']))",
        "// Line_Reference 51: \t{",
        "// Line_Reference 52: \t\t$tmp_local_file = tempnam('/tmp', 'pts-ssh');",
        "// Line_Reference 53: \t\t$tmp_remote_file = 'pts-ssh-' . rand(9999, 99999);",
        "// Line_Reference 54: ",
        "// Line_Reference 55: \t\tfile_put_contents($tmp_local_file, '#!/bin/sh",
        "// Line_Reference 56: if [ -w /var/lib/phoronix-test-suite/ ]",
        "// Line_Reference 57: then",
        "// Line_Reference 58: \tPHORO_FILE_PATH=/var/lib/phoronix-test-suite/",
        "// Line_Reference 59: elif [ -w $HOME/.phoronix-test-suite/ ]",
        "// Line_Reference 60: then",
        "// Line_Reference 61: \tPHORO_FILE_PATH=$HOME/.phoronix-test-suite/",
        "// Line_Reference 62: fi",
        "// Line_Reference 63: ",
        "// Line_Reference 64: echo \"' . phoromatic_web_socket_server_ip() . '\" >> $PHORO_FILE_PATH/phoromatic-servers",
        "// Line_Reference 65: mkdir -p $PHORO_FILE_PATH/modules-data/phoromatic",
        "// Line_Reference 66: echo \"' . phoromatic_web_socket_server_addr() . '\" > $PHORO_FILE_PATH/modules-data/phoromatic/last-phoromatic-server",
        "// Line_Reference 67: ');",
        "// Line_Reference 68: ",
        "// Line_Reference 69: \t\tssh2_scp_send($connection, $tmp_local_file, $tmp_remote_file);",
        "// Line_Reference 70: \t\tunlink($tmp_local_file);",
        "// Line_Reference 71: \t\tssh2_exec($connection, 'chmod +x ' . $tmp_remote_file);",
        "// Line_Reference 72: \t\tssh2_exec($connection, './' . $tmp_remote_file);",
        "// Line_Reference 73: \t\tssh2_exec($connection, 'rm' . $tmp_remote_file);",
        "// Line_Reference 74: \t}",
        "// Line_Reference 75: }",
        "// Line_Reference 91: \t\t\t\t$stmt->bindValue(':ip_address', $_POST['ip_claim']);",
        "// Line_Reference 92: \t\t\t\t$stmt->bindValue(':mac_address', $_POST['mac_claim']);",
        "// Line_Reference 101: \t\t\t\t$stmt->bindValue(':ip_address', $ipc);",
        "// Line_Reference 102: \t\t\t\t$stmt->bindValue(':mac_address', $macc);"
    ]
}
