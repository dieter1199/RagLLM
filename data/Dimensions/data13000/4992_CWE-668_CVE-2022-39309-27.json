{
    "cve_id": "CVE-2022-39309",
    "cve_description": "GoCD is a continuous delivery server. GoCD helps you automate and streamline the build-test-release cycle for continuous delivery of your product. GoCD versions prior to 21.1.0 leak the symmetric key used to encrypt/decrypt any secure variables/secrets in GoCD configuration to authenticated agents. A malicious/compromised agent may then expose that key from memory, and potentially allow an attacker the ability to decrypt secrets intended for other agents/environments if they also are able to obtain access to encrypted configuration values from the GoCD server. This issue is fixed in GoCD version 21.1.0. There are currently no known workarounds.",
    "cve_publish_date": "2022-10-14",
    "cwe_id": "CWE-668",
    "cwe_name": "Exposure of Resource to Wrong Sphere",
    "cwe_description": "The product exposes a resource to the wrong control sphere, providing unintended actors with inappropriate access to the resource.",
    "commit_message": "SCMMaterial changes #000\n\n* SCMMaterial unlike SCMMaterialConfig objects are used for polling,\n  they do not need to encrypt the password. Hence removing the\n  encryptedPassword attribute.",
    "type_of_change": "Modification",
    "filename_of_changes": "ScmMaterial.java",
    "code_language": "Java",
    "number_of_lines_added_for_mitigation": "2",
    "number_of_lines_deleted_vulnerable_to_cve": "39",
    "vulnerable_lines": [
        "// Line_Reference 24: import com.thoughtworks.go.security.CryptoException;",
        "// Line_Reference 25: import com.thoughtworks.go.security.GoCipher;",
        "// Line_Reference 37: import static com.thoughtworks.go.util.ExceptionUtils.bomb;",
        "// Line_Reference 39: import static org.apache.commons.lang3.StringUtils.isBlank;",
        "// Line_Reference 51:     protected final GoCipher goCipher;",
        "// Line_Reference 59:     protected String encryptedPassword;",
        "// Line_Reference 62:     public ScmMaterial(String typeName, GoCipher goCipher) {",
        "// Line_Reference 64:         this.goCipher = goCipher;",
        "// Line_Reference 124:         if (StringUtils.isBlank(passwordToSet)) {",
        "// Line_Reference 125:             encryptedPassword = null;",
        "// Line_Reference 126:         }",
        "// Line_Reference 133:         this.encryptedPassword = StringUtils.stripToNull(encryptedPassword);",
        "// Line_Reference 134: ",
        "// Line_Reference 135:         if (this.password == null) {",
        "// Line_Reference 136:             return;",
        "// Line_Reference 137:         }",
        "// Line_Reference 138:         try {",
        "// Line_Reference 139:             this.encryptedPassword = this.goCipher.encrypt(password);",
        "// Line_Reference 140:         } catch (Exception e) {",
        "// Line_Reference 141:             bomb(\"Password encryption failed. Please verify your cipher key.\", e);",
        "// Line_Reference 142:         }",
        "// Line_Reference 143:         this.password = null;",
        "// Line_Reference 156:     public final void setEncryptedPassword(String encryptedPassword) {",
        "// Line_Reference 157:         this.encryptedPassword = encryptedPassword;",
        "// Line_Reference 158:     }",
        "// Line_Reference 159: ",
        "// Line_Reference 160:     public final String getEncryptedPassword() {",
        "// Line_Reference 161:         return encryptedPassword;",
        "// Line_Reference 162:     }",
        "// Line_Reference 163: ",
        "// Line_Reference 165:         return currentPassword();",
        "// Line_Reference 182:     public final String currentPassword() {",
        "// Line_Reference 183:         try {",
        "// Line_Reference 184:             return isBlank(encryptedPassword) ? null : this.goCipher.decrypt(encryptedPassword);",
        "// Line_Reference 185:         } catch (CryptoException e) {",
        "// Line_Reference 186:             throw new RuntimeException(\"Could not decrypt the password to get the real password\", e);",
        "// Line_Reference 187:         }",
        "// Line_Reference 188:     }",
        "// Line_Reference 189: "
    ]
}
