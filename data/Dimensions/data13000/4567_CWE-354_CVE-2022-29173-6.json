{
    "cve_id": "CVE-2022-29173",
    "cve_description": "go-tuf is a Go implementation of The Update Framework (TUF). go-tuf does not correctly implement the client workflow for updating the metadata files for roles other than the root role. Specifically, checks for rollback attacks are not implemented correctly meaning an attacker can cause clients to install software that is older than the software which the client previously knew to be available, and may include software with known vulnerabilities. In more detail, the client code of go-tuf has several issues in regards to preventing rollback attacks: 1. It does not take into account the content of any previously trusted metadata, if available, before proceeding with updating roles other than the root role (i.e., steps 5.4.3.1 and 5.5.5 of the detailed client workflow). This means that any form of version verification done on the newly-downloaded metadata is made using the default value of zero, which always passes. 2. For both timestamp and snapshot roles, go-tuf saves these metadata files as trusted before verifying if the version of the metafiles they refer to is correct (i.e., steps 5.5.4 and 5.6.4 of the detailed client workflow). A fix is available in version 0.3.0 or newer. No workarounds are known for this issue apart from upgrading.",
    "cve_publish_date": "2022-05-05",
    "cwe_id": "CWE-354",
    "cwe_name": "Improper Validation of Integrity Check Value",
    "cwe_description": "The product does not validate or incorrectly validates the integrity check values or \"checksums\" of a message. This may prevent it from detecting if the data has been modified or corrupted in transmission.",
    "commit_message": "Merge pull request from GHSA-66x3-6cw3-v5gj\n\n* Remove obsolete snapshot error check\n\nSigned-off-by: Radoslav Dimitrov <dimitrovr@vmware.com>\n\n* Add a dedicated error for missing target metadata file\n\nSigned-off-by: Radoslav Dimitrov <dimitrovr@vmware.com>\n\n* Fix protection against metadata rollback attacks\n\nThe go-tuf client now loads any previously trusted metadata before\nproceeding with the update process. This is mandatory for the\nprotection against rollback attacks. It also fixes the detailed order\nof operations necessary to implement such protection.\n\nSigned-off-by: Radoslav Dimitrov <dimitrovr@vmware.com>\n\n* Don't abort the update process if loading trusted metadata fails\n\nSigned-off-by: Radoslav Dimitrov <dimitrovr@vmware.com>\n\n* Update getLocalMeta so it tries loading every verified metadata file\n\nIf some of the metadata files fail to load, getLocalMeta will proceed\nwith trying to load the rest, but still return an error at the end,\nif such occurred.\n\nSigned-off-by: Radoslav Dimitrov <dimitrovr@vmware.com>\n\n* Revert the preliminary targets.json download check\n\nSigned-off-by: Radoslav Dimitrov <dimitrovr@vmware.com>\n\n* Use current instead of old when addressing metadata\n\nSigned-off-by: Radoslav Dimitrov <dimitrovr@vmware.com>\n\n* Timestamp metadata do not require hashes and lenght being present\n\nSigned-off-by: Radoslav Dimitrov <dimitrovr@vmware.com>\n\n* fix: reload local meta based on the latest root\n\nClear the in-memory copy of the local metadata. The goal is to reload\nand take into account only the metadata files that are verified by\nthe latest root. Otherwise, their content should be ignored.\n\nSigned-off-by: Radoslav Dimitrov <dimitrovr@vmware.com>\n\n* fix: update client unit tests for cases where metadata is now invalidated\n\nSigned-off-by: Radoslav Dimitrov <dimitrovr@vmware.com>\n\n* chore: clarify the case where targets rollback verification will be skipped\n\nSigned-off-by: Radoslav Dimitrov <dimitrovr@vmware.com>\n\n* chore: update getLocalMeta() description\n\nSigned-off-by: Radoslav Dimitrov <dimitrovr@vmware.com>\n\n* chore: simplify getLocalMeta() so it wraps the inner error upon failure\n\nSigned-off-by: Radoslav Dimitrov <dimitrovr@vmware.com>\n\n* chore: remove unused ErrLoadLocalFailed error type\n\nSigned-off-by: Radoslav Dimitrov <dimitrovr@vmware.com>\n\n* chore: improve code layout for decodeSnapshot()\n\nSigned-off-by: Radoslav Dimitrov <dimitrovr@vmware.com>",
    "type_of_change": "Modification",
    "filename_of_changes": "util.go",
    "code_language": "Go",
    "number_of_lines_added_for_mitigation": "13",
    "number_of_lines_deleted_vulnerable_to_cve": "8",
    "vulnerable_lines": [
        "// Line_Reference 121: ",
        "// Line_Reference 127: ",
        "// Line_Reference 140: \t// As opposed to snapshots, the length and hashes are still required in",
        "// Line_Reference 141: \t// TUF-1.0. See:",
        "// Line_Reference 142: \t// https://github.com/theupdateframework/specification/issues/38",
        "// Line_Reference 143: \tif err := FileMetaEqual(actual.FileMeta, expected.FileMeta); err != nil {",
        "// Line_Reference 144: \t\treturn err",
        "// Line_Reference 146: "
    ]
}
