{
    "cve_id": "CVE-2017-12978",
    "cve_description": "lib/html.php in Cacti before 1.1.18 has XSS via the title field of an external link added by an authenticated user.",
    "cve_publish_date": "2017-08-21",
    "cwe_id": "CWE-79",
    "cwe_name": "Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting')",
    "cwe_description": "The product does not neutralize or incorrectly neutralizes user-controllable input before it is placed in output that is used as a web page that is served to other users.",
    "commit_message": "Resolving Issue #918\n\nMinor XSS and create generalized escape function",
    "type_of_change": "Modification",
    "filename_of_changes": "html.php",
    "code_language": "PHP",
    "number_of_lines_added_for_mitigation": "50",
    "number_of_lines_deleted_vulnerable_to_cve": "40",
    "vulnerable_lines": [
        "// Line_Reference 54: \t\tprint \"<div class='cactiTableButton'><span>\" . ($add_text != '' ? \"<a class='linkOverDark' href='\" . htmlspecialchars($add_text) . \"'>\" . $add_label . '</a>':'') . '</span></div>';",
        "// Line_Reference 135: \t\t\t\t\t\t\t<?php print (read_user_setting('show_graph_title') == 'on' ? \"<span class='center'>\" . htmlspecialchars($graph['title_cache']) . '</span>' : '');?>",
        "// Line_Reference 250: \t\t\t\t\t\t\t<?php print (read_user_setting('show_graph_title') == 'on' ? \"<span class='center'>\" . htmlspecialchars($graph['title_cache']) . '</span>' : '');?>",
        "// Line_Reference 506: \t\t\tprint '<th ' . ($tip != '' ? \"title='\" . htmlspecialchars($tip, ENT_QUOTES, 'UTF-8') . \"'\":'') . \" class='$nohide $align' \" . ((($i+1) == count($header_items)) ? \"colspan='$last_item_colspan' \" : '') . '>' . $display_text . \"</th>\\n\";",
        "// Line_Reference 508: \t\t\tprint '<th ' . ($tip != '' ? \"title='\" . htmlspecialchars($tip, ENT_QUOTES, 'UTF-8') . \"'\":'') . \" class='sortable $align $nohide $isSort'>\";",
        "// Line_Reference 509: \t\t\tprint \"<div class='sortinfo' sort-page='\" . ($url == '' ? htmlspecialchars(get_current_page(false)):$url) . \"' sort-column='$db_column' sort-direction='$direction'><div class='textSubHeaderDark'>\" . $display_text . \"<i class='$icon'></i></div></div></th>\\n\";",
        "// Line_Reference 667: \t\t\tprint '<th ' . ($tip != '' ? \"title='\" . htmlspecialchars($tip, ENT_QUOTES, 'UTF-8') . \"'\":'') . \" class='$align $nohide'>\" . $display_text . \"</th>\\n\";",
        "// Line_Reference 669: \t\t\tprint '<th ' . ($tip != '' ? \"title='\" . htmlspecialchars($tip, ENT_QUOTES, 'UTF-8') . \"'\":'') . \" class='sortable $align $nohide $isSort'>\";",
        "// Line_Reference 670: \t\t\tprint \"<div class='sortinfo' sort-page='\" . htmlspecialchars($form_action, ENT_QUOTES, 'UTF-8') . \"' sort-column='$db_column' sort-direction='$direction'><div class='textSubHeaderDark'>\" . $display_text . \"<i class='$icon'></i></div></div></th>\\n\";",
        "// Line_Reference 781: \t\t\t\tprint '<option value=\"' . htmlspecialchars($id, ENT_QUOTES, 'UTF-8') . '\"';",
        "// Line_Reference 787: \t\t\t\tprint '>' . title_trim(null_out_substitutions(htmlspecialchars($form_data[$id])), 75) . \"</option>\\n\";",
        "// Line_Reference 793: \t\t\t\tprint \"<option value='\" . htmlspecialchars($row[$column_id], ENT_QUOTES, 'UTF-8') . \"'\";",
        "// Line_Reference 800: \t\t\t\t\tprint '>' . title_trim(htmlspecialchars($row[$column_display]), 75) . \"</option>\\n\";",
        "// Line_Reference 802: \t\t\t\t\tprint '>' . title_trim(null_out_substitutions(htmlspecialchars($row[$column_display])), 75) . \"</option>\\n\";",
        "// Line_Reference 810: \treturn htmlspecialchars(get_request_var($string), ENT_QUOTES, 'UTF-8');",
        "// Line_Reference 827: \t\t\t\tif (substr($string, $length-$i, 1) == \" \") {",
        "// Line_Reference 828: \t\t\t\t\t$new_string .= substr($string, 0, $length-$i) . \"<br>\";",
        "// Line_Reference 901: \t\t\tif ($disable_controls == false) { print \"<a class='linkEditMain' href='\" . htmlspecialchars(\"$filename?action=item_edit&id=\" . $item['id'] . \"&$url_data\") . \"'>\"; }",
        "// Line_Reference 936: \t\t\tprint \"<td style='$this_row_style'>\" . htmlspecialchars($matrix_title) . $hard_return . '</td>';",
        "// Line_Reference 965: \t\t\t\t\tprint \"<a class='moveArrow fa fa-caret-down' title='\" . __esc('Move Down'). \"' href='\" . htmlspecialchars(\"$filename?action=item_movedown&id=\" . $item[\"id\"] . \"&$url_data\") . \"'></a>\\n\";",
        "// Line_Reference 970: \t\t\t\t\tprint \"<a class='moveArrow fa fa-caret-up' title='\" . __esc('Move Up') . \"' href='\" . htmlspecialchars(\"$filename?action=item_moveup&id=\" . $item[\"id\"] . \"&$url_data\") . \"'></a>\\n\";",
        "// Line_Reference 976: \t\t\t\tprint \"<td style='text-align:right;'><a class='deleteMarker fa fa-remove' title='\" . __esc('Delete') . \"' href='\" . htmlspecialchars(\"$filename?action=item_remove&id=\" . $item[\"id\"] . \"&$url_data\") . \"'></a></td>\\n\";",
        "// Line_Reference 1111: \t\t\t\t\t\t\t\t\tprint \"<li><a role='menuitem' class='pic selected' href='\" . htmlspecialchars($item_sub_url) . \"'>$item_sub_title</a></li>\\n\";",
        "// Line_Reference 1113: \t\t\t\t\t\t\t\t\tprint \"<li><a role='menuitem' class='pic' href='\" . htmlspecialchars($item_sub_url) . \"'>$item_sub_title</a></li>\\n\";",
        "// Line_Reference 1125: \t\t\t\t\t\t\tprint \"<li><a role='menuitem' class='pic selected' href='\" . htmlspecialchars($item_url) . \"'>$item_title</a></li>\\n\";",
        "// Line_Reference 1127: \t\t\t\t\t\t\tprint \"<li><a role='menuitem' class='pic' href='\" . htmlspecialchars($item_url) . \"'>$item_title</a></li>\\n\";",
        "// Line_Reference 1314: \t\t\t\t\tprint \"<a id='maintab-anchor\" . rand() . \"' class='selected' href='\" . htmlspecialchars($config['url_path'] . 'graph_view.php') . \"'><img src='\" . $config['url_path'] . \"images/tab_graphs_down.gif' alt='\" . __('Graphs') . \"'></a>\";",
        "// Line_Reference 1316: \t\t\t\t\tprint \"<a href='\" . htmlspecialchars($config['url_path'] . 'graph_view.php') . \"'><img src='\" . $config['url_path'] . \"images/tab_graphs.gif' alt='\" . __('Graphs') . \"'></a>\";",
        "// Line_Reference 1519: \t\t\tprint \"<li><a id='\" . (isset($tab['id']) ? $tab['id'] : 'maintab-anchor-' . $i) . \"' class='lefttab\" . (isset($tab['selected']) ? ' selected':'') . \"' href='\" . $tab['url'] . \"'>\" . $tab['title'] . \"</a></li>\\n\";",
        "// Line_Reference 1534: \t\t\t?><a class='righttab' id='treeview' href='<?php print htmlspecialchars($config['url_path'] . 'graph_view.php?action=tree');?>'><img src='<?php echo $config['url_path']; ?>images/tab_mode_tree<?php",
        "// Line_Reference 1541: \t\t\t?><a class='righttab' id='listview' href='<?php print htmlspecialchars($config['url_path'] . 'graph_view.php?action=list');?>'><img src='<?php echo $config['url_path']; ?>images/tab_mode_list<?php",
        "// Line_Reference 1548: \t\t\t?><a class='righttab' id='preview' href='<?php print htmlspecialchars($config['url_path'] . 'graph_view.php?action=preview');?>'><img src='<?php echo $config['url_path']; ?>images/tab_mode_preview<?php",
        "// Line_Reference 1610: \t\t\t\t\tprint \"<li role='tab'><a id='treeview' title='\" . htmlspecialchars($tab['title'], ENT_QUOTES, 'UTF-8') . \"' class='righttab \" . (isset($tab['selected']) ? 'selected':'') . \"' href='\" . $tab['url'] . \"'><img src='\" . $config['url_path'] . $tab['image'] . \"' alt='' style='vertical-align:bottom;'></a></li>\\n\";",
        "// Line_Reference 1612: \t\t\t\t\tprint \"<li role='tab'><a title='\" . htmlspecialchars($tab['title'], ENT_QUOTES, 'UTF-8') . \"' class='righttab \" . (isset($tab['selected']) ? 'selected':'') . \"' href='\" . $tab['url'] . \"'>\" . $tab['title'] . \"</a></li>\\n\";",
        "// Line_Reference 1617: \t\t\t\t\tprint \"<li role='tab'><a id='listview' title='\" . htmlspecialchars($tab['title'], ENT_QUOTES, 'UTF-8') . \"' class='righttab \" . (isset($tab['selected']) ? 'selected':'') . \"' href='\" . $tab['url'] . \"'><img src='\" . $config['url_path'] . $tab['image'] . \"' alt='' style='vertical-align:bottom;'></a></li>\\n\";",
        "// Line_Reference 1619: \t\t\t\t\tprint \"<li role='tab'><a title='\" . htmlspecialchars($tab['title'], ENT_QUOTES, 'UTF-8') . \"' class='righttab \" . (isset($tab['selected']) ? 'selected':'') . \"' href='\" . $tab['url'] . \"'>\" . $tab['title'] . \"</a></li>\\n\";",
        "// Line_Reference 1625: \t\t\t\t\tprint \"<li role='tab'><a id='preview' title='\" . htmlspecialchars($tab['title'], ENT_QUOTES, 'UTF-8') . \"' class='righttab \" . (isset($tab['selected']) ? 'selected':'') . \"' href='\" . $tab['url'] . \"'><img src='\" . $config['url_path'] . $tab['image'] . \"' alt='' style='vertical-align:bottom;'></a></li>\\n\";",
        "// Line_Reference 1627: \t\t\t\t\tprint \"<li role='tab'><a title='\" . htmlspecialchars($tab['title'], ENT_QUOTES, 'UTF-8') . \"' class='righttab \" . (isset($tab['selected']) ? 'selected':'') . \"' href='\" . $tab['url'] . \"'>\" . $tab['title'] . \"</a></li>\\n\";",
        "// Line_Reference 1659: \t\t\t\t\t\tprint \"<option value='\" . $device['id'] . \"'\"; if (get_request_var('host_id') == $device['id']) { print ' selected'; } print '>' . title_trim(htmlspecialchars($device['description'] . ' (' . $device['hostname'] . ')'), 40) . \"</option>\\n\";",
        "// Line_Reference 1682: \t\t\t\t<input size='28' id='host' value='<?php print htmlspecialchars($hostname, ENT_QUOTES, 'UTF-8');?>'>"
    ]
}
