{
    "cve_id": "CVE-2021-21318",
    "cve_description": "Opencast is a free, open-source platform to support the management of educational audio and video content. In Opencast before version 9.2 there is a vulnerability in which publishing an episode with strict access rules will overwrite the currently set series access. This allows for an easy denial of access for all users without superuser privileges, effectively hiding the series. Access to series and series metadata on the search service (shown in media module and player) depends on the events published which are part of the series. Publishing an event will automatically publish a series and update access to it. Removing an event or republishing the event should do the same. Affected versions of Opencast may not update the series access or remove a published series if an event is being removed. On removal of an episode, this may lead to an access control list for series metadata with broader access rules than the merged access rules of all remaining events, or the series metadata still being available although all episodes of that series have been removed. This problem is fixed in Opencast 9.2.",
    "cve_publish_date": "2021-02-18",
    "cwe_id": "CWE-863",
    "cwe_name": "Incorrect Authorization",
    "cwe_description": "The product performs an authorization check when an actor attempts to access a resource or perform an action, but it does not correctly perform the check. This allows attackers to bypass intended access restrictions.",
    "commit_message": "Fix Engage Series Publication and Access\n\nAccess to series and series metadata on the search service (shown in\nmedia module and player) depends on the events published which are part\nof the series. Publishing an event will automatically publish a series\nand update access to it. Removing an event or republishing the event\nshould do the same.\n\nIncorrectly Hiding Public Series\n--------------------------------\n\nThis patch fixes the access control update to the series when a new\nepisode is being published. Until now, a new episode publication would\nalways update the series access with the episode access.\n\nWhile this is no security issue since it can only cause the access to be\nstricter, it may cause public series to become private. This would\nhappen, for example, if a users sets one episode of a series to private\nand republishes the episode.\n\nNow, the search service will merge the access control lists of all\nepisodes to grant access based on their combined access rules.\n\nUpdate Series on Removal\n------------------------\n\nThis patch fixes Opencast not updating the series access or remove a\npublished series if an event is being removed.\n\nThis means that access to a series is re-calculated when an episode is\nbeing deleted based on the remaining published episodes in the series.\nFor example, removing the last episode with public access will now make\nthe series private which it would have stayed public before.\n\nIt also means that if the last episode of a series is being removed, the\nseries itself will be unpublished as well, so no empty series will\ncontinue to show up any longer.",
    "type_of_change": "Modification",
    "filename_of_changes": "SearchServiceImpl.java",
    "code_language": "Java",
    "number_of_lines_added_for_mitigation": "35",
    "number_of_lines_deleted_vulnerable_to_cve": "19",
    "vulnerable_lines": [
        "// Line_Reference 376:    * @throws MediaPackageException",
        "// Line_Reference 377:    *           if the mediapckage is invalid",
        "// Line_Reference 383:   public void addSynchronously(MediaPackage mediaPackage) throws SearchException, MediaPackageException,",
        "// Line_Reference 384:           IllegalArgumentException, UnauthorizedException {",
        "// Line_Reference 388:     logger.debug(\"Attempting to add mediapackage {} to search index\", mediaPackage.getIdentifier());",
        "// Line_Reference 394:       if (indexManager.add(mediaPackage, acl, now)) {",
        "// Line_Reference 395:         logger.info(\"Added mediapackage `{}` to the search index, using ACL `{}`\", mediaPackage, acl);",
        "// Line_Reference 397:         logger.warn(\"Failed to add mediapackage {} to the search index\", mediaPackage.getIdentifier());",
        "// Line_Reference 406:       logger.error(\"Could not store media package to search database {}: {}\", mediaPackage.getIdentifier(), e);",
        "// Line_Reference 407:       throw new SearchException(e);",
        "// Line_Reference 432:    * @throws UnauthorizedException",
        "// Line_Reference 433:    *           if the user did not have access to the media package",
        "// Line_Reference 434:    * @throws NotFoundException",
        "// Line_Reference 435:    *           if the mediapackage did not exist",
        "// Line_Reference 437:   public boolean deleteSynchronously(String mediaPackageId) throws SearchException, UnauthorizedException,",
        "// Line_Reference 438:           NotFoundException {",
        "// Line_Reference 448:       logger.info(\"Removing mediapackage {} from search index\", mediaPackageId);",
        "// Line_Reference 463:       return indexManager.delete(mediaPackageId, now);",
        "// Line_Reference 464:     } catch (SolrServerException e) {"
    ]
}
