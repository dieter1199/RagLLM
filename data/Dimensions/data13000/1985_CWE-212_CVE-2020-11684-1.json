{
    "cve_id": "CVE-2020-11684",
    "cve_description": "AT91bootstrap before 3.9.2 does not properly wipe encryption and authentication keys from memory before passing control to a less privileged software component. This can be exploited to disclose these keys and subsequently encrypt and sign the next boot stage (such as the bootloader).",
    "cve_publish_date": "2020-09-14",
    "cwe_id": "CWE-212",
    "cwe_name": "Improper Removal of Sensitive Information Before Storage or Transfer",
    "cwe_description": "The product stores, transfers, or shares a resource that contains sensitive information, but it does not properly remove that information before the product makes the resource available to unauthorized actors.",
    "commit_message": "driver: secure: move keys into static arrays\n\nMove the keys into static arrays. This will avoid copying the keys\nfrom the code section to the stack on the previous init_keys implementation.\nLike this, the keys are hardcoded into data section at compile time,\nand can be completely wiped after use.\n\nSigned-off-by: Eugen Hristev <eugen.hristev@microchip.com>\nTested-by: Nicolas Ferre <nicolas.ferre@microchip.com>",
    "type_of_change": "Modification",
    "filename_of_changes": "secure.c",
    "code_language": "C",
    "number_of_lines_added_for_mitigation": "53",
    "number_of_lines_deleted_vulnerable_to_cve": "48",
    "vulnerable_lines": [
        "// Line_Reference 35: ",
        "// Line_Reference 36: static inline void init_keys(at91_aes_key_size_t *key_size,",
        "// Line_Reference 37: \t\t\t     unsigned int *cipher_key,",
        "// Line_Reference 38: \t\t\t     unsigned int *cmac_key,",
        "// Line_Reference 39: \t\t\t     unsigned int *iv)",
        "// Line_Reference 40: {",
        "// Line_Reference 41: #if defined(CONFIG_AES_KEY_SIZE_128)",
        "// Line_Reference 42: \t*key_size = AT91_AES_KEY_SIZE_128;",
        "// Line_Reference 43: #elif defined(CONFIG_AES_KEY_SIZE_192)",
        "// Line_Reference 44: \t*key_size = AT91_AES_KEY_SIZE_192;",
        "// Line_Reference 45: #elif defined(CONFIG_AES_KEY_SIZE_256)",
        "// Line_Reference 46: \t*key_size = AT91_AES_KEY_SIZE_256;",
        "// Line_Reference 47: #else",
        "// Line_Reference 48: #error \"bad AES key size\"",
        "// Line_Reference 51: \tiv[0]\t\t= CONFIG_AES_IV_WORD0;",
        "// Line_Reference 52: \tiv[1]\t\t= CONFIG_AES_IV_WORD1;",
        "// Line_Reference 53: \tiv[2]\t\t= CONFIG_AES_IV_WORD2;",
        "// Line_Reference 54: \tiv[3]\t\t= CONFIG_AES_IV_WORD3;",
        "// Line_Reference 55: ",
        "// Line_Reference 56: \tcipher_key[0]\t= CONFIG_AES_CIPHER_KEY_WORD0;",
        "// Line_Reference 57: \tcmac_key[0]\t= CONFIG_AES_CMAC_KEY_WORD0;",
        "// Line_Reference 58: \tcipher_key[1]\t= CONFIG_AES_CIPHER_KEY_WORD1;",
        "// Line_Reference 59: \tcmac_key[1]\t= CONFIG_AES_CMAC_KEY_WORD1;",
        "// Line_Reference 60: \tcipher_key[2]\t= CONFIG_AES_CIPHER_KEY_WORD2;",
        "// Line_Reference 61: \tcmac_key[2]\t= CONFIG_AES_CMAC_KEY_WORD2;",
        "// Line_Reference 62: \tcipher_key[3]\t= CONFIG_AES_CIPHER_KEY_WORD3;",
        "// Line_Reference 63: \tcmac_key[3]\t= CONFIG_AES_CMAC_KEY_WORD3;",
        "// Line_Reference 64: ",
        "// Line_Reference 66: \tcipher_key[4]\t= CONFIG_AES_CIPHER_KEY_WORD4;",
        "// Line_Reference 67: \tcmac_key[4]\t= CONFIG_AES_CMAC_KEY_WORD4;",
        "// Line_Reference 68: \tcipher_key[5]\t= CONFIG_AES_CIPHER_KEY_WORD5;",
        "// Line_Reference 69: \tcmac_key[5]\t= CONFIG_AES_CMAC_KEY_WORD5;",
        "// Line_Reference 71: ",
        "// Line_Reference 73: \tcipher_key[6]\t= CONFIG_AES_CIPHER_KEY_WORD6;",
        "// Line_Reference 74: \tcmac_key[6]\t= CONFIG_AES_CMAC_KEY_WORD6;",
        "// Line_Reference 75: \tcipher_key[7]\t= CONFIG_AES_CIPHER_KEY_WORD7;",
        "// Line_Reference 76: \tcmac_key[7]\t= CONFIG_AES_CMAC_KEY_WORD7;",
        "// Line_Reference 78: }",
        "// Line_Reference 80: int secure_decrypt(void *data, unsigned int data_length, int is_signed)",
        "// Line_Reference 83: \tunsigned int cmac_key[8], cipher_key[8];",
        "// Line_Reference 84: \tunsigned int iv[AT91_AES_IV_SIZE_WORD];",
        "// Line_Reference 90: \t/* Init keys */",
        "// Line_Reference 91: \tinit_keys(&key_size, cipher_key, cmac_key, iv);",
        "// Line_Reference 124: ",
        "// Line_Reference 125: \treturn rc;",
        "// Line_Reference 134: \t\treturn -1;",
        "// Line_Reference 138: \t\treturn -1;",
        "// Line_Reference 141: \treturn secure_decrypt(file, header->file_size, 1);"
    ]
}
