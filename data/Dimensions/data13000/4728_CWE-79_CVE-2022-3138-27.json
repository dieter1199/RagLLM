{
    "cve_id": "CVE-2022-3138",
    "cve_description": "Cross-site Scripting (XSS) - Generic in GitHub repository jgraph/drawio prior to 20.3.0.",
    "cve_publish_date": "2022-09-08",
    "cwe_id": "CWE-79",
    "cwe_name": "Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting')",
    "cwe_description": "The product does not neutralize or incorrectly neutralizes user-controllable input before it is placed in output that is used as a web page that is served to other users.",
    "commit_message": "20.3.0 release",
    "type_of_change": "Modification",
    "filename_of_changes": "App.js",
    "code_language": "JavaScript",
    "number_of_lines_added_for_mitigation": "103",
    "number_of_lines_deleted_vulnerable_to_cve": "128",
    "vulnerable_lines": [
        "// Line_Reference 749: \t\t\t\t// Loading plugins inside the asynchronous block below stops the page from loading so a",
        "// Line_Reference 750: \t\t\t\t// hardcoded message for the warning dialog is used since the resources are loadd below",
        "// Line_Reference 751: \t\t\t\tvar warning = 'The page has requested to load the following plugin(s):\\n \\n {1}\\n \\n Would you like to load these plugin(s) now?\\n \\n NOTE : Only allow plugins to run if you fully understand the security implications of doing so.\\n';",
        "// Line_Reference 752: \t\t\t\tvar tmp = window.location.protocol + '//' + window.location.host;",
        "// Line_Reference 753: \t\t\t\tvar local = true;",
        "// Line_Reference 754: ",
        "// Line_Reference 755: \t\t\t\tfor (var i = 0; i < plugins.length && local; i++)",
        "// Line_Reference 756: \t\t\t\t{",
        "// Line_Reference 757: \t\t\t\t\tif (plugins[i].charAt(0) != '/' && plugins[i].substring(0, tmp.length) != tmp)",
        "// Line_Reference 758: \t\t\t\t\t{",
        "// Line_Reference 759: \t\t\t\t\t\tlocal = false;",
        "// Line_Reference 760: \t\t\t\t\t}",
        "// Line_Reference 761: \t\t\t\t}",
        "// Line_Reference 762: ",
        "// Line_Reference 763: \t\t\t\tif (local || mxUtils.confirm(mxResources.replacePlaceholders(warning, [plugins.join('\\n')]).replace(/\\\\n/g, '\\n')))",
        "// Line_Reference 765: \t\t\t\t\tfor (var i = 0; i < plugins.length; i++)",
        "// Line_Reference 767: \t\t\t\t\t\ttry",
        "// Line_Reference 769: \t\t\t\t\t\t\tif (App.pluginsLoaded[plugins[i]] == null)",
        "// Line_Reference 771: \t\t\t\t\t\t\t\tApp.pluginsLoaded[plugins[i]] = true;",
        "// Line_Reference 772: \t\t\t\t\t\t\t\tApp.embedModePluginsCount++;",
        "// Line_Reference 773: ",
        "// Line_Reference 774: \t\t\t\t\t\t\t\tif (plugins[i].charAt(0) == '/')",
        "// Line_Reference 775: \t\t\t\t\t\t\t\t{",
        "// Line_Reference 776: \t\t\t\t\t\t\t\t\tplugins[i] = PLUGINS_BASE_PATH + plugins[i];",
        "// Line_Reference 777: \t\t\t\t\t\t\t\t}",
        "// Line_Reference 778: ",
        "// Line_Reference 779: \t\t\t\t\t\t\t\tmxscript(plugins[i]);",
        "// Line_Reference 782: \t\t\t\t\t\tcatch (e)",
        "// Line_Reference 784: \t\t\t\t\t\t\t// ignore",
        "// Line_Reference 832: \t\t\t\t\tvar trustedPlugins = {};",
        "// Line_Reference 833: ",
        "// Line_Reference 834: \t\t\t\t\tfor (var key in App.pluginRegistry)",
        "// Line_Reference 835: \t\t\t\t\t{",
        "// Line_Reference 836: \t\t\t\t\t\ttrustedPlugins[App.pluginRegistry[key]] = true;",
        "// Line_Reference 837: \t\t\t\t\t}",
        "// Line_Reference 838: ",
        "// Line_Reference 839: \t\t\t\t\t// Only allows trusted plugins",
        "// Line_Reference 840: \t\t\t\t\tfunction checkPlugins(plugins)",
        "// Line_Reference 841: \t\t\t\t\t{",
        "// Line_Reference 842: \t\t\t\t\t\tif (plugins != null)",
        "// Line_Reference 843: \t\t\t\t\t\t{",
        "// Line_Reference 844: \t\t\t\t\t\t\tfor (var i = 0; i < plugins.length; i++)",
        "// Line_Reference 845: \t\t\t\t\t\t\t{",
        "// Line_Reference 846: \t\t\t\t\t\t\t\tif (!trustedPlugins[plugins[i]])",
        "// Line_Reference 847: \t\t\t\t\t\t\t\t{",
        "// Line_Reference 848: \t\t\t\t\t\t\t\t\tthrow new Error(mxResources.get('invalidInput') + ' \"' + plugins[i]) + '\"';",
        "// Line_Reference 849: \t\t\t\t\t\t\t\t}",
        "// Line_Reference 850: \t\t\t\t\t\t\t}",
        "// Line_Reference 851: \t\t\t\t\t\t}",
        "// Line_Reference 852: ",
        "// Line_Reference 853: \t\t\t\t\t\treturn true;",
        "// Line_Reference 854: \t\t\t\t\t};",
        "// Line_Reference 855: ",
        "// Line_Reference 858: \t\t\t\t\tif (value != null && checkPlugins(value.plugins))",
        "// Line_Reference 868: ",
        "// Line_Reference 1126: \t\t\t\t\t\tEditor.configure(data.config, true);",
        "// Line_Reference 1291: \t\t\t\tvar url = PLUGINS_BASE_PATH + App.pluginRegistry[plugins[i]];",
        "// Line_Reference 1292: ",
        "// Line_Reference 1293: \t\t\t\tif (url != null)",
        "// Line_Reference 2099: \tif (lic != null && lic.plugins != null)",
        "// Line_Reference 2100: \t{",
        "// Line_Reference 2101: \t\tApp.loadPlugins(lic.plugins.split(';'), true);",
        "// Line_Reference 2102: \t}",
        "// Line_Reference 5731: ",
        "// Line_Reference 5734: \t\t\tif (uiTheme == 'atlas' || urlParams['atlas'] == '1')",
        "// Line_Reference 5735: \t\t\t{",
        "// Line_Reference 5736: \t\t\t\tthis.buttonContainer.style.paddingRight = '12px';",
        "// Line_Reference 5737: \t\t\t\tthis.buttonContainer.style.paddingTop = '6px';",
        "// Line_Reference 5738: \t\t\t\tthis.buttonContainer.style.right = urlParams['noLangIcon'] == '1'? '0' : '25px';",
        "// Line_Reference 5739: \t\t\t}",
        "// Line_Reference 5740: \t\t\telse if (uiTheme != 'min')",
        "// Line_Reference 5741: \t\t\t{",
        "// Line_Reference 5742: \t\t\t\tthis.buttonContainer.style.paddingRight = '38px';",
        "// Line_Reference 5743: \t\t\t\tthis.buttonContainer.style.paddingTop = '6px';",
        "// Line_Reference 5744: \t\t\t}",
        "// Line_Reference 6854: \t\tthis.toggleFormatElement.style.right = (uiTheme != 'atlas' && urlParams['embed'] != '1') ? '30px' : '10px';",
        "// Line_Reference 6895: \t\tthis.fullscreenElement = document.createElement('a');",
        "// Line_Reference 6897: \t\tthis.fullscreenElement.style.position = 'absolute';",
        "// Line_Reference 6898: \t\tthis.fullscreenElement.style.display = 'inline-block';",
        "// Line_Reference 6899: \t\tthis.fullscreenElement.style.top = (uiTheme == 'atlas') ? '8px' : '6px';",
        "// Line_Reference 6900: \t\tthis.fullscreenElement.style.right = (uiTheme != 'atlas' && urlParams['embed'] != '1') ? '50px' : '30px';",
        "// Line_Reference 6901: \t\tthis.fullscreenElement.style.padding = '2px';",
        "// Line_Reference 6902: \t\tthis.fullscreenElement.style.fontSize = '14px';",
        "// Line_Reference 6903: \t\tthis.fullscreenElement.className = (uiTheme != 'atlas') ? 'geButton geAdaptiveAsset' : '';",
        "// Line_Reference 6904: \t\tthis.fullscreenElement.style.width = '16px';",
        "// Line_Reference 6905: \t\tthis.fullscreenElement.style.height = '16px';",
        "// Line_Reference 6906: \t\tthis.fullscreenElement.style.backgroundPosition = '50% 50%';",
        "// Line_Reference 6907: \t\tthis.fullscreenElement.style.backgroundSize = '16px 16px';",
        "// Line_Reference 6908: \t\tthis.fullscreenElement.style.backgroundRepeat = 'no-repeat';",
        "// Line_Reference 6919: \t\tif (uiTheme != 'atlas')",
        "// Line_Reference 6921: \t\t\tthis.darkModeElement = document.createElement('a');",
        "// Line_Reference 6923: \t\t\tthis.darkModeElement.style.position = 'absolute';",
        "// Line_Reference 6924: \t\t\tthis.darkModeElement.style.display = 'inline-block';",
        "// Line_Reference 6925: \t\t\tthis.darkModeElement.style.top = (uiTheme == 'atlas') ? '8px' : '6px';",
        "// Line_Reference 6926: \t\t\tthis.darkModeElement.style.right = (uiTheme != 'atlas' && urlParams['embed'] != '1') ? '70px' : '50px';",
        "// Line_Reference 6927: \t\t\tthis.darkModeElement.style.padding = '2px';",
        "// Line_Reference 6928: \t\t\tthis.darkModeElement.style.fontSize = '14px';",
        "// Line_Reference 6929: \t\t\tthis.darkModeElement.className = (uiTheme != 'atlas') ? 'geButton geAdaptiveAsset' : '';",
        "// Line_Reference 6930: \t\t\tthis.darkModeElement.style.width = '16px';",
        "// Line_Reference 6931: \t\t\tthis.darkModeElement.style.height = '16px';",
        "// Line_Reference 6932: \t\t\tthis.darkModeElement.style.backgroundPosition = '50% 50%';",
        "// Line_Reference 6933: \t\t\tthis.darkModeElement.style.backgroundSize = '16px 16px';",
        "// Line_Reference 6934: \t\t\tthis.darkModeElement.style.backgroundRepeat = 'no-repeat';",
        "// Line_Reference 6939: \t\t\t\tthis.darkModeElement.style.backgroundImage = 'url(\\'' + ((Editor.isDarkMode()) ?",
        "// Line_Reference 6950: \t\t\t\tthis.actions.get('toggleDarkMode').funct();",
        "// Line_Reference 6963: ",
        "// Line_Reference 6964: \t\tmxEvent.addListener(this.fullscreenElement, 'click', mxUtils.bind(this, function(evt)",
        "// Line_Reference 6965: \t\t{",
        "// Line_Reference 6966: \t\t\tvar visible = this.fullscreenMode;",
        "// Line_Reference 6967: ",
        "// Line_Reference 6968: \t\t\tEditorUi.logEvent({category: 'TOOLBAR-ACTION-',",
        "// Line_Reference 6969: \t\t\t\taction: 'fullscreen' , currentstate: visible});",
        "// Line_Reference 6970: ",
        "// Line_Reference 6971: \t\t\tif (uiTheme != 'atlas' && urlParams['embed'] != '1')",
        "// Line_Reference 6972: \t\t\t{",
        "// Line_Reference 6973: \t\t\t\tthis.toggleCompactMode(visible);",
        "// Line_Reference 6974: \t\t\t}",
        "// Line_Reference 6975: ",
        "// Line_Reference 6976: \t\t\tif (!visible)",
        "// Line_Reference 6977: \t\t\t{",
        "// Line_Reference 6978: \t\t\t\tinitialPosition = this.hsplitPosition;",
        "// Line_Reference 6979: \t\t\t}",
        "// Line_Reference 6980: ",
        "// Line_Reference 6981: \t\t\tthis.hsplitPosition = (visible) ? initialPosition : 0;",
        "// Line_Reference 6982: \t\t\tthis.toggleFormatPanel(visible);",
        "// Line_Reference 6983: \t\t\tthis.fullscreenMode = !visible;",
        "// Line_Reference 6984: \t\t\tmxEvent.consume(evt);",
        "// Line_Reference 6985: \t\t}));"
    ]
}
