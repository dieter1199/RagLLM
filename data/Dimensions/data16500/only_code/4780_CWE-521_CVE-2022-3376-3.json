flash(_("Wrong current password."), level='warning')
else:
# Clear number of attempts
if CHANGE_PASSWORD_ATTEMPTS in cherrypy.session:
del cherrypy.session[CHANGE_PASSWORD_ATTEMPTS]
# If Valid, update password
try:
user.set_password(self.new.data)
flash(_("Password updated successfully."), level='success')
except ValueError as e:
flash(str(e), level='warning')
password_form.populate_obj(self.app.currentuser)