if (data.error == "not_allowed") {
$("#change_user_functions").dialog({
bgiframe: true,
modal: true,
autoOpen: false,
width: 400,
height: 400,
title: "<?php echo $LANG['change_user_functions_title']; ?>",
buttons: {
"<?php echo $LANG['save_button']; ?>": function() {
Change_user_rights(document.getElementById("selected_user").value,"functions");
$(this).dialog("close");
},
"<?php echo $LANG['cancel_button']; ?>": function() {
$(this).dialog("close");
}
}
});
$("#change_user_autgroups").dialog({
bgiframe: true,
modal: true,
autoOpen: false,
width: 400,
height: 400,
title: "<?php echo $LANG['change_user_autgroups_title']; ?>",
buttons: {
"<?php echo $LANG['save_button']; ?>": function() {
Change_user_rights(document.getElementById("selected_user").value,"autgroups");
$(this).dialog("close");
},
"<?php echo $LANG['cancel_button']; ?>": function() {
$(this).dialog("close");
}
}
});
$("#change_user_forgroups").dialog({
bgiframe: true,
modal: true,
autoOpen: false,
width: 400,
height: 400,
title: "<?php echo $LANG['change_user_forgroups_title']; ?>",
buttons: {
"<?php echo $LANG['save_button']; ?>": function() {
Change_user_rights(document.getElementById("selected_user").value,"forgroups");
$(this).dialog("close");
},
"<?php echo $LANG['cancel_button']; ?>": function() {
$(this).dialog("close");
}
}
});;
$("#change_user_adminby").dialog({
bgiframe: true,
modal: true,
autoOpen: false,
width: 400,
height: 200,
title: "<?php echo $LANG['is_administrated_by_role']; ?>",
buttons: {
"<?php echo $LANG['save_button']; ?>": function() {
$.post(
"sources/users.queries.php",
{
type    :"change_user_adminby",
userId : $("#selected_user").val(),
isAdministratedByRole : $("#user_admin_by").val(),
key    : "<?php echo $_SESSION['key']; ?>"
},
function(data) {
if ($("#user_admin_by").val() == "0") {
$("#list_adminby_"+$("#selected_user").val()).
html("<?php echo $LANG['admin_small']; ?>");
} else {
$("#list_adminby_"+$("#selected_user").val()).
html($("#user_admin_by option:selected").text().match(/"([^"]+)"/)[1]);
}
$("#change_user_adminby").dialog("close");
}
)
},
"<?php echo $LANG['cancel_button']; ?>": function() {
$(this).dialog("close");
}
}
});
if (data[0].error == "no") {
type    : "delete_user",
id        : $("#delete_user_id").val(),
action    : $("#delete_user_action").val(),
key        : "<?php echo $_SESSION['key']; ?>"
window.location.href = "index.php?page=manage_users";
id   : $('#user_edit_id').val(),
if (data.error == "no") {
$("#user_edit_error").html("<?php echo $LANG['error_unknown']; ?>")
if (data[0].error == "no") {
// refresh table content
tableUsers.api().ajax.reload();
$("#user_management_dialog").dialog("close");
function Change_user_rights(id,type)
{
var list = "";
if (type == "functions") var form = document.forms.tmp_functions;
if (type == "autgroups") var form = document.forms.tmp_autgroups;
if (type == "forgroups") var form = document.forms.tmp_forgroups;
$("#div_loading").show();
for (i=0 ; i<= form.length-1 ; i++) {
if (form[i].type == "checkbox" && form[i].checked) {
function_id = form[i].id.split("-")
if (list == "") list = function_id[1];
else list = list + ";" + function_id[1];
}
}
$.post("sources/users.queries.php",
{
type    : "change_user_"+type,
id      : id,
list    : list,
key     : "<?php echo $_SESSION['key']; ?>"
},
function(data) {
if (type == "functions") {
$("#list_function_user_"+id).html(data[0].text);
} else if (type == "autgroups") {
$("#list_autgroups_user_"+id).html(data[0].text);
} else if (type == "forgroups") {
$("#list_forgroups_user_"+id).html(data[0].text);
}
$("#div_loading").hide();
},
"json"
);
}
