{
    "cve_id": "CVE-2017-13671",
    "cve_description": "app/View/Helper/CommandHelper.php in MISP before 2.4.79 has persistent XSS via comments. It only impacts the users of the same instance because the comment field is not part of the MISP synchronisation.",
    "cve_publish_date": "2017-08-24",
    "cwe_id": "CWE-79",
    "cwe_name": "Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting')",
    "cwe_description": "The product does not neutralize or incorrectly neutralizes user-controllable input before it is placed in output that is used as a web page that is served to other users.",
    "commit_message": "fix: Fixed a potential persistent cross site scripting in the comments\n\n- new tag parser for the comments implemented\n- Parser now cleanly pre-constructs the replacement items after finding tag pairs\n\n- This only impacts users of the same instance, as comments are not synchronised\n\n- as reported by Jurgen Jans and Cedric Van Bockhaven from Deloitte",
    "type_of_change": "Modification",
    "filename_of_changes": "CommandHelper.php",
    "code_language": "PHP",
    "number_of_lines_added_for_mitigation": "81",
    "number_of_lines_deleted_vulnerable_to_cve": "7",
    "vulnerable_lines": [
        "// Line_Reference 9: \t\tpublic function convertQuotes($string) {",
        "// Line_Reference 10: \t\t\t$string = str_ireplace('[QUOTE]', '<div class=\"quote\">', $string);",
        "// Line_Reference 11: \t\t\t$string = str_ireplace('[/QUOTE]', '</div>', $string);",
        "// Line_Reference 12: \t\t\t$string = preg_replace('%\\[event\\]\\s*(\\d*)\\s*\\[/event\\]%isU', '<a href=\"' . h(Configure::read('MISP.baseurl')). '/events/view/$1> Event $1</a>', $string);",
        "// Line_Reference 13: \t\t\t$string = preg_replace('%\\[thread\\]\\s*(\\d*)\\s*\\[/thread\\]%isU', '<a href=\"' . h(Configure::read('MISP.baseurl')). '/threads/view/$1> Thread $1</a>', $string);",
        "// Line_Reference 14: \t\t\t$string = preg_replace('%\\[link\\]\\s*(http|https|ftp|git|ftps)(.*)\\s*\\[/link\\]%isU', '<a href=\"$1$2\">$1$2</a>', $string);",
        "// Line_Reference 15: \t\t\t$string = preg_replace('%\\[code\\](.*)\\[/code\\]%isU', '<pre>$1</pre>', $string);"
    ]
}
