{
    "cve_id": "CVE-2021-27340",
    "cve_description": "OpenSIS Community Edition version <= 7.6 is affected by a reflected XSS vulnerability in EmailCheck.php via the \"opt\" parameter.",
    "cve_publish_date": "2021-09-16",
    "cwe_id": "CWE-79",
    "cwe_name": "Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting')",
    "cwe_description": "The product does not neutralize or incorrectly neutralizes user-controllable input before it is placed in output that is used as a web page that is served to other users.",
    "commit_message": "Commit with security and bug fixes",
    "type_of_change": "ModificationType.ADD",
    "filename_of_changes": "PrintRequests.php",
    "code_language": "PHP",
    "number_of_lines_added_for_mitigation": "100",
    "number_of_lines_deleted_vulnerable_to_cve": "82",
    "vulnerable_lines": [
        "// Line_Reference 4: #  openSIS is a free student information system for public and non-public",
        "// Line_Reference 7: #  openSIS is  web-based, open source, and comes packed with features that",
        "// Line_Reference 8: #  include student demographic info, scheduling, grade book, attendance,",
        "// Line_Reference 9: #  report cards, eligibility, transcripts, parent portal,",
        "// Line_Reference 10: #  student portal and more.",
        "// Line_Reference 13: #  If you have question regarding this system or the license, please send",
        "// Line_Reference 16: #  This program is released under the terms of the GNU General Public License as",
        "// Line_Reference 17: #  published by the Free Software Foundation, version 2 of the License.",
        "// Line_Reference 29: include('../../RedirectModulesInc.php');",
        "// Line_Reference 30: include('lang/language.php');",
        "// Line_Reference 44:     DrawBC(\"\"._scheduling.\" > \" . ProgramTitle());",
        "// Line_Reference 50:     $columns = array('COURSE_TITLE' => ''._course.'', 'MARKING_PERIOD_ID' => ''._markingPeriod.'', 'WITH_TEACHER_ID' => ''._withTeacher.'', 'WITH_PERIOD_ID' => ''._inPeriod.'', 'NOT_TEACHER_ID' => ''._notWithTeacher.'', 'NOT_PERIOD_ID' => ''._notInPeriod.'');",
        "// Line_Reference 66:         echo \"<tr><td width=105>\" . DrawLogo() . \"</td><td  style=\\\"font-size:15px; font-weight:bold; padding-top:20px;\\\">\" . GetSchool(UserSchool()) . \"<div style=\\\"font-size:12px;\\\">\"._studentPrintRequest.\"</div></td><td align=right style=\\\"padding-top:20px;\\\">\" . ProperDate(DBDate()) . \"<br \\>\"._poweredByOpenSis.\" openSIS</td></tr><tr><td colspan=3 style=\\\"border-top:1px solid #333;\\\">&nbsp;</td></tr></table>\";",
        "// Line_Reference 76:                     echo \"<tr><td>\"._studentID.\":</td>\";",
        "// Line_Reference 78:                     echo \"<tr><td>\"._studentName.\":</td>\";",
        "// Line_Reference 80:                     echo \"<tr><td>\"._studentGrade.\":</td>\";",
        "// Line_Reference 83:                         echo \"<tr><td>\"._studentMaillingLabel.\" :</td>\";",
        "// Line_Reference 86:                     echo'</table>';",
        "// Line_Reference 88:                     ListOutputPrint($address, $columns, _request, _requests, array(), array(), array('center' =>false, 'print' =>false));",
        "// Line_Reference 94: ",
        "// Line_Reference 95: ",
        "// Line_Reference 99:                 echo \"<tr><td>\"._studentID.\":</td>\";",
        "// Line_Reference 101:                 echo \"<tr><td>\"._studentName.\":</td>\";",
        "// Line_Reference 103:                 echo \"<tr><td>\"._studentGrade.\":</td>\";",
        "// Line_Reference 106:                     echo \"<tr><td>\"._studentMaillingLabel.\" :</td>\";",
        "// Line_Reference 109:                 echo'</table>';",
        "// Line_Reference 127: //",
        "// Line_Reference 161:                 ListOutputPrint($courses, $columns, _request, _requests, array(), array(), array('center' =>false, 'print' =>false));",
        "// Line_Reference 166:     } else",
        "// Line_Reference 167:         BackPrompt(''._noStudentsWereFound.'.');",
        "// Line_Reference 170: echo '<div id=\"modal_default_request\" class=\"modal fade\">';",
        "// Line_Reference 171: echo '<div class=\"modal-dialog\">';",
        "// Line_Reference 172: echo '<div class=\"modal-content\">';",
        "// Line_Reference 173: ",
        "// Line_Reference 174: echo '<div class=\"modal-header\">';",
        "// Line_Reference 175: echo '<button type=\"button\" class=\"close\" data-dismiss=\"modal\">Ã—</button>';",
        "// Line_Reference 176: echo '<h5 class=\"modal-title\">'._chooseCourse.'</h5>';",
        "// Line_Reference 177: echo '</div>'; //.modal-header",
        "// Line_Reference 178: ",
        "// Line_Reference 179: echo '<div class=\"modal-body\">';",
        "// Line_Reference 180: echo '<div id=\"conf_div\" class=\"text-center\"></div>';",
        "// Line_Reference 181: echo '<div class=\"row\" id=\"resp_table\">';",
        "// Line_Reference 182: echo '<div class=\"col-md-6\">';",
        "// Line_Reference 183: $sql = \"SELECT SUBJECT_ID,TITLE FROM course_subjects WHERE SCHOOL_ID='\" . UserSchool() . \"' AND SYEAR='\" . UserSyear() . \"' ORDER BY TITLE\";",
        "// Line_Reference 184: $QI = DBQuery($sql);",
        "// Line_Reference 185: $subjects_RET = DBGet($QI);",
        "// Line_Reference 186: ",
        "// Line_Reference 187: echo '<h6>' . count($subjects_RET) . ((count($subjects_RET) == 1) ? ' '._subjectWas.'' : ' '._subjectsWere.'') . ' '._found.'.</h6>';",
        "// Line_Reference 188: if (count($subjects_RET) > 0) {",
        "// Line_Reference 189:     echo '<table class=\"table table-bordered\"><thead><tr class=\"alpha-grey\"><th>'._subject.'</th></tr></thead>';",
        "// Line_Reference 190:     echo '<tbody>';",
        "// Line_Reference 191:     foreach ($subjects_RET as $val) {",
        "// Line_Reference 192:         echo '<tr><td><a href=javascript:void(0); onclick=\"chooseCpModalSearchRequest(' . $val['SUBJECT_ID'] . ',\\'courses\\')\">' . $val['TITLE'] . '</a></td></tr>';",
        "// Line_Reference 194:     echo '</tbody>';",
        "// Line_Reference 195:     echo '</table>';",
        "// Line_Reference 196: }",
        "// Line_Reference 197: echo '</div>';",
        "// Line_Reference 198: echo '<div class=\"col-md-6\"><div id=\"course_modal_request\"></div></div>';",
        "// Line_Reference 199: echo '</div>'; //.row",
        "// Line_Reference 200: echo '</div>'; //.modal-body",
        "// Line_Reference 201: ",
        "// Line_Reference 202: echo '</div>'; //.modal-content",
        "// Line_Reference 203: echo '</div>'; //.modal-dialog",
        "// Line_Reference 204: echo '</div>'; //.modal",
        "// Line_Reference 206: function _makeExtra($value, $title = '') {",
        "// Line_Reference 209:     if ($THIS_RET['WITH_TEACHER_ID'])",
        "// Line_Reference 210:         $return .= ''._with.':&nbsp;' . GetTeacher($THIS_RET['WITH_TEACHER_ID']) . '<BR>';",
        "// Line_Reference 211:     if ($THIS_RET['NOT_TEACHER_ID'])",
        "// Line_Reference 212:         $return .= ''._notWith.':&nbsp;' . GetTeacher($THIS_RET['NOT_TEACHER_ID']) . '<BR>';",
        "// Line_Reference 213:     if ($THIS_RET['WITH_PERIOD_ID'])",
        "// Line_Reference 214:         $return .= ''._on.':&nbsp;' . GetPeriod($THIS_RET['WITH_PERIOD_ID']) . '<BR>';",
        "// Line_Reference 215:     if ($THIS_RET['NOT_PERIOD_ID'])",
        "// Line_Reference 216:         $return .= ''._notOn.':&nbsp;' . GetPeriod($THIS_RET['NOT_PERIOD_ID']) . '<BR>';",
        "// Line_Reference 217:     if ($THIS_RET['PRIORITY'])",
        "// Line_Reference 218:         $return .= ''._priority.':&nbsp;' . $THIS_RET['PRIORITY'] . '<BR>';",
        "// Line_Reference 219:     if ($THIS_RET['MARKING_PERIOD_ID'])",
        "// Line_Reference 220:         $return .= ''._markingPeriod.':&nbsp;' . GetMP($THIS_RET['MARKING_PERIOD_ID']) . '<BR>';",
        "// Line_Reference 225: function _makeMpName($value) {",
        "// Line_Reference 229:     } else",
        "// Line_Reference 230:         return ''._customCoursePeriod.'';",
        "// Line_Reference 231: }",
        "// Line_Reference 233: ?>"
    ]
}
