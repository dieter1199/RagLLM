{
    "cve_id": "CVE-2022-45962",
    "cve_description": "Open Solutions for Education, Inc openSIS Community Edition v8.0 and earlier is vulnerable to SQL Injection via CalendarModal.php.",
    "cve_publish_date": "2023-02-13",
    "cwe_id": "CWE-89",
    "cwe_name": "Improper Neutralization of Special Elements used in an SQL Command ('SQL Injection')",
    "cwe_description": "The product constructs all or part of an SQL command using externally-influenced input from an upstream component, but it does not neutralize or incorrectly neutralizes special elements that could modify the intended SQL command when it is sent to a downstream component. Without sufficient removal or quoting of SQL syntax in user-controllable inputs, the generated SQL query can cause those inputs to be interpreted as SQL instead of ordinary user data.",
    "commit_message": "Version 9.0 release\n\nOlder version shifted to branch: Version_8.0",
    "type_of_change": "ModificationType.ADD",
    "filename_of_changes": "AssignOtherInfo.php",
    "code_language": "PHP",
    "number_of_lines_added_for_mitigation": "29",
    "number_of_lines_deleted_vulnerable_to_cve": "169",
    "vulnerable_lines": [
        "// Line_Reference 37:     if (count($_REQUEST['month_values'])) {",
        "// Line_Reference 42:             //            if (!VerifyDate($_REQUEST['values'][$field_name])) {",
        "// Line_Reference 43:             //                if ($_REQUEST['values'][$field_name] != '--')",
        "// Line_Reference 44:             //                    $note = '<IMG SRC=assets/warning_button.gif>The date you specified is not valid, so was not used.  The other data was saved.';",
        "// Line_Reference 45:             //                unset($_REQUEST['values'][$field_name]);",
        "// Line_Reference 46:             //            }",
        "// Line_Reference 176:                         if ($values[1] . trim() != '')",
        "// Line_Reference 178:                         if ($values[2] . trim() != '')",
        "// Line_Reference 180:                         if ($values[3] . trim() != '')",
        "// Line_Reference 185:                         if ($values[1] . trim() != '')",
        "// Line_Reference 187:                         if ($values[2] . trim() != '')",
        "// Line_Reference 189:                         if ($values[3] . trim() != '')",
        "// Line_Reference 222:         // ShowErr('<div class=\"alert bg-warning alert-styled-left\">' . _youMustChooseAtLeastOneFieldAndOneStudent . '.</div>');",
        "// Line_Reference 236: ",
        "// Line_Reference 237:         //        if ($_REQUEST['category_id']) {",
        "// Line_Reference 238:         //            $fields_RET = DBGet(DBQuery('SELECT ID,TITLE,TYPE,SELECT_OPTIONS FROM custom_fields WHERE CATEGORY_ID=\\'' . $_REQUEST[category_id] . '\\''), array(), array('TYPE'));",
        "// Line_Reference 239:         //        } else {",
        "// Line_Reference 240:         //            $fields_RET = DBGet(DBQuery('SELECT ID,TITLE,TYPE,SELECT_OPTIONS FROM custom_fields'), array(), array('TYPE'));",
        "// Line_Reference 241:         //        }",
        "// Line_Reference 286:         $fields_RET = DBGet(DBQuery('SELECT ID,TITLE,TYPE,SELECT_OPTIONS FROM custom_fields WHERE CATEGORY_ID=\\'' . $_REQUEST[category_id] . '\\''), array(), array('TYPE'));",
        "// Line_Reference 287:         //        if ($_REQUEST[category_id] == 'all') {",
        "// Line_Reference 288:         //",
        "// Line_Reference 289:         //            $arr_g = array(firstName,middleName,'Last Name','Estimated Grad. Date','Ethnicity', 'Common Name', 'Gender', 'Language', 'Email', 'Phone');",
        "// Line_Reference 290:         //            foreach ($arr_g as $v_g) {",
        "// Line_Reference 291:         //                if ($v_g == ''._commonName.'') {",
        "// Line_Reference 292:         //                    $v_g = 'common_name';",
        "// Line_Reference 293:         //                }",
        "// Line_Reference 294:         //",
        "// Line_Reference 295:         //                if($v_g==''._estimatedGradDate.'' || $v_g==''._estimatedGradDate.'')",
        "// Line_Reference 296:         //                    array_push($fields, '<div class=form-group>' .$v_g.' '. _makeDateInput($v_g) . '</div>');",
        "// Line_Reference 297:         //            else",
        "// Line_Reference 298:         //                array_push($fields, '<div class=form-group>' . _makeTextInput($v_g) . '</div>');",
        "// Line_Reference 299:         //            }",
        "// Line_Reference 300:         //",
        "// Line_Reference 301:         //",
        "// Line_Reference 302:         ////        echo '<div class=\"col-md-12\">';",
        "// Line_Reference 303:         ////        echo '<span class=\"heading-text\">'._section.'</span><div class=\"btn-group\">';",
        "// Line_Reference 304:         ////",
        "// Line_Reference 305:         ////",
        "// Line_Reference 306:         ////        $school_id = UserSchool();",
        "// Line_Reference 307:         ////        $sql = 'SELECT * FROM school_gradelevel_sections WHERE SCHOOL_ID=\\''.$school_id.'\\' ORDER BY SORT_ORDER';",
        "// Line_Reference 308:         ////        $QI = DBQuery($sql);",
        "// Line_Reference 309:         ////        $sec_RET = DBGet($QI);",
        "// Line_Reference 310:         ////        unset($options);",
        "// Line_Reference 311:         ////        if(count($sec_RET))",
        "// Line_Reference 312:         ////        {",
        "// Line_Reference 313:         ////                foreach($sec_RET as $value)",
        "// Line_Reference 314:         ////                        $options[$value['ID']] = $value['NAME'];",
        "// Line_Reference 315:         ////        }",
        "// Line_Reference 316:         ////",
        "// Line_Reference 317:         ////        echo _makeSelectInput('SECTION_ID',$options);",
        "// Line_Reference 318:         ////        echo'</div>';",
        "// Line_Reference 319:         //",
        "// Line_Reference 320:         //",
        "// Line_Reference 321:         //",
        "// Line_Reference 322:         //            $arr_m = array('Physician', 'Physician\\'s Phone', 'Preferred Hospital');",
        "// Line_Reference 323:         //",
        "// Line_Reference 324:         //            foreach ($arr_m as $v_m) {",
        "// Line_Reference 325:         //",
        "// Line_Reference 326:         //                if (trim($v_m) == physician) {",
        "// Line_Reference 327:         //                    $v_m_n = 'medical_info[PHYSICIAN]';",
        "// Line_Reference 328:         //                    array_push($fields, '<div class=\"form-group\">' . _makeTextInput($v_m_n) . '</div>');",
        "// Line_Reference 329:         //                }if (trim($v_m) == physicianSPhone) {",
        "// Line_Reference 330:         //                    $v_m_n = 'medical_info[PHYSICIAN_PHONE]';",
        "// Line_Reference 331:         //                    array_push($fields, '<div class=\"form-group\">' . _makeTextInput($v_m_n) . '</div>');",
        "// Line_Reference 332:         //                } else if (trim($v_m) == preferredHospital) {",
        "// Line_Reference 333:         //                    $v_m_n = 'medical_info[PREFERRED_HOSPITAL]';",
        "// Line_Reference 334:         //                    array_push($fields, '<div class=\"form-group\">' . _makeTextInput($v_m_n) . '</div>');",
        "// Line_Reference 335:         //                }",
        "// Line_Reference 336:         //            }",
        "// Line_Reference 337:         //        }",
        "// Line_Reference 338: ",
        "// Line_Reference 339:         if ($_REQUEST[category_id] == 2) {",
        "// Line_Reference 359:         if ($_REQUEST[category_id] == 1 || $_REQUEST[category_id] == '') {",
        "// Line_Reference 402:                     // $ethnic_option = array($ethnicity[1]['ETHNICITY_ID'] => $ethnicity[1]['ETHNICITY_NAME'], $ethnicity[2]['ETHNICITY_ID'] => $ethnicity[2]['ETHNICITY_NAME'],$ethnicity[3]['ETHNICITY_ID'] => $ethnicity[3]['ETHNICITY_NAME'],$ethnicity[4]['ETHNICITY_ID'] => $ethnicity[4]['ETHNICITY_NAME'],$ethnicity[5]['ETHNICITY_ID'] => $ethnicity[5]['ETHNICITY_NAME'],$ethnicity[6]['ETHNICITY_ID'] => $ethnicity[6]['ETHNICITY_NAME'],$ethnicity[7]['ETHNICITY_ID'] => $ethnicity[7]['ETHNICITY_NAME'],$ethnicity[8]['ETHNICITY_ID'] => $ethnicity[8]['ETHNICITY_NAME'],$ethnicity[9]['ETHNICITY_ID'] => $ethnicity[9]['ETHNICITY_NAME'],$ethnicity[10]['ETHNICITY_ID'] => $ethnicity[10]['ETHNICITY_NAME'],$ethnicity[11]['ETHNICITY_ID'] => $ethnicity[11]['ETHNICITY_NAME']);",
        "// Line_Reference 443:         if ($_REQUEST[category_id] == 6) {",
        "// Line_Reference 476:             $fields_RET = DBGet(DBQuery('SELECT ID,TITLE,TYPE,SELECT_OPTIONS FROM custom_fields WHERE CATEGORY_ID=\\'' . $_REQUEST[category_id] . '\\''), array(), array('TYPE'));",
        "// Line_Reference 479:         if ($_REQUEST[category_id] == 4) {",
        "// Line_Reference 494:             $fields_RET = DBGet(DBQuery('SELECT ID,TITLE,TYPE,SELECT_OPTIONS FROM custom_fields WHERE CATEGORY_ID=\\'' . $_REQUEST[category_id] . '\\''), array(), array('TYPE'));",
        "// Line_Reference 497:         if (count($fields_RET['text'])) {",
        "// Line_Reference 499:                 //                $title = strtolower(trim($field['TITLE']));",
        "// Line_Reference 500:                 //                if (strpos(trim($field['TITLE']), ' ') != 0) {",
        "// Line_Reference 501:                 //                    $p1 = substr(trim($field['TITLE']), 0, strpos(trim($field['TITLE']), ' '));",
        "// Line_Reference 502:                 //                    $p2 = substr(trim($field['TITLE']), strpos(trim($field['TITLE']), ' ') + 1);",
        "// Line_Reference 503:                 //                    $title = strtolower($p1 . '_' . $p2);",
        "// Line_Reference 504:                 //                }",
        "// Line_Reference 505:                 //                $query = DBGet(DBQuery('SELECT * FROM students LIMIT 0,1'));",
        "// Line_Reference 506:                 //                $query = $query[1];",
        "// Line_Reference 507:                 //                $f = 0;",
        "// Line_Reference 508:                 //                foreach ($query as $k => $v) {",
        "// Line_Reference 509:                 //                    if (strtolower($k) == strtolower($title))",
        "// Line_Reference 510:                 //                        $f = 1;",
        "// Line_Reference 511:                 //                }",
        "// Line_Reference 512:                 //                if ($f == 0) {",
        "// Line_Reference 513:                 //                    if (trim($title) == 'physician')",
        "// Line_Reference 514:                 //                        $title = 'medical_info[PHYSICIAN]';",
        "// Line_Reference 515:                 //                    if (trim($title) == 'physician_phone')",
        "// Line_Reference 516:                 //                        $title = 'medical_info[PHYSICIAN_PHONE]';",
        "// Line_Reference 517:                 //                    else if (trim($title) == 'preferred_hospital')",
        "// Line_Reference 518:                 //                        $title = 'medical_info[PREFERRED_HOSPITAL]';",
        "// Line_Reference 519:                 //                }",
        "// Line_Reference 523:         if (count($fields_RET['numeric'])) {",
        "// Line_Reference 527:         if (count($fields_RET['date'])) {",
        "// Line_Reference 534:         if (count($fields_RET['select'])) {",
        "// Line_Reference 536:                 if ($field[TITLE] == 'Ethnicity' || $field[TITLE] == 'Gender' || $field[TITLE] == 'Language') {",
        "// Line_Reference 545:                     array_push($fields, \"<div class=\\\"form-group\\\"><label class=\\\"control-label col-lg-4 text-right\\\" for=\\\"CUSTOM_\" . $field['ID'] . \"\\\">$field[TITLE]</label><div class=\\\"col-lg-8\\\">\" . _makeSelectInput($field[TITLE], $select_options) . '</div></div>');",
        "// Line_Reference 559:         if (count($fields_RET['textarea'])) {",
        "// Line_Reference 564:         /*if (!$_REQUEST['category_id'] || $_REQUEST['category_id'] == '1') {",
        "// Line_Reference 565: ",
        "// Line_Reference 566:             $schools_RET = DBGet(DBQuery('SELECT ID,TITLE FROM schools WHERE ID!=\\'' . UserSchool() . '\\''));",
        "// Line_Reference 567:             $options = array(UserSchool() => 'Next grade at current school', '0' => 'Retain', '-1' => 'Do not enroll after this school year');",
        "// Line_Reference 568:             if (count($schools_RET)) {",
        "// Line_Reference 569:                 foreach ($schools_RET as $school)",
        "// Line_Reference 570:                     $options[$school['ID']] = $school['TITLE'];",
        "// Line_Reference 571:             }",
        "// Line_Reference 572:             array_push($fields, '<div class=\"form-group\"><label class=\"control-label text-right col-lg-4\" for=\"CUSTOM_' . $field['ID'].'\">Rolling Retention / Options</label><div class=\"col-lg-8\">' . _makeSelectInput('NEXT_SCHOOL', $options) . '</div></div>');",
        "// Line_Reference 573: ",
        "// Line_Reference 574:             $calendars_RET = DBGet(DBQuery('SELECT CALENDAR_ID,DEFAULT_CALENDAR,TITLE FROM school_calendars WHERE SYEAR=\\'' . UserSyear() . '\\' AND SCHOOL_ID=\\'' . UserSchool() . '\\' ORDER BY DEFAULT_CALENDAR ASC'));",
        "// Line_Reference 575:             $options = array();",
        "// Line_Reference 576:             if (count($calendars_RET)) {",
        "// Line_Reference 577:                 foreach ($calendars_RET as $calendar)",
        "// Line_Reference 578:                     $options[$calendar['CALENDAR_ID']] = $calendar['TITLE'];",
        "// Line_Reference 579:             }",
        "// Line_Reference 580:             array_push($fields, '<div class=\"form-group\"><label class=\"control-label text-right col-lg-4\" for=\"CUSTOM_' . $field['ID'].'\">Calendar</label><div class=\"col-lg-8\">' . _makeSelectInput('CALENDAR_ID', $options) . '</div></div>');",
        "// Line_Reference 581:         }*/",
        "// Line_Reference 582: ",
        "// Line_Reference 583:         /*if ($_REQUEST['category_id'] == '') {",
        "// Line_Reference 584: //         echo '<div class=\"col-md-12\">';",
        "// Line_Reference 585: //        echo '<span class=\"heading-text\">'._section.'</span><div class=\"btn-group\">';",
        "// Line_Reference 586: //",
        "// Line_Reference 587: ",
        "// Line_Reference 588:             $school_id = UserSchool();",
        "// Line_Reference 589:             $sql = 'SELECT * FROM school_gradelevel_sections WHERE SCHOOL_ID=\\'' . $school_id . '\\' ORDER BY SORT_ORDER';",
        "// Line_Reference 590:             $QI = DBQuery($sql);",
        "// Line_Reference 591:             $sec_RET = DBGet($QI);",
        "// Line_Reference 592:             unset($options);",
        "// Line_Reference 593:             if (count($sec_RET)) {",
        "// Line_Reference 594:                 foreach ($sec_RET as $value)",
        "// Line_Reference 595:                     $options[$value['ID']] = $value['NAME'];",
        "// Line_Reference 596:             }",
        "// Line_Reference 597: ",
        "// Line_Reference 598: //        echo _makeSelectInput('SECTION_ID',$options);",
        "// Line_Reference 599:             array_push($fields, '<div class=\"form-group\"><label class=\"control-label text-right col-lg-4\">'._section.'</label><div class=\"col-lg-8\">' . _makeSelectInput('SECTION_ID', $options) . '</div></div>');",
        "// Line_Reference 600: //        echo'</div>';",
        "// Line_Reference 601: ",
        "// Line_Reference 602: ",
        "// Line_Reference 603:             $grade_level_RET = DBGet(DBQuery('SELECT * FROM school_gradelevels WHERE SCHOOL_ID=\\'' . UserSchool() . '\\' ORDER BY SORT_ORDER ASC'));",
        "// Line_Reference 604:             $options = array();",
        "// Line_Reference 605:             if (count($grade_level_RET)) {",
        "// Line_Reference 606:                 foreach ($grade_level_RET as $grade)",
        "// Line_Reference 607:                     $options[$grade['ID']] = $grade['TITLE'];",
        "// Line_Reference 608:             }",
        "// Line_Reference 609:             array_push($fields, '<div class=\"form-group\"><label class=\"control-label text-right col-lg-4\">'._schoolGradelevel.'</label><div class=\"col-lg-8\">' . _makeSelectInput('GRADE_ID', $options) . '</div></div>');",
        "// Line_Reference 610:         }*/",
        "// Line_Reference 611: ",
        "// Line_Reference 612: ",
        "// Line_Reference 613:         $radio_count = count($fields_RET['radio']);",
        "// Line_Reference 615:             //echo '<TABLE cellpadding=5>';",
        "// Line_Reference 616:             //echo '<TR>';",
        "// Line_Reference 619:                 //if ($i % 5 == 0 && $i != $radio_count)",
        "// Line_Reference 620:                 //echo '</TR><TR>';",
        "// Line_Reference 622:             //echo '</TD></TR>';",
        "// Line_Reference 623:             //echo '</TABLE>';",
        "// Line_Reference 626:         //$test = array_map('htmlspecialchars', $fields);",
        "// Line_Reference 627: ",
        "// Line_Reference 682:     $extra['columns_before'] = array('CHECKBOX' => '</A><INPUT type=checkbox value=Y name=controller onclick=\"checkAllDtMod(this,\\'st_arr\\');\">');",
        "// Line_Reference 734:     return \"<INPUT type=checkbox name=student[\" . $THIS_RET['STUDENT_ID'] . \"] value=Y id=$THIS_RET[STUDENT_ID] onClick='setHiddenCheckboxStudents(\\\"st_arr[]\\\",this,$THIS_RET[STUDENT_ID]);'>\";",
        "// Line_Reference 788:         // $returnshape .= '<div class=\"col-lg-8\"><input style=\"margin: 10px auto;\" type=\"checkbox\" id=\"values['.$identifier.']\" name=\"values['.$identifier.']\" size=\"25\" value=\"Y\"></div>';",
        "// Line_Reference 789: "
    ]
}
