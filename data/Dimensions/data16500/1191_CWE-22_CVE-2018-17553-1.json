{
    "cve_id": "CVE-2018-17553",
    "cve_description": "An \"Unrestricted Upload of File with Dangerous Type\" issue with directory traversal in navigate_upload.php in Naviwebs Navigate CMS 2.8 allows authenticated attackers to achieve remote code execution via a POST request with engine=picnik and id=../../../navigate_info.php.",
    "cve_publish_date": "2018-10-03",
    "cwe_id": "CWE-22",
    "cwe_name": "Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal')",
    "cwe_description": "The product uses external input to construct a pathname that is intended to identify a file or directory that is located underneath a restricted parent directory, but the product does not properly neutralize special elements within the pathname that can cause the pathname to resolve to a location that is outside of the restricted directory.",
    "commit_message": "- files: removed unused code related to \"picnik\" upload",
    "type_of_change": "Modification",
    "filename_of_changes": "files.php",
    "code_language": "PHP",
    "number_of_lines_added_for_mitigation": "0",
    "number_of_lines_deleted_vulnerable_to_cve": "44",
    "vulnerable_lines": [
        "// Line_Reference 336: \t\t/*",
        "// Line_Reference 337: \t\tcase 91: // picnik editing",
        "// Line_Reference 338: \t\t\tob_clean();",
        "// Line_Reference 339: ",
        "// Line_Reference 340: \t\t\t// $strPicnikUrl is the URL that we use to launch Picnik.",
        "// Line_Reference 341: \t\t\t$strPicnikUrl = \"http://www.picnik.com/service\";",
        "// Line_Reference 342: \t\t\t// $aPicnikParams collects together all the params we'll give Picnik.  Start with an API key",
        "// Line_Reference 343: \t\t\t$aPicnikParams['_apikey'] = $website->picnik_api_key;",
        "// Line_Reference 344: \t\t\t// tell Picnik where to send the exported image",
        "// Line_Reference 345: \t\t\t$aPicnikParams['_export'] = NAVIGATE_URL.'/navigate_upload.php?wid='.$website->id.'&engine=picnik&id='.$_REQUEST['id'].'&engine=picnik&session_id='.session_id();",
        "// Line_Reference 346: \t\t\t// give the export button a title",
        "// Line_Reference 347: \t\t\t$aPicnikParams['_export_title'] = t(34, 'Save');",
        "// Line_Reference 348: \t\t\t// turn on the close button, and tell it to come back here",
        "// Line_Reference 349: \t\t\t//$aPicnikParams['_close_target'] = $strRoot;",
        "// Line_Reference 350: \t\t\t// send in the previous \"king\" image in case the user feels like decorating it",
        "// Line_Reference 351: \t\t\t$aPicnikParams['_import'] = NAVIGATE_DOWNLOAD.'?wid='.$website->id.'&id='.$_REQUEST['id'].'&disposition=attachment&sid='.session_id();",
        "// Line_Reference 352: \t\t\t// tell Picnik to redirect the user to the following URL after the HTTP POST instead of just redirecting to _export",
        "// Line_Reference 353: \t\t\t$aPicnikParams['_redirect'] = NAVIGATE_DOWNLOAD.'?wid='.$website->id.'&id='.$_REQUEST['id'].'&disposition=inline&ts='.core_time(); //'javascript: return false;';",
        "// Line_Reference 354: ",
        "// Line_Reference 355: \t\t\t// tell Picnik our name.  It'll use it in a few places as appropriate",
        "// Line_Reference 356: \t\t\t$aPicnikParams['_host_name'] = 'Navigate';",
        "// Line_Reference 357: \t\t\t// turn off the \"Save &amp; Share\" tab so users don't get confused",
        "// Line_Reference 358: \t\t\t$aPicnikParams['_exclude'] = \"out\";",
        "// Line_Reference 359: ",
        "// Line_Reference 360: \t\t\techo '<html><head></head><body>';",
        "// Line_Reference 361: ",
        "// Line_Reference 362: \t\t\techo '<form id=\"picnik_form\" method=\"POST\" action=\"'.$strPicnikUrl.'\" style=\" visibility: hidden; \">';",
        "// Line_Reference 363: ",
        "// Line_Reference 364: \t\t\t// put all the API parameters into the form as hidden inputs",
        "// Line_Reference 365: \t\t\tforeach( $aPicnikParams as $key => $value ) {",
        "// Line_Reference 366: \t\t\t\techo \"<input type='hidden' name='$key' value='$value'/>\\n\";",
        "// Line_Reference 367: \t\t\t}",
        "// Line_Reference 368: ",
        "// Line_Reference 369: \t\t\t//echo \"<input type='text' name='address' value='Your Majesty'/>\\n\";",
        "// Line_Reference 370: \t\t\techo \"<input type='submit' value='Picnik'/>\\n\";",
        "// Line_Reference 371: \t\t\techo \"</form>\";",
        "// Line_Reference 372: \t\t\techo '<script language=\"javascript\" type=\"text/javascript\">",
        "// Line_Reference 373: \t\t\t\t\tdocument.forms[0].submit();",
        "// Line_Reference 374: \t\t\t\t  </script>';",
        "// Line_Reference 375: \t\t\techo '</body></html>';",
        "// Line_Reference 376: ",
        "// Line_Reference 377: \t\t\tcore_terminate();",
        "// Line_Reference 378: \t\t\tbreak;",
        "// Line_Reference 379: \t\t*/"
    ]
}
