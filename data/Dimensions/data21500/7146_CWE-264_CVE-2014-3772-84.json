{
    "cve_id": "CVE-2014-3772",
    "cve_description": "TeamPass before 2.1.20 allows remote attackers to bypass access restrictions via a request to index.php followed by a direct request to a file that calls the session_start function before checking the CPM key, as demonstrated by a request to sources/upload/upload.files.php.",
    "cve_publish_date": "2014-08-07",
    "cwe_id": "CWE-264",
    "cwe_name": "Permissions, Privileges, and Access Controls",
    "cwe_description": "Weaknesses in this category are related to the management of permissions, privileges, and other security features that are used to perform access control.",
    "commit_message": "2.1.20",
    "type_of_change": "Modification",
    "filename_of_changes": "users.queries.php",
    "code_language": "PHP",
    "number_of_lines_added_for_mitigation": "123",
    "number_of_lines_deleted_vulnerable_to_cve": "23",
    "vulnerable_lines": [
        "// Line_Reference 9:  * @link          http://www.teampass.net",
        "// Line_Reference 14: if (!isset($_SESSION['CPM']) || $_SESSION['CPM'] != 1 || !isset($_SESSION['key']) || empty($_SESSION['key'])) {",
        "// Line_Reference 47:             $data = $db->fetchRow(\"SELECT \".$_POST['type'].\" FROM \".$pre.\"users WHERE id = \".$val[0]);",
        "// Line_Reference 77:             $data = $db->fetchRow(\"SELECT fonction_id FROM \".$pre.\"users WHERE id = $val[0]\");",
        "// Line_Reference 242:                 $data = $db->fetchRow(\"SELECT id FROM \".$pre.\"nested_tree WHERE title = '\".$_POST['id'].\"' AND personal_folder = 1\");    // Get personal folder ID",
        "// Line_Reference 307:             $data = $db->fetchRow(\"SELECT email FROM \".$pre.\"users WHERE id = '\".$_POST['id'].\"'\");",
        "// Line_Reference 426:             $data_user = $db->fetchRow(\"SELECT fonction_id FROM \".$pre.\"users WHERE id = \".$_POST['id']);",
        "// Line_Reference 487:             $data_user = $db->fetchRow(\"SELECT groupes_visibles FROM \".$pre.\"users WHERE id = \".$_POST['id']);",
        "// Line_Reference 577:             $data_user = $db->fetchRow(\"SELECT groupes_interdits FROM \".$pre.\"users WHERE id = \".$_POST['id']);",
        "// Line_Reference 665:             $data = $db->fetchRow(\"SELECT COUNT(*) FROM \".$pre.\"nested_tree WHERE title = '\".$_POST['domain'].\"' AND parent_id = 0\");",
        "// Line_Reference 672:             $data = $db->fetchRow(\"SELECT COUNT(*) FROM \".$pre.\"roles_title WHERE title = '\".$_POST['domain'].\"'\");",
        "// Line_Reference 700:                     WHERE l.id_user = \".$_POST['id'].$sql_filter",
        "// Line_Reference 714:                     WHERE l.id_user = \".$_POST['id'].$sql_filter.\"",
        "// Line_Reference 716:                     LIMIT $start,\".$_POST['nb_items_by_page']",
        "// Line_Reference 720:                 $data = $db->fetchRow(",
        "// Line_Reference 721:                     \"SELECT COUNT(*)",
        "// Line_Reference 722:                     FROM \".$pre.\"log_system",
        "// Line_Reference 723:                     WHERE type = 'user_mngt' AND field_1=\".$_POST['id']",
        "// Line_Reference 782:                 $admin_folder = $db->queryFirst(\"SELECT id FROM \".$pre.\"nested_tree WHERE title='\".$_SESSION['user_id'].\"' AND personal_folder = 1\");",
        "// Line_Reference 784:                 $user_folder = $db->queryFirst(\"SELECT id FROM \".$pre.\"nested_tree WHERE title='\".$user_id.\"' AND personal_folder = 1\");",
        "// Line_Reference 803:                         WHERE l.action = 'at_creation' AND i.perso=1 AND i.id_tree=\".$folder->id",
        "// Line_Reference 844:                     \"id = \".$_POST['user_id']",
        "// Line_Reference 867:                     \"id = \".$reccord['id']"
    ]
}
