{
    "cve_id": "CVE-2014-3538",
    "cve_description": "file before 5.19 does not properly restrict the amount of data read during a regex search, which allows remote attackers to cause a denial of service (CPU consumption) via a crafted file that triggers backtracking during processing of an awk rule.  NOTE: this vulnerability exists because of an incomplete fix for CVE-2013-7345.",
    "cve_publish_date": "2014-07-03",
    "cwe_id": "CWE-399",
    "cwe_name": "Resource Management Errors",
    "cwe_description": "Weaknesses in this category are related to improper management of system resources.",
    "commit_message": "* Enforce limit of 8K on regex searches that have no limits\n* Allow the l modifier for regex to mean line count. Default\n  to byte count. If line count is specified, assume a max\n  of 80 characters per line to limit the byte count.\n* Don't allow conversions to be used for dates, allowing\n  the mask field to be used as an offset.\n* Bump the version of the magic format so that regex changes\n  are visible.",
    "type_of_change": "Modification",
    "filename_of_changes": "softmagic.c",
    "code_language": "C",
    "number_of_lines_added_for_mitigation": "43",
    "number_of_lines_deleted_vulnerable_to_cve": "29",
    "vulnerable_lines": [
        "// Line_Reference 35: FILE_RCSID(\"@(#)$File: softmagic.c,v 1.188 2014/05/14 23:15:42 christos Exp $\")",
        "// Line_Reference 60:     const unsigned char *, uint32_t, size_t, size_t);",
        "// Line_Reference 543: \t\t    file_fmttime(p->l, FILE_T_LOCAL, tbuf)) == -1)",
        "// Line_Reference 553: \t\t    file_fmttime(p->l, 0, tbuf)) == -1)",
        "// Line_Reference 562: \t\t    file_fmttime(p->q, FILE_T_LOCAL, tbuf)) == -1)",
        "// Line_Reference 571: \t\t    file_fmttime(p->q, 0, tbuf)) == -1)",
        "// Line_Reference 580: \t\t    file_fmttime(p->q, FILE_T_WINDOWS, tbuf)) == -1)",
        "// Line_Reference 916: \tswitch (cvt_flip(m->type, flip)) {",
        "// Line_Reference 960: \t\tcvt_32(p, m);",
        "// Line_Reference 971: \t\tcvt_64(p, m);",
        "// Line_Reference 982: \t\tcvt_32(p, m);",
        "// Line_Reference 993: \t\tcvt_64(p, m);",
        "// Line_Reference 1000: \t\tcvt_32(p, m);",
        "// Line_Reference 1057:     const unsigned char *s, uint32_t offset, size_t nbytes, size_t linecnt)",
        "// Line_Reference 1077: \t\t\tsize_t lines;",
        "// Line_Reference 1085: \t\t\tend = last = RCAST(const char *, s) + nbytes;",
        "// Line_Reference 1098: \t\t\t\tlast = RCAST(const char *, s) + nbytes;",
        "// Line_Reference 1169: \tuint32_t count = m->str_range;",
        "// Line_Reference 1182: \t    (uint32_t)nbytes, count) == -1)",
        "// Line_Reference 1187: \t\t    \"nbytes=%zu, count=%u)\\n\", m->type, m->flag, offset, o,",
        "// Line_Reference 1188: \t\t    nbytes, count);",
        "// Line_Reference 1553: \t\tif (mcopy(ms, p, m->type, 0, s, offset, nbytes, count) == -1)",
        "// Line_Reference 1909: \t\t\tv = file_strncmp(m->value.s, ms->search.s + idx, slen, m->str_flags);",
        "// Line_Reference 1932: #ifndef REG_STARTEND",
        "// Line_Reference 1933: \t\t\tchar c;",
        "// Line_Reference 1934: #endif",
        "// Line_Reference 1937: \t\t\t/* Limit by offset if requested */",
        "// Line_Reference 1938: \t\t\tif (m->str_range > 0)",
        "// Line_Reference 1939: \t\t\t\tslen = MIN(slen, m->str_range);"
    ]
}
