{
    "cve_id": "CVE-2014-4027",
    "cve_description": "The rd_build_device_space function in drivers/target/target_core_rd.c in the Linux kernel before 3.14 does not properly initialize a certain data structure, which allows local users to obtain sensitive information from ramdisk_mcp memory by leveraging access to a SCSI initiator.",
    "cve_publish_date": "2014-06-23",
    "cwe_id": "CWE-200",
    "cwe_name": "Exposure of Sensitive Information to an Unauthorized Actor",
    "cwe_description": "The product exposes sensitive information to an actor that is not explicitly authorized to have access to that information.",
    "commit_message": "target/rd: Refactor rd_build_device_space + rd_release_device_space\n\nThis patch refactors rd_build_device_space() + rd_release_device_space()\ninto rd_allocate_sgl_table() + rd_release_device_space() so that they\nmay be used seperatly for setup + release of protection information\nscatterlists.\n\nAlso add explicit memset of pages within rd_allocate_sgl_table() based\nupon passed 'init_payload' value.\n\nv2 changes:\n  - Drop unused sg_table from rd_release_device_space (Wei)\n\nCc: Martin K. Petersen <martin.petersen@oracle.com>\nCc: Christoph Hellwig <hch@lst.de>\nCc: Hannes Reinecke <hare@suse.de>\nCc: Sagi Grimberg <sagig@mellanox.com>\nCc: Or Gerlitz <ogerlitz@mellanox.com>\nSigned-off-by: Nicholas Bellinger <nab@linux-iscsi.org>",
    "type_of_change": "Modification",
    "filename_of_changes": "target_core_rd.c",
    "code_language": "C",
    "number_of_lines_added_for_mitigation": "68",
    "number_of_lines_deleted_vulnerable_to_cve": "45",
    "vulnerable_lines": [
        "// Line_Reference 81: /*\trd_release_device_space():",
        "// Line_Reference 82:  *",
        "// Line_Reference 83:  *",
        "// Line_Reference 84:  */",
        "// Line_Reference 85: static void rd_release_device_space(struct rd_dev *rd_dev)",
        "// Line_Reference 87: \tu32 i, j, page_count = 0, sg_per_table;",
        "// Line_Reference 88: \tstruct rd_dev_sg_table *sg_table;",
        "// Line_Reference 92: \tif (!rd_dev->sg_table_array || !rd_dev->sg_table_count)",
        "// Line_Reference 93: \t\treturn;",
        "// Line_Reference 94: ",
        "// Line_Reference 95: \tsg_table = rd_dev->sg_table_array;",
        "// Line_Reference 96: ",
        "// Line_Reference 97: \tfor (i = 0; i < rd_dev->sg_table_count; i++) {",
        "// Line_Reference 108: ",
        "// Line_Reference 117: \tkfree(sg_table);",
        "// Line_Reference 127: static int rd_build_device_space(struct rd_dev *rd_dev)",
        "// Line_Reference 129: \tu32 i = 0, j, page_offset = 0, sg_per_table, sg_tables, total_sg_needed;",
        "// Line_Reference 132: \tstruct rd_dev_sg_table *sg_table;",
        "// Line_Reference 135: ",
        "// Line_Reference 136: \tif (rd_dev->rd_page_count <= 0) {",
        "// Line_Reference 137: \t\tpr_err(\"Illegal page count: %u for Ramdisk device\\n\",",
        "// Line_Reference 138: \t\t\trd_dev->rd_page_count);",
        "// Line_Reference 139: \t\treturn -EINVAL;",
        "// Line_Reference 140: \t}",
        "// Line_Reference 141: ",
        "// Line_Reference 142: \t/* Don't need backing pages for NULLIO */",
        "// Line_Reference 143: \tif (rd_dev->rd_flags & RDF_NULLIO)",
        "// Line_Reference 144: \t\treturn 0;",
        "// Line_Reference 145: ",
        "// Line_Reference 146: \ttotal_sg_needed = rd_dev->rd_page_count;",
        "// Line_Reference 147: ",
        "// Line_Reference 148: \tsg_tables = (total_sg_needed / max_sg_per_table) + 1;",
        "// Line_Reference 149: ",
        "// Line_Reference 150: \tsg_table = kzalloc(sg_tables * sizeof(struct rd_dev_sg_table), GFP_KERNEL);",
        "// Line_Reference 151: \tif (!sg_table) {",
        "// Line_Reference 152: \t\tpr_err(\"Unable to allocate memory for Ramdisk\"",
        "// Line_Reference 153: \t\t\t\" scatterlist tables\\n\");",
        "// Line_Reference 154: \t\treturn -ENOMEM;",
        "// Line_Reference 155: \t}",
        "// Line_Reference 156: ",
        "// Line_Reference 157: \trd_dev->sg_table_array = sg_table;",
        "// Line_Reference 158: \trd_dev->sg_table_count = sg_tables;",
        "// Line_Reference 196: \t\t\" %u pages in %u tables\\n\", rd_dev->rd_host->rd_host_id,",
        "// Line_Reference 197: \t\trd_dev->rd_dev_id, rd_dev->rd_page_count,",
        "// Line_Reference 198: \t\trd_dev->sg_table_count);"
    ]
}
