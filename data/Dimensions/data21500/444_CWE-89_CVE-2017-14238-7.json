{
    "cve_id": "CVE-2017-14238",
    "cve_description": "SQL injection vulnerability in admin/menus/edit.php in Dolibarr ERP/CRM version 6.0.0 allows remote attackers to execute arbitrary SQL commands via the menuId parameter.",
    "cve_publish_date": "2017-09-11",
    "cwe_id": "CWE-89",
    "cwe_name": "Improper Neutralization of Special Elements used in an SQL Command ('SQL Injection')",
    "cwe_description": "The product constructs all or part of an SQL command using externally-influenced input from an upstream component, but it does not neutralize or incorrectly neutralizes special elements that could modify the intended SQL command when it is sent to a downstream component. Without sufficient removal or quoting of SQL syntax in user-controllable inputs, the generated SQL query can cause those inputs to be interpreted as SQL instead of ordinary user data.",
    "commit_message": "FIX Security fixes (filter onload js, less verbose error message in\ndownload and viewimage, show info to encourage dolibarr_main_prod=1)",
    "type_of_change": "Modification",
    "filename_of_changes": "company.php",
    "code_language": "PHP",
    "number_of_lines_added_for_mitigation": "108",
    "number_of_lines_deleted_vulnerable_to_cve": "108",
    "vulnerable_lines": [
        "// Line_Reference 52: if ( ($action == 'update' && empty($_POST[\"cancel\"]))",
        "// Line_Reference 66: \tdolibarr_set_const($db, \"MAIN_INFO_SOCIETE_NOM\",$_POST[\"nom\"],'chaine',0,'',$conf->entity);",
        "// Line_Reference 67: \tdolibarr_set_const($db, \"MAIN_INFO_SOCIETE_ADDRESS\",$_POST[\"address\"],'chaine',0,'',$conf->entity);",
        "// Line_Reference 68: \tdolibarr_set_const($db, \"MAIN_INFO_SOCIETE_TOWN\",$_POST[\"town\"],'chaine',0,'',$conf->entity);",
        "// Line_Reference 69: \tdolibarr_set_const($db, \"MAIN_INFO_SOCIETE_ZIP\",$_POST[\"zipcode\"],'chaine',0,'',$conf->entity);",
        "// Line_Reference 70: \tdolibarr_set_const($db, \"MAIN_INFO_SOCIETE_STATE\",$_POST[\"state_id\"],'chaine',0,'',$conf->entity);",
        "// Line_Reference 71: \tdolibarr_set_const($db, \"MAIN_MONNAIE\",$_POST[\"currency\"],'chaine',0,'',$conf->entity);",
        "// Line_Reference 72: \tdolibarr_set_const($db, \"MAIN_INFO_SOCIETE_TEL\",$_POST[\"tel\"],'chaine',0,'',$conf->entity);",
        "// Line_Reference 73: \tdolibarr_set_const($db, \"MAIN_INFO_SOCIETE_FAX\",$_POST[\"fax\"],'chaine',0,'',$conf->entity);",
        "// Line_Reference 74: \tdolibarr_set_const($db, \"MAIN_INFO_SOCIETE_MAIL\",$_POST[\"mail\"],'chaine',0,'',$conf->entity);",
        "// Line_Reference 75: \tdolibarr_set_const($db, \"MAIN_INFO_SOCIETE_WEB\",$_POST[\"web\"],'chaine',0,'',$conf->entity);",
        "// Line_Reference 76: \tdolibarr_set_const($db, \"MAIN_INFO_SOCIETE_NOTE\",$_POST[\"note\"],'chaine',0,'',$conf->entity);",
        "// Line_Reference 77: \tdolibarr_set_const($db, \"MAIN_INFO_SOCIETE_GENCOD\",$_POST[\"barcode\"],'chaine',0,'',$conf->entity);",
        "// Line_Reference 78: ",
        "// Line_Reference 103: \t\t\t\t\t    //$object->addThumbs($newfile);    // We can't use addThumbs here yet because we need name of generated thumbs to add them into constants. TODO Check if need such constants. We should be able to retreive value with get...",
        "// Line_Reference 104: ",
        "// Line_Reference 146: ",
        "// Line_Reference 147: \tdolibarr_set_const($db, \"MAIN_INFO_SOCIETE_MANAGERS\",$_POST[\"MAIN_INFO_SOCIETE_MANAGERS\"],'chaine',0,'',$conf->entity);",
        "// Line_Reference 148: \tdolibarr_set_const($db, \"MAIN_INFO_CAPITAL\",$_POST[\"capital\"],'chaine',0,'',$conf->entity);",
        "// Line_Reference 149: \tdolibarr_set_const($db, \"MAIN_INFO_SOCIETE_FORME_JURIDIQUE\",$_POST[\"forme_juridique_code\"],'chaine',0,'',$conf->entity);",
        "// Line_Reference 150: \tdolibarr_set_const($db, \"MAIN_INFO_SIREN\",$_POST[\"siren\"],'chaine',0,'',$conf->entity);",
        "// Line_Reference 151: \tdolibarr_set_const($db, \"MAIN_INFO_SIRET\",$_POST[\"siret\"],'chaine',0,'',$conf->entity);",
        "// Line_Reference 152: \tdolibarr_set_const($db, \"MAIN_INFO_APE\",$_POST[\"ape\"],'chaine',0,'',$conf->entity);",
        "// Line_Reference 153: \tdolibarr_set_const($db, \"MAIN_INFO_RCS\",$_POST[\"rcs\"],'chaine',0,'',$conf->entity);",
        "// Line_Reference 154: \tdolibarr_set_const($db, \"MAIN_INFO_PROFID5\",$_POST[\"MAIN_INFO_PROFID5\"],'chaine',0,'',$conf->entity);",
        "// Line_Reference 155: \tdolibarr_set_const($db, \"MAIN_INFO_PROFID6\",$_POST[\"MAIN_INFO_PROFID6\"],'chaine',0,'',$conf->entity);",
        "// Line_Reference 157: \tdolibarr_set_const($db, \"MAIN_INFO_TVAINTRA\",$_POST[\"tva\"],'chaine',0,'',$conf->entity);",
        "// Line_Reference 158: \tdolibarr_set_const($db, \"MAIN_INFO_SOCIETE_OBJECT\",$_POST[\"object\"],'chaine',0,'',$conf->entity);",
        "// Line_Reference 160: \tdolibarr_set_const($db, \"SOCIETE_FISCAL_MONTH_START\",$_POST[\"fiscalmonthstart\"],'chaine',0,'',$conf->entity);",
        "// Line_Reference 162: \tdolibarr_set_const($db, \"FACTURE_TVAOPTION\",$_POST[\"optiontva\"],'chaine',0,'',$conf->entity);",
        "// Line_Reference 165: \tdolibarr_set_const($db, \"FACTURE_LOCAL_TAX1_OPTION\",$_POST[\"optionlocaltax1\"],'chaine',0,'',$conf->entity);",
        "// Line_Reference 166: \tdolibarr_set_const($db, \"FACTURE_LOCAL_TAX2_OPTION\",$_POST[\"optionlocaltax2\"],'chaine',0,'',$conf->entity);",
        "// Line_Reference 176: \t\t\tdolibarr_set_const($db, \"MAIN_INFO_VALUE_LOCALTAX1\", GETPOST('lt1'),'chaine',0,'',$conf->entity);",
        "// Line_Reference 178: \t\tdolibarr_set_const($db,\"MAIN_INFO_LOCALTAX_CALC1\", $_POST[\"clt1\"],'chaine',0,'',$conf->entity);",
        "// Line_Reference 188: \t\t\tdolibarr_set_const($db, \"MAIN_INFO_VALUE_LOCALTAX2\", GETPOST('lt2'),'chaine',0,'',$conf->entity);",
        "// Line_Reference 190: \t\tdolibarr_set_const($db,\"MAIN_INFO_LOCALTAX_CALC2\", $_POST[\"clt2\"],'chaine',0,'',$conf->entity);",
        "// Line_Reference 210: \t\t    //$object->addThumbs($newfile);    // We can't use addThumbs here yet because we need name of generated thumbs to add them into constants. TODO Check if need such constants. We should be able to retreive value with get...",
        "// Line_Reference 312: ",
        "// Line_Reference 314: \tprint '<input name=\"nom\" id=\"name\" class=\"minwidth200\" value=\"'. ($conf->global->MAIN_INFO_SOCIETE_NOM?$conf->global->MAIN_INFO_SOCIETE_NOM:$_POST[\"nom\"]) . '\" autofocus=\"autofocus\"></td></tr>'.\"\\n\";",
        "// Line_Reference 317: ",
        "// Line_Reference 319: \tprint '<textarea name=\"address\" id=\"address\" class=\"quatrevingtpercent\" rows=\"'.ROWS_3.'\">'. ($conf->global->MAIN_INFO_SOCIETE_ADDRESS?$conf->global->MAIN_INFO_SOCIETE_ADDRESS:$_POST[\"address\"]) . '</textarea></td></tr>'.\"\\n\";",
        "// Line_Reference 321: ",
        "// Line_Reference 323: \tprint '<input class=\"minwidth100\" name=\"zipcode\" id=\"zipcode\" value=\"'. ($conf->global->MAIN_INFO_SOCIETE_ZIP?$conf->global->MAIN_INFO_SOCIETE_ZIP:$_POST[\"zipcode\"]) . '\"></td></tr>'.\"\\n\";",
        "// Line_Reference 325: ",
        "// Line_Reference 327: \tprint '<input name=\"town\" class=\"minwidth100\" id=\"town\" value=\"'. ($conf->global->MAIN_INFO_SOCIETE_TOWN?$conf->global->MAIN_INFO_SOCIETE_TOWN:$_POST[\"town\"]) . '\"></td></tr>'.\"\\n\";",
        "// Line_Reference 330: ",
        "// Line_Reference 337: ",
        "// Line_Reference 342: ",
        "// Line_Reference 347: ",
        "// Line_Reference 352: ",
        "// Line_Reference 357: ",
        "// Line_Reference 363: ",
        "// Line_Reference 370: ",
        "// Line_Reference 377: ",
        "// Line_Reference 395: ",
        "// Line_Reference 397: \tprint '<textarea class=\"flat quatrevingtpercent\" name=\"note\" id=\"note\" rows=\"'.ROWS_5.'\">'.(! empty($conf->global->MAIN_INFO_SOCIETE_NOTE) ? $conf->global->MAIN_INFO_SOCIETE_NOTE : '').'</textarea></td></tr>';",
        "// Line_Reference 412: ",
        "// Line_Reference 417: ",
        "// Line_Reference 422: ",
        "// Line_Reference 434: ",
        "// Line_Reference 450: ",
        "// Line_Reference 466: ",
        "// Line_Reference 482: ",
        "// Line_Reference 498: ",
        "// Line_Reference 514: ",
        "// Line_Reference 528: ",
        "// Line_Reference 532: ",
        "// Line_Reference 534: ",
        "// Line_Reference 549: ",
        "// Line_Reference 564: ",
        "// Line_Reference 573: ",
        "// Line_Reference 596: ",
        "// Line_Reference 619: ",
        "// Line_Reference 640: ",
        "// Line_Reference 660: ",
        "// Line_Reference 696: ",
        "// Line_Reference 702: ",
        "// Line_Reference 705: ",
        "// Line_Reference 708: ",
        "// Line_Reference 711: ",
        "// Line_Reference 722: ",
        "// Line_Reference 728: ",
        "// Line_Reference 736: ",
        "// Line_Reference 739: ",
        "// Line_Reference 742: ",
        "// Line_Reference 746: ",
        "// Line_Reference 752: ",
        "// Line_Reference 757: ",
        "// Line_Reference 783: ",
        "// Line_Reference 799: ",
        "// Line_Reference 804: ",
        "// Line_Reference 809: ",
        "// Line_Reference 817: ",
        "// Line_Reference 833: ",
        "// Line_Reference 849: ",
        "// Line_Reference 865: ",
        "// Line_Reference 881: ",
        "// Line_Reference 897: ",
        "// Line_Reference 911: ",
        "// Line_Reference 947: ",
        "// Line_Reference 948: ",
        "// Line_Reference 963: ",
        "// Line_Reference 980: ",
        "// Line_Reference 989: ",
        "// Line_Reference 1014: ",
        "// Line_Reference 1042: ",
        "// Line_Reference 1064: ",
        "// Line_Reference 1093: "
    ]
}
