[Test]
public void should_throw_UnsuccessfulCommandExecutionException_if_connection_to_updater_service_fails()
{
_sleeper.Expect(x => x.Sleep(Arg<int>.Is.Anything));
_connectionChecker.Stub(x => x.Check())
.Throw(new UnsuccessfulCommandExecutionException("error message", new ExecutableResult { ExitCode = "1" }));
var result = _xentoolsUpdate.Execute(_agentUpdateInfo);
Assert.That(result.ExitCode, Is.EqualTo("1"));
Assert.That(result.Error[0], Is.EqualTo("Update failed"));
}