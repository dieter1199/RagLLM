if(!lockAction("checkuser")) {
//returns array (username, email address, name)
function getUserInformation($user_id) {
$user_id = escape($user_id);
$result = mysql_query("SELECT username, email, name FROM users WHERE id='$user_id'");
if($row = mysql_fetch_array($result)) {
return array($row[0], $row[1], $row[2]);
//returns array (username, email address, club name)
function getAdminInformation($admin_id) {
$admin_id = escape($admin_id);
$club_id = getAdminClub($admin_id);
$result = mysql_query("SELECT a.username, a.email, c.name FROM admins a, clubs c WHERE a.id='$admin_id' AND c.id='$club_id'");
if(!lockAction("checkuser")) {
function addAdmin($username, $password, $email, $club_id) {
$username = escape($username);
$password = escape(chash($password));
$email = escape($email);
$result = mysql_query("INSERT INTO admins (username, password, email, club_id) VALUES ('$username', '$password', '$email', '$club_id')");
}
function updateAdmin($admin_id, $username, $password, $email, $club_id) {
$admin_id = escape($admin_id);
$setString = "";
if(strlen($username) > 0) {
$setString .= ", username = '" . escape($username) . "'";
}
if(strlen($password) > 0) {
$setString .= ", password = '" . escape(chash($password)) . "'";
}
if(strlen($email) > 0) {
$setString .= ", email = '" . escape($email) . "'";
}
if(strlen($club_id) > 0) {
$setString .= ", club_id = '" . escape($club_id) . "'";
}
if(strlen($setString) > 0) {
$setString = substr($setString, 2);
$result = mysql_query("UPDATE admins SET $setString WHERE id='$admin_id'");
}
}
function checkAdmin($username, $password) {
if(!checkLock("checkadmin")) {
return FALSE;
}
$username = escape($username);
$password = escape(chash($password));
$result = mysql_query("SELECT id, password FROM admins WHERE username='" . $username . "'");
if($row = mysql_fetch_array($result)) {
if(strcmp($password, $row['password']) == 0) {
return $row['id'];
lockAction("checkadmin");
return FALSE;
lockAction("checkadmin");
return FALSE;
//returns admin ID, or false on failure
function getAdminClub($admin_id) {
$admin_id = escape($admin_id);
$result = mysql_query("SELECT club_id FROM admins WHERE id='$admin_id'");
if($row = mysql_fetch_array($result)) {
return $row[0];
return FALSE;
function checkRoot($password) {
if(!checkLock("root")) {
return FALSE;
}
$config = $GLOBALS['config'];
$root_password = $config['root_password'];
if(substr($root_password, 0, 1) == ':') { //rest of root password is actually a hash
$root_password = substr($root_password, 1);
$password = chash($config['root_password_salt'] . $password);
if($password == $root_password) {
return true;
} else {
lockAction("root");
return false;
//1: success; -1: invalid password
function changeAdminPassword($admin_id, $password){
if(validPassword($password) != 0) {
return -1;
} else {
mysql_query("UPDATE admins SET password = '" . escape(chash($password)) . "' WHERE id='" . $admin_id . "'");
return 1;
}
//1: success; -1: invalid password, -2 password doesnt match
function changeAdminPass($admin_id, $password, $verify){
if($password != $verify){
return -2;
} else if(validPassword($password) != 0) {
return -1;
} else {
mysql_query("UPDATE admins SET password = '" . escape(chash($password)) . "' WHERE id='" . $admin_id . "'");
return 1;
