int fd = -1, ofd = -1, ret, ifindex = -1;
fprintf(stderr, "Failed opening network namespace path for '%d'.", getpid());
return -1;
fprintf(stderr, "Failed opening network namespace path for '%d'.", pid);
return -1;
if (setns(fd, 0) < 0) {
fprintf(stderr, "setns to container network namespace\n");
goto out_err;
close(fd); fd = -1;
if (!(ifindex = if_nametoindex(oldname))) {
fprintf(stderr, "failed to get netdev index\n");
goto out_err;
if ((ret = lxc_netdev_rename_by_name(oldname, *newnamep)) < 0) {
fprintf(stderr, "Error %d renaming netdev %s to %s in container\n", ret, oldname, *newnamep);
goto out_err;
char ifname[IFNAMSIZ], *namep = ifname;
fprintf(stderr, "Failed to get new netdev name\n");
goto out_err;
goto out_err;
if (setns(ofd, 0) < 0) {
fprintf(stderr, "Error returning to original netns\n");
close(ofd);
return -1;
close(ofd);
return 0;
out_err:
if (ofd >= 0)
close(ofd);
if (setns(ofd, 0) < 0)
fprintf(stderr, "Error returning to original network namespace\n");
return -1;
