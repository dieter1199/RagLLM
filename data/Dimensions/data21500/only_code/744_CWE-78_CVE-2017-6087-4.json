$bdd = new PDO('mysql:host=localhost;dbname=nagiosbp', 'root', 'root66');
$sql = "delete from bp where name = '" . $bp . "'";
$bdd->exec($sql);
$sql = "delete from bp_services where bp_name = '" . $bp . "'";
$bdd->exec($sql);
$sql = "delete from bp_links where bp_name = '" . $bp . "'";
$bdd->exec($sql);
$sql = "delete from bp_links where bp_link = '" . $bp . "'";
$bdd->exec($sql);
$sql = "select name from bp where is_define = 1 and name!='".$bp."' and priority = '" . $display . "'";
$req = $bdd->query($sql);
$sql = "select service,host from bp_services where bp_name = '" . $bp . "'";
$req = $bdd->query($sql);
$sql = "delete from bp_services where bp_name = '" . $bp . "'";
$bdd->exec($sql);
$sql = "update bp set is_define = 1 where name = '" . $bp . "'";
$bdd->exec($sql);
$sql = "update bp set is_define = 0 where name = '" . $bp . "'";
$bdd->exec($sql);
$sql = "insert into bp_services (bp_name,host,service) values('" . trim($bp) . "','" . $host . "','" . $service . "')";
$bdd->exec($sql);
$sql = "delete from bp_links where bp_name = '" . $bp . "'";
$bdd->exec($sql);
$sql = "update bp set is_define = 0 where name = '" . $bp . "'";
$bdd->exec($sql);
$sql = "update bp set is_define = 1 where name = '" . $bp . "'";
$bdd->exec($sql);
$sql = "insert into bp_links (bp_name,bp_link) values('" . $bp . "','" . $bp_link . "')";
$bdd->exec($sql);
$sql = "select count(*) from bp where name = '" . $uniq_name . "';";
$req = $bdd->query($sql);
$sql = "select count(*) from bp where name = '" . $uniq_name . "';";
$req = $bdd->query($sql);
$sql = "insert into bp (name,description,priority,type,command,url,min_value) values('" . $uniq_name ."','" . $process_name ."','" . $display . "','" . $type . "','" . $command . "','" . $url . "','" . $min_value . "')";
$bdd->exec($sql);
$sql = "update bp set name = '" . $uniq_name . "',description = '" . $process_name . "',priority = '" . $display . "',type = '" . $type . "',command = '" . $command . "',url = '" . $url . "',min_value = '" . $min_value . "' where name = '" . $uniq_name_orig . "'";
$bdd->exec($sql);
$sql = "update bp_links set bp_name = '" . $uniq_name . "' where bp_name = '" . $uniq_name_orig . "'";
$bdd->exec($sql);
$sql = "update bp_links set bp_link = '" . $uniq_name . "' where bp_link = '" . $uniq_name_orig . "'";
$bdd->exec($sql);
$sql = "update bp_services set bp_name = '" . $uniq_name . "' where bp_name = '" . $uniq_name_orig . "'";
$bdd->exec($sql);
$sql = "update bp set name = '" . $uniq_name . "',description = '" . $process_name . "',priority = '" . $display . "',type = '" . $type . "',command = '" . $command . "',url = '" . $url . "',min_value = '" . $min_value . "' where name = '" . $uniq_name . "'";
$bdd->exec($sql);
$sql = "SELECT bp_link FROM bp_links where bp_name='".$bp_informations['name']."'";
$req = $bdd->query($sql);
$sql = "SELECT * FROM bp where is_define ='1' and name='".$bp_link["bp_link"]."'";
$req = $bdd->query($sql);
$sql = "select host,service from bp_services where bp_name = '" . $bp_informations['name'] . "'";
$req = $bdd->query($sql);
$sql = "select bp_link from bp_links where bp_name = '" .$bp_informations['name'] . "'";
$req = $bdd->query($sql);
$sql = "select * from bp where name = '" . $bp_name . "'";
$req = $bdd->query($sql);
