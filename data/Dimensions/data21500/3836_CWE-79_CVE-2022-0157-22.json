{
    "cve_id": "CVE-2022-0157",
    "cve_description": "phoronix-test-suite is vulnerable to Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting')",
    "cve_publish_date": "2022-01-10",
    "cwe_id": "CWE-79",
    "cwe_name": "Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting')",
    "cwe_description": "The product does not neutralize or incorrectly neutralizes user-controllable input before it is placed in output that is used as a web page that is served to other users.",
    "commit_message": "phodevi: Input sanitization updates for Phoromatic Server\n\nAlso other code formatting / cleanups while reviewing the code...",
    "type_of_change": "Modification",
    "filename_of_changes": "phoromatic_sched.php",
    "code_language": "PHP",
    "number_of_lines_added_for_mitigation": "42",
    "number_of_lines_deleted_vulnerable_to_cve": "43",
    "vulnerable_lines": [
        "// Line_Reference 6: \tCopyright (C) 2014 - 2017, Phoronix Media",
        "// Line_Reference 7: \tCopyright (C) 2014 - 2017, Michael Larabel",
        "// Line_Reference 23: ",
        "// Line_Reference 239: \t\t\t<p><select name=\"schedule_hour\" id=\"schedule_hour\">';",
        "// Line_Reference 240: ",
        "// Line_Reference 241: \t\t\tif(!$is_new)",
        "// Line_Reference 242: \t\t\t{",
        "// Line_Reference 243: \t\t\t\t$run_at = explode('.', $e_schedule['RunAt']);",
        "// Line_Reference 244: \t\t\t\t$days_active = !empty($e_schedule['ActiveOn']) ? explode(',', $e_schedule['ActiveOn']) : array();",
        "// Line_Reference 245: \t\t\t}",
        "// Line_Reference 247: \t\t\tfor($i = 0; $i <= 23; $i++)",
        "// Line_Reference 248: \t\t\t{",
        "// Line_Reference 249: \t\t\t\t$i_f = (strlen($i) == 1 ? '0' . $i : $i);",
        "// Line_Reference 250: \t\t\t\t$main .= '<option value=\"' . $i_f . '\"' . (!$is_new && $run_at[0] == $i ? 'selected=\"selected\" ' : null) . '>' . $i_f . '</option>';",
        "// Line_Reference 251: \t\t\t}",
        "// Line_Reference 252: ",
        "// Line_Reference 253: \t\t\t$main .= '</select> <select name=\"schedule_minute\" id=\"schedule_minute\">';",
        "// Line_Reference 255: \t\t\tfor($i = 0; $i < 60; $i += 10)",
        "// Line_Reference 256: \t\t\t{",
        "// Line_Reference 257: \t\t\t\t$i_f = (strlen($i) == 1 ? '0' . $i : $i);",
        "// Line_Reference 258: \t\t\t\t$main .= '<option value=\"' . $i_f . '\"' . (!$is_new && $run_at[1] == $i ? 'selected=\"selected\" ' : null) . '>' . $i_f . '</option>';",
        "// Line_Reference 259: \t\t\t}",
        "// Line_Reference 261: \t\t\t$main .= '</select><h3>Active On:</h3><p>';",
        "// Line_Reference 262: \t\t\t$week = array('Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday', 'Sunday');",
        "// Line_Reference 263: \t\t\tforeach($week as $index => $day)",
        "// Line_Reference 264: \t\t\t{",
        "// Line_Reference 265: \t\t\t\t$main .= '<input type=\"checkbox\" name=\"days_active[]\" value=\"' . $index . '\"' . (!$is_new && in_array($index, $days_active) ? 'checked=\"checked\" ' : null) . '/> ' . $day;",
        "// Line_Reference 266: \t\t\t}",
        "// Line_Reference 268: \t\t\t$main .= '</p></td>",
        "// Line_Reference 269: </tr>",
        "// Line_Reference 270: <tr>",
        "// Line_Reference 271:   <td><h3>Trigger-Based Testing</h3><em>To carry out trigger-based testing, you can simply have an external process/script trigger (&quot;ping&quot;) a specialized URL whenever an event occurs to commence a new round of testing. This is the most customizable approach to having Phoromatic run tests on a system if you wish to have it occur whenever a Git/SVN commit takes place or other operations.</em></td>",
        "// Line_Reference 272:   <td><h3>Once creating the test schedule there will be a specialized URL you can use for &quot;pinging&quot; where you can pass it a Git commit hash, SVN revision number, date, or other unique identifiers to externally trigger the test schedules and systems to begin testing. This custom trigger is passed to any of the used context scripts for setting up the system in an appropriate state.</h3></td>",
        "// Line_Reference 273: </tr>",
        "// Line_Reference 274: <tr>",
        "// Line_Reference 275:   <td><h3>One-Time / Manual Testing</h3><em>Carrying out Phoromatic-controlled benchmark on no routine schedule, similar to the trigger-based testing.</em></td>",
        "// Line_Reference 276:   <td><h3>If you wish to only run a set of tests once on a given system or to do so seldom with the same set of tests, simply proceed with creating the test schedule without setting any run time / active days. When going to the web page for this test schedule there will be a button to trigger the tests to run on all affected systems. One-time benchmarking can also be setup via the <a href=\"?benchmark\">Run A Benchmark</a> page.</h3></td>",
        "// Line_Reference 277: </tr>",
        "// Line_Reference 278: </table>';",
        "// Line_Reference 280: $main .= (empty($env_var_edit) ? '<p><a id=\"env_var_options_show\" onclick=\"javascript:document.getElementById(\\'env_var_options\\').style.display = \\'block\\'; javascript:document.getElementById(\\'env_var_options_show\\').style.display = \\'none\\'; \">Advanced Options</a></p> <div id=\"env_var_options\" style=\"display: none;\">' : '<div id=\"env_var_options\">') . '<p>The advanced options require the Phoromatic clients be on the latest Phoronix Test Suite (10.8 or newer / Git). See the Phoronix Test Suite documentation for more information on these environment variables / advanced options.</p>' . pts_env::get_html_options('phoromatic', $env_var_edit) . '</div>';",
        "// Line_Reference 282: $main .= '<p align=\"right\"><input name=\"submit\" value=\"' . ($is_new ? 'Create' : 'Edit') . ' Schedule\" type=\"submit\" onclick=\"return pts_rmm_validate_schedule();\" /></p>",
        "// Line_Reference 284: \t\t\techo phoromatic_webui_main($main);",
        "// Line_Reference 285: \t\t\techo phoromatic_webui_footer();"
    ]
}
