{
    "cve_id": "CVE-2023-6831",
    "cve_description": "Path Traversal: '\\..\\filename' in GitHub repository mlflow/mlflow prior to 2.9.2.",
    "cve_publish_date": "2023-12-15",
    "cwe_id": "CWE-22",
    "cwe_name": "Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal')",
    "cwe_description": "The product uses external input to construct a pathname that is intended to identify a file or directory that is located underneath a restricted parent directory, but the product does not properly neutralize special elements within the pathname that can cause the pathname to resolve to a location that is outside of the restricted directory.",
    "commit_message": "Prevent path traversal with encoded URL (#10650)\n\nSigned-off-by: B-Step62 <yuki.watanabe@databricks.com>",
    "type_of_change": "Modification",
    "filename_of_changes": "test_rest_tracking.py",
    "code_language": "Python",
    "number_of_lines_added_for_mitigation": "1",
    "number_of_lines_deleted_vulnerable_to_cve": "148",
    "vulnerable_lines": [
        "// Line_Reference 38: from mlflow.server.handlers import validate_path_is_safe",
        "// Line_Reference 517: @pytest.mark.parametrize(",
        "// Line_Reference 518:     \"path\",",
        "// Line_Reference 519:     [",
        "// Line_Reference 520:         \"path\",",
        "// Line_Reference 521:         \"path/\",",
        "// Line_Reference 522:         \"path/to/file\",",
        "// Line_Reference 523:     ],",
        "// Line_Reference 524: )",
        "// Line_Reference 525: def test_validate_path_is_safe_good(path):",
        "// Line_Reference 526:     validate_path_is_safe(path)",
        "// Line_Reference 527: ",
        "// Line_Reference 528: ",
        "// Line_Reference 529: @pytest.mark.skipif(not is_windows(), reason=\"This test only passes on Windows\")",
        "// Line_Reference 530: @pytest.mark.parametrize(",
        "// Line_Reference 531:     \"path\",",
        "// Line_Reference 532:     [",
        "// Line_Reference 533:         # relative path from current directory of C: drive",
        "// Line_Reference 534:         \".../...//\",",
        "// Line_Reference 535:     ],",
        "// Line_Reference 536: )",
        "// Line_Reference 537: def test_validate_path_is_safe_windows_good(path):",
        "// Line_Reference 538:     validate_path_is_safe(path)",
        "// Line_Reference 539: ",
        "// Line_Reference 540: ",
        "// Line_Reference 541: @pytest.mark.skipif(is_windows(), reason=\"This test does not pass on Windows\")",
        "// Line_Reference 542: @pytest.mark.parametrize(",
        "// Line_Reference 543:     \"path\",",
        "// Line_Reference 544:     [",
        "// Line_Reference 545:         \"/path\",",
        "// Line_Reference 546:         \"../path\",",
        "// Line_Reference 547:         \"../../path\",",
        "// Line_Reference 548:         \"./../path\",",
        "// Line_Reference 549:         \"path/../to/file\",",
        "// Line_Reference 550:         \"path/../../to/file\",",
        "// Line_Reference 551:         \"file://a#/..//tmp\",",
        "// Line_Reference 552:         \"file://a%23/..//tmp/\",",
        "// Line_Reference 553:         \"/etc/passwd\",",
        "// Line_Reference 554:         \"/etc/passwd%00.jpg\",",
        "// Line_Reference 555:         \"/etc/passwd%00.html\",",
        "// Line_Reference 556:         \"/etc/passwd%00.txt\",",
        "// Line_Reference 557:         \"/etc/passwd%00.php\",",
        "// Line_Reference 558:         \"/etc/passwd%00.asp\",",
        "// Line_Reference 559:         \"/file://etc/passwd\",",
        "// Line_Reference 560:     ],",
        "// Line_Reference 561: )",
        "// Line_Reference 562: def test_validate_path_is_safe_bad(path):",
        "// Line_Reference 563:     with pytest.raises(MlflowException, match=\"Invalid path\"):",
        "// Line_Reference 564:         validate_path_is_safe(path)",
        "// Line_Reference 565: ",
        "// Line_Reference 566: ",
        "// Line_Reference 567: @pytest.mark.skipif(not is_windows(), reason=\"This test only passes on Windows\")",
        "// Line_Reference 568: @pytest.mark.parametrize(",
        "// Line_Reference 569:     \"path\",",
        "// Line_Reference 570:     [",
        "// Line_Reference 571:         r\"../path\",",
        "// Line_Reference 572:         r\"../../path\",",
        "// Line_Reference 573:         r\"./../path\",",
        "// Line_Reference 574:         r\"path/../to/file\",",
        "// Line_Reference 575:         r\"path/../../to/file\",",
        "// Line_Reference 576:         r\"..\\path\",",
        "// Line_Reference 577:         r\"..\\..\\path\",",
        "// Line_Reference 578:         r\".\\..\\path\",",
        "// Line_Reference 579:         r\"path\\..\\to\\file\",",
        "// Line_Reference 580:         r\"path\\..\\..\\to\\file\",",
        "// Line_Reference 581:         # Drive-relative paths",
        "// Line_Reference 582:         r\"C:path\",",
        "// Line_Reference 583:         r\"C:path/\",",
        "// Line_Reference 584:         r\"C:path/to/file\",",
        "// Line_Reference 585:         r\"C:../path/to/file\",",
        "// Line_Reference 586:         r\"C:\\path\",",
        "// Line_Reference 587:         r\"C:/path\",",
        "// Line_Reference 588:         r\"C:\\path\\to\\file\",",
        "// Line_Reference 589:         r\"C:\\path/to/file\",",
        "// Line_Reference 590:         r\"C:\\path\\..\\to\\file\",",
        "// Line_Reference 591:         r\"C:/path/../to/file\",",
        "// Line_Reference 592:         # UNC(Universal Naming Convention) paths",
        "// Line_Reference 593:         r\"\\\\path\\to\\file\",",
        "// Line_Reference 594:         r\"\\\\path/to/file\",",
        "// Line_Reference 595:         r\"\\\\.\\\\C:\\path\\to\\file\",",
        "// Line_Reference 596:         r\"\\\\?\\C:\\path\\to\\file\",",
        "// Line_Reference 597:         r\"\\\\?\\UNC/path/to/file\",",
        "// Line_Reference 598:         # Other potential attackable paths",
        "// Line_Reference 599:         r\"/etc/password\",",
        "// Line_Reference 600:         r\"/path\",",
        "// Line_Reference 601:         r\"/etc/passwd%00.jpg\",",
        "// Line_Reference 602:         r\"/etc/passwd%00.html\",",
        "// Line_Reference 603:         r\"/etc/passwd%00.txt\",",
        "// Line_Reference 604:         r\"/etc/passwd%00.php\",",
        "// Line_Reference 605:         r\"/etc/passwd%00.asp\",",
        "// Line_Reference 606:         r\"/Windows/no/such/path\",",
        "// Line_Reference 607:         r\"/file://etc/passwd\",",
        "// Line_Reference 608:         r\"/file:c:/passwd\",",
        "// Line_Reference 609:         r\"/file://d:/windows/win.ini\",",
        "// Line_Reference 610:         r\"/file://./windows/win.ini\",",
        "// Line_Reference 611:         r\"file://c:/boot.ini\",",
        "// Line_Reference 612:         r\"file://C:path\",",
        "// Line_Reference 613:         r\"file://C:path/\",",
        "// Line_Reference 614:         r\"file://C:path/to/file\",",
        "// Line_Reference 615:         r\"file:///C:/Windows/System32/\",",
        "// Line_Reference 616:         r\"file:///etc/passwd\",",
        "// Line_Reference 617:         r\"file:///d:/windows/repair/sam\",",
        "// Line_Reference 618:         r\"file:///proc/version\",",
        "// Line_Reference 619:         r\"file:///inetpub/wwwroot/global.asa\",",
        "// Line_Reference 620:         r\"/file://../windows/win.ini\",",
        "// Line_Reference 621:         r\"../etc/passwd\",",
        "// Line_Reference 622:         r\"..\\Windows\\System32\\\\\",",
        "// Line_Reference 623:         r\"C:\\Windows\\System32\\\\\",",
        "// Line_Reference 624:         r\"/etc/passwd\",",
        "// Line_Reference 625:         r\"::Windows\\System32\",",
        "// Line_Reference 626:         r\"..\\..\\..\\..\\Windows\\System32\\\\\",",
        "// Line_Reference 627:         r\"../Windows/System32\",",
        "// Line_Reference 628:         r\"....\\\\\",",
        "// Line_Reference 629:         r\"\\\\?\\C:\\Windows\\System32\\\\\",",
        "// Line_Reference 630:         r\"\\\\.\\C:\\Windows\\System32\\\\\",",
        "// Line_Reference 631:         r\"\\\\UNC\\Server\\Share\\\\\",",
        "// Line_Reference 632:         r\"\\\\Server\\Share\\folder\\\\\",",
        "// Line_Reference 633:         r\"\\\\127.0.0.1\\c$\\Windows\\\\\",",
        "// Line_Reference 634:         r\"\\\\localhost\\c$\\Windows\\\\\",",
        "// Line_Reference 635:         r\"\\\\smbserver\\share\\path\\\\\",",
        "// Line_Reference 636:         r\"..\\\\?\\C:\\Windows\\System32\\\\\",",
        "// Line_Reference 637:         r\"C:/Windows/../Windows/System32/\",",
        "// Line_Reference 638:         r\"C:\\Windows\\..\\Windows\\System32\\\\\",",
        "// Line_Reference 639:         r\"../../../../../../../../../../../../Windows/System32\",",
        "// Line_Reference 640:         r\"../../../../../../../../../../../../etc/passwd\",",
        "// Line_Reference 641:         r\"../../../../../../../../../../../../var/www/html/index.html\",",
        "// Line_Reference 642:         r\"../../../../../../../../../../../../usr/local/etc/openvpn/server.conf\",",
        "// Line_Reference 643:         r\"../../../../../../../../../../../../Program Files (x86)\",",
        "// Line_Reference 644:         r\"/../../../../../../../../../../../../Windows/System32\",",
        "// Line_Reference 645:         r\"/Windows\\../etc/passwd\",",
        "// Line_Reference 646:         r\"/Windows\\..\\Windows\\System32\\\\\",",
        "// Line_Reference 647:         r\"/Windows\\..\\Windows\\System32\\cmd.exe\",",
        "// Line_Reference 648:         r\"/Windows\\..\\Windows\\System32\\msconfig.exe\",",
        "// Line_Reference 649:         r\"/Windows\\..\\Windows\\System32\\regedit.exe\",",
        "// Line_Reference 650:         r\"/Windows\\..\\Windows\\System32\\taskmgr.exe\",",
        "// Line_Reference 651:         r\"/Windows\\..\\Windows\\System32\\control.exe\",",
        "// Line_Reference 652:         r\"/Windows\\..\\Windows\\System32\\services.msc\",",
        "// Line_Reference 653:         r\"/Windows\\..\\Windows\\System32\\diskmgmt.msc\",",
        "// Line_Reference 654:         r\"/Windows\\..\\Windows\\System32\\eventvwr.msc\",",
        "// Line_Reference 655:         r\"/Windows/System32/drivers/etc/hosts\",",
        "// Line_Reference 656:     ],",
        "// Line_Reference 657: )",
        "// Line_Reference 658: def test_validate_path_is_safe_windows_bad(path):",
        "// Line_Reference 659:     with pytest.raises(MlflowException, match=\"Invalid path\"):",
        "// Line_Reference 660:         validate_path_is_safe(path)",
        "// Line_Reference 661: ",
        "// Line_Reference 662: ",
        "// Line_Reference 673:             \"message\": f\"Invalid path: {invalid_path}\","
    ]
}
