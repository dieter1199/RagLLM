{
    "cve_id": "CVE-2011-4131",
    "cve_description": "The NFSv4 implementation in the Linux kernel before 3.2.2 does not properly handle bitmap sizes in GETACL replies, which allows remote NFS servers to cause a denial of service (OOPS) by sending an excessive number of bitmap words.",
    "cve_publish_date": "2012-05-17",
    "cwe_id": "CWE-189",
    "cwe_name": "Numeric Errors",
    "cwe_description": "Weaknesses in this category are related to improper calculation or conversion of numbers.",
    "commit_message": "NFSv4: include bitmap in nfsv4 get acl data\n\nThe NFSv4 bitmap size is unbounded: a server can return an arbitrary\nsized bitmap in an FATTR4_WORD0_ACL request.  Replace using the\nnfs4_fattr_bitmap_maxsz as a guess to the maximum bitmask returned by a server\nwith the inclusion of the bitmap (xdr length plus bitmasks) and the acl data\nxdr length to the (cached) acl page data.\n\nThis is a general solution to commit e5012d1f \"NFSv4.1: update\nnfs4_fattr_bitmap_maxsz\" and fixes hitting a BUG_ON in xdr_shrink_bufhead\nwhen getting ACLs.\n\nFix a bug in decode_getacl that returned -EINVAL on ACLs > page when getxattr\nwas called with a NULL buffer, preventing ACL > PAGE_SIZE from being retrieved.\n\nCc: stable@kernel.org\nSigned-off-by: Andy Adamson <andros@netapp.com>\nSigned-off-by: Trond Myklebust <Trond.Myklebust@netapp.com>",
    "type_of_change": "Modification",
    "filename_of_changes": "nfs4xdr.c",
    "code_language": "C",
    "number_of_lines_added_for_mitigation": "23",
    "number_of_lines_deleted_vulnerable_to_cve": "8",
    "vulnerable_lines": [
        "// Line_Reference 2520: \treplen = hdr.replen + op_decode_hdr_maxsz + nfs4_fattr_bitmap_maxsz + 1;",
        "// Line_Reference 4960: \t\tsize_t *acl_len)",
        "// Line_Reference 4962: \t__be32 *savep;",
        "// Line_Reference 4968: \t*acl_len = 0;",
        "// Line_Reference 4987: \t\t\tdprintk(\"NFS: server cheating in getattr\"",
        "// Line_Reference 4988: \t\t\t\t\t\" acl reply: attrlen %u > recvd %u\\n\",",
        "// Line_Reference 4993: \t\t*acl_len = attrlen;",
        "// Line_Reference 6031: \tstatus = decode_getacl(xdr, rqstp, &res->acl_len);"
    ]
}
