{
    "cve_id": "CVE-2017-15128",
    "cve_description": "A flaw was found in the hugetlb_mcopy_atomic_pte function in mm/hugetlb.c in the Linux kernel before 4.13.12. A lack of size check could cause a denial of service (BUG).",
    "cve_publish_date": "2018-01-14",
    "cwe_id": "CWE-119",
    "cwe_name": "Improper Restriction of Operations within the Bounds of a Memory Buffer",
    "cwe_description": "The product performs operations on a memory buffer, but it reads from or writes to a memory location outside the buffer's intended boundary. This may result in read or write operations on unexpected memory locations that could be linked to other variables, data structures, or internal program data.",
    "commit_message": "userfaultfd: hugetlbfs: prevent UFFDIO_COPY to fill beyond the end of i_size\n\nThis oops:\n\n  kernel BUG at fs/hugetlbfs/inode.c:484!\n  RIP: remove_inode_hugepages+0x3d0/0x410\n  Call Trace:\n    hugetlbfs_setattr+0xd9/0x130\n    notify_change+0x292/0x410\n    do_truncate+0x65/0xa0\n    do_sys_ftruncate.constprop.3+0x11a/0x180\n    SyS_ftruncate+0xe/0x10\n    tracesys+0xd9/0xde\n\nwas caused by the lack of i_size check in hugetlb_mcopy_atomic_pte.\n\nmmap() can still succeed beyond the end of the i_size after vmtruncate\nzapped vmas in those ranges, but the faults must not succeed, and that\nincludes UFFDIO_COPY.\n\nWe could differentiate the retval to userland to represent a SIGBUS like\na page fault would do (vs SIGSEGV), but it doesn't seem very useful and\nwe'd need to pick a random retval as there's no meaningful syscall\nretval that would differentiate from SIGSEGV and SIGBUS, there's just\n-EFAULT.\n\nLink: http://lkml.kernel.org/r/20171016223914.2421-2-aarcange@redhat.com\nSigned-off-by: Andrea Arcangeli <aarcange@redhat.com>\nReviewed-by: Mike Kravetz <mike.kravetz@oracle.com>\nCc: Mike Rapoport <rppt@linux.vnet.ibm.com>\nCc: \"Dr. David Alan Gilbert\" <dgilbert@redhat.com>\nCc: <stable@vger.kernel.org>\nSigned-off-by: Andrew Morton <akpm@linux-foundation.org>\nSigned-off-by: Linus Torvalds <torvalds@linux-foundation.org>",
    "type_of_change": "Modification",
    "filename_of_changes": "hugetlb.c",
    "code_language": "C",
    "number_of_lines_added_for_mitigation": "30",
    "number_of_lines_deleted_vulnerable_to_cve": "2",
    "vulnerable_lines": [
        "// Line_Reference 4028: \t\tstruct address_space *mapping = dst_vma->vm_file->f_mapping;",
        "// Line_Reference 4029: \t\tpgoff_t idx = vma_hugecache_offset(h, dst_vma, dst_addr);"
    ]
}
