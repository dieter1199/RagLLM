{
    "cve_id": "CVE-2019-11340",
    "cve_description": "util/emailutils.py in Matrix Sydent before 1.0.2 mishandles registration restrictions that are based on e-mail domain, if the allowed_local_3pids option is enabled. This occurs because of potentially unwanted behavior in Python, in which an email.utils.parseaddr call on user@bad.example.net@good.example.com returns the user@bad.example.net substring.",
    "cve_publish_date": "2019-04-19",
    "cwe_id": "CWE-20",
    "cwe_name": "Improper Input Validation",
    "cwe_description": "The product receives input or data, but it does\n        not validate or incorrectly validates that the input has the\n        properties that are required to process the data safely and\n        correctly.",
    "commit_message": "Require that parsed mail addresses match raw input\n\nPython's email parser turns malformed addresses into valid ones\nby removing anything after and including the second '@'. This\nmeant that sydent sent emails to the validated address but stored\nthe raw address as validated.\n\nThis rejects any requests where the parsed email address does not\nmatch the raw input.",
    "type_of_change": "Modification",
    "filename_of_changes": "emailutils.py",
    "code_language": "Python",
    "number_of_lines_added_for_mitigation": "11",
    "number_of_lines_deleted_vulnerable_to_cve": "5",
    "vulnerable_lines": [
        "// Line_Reference 58:         mailString = open(mailTemplateFile).read() % allSubstitutions",
        "// Line_Reference 59:         rawFrom = email.utils.parseaddr(mailFrom)[1]",
        "// Line_Reference 60:         rawTo = email.utils.parseaddr(mailTo)[1]",
        "// Line_Reference 61:         if rawFrom == '' or rawTo == '':",
        "// Line_Reference 80:             smtp.sendmail(rawFrom, rawTo, mailString.encode('utf-8'))"
    ]
}
