{
    "cve_id": "CVE-2024-32983",
    "cve_description": "Misskey is an open source, decentralized microblogging platform. Misskey doesn't perform proper normalization on the JSON structures of incoming signed ActivityPub activity objects before processing them, allowing threat actors to spoof the contents of signed activities and impersonate the authors of the original activities. This vulnerability is fixed in 2024.5.0.",
    "cve_publish_date": "2024-06-03",
    "cwe_id": "NVD-CWE-noinfo",
    "cwe_name": "Insufficient Information",
    "cwe_description": "There is insufficient information about the issue to classify it; details are unkown or unspecified.",
    "commit_message": "Merge pull request from GHSA-2vxv-pv3m-3wvj\n\n* fix: normalize incoming signed activities\n\n* Tweak style\n\n* Update CHANGELOG.md\n\n* Log compacted activity as well\n\n---------\n\nCo-authored-by: syuilo <4439005+syuilo@users.noreply.github.com>",
    "type_of_change": "Modification",
    "filename_of_changes": "ApRendererService.ts",
    "code_language": "TypeScript",
    "number_of_lines_added_for_mitigation": "7",
    "number_of_lines_deleted_vulnerable_to_cve": "38",
    "vulnerable_lines": [
        "// Line_Reference 31: import { LdSignatureService } from './LdSignatureService.js';",
        "// Line_Reference 59: \t\tprivate ldSignatureService: LdSignatureService,",
        "// Line_Reference 620: \t\treturn Object.assign({",
        "// Line_Reference 621: \t\t\t'@context': [",
        "// Line_Reference 622: \t\t\t\t'https://www.w3.org/ns/activitystreams',",
        "// Line_Reference 623: \t\t\t\t'https://w3id.org/security/v1',",
        "// Line_Reference 624: \t\t\t\t{",
        "// Line_Reference 625: \t\t\t\t\tKey: 'sec:Key',",
        "// Line_Reference 626: \t\t\t\t\t// as non-standards",
        "// Line_Reference 627: \t\t\t\t\tmanuallyApprovesFollowers: 'as:manuallyApprovesFollowers',",
        "// Line_Reference 628: \t\t\t\t\tsensitive: 'as:sensitive',",
        "// Line_Reference 629: \t\t\t\t\tHashtag: 'as:Hashtag',",
        "// Line_Reference 630: \t\t\t\t\tquoteUrl: 'as:quoteUrl',",
        "// Line_Reference 631: \t\t\t\t\t// Mastodon",
        "// Line_Reference 632: \t\t\t\t\ttoot: 'http://joinmastodon.org/ns#',",
        "// Line_Reference 633: \t\t\t\t\tEmoji: 'toot:Emoji',",
        "// Line_Reference 634: \t\t\t\t\tfeatured: 'toot:featured',",
        "// Line_Reference 635: \t\t\t\t\tdiscoverable: 'toot:discoverable',",
        "// Line_Reference 636: \t\t\t\t\t// schema",
        "// Line_Reference 637: \t\t\t\t\tschema: 'http://schema.org#',",
        "// Line_Reference 638: \t\t\t\t\tPropertyValue: 'schema:PropertyValue',",
        "// Line_Reference 639: \t\t\t\t\tvalue: 'schema:value',",
        "// Line_Reference 640: \t\t\t\t\t// Misskey",
        "// Line_Reference 641: \t\t\t\t\tmisskey: 'https://misskey-hub.net/ns#',",
        "// Line_Reference 642: \t\t\t\t\t'_misskey_content': 'misskey:_misskey_content',",
        "// Line_Reference 643: \t\t\t\t\t'_misskey_quote': 'misskey:_misskey_quote',",
        "// Line_Reference 644: \t\t\t\t\t'_misskey_reaction': 'misskey:_misskey_reaction',",
        "// Line_Reference 645: \t\t\t\t\t'_misskey_votes': 'misskey:_misskey_votes',",
        "// Line_Reference 646: \t\t\t\t\t'_misskey_summary': 'misskey:_misskey_summary',",
        "// Line_Reference 647: \t\t\t\t\t'isCat': 'misskey:isCat',",
        "// Line_Reference 648: \t\t\t\t\t// vcard",
        "// Line_Reference 649: \t\t\t\t\tvcard: 'http://www.w3.org/2006/vcard/ns#',",
        "// Line_Reference 650: \t\t\t\t},",
        "// Line_Reference 651: \t\t\t],",
        "// Line_Reference 652: \t\t}, x as T & { id: string });",
        "// Line_Reference 659: \t\tconst ldSignature = this.ldSignatureService.use();",
        "// Line_Reference 660: \t\tldSignature.debug = false;",
        "// Line_Reference 661: \t\tactivity = await ldSignature.signRsaSignature2017(activity, keypair.privateKey, `${this.config.url}/users/${user.id}#main-key`);"
    ]
}
