{
    "cve_id": "CVE-2015-3290",
    "cve_description": "arch/x86/entry/entry_64.S in the Linux kernel before 4.1.6 on the x86_64 platform improperly relies on espfix64 during nested NMI processing, which allows local users to gain privileges by triggering an NMI within a certain instruction window.",
    "cve_publish_date": "2015-08-31",
    "cwe_id": "CWE-264",
    "cwe_name": "Permissions, Privileges, and Access Controls",
    "cwe_description": "Weaknesses in this category are related to the management of permissions, privileges, and other security features that are used to perform access control.",
    "commit_message": "x86/nmi/64: Switch stacks on userspace NMI entry\n\nReturning to userspace is tricky: IRET can fail, and ESPFIX can\nrearrange the stack prior to IRET.\n\nThe NMI nesting fixup relies on a precise stack layout and\natomic IRET.  Rather than trying to teach the NMI nesting fixup\nto handle ESPFIX and failed IRET, punt: run NMIs that came from\nuser mode on the normal kernel stack.\n\nThis will make some nested NMIs visible to C code, but the C\ncode is okay with that.\n\nAs a side effect, this should speed up perf: it eliminates an\nRDMSR when NMIs come from user mode.\n\nSigned-off-by: Andy Lutomirski <luto@kernel.org>\nReviewed-by: Steven Rostedt <rostedt@goodmis.org>\nReviewed-by: Borislav Petkov <bp@suse.de>\nCc: Linus Torvalds <torvalds@linux-foundation.org>\nCc: Peter Zijlstra <peterz@infradead.org>\nCc: Thomas Gleixner <tglx@linutronix.de>\nCc: stable@vger.kernel.org\nSigned-off-by: Ingo Molnar <mingo@kernel.org>",
    "type_of_change": "Modification",
    "filename_of_changes": "entry_64.S",
    "code_language": "C",
    "number_of_lines_added_for_mitigation": "58",
    "number_of_lines_deleted_vulnerable_to_cve": "4",
    "vulnerable_lines": [
        "// Line_Reference 1259: \t * If %cs was not the kernel segment, then the NMI triggered in user",
        "// Line_Reference 1260: \t * space, which means it is definitely not nested.",
        "// Line_Reference 1262: \tcmpl\t$__KERNEL_CS, 16(%rsp)",
        "// Line_Reference 1263: \tjne\tfirst_nmi"
    ]
}
