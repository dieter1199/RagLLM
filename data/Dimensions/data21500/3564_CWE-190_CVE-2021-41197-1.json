{
    "cve_id": "CVE-2021-41197",
    "cve_description": "TensorFlow is an open source platform for machine learning. In affected versions TensorFlow allows tensor to have a large number of dimensions and each dimension can be as large as desired. However, the total number of elements in a tensor must fit within an `int64_t`. If an overflow occurs, `MultiplyWithoutOverflow` would return a negative result. In the majority of TensorFlow codebase this then results in a `CHECK`-failure. Newer constructs exist which return a `Status` instead of crashing the binary. This is similar to CVE-2021-29584. The fix will be included in TensorFlow 2.7.0. We will also cherrypick this commit on TensorFlow 2.6.1, TensorFlow 2.5.2, and TensorFlow 2.4.4, as these are also affected and still in supported range.",
    "cve_publish_date": "2021-11-05",
    "cwe_id": "CWE-190",
    "cwe_name": "Integer Overflow or Wraparound",
    "cwe_description": "The product performs a calculation that can\n         produce an integer overflow or wraparound when the logic\n         assumes that the resulting value will always be larger than\n         the original value. This occurs when an integer value is\n         incremented to a value that is too large to store in the\n         associated representation. When this occurs, the value may\n         become a very small or negative number.",
    "commit_message": "PR #51732: Fix crash of tf.image.crop_and_resize when input is large number\n\nImported from GitHub PR https://github.com/tensorflow/tensorflow/pull/51732\n\nThis PR is part of the effort in #46890 where\ntf.image.crop_and_resize will crash if shape consists of large number.\n\nSigned-off-by: Yong Tang <yong.tang.github@outlook.com>\nCopybara import of the project:\n\n--\nc8d87055a56d8740d27ad8bdc74a7459ede6900e by Yong Tang <yong.tang.github@outlook.com>:\n\nFix crash of tf.image.crop_and_resize when input is large number\n\nThis PR is part of the effort in 46890 where\ntf.image.crop_and_resize will crash if shape consists of large number.\n\nSigned-off-by: Yong Tang <yong.tang.github@outlook.com>\nCOPYBARA_INTEGRATE_REVIEW=https://github.com/tensorflow/tensorflow/pull/51732 from yongtang:46890-tf.image.crop_and_resize c8d87055a56d8740d27ad8bdc74a7459ede6900e\nPiperOrigin-RevId: 394109830\nChange-Id: If049dad0844df9353722029ee95bc76819eda1f4",
    "type_of_change": "Modification",
    "filename_of_changes": "crop_and_resize_op.cc",
    "code_language": "C++",
    "number_of_lines_added_for_mitigation": "14",
    "number_of_lines_deleted_vulnerable_to_cve": "12",
    "vulnerable_lines": [
        "// Line_Reference 175:     OP_REQUIRES_OK_ASYNC(",
        "// Line_Reference 176:         context,",
        "// Line_Reference 177:         context->allocate_output(",
        "// Line_Reference 178:             0, TensorShape({num_boxes, crop_height, crop_width, depth}),",
        "// Line_Reference 179:             &output),",
        "// Line_Reference 180:         done);",
        "// Line_Reference 422:     OP_REQUIRES_OK_ASYNC(",
        "// Line_Reference 423:         context,",
        "// Line_Reference 424:         context->allocate_output(",
        "// Line_Reference 425:             0, TensorShape({batch_size, image_height, image_width, depth}),",
        "// Line_Reference 426:             &output),",
        "// Line_Reference 427:         done);"
    ]
}
