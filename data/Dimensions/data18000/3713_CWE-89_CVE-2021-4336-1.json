{
    "cve_id": "CVE-2021-4336",
    "cve_description": "A vulnerability was found in ITRS Group monitor-ninja up to 2021.11.1. It has been rated as critical. Affected by this issue is some unknown functionality of the file modules/reports/models/scheduled_reports.php. The manipulation leads to sql injection. Upgrading to version 2021.11.30 is able to address this issue. The name of the patch is 6da9080faec9bca1ca5342386c0421dca0a6c0cc. It is recommended to upgrade the affected component. The identifier of this vulnerability is VDB-230084.",
    "cve_publish_date": "2023-05-28",
    "cwe_id": "CWE-89",
    "cwe_name": "Improper Neutralization of Special Elements used in an SQL Command ('SQL Injection')",
    "cwe_description": "The product constructs all or part of an SQL command using externally-influenced input from an upstream component, but it does not neutralize or incorrectly neutralizes special elements that could modify the intended SQL command when it is sent to a downstream component. Without sufficient removal or quoting of SQL syntax in user-controllable inputs, the generated SQL query can cause those inputs to be interpreted as SQL instead of ordinary user data.",
    "commit_message": "Prevent SQL injections\n\nThis escapes a bunch of variables used in SQL statements, which could\notherwise be used to perform SQL injection attacks.\n\nThis is part of MON-12841.\n\nSigned-off-by: Petter Nystr√∂m <pnystrom@itrsgroup.com>",
    "type_of_change": "Modification",
    "filename_of_changes": "scheduled_reports.php",
    "code_language": "PHP",
    "number_of_lines_added_for_mitigation": "8",
    "number_of_lines_deleted_vulnerable_to_cve": "8",
    "vulnerable_lines": [
        "// Line_Reference 40: \t\t$sql = \"DELETE FROM scheduled_reports WHERE report_type_id=\".$report_type_id.\" AND report_id=\".$id;",
        "// Line_Reference 77: \t\t\t\trt.identifier='\".$type.\"' AND",
        "// Line_Reference 208: \t\t\t$sql = \"UPDATE scheduled_reports SET \".self::USERFIELD.\"=\".$db->escape($user).\", report_type_id=\".$rep_type.\", report_id=\".$saved_report_id.\", recipients=\".$db->escape($recipients).\", period_id=\".$period.\", filename=\".$db->escape($filename).\", description=\".$db->escape($description).\", local_persistent_filepath = \".$db->escape($local_persistent_filepath).\", attach_description = \".$db->escape($attach_description).\" WHERE id=\".$id;",
        "// Line_Reference 210: \t\t\t$sql = \"INSERT INTO scheduled_reports (\".self::USERFIELD.\", report_type_id, report_id, recipients, period_id, filename, description, local_persistent_filepath, attach_description, report_time, report_on, report_period)VALUES(\".$db->escape($user).\", \".$rep_type.\", \".$saved_report_id.\", \".$db->escape($recipients).\", \".$period.\", \".$db->escape($filename).\", \".$db->escape($description).\", \".$db->escape($local_persistent_filepath).\", \".$db->escape($attach_description).\", '\".$report_time.\"', '\".$report_on.\"', '\".$report_period.\"' )\";",
        "// Line_Reference 237: \t\t$id = (int)$id;",
        "// Line_Reference 238: \t\t$field = trim($field);",
        "// Line_Reference 239: \t\t$value = trim($value);",
        "// Line_Reference 241: \t\t$sql = \"UPDATE scheduled_reports SET \".$field.\"= \".$db->escape($value).\" WHERE id=\".$id;"
    ]
}
