{
    "cve_id": "CVE-2017-11665",
    "cve_description": "The ff_amf_get_field_value function in libavformat/rtmppkt.c in FFmpeg 3.3.2 allows remote RTMP servers to cause a denial of service (Segmentation Violation and application crash) via a crafted stream.",
    "cve_publish_date": "2017-07-27",
    "cwe_id": "CWE-20",
    "cwe_name": "Improper Input Validation",
    "cwe_description": "The product receives input or data, but it does\n        not validate or incorrectly validates that the input has the\n        properties that are required to process the data safely and\n        correctly.",
    "commit_message": "avformat/rtmppkt: Convert ff_amf_get_field_value() to bytestream2\n\nFixes: out of array accesses\n\nFound-by: JunDong Xie of Ant-financial Light-Year Security Lab\nSigned-off-by: Michael Niedermayer <michael@niedermayer.cc>",
    "type_of_change": "Modification",
    "filename_of_changes": "rtmppkt.c",
    "code_language": "C",
    "number_of_lines_added_for_mitigation": "37",
    "number_of_lines_deleted_vulnerable_to_cve": "20",
    "vulnerable_lines": [
        "// Line_Reference 508: int ff_amf_get_field_value(const uint8_t *data, const uint8_t *data_end,",
        "// Line_Reference 514:     while (*data != AMF_DATA_TYPE_OBJECT && data < data_end) {",
        "// Line_Reference 515:         len = ff_amf_tag_size(data, data_end);",
        "// Line_Reference 516:         if (len < 0)",
        "// Line_Reference 517:             len = data_end - data;",
        "// Line_Reference 518:         data += len;",
        "// Line_Reference 520:     if (data_end - data < 3)",
        "// Line_Reference 522:     data++;",
        "// Line_Reference 524:         int size = bytestream_get_be16(&data);",
        "// Line_Reference 527:         if (size < 0 || size >= data_end - data)",
        "// Line_Reference 529:         data += size;",
        "// Line_Reference 530:         if (size == namelen && !memcmp(data-size, name, namelen)) {",
        "// Line_Reference 531:             switch (*data++) {",
        "// Line_Reference 533:                 snprintf(dst, dst_size, \"%g\", av_int2double(AV_RB64(data)));",
        "// Line_Reference 536:                 snprintf(dst, dst_size, \"%s\", *data ? \"true\" : \"false\");",
        "// Line_Reference 539:                 len = bytestream_get_be16(&data);",
        "// Line_Reference 540:                 av_strlcpy(dst, data, FFMIN(len+1, dst_size));",
        "// Line_Reference 547:         len = ff_amf_tag_size(data, data_end);",
        "// Line_Reference 548:         if (len < 0 || len >= data_end - data)",
        "// Line_Reference 550:         data += len;"
    ]
}
