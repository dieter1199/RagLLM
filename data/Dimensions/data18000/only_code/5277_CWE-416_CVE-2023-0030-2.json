void
#define node(root, dir) ((root)->head.dir == &vmm->list) ? NULL :              \
list_entry((root)->head.dir, struct nvkm_vma, head)
struct nvkm_vma *next;
if (vma->part) {
struct nvkm_vma *prev = node(vma, prev);
if (!prev->memory) {
prev->size += vma->size;
rb_erase(&vma->tree, &vmm->root);
list_del(&vma->head);
kfree(vma);
vma = prev;
}
}
next = node(vma, next);
if (next && next->part) {
if (!next->memory) {
vma->size += next->size;
rb_erase(&next->tree, &vmm->root);
list_del(&next->head);
kfree(next);
}
}
rb_erase(&prev->tree, &vmm->free);
list_del(&prev->head);
kfree(prev);
rb_erase(&next->tree, &vmm->free);
list_del(&next->head);
kfree(next);
rb_erase(&vma->tree, &vmm->root);
rb_erase(&this->tree, &vmm->free);
