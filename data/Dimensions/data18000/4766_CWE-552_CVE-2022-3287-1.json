{
    "cve_id": "CVE-2022-3287",
    "cve_description": "When creating an OPERATOR user account on the BMC, the redfish plugin saved the auto-generated password to /etc/fwupd/redfish.conf without proper restriction, allowing any user on the system to read the same configuration file.",
    "cve_publish_date": "2022-09-28",
    "cwe_id": "CWE-552",
    "cwe_name": "Files or Directories Accessible to External Parties",
    "cwe_description": "The product makes files or directories accessible to unauthorized actors, even though they should not be.",
    "commit_message": "Never save the Redfish passwords to a file readable by users\n\nWhen the redfish plugin automatically creates an OPERATOR user account on the\nBMC we save the autogenerated password to /etc/fwupd/redfish.conf, ensuring it\nis chmod'ed to 0660 before writing the file with g_key_file_save_to_file().\n\nUnder the covers, g_key_file_save_to_file() calls g_file_set_contents() with\nthe keyfile string data.\nI was under the impression that G_FILE_CREATE_REPLACE_DESTINATION was being\nused to copy permissions, but alas not.\n\nGLib instead calls g_file_set_contents_full() with the mode hardcoded to 0666,\nwhich undoes the previous chmod().\n\nUse g_file_set_contents_full() with the correct mode for newer GLib versions,\nand provide a fallback with the same semantics for older versions.",
    "type_of_change": "Modification",
    "filename_of_changes": "fu-plugin.c",
    "code_language": "C",
    "number_of_lines_added_for_mitigation": "54",
    "number_of_lines_deleted_vulnerable_to_cve": "11",
    "vulnerable_lines": [
        "// Line_Reference 2441: \tgint ret;",
        "// Line_Reference 2450: \tret = g_chmod(conf_path, 0660);",
        "// Line_Reference 2451: \tif (ret == -1) {",
        "// Line_Reference 2452: \t\tg_set_error(error,",
        "// Line_Reference 2453: \t\t\t    FWUPD_ERROR,",
        "// Line_Reference 2454: \t\t\t    FWUPD_ERROR_INTERNAL,",
        "// Line_Reference 2455: \t\t\t    \"failed to set permissions on %s\",",
        "// Line_Reference 2456: \t\t\t    conf_path);",
        "// Line_Reference 2458: \t}",
        "// Line_Reference 2459: ",
        "// Line_Reference 2460: \treturn fu_plugin_set_config_value(self, key, value, error);"
    ]
}
