{
    "cve_id": "CVE-2024-31997",
    "cve_description": "XWiki Platform is a generic wiki platform. Prior to versions 4.10.19, 15.5.4, and 15.10-rc-1, parameters of UI extensions are always interpreted as Velocity code and executed with programming rights. Any user with edit right on any document like the user's own profile can create UI extensions. This allows remote code execution and thereby impacts the confidentiality, integrity and availability of the whole XWiki installation. This vulnerability has been patched in XWiki 14.10.19, 15.5.4 and 15.9-RC1. No known workarounds are available.",
    "cve_publish_date": "2024-04-10",
    "cwe_id": "NVD-CWE-noinfo",
    "cwe_name": "Insufficient Information",
    "cwe_description": "There is insufficient information about the issue to classify it; details are unkown or unspecified.",
    "commit_message": "XWIKI-21335: Execute UI Extension parameters with the rights of their author\n\n* Check script right for the UI extension's author\n* Use AuthorExecutor to set the context author",
    "type_of_change": "Modification",
    "filename_of_changes": "WikiUIExtensionParameters.java",
    "code_language": "Java",
    "number_of_lines_added_for_mitigation": "55",
    "number_of_lines_deleted_vulnerable_to_cve": "26",
    "vulnerable_lines": [
        "// Line_Reference 25: import java.util.HashMap;",
        "// Line_Reference 103:      * @param id the unique identifier of this set of parameters, mostly used to isolate parameters value execution",
        "// Line_Reference 104:      * @param rawParameters raw parameters, their values can contain velocity directives",
        "// Line_Reference 108:     public WikiUIExtensionParameters(String id, String rawParameters, ComponentManager cm)",
        "// Line_Reference 111:         this.id = id;",
        "// Line_Reference 112:         this.parameters = parseParameters(rawParameters);",
        "// Line_Reference 151:         boolean isCacheValid = false;",
        "// Line_Reference 161:             isCacheValid = true;",
        "// Line_Reference 162:         }",
        "// Line_Reference 163: ",
        "// Line_Reference 164:         if (!isCacheValid) {",
        "// Line_Reference 165:             this.evaluatedParameters = new HashMap<>();",
        "// Line_Reference 166: ",
        "// Line_Reference 167:             if (this.parameters.size() > 0) {",
        "// Line_Reference 169:                     VelocityEngine velocityEngine = this.velocityManager.getVelocityEngine();",
        "// Line_Reference 170:                     VelocityContext velocityContext = this.velocityManager.getVelocityContext();",
        "// Line_Reference 172:                     for (String propertyKey : this.parameters.stringPropertyNames()) {",
        "// Line_Reference 173:                         if (!StringUtils.isBlank(propertyKey)) {",
        "// Line_Reference 174:                             String propertyValue = this.parameters.getProperty(propertyKey);",
        "// Line_Reference 182:                                 this.evaluatedParameters.put(propertyKey, writer.toString());",
        "// Line_Reference 188:                         }",
        "// Line_Reference 189:                     }",
        "// Line_Reference 190:                 } catch (XWikiVelocityException ex) {",
        "// Line_Reference 193:                 this.previousContextId = currentContextId;",
        "// Line_Reference 194:                 this.previousWiki = currentWiki;",
        "// Line_Reference 198:         return this.evaluatedParameters;"
    ]
}
