{
    "cve_id": "CVE-2024-31997",
    "cve_description": "XWiki Platform is a generic wiki platform. Prior to versions 4.10.19, 15.5.4, and 15.10-rc-1, parameters of UI extensions are always interpreted as Velocity code and executed with programming rights. Any user with edit right on any document like the user's own profile can create UI extensions. This allows remote code execution and thereby impacts the confidentiality, integrity and availability of the whole XWiki installation. This vulnerability has been patched in XWiki 14.10.19, 15.5.4 and 15.9-RC1. No known workarounds are available.",
    "cve_publish_date": "2024-04-10",
    "cwe_id": "NVD-CWE-noinfo",
    "cwe_name": "Insufficient Information",
    "cwe_description": "There is insufficient information about the issue to classify it; details are unkown or unspecified.",
    "commit_message": "XWIKI-21335: Execute UI Extension parameters with the rights of their author\n\n* Check script right for the UI extension's author\n* Use AuthorExecutor to set the context author",
    "type_of_change": "Modification",
    "filename_of_changes": "WikiUIExtensionParametersTest.java",
    "code_language": "Java",
    "number_of_lines_added_for_mitigation": "96",
    "number_of_lines_deleted_vulnerable_to_cve": "22",
    "vulnerable_lines": [
        "// Line_Reference 47: import static org.junit.jupiter.api.Assertions.assertNull;",
        "// Line_Reference 99:         when(this.modelContext.getCurrentEntityReference()).thenReturn(new WikiReference(\"xwiki\"));",
        "// Line_Reference 100:         WikiUIExtensionParameters parameters = new WikiUIExtensionParameters(\"id\", \"\", this.componentManager);",
        "// Line_Reference 107:         when(this.modelContext.getCurrentEntityReference()).thenReturn(new WikiReference(\"xwiki\"));",
        "// Line_Reference 111:         WikiUIExtensionParameters parameters = new WikiUIExtensionParameters(\"id\", \"key=value\", this.componentManager);",
        "// Line_Reference 120:         when(this.modelContext.getCurrentEntityReference()).thenReturn(new WikiReference(\"xwiki\"));",
        "// Line_Reference 121: ",
        "// Line_Reference 127:         WikiUIExtensionParameters parameters =",
        "// Line_Reference 128:             new WikiUIExtensionParameters(\"id\", paramsStr, this.componentManager);",
        "// Line_Reference 139:         when(this.modelContext.getCurrentEntityReference()).thenReturn(new WikiReference(\"xwiki\"));",
        "// Line_Reference 140: ",
        "// Line_Reference 144:         WikiUIExtensionParameters parameters =",
        "// Line_Reference 145:             new WikiUIExtensionParameters(\"id\", paramsStr, this.componentManager);",
        "// Line_Reference 156:         when(this.modelContext.getCurrentEntityReference()).thenReturn(new WikiReference(\"xwiki\"));",
        "// Line_Reference 160:         WikiUIExtensionParameters parameters = new WikiUIExtensionParameters(\"id\", \"key=value\", this.componentManager);",
        "// Line_Reference 162:         // It should fail and put a warn in the logs",
        "// Line_Reference 163:         assertNull(parameters.get().get(\"key\"));",
        "// Line_Reference 171:         when(this.modelContext.getCurrentEntityReference()).thenReturn(new WikiReference(\"xwiki\"));",
        "// Line_Reference 175:         WikiUIExtensionParameters parameters = new WikiUIExtensionParameters(\"id\", \"key=value\", this.componentManager);",
        "// Line_Reference 194:         WikiUIExtensionParameters parameters = new WikiUIExtensionParameters(\"id\", \"key=value\", this.componentManager);",
        "// Line_Reference 208:         when(this.modelContext.getCurrentEntityReference()).thenReturn(new WikiReference(\"wiki1\"));",
        "// Line_Reference 212:         WikiUIExtensionParameters parameters = new WikiUIExtensionParameters(\"id\", \"key=value\", this.componentManager);"
    ]
}
