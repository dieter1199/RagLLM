{
    "cve_id": "CVE-2018-18955",
    "cve_description": "In the Linux kernel 4.15.x through 4.19.x before 4.19.2, map_write() in kernel/user_namespace.c allows privilege escalation because it mishandles nested user namespaces with more than 5 UID or GID ranges. A user who has CAP_SYS_ADMIN in an affected user namespace can bypass access controls on resources outside the namespace, as demonstrated by reading /etc/shadow. This occurs because an ID transformation takes place properly for the namespaced-to-kernel direction but not for the kernel-to-namespaced direction.",
    "cve_publish_date": "2018-11-16",
    "cwe_id": "CWE-863",
    "cwe_name": "Incorrect Authorization",
    "cwe_description": "The product performs an authorization check when an actor attempts to access a resource or perform an action, but it does not correctly perform the check. This allows attackers to bypass intended access restrictions.",
    "commit_message": "userns: also map extents in the reverse map to kernel IDs\n\nThe current logic first clones the extent array and sorts both copies, then\nmaps the lower IDs of the forward mapping into the lower namespace, but\ndoesn't map the lower IDs of the reverse mapping.\n\nThis means that code in a nested user namespace with >5 extents will see\nincorrect IDs. It also breaks some access checks, like\ninode_owner_or_capable() and privileged_wrt_inode_uidgid(), so a process\ncan incorrectly appear to be capable relative to an inode.\n\nTo fix it, we have to make sure that the \"lower_first\" members of extents\nin both arrays are translated; and we have to make sure that the reverse\nmap is sorted *after* the translation (since otherwise the translation can\nbreak the sorting).\n\nThis is CVE-2018-18955.\n\nFixes: 6397fac4915a (\"userns: bump idmap limits to 340\")\nCc: stable@vger.kernel.org\nSigned-off-by: Jann Horn <jannh@google.com>\nTested-by: Eric W. Biederman <ebiederm@xmission.com>\nReviewed-by: Eric W. Biederman <ebiederm@xmission.com>\nSigned-off-by: Eric W. Biederman <ebiederm@xmission.com>",
    "type_of_change": "Modification",
    "filename_of_changes": "user_namespace.c",
    "code_language": "C",
    "number_of_lines_added_for_mitigation": "8",
    "number_of_lines_deleted_vulnerable_to_cve": "4",
    "vulnerable_lines": [
        "// Line_Reference 977: \tret = sort_idmaps(&new_map);",
        "// Line_Reference 978: \tif (ret < 0)",
        "// Line_Reference 979: \t\tgoto out;",
        "// Line_Reference 980: "
    ]
}
