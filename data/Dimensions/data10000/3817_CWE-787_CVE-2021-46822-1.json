{
    "cve_id": "CVE-2021-46822",
    "cve_description": "The PPM reader in libjpeg-turbo through 2.0.90 mishandles use of tjLoadImage for loading a 16-bit binary PPM file into a grayscale buffer and loading a 16-bit binary PGM file into an RGB buffer. This is related to a heap-based buffer overflow in the get_word_rgb_row function in rdppm.c.",
    "cve_publish_date": "2022-06-18",
    "cwe_id": "CWE-787",
    "cwe_name": "Out-of-bounds Write",
    "cwe_description": "The product writes data past the end, or before the beginning, of the intended buffer.",
    "commit_message": "tjLoadImage: Fix issues w/loading 16-bit PPMs/PGMs\n\n- The PPM reader now throws an error rather than segfaulting (due to a\n  buffer overrun) if an application attempts to load a 16-bit PPM file\n  into a grayscale uncompressed image buffer.  No known applications\n  allowed that (not even the test applications in libjpeg-turbo),\n  because that mode of operation was never expected to work and did not\n  work under any circumstances.  (In fact, it was necessary to modify\n  TJBench in order to reproduce the issue outside of a fuzzing\n  environment.)  This was purely a matter of making the library bow out\n  gracefully rather than crash if an application tries to do something\n  really stupid.\n\n- The PPM reader now throws an error rather than generating incorrect\n  pixels if an application attempts to load a 16-bit PGM file into an\n  RGB uncompressed image buffer.\n\n- The PPM reader now correctly loads 16-bit PPM files into extended\n  RGB uncompressed image buffers.  (Previously it generated incorrect\n  pixels unless the input colorspace was JCS_RGB or JCS_EXT_RGB.)\n\nThe only way that users could have potentially encountered these issues\nwas through the tjLoadImage() function.  cjpeg and TJBench were\nunaffected.",
    "type_of_change": "Modification",
    "filename_of_changes": "rdppm.c",
    "code_language": "C",
    "number_of_lines_added_for_mitigation": "20",
    "number_of_lines_deleted_vulnerable_to_cve": "6",
    "vulnerable_lines": [
        "// Line_Reference 8:  * Copyright (C) 2015-2017, 2020, D. R. Commander.",
        "// Line_Reference 530:     *ptr++ = rescale[temp];",
        "// Line_Reference 535:     *ptr++ = rescale[temp];",
        "// Line_Reference 540:     *ptr++ = rescale[temp];",
        "// Line_Reference 627:       source->pub.get_pixel_rows = get_word_gray_row;",
        "// Line_Reference 650:       source->pub.get_pixel_rows = get_word_rgb_row;"
    ]
}
