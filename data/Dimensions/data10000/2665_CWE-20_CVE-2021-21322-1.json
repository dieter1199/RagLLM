{
    "cve_id": "CVE-2021-21322",
    "cve_description": "fastify-http-proxy is an npm package which is a fastify plugin for proxying your http requests to another server, with hooks. By crafting a specific URL, it is possible to escape the prefix of the proxied backend service. If the base url of the proxied server is `/pub/`, a user expect that accessing `/priv` on the target service would not be possible. In affected versions, it is possible. This is fixed in version 4.3.1.",
    "cve_publish_date": "2021-03-02",
    "cwe_id": "CWE-20",
    "cwe_name": "Improper Input Validation",
    "cwe_description": "The product receives input or data, but it does\n        not validate or incorrectly validates that the input has the\n        properties that are required to process the data safely and\n        correctly.",
    "commit_message": "Merge pull request from GHSA-c4qr-gmr9-v23w\n\n* added failing test\n\n* fix first test\n\n* Fixed 2/4\n\n* three out of four\n\n* four out of four",
    "type_of_change": "Modification",
    "filename_of_changes": "index.js",
    "code_language": "JavaScript",
    "number_of_lines_added_for_mitigation": "37",
    "number_of_lines_deleted_vulnerable_to_cve": "18",
    "vulnerable_lines": [
        "// Line_Reference 56: function createWebSocketUrl (options, request) {",
        "// Line_Reference 57:   const source = new URL(request.url, 'http://127.0.0.1')",
        "// Line_Reference 58: ",
        "// Line_Reference 59:   const target = new URL(",
        "// Line_Reference 60:     options.rewritePrefix || options.prefix || source.pathname,",
        "// Line_Reference 61:     options.upstream",
        "// Line_Reference 62:   )",
        "// Line_Reference 63: ",
        "// Line_Reference 64:   target.search = source.search",
        "// Line_Reference 65: ",
        "// Line_Reference 66:   return target",
        "// Line_Reference 67: }",
        "// Line_Reference 68: ",
        "// Line_Reference 69: function setupWebSocketProxy (fastify, options) {",
        "// Line_Reference 71:     path: options.prefix,",
        "// Line_Reference 96:     const url = createWebSocketUrl(options, request)",
        "// Line_Reference 111:   const rewritePrefix = opts.rewritePrefix || ''",
        "// Line_Reference 167:     setupWebSocketProxy(fastify, opts)"
    ]
}
