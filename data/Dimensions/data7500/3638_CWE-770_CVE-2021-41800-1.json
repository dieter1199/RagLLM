{
    "cve_id": "CVE-2021-41800",
    "cve_description": "MediaWiki before 1.36.2 allows a denial of service (resource consumption because of lengthy query processing time). Visiting Special:Contributions can sometimes result in a long running SQL query because PoolCounter protection is mishandled.",
    "cve_publish_date": "2021-10-11",
    "cwe_id": "CWE-770",
    "cwe_name": "Allocation of Resources Without Limits or Throttling",
    "cwe_description": "The product allocates a reusable resource or group of resources on behalf of an actor without imposing any restrictions on the size or number of resources that can be allocated, in violation of the intended security policy for that actor.",
    "commit_message": "SECURITY: fix PoolCounter protection of Special:Contributions\n\nThe call to $pager->getNumRows() itself triggers execution of\nthe database query backing the page, so, that call must be inside\nthe callback given to PoolCounterWorkViaCallback.\n\nCVE-2021-41800\n\nBug: T284419\nChange-Id: I8b7b41a355be265389a4a8c9ea91301d4e23ae1b",
    "type_of_change": "Modification",
    "filename_of_changes": "SpecialContributions.php",
    "code_language": "PHP",
    "number_of_lines_added_for_mitigation": "17",
    "number_of_lines_deleted_vulnerable_to_cve": "15",
    "vulnerable_lines": [
        "// Line_Reference 313: \t\t\t} elseif ( !$pager->getNumRows() ) {",
        "// Line_Reference 314: \t\t\t\t$out->addWikiMsg( 'nocontribs', $target );",
        "// Line_Reference 325: \t\t\t\t\t'doWork' => function () use ( $pager, $out ) {",
        "// Line_Reference 326: \t\t\t\t\t\t# Show a message about replica DB lag, if applicable",
        "// Line_Reference 327: \t\t\t\t\t\t$lag = $pager->getDatabase()->getSessionLagStatus()['lag'];",
        "// Line_Reference 328: \t\t\t\t\t\tif ( $lag > 0 ) {",
        "// Line_Reference 329: \t\t\t\t\t\t\t$out->showLagWarning( $lag );",
        "// Line_Reference 331: ",
        "// Line_Reference 332: \t\t\t\t\t\t$output = $pager->getBody();",
        "// Line_Reference 333: \t\t\t\t\t\tif ( !$this->including() ) {",
        "// Line_Reference 334: \t\t\t\t\t\t\t$output = $pager->getNavigationBar() .",
        "// Line_Reference 335: \t\t\t\t\t\t\t\t$output .",
        "// Line_Reference 336: \t\t\t\t\t\t\t\t$pager->getNavigationBar();",
        "// Line_Reference 337: \t\t\t\t\t\t}",
        "// Line_Reference 338: \t\t\t\t\t\t$out->addHTML( $output );"
    ]
}
