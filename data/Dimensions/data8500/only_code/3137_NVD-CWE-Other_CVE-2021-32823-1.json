max = (1 << (nbits - 1)) - 1
min = -(max + 1)
min = 0
max = (1 << nbits) - 1
clamp = "(val < #{min}) ? #{min} : (val > #{max}) ? #{max} : val"