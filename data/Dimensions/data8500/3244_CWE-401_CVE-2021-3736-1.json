{
    "cve_id": "CVE-2021-3736",
    "cve_description": "A flaw was found in the Linux kernel. A memory leak problem was found in mbochs_ioctl in samples/vfio-mdev/mbochs.c in Virtual Function I/O (VFIO) Mediated devices. This flaw could allow a local attacker to leak internal kernel information.",
    "cve_publish_date": "2022-08-23",
    "cwe_id": "CWE-401",
    "cwe_name": "Missing Release of Memory after Effective Lifetime",
    "cwe_description": "The product does not sufficiently track and release allocated memory after it has been used, which slowly consumes remaining memory.",
    "commit_message": "vfio/mbochs: Fix missing error unwind of mbochs_used_mbytes\n\nConvert mbochs to use an atomic scheme for this like mtty was changed\ninto. The atomic fixes various race conditions with probing. Add the\nmissing error unwind. Also add the missing kfree of mdev_state->pages.\n\nFixes: 681c1615f891 (\"vfio/mbochs: Convert to use vfio_register_group_dev()\")\nReported-by: Cornelia Huck <cohuck@redhat.com>\nCo-developed-by: Alex Williamson <alex.williamson@redhat.com>\nReviewed-by: Christoph Hellwig <hch@lst.de>\nSigned-off-by: Jason Gunthorpe <jgg@nvidia.com>\nReviewed-by: Cornelia Huck <cohuck@redhat.com>\nLink: https://lore.kernel.org/r/2-v4-9ea22c5e6afb+1adf-vfio_reflck_jgg@nvidia.com\nSigned-off-by: Alex Williamson <alex.williamson@redhat.com>",
    "type_of_change": "Modification",
    "filename_of_changes": "mbochs.c",
    "code_language": "C",
    "number_of_lines_added_for_mitigation": "15",
    "number_of_lines_deleted_vulnerable_to_cve": "9",
    "vulnerable_lines": [
        "// Line_Reference 132: static int\t\tmbochs_used_mbytes;",
        "// Line_Reference 516: \tif (type->mbytes + mbochs_used_mbytes > max_mbytes)",
        "// Line_Reference 517: \t\treturn -ENOMEM;",
        "// Line_Reference 521: \t\treturn -ENOMEM;",
        "// Line_Reference 552: \tmbochs_used_mbytes += type->mbytes;",
        "// Line_Reference 553: ",
        "// Line_Reference 559: ",
        "// Line_Reference 570: \tmbochs_used_mbytes -= mdev_state->type->mbytes;",
        "// Line_Reference 1354: \tint count = (max_mbytes - mbochs_used_mbytes) / type->mbytes;"
    ]
}
