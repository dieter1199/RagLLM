func parseConsoleToken(hmacSecretByte []byte, tokenString string) (username, email string, role console.UserRole, exp int64, ok bool) {
return claims.Username, claims.Email, claims.Role, claims.ExpiresAt, true
uname, email, role, err = s.lookupConsoleUser(ctx, in.Username, in.Password)
ExpiresAt: time.Now().UTC().Add(time.Duration(s.config.GetConsole().TokenExpirySec) * time.Second).Unix(),
func (s *ConsoleServer) lookupConsoleUser(ctx context.Context, unameOrEmail, password string) (uname string, email string, role console.UserRole, err error) {
query := "SELECT username, email, role, password, disable_time FROM console_user WHERE username = $1 OR email = $1"
err = s.db.QueryRowContext(ctx, query, unameOrEmail).Scan(&uname, &email, &role, &dbPassword, &dbDisableTime)