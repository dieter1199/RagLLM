var version = require('../'),
assert = require('assert'),
fs = require('fs'),
vinylFs = require('vinyl-fs'),
path = require('path'),
cp = require('child_process'),
File = require('vinyl'),
through = require('through2'),
fUtil = require('../lib/files'),
git = require('../lib/git');
describe('git', function () {
var filename = 'package.json';
var expectedPath = path.join(__dirname, './fixtures/', filename);
before(function ()Â {
}
contents: expectedContent
describe('#Update()', function(){
it('should return error on unclean git repository when commit is given', function (done) {
return cb(new Error('Not clean'));
version.update({
version: '1.0.0',
commitMessage: 'Message'
}, function (err, data) {
assert.ok(err);
assert.equal(err.message, 'Not clean', 'Error message should be set by isRepositoryClean');
it('should return NOT error on unclean git repository when no commit message is given', function (done) {
return cb(new Error('Not clean'));
version.update('1.0.0', function (err, data) {
assert.ifError(err);
it('should get updated version sent to commit when commit message is given', function (done) {
assert.equal(message, 'Message');
assert.equal(newVer, '1.0.0');
assert.equal(tagName, 'v1.0.0');
version.update({
version: '1.0.0',
commitMessage: 'Message'
}, function (err, data) {
assert.ifError(err);
done();
});
it('should be able to override tagName', function (done) {
assert.equal(tagName, 'v1.0.0-src');
version.update({
version: '1.0.0',
commitMessage: 'Message',
tagName: 'v%s-src'
}, function (err, data) {
assert.ifError(err);
done();
});
it('should get flag defining if v-prefix should be used or not', function (done) {
assert.ok(noPrefix, 'No prefix should be true');
version.update({
version: '1.0.0',
commitMessage: 'Message',
noPrefix: true
}, function (err, data) {
assert.ifError(err);
done();
});
it('should make tag with v-prefix per default', function (done) {
if (cmd.indexOf('-a') === -1) return cb(null);
version: '1.0.0',
commitMessage: 'Message'
it('should make tag without v-prefix if specified', function (done) {
if (cmd.indexOf('-a') === -1) return cb(null);
version: '1.0.0',
commitMessage: 'Message',
noPrefix: true
});
