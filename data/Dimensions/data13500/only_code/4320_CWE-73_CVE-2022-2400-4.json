if (!$this->options->isRemoteEnabled() && ($protocol !== "" && $protocol !== "file://")) {
Helpers::record_warnings(E_USER_WARNING, "Remote font resource $remoteFile referenced, but remote file download is disabled.", __FILE__, __LINE__);
return false;
if ($protocol === "" || $protocol === "file://") {
$realfile = realpath($remoteFile);
$rootDir = realpath($this->options->getRootDir());
if (strpos($realfile, $rootDir) !== 0) {
$chroot = $this->options->getChroot();
$chrootValid = false;
foreach ($chroot as $chrootPath) {
$chrootPath = realpath($chrootPath);
if ($chrootPath !== false && strpos($realfile, $chrootPath) === 0) {
$chrootValid = true;
break;
}
}
if ($chrootValid !== true) {
Helpers::record_warnings(E_USER_WARNING, "Permission denied on $remoteFile. The file could not be found under the paths specified by Options::chroot.", __FILE__, __LINE__);
return false;
}
}
if (!$realfile) {
Helpers::record_warnings(E_USER_WARNING, "File '$realfile' not found.", __FILE__, __LINE__);
return false;
$remoteFile = $realfile;
