{
    "cve_id": "CVE-2018-20174",
    "cve_description": "rdesktop versions up to and including v1.8.3 contain an Out-Of-Bounds Read in the function ui_clip_handle_data() that results in an information leak.",
    "cve_publish_date": "2019-03-15",
    "cwe_id": "CWE-125",
    "cwe_name": "Out-of-bounds Read",
    "cwe_description": "The product reads data past the end, or before the beginning, of the intended buffer.",
    "commit_message": "Malicious RDP server security fixes\n\nThis commit includes fixes for a set of 21 vulnerabilities in\nrdesktop when a malicious RDP server is used.\n\nAll vulnerabilities was identified and reported by Eyal Itkin.\n\n * Add rdp_protocol_error function that is used in several fixes\n * Refactor of process_bitmap_updates\n * Fix possible integer overflow in s_check_rem() on 32bit arch\n * Fix memory corruption in process_bitmap_data - CVE-2018-8794\n * Fix remote code execution in process_bitmap_data - CVE-2018-8795\n * Fix remote code execution in process_plane - CVE-2018-8797\n * Fix Denial of Service in mcs_recv_connect_response - CVE-2018-20175\n * Fix Denial of Service in mcs_parse_domain_params - CVE-2018-20175\n * Fix Denial of Service in sec_parse_crypt_info - CVE-2018-20176\n * Fix Denial of Service in sec_recv - CVE-2018-20176\n * Fix minor information leak in rdpdr_process - CVE-2018-8791\n * Fix Denial of Service in cssp_read_tsrequest - CVE-2018-8792\n * Fix remote code execution in cssp_read_tsrequest - CVE-2018-8793\n * Fix Denial of Service in process_bitmap_data - CVE-2018-8796\n * Fix minor information leak in rdpsnd_process_ping - CVE-2018-8798\n * Fix Denial of Service in process_secondary_order - CVE-2018-8799\n * Fix remote code execution in in ui_clip_handle_data - CVE-2018-8800\n * Fix major information leak in ui_clip_handle_data - CVE-2018-20174\n * Fix memory corruption in rdp_in_unistr - CVE-2018-20177\n * Fix Denial of Service in process_demand_active - CVE-2018-20178\n * Fix remote code execution in lspci_process - CVE-2018-20179\n * Fix remote code execution in rdpsnddbg_process - CVE-2018-20180\n * Fix remote code execution in seamless_process - CVE-2018-20181\n * Fix remote code execution in seamless_process_line - CVE-2018-20182",
    "type_of_change": "Modification",
    "filename_of_changes": "rdp.c",
    "code_language": "C",
    "number_of_lines_added_for_mitigation": "132",
    "number_of_lines_deleted_vulnerable_to_cve": "60",
    "vulnerable_lines": [
        "// Line_Reference 1393: /* Process bitmap updates */",
        "// Line_Reference 1394: void",
        "// Line_Reference 1395: process_bitmap_updates(STREAM s)",
        "// Line_Reference 1397: \tuint16 num_updates;",
        "// Line_Reference 1399: \tuint16 cx, cy, bpp, Bpp, compress, bufsize, size;",
        "// Line_Reference 1401: \tint i;",
        "// Line_Reference 1402: ",
        "// Line_Reference 1405: \tin_uint16_le(s, num_updates);",
        "// Line_Reference 1407: \tfor (i = 0; i < num_updates; i++)",
        "// Line_Reference 1408: \t{",
        "// Line_Reference 1409: \t\tin_uint16_le(s, left);",
        "// Line_Reference 1410: \t\tin_uint16_le(s, top);",
        "// Line_Reference 1411: \t\tin_uint16_le(s, right);",
        "// Line_Reference 1412: \t\tin_uint16_le(s, bottom);",
        "// Line_Reference 1413: \t\tin_uint16_le(s, width);",
        "// Line_Reference 1414: \t\tin_uint16_le(s, height);",
        "// Line_Reference 1415: \t\tin_uint16_le(s, bpp);",
        "// Line_Reference 1416: \t\tBpp = (bpp + 7) / 8;",
        "// Line_Reference 1417: \t\tin_uint16_le(s, compress);",
        "// Line_Reference 1418: \t\tin_uint16_le(s, bufsize);",
        "// Line_Reference 1419: ",
        "// Line_Reference 1420: \t\tcx = right - left + 1;",
        "// Line_Reference 1421: \t\tcy = bottom - top + 1;",
        "// Line_Reference 1422: ",
        "// Line_Reference 1423: \t\tlogger(Graphics, Debug,",
        "// Line_Reference 1424: \t\t       \"process_bitmap_updates(), [%d,%d,%d,%d], [%d,%d], bpp=%d, compression=%d\",",
        "// Line_Reference 1425: \t\t       left, top, right, bottom, width, height, Bpp, compress);",
        "// Line_Reference 1426: ",
        "// Line_Reference 1427: \t\tif (!compress)",
        "// Line_Reference 1428: \t\t{",
        "// Line_Reference 1429: \t\t\tint y;",
        "// Line_Reference 1430: \t\t\tbmpdata = (uint8 *) xmalloc(width * height * Bpp);",
        "// Line_Reference 1431: \t\t\tfor (y = 0; y < height; y++)",
        "// Line_Reference 1432: \t\t\t{",
        "// Line_Reference 1433: \t\t\t\tin_uint8a(s, &bmpdata[(height - y - 1) * (width * Bpp)],",
        "// Line_Reference 1434: \t\t\t\t\t  width * Bpp);",
        "// Line_Reference 1435: \t\t\t}",
        "// Line_Reference 1436: \t\t\tui_paint_bitmap(left, top, cx, cy, width, height, bmpdata);",
        "// Line_Reference 1437: \t\t\txfree(bmpdata);",
        "// Line_Reference 1438: \t\t\tcontinue;",
        "// Line_Reference 1439: \t\t}",
        "// Line_Reference 1442: \t\tif (compress & 0x400)",
        "// Line_Reference 1443: \t\t{",
        "// Line_Reference 1444: \t\t\tsize = bufsize;",
        "// Line_Reference 1445: \t\t}",
        "// Line_Reference 1446: \t\telse",
        "// Line_Reference 1447: \t\t{",
        "// Line_Reference 1448: \t\t\tin_uint8s(s, 2);\t/* pad */",
        "// Line_Reference 1449: \t\t\tin_uint16_le(s, size);",
        "// Line_Reference 1450: \t\t\tin_uint8s(s, 4);\t/* line_size, final_size */",
        "// Line_Reference 1451: \t\t}",
        "// Line_Reference 1452: \t\tin_uint8p(s, data, size);",
        "// Line_Reference 1454: \t\tif (bitmap_decompress(bmpdata, width, height, data, size, Bpp))",
        "// Line_Reference 1456: \t\t\tui_paint_bitmap(left, top, cx, cy, width, height, bmpdata);",
        "// Line_Reference 1458: \t\telse",
        "// Line_Reference 1459: \t\t{",
        "// Line_Reference 1460: \t\t\tlogger(Graphics, Warning,",
        "// Line_Reference 1461: \t\t\t       \"process_bitmap_updates(), failed to decompress bitmap\");",
        "// Line_Reference 1462: \t\t}",
        "// Line_Reference 1463: "
    ]
}
