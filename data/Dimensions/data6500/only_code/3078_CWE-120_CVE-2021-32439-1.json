GF_Err stbl_AddDTS(GF_SampleTableBox *stbl, u64 DTS, u32 *sampleNumber, u32 LastAUDefDuration, u32 nb_packed_samples)
if (!nb_packed_samples)
nb_packed_samples=1;
stts->entries[0].sampleCount = nb_packed_samples;
stts->entries[0].sampleDelta = (nb_packed_samples>1) ? 0 : LastAUDefDuration;
stts->w_currentSampleNum = nb_packed_samples;
|| ((nb_packed_samples>1) && ((DTS == stts->w_LastDTS) || (DTS == stts->w_LastDTS + 2*ent->sampleDelta) ))
ent->sampleCount += nb_packed_samples;
stts->w_currentSampleNum += nb_packed_samples;
stts->w_LastDTS = DTS + ent->sampleDelta * (nb_packed_samples-1);
if (nb_packed_samples>1)
if (nb_packed_samples==1) {
ent->sampleCount = nb_packed_samples;
stts->w_currentSampleNum += nb_packed_samples;
GF_Err stbl_AddSize(GF_SampleSizeBox *stsz, u32 sampleNumber, u32 size, u32 nb_pack_samples)
if (!nb_pack_samples) nb_pack_samples = 1;
else if (nb_pack_samples>1)
size /= nb_pack_samples;
stsz->sampleCount = nb_pack_samples;
stsz->sampleCount += nb_pack_samples;
if (nb_pack_samples>1) {
GF_Err stbl_AddChunkOffset(GF_MediaBox *mdia, u32 sampleNumber, u32 StreamDescIndex, u64 offset, u32 nb_pack_samples)
if (!nb_pack_samples)
nb_pack_samples = 1;
stsc->w_lastSampleNumber = sampleNumber + nb_pack_samples-1;
ent->samplesPerChunk = nb_pack_samples;
if (sampleNumber + nb_pack_samples - 1 == stsc->w_lastSampleNumber) {
if (!nb_pack) nb_pack = 1;
if (!nb_pack) nb_pack = 1;
if (stbl->SampleSize->sampleCount+nb_pack > stbl->SampleSize->alloc_size)