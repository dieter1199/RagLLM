{
    "cve_id": "CVE-2017-15127",
    "cve_description": "A flaw was found in the hugetlb_mcopy_atomic_pte function in mm/hugetlb.c in the Linux kernel before 4.13. A superfluous implicit page unlock for VM_SHARED hugetlbfs mapping could trigger a local denial of service (BUG).",
    "cve_publish_date": "2018-01-14",
    "cwe_id": "CWE-460",
    "cwe_name": "Improper Cleanup on Thrown Exception",
    "cwe_description": "The product does not clean up its state or incorrectly cleans up its state when an exception is thrown, leading to unexpected state or control flow.",
    "commit_message": "userfaultfd: hugetlbfs: remove superfluous page unlock in VM_SHARED case\n\nhuge_add_to_page_cache->add_to_page_cache implicitly unlocks the page\nbefore returning in case of errors.\n\nThe error returned was -EEXIST by running UFFDIO_COPY on a non-hole\noffset of a VM_SHARED hugetlbfs mapping.  It was an userland bug that\ntriggered it and the kernel must cope with it returning -EEXIST from\nioctl(UFFDIO_COPY) as expected.\n\n  page dumped because: VM_BUG_ON_PAGE(!PageLocked(page))\n  kernel BUG at mm/filemap.c:964!\n  invalid opcode: 0000 [#1] SMP\n  CPU: 1 PID: 22582 Comm: qemu-system-x86 Not tainted 4.11.11-300.fc26.x86_64 #1\n  RIP: unlock_page+0x4a/0x50\n  Call Trace:\n    hugetlb_mcopy_atomic_pte+0xc0/0x320\n    mcopy_atomic+0x96f/0xbe0\n    userfaultfd_ioctl+0x218/0xe90\n    do_vfs_ioctl+0xa5/0x600\n    SyS_ioctl+0x79/0x90\n    entry_SYSCALL_64_fastpath+0x1a/0xa9\n\nLink: http://lkml.kernel.org/r/20170802165145.22628-2-aarcange@redhat.com\nSigned-off-by: Andrea Arcangeli <aarcange@redhat.com>\nTested-by: Maxime Coquelin <maxime.coquelin@redhat.com>\nReviewed-by: Mike Kravetz <mike.kravetz@oracle.com>\nCc: \"Dr. David Alan Gilbert\" <dgilbert@redhat.com>\nCc: Mike Rapoport <rppt@linux.vnet.ibm.com>\nCc: Alexey Perevalov <a.perevalov@samsung.com>\nSigned-off-by: Andrew Morton <akpm@linux-foundation.org>\nSigned-off-by: Linus Torvalds <torvalds@linux-foundation.org>",
    "type_of_change": "Modification",
    "filename_of_changes": "hugetlb.c",
    "code_language": "C",
    "number_of_lines_added_for_mitigation": "1",
    "number_of_lines_deleted_vulnerable_to_cve": "1",
    "vulnerable_lines": [
        "// Line_Reference 4065: out_release_nounlock:"
    ]
}
