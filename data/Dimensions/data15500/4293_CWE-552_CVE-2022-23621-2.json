{
    "cve_id": "CVE-2022-23621",
    "cve_description": "XWiki Platform is a generic wiki platform offering runtime services for applications built on top of it. In affected versions any user with SCRIPT right can read any file located in the XWiki WAR (for example xwiki.cfg and xwiki.properties) through XWiki#invokeServletAndReturnAsString as `$xwiki.invokeServletAndReturnAsString(\"/WEB-INF/xwiki.cfg\")`. This issue has been patched in XWiki versions 12.10.9, 13.4.3 and 13.7-rc-1. Users are advised to update. The only workaround is to limit SCRIPT right.",
    "cve_publish_date": "2022-02-09",
    "cwe_id": "CWE-552",
    "cwe_name": "Files or Directories Accessible to External Parties",
    "cwe_description": "The product makes files or directories accessible to unauthorized actors, even though they should not be.",
    "commit_message": "XWIKI-18870: Unexpected behavior of XWiki#invokeServletAndReturnAsString",
    "type_of_change": "Modification",
    "filename_of_changes": "XWiki.java",
    "code_language": "Java",
    "number_of_lines_added_for_mitigation": "0",
    "number_of_lines_deleted_vulnerable_to_cve": "22",
    "vulnerable_lines": [
        "// Line_Reference 69: import javax.servlet.http.HttpServletRequest;",
        "// Line_Reference 70: import javax.servlet.http.HttpServletResponse;",
        "// Line_Reference 268: import com.xpn.xwiki.web.includeservletasstring.IncludeServletAsString;",
        "// Line_Reference 2581:     /**",
        "// Line_Reference 2582:      * Designed to include dynamic content, such as Servlets or JSPs, inside Velocity templates; works by creating a",
        "// Line_Reference 2583:      * RequestDispatcher, buffering the output, then returning it as a string.",
        "// Line_Reference 2584:      */",
        "// Line_Reference 2585:     public String invokeServletAndReturnAsString(String url, XWikiContext xwikiContext)",
        "// Line_Reference 2586:     {",
        "// Line_Reference 2587: ",
        "// Line_Reference 2588:         HttpServletRequest servletRequest = xwikiContext.getRequest();",
        "// Line_Reference 2589:         HttpServletResponse servletResponse = xwikiContext.getResponse();",
        "// Line_Reference 2590: ",
        "// Line_Reference 2591:         try {",
        "// Line_Reference 2592:             return IncludeServletAsString.invokeServletAndReturnAsString(url, servletRequest, servletResponse);",
        "// Line_Reference 2593:         } catch (Exception e) {",
        "// Line_Reference 2594:             LOGGER.warn(\"Exception including url: \" + url, e);",
        "// Line_Reference 2595:             return \"Exception including \\\"\" + url + \"\\\", see logs for details.\";",
        "// Line_Reference 2596:         }",
        "// Line_Reference 2597: ",
        "// Line_Reference 2598:     }",
        "// Line_Reference 2599: "
    ]
}
