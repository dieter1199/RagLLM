{
    "cve_id": "CVE-2022-45873",
    "cve_description": "systemd 250 and 251 allows local users to achieve a systemd-coredump deadlock by triggering a crash that has a long backtrace. This occurs in parse_elf_object in shared/elf-util.c. The exploitation methodology is to crash a binary calling the same function recursively, and put it in a deeply nested directory to make its backtrace large enough to cause the deadlock. This must be done 16 times when MaxConnections=16 is set for the systemd/units/systemd-coredump.socket file.",
    "cve_publish_date": "2022-11-23",
    "cwe_id": "CWE-400",
    "cwe_name": "Uncontrolled Resource Consumption",
    "cwe_description": "The product does not properly control the allocation and maintenance of a limited resource, thereby enabling an actor to influence the amount of resources consumed, eventually leading to the exhaustion of available resources.",
    "commit_message": "coredump: avoid deadlock when passing processed backtrace data\n\nWe would deadlock when passing the data back from the forked-off process that\nwas doing backtrace generation back to the coredump parent. This is because we\nfork the child and wait for it to exit. The child tries to write too much data\nto the output pipe, and and after the first 64k blocks on the parent because\nthe pipe is full. The bug surfaced in Fedora because of a combination of four\nfactors:\n- 87707784c70dc9894ec613df0a6e75e732a362a3 was backported to v251.5, which\n  allowed coredump processing to be successful.\n- 1a0281a3ebf4f8c16d40aa9e63103f16cd23bb2a was NOT backported, so the output\n  was very verbose.\n- Fedora has the ELF package metadata available, so a lot of output can be\n  generated. Most other distros just don't have the information.\n- gnome-calendar crashes and has a bazillion modules and 69596 bytes of output\n  are generated for it.\n\nFixes https://bugzilla.redhat.com/show_bug.cgi?id=2135778.\n\nThe code is changed to try to write data opportunistically. If we get partial\ninformation, that is still logged. In is generally better to log partial\nbacktrace information than nothing at all.",
    "type_of_change": "Modification",
    "filename_of_changes": "elf-util.c",
    "code_language": "C",
    "number_of_lines_added_for_mitigation": "31",
    "number_of_lines_deleted_vulnerable_to_cve": "6",
    "vulnerable_lines": [
        "// Line_Reference 762:                 r = RET_NERRNO(pipe2(return_pipe, O_CLOEXEC));",
        "// Line_Reference 768:                 r = RET_NERRNO(pipe2(json_pipe, O_CLOEXEC));",
        "// Line_Reference 812:                         r = loop_write(return_pipe[1], buf, strlen(buf), false);",
        "// Line_Reference 813:                         if (r < 0)",
        "// Line_Reference 828:                         json_variant_dump(package_metadata, JSON_FORMAT_FLUSH, json_out, NULL);",
        "// Line_Reference 863:                         return r;"
    ]
}
