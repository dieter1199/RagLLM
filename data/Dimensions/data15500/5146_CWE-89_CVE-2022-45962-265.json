{
    "cve_id": "CVE-2022-45962",
    "cve_description": "Open Solutions for Education, Inc openSIS Community Edition v8.0 and earlier is vulnerable to SQL Injection via CalendarModal.php.",
    "cve_publish_date": "2023-02-13",
    "cwe_id": "CWE-89",
    "cwe_name": "Improper Neutralization of Special Elements used in an SQL Command ('SQL Injection')",
    "cwe_description": "The product constructs all or part of an SQL command using externally-influenced input from an upstream component, but it does not neutralize or incorrectly neutralizes special elements that could modify the intended SQL command when it is sent to a downstream component. Without sufficient removal or quoting of SQL syntax in user-controllable inputs, the generated SQL query can cause those inputs to be interpreted as SQL instead of ordinary user data.",
    "commit_message": "Version 9.0 release\n\nOlder version shifted to branch: Version_8.0",
    "type_of_change": "ModificationType.ADD",
    "filename_of_changes": "ParentLookup.php",
    "code_language": "PHP",
    "number_of_lines_added_for_mitigation": "45",
    "number_of_lines_deleted_vulnerable_to_cve": "52",
    "vulnerable_lines": [
        "// Line_Reference 3: include'ConfigInc.php';",
        "// Line_Reference 23: if ($_REQUEST['USERINFO_FIRST_NAME'] || $_REQUEST['USERINFO_LAST_NAME'] || $_REQUEST['USERINFO_EMAIL'] || $_REQUEST['USERINFO_MOBILE'] || $_REQUEST['USERINFO_SADD'] || $_REQUEST['USERINFO_CITY'] || $_REQUEST['USERINFO_STATE'] || $_REQUEST['USERINFO_ZIP'])",
        "// Line_Reference 24: {",
        "// Line_Reference 26: ",
        "// Line_Reference 29: ",
        "// Line_Reference 30:     if ($_REQUEST['USERINFO_FIRST_NAME'] || $_REQUEST['USERINFO_LAST_NAME'] || $_REQUEST['USERINFO_EMAIL'] || $_REQUEST['USERINFO_MOBILE'])",
        "// Line_Reference 31:     {",
        "// Line_Reference 32:         if ($_REQUEST['USERINFO_FIRST_NAME']!='')",
        "// Line_Reference 33:             $sql_where.= 'AND LOWER(stf.FIRST_NAME) LIKE \\'' . str_replace(\"'\", \"''\", strtolower(trim($_REQUEST['USERINFO_FIRST_NAME']))) . '%\\' ';",
        "// Line_Reference 34:         if ($_REQUEST['USERINFO_LAST_NAME']!='')",
        "// Line_Reference 35:             $sql_where.= 'AND LOWER(stf.LAST_NAME) LIKE \\'' . str_replace(\"'\", \"''\", strtolower(trim($_REQUEST['USERINFO_LAST_NAME']))) . '%\\' ';",
        "// Line_Reference 36:         if ($_REQUEST['USERINFO_EMAIL']!='')",
        "// Line_Reference 37:             $sql_where.= 'AND LOWER(stf.EMAIL) = \\'' . str_replace(\"'\", \"''\", strtolower(trim($_REQUEST['USERINFO_EMAIL']))) . '\\' ';",
        "// Line_Reference 38:         if ($_REQUEST['USERINFO_MOBILE']!='')",
        "// Line_Reference 39:             $sql_where.= 'AND stf.CELL_PHONE = \\'' . str_replace(\"'\", \"''\", trim($_REQUEST['USERINFO_MOBILE'])) . '\\' ';",
        "// Line_Reference 43:     if ($_REQUEST['USERINFO_SADD'] || $_REQUEST['USERINFO_CITY'] || $_REQUEST['USERINFO_STATE'] || $_REQUEST['USERINFO_ZIP'])",
        "// Line_Reference 44:     {",
        "// Line_Reference 45:         $sql.=' LEFT OUTER JOIN student_address sa on sa.PEOPLE_ID=stf.STAFF_ID';",
        "// Line_Reference 46:         $sql_where.='  AND sa.TYPE IN (\\'Primary\\',\\'Secondary\\',\\'Other\\') ';",
        "// Line_Reference 47:         if ($_REQUEST['USERINFO_SADD']!='')",
        "// Line_Reference 48:             $sql_where.= ' AND LOWER(STREET_ADDRESS_1) LIKE \\'' . str_replace(\"'\", \"''\", strtolower(trim($_REQUEST['USERINFO_SADD']))) . '%\\' ';",
        "// Line_Reference 49:         if ($_REQUEST['USERINFO_CITY']!='')",
        "// Line_Reference 50:             $sql_where.= ' AND LOWER(CITY) LIKE \\'' . str_replace(\"'\", \"''\", strtolower(trim($_REQUEST['USERINFO_CITY']))) . '%\\' ';",
        "// Line_Reference 51:         if ($_REQUEST['USERINFO_STATE']!='')",
        "// Line_Reference 52:             $sql_where.= ' AND LOWER(STATE) LIKE \\'' . str_replace(\"'\", \"''\", strtolower(trim($_REQUEST['USERINFO_STATE']))) . '%\\' ';",
        "// Line_Reference 53:         if ($_REQUEST['USERINFO_ZIP']!='')",
        "// Line_Reference 54:             $sql_where.= ' AND ZIPCODE = \\'' . str_replace(\"'\", \"''\", trim($_REQUEST['USERINFO_ZIP'])) . '\\' ';",
        "// Line_Reference 57:     $sql.=' Left outer join students_join_people sju on stf.STAFF_ID=sju.PERSON_ID Left outer join students s on s.STUDENT_ID = sju.STUDENT_ID  ';",
        "// Line_Reference 58:     $sql_where.= '  AND LOWER(stf.FIRST_NAME)<>\\'\\' AND LOWER(stf.LAST_NAME)<>\\'\\' AND sju.PERSON_ID NOT IN (SELECT PERSON_ID FROM students_join_people WHERE STUDENT_ID=' . UserStudentID() . ') GROUP BY sju.PERSON_ID';",
        "// Line_Reference 61: ",
        "// Line_Reference 62:     foreach ($searched_staffs as $key => $value)",
        "// Line_Reference 63:     {",
        "// Line_Reference 67: }",
        "// Line_Reference 68: else",
        "// Line_Reference 69: {",
        "// Line_Reference 74:     foreach ($searched_staffs as $key => $value)",
        "// Line_Reference 75:     {",
        "// Line_Reference 77: ",
        "// Line_Reference 81: ",
        "// Line_Reference 88: $columns = array('BUTTON' =>_selectAnyOne,",
        "// Line_Reference 89:  'FULLNAME' =>_name,",
        "// Line_Reference 90:  'USERNAME' =>_username,",
        "// Line_Reference 91:  'EMAIL' =>_email,",
        "// Line_Reference 92:  'STUFULLNAME' =>_associatedStudentSName,",
        "// Line_Reference 101:     echo '<FORM name=sel_staff id=sel_staff action=\"ForWindow.php?modname=' . $_REQUEST[modname] . '&modfunc=lookup&type=' . $_REQUEST['type'] . '&func=search&nfunc=status&ajax=' . $_REQUEST['ajax'] . '&add_id=new&address_id=' . $_REQUEST['address_id'] . '\" METHOD=POST>';",
        "// Line_Reference 103:     echo '<FORM name=sel_staff id=sel_staff action=\"ForWindow.php?modname=' . $_REQUEST[modname] . '&modfunc=lookup&type=' . $_REQUEST['type'] . '&func=search&nfunc=status&ajax=' . $_REQUEST['ajax'] . '&add_id=' . $_REQUEST['add_id'] . '&address_id=' . $_REQUEST['address_id'] . '\" METHOD=POST>';",
        "// Line_Reference 104: ",
        "// Line_Reference 114: if(!empty($searched_staffs))",
        "// Line_Reference 115: echo '<div id=\"select-people-div\"><br><input type=\"button\" class=\"btn btn-primary\" value=\"Select\" name=\"button\" onclick=\"SelectedParent(\\''.$_REQUEST['address_id'].'\\',\\''.$_REQUEST['p_type'].'\\',\\''.$_REQUEST['other_p_erson_id'].'\\')\"></div>';",
        "// Line_Reference 121:     if ($THIS_RET['BUTTON'])",
        "// Line_Reference 122:     {",
        "// Line_Reference 125: }"
    ]
}
