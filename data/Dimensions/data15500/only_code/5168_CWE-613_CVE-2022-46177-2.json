it "can destroy associated email tokens" do
expect { updater.change_to(new_email) }
.to change { user1.email_tokens.count }.by(1)
expect { delete "/u/#{user1.username}/preferences/email.json", params: { email: new_email } }
.to change { user1.email_tokens.count }.by(-1)
expect(user1.email_tokens.first.email).to eq(user1.email)
token.reload
expect(token.expired?).to eq(true)
token.reload
expect(token.expired?).to eq(true)