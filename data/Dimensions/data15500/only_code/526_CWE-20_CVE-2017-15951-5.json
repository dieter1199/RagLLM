if (!test_bit(KEY_FLAG_INSTANTIATED, &key->flags)) {
set_bit(KEY_FLAG_INSTANTIATED, &key->flags);
if (!test_bit(KEY_FLAG_INSTANTIATED, &key->flags)) {
key->reject_error = -error;
smp_wmb();
set_bit(KEY_FLAG_NEGATIVE, &key->flags);
set_bit(KEY_FLAG_INSTANTIATED, &key->flags);
/* updating a negative key instantiates it */
clear_bit(KEY_FLAG_NEGATIVE, &key->flags);
/* updating a negative key instantiates it */
clear_bit(KEY_FLAG_NEGATIVE, &key->flags);