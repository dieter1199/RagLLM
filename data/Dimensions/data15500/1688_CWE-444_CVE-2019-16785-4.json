{
    "cve_id": "CVE-2019-16785",
    "cve_description": "Waitress through version 1.3.1 implemented a \"MAY\" part of the RFC7230 which states: \"Although the line terminator for the start-line and header fields is the sequence CRLF, a recipient MAY recognize a single LF as a line terminator and ignore any preceding CR.\" Unfortunately if a front-end server does not parse header fields with an LF the same way as it does those with a CRLF it can lead to the front-end and the back-end server parsing the same HTTP message in two different ways. This can lead to a potential for HTTP request smuggling/splitting whereby Waitress may see two requests while the front-end server only sees a single HTTP message. This issue is fixed in Waitress 1.4.0.",
    "cve_publish_date": "2019-12-20",
    "cwe_id": "CWE-444",
    "cwe_name": "Inconsistent Interpretation of HTTP Requests ('HTTP Request/Response Smuggling')",
    "cwe_description": "The product acts as an intermediary HTTP agent\n         (such as a proxy or firewall) in the data flow between two\n         entities such as a client and server, but it does not\n         interpret malformed HTTP requests or responses in ways that\n         are consistent with how the messages will be processed by\n         those entities that are at the ultimate destination.",
    "commit_message": "Remove support for non CRLF line endings\n\nhttps://tools.ietf.org/html/rfc7230#section-3.5 says that servers MAY\nimplement their parsers to use only the LF as a delimeter between lines,\nhowever if the frontend server does NOT do the same you can potentially\nallow a single HTTP request to be treated differently by the two\nservers.\n\nThis issue can be used to cause HTTP request smuggling or HTTP desync\nwhich may lead to vulnerabilities.\n\nTo increase robustness Waitress will no longer allow bare LF for HTTP\nmessages/headers and chunked encoding and instead now enforces that the\nline endings at CRLF.",
    "type_of_change": "Modification",
    "filename_of_changes": "test_functional.py",
    "code_language": "Python",
    "number_of_lines_added_for_mitigation": "132",
    "number_of_lines_deleted_vulnerable_to_cve": "107",
    "vulnerable_lines": [
        "// Line_Reference 182:         to_send = \"GET / HTTP/1.0\\n\" \"Content-Length: 0\\n\\n\"",
        "// Line_Reference 194:         to_send = \"GET / HTTP/1.0\\n\" \" Host: 0\\n\\n\"",
        "// Line_Reference 205:         to_send = \"GET / HTTP/1.0\\n\" \"Content-Length: 5\\n\\n\"",
        "// Line_Reference 217:         to_send = \"GET / HTTP/1.0\\n\" \"Content-Length: 0\\n\\n\"",
        "// Line_Reference 244:         data = \"Echo\\nthis\\r\\nplease\"",
        "// Line_Reference 246:             \"GET / HTTP/1.0\\n\"",
        "// Line_Reference 247:             \"Connection: close\\n\"",
        "// Line_Reference 248:             \"Content-Length: %d\\n\"",
        "// Line_Reference 249:             \"\\n\"",
        "// Line_Reference 265:             \"GET / HTTP/1.0\\n\" \"Content-Length: %d\\n\" \"\\n\" \"%s\" % (len(body), body)",
        "// Line_Reference 292:         header = tobytes(\"GET / HTTP/1.1\\n\" \"Transfer-Encoding: chunked\\n\\n\")",
        "// Line_Reference 307:         header = tobytes(\"GET / HTTP/1.1\\n\" \"Transfer-Encoding: chunked\\n\\n\")",
        "// Line_Reference 324:         to_send = \"GET / HTTP/1.1\\nTransfer-Encoding: chunked\\n\\n\"",
        "// Line_Reference 325:         to_send += control_line + s",
        "// Line_Reference 327:         to_send += \"GET / HTTP/1.1\\nTransfer-Encoding: chunked\\n\\n\"",
        "// Line_Reference 350:             \"GET / HTTP/1.0\\n\" \"Content-Length: %d\\n\" \"\\n\" \"%s\" % (len(data), data)",
        "// Line_Reference 368:             \"GET / HTTP/1.0\\n\"",
        "// Line_Reference 369:             \"Connection: Keep-Alive\\n\"",
        "// Line_Reference 370:             \"Content-Length: %d\\n\"",
        "// Line_Reference 371:             \"\\n\"",
        "// Line_Reference 388:             \"GET / HTTP/1.1\\n\" \"Content-Length: %d\\n\" \"\\n\" \"%s\" % (len(data), data)",
        "// Line_Reference 401:             \"GET / HTTP/1.1\\n\"",
        "// Line_Reference 402:             \"Connection: keep-alive\\n\"",
        "// Line_Reference 403:             \"Content-Length: %d\\n\"",
        "// Line_Reference 404:             \"\\n\"",
        "// Line_Reference 418:             \"GET / HTTP/1.1\\n\"",
        "// Line_Reference 419:             \"Connection: close\\n\"",
        "// Line_Reference 420:             \"Content-Length: %d\\n\"",
        "// Line_Reference 421:             \"\\n\"",
        "// Line_Reference 433:             \"GET / HTTP/1.0\\n\"",
        "// Line_Reference 434:             \"Content-Length: 0\\n\"",
        "// Line_Reference 435:             \"Host: www.google.com:8080\\n\"",
        "// Line_Reference 436:             \"X-Forwarded-For: 192.168.1.1\\n\"",
        "// Line_Reference 437:             \"X-Forwarded-Proto: https\\n\"",
        "// Line_Reference 438:             \"X-Forwarded-Port: 5000\\n\\n\"",
        "// Line_Reference 510:             \"GET / HTTP/1.1\\n\"",
        "// Line_Reference 511:             \"Connection: close\\n\"",
        "// Line_Reference 512:             \"Content-Length: %d\\n\"",
        "// Line_Reference 513:             \"Expect: 100-continue\\n\"",
        "// Line_Reference 514:             \"\\n\"",
        "// Line_Reference 549:             \"GET /short_body HTTP/1.0\\n\"",
        "// Line_Reference 550:             \"Connection: Keep-Alive\\n\"",
        "// Line_Reference 551:             \"Content-Length: 0\\n\"",
        "// Line_Reference 552:             \"\\n\"",
        "// Line_Reference 575:             \"GET /long_body HTTP/1.0\\n\"",
        "// Line_Reference 576:             \"Connection: Keep-Alive\\n\"",
        "// Line_Reference 577:             \"Content-Length: 0\\n\"",
        "// Line_Reference 578:             \"\\n\"",
        "// Line_Reference 614:             \"GET / HTTP/1.0\\n\"",
        "// Line_Reference 615:             \"Connection: Keep-Alive\\n\"",
        "// Line_Reference 616:             \"Content-Length: %d\\n\\n\" % len(body)",
        "// Line_Reference 636:             \"GET /list HTTP/1.0\\n\"",
        "// Line_Reference 637:             \"Connection: Keep-Alive\\n\"",
        "// Line_Reference 638:             \"Content-Length: %d\\n\\n\" % len(body)",
        "// Line_Reference 659:             \"GET /list_lentwo HTTP/1.0\\n\"",
        "// Line_Reference 660:             \"Connection: Keep-Alive\\n\"",
        "// Line_Reference 661:             \"Content-Length: %d\\n\\n\" % len(body)",
        "// Line_Reference 680:         to_send = \"GET / HTTP/1.1\\n\" \"Content-Length: %s\\n\\n\" % len(body)",
        "// Line_Reference 701:         to_send = \"GET /list HTTP/1.1\\n\" \"Content-Length: %d\\n\\n\" % len(body)",
        "// Line_Reference 719:         to_send = \"GET /list_lentwo HTTP/1.1\\n\" \"Content-Length: %s\\n\\n\" % len(body)",
        "// Line_Reference 752:             \"GET /short_body HTTP/1.0\\n\"",
        "// Line_Reference 753:             \"Connection: Keep-Alive\\n\"",
        "// Line_Reference 754:             \"Content-Length: 0\\n\"",
        "// Line_Reference 755:             \"\\n\"",
        "// Line_Reference 776:             \"GET /long_body HTTP/1.0\\n\"",
        "// Line_Reference 777:             \"Connection: Keep-Alive\\n\"",
        "// Line_Reference 778:             \"Content-Length: 0\\n\"",
        "// Line_Reference 779:             \"\\n\"",
        "// Line_Reference 799:             \"GET /equal_body HTTP/1.0\\n\"",
        "// Line_Reference 800:             \"Connection: Keep-Alive\\n\"",
        "// Line_Reference 801:             \"Content-Length: 0\\n\"",
        "// Line_Reference 802:             \"\\n\"",
        "// Line_Reference 822:             \"GET /no_content_length HTTP/1.0\\n\"",
        "// Line_Reference 823:             \"Connection: Keep-Alive\\n\"",
        "// Line_Reference 824:             \"Content-Length: 0\\n\"",
        "// Line_Reference 825:             \"\\n\"",
        "// Line_Reference 856:         to_send = \"GET / HTTP/1.0\\n\" \"Content-Length: 5\\n\\n\"",
        "// Line_Reference 875:         to_send = \"GET / HTTP/1.0\\n\" \"Content-Length: 5\\n\" \"Connection: Keep-Alive\\n\\n\"",
        "// Line_Reference 896:         to_send = \"GET / HTTP/1.0\\n\\n\"",
        "// Line_Reference 912:         to_send = \"GET / HTTP/1.0\\nConnection: Keep-Alive\\n\\n\"",
        "// Line_Reference 935:         to_send = \"GET / HTTP/1.1\\n\" \"Content-Length: 5\\n\\n\"",
        "// Line_Reference 957:         to_send = \"GET / HTTP/1.1\\nContent-Length: 5\\nConnection: close\\n\\n\"",
        "// Line_Reference 974:         to_send = \"GET / HTTP/1.1\\n\\n\"",
        "// Line_Reference 999:         to_send = \"GET / HTTP/1.1\\nConnection: close\\n\\n\"",
        "// Line_Reference 1017:         to_send = \"GET / HTTP/1.1\\nTransfer-Encoding: chunked\\n\\n\"",
        "// Line_Reference 1045:         to_send = \"GET /before_start_response HTTP/1.0\\n\\n\"",
        "// Line_Reference 1061:         to_send = \"GET /before_start_response HTTP/1.1\\n\\n\"",
        "// Line_Reference 1080:             \"GET /before_start_response HTTP/1.1\\n\" \"Connection: close\\n\\n\"",
        "// Line_Reference 1100:         to_send = \"GET /after_start_response HTTP/1.0\\n\\n\"",
        "// Line_Reference 1120:         to_send = \"GET /after_start_response HTTP/1.1\\n\\n\"",
        "// Line_Reference 1139:             \"GET /after_start_response HTTP/1.1\\n\" \"Connection: close\\n\\n\"",
        "// Line_Reference 1159:         to_send = \"GET /after_write_cb HTTP/1.1\\n\\n\"",
        "// Line_Reference 1172:         to_send = \"GET /in_generator HTTP/1.1\\n\\n\"",
        "// Line_Reference 1195:         to_send = \"GET /filelike HTTP/1.1\\n\\n\"",
        "// Line_Reference 1213:         to_send = \"GET /filelike_nocl HTTP/1.1\\n\\n\"",
        "// Line_Reference 1231:         to_send = \"GET /filelike_shortcl HTTP/1.1\\n\\n\"",
        "// Line_Reference 1250:         to_send = \"GET /filelike_longcl HTTP/1.1\\n\\n\"",
        "// Line_Reference 1268:         to_send = \"GET /notfilelike HTTP/1.1\\n\\n\"",
        "// Line_Reference 1286:         to_send = \"GET /notfilelike_iobase HTTP/1.1\\n\\n\"",
        "// Line_Reference 1304:         to_send = \"GET /notfilelike_nocl HTTP/1.1\\n\\n\"",
        "// Line_Reference 1321:         to_send = \"GET /notfilelike_shortcl HTTP/1.1\\n\\n\"",
        "// Line_Reference 1340:         to_send = \"GET /notfilelike_longcl HTTP/1.1\\n\\n\"",
        "// Line_Reference 1359:         to_send = \"GET /filelike HTTP/1.0\\n\\n\"",
        "// Line_Reference 1378:         to_send = \"GET /filelike_nocl HTTP/1.0\\n\\n\"",
        "// Line_Reference 1397:         to_send = \"GET /notfilelike HTTP/1.0\\n\\n\"",
        "// Line_Reference 1416:         to_send = \"GET /notfilelike_nocl HTTP/1.0\\n\\n\"",
        "// Line_Reference 1585:         if line in (b\"\\r\\n\", b\"\\n\", b\"\"):"
    ]
}
