/* $OpenBSD: scp.c,v 1.208 2020/04/30 17:07:10 markus Exp $ */
enum {
YES, NO, DISPLAYED
} wrerr;
int setimes, targisdir, wrerrno = 0;
wrerr = NO;
if (wrerr == NO) {
wrerr = YES;
wrerrno = errno;
if (count != 0 && wrerr == NO &&
wrerr = YES;
wrerrno = errno;
}
if (wrerr == NO && (!exists || S_ISREG(stb.st_mode)) &&
ftruncate(ofd, size) != 0) {
run_err("%s: truncate: %s", np, strerror(errno));
wrerr = DISPLAYED;
run_err("%s: set mode: %s",
wrerr = DISPLAYED;
run_err("%s: set mode: %s",
wrerr = DISPLAYED;
if (close(ofd) == -1) {
wrerr = YES;
wrerrno = errno;
}
if (setimes && wrerr == NO) {
run_err("%s: set times: %s",
wrerr = DISPLAYED;
switch (wrerr) {
case YES:
run_err("%s: %s", np, strerror(wrerrno));
break;
case NO:
break;
case DISPLAYED:
break;
}