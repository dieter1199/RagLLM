$tag = $_REQUEST['tag'];
$lang = $_REQUEST['lang'];
AND d.lang = '.protect($lang).'
AND d.website = '.$website->id.'
WHERE website = ' . $website->id . '
AND lang = ' . protect($lang) . '
AND FIND_IN_SET('.protect($tag).', text) > 0
ORDER BY p.id DESC
');
$where      =   ' p.website = '.$website->id;
$sql = ' SELECT SQL_CALC_FOUND_ROWS
p.*, d.text as title, d.lang as language,
u.username as author_username,
(   SELECT COUNT(*)
FROM nv_comments cm
WHERE cm.object_type = "product"
AND cm.object_id = p.id
AND cm.website = '.$website->id.'
) as comments
FROM nv_products p
LEFT JOIN nv_webdictionary d
ON p.id = d.node_id
AND d.node_type = "product"
AND d.subtype = "title"
AND d.lang = '.protect($website->languages_list[0]).'
AND d.website = '.$website->id.'
LEFT JOIN nv_users u
ON u.id = p.author
WHERE '.$where.'
ORDER BY '.$orderby.'
LIMIT '.$max.'
OFFSET '.$offset;
if(!$DB->query($sql, 'array'))
throw new Exception($DB->get_last_error());
$DB->query('SELECT id, date_created, autosave
FROM nv_webdictionary_history
WHERE node_type = "product"
AND subtype = '.protect('section-'.$_REQUEST['section']).'
AND lang = '.protect($_GET['lang']).'
AND node_id = '.protect($_REQUEST['id']).'
AND website = '.$website->id.'
ORDER BY date_created DESC',
'array');
AND lang = '.protect($_REQUEST['lang']).'
AND website = '.$website->id.'
AND text LIKE '.protect('%'.$_REQUEST['title'].'%').'
'array'
$DB->query('SELECT text
FROM nv_webdictionary_history
WHERE node_type = "product"
AND website = '.$website->id.'
AND id = '.protect($_REQUEST['id']),
'array');
$DB->query('SELECT text
FROM nv_webdictionary
WHERE node_type = "product"
AND subtype = '.protect('section-'.$_REQUEST['section']).'
AND lang = '.protect($_REQUEST['lang']).'
AND website = '.$website->id.'
AND node_id = '.protect($_REQUEST['node_id']),
'array');
$DB->query('SELECT text
FROM nv_webdictionary
WHERE node_type = "property-product"
AND subtype = '.protect('property-'.$_REQUEST['section'].'-'.$_REQUEST['lang']).'
AND lang = '.protect($_REQUEST['lang']).'
AND website = '.$website->id.'
AND node_id = '.protect($_REQUEST['node_id']),
'array');
$path = $_REQUEST['path'];
WHERE path = '.protect($path).'
AND website = '.$website->id
WHERE sku = '.protect($sku).'
AND website = '.$website->id
WHERE username LIKE '.protect('%'.$_REQUEST['username'].'%').'
'array
');
$template_filter = '';
if(!empty($_REQUEST['template']))
$template_filter = ' AND nvp.template = '.protect($_REQUEST['template']).' ';
AND nvw.website = '.$website->id.'
AND ( nvw.text LIKE ' . protect('%' . $text . '%') . '
OR
( nvp.id LIKE  ' . protect('%' . $text . '%') . '
AND
nvw.lang = '.protect($website->languages_published[0]).'
)
$DB->query($sql, 'array');
nvb.name LIKE ' . protect('%' . $text . '%') . '    OR
nvb.id LIKE   ' . protect('%' . $text . '%') . '
$DB->query($sql, 'array');
WHERE nvc.website = '.protect($website->id).'
AND nvc.object_id = '.protect($item->id).'
