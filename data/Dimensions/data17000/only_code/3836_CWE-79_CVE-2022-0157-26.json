Copyright (C) 2008 - 2015, Phoronix Media
Copyright (C) 2008 - 2015, Michael Larabel
if(function_exists('ssh2_connect') && isset($_POST['ip']) && isset($_POST['port']) && isset($_POST['password']) && isset($_POST['username']))
{
$connection = ssh2_connect($_POST['ip'], $_POST['port']);
if(ssh2_auth_password($connection, $_POST['username'], $_POST['password']))
{
$tmp_local_file = tempnam('/tmp', 'pts-ssh');
$tmp_remote_file = 'pts-ssh-' . rand(9999, 99999);
file_put_contents($tmp_local_file, '#!/bin/sh
if [ -w /var/lib/phoronix-test-suite/ ]
then
PHORO_FILE_PATH=/var/lib/phoronix-test-suite/
elif [ -w $HOME/.phoronix-test-suite/ ]
then
PHORO_FILE_PATH=$HOME/.phoronix-test-suite/
fi
echo "' . phoromatic_web_socket_server_ip() . '" >> $PHORO_FILE_PATH/phoromatic-servers
mkdir -p $PHORO_FILE_PATH/modules-data/phoromatic
echo "' . phoromatic_web_socket_server_addr() . '" > $PHORO_FILE_PATH/modules-data/phoromatic/last-phoromatic-server
');
ssh2_scp_send($connection, $tmp_local_file, $tmp_remote_file);
unlink($tmp_local_file);
ssh2_exec($connection, 'chmod +x ' . $tmp_remote_file);
ssh2_exec($connection, './' . $tmp_remote_file);
ssh2_exec($connection, 'rm' . $tmp_remote_file);
}
}
$stmt->bindValue(':ip_address', $_POST['ip_claim']);
$stmt->bindValue(':mac_address', $_POST['mac_claim']);
$stmt->bindValue(':ip_address', $ipc);
$stmt->bindValue(':mac_address', $macc);
