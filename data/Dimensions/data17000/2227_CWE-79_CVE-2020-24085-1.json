{
    "cve_id": "CVE-2020-24085",
    "cve_description": "A cross-site scripting (XSS) vulnerability exists in MISP v2.4.128 in app/Controller/UserSettingsController.php at SetHomePage() function. Due to a lack of controller validation in \"path\" parameter, an attacker can execute malicious JavaScript code.",
    "cve_publish_date": "2021-01-26",
    "cwe_id": "CWE-79",
    "cwe_name": "Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting')",
    "cwe_description": "The product does not neutralize or incorrectly neutralizes user-controllable input before it is placed in output that is used as a web page that is served to other users.",
    "commit_message": "fix: [security] xss fix missing part of solution\n\n- the previous fix to the xss in the homepage setter was lacking the controller changes due to a partial commit (#bf4610c947c7dc372c4078f363d2dff6ae0703a8)\n\n  - as originally discovered by Mislav Božičević <mislav.bozicevic@nn.cz>\n  - persistence of the vulnerability after the lacking fix reported by DIEGO JURADO PALLARES from Ciberinteligencia",
    "type_of_change": "Modification",
    "filename_of_changes": "UserSettingsController.php",
    "code_language": "PHP",
    "number_of_lines_added_for_mitigation": "21",
    "number_of_lines_deleted_vulnerable_to_cve": "18",
    "vulnerable_lines": [
        "// Line_Reference 31:         $this->Security->unlockedActions = array_merge($this->Security->unlockedActions, array('setHomePage'));",
        "// Line_Reference 328:         if (!$this->request->is('post')) {",
        "// Line_Reference 329:             throw new MethodNotAllowedException(__('This endpoint only aaccepts POST requests.'));",
        "// Line_Reference 330:         }",
        "// Line_Reference 331:         if (empty($this->request->data['path'])) {",
        "// Line_Reference 332:             $this->request->data = array('path' => $this->request->data);",
        "// Line_Reference 333:         }",
        "// Line_Reference 334:         if (empty($this->request->data['path'])) {",
        "// Line_Reference 335:             throw new InvalidArgumentException(__('No path POSTed.'));",
        "// Line_Reference 337:         $setting = array(",
        "// Line_Reference 338:             'UserSetting' => array(",
        "// Line_Reference 339:                 'user_id' => $this->Auth->user('id'),",
        "// Line_Reference 340:                 'setting' => 'homepage',",
        "// Line_Reference 341:                 'value' => json_encode(array('path' => $this->request->data['path']))",
        "// Line_Reference 342:             )",
        "// Line_Reference 343:         );",
        "// Line_Reference 344:         $result = $this->UserSetting->setSetting($this->Auth->user(), $setting);",
        "// Line_Reference 345:         return $this->RestResponse->saveSuccessResponse('UserSettings', 'setHomePage', false, $this->response->type(), 'Homepage set to ' . $this->request->data['path']);"
    ]
}
