{
    "cve_id": "CVE-2021-27340",
    "cve_description": "OpenSIS Community Edition version <= 7.6 is affected by a reflected XSS vulnerability in EmailCheck.php via the \"opt\" parameter.",
    "cve_publish_date": "2021-09-16",
    "cwe_id": "CWE-79",
    "cwe_name": "Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting')",
    "cwe_description": "The product does not neutralize or incorrectly neutralizes user-controllable input before it is placed in output that is used as a web page that is served to other users.",
    "commit_message": "Commit with security and bug fixes",
    "type_of_change": "ModificationType.ADD",
    "filename_of_changes": "Backup.php",
    "code_language": "PHP",
    "number_of_lines_added_for_mitigation": "32",
    "number_of_lines_deleted_vulnerable_to_cve": "35",
    "vulnerable_lines": [
        "// Line_Reference 56:         $sql_path_arr = explode(\"\\\\\", $_SERVER['MYSQL_HOME']);",
        "// Line_Reference 57:         $sql_path = \"\\\\\" . $sql_path_arr[1] . '\\\\' . $sql_path_arr[2] . '\\\\' . $sql_path_arr[3];",
        "// Line_Reference 58:         $mysql_dir = str_replace('\\\\', '\\\\\\\\', $mysql_dir1 . $_SERVER['MYSQL_HOME']);",
        "// Line_Reference 66:     } else {",
        "// Line_Reference 73:     $same_dt_chck = DBGet(DBQuery(\"SELECT COUNT(*) AS TODAY_BACKUP FROM `program_config` WHERE `program` = 'DB_BACKUP' AND `value` = '\" . $fair_date . \"'\"));",
        "// Line_Reference 75:     if ($same_dt_chck[1]['TODAY_BACKUP'] == 0) {",
        "// Line_Reference 76:         $program_entry = \"INSERT INTO `program_config` (`syear`, `school_id`, `program`, `title`, `value`) VALUES('\" . UserSyear() . \"', '\" . UserSchool() . \"', 'DB_BACKUP', '\" . str_replace(\".sql\", \"\", $Export_FileName) . \"', '\" . $fair_date . \"')\";",
        "// Line_Reference 78:         if ($program_entry) {",
        "// Line_Reference 84:     header('Location: ' . $Export_FileName);",
        "// Line_Reference 94: ?>",
        "// Line_Reference 100:                 echo '<h4 class=\"text-danger\">' . _note . ':</h4><p>' . _thisBackupUtilityWillCreateABackupOfTheDatabaseAlongWithTheDatabaseStructureYouWillBeAbleToUseThisBackupFileToRestoreTheDatabaseHoweverInOrderToRestoreYouWillNeedToHaveAccessToMySqlAdministrationApplicationLikePhpMyAdminAndTheRootUserIdAndPasswordToMySql . '</p>';",
        "// Line_Reference 102:                 $btn = '<input type=\"submit\" name=\"action\"  value=\"' . _backup . '\" class=\"btn btn-primary\"> &nbsp; ';",
        "// Line_Reference 104:                 $btn .= '<a href=javascript:void(0); onClick=\"check_content(\\'Ajax.php?modname=miscellaneous/Portal.php\\');\" STYLE=\"TEXT-DECORATION: NONE\"> <INPUT type=button class=\"btn btn-default\" name=Cancel value=\"' . _cancel . '\"></a>';",
        "// Line_Reference 105: ",
        "// Line_Reference 111: <?php",
        "// Line_Reference 114: function EXPORT_TABLES($host, $user, $pass, $name, $tables = false, $backup_name = false)",
        "// Line_Reference 115: {",
        "// Line_Reference 118:     //    $backup_name=$name.\"(\".date(\"H:i:s d-m-Y\").\").sql\";",
        "// Line_Reference 129:     }",
        "// Line_Reference 130:     if ($tables !== false) {",
        "// Line_Reference 161:                         if ($j < ($fields_amount - 1)) {",
        "// Line_Reference 162:                             $content .= ',';",
        "// Line_Reference 163:                         }",
        "// Line_Reference 164:                     }",
        "// Line_Reference 165:                     $content .= \")\";",
        "// Line_Reference 171:                     }",
        "// Line_Reference 172:                     $st_counter = $st_counter + 1;",
        "// Line_Reference 174:             }",
        "// Line_Reference 175:             $content .= \"\\n\\n\\n\";",
        "// Line_Reference 179:     $content .= \"--",
        "// Line_Reference 249:     $content .= \"DELIMITER $$",
        "// Line_Reference 668:     $content .= \"--",
        "// Line_Reference 808:     //    $backup_name = $backup_name ? $backup_name.\"_(\".date('H:i:s').\"_\".date('d-m-Y').\")__rand\".rand(1,11111111).\".sql\" : $name.\"___(\".date('H-i-s').\"_\".date('d-m-Y').\")__rand\".rand(1,11111111).\".sql\";",
        "// Line_Reference 809:     //",
        "// Line_Reference 820: ?>"
    ]
}
