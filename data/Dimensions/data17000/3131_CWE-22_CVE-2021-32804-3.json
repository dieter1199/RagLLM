{
    "cve_id": "CVE-2021-32804",
    "cve_description": "The npm package \"tar\" (aka node-tar) before versions 6.1.1, 5.0.6, 4.4.14, and 3.3.2 has a arbitrary File Creation/Overwrite vulnerability due to insufficient absolute path sanitization. node-tar aims to prevent extraction of absolute file paths by turning absolute paths into relative paths when the `preservePaths` flag is not set to `true`. This is achieved by stripping the absolute path root from any absolute file paths contained in a tar file. For example `/home/user/.bashrc` would turn into `home/user/.bashrc`. This logic was insufficient when file paths contained repeated path roots such as `////home/user/.bashrc`. `node-tar` would only strip a single path root from such paths. When given an absolute file path with repeating path roots, the resulting path (e.g. `///home/user/.bashrc`) would still resolve to an absolute path, thus allowing arbitrary file creation and overwrite. This issue was addressed in releases 3.2.2, 4.4.14, 5.0.6 and 6.1.1. Users may work around this vulnerability without upgrading by creating a custom `onentry` method which sanitizes the `entry.path` or a `filter` method which removes entries with absolute paths. See referenced GitHub Advisory for details. Be aware of CVE-2021-32803 which fixes a similar bug in later versions of tar.",
    "cve_publish_date": "2021-08-03",
    "cwe_id": "CWE-22",
    "cwe_name": "Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal')",
    "cwe_description": "The product uses external input to construct a pathname that is intended to identify a file or directory that is located underneath a restricted parent directory, but the product does not properly neutralize special elements within the pathname that can cause the pathname to resolve to a location that is outside of the restricted directory.",
    "commit_message": "fix: strip absolute paths more comprehensively",
    "type_of_change": "Modification",
    "filename_of_changes": "write-entry.js",
    "code_language": "JavaScript",
    "number_of_lines_added_for_mitigation": "13",
    "number_of_lines_deleted_vulnerable_to_cve": "10",
    "vulnerable_lines": [
        "// Line_Reference 55:     if (!this.preservePaths && path.win32.isAbsolute(p)) {",
        "// Line_Reference 56:       // absolutes on posix are also absolutes on win32",
        "// Line_Reference 57:       // so we only need to test this one to get both",
        "// Line_Reference 58:       const parsed = path.win32.parse(p)",
        "// Line_Reference 59:       this.path = p.substr(parsed.root.length)",
        "// Line_Reference 60:       pathWarn = parsed.root",
        "// Line_Reference 354:     if (path.isAbsolute(this.path) && !this.preservePaths) {",
        "// Line_Reference 355:       const parsed = path.parse(this.path)",
        "// Line_Reference 356:       pathWarn = parsed.root",
        "// Line_Reference 357:       this.path = this.path.substr(parsed.root.length)"
    ]
}
