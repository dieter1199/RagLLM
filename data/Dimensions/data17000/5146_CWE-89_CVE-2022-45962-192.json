{
    "cve_id": "CVE-2022-45962",
    "cve_description": "Open Solutions for Education, Inc openSIS Community Edition v8.0 and earlier is vulnerable to SQL Injection via CalendarModal.php.",
    "cve_publish_date": "2023-02-13",
    "cwe_id": "CWE-89",
    "cwe_name": "Improper Neutralization of Special Elements used in an SQL Command ('SQL Injection')",
    "cwe_description": "The product constructs all or part of an SQL command using externally-influenced input from an upstream component, but it does not neutralize or incorrectly neutralizes special elements that could modify the intended SQL command when it is sent to a downstream component. Without sufficient removal or quoting of SQL syntax in user-controllable inputs, the generated SQL query can cause those inputs to be interpreted as SQL instead of ordinary user data.",
    "commit_message": "Version 9.0 release\n\nOlder version shifted to branch: Version_8.0",
    "type_of_change": "ModificationType.ADD",
    "filename_of_changes": "Calendar.php",
    "code_language": "PHP",
    "number_of_lines_added_for_mitigation": "155",
    "number_of_lines_deleted_vulnerable_to_cve": "184",
    "vulnerable_lines": [
        "// Line_Reference 41:     echo \"<tr><td  style=\\\"font-size:15px; font-weight:bold; padding-top:10px;\\\">\" . GetSchool(UserSchool()) . \"<div style=\\\"font-size:12px;\\\">\"._listOfEvents.\"</div></td><td align=right style=\\\"padding-top:10px;\\\">\" . ProperDate(DBDate()) . \"<br />\"._listOfEvents.\" openSIS</td></tr><tr><td colspan=2 style=\\\"border-top:1px solid #333;\\\">&nbsp;</td></tr></table>\";",
        "// Line_Reference 43:     ListOutputFloat($_SESSION['events_RET'], array('SCHOOL_DATE' =>_date, 'TITLE' =>_date, 'DESCRIPTION' =>_description), event, events, '', '', array('search' =>_date, 'count' =>_description));",
        "// Line_Reference 55:     DrawBC(\"\"._schoolSetup.\" > \" . ProgramTitle());",
        "// Line_Reference 64:         echo '<div class=\"alert alert-danger no-border\">'._noCalendarsWereFound.'</div>';",
        "// Line_Reference 72:     $message .= '<label class=\"col-md-2 control-label text-right\">'._title.'</label>';",
        "// Line_Reference 75:     $message .= '<div class=\"checkbox checkbox-switch switch-success\"><label><INPUT type=checkbox name=default value=Y><span></span>'._defaultCalendarForThisSchool.'</label></div>';",
        "// Line_Reference 87:     $message .= '<label class=\"col-md-4 control-label text-right\">'._from.'</label>';",
        "// Line_Reference 93:     $message .= '<label class=\"col-md-4 control-label text-right\">'._to.'</label>';",
        "// Line_Reference 103:     $message .= '<label class=\"col-md-4 control-label text-right\">'._weekdays.'</label>';",
        "// Line_Reference 104:     $message .= '<div class=\"col-md-8\"><div class=\"checkbox\"><label><INPUT class=\"styled\" type=checkbox value=Y name=weekdays[0]>'._sunday.'</label></div> <div class=\"checkbox\"><label><INPUT class=\"styled\" type=checkbox value=Y name=weekdays[1] CHECKED>'._monday.'</label></div> <div class=\"checkbox\"><label><INPUT class=\"styled\" type=checkbox value=Y name=weekdays[2] CHECKED>'._tuesday.'</label></div> <div class=\"checkbox\"><label><INPUT class=\"styled\" type=checkbox value=Y name=weekdays[3] CHECKED>'._wednesday.'</label></div> <div class=\"checkbox\"><label><INPUT class=\"styled\" type=checkbox value=Y name=weekdays[4] CHECKED>'._thursday.'</label></div> <div class=\"checkbox\"><label><INPUT class=\"styled\" type=checkbox value=Y name=weekdays[5] CHECKED>'._friday.'</label></div> <div class=\"checkbox\"><label><INPUT class=\"styled\" type=checkbox value=Y name=weekdays[6]>'._saturday.'</label></div></div>';",
        "// Line_Reference 119:     if (Prompt_Calender(''._createANewCalendar.'', '', $message)) {",
        "// Line_Reference 125:         $col = Calender_Title;",
        "// Line_Reference 129:         $fetch_calendar_id = DBGet(DBQuery('SHOW TABLE STATUS LIKE \\'school_calendars\\''));",
        "// Line_Reference 131:         $calendar_id[1]['CALENDAR_ID'] = $fetch_calendar_id[1]['AUTO_INCREMENT'];",
        "// Line_Reference 132:         $calendar_id = $calendar_id[1]['CALENDAR_ID'];",
        "// Line_Reference 134:             for ($i = $begin; $i <= $end; $i+=86400) {",
        "// Line_Reference 147:         if ($dup_cal_title[1]['NO'] == 0)",
        "// Line_Reference 148:             DBQuery('INSERT INTO school_calendars (SYEAR,SCHOOL_ID,TITLE,DEFAULT_CALENDAR,DAYS) values(\\'' . UserSyear() . '\\',\\'' . UserSchool() . '\\',\\'' . $cal_title . '\\',\\'' . $_REQUEST['default'] . '\\',\\'' . conv_day($_REQUEST['weekdays']) . '\\')');",
        "// Line_Reference 153:                     $profile_sql .='(\\'' . $calendar_id . '\\',\\'' . $key . '\\',NULL),';",
        "// Line_Reference 155:                     $profile_sql .='(\\'' . $calendar_id . '\\',NULL,\\'' . $key . '\\'),';",
        "// Line_Reference 162:                 echo'<div class=\"alert alert-danger\">'._calenderTitleAlreadyExists.'</div>';",
        "// Line_Reference 176:     $colmn = Calender_Id;",
        "// Line_Reference 177:     $cal_title = paramlib_validation($colmn, $_REQUEST[calendar_id]);",
        "// Line_Reference 185:         UnableDeletePrompt( _cannotDeleteBecauseStudentsAreEnrolledInThisCalendar);",
        "// Line_Reference 187:         UnableDeletePrompt( _cannotDeleteBecauseCoursePeriodsAreCreatedOnThisCalendar);",
        "// Line_Reference 200:                     $error = array(''._thereAreNoCalendarsYetSetup.'.');",
        "// Line_Reference 212:     $colmn = Calender_Id;",
        "// Line_Reference 234:     $message .= '<label class=\"col-md-2 control-label text-right\">'._title.'</label>';",
        "// Line_Reference 236:     $message .= '<INPUT type=text name=title class=form-control id=title value=\"' . $acs_RET[TITLE] . '\">';",
        "// Line_Reference 237:     $message .= '<div class=\"checkbox checkbox-switch switch-success switch-sm\"><label><INPUT type=checkbox name=default value=Y ' . (($acs_RET['DEFAULT_CALENDAR'] == 'Y') ? 'checked' : '') . '><span></span>'._defaultCalendarForThisSchool.'</label></div>';",
        "// Line_Reference 246:     $message .= '<label class=\"col-md-4 control-label text-right\">'._from.'</label>';",
        "// Line_Reference 252:     $message .= '<label class=\"col-md-4 control-label text-right\">'._to.'</label>';",
        "// Line_Reference 261:     $message .= '<label class=\"col-md-4 control-label text-right\">'._weekdays.'</label>';",
        "// Line_Reference 262:     $message .= '<div class=\"col-md-8\"><div class=\"checkbox\"><label><INPUT class=\"styled\" type=checkbox value=Y name=weekdays[0] ' . ((in_array('U', $weekdays) == true) ? 'CHECKED' : '') . ' DISABLED> '._sunday.'</label></div><div class=\"checkbox\"><label><INPUT class=\"styled\" type=checkbox value=Y name=weekdays[1] ' . ((in_array('M', $weekdays) == true) ? 'CHECKED' : '') . ' DISABLED>'._monday.'</label></div><div class=\"checkbox\"><label><INPUT class=\"styled\" type=checkbox value=Y name=weekdays[2] ' . ((in_array('T', $weekdays) == true) ? 'CHECKED' : '') . ' DISABLED>'._tuesday.'</label></div><div class=\"checkbox\"><label><INPUT class=\"styled\" type=checkbox value=Y name=weekdays[3] ' . ((in_array('W', $weekdays) == true) ? 'CHECKED' : '') . ' DISABLED>'._wednesday.'</label></div><div class=\"checkbox\"><label><INPUT class=\"styled\" type=checkbox value=Y name=weekdays[4] ' . ((in_array('H', $weekdays) == true) ? 'CHECKED' : '') . ' DISABLED>'._thursday.'</label></div><div class=\"checkbox\"><label><INPUT class=\"styled\" type=checkbox value=Y name=weekdays[5] ' . ((in_array('F', $weekdays) == true) ? 'CHECKED' : '') . ' DISABLED>'._friday.'</label></div><div class=\"checkbox\"><label><INPUT class=\"styled\" type=checkbox value=Y name=weekdays[6] ' . ((in_array('S', $weekdays) == true) ? 'CHECKED' : '') . ' DISABLED> '._saturday.'</label></div></div>';",
        "// Line_Reference 284:         $end_date_cal=$_REQUEST['year__max'].'-'.$_REQUEST['month__max'].'-'.$_REQUEST['day__max'];",
        "// Line_Reference 285:         $start_date_cal=$_REQUEST['year__min'].'-'.$_REQUEST['month__min'].'-'.$_REQUEST['day__min'];",
        "// Line_Reference 286: ",
        "// Line_Reference 287:         $min_date=DBGet(DBquery('SELECT MIN(SCHOOL_DATE) as SCHOOL_DATE FROM attendance_calendar WHERE CALENDAR_ID='.$cal_id));",
        "// Line_Reference 288:         $max_date=DBGet(DBquery('SELECT MAX(SCHOOL_DATE) as SCHOOL_DATE FROM attendance_calendar WHERE CALENDAR_ID='.$cal_id));",
        "// Line_Reference 289:         $cal_days=DBGet(DBquery('SELECT DAYS FROM school_calendars WHERE CALENDAR_ID='.$cal_id));",
        "// Line_Reference 290:         $days_conv=array('Mon'=>'M','Tue'=>'T','Wed'=>'W','Thu'=>'H','Fri'=>'F','Sat'=>'S','Sun'=>'U');",
        "// Line_Reference 291:         if(strtotime($start_date_cal)<strtotime($min_date[1]['SCHOOL_DATE']) && $start_date_cal!='' && $min_date[1]['SCHOOL_DATE']!='')",
        "// Line_Reference 292:         {",
        "// Line_Reference 293:         $date1_ts = strtotime($start_date_cal);",
        "// Line_Reference 294:         $date2_ts = strtotime($min_date[1]['SCHOOL_DATE']);",
        "// Line_Reference 295:         $diff = $date2_ts - $date1_ts;",
        "// Line_Reference 296:         for($d=0;$d<round($diff / 86400);$d++)",
        "// Line_Reference 297:         {",
        "// Line_Reference 298:             $mk_date=strtotime($start_date_cal)+(86400*$d);",
        "// Line_Reference 299:             if(strpos($cal_days[1]['DAYS'],$days_conv[date('D',$mk_date)])!==false)",
        "// Line_Reference 300:             {",
        "// Line_Reference 301:                 $ins_date=date('Y-m-d',$mk_date);",
        "// Line_Reference 302:                 DBQuery('INSERT INTO attendance_calendar (SYEAR,SCHOOL_ID,SCHOOL_DATE,MINUTES,CALENDAR_ID) VALUES (\\''.UserSyear().'\\',\\''.UserSchool().'\\',\\''.$ins_date.'\\',999,\\''.$cal_id.'\\')');",
        "// Line_Reference 305:         }",
        "// Line_Reference 306:         if(strtotime($end_date_cal)>strtotime($max_date[1]['SCHOOL_DATE']))",
        "// Line_Reference 307:         {",
        "// Line_Reference 308:         $date2_ts = strtotime($end_date_cal);",
        "// Line_Reference 309:         $date1_ts = strtotime($max_date[1]['SCHOOL_DATE']);",
        "// Line_Reference 310:         $diff = $date2_ts - $date1_ts;",
        "// Line_Reference 311:         for($d=1;$d<=round($diff / 86400);$d++)",
        "// Line_Reference 312:         {",
        "// Line_Reference 313:             $mk_date=strtotime($max_date[1]['SCHOOL_DATE'])+(86400*$d);",
        "// Line_Reference 314:             if(strpos($cal_days[1]['DAYS'],$days_conv[date('D',$mk_date)])!==false)",
        "// Line_Reference 315:             {",
        "// Line_Reference 316:                 $ins_date=date('Y-m-d',$mk_date);",
        "// Line_Reference 317:                 DBQuery('INSERT INTO attendance_calendar (SYEAR,SCHOOL_ID,SCHOOL_DATE,MINUTES,CALENDAR_ID) VALUES (\\''.UserSyear().'\\',\\''.UserSchool().'\\',\\''.$ins_date.'\\',999,\\''.$cal_id.'\\')');",
        "// Line_Reference 319:         }",
        "// Line_Reference 325:                     $profile_sql .='(\\'' . $cal_id . '\\',\\'' . $key . '\\',NULL),';",
        "// Line_Reference 327:                     $profile_sql .='(\\'' . $cal_id . '\\',NULL,\\'' . $key . '\\'),';",
        "// Line_Reference 334:                 echo'<p style=color:red>'._calenderTitleAlreadyExists.'.</p>';",
        "// Line_Reference 397:                         $value = mysql_real_escape_string($value);",
        "// Line_Reference 406:                         $sql.=' CALENDAR_ID=\\'0\\'';",
        "// Line_Reference 410:                         $sql.=' CALENDAR_ID=\\'' . $_REQUEST[calendar_id] . '\\'';",
        "// Line_Reference 415:                         $sql.=',CALENDAR_ID=\\'0\\'';",
        "// Line_Reference 418:                         $sql.=' ,CALENDAR_ID=\\'' . $_REQUEST[calendar_id] . '\\'';",
        "// Line_Reference 421:                 $sql.= ' WHERE ID=\\'' . $_REQUEST[event_id] . '\\'';",
        "// Line_Reference 422: ",
        "// Line_Reference 425:             }",
        "// Line_Reference 426:             else {",
        "// Line_Reference 446:                                 $value = mysql_real_escape_string($value);",
        "// Line_Reference 454: ",
        "// Line_Reference 471:             DBQuery(\"DELETE FROM calendar_events WHERE ID='\" . paramlib_validation($column = EVENT_ID, $_REQUEST[event_id]) . \"'\");",
        "// Line_Reference 472: ",
        "// Line_Reference 473:             // echo '<SCRIPT language=javascript>opener.document.location = \"Modules.php?modname=' . $_REQUEST['modname'] . '&calendar_id=' . $_REQUEST['calendar_id'] . '&year=' . $_REQUEST['year'] . '&month=' . MonthNWSwitch($_REQUEST['month'], 'tochar') . '\"; window.close();</script>';",
        "// Line_Reference 478: //",
        "// Line_Reference 479: //            echo '<SCRIPT language=javascript>window.location.href = \"Modules.php?modname=' . $_REQUEST['modname'] . '\"; window.close();</script>';",
        "// Line_Reference 480: //            unset($_REQUEST['values']);",
        "// Line_Reference 481: //            unset($_SESSION['_REQUEST_vars']['values']);",
        "// Line_Reference 482: //            unset($_REQUEST['button']);",
        "// Line_Reference 483: //            unset($_SESSION['_REQUEST_vars']['button']);",
        "// Line_Reference 484: //            echo '<SCRIPT language=javascript>window.close();</script>';",
        "// Line_Reference 500:             $RET = DBGet(DBQuery('SELECT TITLE,STAFF_ID,DATE_FORMAT(DUE_DATE,\\'%d-%b-%y\\') AS SCHOOL_DATE,ASSIGNED_DATE,DUE_DATE,DESCRIPTION FROM gradebook_assignments WHERE ASSIGNMENT_ID=\\'' . $_REQUEST[assignment_id] . '\\''));",
        "// Line_Reference 508:         echo '<div class=\"form-group\"><label class=\"control-label text-right col-md-4\">'._date.'</label><div class=\"col-md-8\">' . date(\"Y/M/d\", strtotime($RET[1]['SCHOOL_DATE'])) . '</div></div>';",
        "// Line_Reference 517:             echo '<div class=\"form-group\"><label class=\"control-label text-right col-md-4\">'._teacher.'</label><div class=\"col-md-8\">' . (User('PROFILE') == 'admin' ? TextAreaInput($RET[1]['STAFF_ID'], 'values[STAFF_ID]') : $RET[1]['STAFF_ID']) . '</div></div>';",
        "// Line_Reference 521:             echo '<div class=\"form-group\"><label class=\"control-label text-right col-md-4\">'._assignedDate.'</label><div class=\"col-md-8\">' . (User('PROFILE') == 'admin' ? TextAreaInput($RET[1]['ASSIGNED_DATE'], 'values[ASSIGNED_DATE]') : $RET[1]['ASSIGNED_DATE']) . '</div></div>';",
        "// Line_Reference 525:             echo '<div class=\"form-group\"><label class=\"control-label text-right col-md-4\">'._dueDate.'</label><div class=\"col-md-8\">' . (User('PROFILE') == 'admin' ? TextAreaInput($RET[1]['DUE_DATE'], 'values[DUE_DATE]') : $RET[1]['DUE_DATE']) . '</div></div>';",
        "// Line_Reference 536:                 echo '<INPUT type=submit class=\"btn btn-primary\" name=button value='._save.' onclick=\"return formcheck_calendar_event();\">';",
        "// Line_Reference 539:                 echo '<INPUT type=submit name=button class=\"btn btn-white\" value='._delete.' onclick=\"formload_ajax(\\'popform\\');\">';",
        "// Line_Reference 540:         }",
        "// Line_Reference 541:         else {",
        "// Line_Reference 542:             echo '<div class=\"form-group\"><label class=\"control-label text-right col-md-4\">'._showEventsSystemWide.'</label><div class=\"col-md-8\">' . ($RET[1]['CALENDAR_ID'] == '' ? '<i class=\"icon-checkbox-checked\"></i>' : '<i class=\"icon-checkbox-unchecked\"></i>') . '</div></div>';",
        "// Line_Reference 560:             $_REQUEST['day_start'] --;",
        "// Line_Reference 601:             $_REQUEST['day_end'] --;",
        "// Line_Reference 642:         DrawBC(\"\"._schoolSetup.\" > \" . ProgramTitle());",
        "// Line_Reference 661:         echo '<div class=\"alert alert-danger alert-styled-left alert-bordered\"><span class=\"text-bold\">'._alert.'!!</span> - '._alert.'.</span></div>';",
        "// Line_Reference 668:     echo '<h6 class=\"panel-title\"><A HREF=Modules.php?modname=' . $_REQUEST['modname'] . '&month=' . $_REQUEST['month'] . '&year=' . $_REQUEST['year'] . ' class=\"text-primary\"><i class=\"icon-square-left\"></i>'._backToCalendar.'</A></h6>';",
        "// Line_Reference 671:     echo '<div class=\"form-inline inline-block\"><div class=\"inline-block\">' . PrepareDateSchedule($start_date, 'start') . '</div><label>&nbsp; &nbsp; - &nbsp; &nbsp;</label><div class=\"inline-block\">' . PrepareDateSchedule($end_date, 'end') . '</div> &nbsp; &nbsp;<INPUT type=submit class=\"btn btn-primary\" value='._go.'></div>';",
        "// Line_Reference 674: ",
        "// Line_Reference 686:     ListOutput($events_RET, array('SCHOOL_DATE' => ''._date.'', 'TITLE' => ''._event.'', 'DESCRIPTION' => ''._description.''), event, events);",
        "// Line_Reference 693:         DrawBC(\"\"._schoolSetup.\" > \" . ProgramTitle());",
        "// Line_Reference 695:         DrawBC(\"\"._schoolInfo.\" > \" . ProgramTitle());",
        "// Line_Reference 729:                     $period.=$value['PERIOD_ID'] . ',';",
        "// Line_Reference 741:                         echo '<font color=red><b>'._selectedDayHasAssociation.'</b></font>';",
        "// Line_Reference 742:                 }",
        "// Line_Reference 743:                 else {",
        "// Line_Reference 747:                         echo '<font color=red><b>'._selectedDayHasAssociation.'</b></font>';",
        "// Line_Reference 781:             $link .= '<div class=\"col-md-6\"><h3 class=\"text-center m-0\"><a href=\"Modules.php?modname=' . $_REQUEST['modname'] . '&modfunc=' . $_REQUEST['modfunc'] . '&month=' . date('m',strtotime('first day of -1 month', $time)) . '&year=' . date('Y',strtotime('first day of -1 month', $time)) . '\" class=\"btn btn-icon\"><i class=\"fa fa-chevron-left fa-lg\"></i></a> <span class=\"inline-block p-l-20 p-r-20\">' . date(\"F Y\", $time) . '</span> <a href=\"Modules.php?modname=' . $_REQUEST['modname'] . '&modfunc=' . $_REQUEST['modfunc'] . '&month=' . date('m',strtotime('first day of +1 month', $time)) . '&year=' . date('Y',strtotime('first day of +1 month', $time)) . '\" class=\"btn btn-icon\"><i class=\"fa fa-chevron-right fa-lg\"></i></a></h3></div>';",
        "// Line_Reference 784:                 $link .= \"<div class=\\\"btn-group pull-right\\\"><a href='#' onclick='load_link(\\\"Modules.php?modname=$_REQUEST[modname]&modfunc=create\\\");' class=\\\"btn btn-primary btn-icon btn-lg\\\" data-popup=\\\"tooltip\\\" data-placement=\\\"top\\\" data-original-title=\\\"\"._createANewCalendar.\"\\\"><i class=\\\"fa fa-plus\\\"></i></a>\";",
        "// Line_Reference 785:                 $link .= \"<a href='#' onclick='load_link(\\\"Modules.php?modname=$_REQUEST[modname]&modfunc=delete_calendar&calendar_id=$_REQUEST[calendar_id]\\\");' class=\\\"btn btn-primary btn-lg btn-icon\\\" data-popup=\\\"tooltip\\\" data-placement=\\\"top\\\" data-original-title=\\\"\"._deleteThisCalendar.\"\\\"><i class=\\\"fa fa-times\\\"></i></a><a href='#' onclick='load_link(\\\"Modules.php?modname=$_REQUEST[modname]&modfunc=edit_calendar&calendar_id=$_REQUEST[calendar_id]\\\");' class=\\\"btn btn-primary btn-lg btn-icon\\\" data-popup=\\\"tooltip\\\" data-placement=\\\"top\\\" data-original-title=\\\"\"._editThisCalendar.\"\\\"><i class=\\\"fa fa-pencil\\\"></i></a></div>\";",
        "// Line_Reference 807:                 $link .='</tr></table>';",
        "// Line_Reference 816:         DrawHeaderHome('<div class=\"inline-block\">' . PrepareDate(strtoupper(date(\"d-M-y\", $time)), '', false, array('M' => date(\"m\", $time), 'Y' => date(\"y\", $time), 'submit' =>true, 'view' => 'month')) . '</div>' . ' <A HREF=Modules.php?modname=' . $_REQUEST['modname'] . '&modfunc=list_events&calendar_id=' . $_REQUEST['calendar_id'] . '&month=' . $_REQUEST['month'] . '&year=' . $_REQUEST['year'] . ' class=\"btn btn-default m-l-5\">'._listEvents.'</A>', (User('PROFILE') == 'admin' ? SubmitButton(_save, '', 'class=\"btn btn-primary pull-right\"  onclick=\"self_disable(this);\"') : ''));",
        "// Line_Reference 824:     if (count($error)) {",
        "// Line_Reference 836: //echo 'SELECT ce.ID,DATE_FORMAT(ce.SCHOOL_DATE,\\'%d-%b-%y\\') AS SCHOOL_DATE,ce.TITLE FROM calendar_events ce,calendar_events_visibility cev WHERE ce.SCHOOL_DATE BETWEEN \\'' . date('Y-m-d', $time) . '\\' AND \\'' . date('Y-m-d', mktime(0, 0, 0, $_REQUEST['month'], $last, $_REQUEST['year'])) . '\\' AND SYEAR=\\'' . UserSyear() . '\\' AND ce.calendar_id=\\'' . $_REQUEST['calendar_id'] . '\\'  AND ce.CALENDAR_ID=cev.CALENDAR_ID AND cev.PROFILE_ID=' . User('PROFILE_ID') . ' UNION SELECT ID,DATE_FORMAT(SCHOOL_DATE,\\'%d-%b-%y\\') AS SCHOOL_DATE,TITLE FROM calendar_events WHERE SCHOOL_DATE BETWEEN \\'' . date('Y-m-d', $time) . '\\' AND \\'' . date('Y-m-d', mktime(0, 0, 0, $_REQUEST['month'], $last, $_REQUEST['year'])) . '\\' AND SYEAR=\\'' . UserSyear() . '\\' AND CALENDAR_ID=0';",
        "// Line_Reference 847:         echo \"<th>\"._sunday.\"</th><th>\"._monday.\"</th><th>\"._tuesday.\"</th><th>\"._wednesday.\"</th><th>\"._thursday.\"</th><th>\"._friday.\"</th><th width=99>\"._saturday.\"</th>\";",
        "// Line_Reference 887:                         echo '<TR><TD><div id=syswide_holi_' . $i . ' style=\"display:none; padding-top: 10px;\"><label class=\"checkbox-inline\"><INPUT type=checkbox name=show_all[' . $date . '] value=Y> '._systemWide.'</label></div></TD></TR>';",
        "// Line_Reference 891:                         echo \"<div id=syswide_holi_$i style='display:none; padding-top: 10px;'><label class='checkbox-inline'><INPUT type=checkbox name=show_all[$date] value=Y>\"._systemWide.\"</label></div>\";",
        "// Line_Reference 899:             if (count($events_RET[$date])) {",
        "// Line_Reference 908:                     //echo \"<TR><TD>\" . button('dot', '0000FF', '', '6') . \"</TD><TD> <A class=\\\"event\\\" HREF=# onclick='javascript:window.open(\\\"ForWindow.php?modname=$_REQUEST[modname]&modfunc=detail&event_id=$event[ID]&year=$_REQUEST[year]&month=\" . MonthNWSwitch($_REQUEST['month'], 'tochar') . \"\\\",\\\"blank\\\",\\\"width=600,height=400\\\"); return false;'><b>\" . ($event['TITLE'] ? $e_title : '***') . \"1</b></A></TD></TR>\";",
        "// Line_Reference 909:                     //  echo '<tr><td valign=bottom align=left><i class=fa fa-plus><input type=button data-toggle=\"modal\"  data-event-id=new onclick=\"CalendarModal(\\'new\\','.$_REQUEST[calendar_id].',\\''.$date.'\\',\\''.$_REQUEST[year].'\\',\\''.MonthNWSwitch($_REQUEST[month]).'\\',\\'tochar\\');\"></i></td></tr>';",
        "// Line_Reference 910:                     echo '<TR><TD>' . button(\"dot\", \"0000FF\", \"\", \"6\") . '</TD><TD> <A class=\\\"event\\\" HREF=# onclick=\"CalendarModal(\\'' . $event[ID] . '\\',' . $_REQUEST[calendar_id] . ',\\'' . $date . '\\',\\'' . $_REQUEST[year] . '\\',\\'' . MonthNWSwitch($_REQUEST[month]) . '\\',\\'tochar\\')\"; return false;>' . ($event['TITLE'] ? $e_title : '***') . '</b></A></TD></TR>';",
        "// Line_Reference 912:                 if (count($assignments_RET[$date])) {",
        "// Line_Reference 914:                     // echo \"<TR><TD>\" . button('dot', $event['ASSIGNED'] == 'Y' ? '00FF00' : 'FF0000', '', 6) . \"</TD><TD><A class=\\\"event\\\" HREF=# onclick='javascript:window.open(\\\"ForWindow.php?modname=$_REQUEST[modname]&modfunc=detail&assignment_id=$event[ID]&year=$_REQUEST[year]&month=\" . MonthNWSwitch($_REQUEST['month'], 'tochar') . \"\\\",\\\"blank\\\",\\\"width=600,height=400\\\"); return false;'>\" . $event['TITLE'] . \"</A></TD></TR>\";",
        "// Line_Reference 918:             } elseif (count($assignments_RET[$date])) {",
        "// Line_Reference 921: ",
        "// Line_Reference 922:                     //echo \"<TR><TD>\" . button('dot', $event['ASSIGNED'] == 'Y' ? '00FF00' : 'FF0000', '', 6) . \"</TD><TD><A HREF=#  onclick='javascript:window.open(\\\"ForWindow.php?modname=$_REQUEST[modname]&modfunc=detail&assignment_id=$event[ID]&year=$_REQUEST[year]&month=\" . MonthNWSwitch($_REQUEST['month'], 'tochar') . \"\\\",\\\"blank\\\",\\\"width=600,height=400\\\"); return false;'>\" . $event['TITLE'] . \"3</A></TD></TR>\";",
        "// Line_Reference 931:                     // echo \"<tr><td valign=bottom align=left>\" . button('add', '', \"# onclick='javascript:window.open(\\\"ForWindow.php?modname=$_REQUEST[modname]&modfunc=detail&event_id=new&calendar_id=$_REQUEST[calendar_id]&school_date=$date&year=$_REQUEST[year]&month=\" . MonthNWSwitch($_REQUEST['month'], 'tochar') . \"\\\",\\\"blank\\\",\\\"width=600,height=400\\\"); return false;'\") . \"</td></tr>\";",
        "// Line_Reference 932:                     // echo '<tr><td valign=bottom align=left><i class=fa fa-plus><input type=button data-toggle=\"modal\" data-event_id=new data-target=\"#modal_default_lookup\" name=lookup  onclick=(\\'modal_default_lookup\\'));></i></td></tr>';",
        "// Line_Reference 933:                     //echo '<tr><td valign=bottom align=left><i class=icon-plus3><input type=button data-toggle=\"modal\"  data-event-id=new onclick=\"CalendarModal(\\'new\\','.$_REQUEST[calendar_id].',\\''.$date.'\\',\\''.$_REQUEST[year].'\\',\\''.MonthNWSwitch($_REQUEST[month]).'\\',\\'tochar\\');\"></i></td></tr>';",
        "// Line_Reference 934:                     echo '<tr><td valign=bottom align=left><button type=\"button\" class=\"btn btn-primary btn-icon btn-xs\" data-toggle=\"modal\"  data-event-id=new onclick=\"CalendarModal(\\'new\\',' . $_REQUEST[calendar_id] . ',\\'' . $date . '\\',\\'' . $_REQUEST[year] . '\\',\\'' . MonthNWSwitch($_REQUEST[month]) . '\\',\\'tochar\\');\"><i class=icon-plus3 ></i></button></td></tr>';",
        "// Line_Reference 959: echo '<h5 class=\"modal-title\">'._eventDetails.'</h5>';",
        "// Line_Reference 962: echo'<div id=\"modal-res\"></div>';",
        "// Line_Reference 968: function calendarEventsVisibility() {",
        "// Line_Reference 978:     $return .= '<div class=\"form-group\"><label class=\"col-md-4 control-label text-right\">'._eventsVisibleTo.'</label>';",
        "// Line_Reference 980:     foreach (array('admin' => ''._administratorWCustom.'', 'teacher' => ''._administratorWCustom.'', 'parent' => ''._administratorWCustom.'') as $profile_id => $profile)",
        "// Line_Reference 981:         $return .= \"<div class=\\\"checkbox\\\"><label><INPUT class=\\\"styled\\\" type=checkbox name=profiles[$profile_id] value=Y\" . (in_array($profile_id, $visible_profile) ? ' CHECKED' : '') . \"> $profile</label></div>\";",
        "// Line_Reference 985: \t\tif($profile[TITLE] == \"Super Administrator\")",
        "// Line_Reference 986:                     {",
        "// Line_Reference 987:                     $profile[TITLE] = _superAdministrator;",
        "// Line_Reference 988: ",
        "// Line_Reference 989:                     }elseif($profile[TITLE] == \"Administrator\")",
        "// Line_Reference 990:                     {",
        "// Line_Reference 991:                         $profile[TITLE] = _administrator;",
        "// Line_Reference 992: ",
        "// Line_Reference 993:                     }elseif($profile[TITLE] == \"Teacher\")",
        "// Line_Reference 994:                     {",
        "// Line_Reference 995:                         $profile[TITLE] = _teacher;",
        "// Line_Reference 996: ",
        "// Line_Reference 997:                     }elseif($profile[TITLE] == \"Student\")",
        "// Line_Reference 998:                     {",
        "// Line_Reference 999:                         $profile[TITLE] = _student;",
        "// Line_Reference 1000: ",
        "// Line_Reference 1001:                     }elseif($profile[TITLE] == \"Parent\"){",
        "// Line_Reference 1002:                                 $profile[TITLE] = _parent;",
        "// Line_Reference 1003: ",
        "// Line_Reference 1004:                     }elseif($profile[TITLE] == \"Admin Asst\")",
        "// Line_Reference 1005:                     {",
        "// Line_Reference 1006:                       $profile[TITLE] = _adminAsst;",
        "// Line_Reference 1007: ",
        "// Line_Reference 1008:                     }",
        "// Line_Reference 1009:         $return .= '<div class=\"checkbox\"><label><INPUT class=\"styled\" type=checkbox name=profiles[' . $profile['ID'] . '] value=Y' . (in_array($profile[ID], $visible_profile) ? ' CHECKED' : '') . \"> $profile[TITLE]</label></div>\";",
        "// Line_Reference 1011:     //for (; $i % 4 != 0; $i++)",
        "// Line_Reference 1012:     //$return .= '<TD></TD>';",
        "// Line_Reference 1014: ",
        "// Line_Reference 1019: function _makeCheckBoxInput($value, $eve_stat) {",
        "// Line_Reference 1031: function conv_day($days_arr) {",
        "// Line_Reference 1035:                 $cal_days .='U';",
        "// Line_Reference 1038:                 $cal_days .='M';",
        "// Line_Reference 1041:                 $cal_days .='T';",
        "// Line_Reference 1044:                 $cal_days .='W';",
        "// Line_Reference 1047:                 $cal_days .='H';",
        "// Line_Reference 1050:                 $cal_days .='F';",
        "// Line_Reference 1053:                 $cal_days .='S';",
        "// Line_Reference 1059: ",
        "// Line_Reference 1060: ?>"
    ]
}
