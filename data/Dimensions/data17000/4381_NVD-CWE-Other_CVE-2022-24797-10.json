{
    "cve_id": "CVE-2022-24797",
    "cve_description": "Pomerium is an identity-aware access proxy. In distributed service mode, Pomerium's Authenticate service exposes pprof debug and prometheus metrics handlers to untrusted traffic. This can leak potentially sensitive environmental information or lead to limited denial of service conditions. This issue is patched in version v0.17.1 Workarounds: Block access to `/debug` and `/metrics` paths on the authenticate service. This can be done with any L7 proxy, including Pomerium's own proxy service.",
    "cve_publish_date": "2022-03-31",
    "cwe_id": "NVD-CWE-Other",
    "cwe_name": "Other",
    "cwe_description": "NVD is only using a subset of CWE for mapping instead of the entire CWE, and the weakness type is not covered by that subset.",
    "commit_message": "authenticate: fix debug and metrics endpoints (#3212)",
    "type_of_change": "Modification",
    "filename_of_changes": "routes.go",
    "code_language": "Go",
    "number_of_lines_added_for_mitigation": "20",
    "number_of_lines_deleted_vulnerable_to_cve": "52",
    "vulnerable_lines": [
        "// Line_Reference 60: \t\t// enable ext_authz",
        "// Line_Reference 61: \t\tr, err := b.buildControlPlanePathRoute(\"/.pomerium/jwt\", true)",
        "// Line_Reference 62: \t\tif err != nil {",
        "// Line_Reference 63: \t\t\treturn nil, err",
        "// Line_Reference 64: \t\t}",
        "// Line_Reference 65: \t\troutes = append(routes, r)",
        "// Line_Reference 66: ",
        "// Line_Reference 67: \t\t// disable ext_authz and passthrough to proxy handlers",
        "// Line_Reference 68: \t\tr, err = b.buildControlPlanePathRoute(\"/ping\", false)",
        "// Line_Reference 69: \t\tif err != nil {",
        "// Line_Reference 70: \t\t\treturn nil, err",
        "// Line_Reference 71: \t\t}",
        "// Line_Reference 72: \t\troutes = append(routes, r)",
        "// Line_Reference 73: \t\tr, err = b.buildControlPlanePathRoute(\"/healthz\", false)",
        "// Line_Reference 74: \t\tif err != nil {",
        "// Line_Reference 75: \t\t\treturn nil, err",
        "// Line_Reference 76: \t\t}",
        "// Line_Reference 77: \t\troutes = append(routes, r)",
        "// Line_Reference 78: \t\tr, err = b.buildControlPlanePathRoute(\"/.pomerium\", false)",
        "// Line_Reference 79: \t\tif err != nil {",
        "// Line_Reference 80: \t\t\treturn nil, err",
        "// Line_Reference 81: \t\t}",
        "// Line_Reference 82: \t\troutes = append(routes, r)",
        "// Line_Reference 83: \t\tr, err = b.buildControlPlanePrefixRoute(\"/.pomerium/\", false)",
        "// Line_Reference 84: \t\tif err != nil {",
        "// Line_Reference 85: \t\t\treturn nil, err",
        "// Line_Reference 86: \t\t}",
        "// Line_Reference 87: \t\troutes = append(routes, r)",
        "// Line_Reference 88: \t\tr, err = b.buildControlPlanePathRoute(\"/.well-known/pomerium\", false)",
        "// Line_Reference 89: \t\tif err != nil {",
        "// Line_Reference 90: \t\t\treturn nil, err",
        "// Line_Reference 91: \t\t}",
        "// Line_Reference 92: \t\troutes = append(routes, r)",
        "// Line_Reference 93: \t\tr, err = b.buildControlPlanePrefixRoute(\"/.well-known/pomerium/\", false)",
        "// Line_Reference 94: \t\tif err != nil {",
        "// Line_Reference 95: \t\t\treturn nil, err",
        "// Line_Reference 96: \t\t}",
        "// Line_Reference 97: \t\troutes = append(routes, r)",
        "// Line_Reference 100: \t\t\tr, err := b.buildControlPlanePathRoute(\"/robots.txt\", false)",
        "// Line_Reference 101: \t\t\tif err != nil {",
        "// Line_Reference 102: \t\t\t\treturn nil, err",
        "// Line_Reference 103: \t\t\t}",
        "// Line_Reference 104: \t\t\troutes = append(routes, r)",
        "// Line_Reference 113: \t\tr, err := b.buildControlPlanePrefixRoute(\"/\", false)",
        "// Line_Reference 114: \t\tif err != nil {",
        "// Line_Reference 115: \t\t\treturn nil, err",
        "// Line_Reference 116: \t\t}",
        "// Line_Reference 117: \t\troutes = append(routes, r)",
        "// Line_Reference 199: func (b *Builder) buildControlPlanePathRoute(path string, protected bool) (*envoy_config_route_v3.Route, error) {",
        "// Line_Reference 218: \treturn r, nil",
        "// Line_Reference 221: func (b *Builder) buildControlPlanePrefixRoute(prefix string, protected bool) (*envoy_config_route_v3.Route, error) {",
        "// Line_Reference 240: \treturn r, nil"
    ]
}
