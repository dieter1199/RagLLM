{
    "cve_id": "CVE-2023-0266",
    "cve_description": "A use after free vulnerability exists in the ALSA PCM package in the Linux Kernel. SNDRV_CTL_IOCTL_ELEM_{READ|WRITE}32 is missing locks that can be used in a use-after-free that can result in a priviledge escalation to gain ring0 access from the system user. We recommend upgrading past commit 56b88b50565cd8b946a2d00b0c83927b7ebb055e\n",
    "cve_publish_date": "2023-01-30",
    "cwe_id": "CWE-416",
    "cwe_name": "Use After Free",
    "cwe_description": "The product reuses or references memory after it has been freed. At some point afterward, the memory may be allocated again and saved in another pointer, while the original pointer references a location somewhere within the new allocation. Any operations using the original pointer are no longer valid because the memory \"belongs\" to the code that operates on the new pointer.",
    "commit_message": "ALSA: pcm: Move rwsem lock inside snd_ctl_elem_read to prevent UAF\n\nTakes rwsem lock inside snd_ctl_elem_read instead of snd_ctl_elem_read_user\nlike it was done for write in commit 1fa4445f9adf1 (\"ALSA: control - introduce\nsnd_ctl_notify_one() helper\"). Doing this way we are also fixing the following\nlocking issue happening in the compat path which can be easily triggered and\nturned into an use-after-free.\n\n64-bits:\nsnd_ctl_ioctl\n  snd_ctl_elem_read_user\n    [takes controls_rwsem]\n    snd_ctl_elem_read [lock properly held, all good]\n    [drops controls_rwsem]\n\n32-bits:\nsnd_ctl_ioctl_compat\n  snd_ctl_elem_write_read_compat\n    ctl_elem_write_read\n      snd_ctl_elem_read [missing lock, not good]\n\nCVE-2023-0266 was assigned for this issue.\n\nCc: stable@kernel.org # 5.13+\nSigned-off-by: Clement Lecigne <clecigne@google.com>\nReviewed-by: Jaroslav Kysela <perex@perex.cz>\nLink: https://lore.kernel.org/r/20230113120745.25464-1-tiwai@suse.de\nSigned-off-by: Takashi Iwai <tiwai@suse.de>",
    "type_of_change": "Modification",
    "filename_of_changes": "control.c",
    "code_language": "C",
    "number_of_lines_added_for_mitigation": "15",
    "number_of_lines_deleted_vulnerable_to_cve": "9",
    "vulnerable_lines": [
        "// Line_Reference 1207: \tif (kctl == NULL)",
        "// Line_Reference 1208: \t\treturn -ENOENT;",
        "// Line_Reference 1212: \tif (!(vd->access & SNDRV_CTL_ELEM_ACCESS_READ) || kctl->get == NULL)",
        "// Line_Reference 1213: \t\treturn -EPERM;",
        "// Line_Reference 1223: \t\treturn ret;",
        "// Line_Reference 1233: \t\treturn ret;",
        "// Line_Reference 1241: \t\treturn -EINVAL;",
        "// Line_Reference 1256: \tdown_read(&card->controls_rwsem);",
        "// Line_Reference 1258: \tup_read(&card->controls_rwsem);"
    ]
}
