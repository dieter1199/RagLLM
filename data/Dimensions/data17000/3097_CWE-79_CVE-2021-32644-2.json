{
    "cve_id": "CVE-2021-32644",
    "cve_description": "Ampache is an open source web based audio/video streaming application and file manager. Due to a lack of input filtering versions 4.x.y are vulnerable to code injection in random.php. The attack requires user authentication to access the random.php page unless the site is running in demo mode. This issue has been resolved in 4.4.3.",
    "cve_publish_date": "2021-06-22",
    "cwe_id": "CWE-79",
    "cwe_name": "Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting')",
    "cwe_description": "The product does not neutralize or incorrectly neutralizes user-controllable input before it is placed in output that is used as a web page that is served to other users.",
    "commit_message": "filter random/search types, code indent",
    "type_of_change": "Modification",
    "filename_of_changes": "search.class.php",
    "code_language": "PHP",
    "number_of_lines_added_for_mitigation": "14",
    "number_of_lines_deleted_vulnerable_to_cve": "14",
    "vulnerable_lines": [
        "// Line_Reference 2042:                 // combine these as they all do the same thing just different tables",
        "// Line_Reference 2043:                 $looking      = str_replace('myplayed', '', $rule[0]);",
        "// Line_Reference 2044:                 $column       = ($looking == '') ? 'id' : $looking;",
        "// Line_Reference 2045:                 $my_type      = ($looking == '') ? 'song' : $looking;",
        "// Line_Reference 2046:                 $operator_sql = ((int) $sql_match_operator == 0) ? 'IS NULL' : 'IS NOT NULL';",
        "// Line_Reference 2047:                 // played once per user",
        "// Line_Reference 2048:                 $table['myplayed'] .= (!strpos((string) $table['myplayed'], \"myplayed_\" . $my_type . \"_\" . $userid)) ?",
        "// Line_Reference 2049:                     \"LEFT JOIN (SELECT `object_id`, `object_type`, `user` FROM `object_count` \" .",
        "// Line_Reference 2050:                     \"WHERE `object_count`.`object_type` = '$my_type' AND `object_count`.`count_type` = 'stream' \" .",
        "// Line_Reference 2051:                     \"AND `object_count`.`user`=$userid GROUP BY `object_id`, `object_type`, `user`) AS \" .",
        "// Line_Reference 2052:                     \"`myplayed_\" . $my_type . \"_\" . $userid . \"` \" .",
        "// Line_Reference 2053:                     \"ON `song`.`$column`=`myplayed_\" . $my_type . \"_\" . $userid . \"`.`object_id` \" .",
        "// Line_Reference 2054:                     \"AND `myplayed_\" . $my_type . \"_\" . $userid . \"`.`object_type` = '$my_type' \" : ' ';",
        "// Line_Reference 2055:                 $where[] = \"`myplayed_\" . $my_type . \"_\" . $userid . \"`.`object_id` $operator_sql\";"
    ]
}
