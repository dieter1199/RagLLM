{
    "cve_id": "CVE-2022-3873",
    "cve_description": "Cross-site Scripting (XSS) - DOM in GitHub repository jgraph/drawio prior to 20.5.2.",
    "cve_publish_date": "2022-11-07",
    "cwe_id": "CWE-79",
    "cwe_name": "Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting')",
    "cwe_description": "The product does not neutralize or incorrectly neutralizes user-controllable input before it is placed in output that is used as a web page that is served to other users.",
    "commit_message": "20.5.2 release",
    "type_of_change": "Modification",
    "filename_of_changes": "ElectronApp.js",
    "code_language": "JavaScript",
    "number_of_lines_added_for_mitigation": "22",
    "number_of_lines_deleted_vulnerable_to_cve": "75",
    "vulnerable_lines": [
        "// Line_Reference 63: \t\t\txml = file.getData();",
        "// Line_Reference 2073: \tEditorUi.prototype.createDownloadRequest = function(filename, format, ignoreSelection, base64, transparent,",
        "// Line_Reference 2074: \t\tcurrentPage, scale, border, grid, includeXml)",
        "// Line_Reference 2076: \t\tvar graph = this.editor.graph;",
        "// Line_Reference 2077: \t\tvar bounds = graph.getGraphBounds();",
        "// Line_Reference 2078: ",
        "// Line_Reference 2079: \t\t// Exports only current page for images that does not contain file data, but for",
        "// Line_Reference 2080: \t\t// the other formats with XML included or pdf with all pages, we need to send the complete data and use",
        "// Line_Reference 2081: \t\t// the from/to URL parameters to specify the page to be exported.",
        "// Line_Reference 2082: \t\tvar data = this.getFileData(true, null, null, null, ignoreSelection, currentPage == false? false : format != 'xmlpng');",
        "// Line_Reference 2083: \t\tvar range = null;",
        "// Line_Reference 2084: \t\tvar allPages = null;",
        "// Line_Reference 2085: ",
        "// Line_Reference 2086: \t\tvar embed = (includeXml) ? '1' : '0';",
        "// Line_Reference 2087: ",
        "// Line_Reference 2088: \t\tif (format == 'pdf' && currentPage == false)",
        "// Line_Reference 2089: \t\t{",
        "// Line_Reference 2090: \t\t\tallPages = '1';",
        "// Line_Reference 2091: \t\t}",
        "// Line_Reference 2092: ",
        "// Line_Reference 2093: \t\tif (format == 'xmlpng')",
        "// Line_Reference 2094: \t\t{",
        "// Line_Reference 2095: \t\t\tembed = '1';",
        "// Line_Reference 2096: \t\t\tformat = 'png';",
        "// Line_Reference 2097: ",
        "// Line_Reference 2098: \t\t\t// Finds the current page number",
        "// Line_Reference 2099: \t\t\tif (this.pages != null && this.currentPage != null)",
        "// Line_Reference 2100: \t\t\t{",
        "// Line_Reference 2101: \t\t\t\tfor (var i = 0; i < this.pages.length; i++)",
        "// Line_Reference 2102: \t\t\t\t{",
        "// Line_Reference 2103: \t\t\t\t\tif (this.pages[i] == this.currentPage)",
        "// Line_Reference 2104: \t\t\t\t\t{",
        "// Line_Reference 2105: \t\t\t\t\t\trange = i;",
        "// Line_Reference 2106: \t\t\t\t\t\tbreak;",
        "// Line_Reference 2107: \t\t\t\t\t}",
        "// Line_Reference 2108: \t\t\t\t}",
        "// Line_Reference 2109: \t\t\t}",
        "// Line_Reference 2110: \t\t}",
        "// Line_Reference 2111: ",
        "// Line_Reference 2112: \t\tvar bg = graph.background;",
        "// Line_Reference 2113: ",
        "// Line_Reference 2114: \t\tif (format == 'png' && transparent)",
        "// Line_Reference 2115: \t\t{",
        "// Line_Reference 2116: \t\t\tbg = mxConstants.NONE;",
        "// Line_Reference 2117: \t\t}",
        "// Line_Reference 2118: \t\telse if (!transparent && (bg == null || bg == mxConstants.NONE))",
        "// Line_Reference 2119: \t\t{",
        "// Line_Reference 2120: \t\t\tbg = '#ffffff';",
        "// Line_Reference 2121: \t\t}",
        "// Line_Reference 2122: ",
        "// Line_Reference 2123: \t\tvar extras = {globalVars: graph.getExportVariables()};",
        "// Line_Reference 2124: ",
        "// Line_Reference 2125: \t\tif (grid)",
        "// Line_Reference 2126: \t\t{",
        "// Line_Reference 2127: \t\t\textras.grid = {",
        "// Line_Reference 2128: \t\t\t\tsize: graph.gridSize,",
        "// Line_Reference 2129: \t\t\t\tsteps: graph.view.gridSteps,",
        "// Line_Reference 2130: \t\t\t\tcolor: graph.view.gridColor",
        "// Line_Reference 2131: \t\t\t};",
        "// Line_Reference 2132: \t\t}",
        "// Line_Reference 2133: ",
        "// Line_Reference 2134: \t\treturn new mxElectronRequest('export', {",
        "// Line_Reference 2135: \t\t\tformat: format,",
        "// Line_Reference 2136: \t\t\txml: data,",
        "// Line_Reference 2137: \t\t\tfrom: range,",
        "// Line_Reference 2138: \t\t\tbg: (bg != null) ? bg : mxConstants.NONE,",
        "// Line_Reference 2139: \t\t\tfilename: (filename != null) ? filename : null,",
        "// Line_Reference 2140: \t\t\tallPages: allPages,",
        "// Line_Reference 2141: \t\t\tbase64: base64,",
        "// Line_Reference 2142: \t\t\tembedXml: embed,",
        "// Line_Reference 2143: \t\t\textras: encodeURIComponent(JSON.stringify(extras)),",
        "// Line_Reference 2144: \t\t\tscale: scale,",
        "// Line_Reference 2145: \t\t\tborder: border",
        "// Line_Reference 2146: \t\t});",
        "// Line_Reference 2148: "
    ]
}
