{
    "cve_id": "CVE-2022-45962",
    "cve_description": "Open Solutions for Education, Inc openSIS Community Edition v8.0 and earlier is vulnerable to SQL Injection via CalendarModal.php.",
    "cve_publish_date": "2023-02-13",
    "cwe_id": "CWE-89",
    "cwe_name": "Improper Neutralization of Special Elements used in an SQL Command ('SQL Injection')",
    "cwe_description": "The product constructs all or part of an SQL command using externally-influenced input from an upstream component, but it does not neutralize or incorrectly neutralizes special elements that could modify the intended SQL command when it is sent to a downstream component. Without sufficient removal or quoting of SQL syntax in user-controllable inputs, the generated SQL query can cause those inputs to be interpreted as SQL instead of ordinary user data.",
    "commit_message": "Version 9.0 release\n\nOlder version shifted to branch: Version_8.0",
    "type_of_change": "ModificationType.ADD",
    "filename_of_changes": "Schedule.php",
    "code_language": "PHP",
    "number_of_lines_added_for_mitigation": "31",
    "number_of_lines_deleted_vulnerable_to_cve": "16",
    "vulnerable_lines": [
        "// Line_Reference 34: //echo \"<pre>\"; print_r($_REQUEST); echo \"</pre>\";",
        "// Line_Reference 35: if (isset($_SESSION['student_id']) && ($_SESSION['student_id'] == UserStudentID())) {",
        "// Line_Reference 101:     echo \"<script type=text/javascript>window.location.href='Modules.php?modname=scheduling/Schedule.php&student_id=\" . UserStudentID() . \"';</script>\";",
        "// Line_Reference 131: $end_d = implode('-', $end_d);",
        "// Line_Reference 296:             echo \"<script>window.location.href='Modules.php?modname=scheduling/Schedule.php'</script>\";",
        "// Line_Reference 302:     if (isset($_REQUEST['student_id'])) {",
        "// Line_Reference 303:         $RET = DBGet(DBQuery('SELECT FIRST_NAME,LAST_NAME,MIDDLE_NAME,NAME_SUFFIX,SCHOOL_ID FROM students,student_enrollment WHERE students.STUDENT_ID=\\'' . $_REQUEST['student_id'] . '\\' AND student_enrollment.STUDENT_ID = students.STUDENT_ID '));",
        "// Line_Reference 595:                         $sql .= MODIFIED_DATE . \"='\" . DBDate() . \"',\";",
        "// Line_Reference 596:                         $sql .= MODIFIED_BY . \"='\" . User('STAFF_ID') . \"',\";",
        "// Line_Reference 846:         $mp = CreateSelect($mp_RET, 'marking_period_id', 'Modules.php?modname=' . $_REQUEST['modname'] . '&marking_period_id=', $_REQUEST['marking_period_id']);",
        "// Line_Reference 1148:     $rem = \"<center><a href=Modules.php?modname=scheduling/Schedule.php&student_id=$i&del=true&c_id=$value&cp_id=$THIS_RET[COURSE_PERIOD_ID]&schedule_id=$THIS_RET[SCHEDULE_ID] class=\\\"btn btn-danger btn-xs btn-icon\\\"><i class=\\\"fa fa-times\\\"></i></a></center>\";",
        "// Line_Reference 1169:     $sql = 'SELECT sp.TITLE AS PERIOD,cp.COURSE_PERIOD_ID,cp.PARENT_ID,cp.TITLE,cp.MARKING_PERIOD_ID,COALESCE(cp.TOTAL_SEATS-cp.FILLED_SEATS,0) AS AVAILABLE_SEATS FROM course_periods cp,course_period_var cpv,school_periods sp WHERE sp.PERIOD_ID=cpv.PERIOD_ID AND cp.COURSE_PERIOD_ID=cpv.COURSE_PERIOD_ID AND cp.COURSE_ID=\\'' . $THIS_RET[COURSE_ID] . '\\' ORDER BY sp.SORT_ORDER';",
        "// Line_Reference 1322:     if ($column == 'END_DATE' && $THIS_RET[END_DATE] != '') {",
        "// Line_Reference 1324:         return '<div style=\"white-space: nowrap;\">' . DateInputAY($value != \"\" ? $value : \"\", \"schedule[$THIS_RET[COURSE_PERIOD_ID]][$THIS_RET[START_DATE]][$column]\", $counter . $THIS_RET[COURSE_PERIOD_ID], '', true, $allow_na) . '</div>';",
        "// Line_Reference 1328:         return '<div style=\"white-space: nowrap;\">' . DateInputAY($value != \"\" ? $value : \"\", \"schedule[$THIS_RET[COURSE_PERIOD_ID]][$THIS_RET[START_DATE]][$column]\", $counter . $THIS_RET[COURSE_PERIOD_ID], '', true, $allow_na) . '</div>';",
        "// Line_Reference 1406:     $hidd = \"<input type='hidden' name='schedule[$THIS_RET[COURSE_PERIOD_ID]][$THIS_RET[START_DATE]][SCHEDULE_ID]' value='\" . $THIS_RET[SCHEDULE_ID] . \"'>\";"
    ]
}
