{
    "cve_id": "CVE-2018-12633",
    "cve_description": "An issue was discovered in the Linux kernel through 4.17.2. vbg_misc_device_ioctl() in drivers/virt/vboxguest/vboxguest_linux.c reads the same user data twice with copy_from_user. The header part of the user data is double-fetched, and a malicious user thread can tamper with the critical variables (hdr.size_in and hdr.size_out) in the header between the two fetches because of a race condition, leading to severe kernel errors, such as buffer over-accesses. This bug can cause a local denial of service and information leakage.",
    "cve_publish_date": "2018-06-22",
    "cwe_id": "CWE-362",
    "cwe_name": "Concurrent Execution using Shared Resource with Improper Synchronization ('Race Condition')",
    "cwe_description": "The product contains a code sequence that can run concurrently with other code, and the code sequence requires temporary, exclusive access to a shared resource, but a timing window exists in which the shared resource can be modified by another code sequence that is operating concurrently.",
    "commit_message": "virt: vbox: Only copy_from_user the request-header once\n\nIn vbg_misc_device_ioctl(), the header of the ioctl argument is copied from\nthe userspace pointer 'arg' and saved to the kernel object 'hdr'. Then the\n'version', 'size_in', and 'size_out' fields of 'hdr' are verified.\n\nBefore this commit, after the checks a buffer for the entire request would\nbe allocated and then all data including the verified header would be\ncopied from the userspace 'arg' pointer again.\n\nGiven that the 'arg' pointer resides in userspace, a malicious userspace\nprocess can race to change the data pointed to by 'arg' between the two\ncopies. By doing so, the user can bypass the verifications on the ioctl\nargument.\n\nThis commit fixes this by using the already checked copy of the header\nto fill the header part of the allocated buffer and only copying the\nremainder of the data from userspace.\n\nSigned-off-by: Wenwen Wang <wang6495@umn.edu>\nReviewed-by: Hans de Goede <hdegoede@redhat.com>\nSigned-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>",
    "type_of_change": "Modification",
    "filename_of_changes": "vboxguest_linux.c",
    "code_language": "C",
    "number_of_lines_added_for_mitigation": "3",
    "number_of_lines_deleted_vulnerable_to_cve": "1",
    "vulnerable_lines": [
        "// Line_Reference 124: \tif (copy_from_user(buf, (void *)arg, hdr.size_in)) {"
    ]
}
