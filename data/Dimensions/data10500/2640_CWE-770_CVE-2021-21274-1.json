{
    "cve_id": "CVE-2021-21274",
    "cve_description": "Synapse is a Matrix reference homeserver written in python (pypi package matrix-synapse). Matrix is an ecosystem for open federated Instant Messaging and VoIP. In Synapse before version 1.25.0, a malicious homeserver could redirect requests to their .well-known file to a large file. This can lead to a denial of service attack where homeservers will consume significantly more resources when requesting the .well-known file of a malicious homeserver. This affects any server which accepts federation requests from untrusted servers. Issue is resolved in version 1.25.0. As a workaround the `federation_domain_whitelist` setting can be used to restrict the homeservers communicated with over federation.",
    "cve_publish_date": "2021-02-26",
    "cwe_id": "CWE-770",
    "cwe_name": "Allocation of Resources Without Limits or Throttling",
    "cwe_description": "The product allocates a reusable resource or group of resources on behalf of an actor without imposing any restrictions on the size or number of resources that can be allocated, in violation of the intended security policy for that actor.",
    "commit_message": "Add a maximum size for well-known lookups. (#8950)",
    "type_of_change": "Modification",
    "filename_of_changes": "client.py",
    "code_language": "Python",
    "number_of_lines_added_for_mitigation": "18",
    "number_of_lines_deleted_vulnerable_to_cve": "14",
    "vulnerable_lines": [
        "// Line_Reference 723:                 readBodyToFile(response, output_stream, max_size)",
        "// Line_Reference 725:         except SynapseError:",
        "// Line_Reference 726:             # This can happen e.g. because the body is too large.",
        "// Line_Reference 727:             raise",
        "// Line_Reference 751: class _ReadBodyToFileProtocol(protocol.Protocol):",
        "// Line_Reference 764:             self.deferred.errback(",
        "// Line_Reference 765:                 SynapseError(",
        "// Line_Reference 766:                     502,",
        "// Line_Reference 767:                     \"Requested file is too large > %r bytes\" % (self.max_size,),",
        "// Line_Reference 768:                     Codes.TOO_LARGE,",
        "// Line_Reference 769:                 )",
        "// Line_Reference 770:             )",
        "// Line_Reference 785: def readBodyToFile(",
        "// Line_Reference 801:     response.deliverBody(_ReadBodyToFileProtocol(stream, d, max_size))"
    ]
}
