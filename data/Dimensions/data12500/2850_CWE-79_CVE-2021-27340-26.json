{
    "cve_id": "CVE-2021-27340",
    "cve_description": "OpenSIS Community Edition version <= 7.6 is affected by a reflected XSS vulnerability in EmailCheck.php via the \"opt\" parameter.",
    "cve_publish_date": "2021-09-16",
    "cwe_id": "CWE-79",
    "cwe_name": "Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting')",
    "cwe_description": "The product does not neutralize or incorrectly neutralizes user-controllable input before it is placed in output that is used as a web page that is served to other users.",
    "commit_message": "Commit with security and bug fixes",
    "type_of_change": "ModificationType.ADD",
    "filename_of_changes": "Reports.php",
    "code_language": "PHP",
    "number_of_lines_added_for_mitigation": "99",
    "number_of_lines_deleted_vulnerable_to_cve": "76",
    "vulnerable_lines": [
        "// Line_Reference 4: #  openSIS is a free student information system for public and non-public",
        "// Line_Reference 7: #  openSIS is  web-based, open source, and comes packed with features that",
        "// Line_Reference 8: #  include student demographic info, scheduling, grade book, attendance,",
        "// Line_Reference 9: #  report cards, eligibility, transcripts, parent portal,",
        "// Line_Reference 10: #  student portal and more.",
        "// Line_Reference 13: #  If you have question regarding this system or the license, please send",
        "// Line_Reference 16: #  This program is released under the terms of the GNU General Public License as",
        "// Line_Reference 17: #  published by the Free Software Foundation, version 2 of the License.",
        "// Line_Reference 29: include('../../RedirectModulesInc.php');",
        "// Line_Reference 47:         if ($gt_dt['PROFILEID'] == 'Staff')",
        "// Line_Reference 49:         else",
        "// Line_Reference 54:     if ($num_parent[1]['TOTAL_PARENTS'] == '')",
        "// Line_Reference 56:     else",
        "// Line_Reference 60:     echo '<ul class=\"nav nav-tabs nav-tabs-bottom no-margin-bottom\"><li class=\"active\" id=\"tab[]\"><a href=\"javascript:void(0);\">'._atAGlance.'</a></li></ul>';",
        "// Line_Reference 67:     echo '<h6 class=\"text-semibold no-margin\">'._institutions.'<span class=\"display-block no-margin text-success\">'.$num_schools.'</span></h6>';",
        "// Line_Reference 75:     echo '<h6 class=\"text-semibold no-margin\">'._students.'<span class=\"display-block no-margin text-success\">'.$num_students.' <small class=\"no-margin\">('._male.' : '.$male.'  &nbsp; | &nbsp;  '._female.' : '.$female.')</small></span></h6>';",
        "// Line_Reference 83:     echo '<h6 class=\"text-semibold no-margin\">'._teachers.'<span class=\"display-block no-margin text-success\">'.$num_teacher.'</span></h6>';",
        "// Line_Reference 93:     echo '<h6 class=\"text-semibold no-margin\">'._staff.'<span class=\"display-block no-margin text-success\">'.$num_staff.'</span></h6>';",
        "// Line_Reference 101:     echo '<h6 class=\"text-semibold no-margin\">'._parents.'<span class=\"display-block no-margin text-success\">'.$num_parent.'</span></h6>';",
        "// Line_Reference 116:     echo '</div>';//.tabbable",
        "// Line_Reference 117:     echo '</div>';//.panel",
        "// Line_Reference 123:         echo \"<tr><td width=105>\" . DrawLogo() . \"</td><td style=\\\"font-size:15px; font-weight:bold; padding-top:20px;\\\">\"._instituteReports.\"</td><td align=right style=\\\"padding-top:20px;\\\">\" . ProperDate(DBDate()) . \"<br />\"._poweredByOpenSis.\"</td></tr><tr><td colspan=3 style=\\\"border-top:1px solid #333;\\\">&nbsp;</td></tr></table>\";",
        "// Line_Reference 126: ",
        "// Line_Reference 139:                 if ($m == 'E_MAIL')",
        "// Line_Reference 141:                 elseif ($m == 'TITLE')",
        "// Line_Reference 143:                 elseif ($m == 'REPORTING_GP_SCALE')",
        "// Line_Reference 145:                 elseif ($m == 'MAIL_ADDRESS')",
        "// Line_Reference 147:                 elseif ($m == 'MAIL_CITY')",
        "// Line_Reference 149:                 elseif ($m == 'MAIL_STATE')",
        "// Line_Reference 151:                 elseif ($m == 'MAIL_ZIP')",
        "// Line_Reference 153:                 elseif ($m == 'WWW_ADDRESS')",
        "// Line_Reference 155:                 else {",
        "// Line_Reference 157:                     if ($col[0] == 'CUSTOM' && $col[1] != '')",
        "// Line_Reference 174:                     if ($get_field_name[1]['TITLE'] != '')",
        "// Line_Reference 176:                     else",
        "// Line_Reference 182: ",
        "// Line_Reference 190: ",
        "// Line_Reference 193:                         $check_validity = DBGet(DBQuery('SELECT COUNT(*) as REC_EX FROM school_custom_fields WHERE ID=' . $column_check[1] . ' AND (SCHOOL_ID=' . $get_school_info[$key]['ID'].' OR SCHOOL_ID=0)'));",
        "// Line_Reference 194:                         if ($check_validity[1]['REC_EX'] == 0)",
        "// Line_Reference 223:         $fields_list['Available School Fields'] = array('TITLE' => _schoolName,",
        "// Line_Reference 224:          'ADDRESS' => _address,",
        "// Line_Reference 225:          'CITY' => _city,",
        "// Line_Reference 226:          'STATE' => _state,",
        "// Line_Reference 227:          'ZIPCODE' => _zipcode,",
        "// Line_Reference 228:          'PHONE' => _telephone,",
        "// Line_Reference 229:          'PRINCIPAL' => _principal,",
        "// Line_Reference 230:          'REPORTING_GP_SCALE' => _baseGradingScale,",
        "// Line_Reference 231:          'E_MAIL' => _email,",
        "// Line_Reference 232:          'WWW_ADDRESS' => _website,",
        "// Line_Reference 239:         }",
        "// Line_Reference 240: \techo '<div class=\"row\">';",
        "// Line_Reference 242:         PopTable('header','<i class=\\\"glyphicon glyphicon-tasks\\\"></i> &nbsp;'._selectFieldsToGenerateReport.'');",
        "// Line_Reference 250:                 if($i==0 && $j==0){",
        "// Line_Reference 252:                 }elseif($i==0 && $j>0){",
        "// Line_Reference 256: ",
        "// Line_Reference 258:                     echo '</TR><TR>';*/",
        "// Line_Reference 260:                 if($i==2){",
        "// Line_Reference 267:                 echo '<TD></TD></TR><TR>';",
        "// Line_Reference 268:                 $i++;",
        "// Line_Reference 269:             }*/",
        "// Line_Reference 273:         PopTable(\"header\",\"<i class=\\\"glyphicon glyphicon-saved\\\"></i> &nbsp;\"._selectedFields);",
        "// Line_Reference 274:         echo '<div id=\"names_div_none\" class=\"error_msg\" style=\"padding:6px 0px 0px 6px;\">'._noFieldsSelected.'</div><ol id=names_div class=\"selected_report_list\"></ol>';",
        "// Line_Reference 275: ",
        "// Line_Reference 276:         $btn = '<INPUT type=submit value=\\''._createReportForInstitutes.'\\' class=\"btn btn-primary\">';",
        "// Line_Reference 284:     $get_schools_cf = DBGet(DBQuery('SELECT s.TITLE AS SCHOOL,s.ID,sc.* FROM schools s,school_custom_fields sc WHERE s.ID=sc.SCHOOL_ID ORDER BY sc.SCHOOL_ID'));",
        "// Line_Reference 299:                     if (ord($char) == '13')",
        "// Line_Reference 309:             if ($cfd_i == 'SYSTEM_FIELD' || $cfd_i == 'REQUIRED') {",
        "// Line_Reference 310:                 if ($cfd_d == 'N')",
        "// Line_Reference 312:                 if ($cfd_d == 'Y')",
        "// Line_Reference 324:     $column = array('SCHOOL' => _school,",
        "// Line_Reference 325:      'TYPE' => _customFieldType,",
        "// Line_Reference 326:      'TITLE' => _customFieldName,",
        "// Line_Reference 327:      'SELECT_OPTIONS' => _options,",
        "// Line_Reference 328:      'SYSTEM_FIELD' => _systemField,",
        "// Line_Reference 329:      'REQUIRED' => _requiredField,",
        "// Line_Reference 336: ?>"
    ]
}
