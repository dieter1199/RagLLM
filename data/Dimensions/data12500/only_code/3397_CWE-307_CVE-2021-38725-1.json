// check if they are no longer in the locked out state and reset variables
if (isset($user_data['failed_login_timer']) AND (time() - $user_data['failed_login_timer']) > (int)$this->fuel->config('seconds_to_unlock'))
{
$user_data['failed_login_attempts'] = 0;
$this->session->unset_userdata('failed_login_timer');
unset($user_data['failed_login_timer']);
}
else
{
// add to the number of attempts if it's an invalid login'
$num_attempts = (!isset($user_data['failed_login_attempts'])) ? 0 : $user_data['failed_login_attempts'] + 1;
$user_data['failed_login_attempts'] = $num_attempts;
}
// check if they should be locked out
if (isset($user_data['failed_login_attempts']) AND $user_data['failed_login_attempts'] >= (int)$this->fuel->config('num_logins_before_lock') -1)
{
$this->fuel_users_model->add_error(lang('error_max_attempts', $this->fuel->config('seconds_to_unlock')));
$user_data['failed_login_timer'] = time();
$this->fuel->logs->write(lang('auth_log_account_lockout', $this->input->post('user_name', TRUE), $this->input->ip_address()), 'debug');
}
else
{
$this->fuel_users_model->add_error(lang('error_invalid_login'));
$this->fuel->logs->write(lang('auth_log_failed_login', $this->input->post('user_name', TRUE), $this->input->ip_address(), ($user_data['failed_login_attempts'] + 1)), 'debug');
}
if ($this->input->post('email'))
$this->fuel_users_model->add_error(lang('error_invalid_email'));