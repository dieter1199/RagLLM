use SilverStripe\Omnipay\Model\Message;
$this->createMessage(Message\PurchaseRequest::class, $request);
$this->createMessage(Message\PurchaseError::class, $e);
$serviceResponse->isRedirect() ? Message\PurchaseRedirectResponse::class : Message\AwaitingPurchaseResponse::class,
$this->createMessage(Message\PurchaseError::class, $response);
} else {
$this->createMessage(Message\CompletePurchaseRequest::class, $request);
$this->createMessage(Message\CompletePurchaseError::class, $e);
if ($serviceResponse->isError()) {
$this->createMessage(Message\CompletePurchaseError::class, $response);
return $serviceResponse;
}
// only update payment status if we're not waiting for a notification
if (!$serviceResponse->isAwaitingNotification()) {
$this->markCompleted('Captured', $serviceResponse, $response);
} else {
$this->createMessage(Message\PurchasedResponse::class, $gatewayMessage);
