int flags = O_RDONLY;
if (rv != -1) {
if (fstat(rv, &st) != 0) {
save_errno = errno;
close(rv);
rv = -1;
errno = save_errno;
goto error;
}
if (!S_ISDIR(st.st_mode)) {
close(rv);
errno = ENOTDIR;
rv = -1;
goto error;
}
}
