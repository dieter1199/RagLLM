import { LdSignatureService } from '@/core/activitypub/LdSignatureService.js';
private ldSignatureService: LdSignatureService,
const activity = job.data.activity;
if (activity.signature) {
if (activity.signature.type !== 'RsaSignature2017') {
throw new Bull.UnrecoverableError(`skip: unsupported LD-signature type ${activity.signature.type}`);
// activity.signature.creator: https://example.oom/users/user#main-key
if (activity.signature.creator) {
const candicate = activity.signature.creator.replace(/#.*/, '');
authUser = await this.apDbResolverService.getAuthUserFromKeyId(activity.signature.creator);
const ldSignature = this.ldSignatureService.use();
const verified = await ldSignature.verifyRsaSignature2017(activity, authUser.key.keyPem).catch(() => false);