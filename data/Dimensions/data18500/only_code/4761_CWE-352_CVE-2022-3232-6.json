from wtforms import validators
confirm = StringField(_('Confirmation'), validators=[validators.data_required()])
redirect = StringField(default='/')
if not form.validate():
raise cherrypy.HTTPError(400, form.error_message)
# Validate the name
if form.confirm.data != path_obj.display_name:
_logger.info("do not delete repo, bad confirmation %r != %r", form.confirm.data, path_obj.display_name)
raise cherrypy.HTTPError(400, 'bad confirmation')
# Delete repository in background using a schedule task.
scheduled = cherrypy.engine.publish('schedule_task', repo.delete, path)
assert scheduled
raise cherrypy.HTTPRedirect(form.redirect.data)
