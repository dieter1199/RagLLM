### Prevent Brute-Force Login Attacks ###
throttle('login/ip', limit: 5, period: 20.seconds) do |req|
req.ip if req.path == '/auth/sign_in' && req.post?
end
## Prevent Brute-Force Signup Attacks ###
throttle('accounts/ip', limit: 5, period: 5.minutes) do |req|
req.ip if req.path == '/api/v1/accounts' && req.post?
end
## Prevent Conversation Bombing on Widget APIs ###
throttle('api/v1/widget/conversations', limit: 6, period: 12.hours) do |req|
req.ip if req.path == '/api/v1/widget/conversations' && req.post?
## Prevent Contact update Bombing in Widget API ###
throttle('api/v1/widget/contacts', limit: 60, period: 1.hour) do |req|
req.ip if req.path == '/api/v1/widget/contacts' && (req.patch? || req.put?)
end
# ref: https://github.com/rack/rack-attack/issues/399
throttle('login/email', limit: 20, period: 5.minutes) do |req|
if req.path == '/auth/sign_in' && req.post?
throttle('super_admin_login/email', limit: 20, period: 5.minutes) do |req|
if req.path == '/super_admin/sign_in' && req.post?
if req.path == '/auth/password' && req.post?
