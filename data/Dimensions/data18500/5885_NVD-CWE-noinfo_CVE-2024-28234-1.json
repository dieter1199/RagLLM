{
    "cve_id": "CVE-2024-28234",
    "cve_description": "Contao is an open source content management system. Starting in version 2.0.0 and prior to versions 4.13.40 and 5.3.4, it is possible to inject CSS styles via BBCode in comments. Installations are only affected if BBCode is enabled. Contao versions 4.13.40 and 5.3.4 have a patch for this issue. As a workaround, disable BBCode for comments.",
    "cve_publish_date": "2024-04-09",
    "cwe_id": "NVD-CWE-noinfo",
    "cwe_name": "Insufficient Information",
    "cwe_description": "There is insufficient information about the issue to classify it; details are unkown or unspecified.",
    "commit_message": "Merge pull request from GHSA-j55w-hjpj-825g\n\n* harden BBCode parsing\n\n* Apply suggestions from code review\n\nCo-authored-by: Martin Auswöger <martin@auswoeger.com>\n\n* CS\n\n* Update comments-bundle/tests/Util/BbCodeTest.php\n\nCo-authored-by: Martin Auswöger <martin@auswoeger.com>\n\n* Update comments-bundle/src/Util/BbCode.php\n\nCo-authored-by: Martin Auswöger <martin@auswoeger.com>\n\n* Update comments-bundle/tests/Util/BbCodeTest.php\n\nCo-authored-by: Martin Auswöger <martin@auswoeger.com>\n\n* Update comments-bundle/tests/Util/BbCodeTest.php\n\n* CS\n\n---------\n\nCo-authored-by: Martin Auswöger <martin@auswoeger.com>\nCo-authored-by: Leo Feyer <1192057+leofeyer@users.noreply.github.com>",
    "type_of_change": "ModificationType.ADD",
    "filename_of_changes": "Comments.php",
    "code_language": "PHP",
    "number_of_lines_added_for_mitigation": "2",
    "number_of_lines_deleted_vulnerable_to_cve": "58",
    "vulnerable_lines": [
        "// Line_Reference 420: \t * Supports the following tags:",
        "// Line_Reference 421: \t *",
        "// Line_Reference 422: \t * * [b][/b] bold",
        "// Line_Reference 423: \t * * [i][/i] italic",
        "// Line_Reference 424: \t * * [u][/u] underline",
        "// Line_Reference 425: \t * * [img][/img]",
        "// Line_Reference 426: \t * * [code][/code]",
        "// Line_Reference 427: \t * * [color=#ff0000][/color]",
        "// Line_Reference 428: \t * * [quote][/quote]",
        "// Line_Reference 429: \t * * [quote=tim][/quote]",
        "// Line_Reference 430: \t * * [url][/url]",
        "// Line_Reference 431: \t * * [url=http://][/url]",
        "// Line_Reference 432: \t * * [email][/email]",
        "// Line_Reference 433: \t * * [email=name@example.com][/email]",
        "// Line_Reference 434: \t *",
        "// Line_Reference 441: \t\t$arrSearch = array",
        "// Line_Reference 442: \t\t(",
        "// Line_Reference 443: \t\t\t'@\\[b\\](.*)\\[/b\\]@Uis',",
        "// Line_Reference 444: \t\t\t'@\\[i\\](.*)\\[/i\\]@Uis',",
        "// Line_Reference 445: \t\t\t'@\\[u\\](.*)\\[/u\\]@Uis',",
        "// Line_Reference 446: \t\t\t'@\\s*\\[code\\](.*)\\[/code\\]\\s*@Uis',",
        "// Line_Reference 447: \t\t\t'@\\[color=([^\\]\" ]+)\\](.*)\\[/color\\]@Uis',",
        "// Line_Reference 448: \t\t\t'@\\s*\\[quote\\](.*)\\[/quote\\]\\s*@Uis',",
        "// Line_Reference 449: \t\t\t'@\\s*\\[quote=([^\\]]+)\\](.*)\\[/quote\\]\\s*@Uis',",
        "// Line_Reference 450: \t\t\t'@\\[img\\]\\s*([^\\[\" ]+\\.(jpe?g|png|gif|bmp|tiff?|ico))\\s*\\[/img\\]@i',",
        "// Line_Reference 451: \t\t\t'@\\[url\\]\\s*([^\\[\" ]+)\\s*\\[/url\\]@i',",
        "// Line_Reference 452: \t\t\t'@\\[url=([^\\]\" ]+)\\](.*)\\[/url\\]@Uis',",
        "// Line_Reference 453: \t\t\t'@\\[email\\]\\s*([^\\[\" ]+)\\s*\\[/email\\]@i',",
        "// Line_Reference 454: \t\t\t'@\\[email=([^\\]\" ]+)\\](.*)\\[/email\\]@Uis',",
        "// Line_Reference 455: \t\t\t'@href=\"(([a-z0-9]+\\.)*[a-z0-9]+\\.([a-z]{2}|asia|biz|com|info|name|net|org|tel)(/|\"))@i'",
        "// Line_Reference 456: \t\t);",
        "// Line_Reference 457: ",
        "// Line_Reference 458: \t\t$arrReplace = array",
        "// Line_Reference 459: \t\t(",
        "// Line_Reference 460: \t\t\t'<strong>$1</strong>',",
        "// Line_Reference 461: \t\t\t'<em>$1</em>',",
        "// Line_Reference 462: \t\t\t'<span style=\"text-decoration:underline\">$1</span>',",
        "// Line_Reference 463: \t\t\t\"\\n\\n\" . '<div class=\"code\"><p>' . $GLOBALS['TL_LANG']['MSC']['com_code'] . '</p><pre>$1</pre></div>' . \"\\n\\n\",",
        "// Line_Reference 464: \t\t\t'<span style=\"color:$1\">$2</span>',",
        "// Line_Reference 465: \t\t\t\"\\n\\n\" . '<blockquote>$1</blockquote>' . \"\\n\\n\",",
        "// Line_Reference 466: \t\t\t\"\\n\\n\" . '<blockquote><p>' . sprintf($GLOBALS['TL_LANG']['MSC']['com_quote'], '$1') . '</p>$2</blockquote>' . \"\\n\\n\",",
        "// Line_Reference 467: \t\t\t'<img src=\"$1\" alt=\"\" />',",
        "// Line_Reference 468: \t\t\t'<a href=\"$1\">$1</a>',",
        "// Line_Reference 469: \t\t\t'<a href=\"$1\">$2</a>',",
        "// Line_Reference 470: \t\t\t'<a href=\"mailto:$1\">$1</a>',",
        "// Line_Reference 471: \t\t\t'<a href=\"mailto:$1\">$2</a>',",
        "// Line_Reference 472: \t\t\t'href=\"http://$1'",
        "// Line_Reference 473: \t\t);",
        "// Line_Reference 474: ",
        "// Line_Reference 475: \t\t$strComment = preg_replace($arrSearch, $arrReplace, $strComment);",
        "// Line_Reference 476: ",
        "// Line_Reference 477: \t\t// Encode e-mail addresses",
        "// Line_Reference 478: \t\tif (strpos($strComment, 'mailto:') !== false)",
        "// Line_Reference 479: \t\t{",
        "// Line_Reference 480: \t\t\t$strComment = StringUtil::encodeEmail($strComment);",
        "// Line_Reference 481: \t\t}",
        "// Line_Reference 482: ",
        "// Line_Reference 483: \t\treturn $strComment;"
    ]
}
