{
    "cve_id": "CVE-2023-23630",
    "cve_description": "Eta is an embedded JS templating engine that works inside Node, Deno, and the browser. XSS attack - anyone using the Express API is impacted. The problem has been resolved. Users should upgrade to version 2.0.0. As a workaround, don't pass user supplied things directly to `res.render`. \n",
    "cve_publish_date": "2023-02-01",
    "cwe_id": "CWE-79",
    "cwe_name": "Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting')",
    "cwe_description": "The product does not neutralize or incorrectly neutralizes user-controllable input before it is placed in output that is used as a web page that is served to other users.",
    "commit_message": "Don't use data object for Eta configuration (#214)",
    "type_of_change": "Modification",
    "filename_of_changes": "file-handlers.ts",
    "code_language": "TypeScript",
    "number_of_lines_added_for_mitigation": "7",
    "number_of_lines_deleted_vulnerable_to_cve": "35",
    "vulnerable_lines": [
        "// Line_Reference 7: import { copyProps } from \"./utils.ts\";",
        "// Line_Reference 22:   /** Express.js settings may be stored here */",
        "// Line_Reference 23:   settings?: {",
        "// Line_Reference 24:     [key: string]: any; // eslint-disable-line @typescript-eslint/no-explicit-any",
        "// Line_Reference 25:   };",
        "// Line_Reference 176:  * - `renderFile(filename, dataAndConfig, [cb])`",
        "// Line_Reference 177:  *   - Eta will merge `dataAndConfig` into `eta.config`",
        "// Line_Reference 192:  * let rendered = await eta.renderFile(\"./template\", {...data, cache: true})",
        "// Line_Reference 227:   However, with Express, configuration options will be passed along with the data.",
        "// Line_Reference 228:   Thus, Express will call renderFile with (filename, dataAndOptions, cb)",
        "// Line_Reference 229:   And we want to also make (filename, data, options, cb) available",
        "// Line_Reference 234:   data = data || {}; // If data is undefined, we don't want accessing data.settings to error",
        "// Line_Reference 253:     // Otherwise, get the config from the data object",
        "// Line_Reference 254:     // And then grab some config options from data.settings",
        "// Line_Reference 255:     // Which is where Express sometimes stores them",
        "// Line_Reference 256:     renderConfig = getConfig(data as PartialConfig) as EtaConfigWithFilename;",
        "// Line_Reference 257:     if (data.settings) {",
        "// Line_Reference 258:       // Pull a few things from known locations",
        "// Line_Reference 259:       if (data.settings.views) {",
        "// Line_Reference 260:         renderConfig.views = data.settings.views;",
        "// Line_Reference 261:       }",
        "// Line_Reference 262:       if (data.settings[\"view cache\"]) {",
        "// Line_Reference 263:         renderConfig.cache = true;",
        "// Line_Reference 264:       }",
        "// Line_Reference 265:       // Undocumented after Express 2, but still usable, esp. for",
        "// Line_Reference 266:       // items that are unsafe to be passed along with data, like `root`",
        "// Line_Reference 267:       const viewOpts = data.settings[\"view options\"];",
        "// Line_Reference 268: ",
        "// Line_Reference 269:       if (viewOpts) {",
        "// Line_Reference 270:         copyProps(renderConfig, viewOpts);",
        "// Line_Reference 271:       }",
        "// Line_Reference 272:     }",
        "// Line_Reference 289:  * - `renderFile(filename, dataAndConfig, [cb])`",
        "// Line_Reference 290:  *   - Eta will merge `dataAndConfig` into `eta.config`",
        "// Line_Reference 305:  * let rendered = await eta.renderFile(\"./template\", {...data, cache: true})"
    ]
}
