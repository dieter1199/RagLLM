{
    "cve_id": "CVE-2019-19059",
    "cve_description": "Multiple memory leaks in the iwl_pcie_ctxt_info_gen3_init() function in drivers/net/wireless/intel/iwlwifi/pcie/ctxt-info-gen3.c in the Linux kernel through 5.3.11 allow attackers to cause a denial of service (memory consumption) by triggering iwl_pcie_init_fw_sec() or dma_alloc_coherent() failures, aka CID-0f4f199443fa.",
    "cve_publish_date": "2019-11-18",
    "cwe_id": "CWE-401",
    "cwe_name": "Missing Release of Memory after Effective Lifetime",
    "cwe_description": "The product does not sufficiently track and release allocated memory after it has been used, which slowly consumes remaining memory.",
    "commit_message": "iwlwifi: pcie: fix memory leaks in iwl_pcie_ctxt_info_gen3_init\n\nIn iwl_pcie_ctxt_info_gen3_init there are cases that the allocated dma\nmemory is leaked in case of error.\n\nDMA memories prph_scratch, prph_info, and ctxt_info_gen3 are allocated\nand initialized to be later assigned to trans_pcie. But in any error case\nbefore such assignment the allocated memories should be released.\n\nFirst of such error cases happens when iwl_pcie_init_fw_sec fails.\nCurrent implementation correctly releases prph_scratch. But in two\nsunsequent error cases where dma_alloc_coherent may fail, such\nreleases are missing.\n\nThis commit adds release for prph_scratch when allocation for\nprph_info fails, and adds releases for prph_scratch and prph_info when\nallocation for ctxt_info_gen3 fails.\n\nFixes: 2ee824026288 (\"iwlwifi: pcie: support context information for 22560 devices\")\nSigned-off-by: Navid Emamdoost <navid.emamdoost@gmail.com>\nSigned-off-by: Luca Coelho <luciano.coelho@intel.com>",
    "type_of_change": "Modification",
    "filename_of_changes": "ctxt-info-gen3.c",
    "code_language": "C",
    "number_of_lines_added_for_mitigation": "25",
    "number_of_lines_deleted_vulnerable_to_cve": "11",
    "vulnerable_lines": [
        "// Line_Reference 110: \tif (ret) {",
        "// Line_Reference 111: \t\tdma_free_coherent(trans->dev,",
        "// Line_Reference 112: \t\t\t\t  sizeof(*prph_scratch),",
        "// Line_Reference 113: \t\t\t\t  prph_scratch,",
        "// Line_Reference 114: \t\t\t\t  trans_pcie->prph_scratch_dma_addr);",
        "// Line_Reference 115: \t\treturn ret;",
        "// Line_Reference 116: \t}",
        "// Line_Reference 124: \tif (!prph_info)",
        "// Line_Reference 125: \t\treturn -ENOMEM;",
        "// Line_Reference 132: \tif (!ctxt_info_gen3)",
        "// Line_Reference 133: \t\treturn -ENOMEM;"
    ]
}
