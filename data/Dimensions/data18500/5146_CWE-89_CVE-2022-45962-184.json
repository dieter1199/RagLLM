{
    "cve_id": "CVE-2022-45962",
    "cve_description": "Open Solutions for Education, Inc openSIS Community Edition v8.0 and earlier is vulnerable to SQL Injection via CalendarModal.php.",
    "cve_publish_date": "2023-02-13",
    "cwe_id": "CWE-89",
    "cwe_name": "Improper Neutralization of Special Elements used in an SQL Command ('SQL Injection')",
    "cwe_description": "The product constructs all or part of an SQL command using externally-influenced input from an upstream component, but it does not neutralize or incorrectly neutralizes special elements that could modify the intended SQL command when it is sent to a downstream component. Without sufficient removal or quoting of SQL syntax in user-controllable inputs, the generated SQL query can cause those inputs to be interpreted as SQL instead of ordinary user data.",
    "commit_message": "Version 9.0 release\n\nOlder version shifted to branch: Version_8.0",
    "type_of_change": "ModificationType.ADD",
    "filename_of_changes": "Ajax.php",
    "code_language": "PHP",
    "number_of_lines_added_for_mitigation": "35",
    "number_of_lines_deleted_vulnerable_to_cve": "41",
    "vulnerable_lines": [
        "// Line_Reference 31: !empty($_SESSION['USERNAME']) or die('Access denied!');",
        "// Line_Reference 102: error_reporting(E_ERROR);",
        "// Line_Reference 109: if (UserStudentID() && User('PROFILE') != 'parent' && User('PROFILE') != 'student' && substr(clean_param($_REQUEST['modname'], PARAM_NOTAGS), 0, 5) != 'Atten' && substr(clean_param($_REQUEST['modname'], PARAM_NOTAGS), 0, 5) != 'users' && clean_param($_REQUEST['modname'], PARAM_NOTAGS) != 'students/AddUsers.php' && $_REQUEST['modname']!= 'tools/Backup.php' && (substr(clean_param($_REQUEST['modname'], PARAM_NOTAGS), 0, 10) != 'attendance' || clean_param($_REQUEST['modname'], PARAM_NOTAGS) == 'attendance/StudentSummary.php' || clean_param($_REQUEST['modname'], PARAM_NOTAGS) == 'attendance/DailySummary.php' || clean_param($_REQUEST['modname'], PARAM_NOTAGS) == 'attendance/AddAbsences.php')) {",
        "// Line_Reference 128:         'scheduling/ViewSchedule.php',",
        "// Line_Reference 129:         'scheduling/Requests.php',",
        "// Line_Reference 144:         'grades/EditReportCardGrades.php',",
        "// Line_Reference 159:         'students/Student.php',",
        "// Line_Reference 162:         'scheduling/ViewSchedule.php',",
        "// Line_Reference 163:         'scheduling/Requests.php',",
        "// Line_Reference 165:         'grades/EditReportCardGrades.php',",
        "// Line_Reference 169: ",
        "// Line_Reference 173:         if(in_array($_REQUEST['modname'], $allow_buffer_list))",
        "// Line_Reference 174:         {",
        "// Line_Reference 175:             if(in_array($_REQUEST['modname'],  $allow_back_to_student_list))",
        "// Line_Reference 176:             {",
        "// Line_Reference 177:                 DrawHeaderHome('<div class=\"panel\"><div class=\"panel-heading\"><h6 class=\"panel-title\">'._selectedStudent.' : ' . $RET[1]['FIRST_NAME'] . '&nbsp;' . ($RET[1]['MIDDLE_NAME'] ? $RET[1]['MIDDLE_NAME'] . ' ' : '') . $RET[1]['LAST_NAME'] . '&nbsp;' . $RET[1]['NAME_SUFFIX'] . '</h6> <div class=\"heading-elements clearfix\"><span class=\"heading-text\"><A HREF=Modules.php?modname=' . clean_param($_REQUEST['modname'], PARAM_NOTAGS) . '&search_modfunc=list&next_modname=Students/Student.php&ajax=true&bottom_back=true&return_session=true target=body><i class=\"icon-square-left\"></i> '._backToStudentList.'</A></span><div class=\"btn-group heading-btn\"><A HREF=SideForStudent.php?student_id=new&modcat=' . clean_param($_REQUEST['modcat'], PARAM_NOTAGS) . '&modname=' . $_REQUEST['modname'] . ' class=\"btn btn-danger btn-xs\">'._deselect.'</A></div></div></div></div>');",
        "// Line_Reference 178:             }",
        "// Line_Reference 179:             else",
        "// Line_Reference 180:             {",
        "// Line_Reference 181:                 DrawHeaderHome('<div class=\"panel\"><div class=\"panel-heading\"><h6 class=\"panel-title\">'._selectedStudent.' : ' . $RET[1]['FIRST_NAME'] . '&nbsp;' . ($RET[1]['MIDDLE_NAME'] ? $RET[1]['MIDDLE_NAME'] . ' ' : '') . $RET[1]['LAST_NAME'] . '&nbsp;' . $RET[1]['NAME_SUFFIX'] . '</h6> <div class=\"heading-elements clearfix\"><div class=\"btn-group heading-btn\"><A HREF=SideForStudent.php?student_id=new&modcat=' . clean_param($_REQUEST['modcat'], PARAM_NOTAGS) . '&modname=' . $_REQUEST['modname'] . ' class=\"btn btn-danger btn-xs\">'._deselect.'</A></div></div></div></div>');",
        "// Line_Reference 187:         if(in_array($_REQUEST['modname'], $allow_buffer_list))",
        "// Line_Reference 188:         {",
        "// Line_Reference 189:             DrawHeaderHome('<div class=\"panel\"><div class=\"panel-heading\"><h6 class=\"panel-title\">'._selectedStudent.' : ' . $RET[1]['FIRST_NAME'] . '&nbsp;' . ($RET[1]['MIDDLE_NAME'] ? $RET[1]['MIDDLE_NAME'] . ' ' : '') . $RET[1]['LAST_NAME'] . '&nbsp;' . $RET[1]['NAME_SUFFIX'] . '</h6> <div class=\"heading-elements clearfix\"><A HREF=SideForStudent.php?student_id=new&modcat=' . clean_param($_REQUEST['modcat'], PARAM_NOTAGS) . '&modname=' . $_REQUEST['modname'] . ' class=\"btn btn-danger btn-xs\">'._deselect.'</A></div></div></div>');",
        "// Line_Reference 202:             DrawHeader(''._selectedStaff.' : ' . $RET[1]['FIRST_NAME'] . '&nbsp;' . $RET[1]['LAST_NAME'], '<span class=\"heading-text\"><A HREF=Modules.php?modname=' . clean_param($_REQUEST['modname'], PARAM_NOTAGS) . '&search_modfunc=list&next_modname=users/User.php&ajax=true&bottom_back=true&return_session=true target=body><i class=\"icon-square-left\"></i> '._backToUserList.'</A></span><div class=\"btn-group heading-btn\"><A HREF=Side.php?staff_id=new&modcat=' . clean_param($_REQUEST['modcat'], PARAM_NOTAGS) . ' class=\"btn btn-danger btn-xs\">'._deselect.'</A></div>');",
        "// Line_Reference 211:    // if (strpos(clean_param($_REQUEST['modname'], PARAM_NOTAGS), 'miscellaneous/') === false)",
        "// Line_Reference 212:    //     echo '<script language=\"JavaScript\">if(window == top  && (!window.opener || window.opener.location.href.substring(0,(window.opener.location.href.indexOf(\"&\")!=-1?window.opener.location.href.indexOf(\"&\"):window.opener.location.href.replace(\"#\",\"\").length))!=window.location.href.substring(0,(window.location.href.indexOf(\"&\")!=-1?window.location.href.indexOf(\"&\"):window.location.href.replace(\"#\",\"\").length)))) window.location.href = \"index.php\";</script>';",
        "// Line_Reference 213:     echo \"<BODY marginwidth=0 leftmargin=0 border=0 onload='doOnload();' background=assets/bg.gif>\";",
        "// Line_Reference 214:     echo '<DIV id=\"Migoicons\" style=\"visibility:hidden;position:absolute;z-index:1000;top:-100\"></DIV>';",
        "// Line_Reference 264:     }",
        "// Line_Reference 265:     else {",
        "// Line_Reference 276:             echo \"\"._youReNotAllowedToUseThisProgram.\"! \"._thisAttemptedViolationHasBeenLoggedAndYourIpAddressWasCaptured.\".\";",
        "// Line_Reference 305: function decode_unicode_url($str) {",
        "// Line_Reference 320:                         . chr(($value & 0x3f) | 0x80);",
        "// Line_Reference 323:                         . chr((($value & 0x0fc0) >> 6) | 0x80)",
        "// Line_Reference 324:                         . chr(($value & 0x3f) | 0x80);",
        "// Line_Reference 334: function code2utf($num) {",
        "// Line_Reference 341:                 . chr(($num & 63) + 128);",
        "// Line_Reference 344:                 . chr((($num >> 6) & 63) + 128) . chr(($num & 63) + 128);",
        "// Line_Reference 348: function unescape($strIn, $iconv_to = 'UTF-8') {",
        "// Line_Reference 385: ",
        "// Line_Reference 386: ?>"
    ]
}
