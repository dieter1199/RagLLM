{
    "cve_id": "CVE-2022-23568",
    "cve_description": "Tensorflow is an Open Source Machine Learning Framework. The implementation of `AddManySparseToTensorsMap` is vulnerable to an integer overflow which results in a `CHECK`-fail when building new `TensorShape` objects (so, an assert failure based denial of service). We are missing some validation on the shapes of the input tensors as well as directly constructing a large `TensorShape` with user-provided dimensions. The fix will be included in TensorFlow 2.8.0. We will also cherrypick this commit on TensorFlow 2.7.1, TensorFlow 2.6.3, and TensorFlow 2.5.3, as these are also affected and still in supported range.",
    "cve_publish_date": "2022-02-03",
    "cwe_id": "CWE-190",
    "cwe_name": "Integer Overflow or Wraparound",
    "cwe_description": "The product performs a calculation that can\n         produce an integer overflow or wraparound when the logic\n         assumes that the resulting value will always be larger than\n         the original value. This occurs when an integer value is\n         incremented to a value that is too large to store in the\n         associated representation. When this occurs, the value may\n         become a very small or negative number.",
    "commit_message": "Replace faulty overflow check with a builder for `TensorShape`.\n\nPrevents an integer overflow that was not caught before.\n\nPiperOrigin-RevId: 415381595\nChange-Id: I76585ddedc912bd9f4a390aeafa8e2ced1a28863",
    "type_of_change": "Modification",
    "filename_of_changes": "sparse_tensors_map_ops.cc",
    "code_language": "C++",
    "number_of_lines_added_for_mitigation": "3",
    "number_of_lines_deleted_vulnerable_to_cve": "15",
    "vulnerable_lines": [
        "// Line_Reference 266:     int new_num_elements = 1;",
        "// Line_Reference 267:     bool overflow_ocurred = false;",
        "// Line_Reference 268:     for (int i = 0; i < input_shape_vec.size(); i++) {",
        "// Line_Reference 269:       new_num_elements =",
        "// Line_Reference 270:           MultiplyWithoutOverflow(new_num_elements, input_shape_vec(i));",
        "// Line_Reference 271:       if (new_num_elements < 0) {",
        "// Line_Reference 272:         overflow_ocurred = true;",
        "// Line_Reference 273:         break;",
        "// Line_Reference 274:       }",
        "// Line_Reference 275:     }",
        "// Line_Reference 276: ",
        "// Line_Reference 277:     OP_REQUIRES(",
        "// Line_Reference 278:         context, !overflow_ocurred,",
        "// Line_Reference 279:         errors::Internal(\"Encountered overflow from large input shape.\"));",
        "// Line_Reference 281:     TensorShape tensor_input_shape(input_shape_vec);"
    ]
}
