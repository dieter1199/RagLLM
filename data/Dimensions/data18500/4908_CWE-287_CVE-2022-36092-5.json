{
    "cve_id": "CVE-2022-36092",
    "cve_description": "XWiki Platform Old Core is a core package for XWiki Platform, a generic wiki platform. Prior to versions 14.2 and 13.10.4, all rights checks that would normally prevent a user from viewing a document on a wiki can be bypassed using the login action and directly specified templates. This exposes title, content and comments of any document and properties of objects, though class and property name must be known. This is also exploitable on private wikis. This has been patched in versions 14.2 and 13.10.4 by properly checking view rights before loading documents and disallowing non-default templates in the login, registration and skin action. As a workaround, it would be possible to protect all templates individually by adding code to check access rights first.",
    "cve_publish_date": "2022-09-08",
    "cwe_id": "CWE-287",
    "cwe_name": "Improper Authentication",
    "cwe_description": "When an actor claims to have a given identity, the product does not prove or insufficiently proves that the claim is correct.",
    "commit_message": "XWIKI-19549: Disallow template override for login, register and skin\n\n* Also do not put a document without view rights into the context.",
    "type_of_change": "Modification",
    "filename_of_changes": "XWiki.java",
    "code_language": "Java",
    "number_of_lines_added_for_mitigation": "31",
    "number_of_lines_deleted_vulnerable_to_cve": "21",
    "vulnerable_lines": [
        "// Line_Reference 5920:         context.put(\"doc\", doc);",
        "// Line_Reference 5921:         context.put(\"cdoc\", doc);",
        "// Line_Reference 5922:         vcontext.put(\"doc\", doc.newDocument(context));",
        "// Line_Reference 5923:         vcontext.put(\"cdoc\", vcontext.get(\"doc\"));",
        "// Line_Reference 5924:         XWikiDocument tdoc;",
        "// Line_Reference 5925: ",
        "// Line_Reference 5926:         // If the parameter language exists and is empty, it means we want to force loading the regular document",
        "// Line_Reference 5927:         // not a translation. This should be handled later by doing a better separation between locale used in the UI",
        "// Line_Reference 5928:         // and for loading the documents.",
        "// Line_Reference 5929:         if (\"\".equals(context.getRequest().getParameter(\"language\"))) {",
        "// Line_Reference 5930:             tdoc = doc;",
        "// Line_Reference 5932:             tdoc = doc.getTranslatedDocument(context);",
        "// Line_Reference 5933:         }",
        "// Line_Reference 5935:         try {",
        "// Line_Reference 5936:             String rev = (String) context.get(\"rev\");",
        "// Line_Reference 5937:             if (StringUtils.isNotEmpty(rev)) {",
        "// Line_Reference 5938:                 tdoc = getDocument(tdoc, rev, context);",
        "// Line_Reference 5940:         } catch (Exception ex) {",
        "// Line_Reference 5941:             // Invalid version, just use the most recent one",
        "// Line_Reference 5943:         context.put(\"tdoc\", tdoc);",
        "// Line_Reference 5944:         vcontext.put(\"tdoc\", tdoc.newDocument(context));"
    ]
}
