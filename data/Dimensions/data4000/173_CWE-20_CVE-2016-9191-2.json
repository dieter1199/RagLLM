{
    "cve_id": "CVE-2016-9191",
    "cve_description": "The cgroup offline implementation in the Linux kernel through 4.8.11 mishandles certain drain operations, which allows local users to cause a denial of service (system hang) by leveraging access to a container environment for executing a crafted application, as demonstrated by trinity.",
    "cve_publish_date": "2016-11-28",
    "cwe_id": "CWE-20",
    "cwe_name": "Improper Input Validation",
    "cwe_description": "The product receives input or data, but it does\n        not validate or incorrectly validates that the input has the\n        properties that are required to process the data safely and\n        correctly.",
    "commit_message": "sysctl: Drop reference added by grab_header in proc_sys_readdir\n\nFixes CVE-2016-9191, proc_sys_readdir doesn't drop reference\nadded by grab_header when return from !dir_emit_dots path.\nIt can cause any path called unregister_sysctl_table will\nwait forever.\n\nThe calltrace of CVE-2016-9191:\n\n[ 5535.960522] Call Trace:\n[ 5535.963265]  [<ffffffff817cdaaf>] schedule+0x3f/0xa0\n[ 5535.968817]  [<ffffffff817d33fb>] schedule_timeout+0x3db/0x6f0\n[ 5535.975346]  [<ffffffff817cf055>] ? wait_for_completion+0x45/0x130\n[ 5535.982256]  [<ffffffff817cf0d3>] wait_for_completion+0xc3/0x130\n[ 5535.988972]  [<ffffffff810d1fd0>] ? wake_up_q+0x80/0x80\n[ 5535.994804]  [<ffffffff8130de64>] drop_sysctl_table+0xc4/0xe0\n[ 5536.001227]  [<ffffffff8130de17>] drop_sysctl_table+0x77/0xe0\n[ 5536.007648]  [<ffffffff8130decd>] unregister_sysctl_table+0x4d/0xa0\n[ 5536.014654]  [<ffffffff8130deff>] unregister_sysctl_table+0x7f/0xa0\n[ 5536.021657]  [<ffffffff810f57f5>] unregister_sched_domain_sysctl+0x15/0x40\n[ 5536.029344]  [<ffffffff810d7704>] partition_sched_domains+0x44/0x450\n[ 5536.036447]  [<ffffffff817d0761>] ? __mutex_unlock_slowpath+0x111/0x1f0\n[ 5536.043844]  [<ffffffff81167684>] rebuild_sched_domains_locked+0x64/0xb0\n[ 5536.051336]  [<ffffffff8116789d>] update_flag+0x11d/0x210\n[ 5536.057373]  [<ffffffff817cf61f>] ? mutex_lock_nested+0x2df/0x450\n[ 5536.064186]  [<ffffffff81167acb>] ? cpuset_css_offline+0x1b/0x60\n[ 5536.070899]  [<ffffffff810fce3d>] ? trace_hardirqs_on+0xd/0x10\n[ 5536.077420]  [<ffffffff817cf61f>] ? mutex_lock_nested+0x2df/0x450\n[ 5536.084234]  [<ffffffff8115a9f5>] ? css_killed_work_fn+0x25/0x220\n[ 5536.091049]  [<ffffffff81167ae5>] cpuset_css_offline+0x35/0x60\n[ 5536.097571]  [<ffffffff8115aa2c>] css_killed_work_fn+0x5c/0x220\n[ 5536.104207]  [<ffffffff810bc83f>] process_one_work+0x1df/0x710\n[ 5536.110736]  [<ffffffff810bc7c0>] ? process_one_work+0x160/0x710\n[ 5536.117461]  [<ffffffff810bce9b>] worker_thread+0x12b/0x4a0\n[ 5536.123697]  [<ffffffff810bcd70>] ? process_one_work+0x710/0x710\n[ 5536.130426]  [<ffffffff810c3f7e>] kthread+0xfe/0x120\n[ 5536.135991]  [<ffffffff817d4baf>] ret_from_fork+0x1f/0x40\n[ 5536.142041]  [<ffffffff810c3e80>] ? kthread_create_on_node+0x230/0x230\n\nOne cgroup maintainer mentioned that \"cgroup is trying to offline\na cpuset css, which takes place under cgroup_mutex.  The offlining\nends up trying to drain active usages of a sysctl table which apprently\nis not happening.\"\nThe real reason is that proc_sys_readdir doesn't drop reference added\nby grab_header when return from !dir_emit_dots path. So this cpuset\noffline path will wait here forever.\n\nSee here for details: http://www.openwall.com/lists/oss-security/2016/11/04/13\n\nFixes: f0c3b5093add (\"[readdir] convert procfs\")\nCc: stable@vger.kernel.org\nReported-by: CAI Qian <caiqian@redhat.com>\nTested-by: Yang Shukui <yangshukui@huawei.com>\nSigned-off-by: Zhou Chengming <zhouchengming1@huawei.com>\nAcked-by: Al Viro <viro@ZenIV.linux.org.uk>\nSigned-off-by: Eric W. Biederman <ebiederm@xmission.com>",
    "type_of_change": "Modification",
    "filename_of_changes": "proc_sysctl.c",
    "code_language": "C",
    "number_of_lines_added_for_mitigation": "2",
    "number_of_lines_deleted_vulnerable_to_cve": "1",
    "vulnerable_lines": [
        "// Line_Reference 712: \t\treturn 0;"
    ]
}
