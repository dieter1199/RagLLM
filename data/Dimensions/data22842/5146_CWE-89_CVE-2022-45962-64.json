{
    "cve_id": "CVE-2022-45962",
    "cve_description": "Open Solutions for Education, Inc openSIS Community Edition v8.0 and earlier is vulnerable to SQL Injection via CalendarModal.php.",
    "cve_publish_date": "2023-02-13",
    "cwe_id": "CWE-89",
    "cwe_name": "Improper Neutralization of Special Elements used in an SQL Command ('SQL Injection')",
    "cwe_description": "The product constructs all or part of an SQL command using externally-influenced input from an upstream component, but it does not neutralize or incorrectly neutralizes special elements that could modify the intended SQL command when it is sent to a downstream component. Without sufficient removal or quoting of SQL syntax in user-controllable inputs, the generated SQL query can cause those inputs to be interpreted as SQL instead of ordinary user data.",
    "commit_message": "Version 9.0 release\n\nOlder version shifted to branch: Version_8.0",
    "type_of_change": "ModificationType.ADD",
    "filename_of_changes": "GeneralInfoInc.php",
    "code_language": "PHP",
    "number_of_lines_added_for_mitigation": "51",
    "number_of_lines_deleted_vulnerable_to_cve": "52",
    "vulnerable_lines": [
        "// Line_Reference 38: $ethnic_option=array();",
        "// Line_Reference 39: $language_option=array();",
        "// Line_Reference 40: $ethnicity=DBGet(DBQuery('SELECT * FROM ethnicity'));",
        "// Line_Reference 41: foreach($ethnicity as $key =>$value)",
        "// Line_Reference 42: {",
        "// Line_Reference 43: \t$ethnic_option[$value['ETHNICITY_ID']]=$value['ETHNICITY_NAME'];",
        "// Line_Reference 48: $language=DBGet(DBQuery('SELECT * FROM language'));",
        "// Line_Reference 49: foreach($language as $key =>$value)",
        "// Line_Reference 50: {",
        "// Line_Reference 51: \t$language_option[$value['LANGUAGE_ID']]=$value['LANGUAGE_NAME'];",
        "// Line_Reference 58: echo '<h5 class=\"text-primary\">'._demographicInformation.'</h5>';",
        "// Line_Reference 64:     echo '<div class=\"well m-b-20 clearfix\"><h6 class=\"m-t-0 text-success\">'._studentName.'</h6><div class=\"row\"><div class=\"col-lg-6\"><div class=\"form-group\">' . TextInput($student['FIRST_NAME'], 'students[FIRST_NAME]', ''._firstName.' *', 'size=12 class=form-control maxlength=50') . '</div></div><div class=\"col-lg-6\"><div class=\"form-group\">' . TextInput($student['MIDDLE_NAME'], 'students[MIDDLE_NAME]', ''._middleName.'', 'class=form-control maxlength=50') . '</div></div></div><div class=\"row\"><div class=\"col-lg-6\"><div class=\"form-group m-b-0\">' . TextInput($student['LAST_NAME'], 'students[LAST_NAME]', ''._lastName.' *', 'size=12 class=form-control maxlength=50') . '</div></div><div class=\"col-lg-6\"><div class=\"form-group m-b-0\">' . SelectInput($student['NAME_SUFFIX'], 'students[NAME_SUFFIX]', 'Suffix', array('Jr.' => 'Jr.', 'Sr.' => 'Sr.', 'II' => 'II', 'III' => 'III', 'IV' => 'IV', 'V' => 'V'), '', '') . '</div></div></div></div>';",
        "// Line_Reference 66:     echo '<DIV id=student_name><div class=form-group onclick=\\'addHTML(\"<div class=\\\"well m-b-20 clearfix\\\"><h6 class=\\\"m-t-0 text-success\\\">Student Name</h6><div class=\\\"row\\\"><div class=\\\"col-lg-6\\\"><div class=\\\"form-group\\\">' . str_replace('\"', '\\\"', TextInput($student['FIRST_NAME'], 'students[FIRST_NAME]', ''._firstName.' *', 'maxlength=50 style=\"font-size:14px;\"', false)) . '</div></div><div class=col-lg-6><div class=form-group>' . str_replace('\"', '\\\"', TextInput($student['LAST_NAME'], 'students[LAST_NAME]', ''._lastName.' *', 'maxlength=50 ', false)) . '</div></div></div><div class=row><div class=col-lg-6><div class=\\\"form-group m-b-0\\\">' . str_replace('\"', '\\\"', TextInput($student['MIDDLE_NAME'], 'students[MIDDLE_NAME]', ''._middleName.'', 'size=3 maxlength=50', false)) . '</div></div><div class=col-lg-6><div class=\\\"form-group m-b-0\\\">' . str_replace('\"', '\\\"', SelectInput($student['NAME_SUFFIX'], 'students[NAME_SUFFIX]', ''._suffix.'', array('Jr.' => 'Jr.', 'Sr.' => 'Sr.', 'II' => 'II', 'III' => 'III', 'IV' => 'IV', 'V' => 'V'), '', '', false)) . '</div></div></div></div>\",\"student_name\",true);\\'><label class=\"control-label col-lg-2 text-right\">'._studentName.'</label><div class=\"col-lg-10\"><h3 class=\"m-0 text-success\">' . $student['FIRST_NAME'] . ' ' . $student['MIDDLE_NAME'] . ' ' . $student['LAST_NAME'] . ' ' . $student['NAME_SUFFIX'] . '</h3></div></div></DIV>';",
        "// Line_Reference 71: echo '<div class=\"form-group\"><label class=\"control-label col-lg-4 text-right\">'._estimatedGradDate.'</label><div class=\"col-lg-8\">' . DateInputAY($student['ESTIMATED_GRAD_DATE'], 'students[ESTIMATED_GRAD_DATE]', '1', false, 'MM/DD/YYYY') . '</div></div>';",
        "// Line_Reference 73: echo '<div class=\"form-group\"><label class=\"control-label col-lg-4 text-right\">'._gender.'</label><div class=\"col-lg-8\">' . SelectInput($student['GENDER'], 'students[GENDER]', '', array('Male' => 'Male', 'Female' => 'Female'), 'N/A', '') . '</div></div>';",
        "// Line_Reference 79: echo '<div class=\"form-group\"><label class=\"control-label col-lg-4 text-right\">'._ethnicity.'</label><div class=\"col-lg-8\">' . SelectInput($student['ETHNICITY_ID'], 'students[ETHNICITY_ID]', '', $ethnic_option, 'N/A', '') . '</div></div>';",
        "// Line_Reference 81: echo '<div class=\"form-group\">' . TextInput($student['COMMON_NAME'], 'students[COMMON_NAME]', ''._commonName.'', 'size=10 class=form-control maxlength=10') . '</div>';",
        "// Line_Reference 85: if($student['BIRTHDATE'] != '')",
        "// Line_Reference 86: {",
        "// Line_Reference 92:     $show_stu_age = '<div class=\"p-t-10 text-right stu_age\"><b>Age:</b> '.(($stu_age->y).\"yrs\").', '.(($stu_age->m).\"mo\").'</div>';",
        "// Line_Reference 95: }",
        "// Line_Reference 96: else",
        "// Line_Reference 97: {",
        "// Line_Reference 105: echo '<div class=\"form-group\"><label class=\"control-label col-lg-4 text-right\">'._dateOfBirth.'<span class=\"text-danger\">*</span></label><div class=\"col-lg-8\">' . DateInputAY(isset($student['BIRTHDATE']) && $student['BIRTHDATE'] != \"\" ? $student['BIRTHDATE'] : \"\", 'students[BIRTHDATE]', '2', false, '') . '</div></div>';",
        "// Line_Reference 107: echo '<div class=\"form-group\"><label class=\"control-label col-lg-4 text-right\">'._language.'</label><div class=\"col-lg-8\">' . SelectInput($student['LANGUAGE_ID'], 'students[LANGUAGE_ID]', '', $language_option, 'N/A', '') . '</div></div>';",
        "// Line_Reference 118: echo '<div class=\"form-group\"><label class=\"control-label col-md-4 text-right\">'._email.'</label><div class=\"col-md-8\">' . TextInput($student['EMAIL'], 'students[EMAIL]', '', 'size=100 class=cell_medium maxlength=100 onkeyup=check_email(this,' . $id_sent . ',3); onblur=check_email(this,' . $id_sent . ',3)') . '<div class=\"help-block\" id=email_error></div></div></div>';",
        "// Line_Reference 120: echo '<div class=\"form-group\">' . TextInput($student['PHONE'], 'students[PHONE]', ''._phone.'', 'size=100 class=cell_medium maxlength=100') . '</div>';",
        "// Line_Reference 124: $fields_RET = DBGet(DBQuery('SELECT ID,TITLE,TYPE,SELECT_OPTIONS,DEFAULT_SELECTION,REQUIRED,HIDE,SORT_ORDER FROM custom_fields WHERE SYSTEM_FIELD=\\'N\\' AND CATEGORY_ID=\\'' . $_REQUEST[category_id] . '\\' ORDER BY SORT_ORDER,TITLE'));",
        "// Line_Reference 266: echo '<h5 class=\"pt-20 text-primary\">'._schoolInformation.'</h5>';",
        "// Line_Reference 279: echo TextInput($student['ALT_ID'], 'students[ALT_ID]', ''._alternateId.'', 'size=10 maxlength=45');",
        "// Line_Reference 313: echo '<div class=\"form-group\"><label class=\"control-label col-lg-4 text-right\">'._grade.'<span class=\"text-danger\">*</span></label><div class=\"col-lg-8\">';",
        "// Line_Reference 345: echo '<div class=\"form-group\"><label class=\"control-label col-lg-4 text-right\">'._section.'</label><div class=\"col-lg-8\">';",
        "// Line_Reference 355: echo '<h5 class=\"pt-20 text-primary\">'._accessInformation.'</h5>';",
        "// Line_Reference 359: echo '<label class=\"control-label col-md-4 text-right\">'._username.'</label>';",
        "// Line_Reference 361: echo TextInput($student['USERNAME'], 'students[USERNAME]', '', 'onkeyup=\"usercheck_init_student(this)\" onBlur=\"usercheck_init_student_Mod(this)\"');",
        "// Line_Reference 362: echo '<div class=\"help-block\" id=\"ajax_output_st\"></div>';",
        "// Line_Reference 367: echo '<label class=\"control-label text-right col-lg-4\">'._password.'</label>';",
        "// Line_Reference 377: if($student['USERNAME'] && $student['USERNAME'] != '')",
        "// Line_Reference 378: {",
        "// Line_Reference 380: }",
        "// Line_Reference 381: else",
        "// Line_Reference 382: {",
        "// Line_Reference 395:         echo '<div class=\"form-group\"><label class=\"control-label col-lg-4 text-right\">'._disableStudent.'</label><div class=\"col-lg-8\">';",
        "// Line_Reference 415:         echo '<br><a href=Modules.php?modname=students/Upload.php?modfunc=edit class=\"btn btn-white btn-xs m-t-5\"><b>'._changePhoto.'</b></a></div>';",
        "// Line_Reference 418: }",
        "// Line_Reference 419: else {",
        "// Line_Reference 422:         echo '<div align=\"center\">'._uploadStudentSPhoto.':<br/><IMG SRC=\"assets/noimage.jpg?id=' . rand(6, 100000) . '\" width=144 class=pic>';",
        "// Line_Reference 424:             echo '<label class=\"fileUpload btn btn-primary btn-xs btn-block m-t-10\"><span>'._selectFile.'</span><input id=\"uploadBtn\" type=\"file\" name=\"file\" class=\"upload\" onchange=\"selectFile(this)\" /></label>';",
        "// Line_Reference 428:         echo '<div align=\"center\">'._uploadStudentSPhoto.':<br/><IMG SRC=\"assets/noimage.jpg?id=' . rand(6, 100000) . '\" width=144 class=pic>';",
        "// Line_Reference 430:             echo '<label class=\"fileUpload btn_ btn btn-primary btn-block btn-xs\"><span>'._selectFile.'</span><input id=\"uploadBtn\" type=\"file\" name=\"file\" class=\"upload\" onchange=\"selectFile(this)\" /></label>';",
        "// Line_Reference 443: echo '<h5 class=\"modal-title\">'._uploadPhoto.'</h5>';",
        "// Line_Reference 452: echo '<input type=\"submit\" class=\"btn btn-primary legitRipple\" name=\"upbtn\" value=\"'._upload.'\">';"
    ]
}
