{
    "cve_id": "CVE-2016-4992",
    "cve_description": "389 Directory Server in Red Hat Enterprise Linux Desktop 6 through 7, Red Hat Enterprise Linux HPC Node 6 through 7, Red Hat Enterprise Linux Server 6 through 7, and Red Hat Enterprise Linux Workstation 6 through 7 allows remote attackers to infer the existence of RDN component objects.",
    "cve_publish_date": "2017-06-08",
    "cwe_id": "CWE-200",
    "cwe_name": "Exposure of Sensitive Information to an Unauthorized Actor",
    "cwe_description": "The product exposes sensitive information to an actor that is not explicitly authorized to have access to that information.",
    "commit_message": "Bug 1347760 - CVE-2016-4992 389-ds-base: Information disclosure via repeated use of LDAP ADD operation, etc.\n\nDescription: If a bind user has no rights, it should not disclose\nany information including the existence of the entry.\n\nFix description:\n1) ALREADY_EXISTS in add -- If to be added entry is found existing\n   in ldbm_back_add, it checks the ACI and if there is no rights,\n   it returns INSUFFICIENT_ACCESS instead of ALREADY_EXISTS.\n2) NO_SUCH_OBJECT in other update operations -- If the target entry\n   is found not existing, it checks the ancestor entry's access\n   rights in find_entry.  If it is not allowed to access the subtree,\n   it returns INSUFFICIENT_ACCESS instead of NO_SUC_OBJECT.  Plus,\n   it supresses the \"Matched\" ancestor message.\n3) NO_SUCH_OBJECT in search -- If a bind entry has no rights to read\n   a subtree, it returns no search results with SUCCESS.  It should\n   be applied to the no existing subtree if the bind entry has no\n   rights to the super tree.\n4) If bind fails because of the non-existence of the bind user or\n   the parent nodes, the bind returns LDAP_INVALID_CREDENTIALS to\n   the client with no other information.\n   The detailed cause is logged in the access log as follows:\n\t RESULT err=49 .. etime=0 - No such suffix (<given suffix>)\n\t RESULT err=49 .. etime=0 - Invalid credentials\n\t RESULT err=49 .. etime=0 - No such entry\n\nhttps://bugzilla.redhat.com/show_bug.cgi?id=1347760\n\nReviewed by lkrispen@redhat.com, mreynolds@redhat.com, and tbordaz@redhat.com.\nThank you!!!",
    "type_of_change": "Modification",
    "filename_of_changes": "findentry.c",
    "code_language": "C",
    "number_of_lines_added_for_mitigation": "106",
    "number_of_lines_deleted_vulnerable_to_cve": "33",
    "vulnerable_lines": [
        "// Line_Reference 19: static struct backentry *find_entry_internal_dn(Slapi_PBlock *pb, backend *be, const Slapi_DN *sdn, int lock, back_txn *txn, int flags);",
        "// Line_Reference 20: static struct backentry * find_entry_internal(Slapi_PBlock *pb, Slapi_Backend *be, const entry_address *addr, int lock, back_txn *txn, int flags);",
        "// Line_Reference 30: \tSlapi_Value *val=NULL;",
        "// Line_Reference 83: \tSlapi_PBlock\t*pb,",
        "// Line_Reference 87: \tback_txn\t\t*txn,",
        "// Line_Reference 88: \tint\t\t\t\tflags",
        "// Line_Reference 98: \tslapi_pblock_get( pb, SLAPI_MANAGEDSAIT, &managedsait );",
        "// Line_Reference 154: \t\tme= dn2ancestor(pb->pb_backend,sdn,&ancestorsdn,txn,&err);",
        "// Line_Reference 167: \t\tslapi_send_ldap_result( pb, ( 0 == err || DB_NOTFOUND == err ) ?",
        "// Line_Reference 168: \t\t\tLDAP_NO_SUCH_OBJECT : ( LDAP_INVALID_DN_SYNTAX == err ) ?",
        "// Line_Reference 169: \t\t\tLDAP_INVALID_DN_SYNTAX : LDAP_OPERATIONS_ERROR,",
        "// Line_Reference 170: \t\t\t(char*)slapi_sdn_get_dn(&ancestorsdn), NULL, 0, NULL );",
        "// Line_Reference 186: \tSlapi_PBlock\t*pb,",
        "// Line_Reference 188: \tconst char \t\t\t*uniqueid,",
        "// Line_Reference 190: \tback_txn\t\t*txn",
        "// Line_Reference 246: \tback_txn *txn,",
        "// Line_Reference 247: \tint flags",
        "// Line_Reference 264: \t\t\tentry = find_entry_internal_dn (pb, be, addr->sdn,",
        "// Line_Reference 265: \t\t\t                                lock, txn, flags);",
        "// Line_Reference 267: \t\t\tLDAPDebug0Args( LDAP_DEBUG_ANY,",
        "// Line_Reference 268: \t\t\t                \"find_entry_internal: Null target dn\\n\" );",
        "// Line_Reference 281: \tback_txn *txn",
        "// Line_Reference 284: \treturn( find_entry_internal( pb, be, addr, 0/*!lock*/, txn, 0/*flags*/ ) );",
        "// Line_Reference 292: \tback_txn *txn",
        "// Line_Reference 295: \treturn( find_entry_internal( pb, be, addr, 1/*lock*/, txn, 0/*flags*/ ) );",
        "// Line_Reference 307: \tback_txn *txn",
        "// Line_Reference 310: \treturn( find_entry_internal( pb, be, addr, 0/*!lock*/, txn, FE_REALLY_INTERNAL ) );",
        "// Line_Reference 318:     back_txn *txn",
        "// Line_Reference 321: \treturn( find_entry_internal( pb, be, addr, 1/*lock*/, txn, FE_REALLY_INTERNAL ) );",
        "// Line_Reference 330:     back_txn *txn",
        "// Line_Reference 331: ",
        "// Line_Reference 334: \treturn( find_entry_internal( pb, be, addr, 1/*lock*/, txn,",
        "// Line_Reference 335: \t\t                         FE_REALLY_INTERNAL | flags ));"
    ]
}
