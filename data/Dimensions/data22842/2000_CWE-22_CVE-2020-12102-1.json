{
    "cve_id": "CVE-2020-12102",
    "cve_description": "In Tiny File Manager 2.4.1, there is a Path Traversal vulnerability in the ajax recursive directory listing functionality. This allows authenticated users to enumerate directories and files on the filesystem (outside of the application scope).",
    "cve_publish_date": "2020-04-28",
    "cwe_id": "CWE-22",
    "cwe_name": "Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal')",
    "cwe_description": "The product uses external input to construct a pathname that is intended to identify a file or directory that is located underneath a restricted parent directory, but the product does not properly neutralize special elements within the pathname that can cause the pathname to resolve to a location that is outside of the restricted directory.",
    "commit_message": "Security fix #357\nDownload file causes timeout #353\nDownload Restart @ 88% #312\ndownload large file issues #259\nFile upload issue #354\nFIle Upload URL error #360\nBug in .tar archive extraction when destination(s) file(s) already exist (HTTP error 500) #332\nBackup File return false #201",
    "type_of_change": "Modification",
    "filename_of_changes": "tinyfilemanager.php",
    "code_language": "PHP",
    "number_of_lines_added_for_mitigation": "160",
    "number_of_lines_deleted_vulnerable_to_cve": "39",
    "vulnerable_lines": [
        "// Line_Reference 6:  * H3K | Tiny File Manager V2.4.1",
        "// Line_Reference 12: define('VERSION', '2.4.1');",
        "// Line_Reference 420:         $response = scan($_POST['path'], $_POST['content']);",
        "// Line_Reference 428:         $path = $_POST['path'];",
        "// Line_Reference 429:         $date = date(\"dMy-His\");",
        "// Line_Reference 430:         $newFile = $file . '-' . $date . '.bak';",
        "// Line_Reference 431:         copy($path . '/' . $file, $path . '/' . $newFile) or die(\"Unable to backup\");",
        "// Line_Reference 432:         echo \"Backup $newFile Created\";",
        "// Line_Reference 788:         header('Content-Description: File Transfer');",
        "// Line_Reference 789:         header('Content-Type: application/octet-stream');",
        "// Line_Reference 790:         header('Content-Disposition: attachment; filename=\"' . basename($path . '/' . $dl) . '\"');",
        "// Line_Reference 791:         header('Content-Transfer-Encoding: binary');",
        "// Line_Reference 792:         header('Connection: Keep-Alive');",
        "// Line_Reference 793:         header('Expires: 0');",
        "// Line_Reference 794:         header('Cache-Control: must-revalidate, post-check=0, pre-check=0');",
        "// Line_Reference 795:         header('Pragma: public');",
        "// Line_Reference 796:         header('Content-Length: ' . filesize($path . '/' . $dl));",
        "// Line_Reference 797:         ob_end_clean();",
        "// Line_Reference 798:         readfile($path . '/' . $dl);",
        "// Line_Reference 992:             $gzipper = new PharData($zip_path);",
        "// Line_Reference 993:             $res = $gzipper->extractTo($path);",
        "// Line_Reference 1140:                 <form action=\"<?php echo htmlspecialchars($_SERVER[\"PHP_SELF\"]) . '?p=' . fm_enc(FM_PATH) ?>\" class=\"dropzone card-tabs-container\" id=\"fileUploader\" enctype=\"multipart/form-data\">",
        "// Line_Reference 1710:                 <a title=\"Backup\" class=\"btn btn-sm btn-outline-primary\" href=\"javascript:backup('<?php echo urlencode($path) ?>','<?php echo urlencode($file) ?>')\"><i class=\"fa fa-database\"></i> <?php echo lng('BackUp') ?></a>",
        "// Line_Reference 2819:     $ite = new RecursiveIteratorIterator(new RecursiveDirectoryIterator($path));",
        "// Line_Reference 2820:     $rii = new RegexIterator($ite, \"/(\".$filter.\")/i\");",
        "// Line_Reference 2821: ",
        "// Line_Reference 2822:     $files = array();",
        "// Line_Reference 2823:     foreach ($rii as $file) {",
        "// Line_Reference 2824:         if (!$file->isDir()) {",
        "// Line_Reference 2825:             $fileName = $file->getFilename();",
        "// Line_Reference 2826:             $location = str_replace(FM_ROOT_PATH, '', $file->getPath());",
        "// Line_Reference 2827:             $files[] = array(",
        "// Line_Reference 2828:                     \"name\" => $fileName,",
        "// Line_Reference 2829:                     \"type\" => \"file\",",
        "// Line_Reference 2830:                     \"path\" => $location,",
        "// Line_Reference 2831:                 );",
        "// Line_Reference 2832:         }",
        "// Line_Reference 2833:     }",
        "// Line_Reference 2834:     return $files;"
    ]
}
