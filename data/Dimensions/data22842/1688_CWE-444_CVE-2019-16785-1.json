{
    "cve_id": "CVE-2019-16785",
    "cve_description": "Waitress through version 1.3.1 implemented a \"MAY\" part of the RFC7230 which states: \"Although the line terminator for the start-line and header fields is the sequence CRLF, a recipient MAY recognize a single LF as a line terminator and ignore any preceding CR.\" Unfortunately if a front-end server does not parse header fields with an LF the same way as it does those with a CRLF it can lead to the front-end and the back-end server parsing the same HTTP message in two different ways. This can lead to a potential for HTTP request smuggling/splitting whereby Waitress may see two requests while the front-end server only sees a single HTTP message. This issue is fixed in Waitress 1.4.0.",
    "cve_publish_date": "2019-12-20",
    "cwe_id": "CWE-444",
    "cwe_name": "Inconsistent Interpretation of HTTP Requests ('HTTP Request/Response Smuggling')",
    "cwe_description": "The product acts as an intermediary HTTP agent\n         (such as a proxy or firewall) in the data flow between two\n         entities such as a client and server, but it does not\n         interpret malformed HTTP requests or responses in ways that\n         are consistent with how the messages will be processed by\n         those entities that are at the ultimate destination.",
    "commit_message": "Remove support for non CRLF line endings\n\nhttps://tools.ietf.org/html/rfc7230#section-3.5 says that servers MAY\nimplement their parsers to use only the LF as a delimeter between lines,\nhowever if the frontend server does NOT do the same you can potentially\nallow a single HTTP request to be treated differently by the two\nservers.\n\nThis issue can be used to cause HTTP request smuggling or HTTP desync\nwhich may lead to vulnerabilities.\n\nTo increase robustness Waitress will no longer allow bare LF for HTTP\nmessages/headers and chunked encoding and instead now enforces that the\nline endings at CRLF.",
    "type_of_change": "Modification",
    "filename_of_changes": "parser.py",
    "code_language": "Python",
    "number_of_lines_added_for_mitigation": "20",
    "number_of_lines_deleted_vulnerable_to_cve": "20",
    "vulnerable_lines": [
        "// Line_Reference 22: from waitress.compat import (",
        "// Line_Reference 23:     tostr,",
        "// Line_Reference 24:     urlparse,",
        "// Line_Reference 25:     unquote_bytes_to_wsgi,",
        "// Line_Reference 26: )",
        "// Line_Reference 27: ",
        "// Line_Reference 29: ",
        "// Line_Reference 30: from waitress.receiver import (",
        "// Line_Reference 31:     FixedStreamReceiver,",
        "// Line_Reference 32:     ChunkedReceiver,",
        "// Line_Reference 33: )",
        "// Line_Reference 34: ",
        "// Line_Reference 36:     find_double_newline,",
        "// Line_Reference 39:     BadRequest,",
        "// Line_Reference 98:                 # Remove preceeding blank lines.",
        "// Line_Reference 172:         index = header_plus.find(b\"\\n\")",
        "// Line_Reference 175:             header = header_plus[index + 1 :]",
        "// Line_Reference 177:             first_line = header_plus.rstrip()",
        "// Line_Reference 178:             header = b\"\"",
        "// Line_Reference 302:     lines = header.split(b\"\\n\")"
    ]
}
