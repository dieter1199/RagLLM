(!empty($url_components['port']) && !in_array($url_components['port'], array(80, 8080, 443))) ||
$addresses = gethostbynamel($url_components['host']);
if($addresses)
foreach($config['disallowed_remote_addresses'] as $disallowed_address)
$ip_range = fetch_ip_range($disallowed_address);
foreach($addresses as $address)
$packed_address = my_inet_pton($address);
if(is_array($ip_range))
{
if(strcmp($ip_range[0], $packed_address) <= 0 && strcmp($ip_range[1], $packed_address) >= 0)
{
return false;
}
}
elseif($address == $disallowed_address)
{
return false;
}
$can_followlocation = @ini_get('open_basedir') === '' && !$mybb->safemode;
$request_header = $max_redirects != 0 && !$can_followlocation;
curl_setopt($ch, CURLOPT_URL, $url);
curl_setopt($ch, CURLOPT_HEADER, $request_header);
curl_setopt($ch, CURLOPT_TIMEOUT, 10);
curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);
curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, 0);
if($max_redirects != 0 && $can_followlocation)
curl_setopt($ch, CURLOPT_FOLLOWLOCATION, 1);
curl_setopt($ch, CURLOPT_MAXREDIRS, $max_redirects);
curl_setopt($ch, CURLOPT_POST, 1);
curl_setopt($ch, CURLOPT_POSTFIELDS, $post_body);
if($request_header)
if(!isset($url_components['port']))
{
$url_components['port'] = 80;
}
$fp = @fsockopen($scheme.$url_components['host'], $url_components['port'], $error_no, $error, 10);
if($max_redirects != 0 && (strstr($status_line, ' 301 ') || strstr($status_line, ' 302 ')))
else if(empty($post_data))
{
return @implode("", @file($url));
}
