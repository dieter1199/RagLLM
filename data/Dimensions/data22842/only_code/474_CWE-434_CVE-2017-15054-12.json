),
$newFileName = time()."_".$_SESSION['user_id'];
$targetDir.DIRECTORY_SEPARATOR.$newFileName
$newFileName = time()."_".$_SESSION['user_id'];
$targetDir.DIRECTORY_SEPARATOR.$newFileName
// sanitize the new file name
$newFileName = preg_replace('/[^\w\._]+/', '_', htmlentities($post_newFileName, ENT_QUOTES));
$newFileName = preg_replace('/[^'.$valid_chars_regex.'\.]/', '', strtolower(basename($newFileName)));
//Connect to mysql server
require_once '../../includes/config/settings.php';
require_once $SETTINGS['cpassman_dir'].'/includes/libraries/Database/Meekrodb/db.class.php';
$pass = defuse_return_decrypted($pass);
DB::$host = $server;
DB::$user = $user;
DB::$password = $pass;
DB::$dbName = $database;
DB::$port = $port;
DB::$encoding = $encoding;
DB::$error_handler = true;
$link = mysqli_connect($server, $user, $pass, $database, $port);
$link->set_charset($encoding);
echo '{"filename" : "'.htmlentities($_SESSION['user_avatar'], ENT_QUOTES).'" , "filename_thumb" : "'.htmlentities($_SESSION['user_avatar_thumb'], ENT_QUOTES).'"}';
} else {
$newFileName = time()."_".$_SESSION['user_id'];
$targetDir.DIRECTORY_SEPARATOR.$newFileName
// Return JSON-RPC response
die('{"jsonrpc" : "2.0", "result" : null, "id" : "id" , "newfilename" : "'.$newFileName.'"}');
