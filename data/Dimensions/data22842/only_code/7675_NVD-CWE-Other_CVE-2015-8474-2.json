if back_url.present? && valid_back_url?(back_url)
redirect_to(back_url)
# Returns true if back_url is a valid url for redirection, otherwise false
def valid_back_url?(back_url)
if uri.host.present? && uri.host != request.host
if uri.path.match(%r{/(login|account/register)})
if relative_url_root.present? && !uri.path.starts_with?(relative_url_root)
return true