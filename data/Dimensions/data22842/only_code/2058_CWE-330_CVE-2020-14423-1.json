use Mojo::Util;
has local_secret   => \&_build_local_secret;
# Remove legacy secrets file
my $file = $self->_legacy_session_secrets_file;
$file->remove if -e $file;
sub _build_local_secret {
my $self = shift;
return $ENV{CONVOS_LOCAL_SECRET} if $ENV{CONVOS_LOCAL_SECRET};
my $secret = Mojo::Util::md5_sum(join ':', $self->core->home->to_string, $<, $(, $0);
return $secret;
}
my $secrets;
my $file = $self->_legacy_session_secrets_file;
$secrets = [split /â€š/, $file->slurp] if -e $file;
return $secrets if $secrets and @$secrets;
$secrets = [Mojo::Util::sha1_sum(join ':', rand(), $$, $<, $(, $^X, Time::HiRes::time())];
return $secrets;
sub _legacy_session_secrets_file { shift->core->home->child('secrets') }
