p, _ := s.Filesystem().SafePath(token.FilePath)
st, err := os.Stat(p)
// If there is an error or we're somehow trying to download a directory, just
// respond with the appropriate error.
} else if st.IsDir() {
f, err := os.Open(p)
if err != nil {
middleware.CaptureAndAbort(c, err)
return
}
defer f.Close()
