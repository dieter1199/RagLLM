array('name' => 'text', 'label' => Yii::t('studio', 'Text'), 'type' => 'text'),
array('name' => 'user', 'optional' => 1, 'label' => 'User (optional)', 'type' => 'dropdown', 'options' => array('' => '----------', 'auto' => 'Auto') + X2Model::getAssignmentOptions(false, false)),
'name' => 'createNotif', 'label' => Yii::t('studio', 'Create Notification?'),
$user = $this->parseOption('user', $params);
if($type === 'auto'){
if(!isset($params['model']))
return array (false, '');
$notif->modelType = get_class($params['model']);
$notif->modelId = $params['model']->id;
$notif->type = $this->getNotifType();
$event->associationType = get_class($params['model']);
$event->associationId = $params['model']->id;
$event->type = $this->getEventType();
if($params['model']->hasAttribute('visibility'))
$event->visibility = $params['model']->visibility;
// $event->user = $this->parseOption('user',$params);
} else{
$text = $this->parseOption('text', $params);
$notif->type = 'custom';
$notif->text = $text;
$event->type = 'feed';
$event->subtype = $type;
$event->text = $text;
if($user == 'auto' && isset($params['model']) &&
!empty($params['model']->assignedTo)){
$event->user = $params['model']->assignedTo;
}elseif(!empty($user)){
$event->user = $user;
}else{
$event->user = 'admin';
return array(false, array_shift($notif->getErrors()));
return array(false, array_shift($event->getErrors()));
