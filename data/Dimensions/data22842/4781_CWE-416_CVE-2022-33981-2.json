{
    "cve_id": "CVE-2022-33981",
    "cve_description": "drivers/block/floppy.c in the Linux kernel before 5.17.6 is vulnerable to a denial of service, because of a concurrency use-after-free flaw after deallocating raw_cmd in the raw_cmd_ioctl function.",
    "cve_publish_date": "2022-06-18",
    "cwe_id": "CWE-416",
    "cwe_name": "Use After Free",
    "cwe_description": "The product reuses or references memory after it has been freed. At some point afterward, the memory may be allocated again and saved in another pointer, while the original pointer references a location somewhere within the new allocation. Any operations using the original pointer are no longer valid because the memory \"belongs\" to the code that operates on the new pointer.",
    "commit_message": "floppy: disable FDRAWCMD by default\n\nMinh Yuan reported a concurrency use-after-free issue in the floppy code\nbetween raw_cmd_ioctl and seek_interrupt.\n\n[ It turns out this has been around, and that others have reported the\n  KASAN splats over the years, but Minh Yuan had a reproducer for it and\n  so gets primary credit for reporting it for this fix   - Linus ]\n\nThe problem is, this driver tends to break very easily and nowadays,\nnobody is expected to use FDRAWCMD anyway since it was used to\nmanipulate non-standard formats.  The risk of breaking the driver is\nhigher than the risk presented by this race, and accessing the device\nrequires privileges anyway.\n\nLet's just add a config option to completely disable this ioctl and\nleave it disabled by default.  Distros shouldn't use it, and only those\nrunning on antique hardware might need to enable it.\n\nLink: https://lore.kernel.org/all/000000000000b71cdd05d703f6bf@google.com/\nLink: https://lore.kernel.org/lkml/CAKcFiNC=MfYVW-Jt9A3=FPJpTwCD2PL_ULNCpsCVE5s8ZeBQgQ@mail.gmail.com\nLink: https://lore.kernel.org/all/CAEAjamu1FRhz6StCe_55XY5s389ZP_xmCF69k987En+1z53=eg@mail.gmail.com\nReported-by: Minh Yuan <yuanmingbuaa@gmail.com>\nReported-by: syzbot+8e8958586909d62b6840@syzkaller.appspotmail.com\nReported-by: cruise k <cruise4k@gmail.com>\nReported-by: Kyungtae Kim <kt0755@gmail.com>\nSuggested-by: Linus Torvalds <torvalds@linuxfoundation.org>\nTested-by: Denis Efremov <efremov@linux.com>\nSigned-off-by: Willy Tarreau <w@1wt.eu>\nSigned-off-by: Linus Torvalds <torvalds@linux-foundation.org>",
    "type_of_change": "Modification",
    "filename_of_changes": "floppy.c",
    "code_language": "C",
    "number_of_lines_added_for_mitigation": "32",
    "number_of_lines_deleted_vulnerable_to_cve": "11",
    "vulnerable_lines": [
        "// Line_Reference 3372: \tint i;",
        "// Line_Reference 3523: \t\tif (type)",
        "// Line_Reference 3524: \t\t\treturn -EINVAL;",
        "// Line_Reference 3525: \t\tif (lock_fdc(drive))",
        "// Line_Reference 3526: \t\t\treturn -EINTR;",
        "// Line_Reference 3527: \t\tset_floppy(drive);",
        "// Line_Reference 3528: \t\ti = raw_cmd_ioctl(cmd, (void __user *)param);",
        "// Line_Reference 3529: \t\tif (i == -EINTR)",
        "// Line_Reference 3530: \t\t\treturn -EINTR;",
        "// Line_Reference 3531: \t\tprocess_fd_request();",
        "// Line_Reference 3532: \t\treturn i;"
    ]
}
