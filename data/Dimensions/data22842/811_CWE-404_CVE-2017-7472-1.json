{
    "cve_id": "CVE-2017-7472",
    "cve_description": "The KEYS subsystem in the Linux kernel before 4.10.13 allows local users to cause a denial of service (memory consumption) via a series of KEY_REQKEY_DEFL_THREAD_KEYRING keyctl_set_reqkey_keyring calls.",
    "cve_publish_date": "2017-05-11",
    "cwe_id": "CWE-404",
    "cwe_name": "Improper Resource Shutdown or Release",
    "cwe_description": "The product does not release or incorrectly releases a resource before it is made available for re-use.",
    "commit_message": "KEYS: fix keyctl_set_reqkey_keyring() to not leak thread keyrings\n\nThis fixes CVE-2017-7472.\n\nRunning the following program as an unprivileged user exhausts kernel\nmemory by leaking thread keyrings:\n\n\t#include <keyutils.h>\n\n\tint main()\n\t{\n\t\tfor (;;)\n\t\t\tkeyctl_set_reqkey_keyring(KEY_REQKEY_DEFL_THREAD_KEYRING);\n\t}\n\nFix it by only creating a new thread keyring if there wasn't one before.\nTo make things more consistent, make install_thread_keyring_to_cred()\nand install_process_keyring_to_cred() both return 0 if the corresponding\nkeyring is already present.\n\nFixes: d84f4f992cbd (\"CRED: Inaugurate COW credentials\")\nCc: stable@vger.kernel.org # 2.6.29+\nSigned-off-by: Eric Biggers <ebiggers@google.com>\nSigned-off-by: David Howells <dhowells@redhat.com>",
    "type_of_change": "Modification",
    "filename_of_changes": "keyctl.c",
    "code_language": "C",
    "number_of_lines_added_for_mitigation": "4",
    "number_of_lines_deleted_vulnerable_to_cve": "7",
    "vulnerable_lines": [
        "// Line_Reference 1261:  * If a process keyring is specified then this will be created if it doesn't",
        "// Line_Reference 1262:  * yet exist.  The old setting will be returned if successful.",
        "// Line_Reference 1287: \t\tif (ret < 0) {",
        "// Line_Reference 1288: \t\t\tif (ret != -EEXIST)",
        "// Line_Reference 1289: \t\t\t\tgoto error;",
        "// Line_Reference 1290: \t\t\tret = 0;",
        "// Line_Reference 1291: \t\t}"
    ]
}
