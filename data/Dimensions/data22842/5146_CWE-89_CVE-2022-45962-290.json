{
    "cve_id": "CVE-2022-45962",
    "cve_description": "Open Solutions for Education, Inc openSIS Community Edition v8.0 and earlier is vulnerable to SQL Injection via CalendarModal.php.",
    "cve_publish_date": "2023-02-13",
    "cwe_id": "CWE-89",
    "cwe_name": "Improper Neutralization of Special Elements used in an SQL Command ('SQL Injection')",
    "cwe_description": "The product constructs all or part of an SQL command using externally-influenced input from an upstream component, but it does not neutralize or incorrectly neutralizes special elements that could modify the intended SQL command when it is sent to a downstream component. Without sufficient removal or quoting of SQL syntax in user-controllable inputs, the generated SQL query can cause those inputs to be interpreted as SQL instead of ordinary user data.",
    "commit_message": "Version 9.0 release\n\nOlder version shifted to branch: Version_8.0",
    "type_of_change": "ModificationType.ADD",
    "filename_of_changes": "ScheduleProcess.php",
    "code_language": "PHP",
    "number_of_lines_added_for_mitigation": "40",
    "number_of_lines_deleted_vulnerable_to_cve": "32",
    "vulnerable_lines": [
        "// Line_Reference 46:         $course[MP]=($course[MARKING_PERIOD_ID]!=''?$course[MP]:'FY');",
        "// Line_Reference 48:        if($qr[1]['END_DATE']=='')",
        "// Line_Reference 49:        {",
        "// Line_Reference 50:         if($course[MARKING_PERIOD_ID]!='')",
        "// Line_Reference 52:    $course[MARKING_PERIOD_ID]=$course[MARKING_PERIOD_ID];",
        "// Line_Reference 53:         $mark_end_qry=DBGet(DBQuery('SELECT END_DATE FROM marking_periods WHERE MARKING_PERIOD_ID ='.$course[MARKING_PERIOD_ID].''));",
        "// Line_Reference 54:  $mark_end_date=date('d-M-Y',strtotime($mark_end_qry[1]['END_DATE' ]));",
        "// Line_Reference 56:  else {",
        "// Line_Reference 57:       $mark_end_qry=DBGet(DBQuery('SELECT END_DATE FROM course_details WHERE COURSE_PERIOD_ID ='.$course_period_id.''));",
        "// Line_Reference 58:  $mark_end_date=date('d-M-Y',strtotime($mark_end_qry[1]['END_DATE' ]));",
        "// Line_Reference 59:  }",
        "// Line_Reference 60:        }",
        "// Line_Reference 61:        else",
        "// Line_Reference 62:        {",
        "// Line_Reference 63:         $mark_end=date('d-M-Y',strtotime($qr[1]['END_DATE' ]));",
        "// Line_Reference 64:           if($course[MARKING_PERIOD_ID]!='')",
        "// Line_Reference 65:         {",
        "// Line_Reference 66:             $course[MARKING_PERIOD_ID]=$course[MARKING_PERIOD_ID];",
        "// Line_Reference 67:         $mark_end_qry=DBGet(DBQuery('SELECT END_DATE FROM marking_periods WHERE MARKING_PERIOD_ID ='.$course[MARKING_PERIOD_ID].''));",
        "// Line_Reference 68:  $mark_end_date=date('d-M-Y',strtotime($mark_end_qry[1]['END_DATE' ]));",
        "// Line_Reference 70:  else {",
        "// Line_Reference 71:       $mark_end_qry=DBGet(DBQuery('SELECT END_DATE FROM course_details WHERE COURSE_PERIOD_ID ='.$course_period_id.''));",
        "// Line_Reference 72:  $mark_end_date=date('d-M-Y',strtotime($mark_end_qry[1]['END_DATE' ]));",
        "// Line_Reference 73:  }",
        "// Line_Reference 74:  if(strtotime($qr[1]['END_DATE' ])<strtotime($mark_end_qry[1]['END_DATE' ]))",
        "// Line_Reference 75:      $mark_end_date=$mark_end;",
        "// Line_Reference 76:  else",
        "// Line_Reference 77:      $mark_end_date=date('d-M-Y',strtotime($mark_end_qry[1]['END_DATE' ]));",
        "// Line_Reference 78:        }",
        "// Line_Reference 79:         DBQuery(\"INSERT INTO temp_schedule(SYEAR,SCHOOL_ID,STUDENT_ID,START_DATE,END_DATE,MODIFIED_BY,COURSE_ID,COURSE_PERIOD_ID,MP,MARKING_PERIOD_ID) values('\".UserSyear().\"','\".UserSchool().\"','\".UserStudentID().\"','\".$date.\"','\".$mark_end_date.\"','\".User('STAFF_ID').\"','$course[COURSE_ID]','\".$course_period_id.\"','$course[MP]','$course[MARKING_PERIOD_ID]')\");",
        "// Line_Reference 80:       $html=$course_period_id.\"||\".$course['CP_TITLE'].'||resp';",
        "// Line_Reference 81:        // $html = 'resp';"
    ]
}
