{
    "cve_id": "CVE-2015-6240",
    "cve_description": "The chroot, jail, and zone connection plugins in ansible before 1.9.2 allow local users to escape a restricted environment via a symlink attack.",
    "cve_publish_date": "2017-06-07",
    "cwe_id": "CWE-59",
    "cwe_name": "Improper Link Resolution Before File Access ('Link Following')",
    "cwe_description": "The product attempts to access a file based on the filename, but it does not properly prevent that filename from identifying a link or shortcut that resolves to an unintended resource.",
    "commit_message": "Fix problem with jail and zone connection plugins and symlinks from within the jail/zone.",
    "type_of_change": "Modification",
    "filename_of_changes": "jail.py",
    "code_language": "Python",
    "number_of_lines_added_for_mitigation": "46",
    "number_of_lines_deleted_vulnerable_to_cve": "31",
    "vulnerable_lines": [
        "// Line_Reference 25: import shutil",
        "// Line_Reference 32:     ''' Local chroot based connections '''",
        "// Line_Reference 84:         ''' connect to the chroot; nothing to do here '''",
        "// Line_Reference 86:         vvv(\"THIS IS A LOCAL CHROOT DIR\", host=self.jail)",
        "// Line_Reference 98:     def exec_command(self, cmd, tmp_path, become_user=None, sudoable=False, executable='/bin/sh', in_data=None):",
        "// Line_Reference 99:         ''' run a command on the chroot '''",
        "// Line_Reference 113:                              stdin=subprocess.PIPE,",
        "// Line_Reference 119:     def _normalize_path(self, path, prefix):",
        "// Line_Reference 120:         if not path.startswith(os.path.sep):",
        "// Line_Reference 121:             path = os.path.join(os.path.sep, path)",
        "// Line_Reference 122:         normpath = os.path.normpath(path)",
        "// Line_Reference 123:         return os.path.join(prefix, normpath[1:])",
        "// Line_Reference 124: ",
        "// Line_Reference 125:     def _copy_file(self, in_path, out_path):",
        "// Line_Reference 126:         if not os.path.exists(in_path):",
        "// Line_Reference 127:             raise errors.AnsibleFileNotFound(\"file or module does not exist: %s\" % in_path)",
        "// Line_Reference 128:         try:",
        "// Line_Reference 129:             shutil.copyfile(in_path, out_path)",
        "// Line_Reference 130:         except shutil.Error:",
        "// Line_Reference 131:             traceback.print_exc()",
        "// Line_Reference 132:             raise errors.AnsibleError(\"failed to copy: %s and %s are the same\" % (in_path, out_path))",
        "// Line_Reference 133:         except IOError:",
        "// Line_Reference 134:             traceback.print_exc()",
        "// Line_Reference 135:             raise errors.AnsibleError(\"failed to transfer file to %s\" % out_path)",
        "// Line_Reference 136: ",
        "// Line_Reference 138:         ''' transfer a file from local to chroot '''",
        "// Line_Reference 140:         out_path = self._normalize_path(out_path, self.get_jail_path())",
        "// Line_Reference 143:         self._copy_file(in_path, out_path)",
        "// Line_Reference 146:         ''' fetch a file from chroot to local '''",
        "// Line_Reference 148:         in_path = self._normalize_path(in_path, self.get_jail_path())",
        "// Line_Reference 151:         self._copy_file(in_path, out_path)"
    ]
}
