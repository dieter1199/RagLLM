{
    "cve_id": "CVE-2017-7501",
    "cve_description": "It was found that versions of rpm before 4.13.0.2 use temporary files with predictable names when installing an RPM. An attacker with ability to write in a directory where files will be installed could create symbolic links to an arbitrary location and modify content, and possibly permissions to arbitrary files, which could be used for denial of service or possibly privilege escalation.",
    "cve_publish_date": "2017-11-22",
    "cwe_id": "CWE-59",
    "cwe_name": "Improper Link Resolution Before File Access ('Link Following')",
    "cwe_description": "The product attempts to access a file based on the filename, but it does not properly prevent that filename from identifying a link or shortcut that resolves to an unintended resource.",
    "commit_message": "Don't follow symlinks on file creation (CVE-2017-7501)\n\nOpen newly created files with O_EXCL to prevent symlink tricks.\nWhen reopening hardlinks for writing the actual content, use append\nmode instead. This is compatible with the write-only permissions but\nis not destructive in case we got redirected to somebody elses file,\nverify the target before actually writing anything.\n\nAs these are files with the temporary suffix, errors mean a local\nuser with sufficient privileges to break the installation of the package\nanyway is trying to goof us on purpose, don't bother trying to mend it\n(we couldn't fix the hardlink case anyhow) but just bail out.\n\nBased on a patch by Florian Festi.",
    "type_of_change": "Modification",
    "filename_of_changes": "fsm.c",
    "code_language": "C",
    "number_of_lines_added_for_mitigation": "23",
    "number_of_lines_deleted_vulnerable_to_cve": "6",
    "vulnerable_lines": [
        "// Line_Reference 213: static int expandRegular(rpmfi fi, const char *dest, rpmpsm psm, int nodigest, int nocontent)",
        "// Line_Reference 221: \twfd = Fopen(dest, \"w.ufdio\");",
        "// Line_Reference 251: \t    rc = expandRegular(fi, dest, psm, nodigest, 1);",
        "// Line_Reference 266: \t    rc = expandRegular(fi, dest, psm, nodigest, 0);",
        "// Line_Reference 269: \t    rc = expandRegular(fi, dest, psm, nodigest, 0);",
        "// Line_Reference 942: \t    rc = expandRegular(fi, fn, psm, nodigest, 0);"
    ]
}
