{
    "cve_id": "CVE-2015-8033",
    "cve_description": "In Textpattern 4.5.7, the password-reset feature does not securely tether a hash to a user account.",
    "cve_publish_date": "2020-08-14",
    "cwe_id": "CWE-521",
    "cwe_name": "Weak Password Requirements",
    "cwe_description": "The product does not require that users should have strong passwords, which makes it easier for attackers to compromise user accounts.",
    "commit_message": "Security improvements part 1. See Issue #565\n\n* No more emailing plaintext passwords out: password changes and reset requests are dealt with immediately on the login/admin panels.\n* Stronger cryptographic hashes for confirmation links that don't leak user ID information.\n* Hashes are securely tethered to the user account and auto-expire when logging in or generating a new request. Timeout window of 20 minutes by default for answering reset requests.\n* Password input boxes are unmaskable. Saves having a separate confirmation box, simplifies code logic and is better UX.\n* Dedicated txp_token table introduced for handling token-based storage and retrieval. Better for plugin authors than abusing txp_discuss_nonce.\n\nMore on the way including strength meter and improvements to setup passwords...",
    "type_of_change": "Modification",
    "filename_of_changes": "txp_auth.php",
    "code_language": "PHP",
    "number_of_lines_added_for_mitigation": "91",
    "number_of_lines_deleted_vulnerable_to_cve": "21",
    "vulnerable_lines": [
        "// Line_Reference 78:     } elseif (gps('reset')) {",
        "// Line_Reference 82:     pagetop(gTxt('login'), $message);",
        "// Line_Reference 83: ",
        "// Line_Reference 84:     $stay = (cs('txp_login') and !gps('logout') ? 1 : 0);",
        "// Line_Reference 85:     $reset = gps('reset');",
        "// Line_Reference 86: ",
        "// Line_Reference 154:     if (cs('txp_login') and strpos(cs('txp_login'), ',')) {",
        "// Line_Reference 168:     if ($c_userid and strlen($c_hash) == 32) { // Cookie exists.",
        "// Line_Reference 196:     } elseif ($p_userid and $p_password) { // Incoming login vars.",
        "// Line_Reference 221:                 substr(md5($nonce), - 10).$name,",
        "// Line_Reference 235:     } elseif ($p_reset) { // Reset request.",
        "// Line_Reference 241:     } elseif (gps('reset')) {",
        "// Line_Reference 242:         $message = '';",
        "// Line_Reference 243:     } elseif (gps('confirm')) {",
        "// Line_Reference 246:         $confirm = pack('H*', gps('confirm'));",
        "// Line_Reference 247:         $name    = substr($confirm, 5);",
        "// Line_Reference 248:         $nonce   = safe_field(\"nonce\", 'txp_users', \"name = '\".doSlash($name).\"'\");",
        "// Line_Reference 250:         if ($nonce and $confirm === pack('H*', substr(md5($nonce), 0, 10)).$name) {",
        "// Line_Reference 251:             include_once txpath.'/lib/txplib_admin.php';",
        "// Line_Reference 252: ",
        "// Line_Reference 253:             $message = reset_author_pass($name);"
    ]
}
