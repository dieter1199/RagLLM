{
    "cve_id": "CVE-2017-7177",
    "cve_description": "Suricata before 3.2.1 has an IPv4 defragmentation evasion issue caused by lack of a check for the IP protocol during fragment matching.",
    "cve_publish_date": "2017-03-18",
    "cwe_id": "CWE-358",
    "cwe_name": "Improperly Implemented Security Check for Standard",
    "cwe_description": "The product does not implement or incorrectly implements one or more security-relevant checks as specified by the design of a standardized algorithm, protocol, or technique.",
    "commit_message": "defrag - take protocol into account during re-assembly\n\nThe IP protocol was not being used to match fragments with\ntheir packets allowing a carefully constructed packet\nwith a different protocol to be matched, allowing re-assembly\nto complete, creating a packet that would not be re-assembled\nby the destination host.",
    "type_of_change": "Modification",
    "filename_of_changes": "defrag.c",
    "code_language": "C",
    "number_of_lines_added_for_mitigation": "102",
    "number_of_lines_deleted_vulnerable_to_cve": "68",
    "vulnerable_lines": [
        "// Line_Reference 999: BuildTestPacket(uint16_t id, uint16_t off, int mf, const char content,",
        "// Line_Reference 1000:     int content_len)",
        "// Line_Reference 1026:     ip4h.ip_proto = IPPROTO_ICMP;",
        "// Line_Reference 1062:     if (IPV4_GET_IPPROTO(p) != IPPROTO_ICMP)",
        "// Line_Reference 1077: IPV6BuildTestPacket(uint32_t id, uint16_t off, int mf, const char content,",
        "// Line_Reference 1078:     int content_len)",
        "// Line_Reference 1112:     fh->ip6fh_nxt = IPPROTO_ICMP;",
        "// Line_Reference 1162:     p1 = BuildTestPacket(id, 0, 1, 'A', 8);",
        "// Line_Reference 1165:     p2 = BuildTestPacket(id, 1, 1, 'B', 8);",
        "// Line_Reference 1168:     p3 = BuildTestPacket(id, 2, 0, 'C', 3);",
        "// Line_Reference 1239:     p1 = BuildTestPacket(id, 0, 1, 'A', 8);",
        "// Line_Reference 1242:     p2 = BuildTestPacket(id, 1, 1, 'B', 8);",
        "// Line_Reference 1245:     p3 = BuildTestPacket(id, 2, 0, 'C', 3);",
        "// Line_Reference 1311:     p1 = IPV6BuildTestPacket(id, 0, 1, 'A', 8);",
        "// Line_Reference 1314:     p2 = IPV6BuildTestPacket(id, 1, 1, 'B', 8);",
        "// Line_Reference 1317:     p3 = IPV6BuildTestPacket(id, 2, 0, 'C', 3);",
        "// Line_Reference 1381:     p1 = IPV6BuildTestPacket(id, 0, 1, 'A', 8);",
        "// Line_Reference 1384:     p2 = IPV6BuildTestPacket(id, 1, 1, 'B', 8);",
        "// Line_Reference 1387:     p3 = IPV6BuildTestPacket(id, 2, 0, 'C', 3);",
        "// Line_Reference 1455:     packets[0] = BuildTestPacket(id, 0, 1, 'A', 24);",
        "// Line_Reference 1458:     packets[1] = BuildTestPacket(id, 32 >> 3, 1, 'B', 16);",
        "// Line_Reference 1461:     packets[2] = BuildTestPacket(id, 48 >> 3, 1, 'C', 24);",
        "// Line_Reference 1464:     packets[3] = BuildTestPacket(id, 80 >> 3, 1, 'D', 8);",
        "// Line_Reference 1467:     packets[4] = BuildTestPacket(id, 104 >> 3, 1, 'E', 16);",
        "// Line_Reference 1470:     packets[5] = BuildTestPacket(id, 120 >> 3, 1, 'F', 24);",
        "// Line_Reference 1473:     packets[6] = BuildTestPacket(id, 144 >> 3, 1, 'G', 16);",
        "// Line_Reference 1476:     packets[7] = BuildTestPacket(id, 160 >> 3, 1, 'H', 16);",
        "// Line_Reference 1479:     packets[8] = BuildTestPacket(id, 176 >> 3, 1, 'I', 8);",
        "// Line_Reference 1486:     packets[9] = BuildTestPacket(id, 8 >> 3, 1, 'J', 32);",
        "// Line_Reference 1489:     packets[10] = BuildTestPacket(id, 48 >> 3, 1, 'K', 24);",
        "// Line_Reference 1492:     packets[11] = BuildTestPacket(id, 72 >> 3, 1, 'L', 24);",
        "// Line_Reference 1495:     packets[12] = BuildTestPacket(id, 96 >> 3, 1, 'M', 24);",
        "// Line_Reference 1498:     packets[13] = BuildTestPacket(id, 128 >> 3, 1, 'N', 8);",
        "// Line_Reference 1501:     packets[14] = BuildTestPacket(id, 152 >> 3, 1, 'O', 8);",
        "// Line_Reference 1504:     packets[15] = BuildTestPacket(id, 160 >> 3, 1, 'P', 8);",
        "// Line_Reference 1507:     packets[16] = BuildTestPacket(id, 176 >> 3, 0, 'Q', 16);",
        "// Line_Reference 1590:     packets[0] = IPV6BuildTestPacket(id, 0, 1, 'A', 24);",
        "// Line_Reference 1593:     packets[1] = IPV6BuildTestPacket(id, 32 >> 3, 1, 'B', 16);",
        "// Line_Reference 1596:     packets[2] = IPV6BuildTestPacket(id, 48 >> 3, 1, 'C', 24);",
        "// Line_Reference 1599:     packets[3] = IPV6BuildTestPacket(id, 80 >> 3, 1, 'D', 8);",
        "// Line_Reference 1602:     packets[4] = IPV6BuildTestPacket(id, 104 >> 3, 1, 'E', 16);",
        "// Line_Reference 1605:     packets[5] = IPV6BuildTestPacket(id, 120 >> 3, 1, 'F', 24);",
        "// Line_Reference 1608:     packets[6] = IPV6BuildTestPacket(id, 144 >> 3, 1, 'G', 16);",
        "// Line_Reference 1611:     packets[7] = IPV6BuildTestPacket(id, 160 >> 3, 1, 'H', 16);",
        "// Line_Reference 1614:     packets[8] = IPV6BuildTestPacket(id, 176 >> 3, 1, 'I', 8);",
        "// Line_Reference 1621:     packets[9] = IPV6BuildTestPacket(id, 8 >> 3, 1, 'J', 32);",
        "// Line_Reference 1624:     packets[10] = IPV6BuildTestPacket(id, 48 >> 3, 1, 'K', 24);",
        "// Line_Reference 1627:     packets[11] = IPV6BuildTestPacket(id, 72 >> 3, 1, 'L', 24);",
        "// Line_Reference 1630:     packets[12] = IPV6BuildTestPacket(id, 96 >> 3, 1, 'M', 24);",
        "// Line_Reference 1633:     packets[13] = IPV6BuildTestPacket(id, 128 >> 3, 1, 'N', 8);",
        "// Line_Reference 1636:     packets[14] = IPV6BuildTestPacket(id, 152 >> 3, 1, 'O', 8);",
        "// Line_Reference 1639:     packets[15] = IPV6BuildTestPacket(id, 160 >> 3, 1, 'P', 8);",
        "// Line_Reference 1642:     packets[16] = IPV6BuildTestPacket(id, 176 >> 3, 0, 'Q', 16);",
        "// Line_Reference 2128:         Packet *p = BuildTestPacket(i, 0, 1, 'A' + i, 16);",
        "// Line_Reference 2144:     Packet *p = BuildTestPacket(99, 0, 1, 'A' + i, 16);",
        "// Line_Reference 2192:     p = BuildTestPacket(id, 1, 0, 'A', 0);",
        "// Line_Reference 2231:     p = BuildTestPacket(1, 8183, 0, 'A', 71);",
        "// Line_Reference 2270:     p1 = BuildTestPacket(1, 0, 1, 'A', 8);",
        "// Line_Reference 2273:     p2 = BuildTestPacket(1, 1, 0, 'B', 8);",
        "// Line_Reference 2316:     p1 = BuildTestPacket(1, 0, 1, 'A', 8);",
        "// Line_Reference 2319:     p2 = BuildTestPacket(1, 1, 0, 'B', 8);",
        "// Line_Reference 2364:     p1 = BuildTestPacket(id, 0, 0, 'A', 8);",
        "// Line_Reference 2434:     Packet *p1 = BuildTestPacket(ip_id, 2, 1, 'C', 8);",
        "// Line_Reference 2435:     Packet *p2 = BuildTestPacket(ip_id, 0, 1, 'A', 8);",
        "// Line_Reference 2436:     Packet *p3 = BuildTestPacket(ip_id, 1, 0, 'B', 8);",
        "// Line_Reference 2498:     Packet *p1 = IPV6BuildTestPacket(ip_id, 2, 1, 'C', 8);",
        "// Line_Reference 2499:     Packet *p2 = IPV6BuildTestPacket(ip_id, 0, 1, 'A', 8);",
        "// Line_Reference 2500:     Packet *p3 = IPV6BuildTestPacket(ip_id, 1, 0, 'B', 8);"
    ]
}
