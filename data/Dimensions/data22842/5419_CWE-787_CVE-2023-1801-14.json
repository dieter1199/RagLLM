{
    "cve_id": "CVE-2023-1801",
    "cve_description": "The SMB protocol decoder in tcpdump version 4.99.3 can perform an out-of-bounds write when decoding a crafted network packet.",
    "cve_publish_date": "2023-04-07",
    "cwe_id": "CWE-787",
    "cwe_name": "Out-of-bounds Write",
    "cwe_description": "The product writes data past the end, or before the beginning, of the intended buffer.",
    "commit_message": "Have a common routine for converting dates and times to strings.\n\nHave a routine that takes a buffer, a strftime format, and a struct tm *\nas arguments, and:\n\n* checks whether the struct tm * is null and, if so, returns a string\nindicating that the date and time couldn't be converted;\n\n* otherwise, passes it to strftime(), along with the buffer and the\nformat argument and, if strftime() returns 0, meaning the string didn't\nfit into the buffer and thus that the buffer's contents are undefined,\nreturns a string indicating that the date and time didn't fit into the\nbuffer;\n\n* otherwise, returns a pointer to the buffer.\n\nCall that routine instead of directly calling strftime() in printers;\nthat prevents printing a buffer with undefined data if the buffer isn't\nbig enough for the string.\n\nAlso, when generating file names using an strftime format, check the\nreturn value of strftime() to make sure the buffer didn't overflow.",
    "type_of_change": "Modification",
    "filename_of_changes": "smbutil.c",
    "code_language": "C",
    "number_of_lines_added_for_mitigation": "5",
    "number_of_lines_deleted_vulnerable_to_cve": "11",
    "vulnerable_lines": [
        "// Line_Reference 771: \t    struct tm *lt;",
        "// Line_Reference 773: \t    char buffer[sizeof(\"Www Mmm dd hh:mm:ss yyyyy\\n\")];",
        "// Line_Reference 803: \t\tlt = localtime(&t);",
        "// Line_Reference 804: \t\tif (lt != NULL) {",
        "// Line_Reference 805: \t\t    strftime(buffer, sizeof(buffer), \"%a %b %e %T %Y%n\", lt);",
        "// Line_Reference 806: \t\t    tstring = buffer;",
        "// Line_Reference 807: \t\t}",
        "// Line_Reference 808: \t\telse",
        "// Line_Reference 809: \t\t    tstring = \"(Can't convert time)\\n\";",
        "// Line_Reference 811: \t\ttstring = \"NULL\\n\";",
        "// Line_Reference 812: \t    ND_PRINT(\"%s\", tstring);"
    ]
}
