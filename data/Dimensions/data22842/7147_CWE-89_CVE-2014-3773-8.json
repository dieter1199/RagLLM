{
    "cve_id": "CVE-2014-3773",
    "cve_description": "Multiple SQL injection vulnerabilities in TeamPass before 2.1.20 allow remote attackers to execute arbitrary SQL commands via the login parameter in a (1) send_pw_by_email or (2) generate_new_password action in sources/main.queries.php; iDisplayStart parameter to (3) datatable.logs.php or (4) a file in source/datatable/; or iDisplayLength parameter to (5) datatable.logs.php or (6) a file in source/datatable/; or allow remote authenticated users to execute arbitrary SQL commands via a sSortDir_ parameter to (7) datatable.logs.php or (8) a file in source/datatable/.",
    "cve_publish_date": "2014-08-07",
    "cwe_id": "CWE-89",
    "cwe_name": "Improper Neutralization of Special Elements used in an SQL Command ('SQL Injection')",
    "cwe_description": "The product constructs all or part of an SQL command using externally-influenced input from an upstream component, but it does not neutralize or incorrectly neutralizes special elements that could modify the intended SQL command when it is sent to a downstream component. Without sufficient removal or quoting of SQL syntax in user-controllable inputs, the generated SQL query can cause those inputs to be interpreted as SQL instead of ordinary user data.",
    "commit_message": "Security/API (beta) improvements",
    "type_of_change": "Modification",
    "filename_of_changes": "functions.php",
    "code_language": "PHP",
    "number_of_lines_added_for_mitigation": "23",
    "number_of_lines_deleted_vulnerable_to_cve": "27",
    "vulnerable_lines": [
        "// Line_Reference 12: \tif (count($apiip_pool) > 0 && !array_search($_SERVER['REMOTE_ADDR'], $apiip_pool)) {",
        "// Line_Reference 172: \t\t\t\t$array_category = explode(';',$GLOBALS['request'][2]);",
        "// Line_Reference 173: ",
        "// Line_Reference 174: \t\t\t\tforeach($array_category as $category) {",
        "// Line_Reference 175: \t\t\t\t\tif(!preg_match_all(\"/^([\\w\\:\\'\\-\\sàáâãäåçèéêëìíîïðòóôõöùúûüýÿ]+)$/i\", $category,$result)) {",
        "// Line_Reference 176: \t\t\t\t\t\trest_error('CATEGORY_MALFORMED');",
        "// Line_Reference 177: \t\t\t\t\t}",
        "// Line_Reference 178: \t\t\t\t}",
        "// Line_Reference 179: ",
        "// Line_Reference 180: \t\t\t\tif(count($array_category) > 1 && count($array_category) < 5) {",
        "// Line_Reference 181: \t\t\t\t\tfor ($i = count($array_category); $i > 0; $i--) {",
        "// Line_Reference 182: \t\t\t\t\t\t$slot = $i - 1;",
        "// Line_Reference 183: \t\t\t\t\t\tif (!$slot) {",
        "// Line_Reference 184: \t\t\t\t\t\t\t$category_query .= \"select id from \".$GLOBALS['pre'].\"nested_tree where title LIKE '\".$array_category[$slot].\"' AND parent_id = 0\";",
        "// Line_Reference 185: \t\t\t\t\t\t} else {",
        "// Line_Reference 186: \t\t\t\t\t\t\t$category_query .= \"select id from \".$GLOBALS['pre'].\"nested_tree where title LIKE '\".$array_category[$slot].\"' AND parent_id = (\";",
        "// Line_Reference 187: \t\t\t\t\t\t}",
        "// Line_Reference 188: \t\t\t\t\t}",
        "// Line_Reference 189: \t\t\t\t\tfor ($i = 1; $i < count($array_category); $i++) { $category_query .= \")\"; }",
        "// Line_Reference 190: \t\t\t\t} elseif (count($array_category) == 1) {",
        "// Line_Reference 191: \t\t\t\t\t$category_query = \"select id from \".$GLOBALS['pre'].\"nested_tree where title LIKE '\".$array_category[0].\"' AND parent_id = 0\";",
        "// Line_Reference 193: \t\t\t\t\trest_error ('NO_CATEGORY');",
        "// Line_Reference 195: \t\t\t\t$response = $bdd->query(\"select id,label,login,pw from \".$GLOBALS['pre'].\"items where id_tree = (\".$category_query.\")\");",
        "// Line_Reference 201: //\t\t\t\t\t$json[$id]['pw'] = teampass_decrypt_pw($data['pw'],SALT,$rand_key);",
        "// Line_Reference 328: }",
        "// Line_Reference 329: ",
        "// Line_Reference 330: ?>"
    ]
}
