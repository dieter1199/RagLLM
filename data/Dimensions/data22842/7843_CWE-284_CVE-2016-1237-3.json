{
    "cve_id": "CVE-2016-1237",
    "cve_description": "nfsd in the Linux kernel through 4.6.3 allows local users to bypass intended file-permission restrictions by setting a POSIX ACL, related to nfs2acl.c, nfs3acl.c, and nfs4acl.c.",
    "cve_publish_date": "2016-06-29",
    "cwe_id": "CWE-284",
    "cwe_name": "Improper Access Control",
    "cwe_description": "The product does not restrict or incorrectly restricts access to a resource from an unauthorized actor.",
    "commit_message": "nfsd: check permissions when setting ACLs\n\nUse set_posix_acl, which includes proper permission checks, instead of\ncalling ->set_acl directly.  Without this anyone may be able to grant\nthemselves permissions to a file by setting the ACL.\n\nLock the inode to make the new checks atomic with respect to set_acl.\n(Also, nfsd was the only caller of set_acl not locking the inode, so I\nsuspect this may fix other races.)\n\nThis also simplifies the code, and ensures our ACLs are checked by\nposix_acl_valid.\n\nThe permission checks and the inode locking were lost with commit\n4ac7249e, which changed nfsd to use the set_acl inode operation directly\ninstead of going through xattr handlers.\n\nReported-by: David Sinquin <david@sinquin.eu>\n[agreunba@redhat.com: use set_posix_acl]\nFixes: 4ac7249e\nCc: Christoph Hellwig <hch@infradead.org>\nCc: Al Viro <viro@zeniv.linux.org.uk>\nCc: stable@vger.kernel.org\nSigned-off-by: J. Bruce Fields <bfields@redhat.com>",
    "type_of_change": "Modification",
    "filename_of_changes": "nfs4acl.c",
    "code_language": "C",
    "number_of_lines_added_for_mitigation": "8",
    "number_of_lines_deleted_vulnerable_to_cve": "8",
    "vulnerable_lines": [
        "// Line_Reference 773: \tif (!inode->i_op->set_acl || !IS_POSIXACL(inode))",
        "// Line_Reference 774: \t\treturn nfserr_attrnotsupp;",
        "// Line_Reference 775: ",
        "// Line_Reference 785: \thost_error = inode->i_op->set_acl(inode, pacl, ACL_TYPE_ACCESS);",
        "// Line_Reference 787: \t\tgoto out_release;",
        "// Line_Reference 790: \t\thost_error = inode->i_op->set_acl(inode, dpacl,",
        "// Line_Reference 791: \t\t\t\t\t\t  ACL_TYPE_DEFAULT);",
        "// Line_Reference 794: out_release:"
    ]
}
