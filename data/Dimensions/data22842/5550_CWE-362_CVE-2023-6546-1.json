{
    "cve_id": "CVE-2023-6546",
    "cve_description": "A race condition was found in the GSM 0710 tty multiplexor in the Linux kernel. This issue occurs when two threads execute the GSMIOC_SETCONF ioctl on the same tty file descriptor with the gsm line discipline enabled, and can lead to a use-after-free problem on a struct gsm_dlci while restarting the gsm mux. This could allow a local unprivileged user to escalate their privileges on the system.",
    "cve_publish_date": "2023-12-21",
    "cwe_id": "CWE-362",
    "cwe_name": "Concurrent Execution using Shared Resource with Improper Synchronization ('Race Condition')",
    "cwe_description": "The product contains a code sequence that can run concurrently with other code, and the code sequence requires temporary, exclusive access to a shared resource, but a timing window exists in which the shared resource can be modified by another code sequence that is operating concurrently.",
    "commit_message": "tty: n_gsm: fix the UAF caused by race condition in gsm_cleanup_mux\n\nIn commit 9b9c8195f3f0 (\"tty: n_gsm: fix UAF in gsm_cleanup_mux\"), the UAF\nproblem is not completely fixed. There is a race condition in\ngsm_cleanup_mux(), which caused this UAF.\n\nThe UAF problem is triggered by the following race:\ntask[5046]                     task[5054]\n-----------------------        -----------------------\ngsm_cleanup_mux();\ndlci = gsm->dlci[0];\nmutex_lock(&gsm->mutex);\n                               gsm_cleanup_mux();\n\t\t\t       dlci = gsm->dlci[0]; //Didn't take the lock\ngsm_dlci_release(gsm->dlci[i]);\ngsm->dlci[i] = NULL;\nmutex_unlock(&gsm->mutex);\n                               mutex_lock(&gsm->mutex);\n\t\t\t       dlci->dead = true; //UAF\n\nFix it by assigning values after mutex_lock().\n\nLink: https://syzkaller.appspot.com/text?tag=CrashReport&x=176188b5a80000\nCc: stable <stable@kernel.org>\nFixes: 9b9c8195f3f0 (\"tty: n_gsm: fix UAF in gsm_cleanup_mux\")\nFixes: aa371e96f05d (\"tty: n_gsm: fix restart handling via CLD command\")\nSigned-off-by: Yi Yang <yiyang13@huawei.com>\nCo-developed-by: Qiumiao Zhang <zhangqiumiao1@huawei.com>\nSigned-off-by: Qiumiao Zhang <zhangqiumiao1@huawei.com>\nLink: https://lore.kernel.org/r/20230811031121.153237-1-yiyang13@huawei.com\nSigned-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>",
    "type_of_change": "Modification",
    "filename_of_changes": "n_gsm.c",
    "code_language": "C",
    "number_of_lines_added_for_mitigation": "2",
    "number_of_lines_deleted_vulnerable_to_cve": "1",
    "vulnerable_lines": [
        "// Line_Reference 3045: \tstruct gsm_dlci *dlci = gsm->dlci[0];"
    ]
}
