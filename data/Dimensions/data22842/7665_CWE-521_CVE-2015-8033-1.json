{
    "cve_id": "CVE-2015-8033",
    "cve_description": "In Textpattern 4.5.7, the password-reset feature does not securely tether a hash to a user account.",
    "cve_publish_date": "2020-08-14",
    "cwe_id": "CWE-521",
    "cwe_name": "Weak Password Requirements",
    "cwe_description": "The product does not require that users should have strong passwords, which makes it easier for attackers to compromise user accounts.",
    "commit_message": "Security improvements part 1. See Issue #565\n\n* No more emailing plaintext passwords out: password changes and reset requests are dealt with immediately on the login/admin panels.\n* Stronger cryptographic hashes for confirmation links that don't leak user ID information.\n* Hashes are securely tethered to the user account and auto-expire when logging in or generating a new request. Timeout window of 20 minutes by default for answering reset requests.\n* Password input boxes are unmaskable. Saves having a separate confirmation box, simplifies code logic and is better UX.\n* Dedicated txp_token table introduced for handling token-based storage and retrieval. Better for plugin authors than abusing txp_discuss_nonce.\n\nMore on the way including strength meter and improvements to setup passwords...",
    "type_of_change": "Modification",
    "filename_of_changes": "txp_admin.php",
    "code_language": "PHP",
    "number_of_lines_added_for_mitigation": "9",
    "number_of_lines_deleted_vulnerable_to_cve": "28",
    "vulnerable_lines": [
        "// Line_Reference 135:     extract(psa(array('new_pass', 'mail_password')));",
        "// Line_Reference 146:         $message = gTxt('password_changed');",
        "// Line_Reference 147: ",
        "// Line_Reference 148:         if ($mail_password) {",
        "// Line_Reference 149:             $email = fetch('email', 'txp_users', 'name', $txp_user);",
        "// Line_Reference 150: ",
        "// Line_Reference 151:             send_new_password($new_pass, $email, $txp_user);",
        "// Line_Reference 152: ",
        "// Line_Reference 153:             $message .= sp.gTxt('and_mailed_to').sp.$email;",
        "// Line_Reference 154:         }",
        "// Line_Reference 155: ",
        "// Line_Reference 156:         $message .= '.';",
        "// Line_Reference 157: ",
        "// Line_Reference 244:             fInput('password', 'new_pass', '', '', '', '', INPUT_REGULAR, '', 'new_pass'),",
        "// Line_Reference 248:             checkbox('mail_password', '1', true, '', 'mail_password').",
        "// Line_Reference 249:             n.tag(gTxt('mail_it'), 'label', array('for' => 'mail_password')), array('class' => 'edit-admin-mail-password')).",
        "// Line_Reference 717:                 $passwd = generate_password(PASSWORD_LENGTH);",
        "// Line_Reference 718: ",
        "// Line_Reference 719:                 if (change_user_password($name, $passwd)) {",
        "// Line_Reference 720:                     $email = safe_field(\"email\", 'txp_users', \"name = '\".doSlash($name).\"'\");",
        "// Line_Reference 721: ",
        "// Line_Reference 722:                     if (send_new_password($passwd, $email, $name)) {",
        "// Line_Reference 723:                         $changed[] = $name;",
        "// Line_Reference 724:                         $msg = 'author_updated';",
        "// Line_Reference 725:                     } else {",
        "// Line_Reference 726:                         return author_list(array(gTxt('could_not_mail').' '.txpspecialchars($name), E_ERROR));",
        "// Line_Reference 727:                     }",
        "// Line_Reference 728:                 }"
    ]
}
