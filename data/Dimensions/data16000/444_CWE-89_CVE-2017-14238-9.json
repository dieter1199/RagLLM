{
    "cve_id": "CVE-2017-14238",
    "cve_description": "SQL injection vulnerability in admin/menus/edit.php in Dolibarr ERP/CRM version 6.0.0 allows remote attackers to execute arbitrary SQL commands via the menuId parameter.",
    "cve_publish_date": "2017-09-11",
    "cwe_id": "CWE-89",
    "cwe_name": "Improper Neutralization of Special Elements used in an SQL Command ('SQL Injection')",
    "cwe_description": "The product constructs all or part of an SQL command using externally-influenced input from an upstream component, but it does not neutralize or incorrectly neutralizes special elements that could modify the intended SQL command when it is sent to a downstream component. Without sufficient removal or quoting of SQL syntax in user-controllable inputs, the generated SQL query can cause those inputs to be interpreted as SQL instead of ordinary user data.",
    "commit_message": "FIX Security fixes (filter onload js, less verbose error message in\ndownload and viewimage, show info to encourage dolibarr_main_prod=1)",
    "type_of_change": "Modification",
    "filename_of_changes": "edit.php",
    "code_language": "PHP",
    "number_of_lines_added_for_mitigation": "51",
    "number_of_lines_deleted_vulnerable_to_cve": "52",
    "vulnerable_lines": [
        "// Line_Reference 86: ",
        "// Line_Reference 88:         $result=$menu->fetch($_POST['menuId']);",
        "// Line_Reference 91:             $menu->titre=$_POST['titre'];",
        "// Line_Reference 92:             $menu->leftmenu=$_POST['leftmenu'];",
        "// Line_Reference 93:             $menu->url=$_POST['url'];",
        "// Line_Reference 94:             $menu->langs=$_POST['langs'];",
        "// Line_Reference 95:             $menu->position=$_POST['position'];",
        "// Line_Reference 96:             $menu->enabled=$_POST['enabled'];",
        "// Line_Reference 97:             $menu->perms=$_POST['perms'];",
        "// Line_Reference 98:             $menu->target=$_POST['target'];",
        "// Line_Reference 99:             $menu->user=$_POST['user'];",
        "// Line_Reference 100:             if (is_numeric($_POST['menuIdParent']))",
        "// Line_Reference 102:             \t$menu->fk_menu=$_POST['menuIdParent'];",
        "// Line_Reference 106:     \t       \tif ($_POST['type'] == 'top') $menu->fk_menu=0;",
        "// Line_Reference 126:         $_GET[\"menuId\"] = $_POST['menuId'];",
        "// Line_Reference 151:     if (! empty($_POST['menuId']) && ! is_numeric($_POST['menuId']))",
        "// Line_Reference 153: \t    $tmp=explode('&',$_POST['menuId']);",
        "// Line_Reference 200:     if (! $error && empty($_POST['menuId']) && $_POST['type'] == 'left')",
        "// Line_Reference 210:         $menu->menu_handler=preg_replace('/_menu$/','',$_POST['menu_handler']);",
        "// Line_Reference 211:         $menu->type=$_POST['type'];",
        "// Line_Reference 212:         $menu->titre=$_POST['titre'];",
        "// Line_Reference 213:         $menu->url=$_POST['url'];",
        "// Line_Reference 214:         $menu->langs=$_POST['langs'];",
        "// Line_Reference 215:         $menu->position=$_POST['position'];",
        "// Line_Reference 216:         $menu->enabled=$_POST['enabled'];",
        "// Line_Reference 217:         $menu->perms=$_POST['perms'];",
        "// Line_Reference 218:         $menu->target=$_POST['target'];",
        "// Line_Reference 219:         $menu->user=$_POST['user'];",
        "// Line_Reference 220:         if (is_numeric($_POST['menuId']))",
        "// Line_Reference 222:         \t$menu->fk_menu=$_POST['menuId'];",
        "// Line_Reference 226: \t       \tif ($_POST['type'] == 'top') $menu->fk_menu=0;",
        "// Line_Reference 235:             header(\"Location: \".DOL_URL_ROOT.\"/admin/menus/index.php?menu_handler=\".$_POST['menu_handler']);",
        "// Line_Reference 308: ",
        "// Line_Reference 309:     print '<form action=\"./edit.php?action=add&menuId='.$_GET['menuId'].'\" method=\"post\" name=\"formmenucreate\">';",
        "// Line_Reference 313: ",
        "// Line_Reference 317:     $parent_rowid = $_GET['menuId'];",
        "// Line_Reference 318:     if ($_GET['menuId'])",
        "// Line_Reference 378:         print '<td><input type=\"text\" size=\"48\" id=\"menuId\" name=\"menuId\" value=\"'.($_POST[\"menuId\"]?$_POST[\"menuId\"]:'').'\"></td>';",
        "// Line_Reference 385:     print '<tr><td class=\"fieldrequired\">'.$langs->trans('Title').'</td><td><input type=\"text\" size=\"30\" name=\"titre\" value=\"'.$_POST[\"titre\"].'\"></td><td>'.$langs->trans('DetailTitre').'</td></tr>';",
        "// Line_Reference 388:     print '<tr><td class=\"fieldrequired\">'.$langs->trans('URL').'</td><td><input type=\"text\" size=\"60\" name=\"url\" value=\"'.$_POST[\"url\"].'\"></td><td>'.$langs->trans('DetailUrl').'</td></tr>';",
        "// Line_Reference 394:     print '<tr><td>'.$langs->trans('Position').'</td><td><input type=\"text\" size=\"5\" name=\"position\" value=\"'.(isset($_POST[\"position\"])?$_POST[\"position\"]:100).'\"></td><td>'.$langs->trans('DetailPosition').'</td></tr>';",
        "// Line_Reference 398:     print '<option value=\"\"'.($menu->target==\"\"?' selected':'').'>'.$langs->trans('').'</option>';",
        "// Line_Reference 403:     print '<tr><td>'.$langs->trans('Enabled').'</td><td><input type=\"text\" size=\"60\" name=\"enabled\" value=\"'.$_POST[\"enabled\"].'\"></td><td>'.$langs->trans('DetailEnabled').'</td></tr>';",
        "// Line_Reference 406:     print '<tr><td>'.$langs->trans('Rights').'</td><td><input type=\"text\" size=\"60\" name=\"perms\" value=\"'.$_POST[\"perms\"].'\"></td><td>'.$langs->trans('DetailRight').'</td></tr>';",
        "// Line_Reference 411: ",
        "// Line_Reference 429:     print '<input type=\"hidden\" name=\"menuId\" value=\"'.$_GET['menuId'].'\">';",
        "// Line_Reference 432: ",
        "// Line_Reference 436:     $result=$menu->fetch($_GET['menuId']);",
        "// Line_Reference 475:     print '<tr><td class=\"fieldrequired\">'.$langs->trans('Title').'</td><td><input type=\"text\" size=\"30\" name=\"titre\" value=\"'.$menu->titre.'\"></td><td>'.$langs->trans('DetailTitre').'</td></tr>';",
        "// Line_Reference 481:     print '<tr><td>'.$langs->trans('LangFile').'</td><td><input type=\"text\" size=\"30\" name=\"langs\" value=\"'.$menu->langs.'\"></td><td>'.$langs->trans('DetailLangs').'</td></tr>';",
        "// Line_Reference 488:     print '<option value=\"\"'.($menu->target==\"\"?' selected':'').'>'.$langs->trans('').'</option>';",
        "// Line_Reference 505: "
    ]
}
