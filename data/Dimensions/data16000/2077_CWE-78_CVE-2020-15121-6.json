{
    "cve_id": "CVE-2020-15121",
    "cve_description": "In radare2 before version 4.5.0, malformed PDB file names in the PDB server path cause shell injection. To trigger the problem it's required to open the executable in radare2 and run idpd to trigger the download. The shell code will execute, and will create a file called pwned in the current directory.",
    "cve_publish_date": "2020-07-20",
    "cwe_id": "CWE-78",
    "cwe_name": "Improper Neutralization of Special Elements used in an OS Command ('OS Command Injection')",
    "cwe_description": "The product constructs all or part of an OS command using externally-influenced input from an upstream component, but it does not neutralize or incorrectly neutralizes special elements that could modify the intended OS command when it is sent to a downstream component.",
    "commit_message": "Fix command injection on PDB download (#16966)\n\n* Fix r_sys_mkdirp with absolute path on Windows\r\n* Fix build with --with-openssl\r\n* Use RBuffer in r_socket_http_answer()\r\n* r_socket_http_answer: Fix read for big responses\r\n* Implement r_str_escape_sh()\r\n* Cleanup r_socket_connect() on Windows\r\n* Fix socket being created without a protocol\r\n* Fix socket connect with SSL ##socket\r\n* Use select() in r_socket_ready()\r\n* Fix read failing if received only protocol answer\r\n* Fix double-free\r\n* r_socket_http_get: Fail if req. SSL with no support\r\n* Follow redirects in r_socket_http_answer()\r\n* Fix r_socket_http_get result length with R2_CURL=1\r\n* Also follow redirects\r\n* Avoid using curl for downloading PDBs\r\n* Use r_socket_http_get() on UNIXs\r\n* Use WinINet API on Windows for r_socket_http_get()\r\n* Fix command injection\r\n* Fix r_sys_cmd_str_full output for binary data\r\n* Validate GUID on PDB download\r\n* Pass depth to socket_http_get_recursive()\r\n* Remove 'r_' and '__' from static function names\r\n* Fix is_valid_guid\r\n* Fix for comments",
    "type_of_change": "Modification",
    "filename_of_changes": "sys.c",
    "code_language": "C",
    "number_of_lines_added_for_mitigation": "28",
    "number_of_lines_deleted_vulnerable_to_cve": "9",
    "vulnerable_lines": [
        "// Line_Reference 683: \t\t\t\tif (!(bytes = read (sh_out[0], buffer, sizeof (buffer)-1))) {",
        "// Line_Reference 686: \t\t\t\tbuffer[sizeof (buffer) - 1] = '\\0';",
        "// Line_Reference 687: \t\t\t\tif (len) {",
        "// Line_Reference 688: \t\t\t\t\t*len += bytes;",
        "// Line_Reference 690: \t\t\t\toutputptr = r_str_append (outputptr, buffer);",
        "// Line_Reference 692: \t\t\t\tif (!read (sh_err[0], buffer, sizeof (buffer)-1)) {",
        "// Line_Reference 695: \t\t\t\tbuffer[sizeof (buffer) - 1] = '\\0';",
        "// Line_Reference 696: \t\t\t\t*sterr = r_str_append (*sterr, buffer);",
        "// Line_Reference 832: \t\t\tptr = p + 2;"
    ]
}
