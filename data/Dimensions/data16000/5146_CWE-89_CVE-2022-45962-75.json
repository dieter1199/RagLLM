{
    "cve_id": "CVE-2022-45962",
    "cve_description": "Open Solutions for Education, Inc openSIS Community Edition v8.0 and earlier is vulnerable to SQL Injection via CalendarModal.php.",
    "cve_publish_date": "2023-02-13",
    "cwe_id": "CWE-89",
    "cwe_name": "Improper Neutralization of Special Elements used in an SQL Command ('SQL Injection')",
    "cwe_description": "The product constructs all or part of an SQL command using externally-influenced input from an upstream component, but it does not neutralize or incorrectly neutralizes special elements that could modify the intended SQL command when it is sent to a downstream component. Without sufficient removal or quoting of SQL syntax in user-controllable inputs, the generated SQL query can cause those inputs to be interpreted as SQL instead of ordinary user data.",
    "commit_message": "Version 9.0 release\n\nOlder version shifted to branch: Version_8.0",
    "type_of_change": "ModificationType.ADD",
    "filename_of_changes": "InputFinalGrades.php",
    "code_language": "PHP",
    "number_of_lines_added_for_mitigation": "54",
    "number_of_lines_deleted_vulnerable_to_cve": "20",
    "vulnerable_lines": [
        "// Line_Reference 212:                         $total_weightage = '';",
        "// Line_Reference 271:                                 $total1 += (round($tot_weight_grade, 2)) * ($programconfig[User('STAFF_ID')][$prefix . $mp1] / 100);",
        "// Line_Reference 292: ",
        "// Line_Reference 293: ",
        "// Line_Reference 294:                             $import_RET[$student_id] = array(1 => array('REPORT_CARD_GRADE_ID' => _makeLetterGrade($tot_weight_grade/$total_weightage, $course_period_id, 0, 'ID'), 'GRADE_PERCENT' => _makeLetterGrade($tot_weight_grade / $total_weightage, $course_period_id, User('STAFF_ID'), '%') . '%'));",
        "// Line_Reference 394:                     $RET = DBGet(DBQuery('SELECT MARKING_PERIOD_ID,\\'Y\\' AS DOES_GRADES,NULL AS DOES_EXAM FROM school_quarters WHERE SEMESTER_ID=\\'' . $_REQUEST['mp'] . '\\' UNION SELECT MARKING_PERIOD_ID,NULL AS DOES_GRADES,DOES_EXAM FROM school_semesters WHERE MARKING_PERIOD_ID=\\'' . $_REQUEST[mp] . '\\''));",
        "// Line_Reference 504:                     $points_RET = DBGet(DBQuery('SELECT DISTINCT s.STUDENT_ID,gt.ASSIGNMENT_TYPE_ID,  gt.ASSIGNMENT_TYPE_ID,sum(' . db_case(array('gg.POINTS', \"'-1'\", \"'0'\", 'gg.POINTS')) . ') AS PARTIAL_POINTS,sum(' . db_case(array('gg.POINTS', '\\'-1\\' OR (ga.due_date <  (select DISTINCT ssm.start_date  from student_enrollment ssm where ssm.STUDENT_ID=s.STUDENT_ID AND ssm.SYEAR=\\'' . UserSyear() . '\\' AND ssm.SCHOOL_ID=' . UserSchool() . ' AND (ssm.START_DATE IS NOT NULL AND (CURRENT_DATE<=ssm.END_DATE OR CURRENT_DATE>=ssm.END_DATE OR  ssm.END_DATE IS NULL)) order by ssm.start_date desc limit 1",
        "// Line_Reference 507:                     $points_RET = DBGet(DBQuery('SELECT DISTINCT  s.STUDENT_ID,\\'-1\\' AS ASSIGNMENT_TYPE_ID,sum(' . db_case(array('gg.POINTS', \"'-1'\", \"'0'\", 'gg.POINTS')) . ') AS PARTIAL_POINTS,sum(' . db_case(array('gg.POINTS', '\\'-1\\' OR (ga.due_date <  (select DISTINCT ssm.start_date  from student_enrollment ssm where ssm.STUDENT_ID=s.STUDENT_ID AND ssm.SYEAR=\\'' . UserSyear() . '\\' AND ssm.SCHOOL_ID=' . UserSchool() . ' AND (ssm.START_DATE IS NOT NULL AND (CURRENT_DATE<=ssm.END_DATE OR CURRENT_DATE>=ssm.END_DATE OR  ssm.END_DATE IS NULL)) order by ssm.start_date desc limit 1",
        "// Line_Reference 802:                 $sql .= ',COURSE_TITLE=\\'' . $course_RET[1]['COURSE_NAME'] . '\\'';",
        "// Line_Reference 836:                     $sql .= ',COURSE_TITLE=\\'' . $course_RET[1]['COURSE_NAME'] . '\\'';",
        "// Line_Reference 876:             $id = DBGet(DBQuery(\"SHOW TABLE STATUS LIKE 'student_report_card_grades'\"));",
        "// Line_Reference 877:             $grade_id[1]['ID'] = $id[1]['AUTO_INCREMENT'];",
        "// Line_Reference 878:             $ngrade_id = $grade_id[1]['ID'];",
        "// Line_Reference 900:                     \\'' . singleQuoteReplace('', '', clean_param($columns['comment'], PARAM_NOTAGS)) . '\\',\\'' . $grades_RET[$grade][1]['TITLE'] . '\\',\\'' . $WEIGHTED_GP . '\\',\\'' . $UNWEIGHTED_GP . '\\',\\'' . $course_RET[1]['COURSE_NAME'] . '\\',\\'' . $grades_RET[$grade][1]['GP_SCALE'] . '\\',\\'' . $course_RET[1]['CREDITS'] . '\\',\\'' . $CREDIT_EARNED . '\\',\\'' . $gr_crct . '\\')';",
        "// Line_Reference 1211:     echo '<label class=\"checkbox checkbox-inline checkbox-switch switch-success switch-xs\"><INPUT type=checkbox name=include_inactive value=Y' . ($_REQUEST['include_inactive'] == 'Y' ? \" CHECKED onclick='document.location.href=\\\"\" . PreparePHP_SELF($tmp_REQUEST) . \"&include_inactive=\\\";'\" : \" onclick='document.location.href=\\\"\" . PreparePHP_SELF($tmp_REQUEST) . \"&include_inactive=Y\\\";'\") . '><span></span>'._includeInactiveStudents.':</label>';",
        "// Line_Reference 1246:                 $gb_header .= \"<li><A HREF=Modules.php?modname=$_REQUEST[modname]&include_inactive=$_REQUEST[include_inactive]&modfunc=gradebook&mp=\" . ($_REQUEST[mp] == '' ? $full_year_mp[1]['MARKING_PERIOD_ID'] : $_REQUEST[mp]) . \"&custom_cp=y&use_percents=true&period=$_REQUEST[period]>\"._getGradebookGrades.\"</A></li>\";",
        "// Line_Reference 1571:                 return '<TABLE border=0 cellspacing=0 cellpadding=0 class=LO_field><TR><TD><font size=-1>' . (rtrim(rtrim($value, '0'), '.') + 0) . '</font></TD><TD><font size=-1>&nbsp;/&nbsp;</font></TD><TD><font size=-1>' . $THIS_RET['TOTAL_POINTS'] . '</font></TD></TR></TABLE>';",
        "// Line_Reference 1576:             return '<TABLE border=0 cellspacing=0 cellpadding=0 class=LO_field><TR><TD><font size=-1>' . (rtrim(rtrim($value, '0'), '.') + 0) . '</font></TD><TD><font size=-1>&nbsp;/&nbsp;</font></TD><TD><font size=-1>' . $THIS_RET['TOTAL_POINTS'] . '</font></TD></TR></TABLE>';",
        "// Line_Reference 1596: ",
        "// Line_Reference 1597: ?>"
    ]
}
