$tables = $tableNames = $faqConfig->getDb()->getTableNames(Database::getTablePrefix());
$tablePrefix = (Database::getTablePrefix() !== '') ? Database::getTablePrefix() . '.phpmyfaq' : 'phpmyfaq';
$majorVersion = substr($faqConfig->getVersion(), 0, 3);
$text[] = '-- pmf' . $majorVersion . ': ' . $tableNames;
$text[] = '-- DO NOT REMOVE THE FIRST LINE!';
$text[] = '-- pmftableprefix: ' . Database::getTablePrefix();
$text[] = '-- DO NOT REMOVE THE LINES ABOVE!';
$text[] = '-- Otherwise this backup will be broken.';
$header = sprintf(
'Content-Disposition: attachment; filename=%s',
urlencode(
sprintf(
'%s-data.%s.sql',
$tablePrefix,
date('Y-m-d-H-i-s')
)
)
);
$httpHelper->addExtraHeader($header);
foreach (explode(' ', $tableNames) as $table) {
echo implode("\r\n", $text);
if ('' !== $table) {
$text = $dbHelper->buildInsertQueries('SELECT * FROM ' . $table, $table);
}
$header = sprintf(
'Content-Disposition: attachment; filename=%s',
urlencode(
sprintf(
'%s-logs.%s.sql',
$tablePrefix,
date('Y-m-d-H-i-s')
)
)
);
$httpHelper->addExtraHeader($header);
foreach (explode(' ', $tableNames) as $table) {
echo implode("\r\n", $text);
if ('' !== $table) {
$text = $dbHelper->buildInsertQueries('SELECT * FROM ' . $table, $table);
}
