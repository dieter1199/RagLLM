import org.apache.commons.lang.time.DateUtils;
public class SaveActionTest
this.saveAction = new SaveAction();
context = oldcore.getXWikiContext();
xWiki = mock(XWiki.class);
context.setWiki(this.xWiki);
mockRequest = mock(XWikiRequest.class);
context.setRequest(mockRequest);
mockResponse = mock(XWikiResponse.class);
context.setResponse(mockResponse);
mockDocument = mock(XWikiDocument.class);
context.setDoc(mockDocument);
mockClonedDocument = mock(XWikiDocument.class);
when(mockDocument.clone()).thenReturn(mockClonedDocument);
mockForm = mock(EditForm.class);
context.setForm(mockForm);
context.setUserReference(USER_REFERENCE);
assertArrayEquals(new Object[] { "Foo.Bar" }, (Object[]) context.get("messageParameters"));
verify(mockClonedDocument).readFromTemplate("", this.context);
verify(this.xWiki).checkSavingDocument(eq(USER_REFERENCE), any(XWikiDocument.class), eq(""),
eq(false), eq(this.context));
* This tests aims at checking the usecase when uploading an image in the WYSIWYG editor before the first save
* and saving afterwards.
verify(mockClonedDocument).readFromTemplate("", this.context);
