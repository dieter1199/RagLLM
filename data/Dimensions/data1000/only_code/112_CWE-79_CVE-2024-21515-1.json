if (isset($this->request->get['route']) && $this->request->get['route'] != 'common/login') {
$args = $this->request->get;
$route = $args['route'];
unset($args['route']);
unset($args['user_token']);
$url = '';
$url .= http_build_query($args);
$data['redirect'] = $this->url->link($route, $url);
} else {
$data['redirect'] = '';
}
if ($this->request->post['redirect'] && str_starts_with(html_entity_decode($this->request->post['redirect'], ENT_QUOTES, 'UTF-8'), HTTP_SERVER)) {
$json['redirect'] = html_entity_decode($this->request->post['redirect'], ENT_QUOTES, 'UTF-8') . '&user_token=' . $this->session->data['user_token'];
} else {
$json['redirect'] = $this->url->link('common/dashboard', 'user_token=' . $this->session->data['user_token'], true);
}
