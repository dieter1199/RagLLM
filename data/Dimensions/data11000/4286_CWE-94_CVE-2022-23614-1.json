{
    "cve_id": "CVE-2022-23614",
    "cve_description": "Twig is an open source template language for PHP. When in a sandbox mode, the `arrow` parameter of the `sort` filter must be a closure to avoid attackers being able to run arbitrary PHP functions. In affected versions this constraint was not properly enforced and could lead to code injection of arbitrary PHP code. Patched versions now disallow calling non Closure in the `sort` filter as is the case for some other filters. Users are advised to upgrade.",
    "cve_publish_date": "2022-02-04",
    "cwe_id": "CWE-94",
    "cwe_name": "Improper Control of Generation of Code ('Code Injection')",
    "cwe_description": "The product constructs all or part of a code segment using externally-influenced input from an upstream component, but it does not neutralize or incorrectly neutralizes special elements that could modify the syntax or behavior of the intended code segment.",
    "commit_message": "Disallow non closures in `sort` filter when the sanbox mode is enabled",
    "type_of_change": "Modification",
    "filename_of_changes": "CoreExtension.php",
    "code_language": "PHP",
    "number_of_lines_added_for_mitigation": "14",
    "number_of_lines_deleted_vulnerable_to_cve": "11",
    "vulnerable_lines": [
        "// Line_Reference 240:             new TwigFilter('sort', 'twig_sort_filter'),",
        "// Line_Reference 929: function twig_sort_filter($array, $arrow = null)",
        "// Line_Reference 1609:     if (!$arrow instanceof Closure && $env->hasExtension('\\Twig\\Extension\\SandboxExtension') && $env->getExtension('\\Twig\\Extension\\SandboxExtension')->isSandboxed()) {",
        "// Line_Reference 1610:         throw new RuntimeError('The callable passed to \"filter\" filter must be a Closure in sandbox mode.');",
        "// Line_Reference 1611:     }",
        "// Line_Reference 1623:     if (!$arrow instanceof Closure && $env->hasExtension('\\Twig\\Extension\\SandboxExtension') && $env->getExtension('\\Twig\\Extension\\SandboxExtension')->isSandboxed()) {",
        "// Line_Reference 1624:         throw new RuntimeError('The callable passed to the \"map\" filter must be a Closure in sandbox mode.');",
        "// Line_Reference 1625:     }",
        "// Line_Reference 1637:     if (!$arrow instanceof Closure && $env->hasExtension('\\Twig\\Extension\\SandboxExtension') && $env->getExtension('\\Twig\\Extension\\SandboxExtension')->isSandboxed()) {",
        "// Line_Reference 1638:         throw new RuntimeError('The callable passed to the \"reduce\" filter must be a Closure in sandbox mode.');",
        "// Line_Reference 1639:     }"
    ]
}
