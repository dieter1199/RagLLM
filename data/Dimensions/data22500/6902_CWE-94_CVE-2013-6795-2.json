{
    "cve_id": "CVE-2013-6795",
    "cve_description": "The Updater in Rackspace Openstack Windows Guest Agent for XenServer before 1.2.6.0 allows remote attackers to execute arbitrary code via a crafted serialized .NET object to TCP port 1984, which triggers the download and extraction of a ZIP file that overwrites the Agent service binary.",
    "cve_publish_date": "2013-12-24",
    "cwe_id": "CWE-94",
    "cwe_name": "Improper Control of Generation of Code ('Code Injection')",
    "cwe_description": "The product constructs all or part of a code segment using externally-influenced input from an upstream component, but it does not neutralize or incorrectly neutralizes special elements that could modify the syntax or behavior of the intended code segment.",
    "commit_message": "Updated the agent and updater to use IPC communications rather than TCP.  Altered the updater update command to make it more resilient and updated the version number for a new build.",
    "type_of_change": "Modification",
    "filename_of_changes": "AgentUpdateMessageSender.cs",
    "code_language": "C#",
    "number_of_lines_added_for_mitigation": "71",
    "number_of_lines_deleted_vulnerable_to_cve": "35",
    "vulnerable_lines": [
        "// Line_Reference 16: using System;",
        "// Line_Reference 17: using Rackspace.Cloud.Server.Agent.Configuration;",
        "// Line_Reference 18: using Rackspace.Cloud.Server.Agent.Interfaces;",
        "// Line_Reference 19: using Rackspace.Cloud.Server.Common.AgentUpdate;",
        "// Line_Reference 20: using Rackspace.Cloud.Server.Common.Communication;",
        "// Line_Reference 21: using Rackspace.Cloud.Server.Common.Configuration;",
        "// Line_Reference 22: ",
        "// Line_Reference 23: namespace Rackspace.Cloud.Server.Agent {",
        "// Line_Reference 24:     public class AgentUpdateMessageSender : IAgentUpdateMessageSender {",
        "// Line_Reference 25:         public void Send(AgentUpdateInfo agentUpdateInfo) {",
        "// Line_Reference 26:             IAgentUpdater agentUpdater;",
        "// Line_Reference 27:             try {",
        "// Line_Reference 28:                 ConnectToRemotingHost(out agentUpdater);",
        "// Line_Reference 29:                 agentUpdater.DoUpdate(agentUpdateInfo);",
        "// Line_Reference 30:             }",
        "// Line_Reference 31:             catch (Exception ex) {",
        "// Line_Reference 32:                 throw new UnsuccessfulCommandExecutionException(",
        "// Line_Reference 33:                     String.Format(\"UPDATE FAILED: {0}\", ex.Message),",
        "// Line_Reference 34:                     new ExecutableResult { ExitCode = \"1\" });",
        "// Line_Reference 35:             }",
        "// Line_Reference 36:         }",
        "// Line_Reference 37: ",
        "// Line_Reference 38:         private void ConnectToRemotingHost(out IAgentUpdater agentUpdater) {",
        "// Line_Reference 39:             agentUpdater = (IAgentUpdater)Activator.GetObject(typeof(IAgentUpdater), BuildRemotingUri());",
        "// Line_Reference 40:         }",
        "// Line_Reference 41: ",
        "// Line_Reference 42:         private string BuildRemotingUri()",
        "// Line_Reference 43:         {",
        "// Line_Reference 44:             return String.Format(\"tcp://{0}:{1}/{2}\",",
        "// Line_Reference 45:                                  SvcConfiguration.RemotingUriHost,",
        "// Line_Reference 46:                                  SvcConfiguration.RemotingPort,",
        "// Line_Reference 47:                                  SvcConfiguration.RemotingUri);",
        "// Line_Reference 48:         }",
        "// Line_Reference 49:     }",
        "// Line_Reference 50: }"
    ]
}
