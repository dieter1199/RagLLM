{
    "cve_id": "CVE-2022-4366",
    "cve_description": "Missing Authorization in GitHub repository lirantal/daloradius prior to master branch.",
    "cve_publish_date": "2022-12-08",
    "cwe_id": "CWE-862",
    "cwe_name": "Missing Authorization",
    "cwe_description": "The product does not perform an authorization check when an actor attempts to access a resource or perform an action.",
    "commit_message": "fix: introduced security fixes (#263)\n\n- dologin.php - validating user input and introduced CSRF token check\r\n- logging.php - preventing direct access to this file, which means redirecting to index.php when directly hitting this include file, (repeated for other exten. / include / etc. files), and optimized logging features\r\n- actionMessages.php and errorHandling.php same as logging.php\r\n- library/exten-* files - preventing direct access to these files, generalized the approach of looking for known file locations, improved user input validation (params such as limit, etc.), improved output (escaping logfile output, etc.)\r\n- in library/exten-server_info.php - i also have added new commands for retrieving network information and system distro/version\r\n- opendb.php - general code optimization (TODO prevent direct access to this file)\r\n- sessions.php - introduced new session handling (TODO prevent direct access to this file)\r\n- login.php - removed the default username hardcoded in the form, added the csrf_token\r\n- rep-* - user input validation, code optimization",
    "type_of_change": "Modification",
    "filename_of_changes": "exten-daloradius_log.php",
    "code_language": "PHP",
    "number_of_lines_added_for_mitigation": "45",
    "number_of_lines_deleted_vulnerable_to_cve": "47",
    "vulnerable_lines": [
        "// Line_Reference 18:  *\t\tthis script displays the daloradius log file ofcourse",
        "// Line_Reference 19:  *\t\tproper premissions must be applied on the log file for the web",
        "// Line_Reference 20:  *\t\tserver to be able to read it",
        "// Line_Reference 22:  * Authors:\tLiran Tal <liran@enginx.com>",
        "// Line_Reference 28: if (isset($configValues['CONFIG_LOG_FILE'])) {",
        "// Line_Reference 29: \t$logfile = $configValues['CONFIG_LOG_FILE'];",
        "// Line_Reference 30: ",
        "// Line_Reference 31: \tif (!file_exists($logfile)) {",
        "// Line_Reference 32: ",
        "// Line_Reference 33:                 $failureMsg = \"error reading log file: <b>$logfile</b><br/>\".",
        "// Line_Reference 34: \t\t\t\t\"looked for log file in $logfile but couldn't find it.<br/>\".",
        "// Line_Reference 35: \t\t\t\t\"if you know where your daloradius log file is located, set it's location in your library/daloradius.conf file\";",
        "// Line_Reference 36: \t} else {",
        "// Line_Reference 37: ",
        "// Line_Reference 38: ",
        "// Line_Reference 39: \t\tif (is_readable($logfile) == false) {",
        "// Line_Reference 41: \t                $failureMsg = \"error reading log file: <b>$logfile</b><br/>\".",
        "// Line_Reference 42: \t\t\t\t\"possible cause is file premissions or file doesn't exist.<br/>\";",
        "// Line_Reference 44: \t\t} else {",
        "// Line_Reference 45: \t\t    if (file_get_contents($logfile)) {",
        "// Line_Reference 46: \t\t\t\t$fileReversed = array_reverse(file($logfile));",
        "// Line_Reference 47: \t\t\t\t$counter = $daloradiusLineCount;",
        "// Line_Reference 49: \t\t\t\t// This doesn't take in any filter value",
        "// Line_Reference 50: \t\t\t\t// from the forms.",
        "// Line_Reference 51: \t\t\t\t// This takes in the log count though.",
        "// Line_Reference 52: \t\t\t\tforeach ($fileReversed as $line) {",
        "// Line_Reference 53: \t\t\t\t\tif ($counter == 0) {",
        "// Line_Reference 54: \t\t\t\t\t\tbreak;",
        "// Line_Reference 55: \t\t\t\t\t}",
        "// Line_Reference 56: \t\t\t\t\techo $line . \"<br>\";",
        "// Line_Reference 57: \t\t\t\t\t$counter--;",
        "// Line_Reference 58: \t\t\t\t}",
        "// Line_Reference 59: \t\t\t\t// Old Code",
        "// Line_Reference 60: \t\t\t\t// $counter = $daloradiusLineCount;",
        "// Line_Reference 61: \t\t\t\t// foreach ($fileReversed as $line) {",
        "// Line_Reference 62: \t\t\t\t// \tif (preg_match(\"/$daloradiusFilter/i\", $line)) {",
        "// Line_Reference 63: \t\t\t\t// \t\tif ($counter == 0)",
        "// Line_Reference 64: \t\t\t\t// \t\t\tbreak;",
        "// Line_Reference 65: \t\t\t\t// \t\t$ret = eregi_replace(\"\\n\", \"<br>\", $line);",
        "// Line_Reference 66: \t\t\t\t// \t\techo $ret;",
        "// Line_Reference 67: \t\t\t\t// \t\t$counter--;",
        "// Line_Reference 68: \t\t\t\t// \t}",
        "// Line_Reference 69: \t\t\t\t// }",
        "// Line_Reference 70: \t\t\t}",
        "// Line_Reference 71: \t\t}",
        "// Line_Reference 72: \t}",
        "// Line_Reference 74: "
    ]
}
