{
    "cve_id": "CVE-2022-45962",
    "cve_description": "Open Solutions for Education, Inc openSIS Community Edition v8.0 and earlier is vulnerable to SQL Injection via CalendarModal.php.",
    "cve_publish_date": "2023-02-13",
    "cwe_id": "CWE-89",
    "cwe_name": "Improper Neutralization of Special Elements used in an SQL Command ('SQL Injection')",
    "cwe_description": "The product constructs all or part of an SQL command using externally-influenced input from an upstream component, but it does not neutralize or incorrectly neutralizes special elements that could modify the intended SQL command when it is sent to a downstream component. Without sufficient removal or quoting of SQL syntax in user-controllable inputs, the generated SQL query can cause those inputs to be interpreted as SQL instead of ordinary user data.",
    "commit_message": "Version 9.0 release\n\nOlder version shifted to branch: Version_8.0",
    "type_of_change": "ModificationType.ADD",
    "filename_of_changes": "AdvancedReport.php",
    "code_language": "PHP",
    "number_of_lines_added_for_mitigation": "28",
    "number_of_lines_deleted_vulnerable_to_cve": "50",
    "vulnerable_lines": [
        "// Line_Reference 29: // if(isset($_SESSION['student_id']) && $_SESSION['student_id'] != '')",
        "// Line_Reference 30: // {",
        "// Line_Reference 31: //     if(clean_param($_REQUEST['modfunc'], PARAM_ALPHAMOD) == 'call')",
        "// Line_Reference 32: //     {",
        "// Line_Reference 33: //         $_REQUEST['search_modfunc'] = '';",
        "// Line_Reference 34: //     }",
        "// Line_Reference 35: //     else if(clean_param($_REQUEST['modfunc'], PARAM_ALPHAMOD) == 'save')",
        "// Line_Reference 36: //     {",
        "// Line_Reference 37: //         $_REQUEST['search_modfunc'] = 'list';",
        "// Line_Reference 38: //     }",
        "// Line_Reference 39: //     else",
        "// Line_Reference 40: //     {",
        "// Line_Reference 41: //         $_REQUEST['search_modfunc'] = 'search_mod';",
        "// Line_Reference 42: //     }",
        "// Line_Reference 43: // }",
        "// Line_Reference 44: if(isset($_SESSION['student_id'])){",
        "// Line_Reference 59:         echo \"<tr><td width=105>\" . DrawLogo() . \"</td><td style=\\\"font-size:15px; font-weight:bold; padding-top:20px;\\\">\" . GetSchool(UserSchool()) . \"<div style=\\\"font-size:12px;\\\">\"._studentAdvancedReport.\"</div></td><td align=right style=\\\"padding-top:20px;\\\">\" . ProperDate(DBDate()) . \"<br />\"._studentAdvancedReport.\"</td></tr><tr><td colspan=3 style=\\\"border-top:1px solid #333;\\\">&nbsp;</td></tr></table>\";",
        "// Line_Reference 65:     if(isset($_SESSION['student_id'])){",
        "// Line_Reference 66:         $_SESSION['st_arr'] = Array(\"0\" => $_SESSION['student_id']);",
        "// Line_Reference 67:     }else{",
        "// Line_Reference 70: ",
        "// Line_Reference 90:     $extra['search'] .= '<div class=\"form-group\"><label>'._includeCoursesActiveAsOf.'</label>' . DateInputAY('', 'include_active_date', 1) . '</div>';",
        "// Line_Reference 93:     echo '<BR><CENTER><INPUT type=submit value=\\''._createReportForSelectedStudents.'\\' class=\"btn btn-primary\"></CENTER>';",
        "// Line_Reference 105:     echo '<h5 class=\"modal-title\">'._chooseCourse.'</h5>';",
        "// Line_Reference 117:     echo '<h6>' . count($subjects_RET) . ((count($subjects_RET) == 1) ? ' '._subjectWas : ' '._subjectsWere) . ' '._found.'.</h6>';",
        "// Line_Reference 119:         echo '<table class=\"table table-bordered\"><thead><tr class=\"alpha-grey\"><th>'._subject.'</th></tr></thead><tbody>';",
        "// Line_Reference 143:     echo '<h5 class=\"modal-title\">'._chooseCourse.'</h5>';",
        "// Line_Reference 155:     echo count($subjects_RET) . ((count($subjects_RET) == 1) ? ' '._subjectWas : ' '._subjectsWere) . ' found.<br>';",
        "// Line_Reference 157:         echo '<table class=\"table table-bordered\"><thead><tr class=\"alpha-grey\"><th>'._subject.'</th></tr></thead><tbody>';",
        "// Line_Reference 174:     DrawBC(\"\"._students.\" > \" . ProgramTitle());",
        "// Line_Reference 179:         $extra['link'] = array('FULL_NAME' =>false);",
        "// Line_Reference 182: //        $extra['SELECT'] = \",CONCAT('<INPUT type=checkbox name=st_arr[] value=',s.STUDENT_ID,' checked>') AS CHECKBOX\";",
        "// Line_Reference 206:         $extra['search'] .= '<div class=\"form-group\"><label class=\"control-label col-lg-4\">'._includeCoursesActiveAsOf.' </label><div class=\"col-lg-8\">' . DateInputAY('', 'include_active_date', 2) . '</div></div>';",
        "// Line_Reference 216:             echo '<div class=\"text-right p-b-20 p-r-20\"><INPUT type=submit value=\\''._createReportForSelectedStudents.'\\' class=\"btn btn-primary\"></div>';",
        "// Line_Reference 222: ",
        "// Line_Reference 231:         $extra['search'] .= '<div class=\"form-group\"><label class=\"control-label col-lg-4 text-right\">'._includeCoursesActiveAsOf.' </label><div class=\"col-lg-8\">' . DateInputAY('', 'include_active_date', 3) . '</div></div>';",
        "// Line_Reference 232: ",
        "// Line_Reference 234: ",
        "// Line_Reference 243: ",
        "// Line_Reference 246: ",
        "// Line_Reference 247: ",
        "// Line_Reference 248: ",
        "// Line_Reference 250: ",
        "// Line_Reference 255: function _makeChooseCheckbox($value, $title) {",
        "// Line_Reference 257:     // return '<INPUT type=checkbox name=st_arr[] value=' . $value . ' checked>';",
        "// Line_Reference 258: ",
        "// Line_Reference 259:     // return \"<input name=unused[$THIS_RET[STUDENT_ID]] value=\" . $THIS_RET[STUDENT_ID] . \"  type='checkbox' id=$THIS_RET[STUDENT_ID] onClick='setHiddenCheckboxStudents(\\\"st_arr[]\\\",this,$THIS_RET[STUDENT_ID]);' />\";",
        "// Line_Reference 260: ",
        "// Line_Reference 261:     return \"<input  class='student_label_cbx' name=unused[$THIS_RET[STUDENT_ID]] value=\" . $THIS_RET[STUDENT_ID] . \"  type='checkbox' id=$THIS_RET[STUDENT_ID] onClick='setHiddenCheckboxStudents(\\\"st_arr[]\\\",this,$THIS_RET[STUDENT_ID]);' />\";",
        "// Line_Reference 263: ?>"
    ]
}
