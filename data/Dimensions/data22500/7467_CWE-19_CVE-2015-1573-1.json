{
    "cve_id": "CVE-2015-1573",
    "cve_description": "The nft_flush_table function in net/netfilter/nf_tables_api.c in the Linux kernel before 3.18.5 mishandles the interaction between cross-chain jumps and ruleset flushes, which allows local users to cause a denial of service (panic) by leveraging the CAP_NET_ADMIN capability.",
    "cve_publish_date": "2016-05-02",
    "cwe_id": "CWE-19",
    "cwe_name": "Data Processing Errors",
    "cwe_description": "Weaknesses in this category are typically found in functionality that processes data. Data processing is the manipulation of input to retrieve or save information.",
    "commit_message": "netfilter: nf_tables: fix flush ruleset chain dependencies\n\nJumping between chains doesn't mix well with flush ruleset. Rules\nfrom a different chain and set elements may still refer to us.\n\n[  353.373791] ------------[ cut here ]------------\n[  353.373845] kernel BUG at net/netfilter/nf_tables_api.c:1159!\n[  353.373896] invalid opcode: 0000 [#1] SMP\n[  353.373942] Modules linked in: intel_powerclamp uas iwldvm iwlwifi\n[  353.374017] CPU: 0 PID: 6445 Comm: 31c3.nft Not tainted 3.18.0 #98\n[  353.374069] Hardware name: LENOVO 5129CTO/5129CTO, BIOS 6QET47WW (1.17 ) 07/14/2010\n[...]\n[  353.375018] Call Trace:\n[  353.375046]  [<ffffffff81964c31>] ? nf_tables_commit+0x381/0x540\n[  353.375101]  [<ffffffff81949118>] nfnetlink_rcv+0x3d8/0x4b0\n[  353.375150]  [<ffffffff81943fc5>] netlink_unicast+0x105/0x1a0\n[  353.375200]  [<ffffffff8194438e>] netlink_sendmsg+0x32e/0x790\n[  353.375253]  [<ffffffff818f398e>] sock_sendmsg+0x8e/0xc0\n[  353.375300]  [<ffffffff818f36b9>] ? move_addr_to_kernel.part.20+0x19/0x70\n[  353.375357]  [<ffffffff818f44f9>] ? move_addr_to_kernel+0x19/0x30\n[  353.375410]  [<ffffffff819016d2>] ? verify_iovec+0x42/0xd0\n[  353.375459]  [<ffffffff818f3e10>] ___sys_sendmsg+0x3f0/0x400\n[  353.375510]  [<ffffffff810615fa>] ? native_sched_clock+0x2a/0x90\n[  353.375563]  [<ffffffff81176697>] ? acct_account_cputime+0x17/0x20\n[  353.375616]  [<ffffffff8110dc78>] ? account_user_time+0x88/0xa0\n[  353.375667]  [<ffffffff818f4bbd>] __sys_sendmsg+0x3d/0x80\n[  353.375719]  [<ffffffff81b184f4>] ? int_check_syscall_exit_work+0x34/0x3d\n[  353.375776]  [<ffffffff818f4c0d>] SyS_sendmsg+0xd/0x20\n[  353.375823]  [<ffffffff81b1826d>] system_call_fastpath+0x16/0x1b\n\nRelease objects in this order: rules -> sets -> chains -> tables, to\nmake sure no references to chains are held anymore.\n\nReported-by: Asbjoern Sloth Toennesen <asbjorn@asbjorn.biz>\nSigned-off-by: Pablo Neira Ayuso <pablo@netfilter.org>",
    "type_of_change": "Modification",
    "filename_of_changes": "nf_tables_api.c",
    "code_language": "C",
    "number_of_lines_added_for_mitigation": "9",
    "number_of_lines_deleted_vulnerable_to_cve": "5",
    "vulnerable_lines": [
        "// Line_Reference 716: \tlist_for_each_entry_safe(chain, nc, &ctx->table->chains, list) {",
        "// Line_Reference 722: ",
        "// Line_Reference 723: \t\terr = nft_delchain(ctx);",
        "// Line_Reference 724: \t\tif (err < 0)",
        "// Line_Reference 725: \t\t\tgoto out;"
    ]
}
