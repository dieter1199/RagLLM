{
    "cve_id": "CVE-2015-4036",
    "cve_description": "Array index error in the tcm_vhost_make_tpg function in drivers/vhost/scsi.c in the Linux kernel before 4.0 might allow guest OS users to cause a denial of service (memory corruption) or possibly have unspecified other impact via a crafted VHOST_SCSI_SET_ENDPOINT ioctl call.  NOTE: the affected function was renamed to vhost_scsi_make_tpg before the vulnerability was announced.",
    "cve_publish_date": "2015-08-31",
    "cwe_id": "CWE-119",
    "cwe_name": "Improper Restriction of Operations within the Bounds of a Memory Buffer",
    "cwe_description": "The product performs operations on a memory buffer, but it reads from or writes to a memory location outside the buffer's intended boundary. This may result in read or write operations on unexpected memory locations that could be linked to other variables, data structures, or internal program data.",
    "commit_message": "vhost/scsi: potential memory corruption\n\nThis code in vhost_scsi_make_tpg() is confusing because we limit \"tpgt\"\nto UINT_MAX but the data type of \"tpg->tport_tpgt\" and that is a u16.\n\nI looked at the context and it turns out that in\nvhost_scsi_set_endpoint(), \"tpg->tport_tpgt\" is used as an offset into\nthe vs_tpg[] array which has VHOST_SCSI_MAX_TARGET (256) elements so\nanything higher than 255 then it is invalid.  I have made that the limit\nnow.\n\nIn vhost_scsi_send_evt() we mask away values higher than 255, but now\nthat the limit has changed, we don't need the mask.\n\nSigned-off-by: Dan Carpenter <dan.carpenter@oracle.com>\nSigned-off-by: Nicholas Bellinger <nab@linux-iscsi.org>",
    "type_of_change": "Modification",
    "filename_of_changes": "scsi.c",
    "code_language": "C",
    "number_of_lines_added_for_mitigation": "3",
    "number_of_lines_deleted_vulnerable_to_cve": "3",
    "vulnerable_lines": [
        "// Line_Reference 1252: \t\tevt->event.lun[1] = tpg->tport_tpgt & 0xFF;",
        "// Line_Reference 2123: \tunsigned long tpgt;",
        "// Line_Reference 2128: \tif (kstrtoul(name + 5, 10, &tpgt) || tpgt > UINT_MAX)"
    ]
}
