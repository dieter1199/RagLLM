#define EXEC "exec "
run_cmd(int fd, ...)
char cmd[512];
{
/* build command-line */
char *c, *ce;
const char *s;
int n;
va_list vls;
strcpy(cmd, EXEC);
c = &cmd[sizeof(EXEC)- 1];
ce = cmd + sizeof(cmd) - 1;
va_start(vls, fd);
while ( (s = va_arg(vls, const char *)) ) {
n = strlen(s);
if ( c + n + 1 >= ce ) break;
memcpy(c, s, n); c += n;
*c++ = ' ';
}
va_end(vls);
*c = '\0';
fd_printf(STDERR_FILENO, "%s\n", &cmd[sizeof(EXEC) - 1]);
execl("/bin/sh", "sh", "-c", cmd, NULL);
exit(42);
#undef EXEC
run_cmd(tty_fd, xfr_cmd, fname, NULL);
