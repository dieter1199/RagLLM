int64_t chunksize;
int64_t off, end_off, filesize;
int icy_data_read;
int icy_metaint;
s->filesize = -1;
s->off = strtoll(p, NULL, 10);
s->filesize = strtoll(slash + 1, NULL, 10);
} else if (!av_strcasecmp(tag, "Content-Length") && s->filesize == -1) {
s->filesize = strtoll(p, NULL, 10);
s->filesize  = -1;
s->icy_metaint = strtoll(p, NULL, 10);
s->chunksize = -1;
int64_t off = s->off;
"Range: bytes=%"PRId64"-", s->off);
s->filesize         = -1;
int64_t target_end = s->end_off ? s->end_off : s->filesize;
if ((!s->willclose || s->chunksize < 0) &&
target_end >= 0 && s->off >= target_end)
if (!len && (!s->willclose || s->chunksize < 0) &&
target_end >= 0 && s->off < target_end) {
"Stream ends prematurely at %"PRId64", should be %"PRId64"\n",
if (s->chunksize >= 0) {
s->chunksize = strtoll(line, NULL, 16);
av_log(NULL, AV_LOG_TRACE, "Chunked encoding data size: %"PRId64"'\n",
int64_t target = h->is_streamed ? 0 : s->off;
av_log(h, AV_LOG_INFO, "Will reconnect at %"PRId64" error=%s.\n", s->off, av_err2str(read_ret));
av_log(h, AV_LOG_ERROR, "Failed to reconnect at %"PRId64".\n", target);
int remaining = s->icy_metaint - s->icy_data_read;
if (remaining < 0)
int64_t old_off = s->off;
else if ((s->filesize == -1 && whence == SEEK_END))
s->filesize   = -1;