send_ldap_result( pb, LDAP_INVALID_CREDENTIALS, NULL,
"client certificate mapping failed", 0, NULL );
Connection *conn = NULL;
int sasl_ssf = 0;
int local_ssf = 0;
/* Allow simple binds only for SSL/TLS established connections
* or connections using SASL privacy layers */
conn = pb->pb_conn;
if ( slapi_pblock_get(pb, SLAPI_CONN_SASL_SSF, &sasl_ssf) != 0) {
slapi_log_error( SLAPI_LOG_PLUGIN, "do_bind",
"Could not get SASL SSF from connection\n" );
sasl_ssf = 0;
}
if ( slapi_pblock_get(pb, SLAPI_CONN_LOCAL_SSF, &local_ssf) != 0) {
slapi_log_error( SLAPI_LOG_PLUGIN, "do_bind",
"Could not get local SSF from connection\n" );
local_ssf = 0;
}
if (((conn->c_flags & CONN_FLAG_SSL) != CONN_FLAG_SSL) &&
(sasl_ssf <= 1) && (local_ssf <= 1)) {
send_ldap_result(pb, LDAP_CONFIDENTIALITY_REQUIRED, NULL,
"Operation requires a secure connection",
0, NULL);
slapi_counter_increment(g_get_global_snmp_vars()->ops_tbl.dsBindSecurityErrors);
goto free_and_return;
}
send_ldap_result(pb, LDAP_OPERATIONS_ERROR, NULL, errorbuf, 0, NULL);
slapi_create_errormsg(errorbuf, sizeof(errorbuf), "Pre-bind plug-in set corrupted dn\n");
send_ldap_result(pb, LDAP_OPERATIONS_ERROR, NULL, errorbuf, 0, NULL);
send_ldap_result(pb, LDAP_OPERATIONS_ERROR, NULL, errorbuf, 0, NULL);
send_ldap_result(pb, LDAP_NO_SUCH_OBJECT, NULL, "", 0, NULL);
send_ldap_result( pb, LDAP_SUCCESS, NULL, NULL,
0, NULL );
if ( bind_target_entry != NULL )
slapi_entry_free(bind_target_entry);
