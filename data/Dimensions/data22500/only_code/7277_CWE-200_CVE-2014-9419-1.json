/*
* Reload esp0, LDT and the page table pointer:
*/
/*
* Switch DS and ES.
* This won't pick up thread selector changes, but I guess that is ok.
*/
savesegment(es, prev->es);
if (unlikely(next->es | prev->es))
loadsegment(es, next->es);
savesegment(ds, prev->ds);
if (unlikely(next->ds | prev->ds))
loadsegment(ds, next->ds);
* Leave lazy mode, flushing any hypercalls made here.
* This must be done before restoring TLS segments so
* the GDT and LDT are properly updated, and must be
* done before math_state_restore, so the TS bit is up
* to date.
* Segment register != 0 always requires a reload.  Also
* reload when it has changed.  When prev process used 64bit
* base always reload to avoid an information leak.
* Check if the user used a selector != 0; if yes
*  clear 64bit base, since overloaded base is always
*  mapped to the Null selector
/* when next process has a 64bit base use it */
