{
    "cve_id": "CVE-2024-0795",
    "cve_description": "If an attacked was given access to an instance with the admin or manager role there is no backend authentication that would prevent the attacked from creating a new user with an `admin` role and then be able to use this new account to have elevated privileges on the instance",
    "cve_publish_date": "2024-03-02",
    "cwe_id": "CWE-284",
    "cwe_name": "Improper Access Control",
    "cwe_description": "The product does not restrict or incorrectly restricts access to a resource from an unauthorized actor.",
    "commit_message": "Implement total permission overhaul (#629)\n\n* Implement total permission overhaul\r\nAdd explicit permissions on each flex and strict route\r\nPatch issues with role escalation and CRUD of users\r\nPatch permissions on all routes for coverage\r\nImprove middleware to accept role array for clarity\r\n\r\n* update comments\r\n\r\n* remove permissions to API-keys for manager. Manager could generate API-key and using high-privelege api-key give themselves admin\r\n\r\n* update sidebar permissions for multi-user and single user\r\n\r\n* update options for mobile sidebar",
    "type_of_change": "ModificationType.ADD",
    "filename_of_changes": "multiUserProtected.js",
    "code_language": "JavaScript",
    "number_of_lines_added_for_mitigation": "51",
    "number_of_lines_deleted_vulnerable_to_cve": "21",
    "vulnerable_lines": [
        "// Line_Reference 3: ",
        "// Line_Reference 4: const ROLES = [\"admin\", \"manager\"];",
        "// Line_Reference 8: async function strictMultiUserRoleValid(request, response, next) {",
        "// Line_Reference 9:   const multiUserMode =",
        "// Line_Reference 10:     response.locals?.multiUserMode ?? (await SystemSettings.isMultiUserMode());",
        "// Line_Reference 11:   if (!multiUserMode) return response.sendStatus(401).end();",
        "// Line_Reference 13:   const user =",
        "// Line_Reference 14:     response.locals?.user ?? (await userFromSession(request, response));",
        "// Line_Reference 15:   if (!ROLES.includes(user?.role)) return response.sendStatus(401).end();",
        "// Line_Reference 17:   next();",
        "// Line_Reference 23: async function flexUserRoleValid(request, response, next) {",
        "// Line_Reference 24:   const multiUserMode =",
        "// Line_Reference 25:     response.locals?.multiUserMode ?? (await SystemSettings.isMultiUserMode());",
        "// Line_Reference 26:   if (!multiUserMode) {",
        "// Line_Reference 27:     next();",
        "// Line_Reference 28:     return;",
        "// Line_Reference 29:   }",
        "// Line_Reference 31:   const user =",
        "// Line_Reference 32:     response.locals?.user ?? (await userFromSession(request, response));",
        "// Line_Reference 33:   if (!ROLES.includes(user?.role)) return response.sendStatus(401).end();",
        "// Line_Reference 35:   next();"
    ]
}
