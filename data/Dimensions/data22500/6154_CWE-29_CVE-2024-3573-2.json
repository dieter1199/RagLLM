{
    "cve_id": "CVE-2024-3573",
    "cve_description": "mlflow/mlflow is vulnerable to Local File Inclusion (LFI) due to improper parsing of URIs, allowing attackers to bypass checks and read arbitrary files on the system. The issue arises from the 'is_local_uri' function's failure to properly handle URIs with empty or 'file' schemes, leading to the misclassification of URIs as non-local. Attackers can exploit this by crafting malicious model versions with specially crafted 'source' parameters, enabling the reading of sensitive files within at least two directory levels from the server's root.",
    "cve_publish_date": "2024-04-16",
    "cwe_id": "CWE-29",
    "cwe_name": "Path Traversal: '\\..\\filename'",
    "cwe_description": "The product uses external input to construct a pathname that should be within a restricted directory, but it does not properly neutralize '\\..\\filename' (leading backslash dot dot) sequences that can resolve to a location that is outside of that directory.",
    "commit_message": "Fix local uri (#10651)\n\nSigned-off-by: Serena Ruan <serena.rxy@gmail.com>",
    "type_of_change": "Modification",
    "filename_of_changes": "handlers.py",
    "code_language": "Python",
    "number_of_lines_added_for_mitigation": "2",
    "number_of_lines_deleted_vulnerable_to_cve": "17",
    "vulnerable_lines": [
        "// Line_Reference 21: from mlflow.environment_variables import (",
        "// Line_Reference 22:     MLFLOW_ALLOW_FILE_URI_AS_MODEL_VERSION_SOURCE,",
        "// Line_Reference 23:     MLFLOW_DEPLOYMENTS_TARGET,",
        "// Line_Reference 24: )",
        "// Line_Reference 108: from mlflow.utils.uri import is_file_uri, is_local_uri, validate_path_is_safe, validate_query_string",
        "// Line_Reference 1607:     # There might be file URIs that are local but can bypass the above check. To prevent this, we",
        "// Line_Reference 1608:     # disallow using file URIs as model version sources by default unless it's explicitly allowed",
        "// Line_Reference 1609:     # by setting the MLFLOW_ALLOW_FILE_URI_AS_MODEL_VERSION_SOURCE environment variable to True.",
        "// Line_Reference 1610:     if not MLFLOW_ALLOW_FILE_URI_AS_MODEL_VERSION_SOURCE.get() and is_file_uri(source):",
        "// Line_Reference 1611:         raise MlflowException(",
        "// Line_Reference 1612:             f\"Invalid model version source: '{source}'. MLflow tracking server doesn't allow using \"",
        "// Line_Reference 1613:             \"a file URI as a model version source for security reasons. To disable this check, set \"",
        "// Line_Reference 1614:             f\"the {MLFLOW_ALLOW_FILE_URI_AS_MODEL_VERSION_SOURCE} environment variable to \"",
        "// Line_Reference 1615:             \"True.\",",
        "// Line_Reference 1616:             INVALID_PARAMETER_VALUE,",
        "// Line_Reference 1617:         )",
        "// Line_Reference 1618: "
    ]
}
