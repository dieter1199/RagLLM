{
    "cve_id": "CVE-2016-3735",
    "cve_description": "Piwigo is image gallery software written in PHP. When a criteria is not met on a host, piwigo defaults to usingmt_rand in order to generate password reset tokens. mt_rand output can be predicted after recovering the seed used to generate it. This low an unauthenticated attacker to take over an account providing they know an administrators email address in order to be able to request password reset.",
    "cve_publish_date": "2022-01-28",
    "cwe_id": "CWE-335",
    "cwe_name": "Incorrect Usage of Seeds in Pseudo-Random Number Generator (PRNG)",
    "cwe_description": "The product uses a Pseudo-Random Number Generator (PRNG) but does not correctly manage seeds.",
    "commit_message": "bug #470, use a dedicated lib to generate random bytes",
    "type_of_change": "ModificationType.ADD",
    "filename_of_changes": "functions_session.inc.php",
    "code_language": "PHP",
    "number_of_lines_added_for_mitigation": "11",
    "number_of_lines_deleted_vulnerable_to_cve": "26",
    "vulnerable_lines": [
        "// Line_Reference 65:   if (",
        "// Line_Reference 66:     is_callable('openssl_random_pseudo_bytes')",
        "// Line_Reference 67:     and !(version_compare(PHP_VERSION, '5.3.4') < 0 and defined('PHP_WINDOWS_VERSION_MAJOR'))",
        "// Line_Reference 68:     )",
        "// Line_Reference 69:   {",
        "// Line_Reference 70:     return substr(",
        "// Line_Reference 71:       str_replace(",
        "// Line_Reference 72:         array('+', '/'),",
        "// Line_Reference 73:         '',",
        "// Line_Reference 74:         base64_encode(openssl_random_pseudo_bytes($size+10))",
        "// Line_Reference 75:         ),",
        "// Line_Reference 76:       0,",
        "// Line_Reference 77:       $size",
        "// Line_Reference 78:       );",
        "// Line_Reference 79:   }",
        "// Line_Reference 80:   else",
        "// Line_Reference 81:   {",
        "// Line_Reference 82:     $alphabet = 'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';",
        "// Line_Reference 83:     $l = strlen($alphabet)-1;",
        "// Line_Reference 84:     $key = '';",
        "// Line_Reference 85:     for ($i=0; $i<$size; $i++)",
        "// Line_Reference 86:     {",
        "// Line_Reference 87:       $key.= $alphabet[mt_rand(0, $l)];",
        "// Line_Reference 88:     }",
        "// Line_Reference 89:     return $key;",
        "// Line_Reference 90:   }"
    ]
}
