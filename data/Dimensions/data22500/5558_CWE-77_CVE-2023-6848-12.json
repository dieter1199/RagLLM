{
    "cve_id": "CVE-2023-6848",
    "cve_description": "A vulnerability was found in kalcaddle kodbox up to 1.48. It has been declared as critical. Affected by this vulnerability is the function check of the file plugins/officeViewer/controller/libreOffice/index.class.php. The manipulation of the argument soffice leads to command injection. The attack can be launched remotely. The exploit has been disclosed to the public and may be used. Upgrading to version 1.48.04 is able to address this issue. The identifier of the patch is 63a4d5708d210f119c24afd941d01a943e25334c. It is recommended to upgrade the affected component. The identifier VDB-248209 was assigned to this vulnerability.",
    "cve_publish_date": "2023-12-16",
    "cwe_id": "CWE-77",
    "cwe_name": "Improper Neutralization of Special Elements used in a Command ('Command Injection')",
    "cwe_description": "The product constructs all or part of a command using externally-influenced input from an upstream component, but it does not neutralize or incorrectly neutralizes special elements that could modify the intended command when it is sent to a downstream component.",
    "commit_message": "1.48.04 release",
    "type_of_change": "Modification",
    "filename_of_changes": "index.class.php",
    "code_language": "PHP",
    "number_of_lines_added_for_mitigation": "47",
    "number_of_lines_deleted_vulnerable_to_cve": "39",
    "vulnerable_lines": [
        "// Line_Reference 54: \t\tif( $action == 'user.index.index' ||",
        "// Line_Reference 55: \t\t    $action == 'user.view.call'){",
        "// Line_Reference 59: \t\t$systemPassword = Model('SystemOption')->get('systemPassword');",
        "// Line_Reference 60: \t\t$accessToken = isset($_REQUEST['accessToken']) ? $_REQUEST['accessToken'] : '';",
        "// Line_Reference 61: \t\tif($accessToken && strlen($accessToken) < 500){",
        "// Line_Reference 62: \t\t\t$pass = substr(md5('kodbox_'.$systemPassword),0,15);",
        "// Line_Reference 63: \t\t\t$sessionSign = Mcrypt::decode($accessToken,$pass);",
        "// Line_Reference 65: \t\t\t$this->initAccessToken();",
        "// Line_Reference 78: \tpublic function accessTokenCheck($accessToken){",
        "// Line_Reference 79: \t\t$systemPassword = Model('SystemOption')->get('systemPassword');",
        "// Line_Reference 80: \t\tif(!$accessToken || strlen($accessToken) > 500) return false;",
        "// Line_Reference 81: ",
        "// Line_Reference 82: \t\t$pass = substr(md5('kodbox_'.$systemPassword),0,15);",
        "// Line_Reference 83: \t\t$sessionSign = Mcrypt::decode($accessToken,$pass);",
        "// Line_Reference 84: \t\tif(!$sessionSign || $sessionSign != Session::sign()) return false;",
        "// Line_Reference 85: \t\treturn true;",
        "// Line_Reference 86: \t}",
        "// Line_Reference 87: ",
        "// Line_Reference 88: \t// accesstoken 登录前处理;",
        "// Line_Reference 89: \tprivate function initAccessToken(){",
        "// Line_Reference 90: \t\t$action = strtolower(ACTION);",
        "// Line_Reference 91: \t\t$disableCookie = array(",
        "// Line_Reference 92: \t\t\t'explorer.index.filedownload',",
        "// Line_Reference 93: \t\t\t'explorer.index.fileout',",
        "// Line_Reference 94: \t\t\t'explorer.share.filedownload',",
        "// Line_Reference 95: \t\t\t'explorer.share.fileout',",
        "// Line_Reference 96: \t\t);",
        "// Line_Reference 97: \t\t$enableCookie = array('user.index.index');",
        "// Line_Reference 98: \t\tif(in_array($action,$enableCookie)){Cookie::disable(false);} // 带token的url跳转入口页面允许cookie输出;",
        "// Line_Reference 99: \t\tif(in_array($action,$disableCookie)){Cookie::disable(true);allowCROS();}",
        "// Line_Reference 100: \t}",
        "// Line_Reference 101: ",
        "// Line_Reference 211: \t\t$pass = Model('SystemOption')->get('systemPassword');",
        "// Line_Reference 212: \t\t$pass = substr(md5('kodbox_'.$pass),0,15);",
        "// Line_Reference 213: \t\t$token = Mcrypt::encode(Session::sign(),$pass,3600*24*30);",
        "// Line_Reference 214: \t\treturn $token;",
        "// Line_Reference 217: \t\tif(!Session::get('kodUser')){",
        "// Line_Reference 218: \t\t\tshow_json('user not login!',ERROR_CODE_LOGOUT);",
        "// Line_Reference 219: \t\t}"
    ]
}
