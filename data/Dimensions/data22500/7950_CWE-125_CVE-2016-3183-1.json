{
    "cve_id": "CVE-2016-3183",
    "cve_description": "The sycc422_t_rgb function in common/color.c in OpenJPEG before 2.1.1 allows remote attackers to cause a denial of service (out-of-bounds read) via a crafted jpeg2000 file.",
    "cve_publish_date": "2017-02-03",
    "cwe_id": "CWE-125",
    "cwe_name": "Out-of-bounds Read",
    "cwe_description": "The product reads data past the end, or before the beginning, of the intended buffer.",
    "commit_message": "Fix Out-Of-Bounds Read in sycc42x_to_rgb function (#745)\n\n42x Images with an odd x0/y0 lead to subsampled component starting at the\r\n2nd column/line.\r\nThat is offset = comp->dx * comp->x0 - image->x0 = 1\r\n\r\nFix #726",
    "type_of_change": "Modification",
    "filename_of_changes": "color.c",
    "code_language": "C",
    "number_of_lines_added_for_mitigation": "86",
    "number_of_lines_deleted_vulnerable_to_cve": "62",
    "vulnerable_lines": [
        "// Line_Reference 94: \tunsigned int maxw, maxh, max, i;",
        "// Line_Reference 100: \tmaxw = (unsigned int)img->comps[0].w; maxh = (unsigned int)img->comps[0].h;",
        "// Line_Reference 107: \td0 = r = (int*)malloc(sizeof(int) * (size_t)max);",
        "// Line_Reference 108: \td1 = g = (int*)malloc(sizeof(int) * (size_t)max);",
        "// Line_Reference 109: \td2 = b = (int*)malloc(sizeof(int) * (size_t)max);",
        "// Line_Reference 124: \tif(r) free(r);",
        "// Line_Reference 125: \tif(g) free(g);",
        "// Line_Reference 126: \tif(b) free(b);",
        "// Line_Reference 127: ",
        "// Line_Reference 134: \tunsigned int maxw, maxh, max;",
        "// Line_Reference 136: \tunsigned int i, j;",
        "// Line_Reference 141: \tmaxw = (unsigned int)img->comps[0].w; maxh = (unsigned int)img->comps[0].h;",
        "// Line_Reference 148: \td0 = r = (int*)malloc(sizeof(int) * (size_t)max);",
        "// Line_Reference 149: \td1 = g = (int*)malloc(sizeof(int) * (size_t)max);",
        "// Line_Reference 150: \td2 = b = (int*)malloc(sizeof(int) * (size_t)max);",
        "// Line_Reference 156: \t\tfor(j=0U; j < (maxw & ~(unsigned int)1U); j += 2U)",
        "// Line_Reference 163: \t\tif (j < maxw) {",
        "// Line_Reference 172: #if defined(USE_JPWL) || defined(USE_MJ2)",
        "// Line_Reference 173: \timg->comps[1].w = maxw; img->comps[1].h = maxh;",
        "// Line_Reference 174: \timg->comps[2].w = maxw; img->comps[2].h = maxh;",
        "// Line_Reference 175: #else",
        "// Line_Reference 176: \timg->comps[1].w = (OPJ_UINT32)maxw; img->comps[1].h = (OPJ_UINT32)maxh;",
        "// Line_Reference 177: \timg->comps[2].w = (OPJ_UINT32)maxw; img->comps[2].h = (OPJ_UINT32)maxh;",
        "// Line_Reference 178: #endif",
        "// Line_Reference 179: \timg->comps[1].dx = img->comps[0].dx;",
        "// Line_Reference 180: \timg->comps[2].dx = img->comps[0].dx;",
        "// Line_Reference 181: \timg->comps[1].dy = img->comps[0].dy;",
        "// Line_Reference 182: \timg->comps[2].dy = img->comps[0].dy;",
        "// Line_Reference 186: \tif(r) free(r);",
        "// Line_Reference 187: \tif(g) free(g);",
        "// Line_Reference 188: \tif(b) free(b);",
        "// Line_Reference 189: ",
        "// Line_Reference 196: \tunsigned int maxw, maxh, max;",
        "// Line_Reference 198: \tunsigned int i, j;",
        "// Line_Reference 203: \tmaxw = (unsigned int)img->comps[0].w; maxh = (unsigned int)img->comps[0].h;",
        "// Line_Reference 210: \td0 = r = (int*)malloc(sizeof(int) * (size_t)max);",
        "// Line_Reference 211: \td1 = g = (int*)malloc(sizeof(int) * (size_t)max);",
        "// Line_Reference 212: \td2 = b = (int*)malloc(sizeof(int) * (size_t)max);",
        "// Line_Reference 213: ",
        "// Line_Reference 214: \tif(r == NULL || g == NULL || b == NULL) goto fails;",
        "// Line_Reference 216: \tfor(i=0U; i < (maxh & ~(unsigned int)1U); i += 2U)",
        "// Line_Reference 221: \t\tfor(j=0; j < (maxw & ~(unsigned int)1U); j += 2U)",
        "// Line_Reference 233: \t\tif(j < maxw)",
        "// Line_Reference 243: \tif(i < maxh)",
        "// Line_Reference 245: \t\tfor(j=0U; j < (maxw & ~(unsigned int)1U); j += 2U)",
        "// Line_Reference 265: #if defined(USE_JPWL) || defined(USE_MJ2)",
        "// Line_Reference 266: \timg->comps[1].w = maxw; img->comps[1].h = maxh;",
        "// Line_Reference 267: \timg->comps[2].w = maxw; img->comps[2].h = maxh;",
        "// Line_Reference 268: #else",
        "// Line_Reference 269: \timg->comps[1].w = (OPJ_UINT32)maxw; img->comps[1].h = (OPJ_UINT32)maxh;",
        "// Line_Reference 270: \timg->comps[2].w = (OPJ_UINT32)maxw; img->comps[2].h = (OPJ_UINT32)maxh;",
        "// Line_Reference 271: #endif",
        "// Line_Reference 272: \timg->comps[1].dx = img->comps[0].dx;",
        "// Line_Reference 273: \timg->comps[2].dx = img->comps[0].dx;",
        "// Line_Reference 274: \timg->comps[1].dy = img->comps[0].dy;",
        "// Line_Reference 275: \timg->comps[2].dy = img->comps[0].dy;",
        "// Line_Reference 279: \tif(r) free(r);",
        "// Line_Reference 280: \tif(g) free(g);",
        "// Line_Reference 281: \tif(b) free(b);",
        "// Line_Reference 282: ",
        "// Line_Reference 327: \timg->color_space = OPJ_CLRSPC_SRGB;",
        "// Line_Reference 328: "
    ]
}
