{
    "cve_id": "CVE-2022-45962",
    "cve_description": "Open Solutions for Education, Inc openSIS Community Edition v8.0 and earlier is vulnerable to SQL Injection via CalendarModal.php.",
    "cve_publish_date": "2023-02-13",
    "cwe_id": "CWE-89",
    "cwe_name": "Improper Neutralization of Special Elements used in an SQL Command ('SQL Injection')",
    "cwe_description": "The product constructs all or part of an SQL command using externally-influenced input from an upstream component, but it does not neutralize or incorrectly neutralizes special elements that could modify the intended SQL command when it is sent to a downstream component. Without sufficient removal or quoting of SQL syntax in user-controllable inputs, the generated SQL query can cause those inputs to be interpreted as SQL instead of ordinary user data.",
    "commit_message": "Version 9.0 release\n\nOlder version shifted to branch: Version_8.0",
    "type_of_change": "ModificationType.ADD",
    "filename_of_changes": "Ins2.php",
    "code_language": "PHP",
    "number_of_lines_added_for_mitigation": "76",
    "number_of_lines_deleted_vulnerable_to_cve": "69",
    "vulnerable_lines": [
        "// Line_Reference 32: session_start();",
        "// Line_Reference 33: ",
        "// Line_Reference 39: ",
        "// Line_Reference 40: ",
        "// Line_Reference 41: $_SESSION['db'] = clean_param($_REQUEST[\"db\"], PARAM_DATA);",
        "// Line_Reference 42: $newdb = clean_param($_REQUEST[\"newdb\"], PARAM_ALPHA);",
        "// Line_Reference 43: ",
        "// Line_Reference 44: $purgedb = clean_param($_REQUEST[\"purgedb\"], PARAM_ALPHA); // Added variable to check for removing existing data.",
        "// Line_Reference 45: ",
        "// Line_Reference 46: $dbconn = new mysqli($_SESSION['server'], $_SESSION['username'], $_SESSION['password'], $_SESSION['db'], $_SESSION['port']);",
        "// Line_Reference 47: ",
        "// Line_Reference 48: ",
        "// Line_Reference 49: if ($dbconn->connect_errno == 0) {",
        "// Line_Reference 50: \tif (!empty($newdb)) {",
        "// Line_Reference 51:             \theader('Location: Step2.php?err=Database Exists. Enter a different name to create a new database or use the remove data from existing database checkbox.');",
        "// Line_Reference 52:             \texit;",
        "// Line_Reference 55: \tif (empty($purgedb)) {",
        "// Line_Reference 56: ",
        "// Line_Reference 58: \t\t$sql = \"SHOW TABLES\";",
        "// Line_Reference 59: \t\t$num_tables = $dbconn->query($sql);",
        "// Line_Reference 60: \t\t$rows = $num_tables->num_rows;",
        "// Line_Reference 76: \t\t// Get tables, loop thru the tables and drop each table.",
        "// Line_Reference 77: \t\t$sql = \"SHOW TABLES\";",
        "// Line_Reference 78: \t\t$num_tables = $dbconn->query($sql);",
        "// Line_Reference 81: \t\twhile ($row = $num_tables->fetch_row()) {",
        "// Line_Reference 82: \t\t    // Drop all tables.",
        "// Line_Reference 83: \t\t    $delete_table = $dbconn->query(\"DROP TABLE IF EXISTS $row[0]\");",
        "// Line_Reference 85: \t\t    // Separate Drop for VIEWs is needed due to mysql syntax for views.",
        "// Line_Reference 86: \t\t    $delete_view = $dbconn->query(\"DROP VIEW IF EXISTS $row[0]\");",
        "// Line_Reference 88: \t\t    // There is currently no way to drop functions without knowing",
        "// Line_Reference 89: \t\t    // the functions name and doing a DROP FUNCTION name",
        "// Line_Reference 90: \t\t    // so we have to modify the mysql file to remove functions first",
        "// Line_Reference 91: \t\t    // before trying to add them or else an error will occur.",
        "// Line_Reference 93: \t\t    if (!$delete_table) {",
        "// Line_Reference 94: \t\t        echo 'Unable to remove ' . $row[0] . '<br>';",
        "// Line_Reference 96:         }",
        "// Line_Reference 97:         // Free result set to clear memory",
        "// Line_Reference 98:         //        mysql_free_result($num_tables);",
        "// Line_Reference 99:         //This begins the add portion",
        "// Line_Reference 101:         $myFile = \"OpensisSchemaMysqlInc.sql\";",
        "// Line_Reference 102:         executeSQL($myFile);",
        "// Line_Reference 104:         $myFile = \"OpensisProcsMysqlInc.sql\";",
        "// Line_Reference 105:          executeSQL($myFile);",
        "// Line_Reference 107:         createUpdatedByTriggers();",
        "// Line_Reference 108:         $dbconn->close();",
        "// Line_Reference 110:         header('Location: Step3.php');",
        "// Line_Reference 111:     }",
        "// Line_Reference 112: } else {",
        "// Line_Reference 113: \tif (empty($newdb)) {",
        "// Line_Reference 114: \t\t    header('Location: Step2.php?err=Database does not exist. Enter a different database or use the create a new database checkbox.');",
        "// Line_Reference 115: \t\t    exit;",
        "// Line_Reference 116: \t\t} else {",
        "// Line_Reference 117: \t    $dbconn = new mysqli($_SESSION['server'], $_SESSION['username'], $_SESSION['password'], '', $_SESSION['port']);",
        "// Line_Reference 118: \t    $sql = \"CREATE DATABASE `\" . $_SESSION['db'] . \"` CHARACTER SET=utf8;\";",
        "// Line_Reference 119: \t    $result = $dbconn->query($sql);",
        "// Line_Reference 120: \t    if (!$result) {",
        "// Line_Reference 121:         echo \"<h2>\" . $dbconn->error . \"</h2>\\n\";",
        "// Line_Reference 122:         exit;",
        "// Line_Reference 123:     }",
        "// Line_Reference 126:    $myFile = \"OpensisSchemaMysqlInc.sql\";",
        "// Line_Reference 127:    executeSQL($myFile);",
        "// Line_Reference 129:     $myFile = \"OpensisProcsMysqlInc.sql\";",
        "// Line_Reference 130:      executeSQL($myFile);",
        "// Line_Reference 132:     createUpdatedByTriggers();",
        "// Line_Reference 133:     $dbconn->close();",
        "// Line_Reference 135: // edited installation",
        "// Line_Reference 136:     header('Location: Step3.php');",
        "// Line_Reference 137: }",
        "// Line_Reference 138: }"
    ]
}
