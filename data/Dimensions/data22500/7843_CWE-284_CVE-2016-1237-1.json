{
    "cve_id": "CVE-2016-1237",
    "cve_description": "nfsd in the Linux kernel through 4.6.3 allows local users to bypass intended file-permission restrictions by setting a POSIX ACL, related to nfs2acl.c, nfs3acl.c, and nfs4acl.c.",
    "cve_publish_date": "2016-06-29",
    "cwe_id": "CWE-284",
    "cwe_name": "Improper Access Control",
    "cwe_description": "The product does not restrict or incorrectly restricts access to a resource from an unauthorized actor.",
    "commit_message": "nfsd: check permissions when setting ACLs\n\nUse set_posix_acl, which includes proper permission checks, instead of\ncalling ->set_acl directly.  Without this anyone may be able to grant\nthemselves permissions to a file by setting the ACL.\n\nLock the inode to make the new checks atomic with respect to set_acl.\n(Also, nfsd was the only caller of set_acl not locking the inode, so I\nsuspect this may fix other races.)\n\nThis also simplifies the code, and ensures our ACLs are checked by\nposix_acl_valid.\n\nThe permission checks and the inode locking were lost with commit\n4ac7249e, which changed nfsd to use the set_acl inode operation directly\ninstead of going through xattr handlers.\n\nReported-by: David Sinquin <david@sinquin.eu>\n[agreunba@redhat.com: use set_posix_acl]\nFixes: 4ac7249e\nCc: Christoph Hellwig <hch@infradead.org>\nCc: Al Viro <viro@zeniv.linux.org.uk>\nCc: stable@vger.kernel.org\nSigned-off-by: J. Bruce Fields <bfields@redhat.com>",
    "type_of_change": "Modification",
    "filename_of_changes": "nfs2acl.c",
    "code_language": "C",
    "number_of_lines_added_for_mitigation": "10",
    "number_of_lines_deleted_vulnerable_to_cve": "10",
    "vulnerable_lines": [
        "// Line_Reference 107: \tif (!IS_POSIXACL(inode) || !inode->i_op->set_acl) {",
        "// Line_Reference 108: \t\terror = -EOPNOTSUPP;",
        "// Line_Reference 109: \t\tgoto out_errno;",
        "// Line_Reference 110: \t}",
        "// Line_Reference 116: \terror = inode->i_op->set_acl(inode, argp->acl_access, ACL_TYPE_ACCESS);",
        "// Line_Reference 118: \t\tgoto out_drop_write;",
        "// Line_Reference 119: \terror = inode->i_op->set_acl(inode, argp->acl_default,",
        "// Line_Reference 120: \t\t\t\t     ACL_TYPE_DEFAULT);",
        "// Line_Reference 122: \t\tgoto out_drop_write;",
        "// Line_Reference 134: out_drop_write:"
    ]
}
