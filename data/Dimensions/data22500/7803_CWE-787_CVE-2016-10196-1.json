{
    "cve_id": "CVE-2016-10196",
    "cve_description": "Stack-based buffer overflow in the evutil_parse_sockaddr_port function in evutil.c in libevent before 2.1.6-beta allows attackers to cause a denial of service (segmentation fault) via vectors involving a long string in brackets in the ip_as_string argument.",
    "cve_publish_date": "2017-03-15",
    "cwe_id": "CWE-787",
    "cwe_name": "Out-of-bounds Write",
    "cwe_description": "The product writes data past the end, or before the beginning, of the intended buffer.",
    "commit_message": "evutil_parse_sockaddr_port(): fix buffer overflow\n\n@asn-the-goblin-slayer:\n  \"Length between '[' and ']' is cast to signed 32 bit integer on line 1815. Is\n   the length is more than 2<<31 (INT_MAX), len will hold a negative value.\n   Consequently, it will pass the check at line 1816. Segfault happens at line\n   1819.\n\n   Generate a resolv.conf with generate-resolv.conf, then compile and run\n   poc.c. See entry-functions.txt for functions in tor that might be\n   vulnerable.\n\n   Please credit 'Guido Vranken' for this discovery through the Tor bug bounty\n   program.\"\n\nReproducer for gdb (https://gist.github.com/azat/be2b0d5e9417ba0dfe2c):\n  start\n  p (1ULL<<31)+1ULL\n  # $1 = 2147483649\n  p malloc(sizeof(struct sockaddr))\n  # $2 = (void *) 0x646010\n  p malloc(sizeof(int))\n  # $3 = (void *) 0x646030\n  p malloc($1)\n  # $4 = (void *) 0x7fff76a2a010\n  p memset($4, 1, $1)\n  # $5 = 1990369296\n  p (char *)$4\n  # $6 = 0x7fff76a2a010 '\\001' <repeats 200 times>...\n  set $6[0]='['\n  set $6[$1]=']'\n  p evutil_parse_sockaddr_port($4, $2, $3)\n  # $7 = -1\n\nBefore:\n  $ gdb bin/http-connect < gdb\n  (gdb) $1 = 2147483649\n  (gdb) (gdb) $2 = (void *) 0x646010\n  (gdb) (gdb) $3 = (void *) 0x646030\n  (gdb) (gdb) $4 = (void *) 0x7fff76a2a010\n  (gdb) (gdb) $5 = 1990369296\n  (gdb) (gdb) $6 = 0x7fff76a2a010 '\\001' <repeats 200 times>...\n  (gdb) (gdb) (gdb) (gdb)\n  Program received signal SIGSEGV, Segmentation fault.\n  __memcpy_sse2_unaligned () at memcpy-sse2-unaligned.S:36\n\nAfter:\n  $ gdb bin/http-connect < gdb\n  (gdb) $1 = 2147483649\n  (gdb) (gdb) $2 = (void *) 0x646010\n  (gdb) (gdb) $3 = (void *) 0x646030\n  (gdb) (gdb) $4 = (void *) 0x7fff76a2a010\n  (gdb) (gdb) $5 = 1990369296\n  (gdb) (gdb) $6 = 0x7fff76a2a010 '\\001' <repeats 200 times>...\n  (gdb) (gdb) (gdb) (gdb) $7 = -1\n  (gdb) (gdb) quit\n\nFixes: #318",
    "type_of_change": "Modification",
    "filename_of_changes": "evutil.c",
    "code_language": "C",
    "number_of_lines_added_for_mitigation": "3",
    "number_of_lines_deleted_vulnerable_to_cve": "3",
    "vulnerable_lines": [
        "// Line_Reference 2061: \t\tint len;",
        "// Line_Reference 2065: \t\tlen = (int) ( cp-(ip_as_string + 1) );",
        "// Line_Reference 2066: \t\tif (len > (int)sizeof(buf)-1) {"
    ]
}
