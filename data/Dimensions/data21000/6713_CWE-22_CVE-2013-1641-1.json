{
    "cve_id": "CVE-2013-1641",
    "cve_description": "Directory traversal vulnerability in the zip download functionality in QuiXplorer before 2.5.5 allows remote attackers to read arbitrary files via a .. (dot dot) in the selitems[] parameter in a download_selected action to index.php.",
    "cve_publish_date": "2014-10-26",
    "cwe_id": "CWE-22",
    "cwe_name": "Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal')",
    "cwe_description": "The product uses external input to construct a pathname that is intended to identify a file or directory that is located underneath a restricted parent directory, but the product does not properly neutralize special elements within the pathname that can cause the pathname to resolve to a location that is outside of the restricted directory.",
    "commit_message": "Bugfix: SECURITY FIX: download as zip may grant access to any files.\n\nThis bugfix removes a vulnerability bug of quixplorer from which\nany file in your system (which is readable to the web process) may\nbe downloaded from your system.\n\n- Refactored downloading and access right controlling.\n- Fixed download and path handling.\n\nCloses #21",
    "type_of_change": "Modification",
    "filename_of_changes": "fun_down.php",
    "code_language": "PHP",
    "number_of_lines_added_for_mitigation": "37",
    "number_of_lines_deleted_vulnerable_to_cve": "68",
    "vulnerable_lines": [
        "// Line_Reference 2: /*------------------------------------------------------------------------------",
        "// Line_Reference 3:      The contents of this file are subject to the Mozilla Public License",
        "// Line_Reference 4:      Version 1.1 (the \"License\"); you may not use this file except in",
        "// Line_Reference 5:      compliance with the License. You may obtain a copy of the License at",
        "// Line_Reference 6:      http://www.mozilla.org/MPL/",
        "// Line_Reference 8:      Software distributed under the License is distributed on an \"AS IS\"",
        "// Line_Reference 9:      basis, WITHOUT WARRANTY OF ANY KIND, either express or implied. See the",
        "// Line_Reference 10:      License for the specific language governing rights and limitations",
        "// Line_Reference 11:      under the License.",
        "// Line_Reference 12: ",
        "// Line_Reference 13:      The Original Code is fun_down.php, released on 2003-01-25.",
        "// Line_Reference 14: ",
        "// Line_Reference 15:      The Initial Developer of the Original Code is The QuiX project.",
        "// Line_Reference 16: ",
        "// Line_Reference 17:      Alternatively, the contents of this file may be used under the terms",
        "// Line_Reference 18:      of the GNU General Public License Version 2 or later (the \"GPL\"), in",
        "// Line_Reference 19:      which case the provisions of the GPL are applicable instead of",
        "// Line_Reference 20:      those above. If you wish to allow use of your version of this file only",
        "// Line_Reference 21:      under the terms of the GPL and not to allow others to use",
        "// Line_Reference 22:      your version of this file under the MPL, indicate your decision by",
        "// Line_Reference 23:      deleting  the provisions above and replace  them with the notice and",
        "// Line_Reference 24:      other provisions required by the GPL.  If you do not delete",
        "// Line_Reference 25:      the provisions above, a recipient may use your version of this file",
        "// Line_Reference 26:      under either the MPL or the GPL.\"",
        "// Line_Reference 27: ------------------------------------------------------------------------------*/",
        "// Line_Reference 28: /*------------------------------------------------------------------------------",
        "// Line_Reference 29: Author: The QuiX project",
        "// Line_Reference 30: \tquix@free.fr",
        "// Line_Reference 31: \thttp://www.quix.tk",
        "// Line_Reference 32: \thttp://quixplorer.sourceforge.net",
        "// Line_Reference 33: ",
        "// Line_Reference 34: Comment:",
        "// Line_Reference 35: \tQuiXplorer Version 2.3",
        "// Line_Reference 36: \tFile-Download Functions",
        "// Line_Reference 37: ",
        "// Line_Reference 38: \tHave Fun...",
        "// Line_Reference 39: ------------------------------------------------------------------------------*/",
        "// Line_Reference 40: require_once(\"./_include/permissions.php\");",
        "// Line_Reference 49:     $dir = get_abs_dir($dir);",
        "// Line_Reference 50:     global $site_name;",
        "// Line_Reference 53: ",
        "// Line_Reference 54:     // check if user selected any items to download",
        "// Line_Reference 55:     switch (count($items))",
        "// Line_Reference 56:     {",
        "// Line_Reference 57:         case 0:",
        "// Line_Reference 58:             show_error($GLOBALS[\"error_msg\"][\"miscselitems\"]);",
        "// Line_Reference 59:         case 1:",
        "// Line_Reference 60:             if (is_file($items[0]))",
        "// Line_Reference 61:             {",
        "// Line_Reference 62:                 download_item( $dir, $items[0] );",
        "// Line_Reference 63:                 break;",
        "// Line_Reference 64:             }",
        "// Line_Reference 65:             // nobreak, downloading a directory is done",
        "// Line_Reference 66:             // with the zip file",
        "// Line_Reference 67:         default:",
        "// Line_Reference 68:             zip_download( $dir, $items );",
        "// Line_Reference 69:     }",
        "// Line_Reference 75: \t// Security Fix:",
        "// Line_Reference 76: \t$item=basename($item);",
        "// Line_Reference 78: \tif (!permissions_grant($dir, $item, \"read\"))",
        "// Line_Reference 79: \t\tshow_error($GLOBALS[\"error_msg\"][\"accessfunc\"]);",
        "// Line_Reference 81: \tif (!get_is_file($dir,$item))",
        "// Line_Reference 83:         _debug(\"error download\");",
        "// Line_Reference 84:         show_error($item.\": \".$GLOBALS[\"error_msg\"][\"fileexist\"]);",
        "// Line_Reference 86: \tif (!get_show_item($dir, $item))",
        "// Line_Reference 87:         show_error($item.\": \".$GLOBALS[\"error_msg\"][\"accessfile\"]);",
        "// Line_Reference 89: \t$abs_item = get_abs_item($dir,$item);",
        "// Line_Reference 90:     _download($abs_item, $item);",
        "// Line_Reference 93: function _download_header($filename, $filesize = 0)",
        "// Line_Reference 94: {"
    ]
}
