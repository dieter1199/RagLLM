{
    "cve_id": "CVE-2014-3772",
    "cve_description": "TeamPass before 2.1.20 allows remote attackers to bypass access restrictions via a request to index.php followed by a direct request to a file that calls the session_start function before checking the CPM key, as demonstrated by a request to sources/upload/upload.files.php.",
    "cve_publish_date": "2014-08-07",
    "cwe_id": "CWE-264",
    "cwe_name": "Permissions, Privileges, and Access Controls",
    "cwe_description": "Weaknesses in this category are related to the management of permissions, privileges, and other security features that are used to perform access control.",
    "commit_message": "2.1.20",
    "type_of_change": "Modification",
    "filename_of_changes": "main.queries.php",
    "code_language": "PHP",
    "number_of_lines_added_for_mitigation": "104",
    "number_of_lines_deleted_vulnerable_to_cve": "33",
    "vulnerable_lines": [
        "// Line_Reference 5:  * @author        Nils Laumaillé",
        "// Line_Reference 7:  * @copyright     (c) 2009-2014 Nils Laumaillé",
        "// Line_Reference 147:             $row = $db->fetchRow(\"SELECT email FROM \".$pre.\"users WHERE id=\".$dataReceived['user_id']);",
        "// Line_Reference 783:         $data = $db->fetchRow(",
        "// Line_Reference 784:             \"SELECT COUNT(*) FROM \".$pre.\"users WHERE email = '\".",
        "// Line_Reference 785:             mysql_real_escape_string(stripslashes(($_POST['email']))).\"'\"",
        "// Line_Reference 789:             \"&login=\".$_POST['login'].\"\\\">\".$_SESSION['settings']['cpassman_url'].",
        "// Line_Reference 790:             \"/index.php?action=password_recovery&key=\".$key.\"&login=\".$_POST['login'].\"</a>.<br><br>\".$txt['thku'];",
        "// Line_Reference 791:         $textMailAlt = $txt['forgot_pw_email_altbody_1'].\" \".$txt['at_login'].\" : \".$data['login'].\" - \".",
        "// Line_Reference 797:                 mysql_real_escape_string(stripslashes(($_POST['email']))).\"'\"",
        "// Line_Reference 801:             $data = $db->fetchRow(",
        "// Line_Reference 802:                 \"SELECT COUNT(*) FROM \".$pre.\"misc WHERE intitule = '\".",
        "// Line_Reference 803:                 $_POST['login'].\"' AND type = 'password_recovery'\"",
        "// Line_Reference 813:                             'intitule' => $_POST['login']",
        "// Line_Reference 822:                             'intitule' => $_POST['login'],",
        "// Line_Reference 837:         $data = $db->fetchRow(",
        "// Line_Reference 839:             $_POST['login'].\"' AND type = 'password_recovery'\"",
        "// Line_Reference 841:         if ($_POST['key'] == $data[0]) {",
        "// Line_Reference 863:                 \"login = '\".$_POST['login'].\"'\"",
        "// Line_Reference 870:                     'intitule' => $_POST['login'],",
        "// Line_Reference 875:             $dataUser = $db->queryFirst(\"SELECT email FROM \".$pre.\"users WHERE login = '\".$_POST['login'].\"'\");",
        "// Line_Reference 1025:                     'user_language' => $_POST['lang']",
        "// Line_Reference 1029:             $_SESSION['user_language'] = $_POST['lang'];",
        "// Line_Reference 1032:             $_SESSION['user_language'] = $_POST['lang'];",
        "// Line_Reference 1132:         //Generate",
        "// Line_Reference 1133:         $pwgen->setLength($_POST['length']);",
        "// Line_Reference 1134:         $pwgen->setSecure($_POST['secure']);",
        "// Line_Reference 1135:         $pwgen->setSymbols($_POST['symbols']);",
        "// Line_Reference 1136:         $pwgen->setCapitalize($_POST['capitalize']);",
        "// Line_Reference 1137:         $pwgen->setNumerals($_POST['numerals']);",
        "// Line_Reference 1139:         echo Encryption\\Crypt\\aesctr::encrypt($pwgen->generate(), $_SESSION['key'], 256);",
        "// Line_Reference 1145:         $sql = \"SELECT * FROM \".$pre.\"users WHERE login = '\".addslashes($_POST['userId']).\"'\";",
        "// Line_Reference 1147:         $data = $db->fetchArray($row);"
    ]
}
