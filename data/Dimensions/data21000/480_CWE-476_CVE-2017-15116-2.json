{
    "cve_id": "CVE-2017-15116",
    "cve_description": "The rngapi_reset function in crypto/rng.c in the Linux kernel before 4.2 allows attackers to cause a denial of service (NULL pointer dereference).",
    "cve_publish_date": "2017-11-30",
    "cwe_id": "CWE-476",
    "cwe_name": "NULL Pointer Dereference",
    "cwe_description": "The product dereferences a pointer that it expects to be valid but is NULL.",
    "commit_message": "crypto: rng - Remove old low-level rng interface\n\nNow that all rng implementations have switched over to the new\ninterface, we can remove the old low-level interface.\n\nSigned-off-by: Herbert Xu <herbert@gondor.apana.org.au>",
    "type_of_change": "Modification",
    "filename_of_changes": "rng.c",
    "code_language": "C",
    "number_of_lines_added_for_mitigation": "4",
    "number_of_lines_deleted_vulnerable_to_cve": "53",
    "vulnerable_lines": [
        "// Line_Reference 39: static inline struct old_rng_alg *crypto_old_rng_alg(struct crypto_rng *tfm)",
        "// Line_Reference 40: {",
        "// Line_Reference 41: \treturn &crypto_rng_tfm(tfm)->__crt_alg->cra_rng;",
        "// Line_Reference 42: }",
        "// Line_Reference 43: ",
        "// Line_Reference 44: static int generate(struct crypto_rng *tfm, const u8 *src, unsigned int slen,",
        "// Line_Reference 45: \t\t    u8 *dst, unsigned int dlen)",
        "// Line_Reference 46: {",
        "// Line_Reference 47: \treturn crypto_old_rng_alg(tfm)->rng_make_random(tfm, dst, dlen);",
        "// Line_Reference 48: }",
        "// Line_Reference 49: ",
        "// Line_Reference 50: static int rngapi_reset(struct crypto_rng *tfm, const u8 *seed,",
        "// Line_Reference 51: \t\t\tunsigned int slen)",
        "// Line_Reference 52: {",
        "// Line_Reference 53: \tu8 *buf = NULL;",
        "// Line_Reference 54: \tu8 *src = (u8 *)seed;",
        "// Line_Reference 55: \tint err;",
        "// Line_Reference 56: ",
        "// Line_Reference 57: \tif (slen) {",
        "// Line_Reference 58: \t\tbuf = kmalloc(slen, GFP_KERNEL);",
        "// Line_Reference 59: \t\tif (!buf)",
        "// Line_Reference 60: \t\t\treturn -ENOMEM;",
        "// Line_Reference 61: ",
        "// Line_Reference 62: \t\tmemcpy(buf, seed, slen);",
        "// Line_Reference 63: \t\tsrc = buf;",
        "// Line_Reference 64: \t}",
        "// Line_Reference 65: ",
        "// Line_Reference 66: \terr = crypto_old_rng_alg(tfm)->rng_reset(tfm, src, slen);",
        "// Line_Reference 67: ",
        "// Line_Reference 68: \tkzfree(buf);",
        "// Line_Reference 69: \treturn err;",
        "// Line_Reference 70: }",
        "// Line_Reference 71: ",
        "// Line_Reference 86: \terr = tfm->seed(tfm, seed, slen);",
        "// Line_Reference 95: \tstruct crypto_rng *rng = __crypto_rng_cast(tfm);",
        "// Line_Reference 96: \tstruct rng_alg *alg = crypto_rng_alg(rng);",
        "// Line_Reference 97: \tstruct old_rng_alg *oalg = crypto_old_rng_alg(rng);",
        "// Line_Reference 98: ",
        "// Line_Reference 99: \tif (oalg->rng_make_random) {",
        "// Line_Reference 100: \t\trng->generate = generate;",
        "// Line_Reference 101: \t\trng->seed = rngapi_reset;",
        "// Line_Reference 102: \t\trng->seedsize = oalg->seedsize;",
        "// Line_Reference 103: \t\treturn 0;",
        "// Line_Reference 104: \t}",
        "// Line_Reference 105: ",
        "// Line_Reference 106: \trng->generate = alg->generate;",
        "// Line_Reference 107: \trng->seed = alg->seed;",
        "// Line_Reference 108: \trng->seedsize = alg->seedsize;",
        "// Line_Reference 109: ",
        "// Line_Reference 117: \treturn alg->cra_rng.rng_make_random ?",
        "// Line_Reference 118: \t       alg->cra_rng.seedsize : ralg->seedsize;",
        "// Line_Reference 153: const struct crypto_type crypto_rng_type = {",
        "// Line_Reference 165: EXPORT_SYMBOL_GPL(crypto_rng_type);"
    ]
}
