{
    "cve_id": "CVE-2014-5351",
    "cve_description": "The kadm5_randkey_principal_3 function in lib/kadm5/srv/svr_principal.c in kadmind in MIT Kerberos 5 (aka krb5) before 1.13 sends old keys in a response to a -randkey -keepold request, which allows remote authenticated users to forge tickets by leveraging administrative access.",
    "cve_publish_date": "2014-10-10",
    "cwe_id": "CWE-255",
    "cwe_name": "Credentials Management Errors",
    "cwe_description": "Weaknesses in this category are related to the management of credentials.",
    "commit_message": "Return only new keys in randkey [CVE-2014-5351]\n\nIn kadmind's randkey operation, if a client specifies the keepold\nflag, do not include the preserved old keys in the response.\n\nCVE-2014-5351:\n\nAn authenticated remote attacker can retrieve the current keys for a\nservice principal when generating a new set of keys for that\nprincipal.  The attacker needs to be authenticated as a user who has\nthe elevated privilege for randomizing the keys of other principals.\n\nNormally, when a Kerberos administrator randomizes the keys of a\nservice principal, kadmind returns only the new keys.  This prevents\nan administrator who lacks legitimate privileged access to a service\nfrom forging tickets to authenticate to that service.  If the\n\"keepold\" flag to the kadmin randkey RPC operation is true, kadmind\nretains the old keys in the KDC database as intended, but also\nunexpectedly returns the old keys to the client, which exposes the\nservice to ticket forgery attacks from the administrator.\n\nA mitigating factor is that legitimate clients of the affected service\nwill start failing to authenticate to the service once they begin to\nreceive service tickets encrypted in the new keys.  The affected\nservice will be unable to decrypt the newly issued tickets, possibly\nalerting the legitimate administrator of the affected service.\n\nCVSSv2: AV:N/AC:H/Au:S/C:P/I:N/A:N/E:POC/RL:OF/RC:C\n\n[tlyu@mit.edu: CVE description and CVSS score]\n\nticket: 8018 (new)\ntarget_version: 1.13\ntags: pullup",
    "type_of_change": "Modification",
    "filename_of_changes": "svr_principal.c",
    "code_language": "C",
    "number_of_lines_added_for_mitigation": "18",
    "number_of_lines_deleted_vulnerable_to_cve": "3",
    "vulnerable_lines": [
        "// Line_Reference 1596:     int                         ret, last_pwd;",
        "// Line_Reference 1689:         ret = decrypt_key_data(handle->context,",
        "// Line_Reference 1690:                                kdb->n_key_data, kdb->key_data,"
    ]
}
