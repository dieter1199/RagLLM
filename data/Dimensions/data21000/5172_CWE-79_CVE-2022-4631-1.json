{
    "cve_id": "CVE-2022-4631",
    "cve_description": "A vulnerability, which was classified as problematic, was found in WP-Ban. Affected is an unknown function of the file ban-options.php. The manipulation leads to cross site scripting. It is possible to launch the attack remotely. The name of the patch is 22b925449c84faa9b7496abe4f8f5661cb5eb3bf. It is recommended to upgrade the affected component. The identifier of this vulnerability is VDB-216480.",
    "cve_publish_date": "2022-12-21",
    "cwe_id": "CWE-79",
    "cwe_name": "Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting')",
    "cwe_description": "The product does not neutralize or incorrectly neutralizes user-controllable input before it is placed in output that is used as a web page that is served to other users.",
    "commit_message": "Fixed XSS",
    "type_of_change": "Modification",
    "filename_of_changes": "ban-options.php",
    "code_language": "PHP",
    "number_of_lines_added_for_mitigation": "60",
    "number_of_lines_deleted_vulnerable_to_cve": "51",
    "vulnerable_lines": [
        "// Line_Reference 27:     $banned_message             = ! empty( $_POST['banned_template_message'] )  ? trim( $_POST['banned_template_message'] ) : '';",
        "// Line_Reference 30:     if(!empty($banned_ips_post)) {",
        "// Line_Reference 31:         foreach($banned_ips_post as $banned_ip) {",
        "// Line_Reference 32:             if($admin_login == 'admin' && ($banned_ip == ban_get_ip() || is_admin_ip($banned_ip))) {",
        "// Line_Reference 33:                 $text .= '<p style=\"color: blue;\">'.sprintf(__('This IP \\'%s\\' Belongs To The Admin And Will Not Be Added To Ban List', 'wp-ban'),$banned_ip).'</p>';",
        "// Line_Reference 35:                 $banned_ips[] = trim($banned_ip);",
        "// Line_Reference 41:     if( ! empty( $banned_ips_range_post ) ) {",
        "// Line_Reference 44:             if( sizeof( $range ) === 2 ) {",
        "// Line_Reference 47:                 if( $admin_login === 'admin' && ( check_ip_within_range( ban_get_ip(), $range_start, $range_end ) ) ) {",
        "// Line_Reference 48:                     $text .= '<p style=\"color: blue;\">'.sprintf( __( 'The Admin\\'s IP \\'%s\\' Fall Within This Range (%s - %s) And Will Not Be Added To Ban List', 'wp-ban' ), ban_get_ip(), $range_start, $range_end ).'</p>';",
        "// Line_Reference 50:                     $banned_ips_range[] = trim( $banned_ip_range );",
        "// Line_Reference 57:     if(!empty($banned_hosts_post)) {",
        "// Line_Reference 58:         foreach($banned_hosts_post as $banned_host) {",
        "// Line_Reference 59:             if($admin_login == 'admin' && ($banned_host == @gethostbyaddr(ban_get_ip()) || is_admin_hostname($banned_host))) {",
        "// Line_Reference 60:                 $text .= '<p style=\"color: blue;\">'.sprintf(__('This Hostname \\'%s\\' Belongs To The Admin And Will Not Be Added To Ban List', 'wp-ban'), $banned_host).'</p>';",
        "// Line_Reference 62:                 $banned_hosts[] = trim($banned_host);",
        "// Line_Reference 68:     if(!empty($banned_referers_post)) {",
        "// Line_Reference 69:         foreach($banned_referers_post as $banned_referer) {",
        "// Line_Reference 70:             if(is_admin_referer($banned_referer)) {",
        "// Line_Reference 71:                 $text .= '<p style=\"color: blue;\">'.sprintf(__('This Referer \\'%s\\' Belongs To This Site And Will Not Be Added To Ban List', 'wp-ban'), $banned_referer).'</p>';",
        "// Line_Reference 73:                 $banned_referers[] = trim($banned_referer);",
        "// Line_Reference 79:     if(!empty($banned_user_agents_post)) {",
        "// Line_Reference 80:         foreach($banned_user_agents_post as $banned_user_agent) {",
        "// Line_Reference 81:             if(is_admin_user_agent($banned_user_agent)) {",
        "// Line_Reference 82:                 $text .= '<p style=\"color: blue;\">'.sprintf(__('This User Agent \\'%s\\' Is Used By The Current Admin And Will Not Be Added To Ban List', 'wp-ban'), $banned_user_agent).'</p>';",
        "// Line_Reference 84:                 $banned_user_agents[] = trim($banned_user_agent);",
        "// Line_Reference 90:     if(!empty($banned_exclude_ips_post)) {",
        "// Line_Reference 91:         foreach($banned_exclude_ips_post as $banned_exclude_ip) {",
        "// Line_Reference 92:             $banned_exclude_ips[] = trim($banned_exclude_ip);",
        "// Line_Reference 97:     $update_ban_queries[] = update_option('banned_ips', $banned_ips);",
        "// Line_Reference 98:     $update_ban_queries[] = update_option('banned_ips_range', $banned_ips_range);",
        "// Line_Reference 99:     $update_ban_queries[] = update_option('banned_hosts', $banned_hosts);",
        "// Line_Reference 100:     $update_ban_queries[] = update_option('banned_referers', $banned_referers);",
        "// Line_Reference 101:     $update_ban_queries[] = update_option('banned_user_agents', $banned_user_agents);",
        "// Line_Reference 102:     $update_ban_queries[] = update_option('banned_exclude_ips', $banned_exclude_ips);",
        "// Line_Reference 103:     $update_ban_queries[] = update_option('banned_message', $banned_message);",
        "// Line_Reference 106:     $update_ban_text[] = __('Banned IPs', 'wp-ban');",
        "// Line_Reference 107:     $update_ban_text[] = __('Banned IP Range', 'wp-ban');",
        "// Line_Reference 108:     $update_ban_text[] = __('Banned Host Names', 'wp-ban');",
        "// Line_Reference 109:     $update_ban_text[] = __('Banned Referers', 'wp-ban');",
        "// Line_Reference 110:     $update_ban_text[] = __('Banned User Agents', 'wp-ban');",
        "// Line_Reference 111:     $update_ban_text[] = __('Banned Excluded IPs', 'wp-ban');",
        "// Line_Reference 112:     $update_ban_text[] = __('Banned Message', 'wp-ban');",
        "// Line_Reference 113:     $i=0;",
        "// Line_Reference 114:     foreach($update_ban_queries as $update_ban_query) {",
        "// Line_Reference 115:         if($update_ban_query) {",
        "// Line_Reference 116:             $text .= '<p style=\"color: green;\">'.$update_ban_text[$i].' '.__('Updated', 'wp-ban').'</p>';",
        "// Line_Reference 120:     if(empty($text)) {",
        "// Line_Reference 121:         $text = '<p style=\"color: red;\">'.__('No Ban Option Updated', 'wp-ban').'</p>';",
        "// Line_Reference 205:                 default_template = \"<!DOCTYPE html>\\n<html>\\n<head>\\n<meta charset=\\\"utf-8\\\">\\n<title>%SITE_NAME% - %SITE_URL%</title>\\n</head>\\n<body>\\n<div id=\\\"wp-ban-container\\\">\\n<p style=\\\"text-align: center; font-weight: bold;\\\"><?php _e('You Are Banned.', 'wp-ban'); ?></p>\\n</div>\\n</body>\\n</html>\";",
        "// Line_Reference 279:             <td valign=\"top\" colspan=\"2\" align=\"center\">"
    ]
}
