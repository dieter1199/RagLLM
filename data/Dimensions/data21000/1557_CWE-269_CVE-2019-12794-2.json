{
    "cve_id": "CVE-2019-12794",
    "cve_description": "An issue was discovered in MISP 2.4.108. Organization admins could reset credentials for site admins (organization admins have the inherent ability to reset passwords for all of their organization's users). This, however, could be abused in a situation where the host organization of an instance creates organization admins. An organization admin could set a password manually for the site admin or simply use the API key of the site admin to impersonate them. The potential for abuse only occurs when the host organization creates lower-privilege organization admins instead of the usual site admins. Also, only organization admins of the same organization as the site admin could abuse this.",
    "cve_publish_date": "2019-06-11",
    "cwe_id": "CWE-269",
    "cwe_name": "Improper Privilege Management",
    "cwe_description": "The product does not properly assign, modify, track, or check privileges for an actor, creating an unintended sphere of control for that actor.",
    "commit_message": "fix: [security] Org admins could reset credentials for site admins\n\n- org admins have the inherent ability to reset passwords for all of their org's users\n- this however could be abused if for some reason the host org of an instance would create org admins\n  - the org admin could set a password manually for the site admin or simply use the API key of the site admin to impersonate them\n- the potential for abuse is very circumstancial as it requires the host org to create lower privilege org admins instead of the usual site admins\n- only org admins of the same organisation as the site admin could abuse this\n\n- as reported by Raymond Schippers",
    "type_of_change": "Modification",
    "filename_of_changes": "UsersController.php",
    "code_language": "PHP",
    "number_of_lines_added_for_mitigation": "23",
    "number_of_lines_deleted_vulnerable_to_cve": "8",
    "vulnerable_lines": [
        "// Line_Reference 22:                 'Role' => array('id', 'name', 'perm_auth')",
        "// Line_Reference 353:                             'Role' => array('id', 'name', 'perm_auth')",
        "// Line_Reference 357:                 unset($users['User']['password']);",
        "// Line_Reference 369:                 $this->set('users', $this->paginate());",
        "// Line_Reference 697:                 'conditions' => array('id' => $id),",
        "// Line_Reference 699:                 'fields' => array('id', 'role_id', 'email', 'org_id'),",
        "// Line_Reference 709:             if ($userToEdit['User']['org_id'] != $this->Auth->user('org_id')) {",
        "// Line_Reference 710:                 throw new Exception('Invalid user');"
    ]
}
