{
    "cve_id": "CVE-2024-39897",
    "cve_description": "zot is an OCI image registry. Prior to 2.1.0, the cache driver `GetBlob()` allows read access to any blob without access control check. If a Zot `accessControl` policy allows users read access to some repositories but restricts read access to other repositories and `dedupe` is enabled (it is enabled by default), then an attacker who knows the name of an image and the digest of a blob (that they do not have read access to), they may maliciously read it via a second repository they do have read access to. \n This attack is possible because [`ImageStore.CheckBlob()` calls `checkCacheBlob()`](https://github.com/project-zot/zot/blob/v2.1.0-rc2/pkg/storage/imagestore/imagestore.go#L1158-L1159) to find the blob a global cache by searching for the digest. If it is found, it is copied to the user requested repository with `copyBlob()`. The attack may be mitigated by configuring \"dedupe\": false in the \"storage\" settings. The vulnerability is fixed in 2.1.0.",
    "cve_publish_date": "2024-07-09",
    "cwe_id": "NVD-CWE-noinfo",
    "cwe_name": "Insufficient Information",
    "cwe_description": "There is insufficient information about the issue to classify it; details are unkown or unspecified.",
    "commit_message": "Merge pull request from GHSA-55r9-5mx9-qq7r\n\nwhen a client pushes an image zot's inline dedupe\nwill try to find the blob path corresponding with the blob digest\nthat it's currently pushed and if it's found in the cache\nthen zot will make a symbolic link to that cache entry and report\nto the client that the blob already exists on the location.\n\nBefore this patch authorization was not applied on this process meaning\nthat a user could copy blobs without having permissions on the source repo.\n\nAdded a rule which says that the client should have read permissions on the source repo\nbefore deduping, otherwise just Stat() the blob and return the corresponding status code.\n\nSigned-off-by: Petu Eusebiu <peusebiu@cisco.com>\nCo-authored-by: Petu Eusebiu <peusebiu@cisco.com>",
    "type_of_change": "Modification",
    "filename_of_changes": "routes.go",
    "code_language": "Go",
    "number_of_lines_added_for_mitigation": "74",
    "number_of_lines_deleted_vulnerable_to_cve": "3",
    "vulnerable_lines": [
        "// Line_Reference 908: \tok, blen, err := imgStore.CheckBlob(name, digest)",
        "// Line_Reference 1197: \t\t_, _, err := imgStore.CheckBlob(name, mountDigest)",
        "// Line_Reference 1198: \t\tif err != nil {"
    ]
}
