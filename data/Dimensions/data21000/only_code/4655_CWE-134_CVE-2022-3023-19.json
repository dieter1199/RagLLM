"net/url"
func resetDBWithSessionParams(tctx *tcontext.Context, db *sql.DB, dsn string, params map[string]interface{}) (*sql.DB, error) {
dsn += fmt.Sprintf("&%s=%s", k, url.QueryEscape(s))
newDB, err := sql.Open("mysql", dsn)
if err == nil {
// ping to make sure all session parameters are set correctly
err = newDB.PingContext(tctx)
if err != nil {
newDB.Close()
}
return newDB, errors.Trace(err)