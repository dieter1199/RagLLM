*  Copyright (c) 2010-2013 Phusion
switch (getFileTypeNoFollowSymlinks(path)) {
case FT_NONEXISTANT:
break;
case FT_DIRECTORY:
verifyDirectoryPermissions(path);
break;
default:
throw RuntimeException("'" + path + "' already exists, and is not a directory");
} else if (getFileType(path) != FT_DIRECTORY) {
void verifyDirectoryPermissions(const string &path) {
struct stat buf;
if (stat(path.c_str(), &buf) == -1) {
int e = errno;
throw FileSystemException("Cannot stat() " + path, e, path);
} else if (buf.st_mode != (S_IFDIR | parseModeString("u=rwx,g=rx,o=rx"))) {