context.put("doc", doc);
context.put("cdoc", doc);
vcontext.put("doc", doc.newDocument(context));
vcontext.put("cdoc", vcontext.get("doc"));
XWikiDocument tdoc;
// If the parameter language exists and is empty, it means we want to force loading the regular document
// not a translation. This should be handled later by doing a better separation between locale used in the UI
// and for loading the documents.
if ("".equals(context.getRequest().getParameter("language"))) {
tdoc = doc;
tdoc = doc.getTranslatedDocument(context);
}
try {
String rev = (String) context.get("rev");
if (StringUtils.isNotEmpty(rev)) {
tdoc = getDocument(tdoc, rev, context);
} catch (Exception ex) {
// Invalid version, just use the most recent one
context.put("tdoc", tdoc);
vcontext.put("tdoc", tdoc.newDocument(context));
