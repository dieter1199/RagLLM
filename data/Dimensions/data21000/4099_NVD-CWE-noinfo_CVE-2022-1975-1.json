{
    "cve_id": "CVE-2022-1975",
    "cve_description": "There is a sleep-in-atomic bug in /net/nfc/netlink.c that allows an attacker to crash the Linux kernel by simulating a nfc device from user-space.",
    "cve_publish_date": "2022-08-31",
    "cwe_id": "NVD-CWE-noinfo",
    "cwe_name": "Insufficient Information",
    "cwe_description": "There is insufficient information about the issue to classify it; details are unkown or unspecified.",
    "commit_message": "NFC: netlink: fix sleep in atomic bug when firmware download timeout\n\nThere are sleep in atomic bug that could cause kernel panic during\nfirmware download process. The root cause is that nlmsg_new with\nGFP_KERNEL parameter is called in fw_dnld_timeout which is a timer\nhandler. The call trace is shown below:\n\nBUG: sleeping function called from invalid context at include/linux/sched/mm.h:265\nCall Trace:\nkmem_cache_alloc_node\n__alloc_skb\nnfc_genl_fw_download_done\ncall_timer_fn\n__run_timers.part.0\nrun_timer_softirq\n__do_softirq\n...\n\nThe nlmsg_new with GFP_KERNEL parameter may sleep during memory\nallocation process, and the timer handler is run as the result of\na \"software interrupt\" that should not call any other function\nthat could sleep.\n\nThis patch changes allocation mode of netlink message from GFP_KERNEL\nto GFP_ATOMIC in order to prevent sleep in atomic bug. The GFP_ATOMIC\nflag makes memory allocation operation could be used in atomic context.\n\nFixes: 9674da8759df (\"NFC: Add firmware upload netlink command\")\nFixes: 9ea7187c53f6 (\"NFC: netlink: Rename CMD_FW_UPLOAD to CMD_FW_DOWNLOAD\")\nSigned-off-by: Duoming Zhou <duoming@zju.edu.cn>\nReviewed-by: Krzysztof Kozlowski <krzysztof.kozlowski@linaro.org>\nLink: https://lore.kernel.org/r/20220504055847.38026-1-duoming@zju.edu.cn\nSigned-off-by: Paolo Abeni <pabeni@redhat.com>",
    "type_of_change": "Modification",
    "filename_of_changes": "netlink.c",
    "code_language": "C",
    "number_of_lines_added_for_mitigation": "2",
    "number_of_lines_deleted_vulnerable_to_cve": "2",
    "vulnerable_lines": [
        "// Line_Reference 1247: \tmsg = nlmsg_new(NLMSG_DEFAULT_SIZE, GFP_KERNEL);",
        "// Line_Reference 1263: \tgenlmsg_multicast(&nfc_genl_family, msg, 0, 0, GFP_KERNEL);"
    ]
}
