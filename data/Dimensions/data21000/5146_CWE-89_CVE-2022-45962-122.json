{
    "cve_id": "CVE-2022-45962",
    "cve_description": "Open Solutions for Education, Inc openSIS Community Edition v8.0 and earlier is vulnerable to SQL Injection via CalendarModal.php.",
    "cve_publish_date": "2023-02-13",
    "cwe_id": "CWE-89",
    "cwe_name": "Improper Neutralization of Special Elements used in an SQL Command ('SQL Injection')",
    "cwe_description": "The product constructs all or part of an SQL command using externally-influenced input from an upstream component, but it does not neutralize or incorrectly neutralizes special elements that could modify the intended SQL command when it is sent to a downstream component. Without sufficient removal or quoting of SQL syntax in user-controllable inputs, the generated SQL query can cause those inputs to be interpreted as SQL instead of ordinary user data.",
    "commit_message": "Version 9.0 release\n\nOlder version shifted to branch: Version_8.0",
    "type_of_change": "ModificationType.ADD",
    "filename_of_changes": "SchoolcustomfieldsInc.php",
    "code_language": "PHP",
    "number_of_lines_added_for_mitigation": "68",
    "number_of_lines_deleted_vulnerable_to_cve": "45",
    "vulnerable_lines": [
        "// Line_Reference 32: $fields_RET = DBGet(DBQuery(\"SELECT ID,TITLE,TYPE,SELECT_OPTIONS,DEFAULT_SELECTION,REQUIRED,HIDE FROM school_custom_fields WHERE SYSTEM_FIELD = 'N' AND (SCHOOL_ID='\".UserSchool().\"' OR SCHOOL_ID=0) ORDER BY SORT_ORDER,TITLE\"));",
        "// Line_Reference 34: if(UserSchool())",
        "// Line_Reference 35: {",
        "// Line_Reference 36: \t$custom_RET = DBGet(DBQuery(\"SELECT * FROM schools WHERE ID='\".  UserSchool().\"'\"));",
        "// Line_Reference 40: $num_field_gen= true;",
        "// Line_Reference 42: if(count($fields_RET))",
        "// Line_Reference 43: {",
        "// Line_Reference 45: \tforeach($fields_RET as $field)",
        "// Line_Reference 46: \t{",
        "// Line_Reference 47: \t    if($field['HIDE']=='Y')",
        "// Line_Reference 48: \t        continue;",
        "// Line_Reference 49: ",
        "// Line_Reference 50: \t\tswitch($field['TYPE'])",
        "// Line_Reference 51: \t\t{",
        "// Line_Reference 55: \t\t\t\techo '<label class=\"col-md-4 control-label text-right\">'.$req.$field['TITLE'].''.($field['REQUIRED']=='Y'?'<span class=\"text-danger\"> *</span>':'') .'</label>';",
        "// Line_Reference 56: \t            echo '<div class=\"col-md-8\">';",
        "// Line_Reference 57: \t            echo _makeTextInputSchl('CUSTOM_'.$field['ID'],'','');",
        "// Line_Reference 61: \t\t\tbreak;",
        "// Line_Reference 66: \t\t\t\techo '<label class=\"col-md-4 control-label text-right\">'.$req.$field['TITLE'].''.($field['REQUIRED']=='Y'?'<span class=\"text-danger\"> *</span>':'') .'</label>';",
        "// Line_Reference 68: \t            echo _makeAutoSelectInputSchl('CUSTOM_'.$field['ID'],'','values');",
        "// Line_Reference 72: \t\t\tbreak;",
        "// Line_Reference 77: \t\t\t\techo '<label class=\"col-md-4 control-label text-right\">'.$req.$field['TITLE'].''.($field['REQUIRED']=='Y'?'<span class=\"text-danger\"> *</span>':'') .'</label>';",
        "// Line_Reference 79: \t            echo _makeAutoSelectInputSchl('CUSTOM_'.$field['ID'],'','values');",
        "// Line_Reference 83: \t\t\tbreak;",
        "// Line_Reference 88: \t\t\t\techo '<label class=\"col-md-4 control-label text-right\">'.$req.$field['TITLE'].''.($field['REQUIRED']=='Y'?'<span class=\"text-danger\"> *</span>':'') .'</label>';",
        "// Line_Reference 90: \t            echo _makeTextInputSchl('CUSTOM_'.$field['ID'],'','size=5 maxlength=10 '. ($value['CUSTOM_'.$field['ID']] != '' ? 'onkeydown=\\\"return numberOnly(event);\\\"' : 'onkeydown=\"return numberOnly(event);\"'));",
        "// Line_Reference 94: \t\t\tbreak;",
        "// Line_Reference 99: \t\t\t\techo '<label class=\"col-md-4 control-label text-right\">'.$req.$field['TITLE'].''.($field['REQUIRED']=='Y'?'<span class=\"text-danger\"> *</span>':'') .'</label>';",
        "// Line_Reference 101: \t            echo _makeDateInput_modSchl('CUSTOM_'.$field['ID'],'',$field['ID']);",
        "// Line_Reference 105: \t\t\tbreak;",
        "// Line_Reference 111: \t\t\t\techo '<label class=\"col-md-4 control-label text-right\">'.$req.$field['TITLE'].''.($field['REQUIRED']=='Y'?'<span class=\"text-danger\"> *</span>':'') .'</label>';",
        "// Line_Reference 113: \t            echo _makeSelectInputSchl('CUSTOM_'.$field['ID'],'','values');",
        "// Line_Reference 117: \t\t\tbreak;",
        "// Line_Reference 122: \t\t\t\techo '<label class=\"col-md-4 control-label text-right\">'.$req.$field['TITLE'].''.($field['REQUIRED']=='Y'?'<span class=\"text-danger\"> *</span>':'') .'</label>';",
        "// Line_Reference 124: \t            echo _makeMultipleInputSchl('CUSTOM_'.$field['ID'],'','values');",
        "// Line_Reference 128: \t\t\tbreak;",
        "// Line_Reference 133: \t\t\t\techo '<label class=\"col-md-4 control-label text-right\">'.$req.$field['TITLE'].''.($field['REQUIRED']=='Y'?'<span class=\"text-danger\"> *</span>':'') .'</label>';",
        "// Line_Reference 135: \t            echo _makeCheckboxInputSchl('CUSTOM_'.$field['ID'],'');",
        "// Line_Reference 139: \t\t\tbreak;",
        "// Line_Reference 141: \t        case 'textarea':",
        "// Line_Reference 144: \t            echo '<label class=\"col-md-4 control-label text-right\">'.$req.$field['TITLE'].''.($field['REQUIRED']=='Y'?'<span class=\"text-danger\"> *</span>':'') .'</label>';",
        "// Line_Reference 145: \t            echo '<div class=\"col-md-8\">';",
        "// Line_Reference 146: \t            echo _makeTextareaInputSchl('CUSTOM_'.$field['ID'],'');",
        "// Line_Reference 150: \t        break;",
        "// Line_Reference 154: ?>"
    ]
}
