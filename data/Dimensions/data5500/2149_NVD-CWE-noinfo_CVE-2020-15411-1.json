{
    "cve_id": "CVE-2020-15411",
    "cve_description": "An issue was discovered in MISP 2.4.128. app/Controller/AttributesController.php has insufficient ACL checks in the attachment downloader.",
    "cve_publish_date": "2020-06-30",
    "cwe_id": "NVD-CWE-noinfo",
    "cwe_name": "Insufficient Information",
    "cwe_description": "There is insufficient information about the issue to classify it; details are unkown or unspecified.",
    "commit_message": "fix: [security] Insufficient ACL checks in the attachment downloader fixed\n- Thanks to Jakub Onderka for reporting it",
    "type_of_change": "Modification",
    "filename_of_changes": "AttributesController.php",
    "code_language": "PHP",
    "number_of_lines_added_for_mitigation": "25",
    "number_of_lines_deleted_vulnerable_to_cve": "28",
    "vulnerable_lines": [
        "// Line_Reference 352:         $this->Attribute->id = $id;",
        "// Line_Reference 353:         if (!$this->Attribute->exists()) {",
        "// Line_Reference 354:             throw new NotFoundException(__('Invalid attribute'));",
        "// Line_Reference 356:         $this->Attribute->read();",
        "// Line_Reference 357:         if (!$this->_isSiteAdmin() &&",
        "// Line_Reference 358:             $this->Auth->user('org_id') !=",
        "// Line_Reference 359:             $this->Attribute->data['Event']['org_id'] &&",
        "// Line_Reference 360:             (",
        "// Line_Reference 361:                 $this->Attribute->data['Event']['distribution'] == 0 ||",
        "// Line_Reference 362:                 $this->Attribute->data['Attribute']['distribution'] == 0",
        "// Line_Reference 363:             )) {",
        "// Line_Reference 364:             throw new UnauthorizedException(__('You do not have the permission to view this event.'));",
        "// Line_Reference 365:         }",
        "// Line_Reference 366:         $this->__downloadAttachment($this->Attribute->data['Attribute']);",
        "// Line_Reference 2019:         $this->Attribute->id = $id;",
        "// Line_Reference 2020:         if (!$this->Attribute->exists()) {",
        "// Line_Reference 2021:             throw new NotFoundException(__('Invalid attribute or no authorisation to view it.'));",
        "// Line_Reference 2022:         }",
        "// Line_Reference 2023:         $this->Attribute->read(null, $id);",
        "// Line_Reference 2024:         if (!$user['User']['siteAdmin'] &&",
        "// Line_Reference 2025:             $user['User']['org_id'] != $this->Attribute->data['Event']['org_id'] &&",
        "// Line_Reference 2026:             (",
        "// Line_Reference 2027:                 $this->Attribute->data['Event']['distribution'] == 0 ||",
        "// Line_Reference 2028:                 $this->Attribute->data['Attribute']['distribution'] == 0",
        "// Line_Reference 2029:             )) {",
        "// Line_Reference 2030:             throw new NotFoundException(__('Invalid attribute or no authorisation to view it.'));",
        "// Line_Reference 2031:         }",
        "// Line_Reference 2032:         $this->__downloadAttachment($this->Attribute->data['Attribute']);"
    ]
}
