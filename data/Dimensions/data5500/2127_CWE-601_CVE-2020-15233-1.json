{
    "cve_id": "CVE-2020-15233",
    "cve_description": "ORY Fosite is a security first OAuth2 & OpenID Connect framework for Go. In Fosite from version 0.30.2 and before version 0.34.1, there is an issue in which an an attacker can override the registered redirect URL by performing an OAuth flow and requesting a redirect URL that is to the loopback adapter. Attackers can provide both custom URL query parameters to their loopback redirect URL, as well as actually overriding the host of the registered redirect URL. These attacks are only applicable in scenarios where the attacker has access over the loopback interface. This vulnerability has been patched in ORY Fosite v0.34.1.",
    "cve_publish_date": "2020-10-02",
    "cwe_id": "CWE-601",
    "cwe_name": "URL Redirection to Untrusted Site ('Open Redirect')",
    "cwe_description": "A web application accepts a user-controlled input that specifies a link to an external site, and uses that link in a Redirect. This simplifies phishing attacks.",
    "commit_message": "fix: make redirect URL checking more strict\n\nThe OAuth 2.0 Client's Redirect URL and the Redirect URL used in the OAuth 2.0 flow do not check if the query string is equal:\n\n1. Registering a client with allowed redirect URL `https://example.com/callback`\n2. Performing OAuth2 flow and requesting redirect URL `https://example.com/callback?bar=foo`\n3. Instead of an error, the browser is redirected to `https://example.com/callback?bar=foo` with a potentially successful OAuth2 response.\n\nAdditionally, matching Redirect URLs used `strings.ToLower` normalization:\n\n1. Registering a client with allowed redirect URL `https://example.com/callback`\n2. Performing OAuth2 flow and requesting redirect URL `https://example.com/CALLBACK`\n3. Instead of an error, the browser is redirected to `https://example.com/CALLBACK ` with a potentially successful OAuth2 response.\n\nThis patch addresses all of these issues and adds regression tests to keep the implementation secure in future releases.",
    "type_of_change": "Modification",
    "filename_of_changes": "authorize_helper.go",
    "code_language": "Go",
    "number_of_lines_added_for_mitigation": "17",
    "number_of_lines_deleted_vulnerable_to_cve": "7",
    "vulnerable_lines": [
        "// Line_Reference 121: \t\tif strings.ToLower(b) == strings.ToLower(uri) || isLoopbackURI(requested, b) {",
        "// Line_Reference 128: func isLoopbackURI(requested *url.URL, registeredURI string) bool {",
        "// Line_Reference 134: \tif registered.Scheme != \"http\" || !isLoopbackAddress(registered.Host) {",
        "// Line_Reference 135: \t\treturn false",
        "// Line_Reference 136: \t}",
        "// Line_Reference 137: ",
        "// Line_Reference 138: \tif requested.Scheme == \"http\" && isLoopbackAddress(requested.Host) && registered.Path == requested.Path {"
    ]
}
