{
    "cve_id": "CVE-2021-3729",
    "cve_description": "firefly-iii is vulnerable to Cross-Site Request Forgery (CSRF)",
    "cve_publish_date": "2021-08-23",
    "cwe_id": "CWE-352",
    "cwe_name": "Cross-Site Request Forgery (CSRF)",
    "cwe_description": "The web application does not, or can not, sufficiently verify whether a well-formed, valid, consistent request was intentionally provided by the user who submitted the request.",
    "commit_message": "Fix https://huntr.dev/bounties/d32f3d5a-0738-41ba-89de-34f2a772de76/",
    "type_of_change": "Modification",
    "filename_of_changes": "CurrencyController.php",
    "code_language": "PHP",
    "number_of_lines_added_for_mitigation": "49",
    "number_of_lines_deleted_vulnerable_to_cve": "37",
    "vulnerable_lines": [
        "// Line_Reference 44:     protected UserRepositoryInterface $userRepository;",
        "// Line_Reference 57:                 app('view')->share('title', (string) trans('firefly.currencies'));",
        "// Line_Reference 78:             $request->session()->flash('error', (string) trans('firefly.ask_site_owner', ['owner' => e(config('firefly.site_owner'))]));",
        "// Line_Reference 84:         $subTitle     = (string) trans('firefly.create_currency');",
        "// Line_Reference 105:     public function defaultCurrency(Request $request, TransactionCurrency $currency)",
        "// Line_Reference 107:         app('preferences')->set('currencyPreference', $currency->code);",
        "// Line_Reference 108:         app('preferences')->mark();",
        "// Line_Reference 109: ",
        "// Line_Reference 110:         Log::channel('audit')->info(sprintf('Make %s the default currency.', $currency->code));",
        "// Line_Reference 111: ",
        "// Line_Reference 112:         $this->repository->enable($currency);",
        "// Line_Reference 113:         $request->session()->flash('success', (string) trans('firefly.new_default_currency', ['name' => $currency->name]));",
        "// Line_Reference 132:             $request->session()->flash('error', (string) trans('firefly.ask_site_owner', ['owner' => e(config('firefly.site_owner'))]));",
        "// Line_Reference 141:             $message  = (string) trans(sprintf('firefly.cannot_disable_currency_%s', $location), ['name' => e($currency->name)]);",
        "// Line_Reference 150:         $subTitle = (string) trans('form.delete_currency', ['name' => $currency->name]);",
        "// Line_Reference 170:             $request->session()->flash('error', (string) trans('firefly.ask_site_owner', ['owner' => e(config('firefly.site_owner'))]));",
        "// Line_Reference 178:             $request->session()->flash('error', (string) trans('firefly.cannot_delete_currency', ['name' => e($currency->name)]));",
        "// Line_Reference 185:             $request->session()->flash('error', (string) trans('firefly.cannot_delete_fallback_currency', ['name' => e($currency->name)]));",
        "// Line_Reference 194:         $request->session()->flash('success', (string) trans('firefly.deleted_currency', ['name' => $currency->name]));",
        "// Line_Reference 203:      * @throws FireflyException",
        "// Line_Reference 214:             $request->session()->flash('error', (string) trans('firefly.ask_site_owner', ['owner' => e(config('firefly.site_owner'))]));",
        "// Line_Reference 224:             $message  = (string) trans(sprintf('firefly.cannot_disable_currency_%s', $location), ['name' => e($currency->name)]);",
        "// Line_Reference 248:             session()->flash('warning', (string) trans('firefly.disable_EUR_side_effects'));",
        "// Line_Reference 251:         session()->flash('success', (string) trans('firefly.currency_is_now_disabled', ['name' => $currency->name]));",
        "// Line_Reference 270:             $request->session()->flash('error', (string) trans('firefly.ask_site_owner', ['owner' => e(config('firefly.site_owner'))]));",
        "// Line_Reference 278:         $subTitle         = (string) trans('breadcrumbs.edit_currency', ['name' => $currency->name]);",
        "// Line_Reference 284:             'enabled' => $hasOldInput ? (bool) $request->old('enabled') : $currency->enabled,",
        "// Line_Reference 309:         session()->flash('success', (string) trans('firefly.currency_is_now_enabled', ['name' => $currency->name]));",
        "// Line_Reference 326:         $page       = 0 === (int) $request->get('page') ? 1 : (int) $request->get('page');",
        "// Line_Reference 327:         $pageSize   = (int) app('preferences')->get('listPageSize', 50)->data;",
        "// Line_Reference 337:             $request->session()->flash('info', (string) trans('firefly.ask_site_owner', ['owner' => config('firefly.site_owner')]));",
        "// Line_Reference 370:             $request->session()->flash('error', (string) trans('firefly.could_not_store_currency'));",
        "// Line_Reference 376:             $request->session()->flash('success', (string) trans('firefly.created_currency', ['name' => $currency->name]));",
        "// Line_Reference 378:             if (1 === (int) $request->get('create_another')) {",
        "// Line_Reference 408:             $request->session()->flash('error', (string) trans('firefly.ask_site_owner', ['owner' => e(config('firefly.site_owner'))]));",
        "// Line_Reference 416:         $request->session()->flash('success', (string) trans('firefly.updated_currency', ['name' => $currency->name]));",
        "// Line_Reference 419:         if (1 === (int) $request->get('return_to_edit')) {"
    ]
}
