{
    "cve_id": "CVE-2020-13795",
    "cve_description": "An issue was discovered in Navigate CMS through 2.8.7. It allows Directory Traversal because lib/packages/templates/template.class.php mishandles ../ and ..\\ substrings.",
    "cve_publish_date": "2020-06-03",
    "cwe_id": "CWE-22",
    "cwe_name": "Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal')",
    "cwe_description": "The product uses external input to construct a pathname that is intended to identify a file or directory that is located underneath a restricted parent directory, but the product does not properly neutralize special elements within the pathname that can cause the pathname to resolve to a location that is outside of the restricted directory.",
    "commit_message": "* template.class: filter file location path",
    "type_of_change": "Modification",
    "filename_of_changes": "templates.php",
    "code_language": "PHP",
    "number_of_lines_added_for_mitigation": "181",
    "number_of_lines_deleted_vulnerable_to_cve": "101",
    "vulnerable_lines": [
        "// Line_Reference 280: \t\t$navibars->title(t(20, 'Templates').' / '.t(38, 'Create'));",
        "// Line_Reference 282: \t\t$navibars->title(t(20, 'Templates').' / '.t(170, 'Edit').' ['.$item->id.']');",
        "// Line_Reference 292: \t\t$navibars->add_actions(\t\tarray(\t'<a href=\"#\" onclick=\"navigate_tabform_submit(1);\"><img height=\"16\" align=\"absmiddle\" width=\"16\" src=\"img/icons/silk/accept.png\"> '.t(34, 'Save').'</a>'\t)",
        "// Line_Reference 293: \t\t\t\t\t\t\t\t\t);",
        "// Line_Reference 297: \t\t$navibars->add_actions(\t\tarray(\t'<a href=\"#\" onclick=\"navigate_tabform_submit(1);\"><img height=\"16\" align=\"absmiddle\" width=\"16\" src=\"img/icons/silk/accept.png\"> '.t(34, 'Save').'</a>',",
        "// Line_Reference 298: \t\t\t\t\t\t\t\t\t\t\t'<a href=\"#\" onclick=\"navigate_delete_dialog();\"><img height=\"16\" align=\"absmiddle\" width=\"16\" src=\"img/icons/silk/cancel.png\"> '.t(35, 'Delete').'</a>'",
        "// Line_Reference 299: \t\t\t\t\t\t\t\t\t\t)",
        "// Line_Reference 300: \t\t\t\t\t\t\t\t\t);",
        "// Line_Reference 330: \t$navibars->add_actions(\tarray(\t(!empty($item->id)? '<a href=\"?fid=templates&act=2\"><img height=\"16\" align=\"absmiddle\" width=\"16\" src=\"img/icons/silk/add.png\"> '.t(38, 'Create').'</a>' : ''),",
        "// Line_Reference 331: \t\t\t\t\t\t\t\t\t'<a href=\"?fid=templates&act=0\"><img height=\"16\" align=\"absmiddle\" width=\"16\" src=\"img/icons/silk/application_view_list.png\"> '.t(39, 'List').'</a>',",
        "// Line_Reference 332: \t\t\t\t\t\t\t\t\t'search_form' ));",
        "// Line_Reference 341: \t$navibars->add_tab_content_row(array(\t'<label>ID</label>',",
        "// Line_Reference 342: \t\t\t\t\t\t\t\t\t\t\t'<span>'.(!empty($item->id)? $item->id : t(52, '(new)')).'</span>' ));",
        "// Line_Reference 344: \t$navibars->add_tab_content_row(array(\t'<label>'.t(67, 'Title').'</label>',",
        "// Line_Reference 345: \t\t\t\t\t\t\t\t\t\t\t$naviforms->textfield('title', $item->title),",
        "// Line_Reference 346: \t\t\t\t\t\t\t\t\t\t));",
        "// Line_Reference 350:         $navibars->add_tab_content_row(array(\t'<label>'.t(82, 'File').'</label>',",
        "// Line_Reference 351:                                                         '<span>'.$item->file.'</span>'",
        "// Line_Reference 352:                                                     ));",
        "// Line_Reference 448: \t$navibars->add_tab_content_row(array(\t'<label>'.t(68, 'Status').'</label>',",
        "// Line_Reference 449: \t\t\t\t\t\t\t\t\t\t\t$naviforms->selectfield('permission',",
        "// Line_Reference 450: \t\t\t\t\t\t\t\t\t\t\t\tarray(",
        "// Line_Reference 451: \t\t\t\t\t\t\t\t\t\t\t\t\t\t0 => 0,",
        "// Line_Reference 452: \t\t\t\t\t\t\t\t\t\t\t\t\t\t1 => 1,",
        "// Line_Reference 453: \t\t\t\t\t\t\t\t\t\t\t\t\t\t2 => 2",
        "// Line_Reference 454: \t\t\t\t\t\t\t\t\t\t\t\t\t),",
        "// Line_Reference 455: \t\t\t\t\t\t\t\t\t\t\t\tarray(",
        "// Line_Reference 456: \t\t\t\t\t\t\t\t\t\t\t\t\t\t0 => t(69, 'Published'),",
        "// Line_Reference 457: \t\t\t\t\t\t\t\t\t\t\t\t\t\t1 => t(70, 'Private'),",
        "// Line_Reference 458: \t\t\t\t\t\t\t\t\t\t\t\t\t\t2 => t(81, 'Hidden')",
        "// Line_Reference 459: \t\t\t\t\t\t\t\t\t\t\t\t\t),",
        "// Line_Reference 460: \t\t\t\t\t\t\t\t\t\t\t\t$item->permission,",
        "// Line_Reference 461: \t\t\t\t\t\t\t\t\t\t\t\t'',",
        "// Line_Reference 462: \t\t\t\t\t\t\t\t\t\t\t\tfalse,",
        "// Line_Reference 463: \t\t\t\t\t\t\t\t\t\t\t\tarray(",
        "// Line_Reference 464: \t\t\t\t\t\t\t\t\t\t\t\t\t\t0 => t(360, 'Visible to everybody'),",
        "// Line_Reference 465: \t\t\t\t\t\t\t\t\t\t\t\t\t\t1 => t(359, 'Visible only to Navigate CMS users'),",
        "// Line_Reference 466: \t\t\t\t\t\t\t\t\t\t\t\t\t\t2 => t(358, 'Hidden to everybody')",
        "// Line_Reference 467: \t\t\t\t\t\t\t\t\t\t\t\t)",
        "// Line_Reference 468: \t\t\t\t\t\t\t\t\t\t\t)",
        "// Line_Reference 469: \t\t\t\t\t\t\t\t\t\t)",
        "// Line_Reference 470: \t\t\t\t\t\t\t\t\t);",
        "// Line_Reference 472: \t$navibars->add_tab_content_row(array(\t'<label>'.t(62, 'Statistics').'</label>',",
        "// Line_Reference 473: \t\t\t\t\t\t\t\t\t\t\t$naviforms->checkbox('statistics', $item->statistics),",
        "// Line_Reference 474: \t\t\t\t\t\t\t\t\t\t));",
        "// Line_Reference 477: \t$navibars->add_tab_content_row(array(\t'<label>'.t(65, 'Enabled').'</label>',",
        "// Line_Reference 478: \t\t\t\t\t\t\t\t\t\t\t$naviforms->checkbox('enabled', $item->enabled),",
        "// Line_Reference 479: \t\t\t\t\t\t\t\t\t\t));",
        "// Line_Reference 510: \t\t\t$table->addRow($p, array(",
        "// Line_Reference 511: \t\t\t\t\tarray('content' => '<input type=\"text\" name=\"template-sections-code[]\" value=\"'.$item->sections[$p]['code'].'\" style=\"width: 140px;\" />', 'align' => 'left'),",
        "// Line_Reference 512: \t\t\t\t\tarray('content' => '<input type=\"text\" name=\"template-sections-name[]\" value=\"'.template::section_name($item->sections[$p]['name']).'\" style=\"width: 290px;\" />', 'align' => 'left'),",
        "// Line_Reference 513: \t\t\t\t\tarray('content' => $select_editor, 'align' => 'left'),",
        "// Line_Reference 514: \t\t\t\t\tarray('content' => '<div style=\" white-space: nowrap; \"><input type=\"text\" name=\"template-sections-width[]\" value=\"'.template::section_name($item->sections[$p]['width']).'\" style=\"width: 40px;\" /> px</div>', 'align' => 'left'),",
        "// Line_Reference 515: \t\t\t\t\tarray('content' => ((!empty($disabled) || $readonly)? '' : '<img src=\"'.NAVIGATE_URL.'/img/icons/silk/cancel.png\" onclick=\"navigate_templates_sections_remove(this);\" />'), 'align' => 'center')",
        "// Line_Reference 516: \t\t\t\t));",
        "// Line_Reference 521:             $navibars->add_tab_content_row(array(\t'<label>'.t(236, 'Sections').'</label>',",
        "// Line_Reference 522:                                                     '<div>'.$table->generate().'</div>'));",
        "// Line_Reference 526:             $navibars->add_tab_content_row(array(\t'<label>'.t(236, 'Sections').'</label>',",
        "// Line_Reference 527:                                                     '<div>'.$table->generate().'</div>',",
        "// Line_Reference 528:                                                     '<div class=\"subcomment\">",
        "// Line_Reference 529:                                                         <img src=\"img/icons/silk/information.png\" align=\"absmiddle\" /> '.t(72, 'Drag any row to assign priorities').'.",
        "// Line_Reference 530:                                                          '.t(192, 'Double click any row to edit').'",
        "// Line_Reference 531:                                                     </div>' ));",
        "// Line_Reference 532: ",
        "// Line_Reference 533:             $navibars->add_tab_content_row(array(\t'<label>&nbsp;</label>',",
        "// Line_Reference 534:                                                     '<button id=\"templates-sections-create\"><img src=\"img/icons/silk/add.png\" align=\"absmiddle\" style=\"cursor:pointer;\" /> '.t(38, 'Create').'</button>'));",
        "// Line_Reference 549: \t\t\t</form>');",
        "// Line_Reference 597: \t\t$navibars->add_tab_content_row(array(\t'<label>'.t(210, 'Gallery').'</label>',",
        "// Line_Reference 598: \t\t\t\t\t\t\t\t\t\t\t\t$naviforms->checkbox('gallery', $item->gallery),",
        "// Line_Reference 599: \t\t\t\t\t\t\t\t\t\t\t));",
        "// Line_Reference 601: \t\t$navibars->add_tab_content_row(array(\t'<label>'.t(250, 'Comments').'</label>',",
        "// Line_Reference 602: \t\t\t\t\t\t\t\t\t\t\t\t$naviforms->checkbox('comments', $item->comments),",
        "// Line_Reference 603: \t\t\t\t\t\t\t\t\t\t\t));",
        "// Line_Reference 605: \t\t$navibars->add_tab_content_row(array(\t'<label>'.t(265, 'Tags').'</label>',",
        "// Line_Reference 606: \t\t\t\t\t\t\t\t\t\t\t\t$naviforms->checkbox('tags', $item->tags),",
        "// Line_Reference 607: \t\t\t\t\t\t\t\t\t\t\t));",
        "// Line_Reference 627:         $element_types = array(\t'item'\t=> \tt(180, 'Item'),",
        "// Line_Reference 628: \t\t\t\t\t\t\t\t'structure' => t(16, 'Structure')/*,",
        "// Line_Reference 629: \t\t\t\t\t\t\t\t'product' => t(214, 'Product')*/);",
        "// Line_Reference 633: \t\t\t$table->addRow($properties[$p]->id, array(",
        "// Line_Reference 634: \t\t\t\t\tarray('content' => $properties[$p]->name, 'align' => 'left'),",
        "// Line_Reference 635: \t\t\t\t\tarray('content' => $types[$properties[$p]->type], 'align' => 'left'),",
        "// Line_Reference 636: \t\t\t\t\tarray('content' => $element_types[$properties[$p]->element], 'align' => 'left'),",
        "// Line_Reference 637: \t\t\t\t\tarray('content' => '<input type=\"checkbox\" name=\"property-enabled[]\" class=\"raw-checkbox\" value=\"'.$properties[$p]->id.'\" '.(($properties[$p]->enabled=='1'? ' checked=checked ' : '')).' />', 'align' => 'center'),",
        "// Line_Reference 638: \t\t\t\t));",
        "// Line_Reference 643:             $navibars->add_tab_content_row(array(\t'<label>'.t(77, 'Properties').'</label>',",
        "// Line_Reference 644:                                                     '<div>'.$table->generate().'</div>'));",
        "// Line_Reference 648:             $navibars->add_tab_content_row(array(\t'<label>'.t(77, 'Properties').'</label>',",
        "// Line_Reference 649:                                                     '<div>'.$table->generate().'</div>',",
        "// Line_Reference 650:                                                     '<div class=\"subcomment\">",
        "// Line_Reference 651:                                                         <img src=\"img/icons/silk/information.png\" align=\"absmiddle\" /> '.t(72, 'Drag any row to assign priorities').'.",
        "// Line_Reference 652:                                                          '.t(192, 'Double click any row to edit').'",
        "// Line_Reference 653:                                                     </div>' ));",
        "// Line_Reference 654: ",
        "// Line_Reference 655:             $navibars->add_tab_content_row(array(\t'<label>&nbsp;</label>',",
        "// Line_Reference 656:                                                     '<button id=\"templates-properties-create\"><img src=\"img/icons/silk/add.png\" align=\"absmiddle\" /> '.t(38, 'Create').'</button>'));",
        "// Line_Reference 959: \t$DB->query('SELECT sections",
        "// Line_Reference 960: \t\t\t\t  FROM nv_templates",
        "// Line_Reference 961: \t\t\t\t WHERE website = '.intval($website->id),",
        "// Line_Reference 962: \t\t\t\t'array');",
        "// Line_Reference 970: \t\tif(!is_array($sections)) $sections = array();"
    ]
}
