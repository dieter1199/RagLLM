/* Iterate thr' all leaf cfs_rq's on a runqueue */
#define for_each_leaf_cfs_rq_safe(rq, cfs_rq, pos)			\
list_for_each_entry_safe(cfs_rq, pos, &rq->leaf_cfs_rq_list,	\
leaf_cfs_rq_list)
#define for_each_leaf_cfs_rq_safe(rq, cfs_rq, pos)	\
for (cfs_rq = &rq->cfs, pos = NULL; cfs_rq; cfs_rq = pos)
static inline bool cfs_rq_is_decayed(struct cfs_rq *cfs_rq)
{
if (cfs_rq->load.weight)
return false;
if (cfs_rq->avg.load_sum)
return false;
if (cfs_rq->avg.util_sum)
return false;
if (cfs_rq->avg.runnable_load_sum)
return false;
return true;
}
struct cfs_rq *cfs_rq, *pos;
for_each_leaf_cfs_rq_safe(rq, cfs_rq, pos) {
/*
* There can be a lot of idle CPU cgroups.  Don't let fully
* decayed cfs_rqs linger on the list.
*/
if (cfs_rq_is_decayed(cfs_rq))
list_del_leaf_cfs_rq(cfs_rq);
struct cfs_rq *cfs_rq, *pos;
for_each_leaf_cfs_rq_safe(cpu_rq(cpu), cfs_rq, pos)
