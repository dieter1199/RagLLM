$banned_message             = ! empty( $_POST['banned_template_message'] )  ? trim( $_POST['banned_template_message'] ) : '';
if(!empty($banned_ips_post)) {
foreach($banned_ips_post as $banned_ip) {
if($admin_login == 'admin' && ($banned_ip == ban_get_ip() || is_admin_ip($banned_ip))) {
$text .= '<p style="color: blue;">'.sprintf(__('This IP \'%s\' Belongs To The Admin And Will Not Be Added To Ban List', 'wp-ban'),$banned_ip).'</p>';
$banned_ips[] = trim($banned_ip);
if( ! empty( $banned_ips_range_post ) ) {
if( sizeof( $range ) === 2 ) {
if( $admin_login === 'admin' && ( check_ip_within_range( ban_get_ip(), $range_start, $range_end ) ) ) {
$text .= '<p style="color: blue;">'.sprintf( __( 'The Admin\'s IP \'%s\' Fall Within This Range (%s - %s) And Will Not Be Added To Ban List', 'wp-ban' ), ban_get_ip(), $range_start, $range_end ).'</p>';
$banned_ips_range[] = trim( $banned_ip_range );
if(!empty($banned_hosts_post)) {
foreach($banned_hosts_post as $banned_host) {
if($admin_login == 'admin' && ($banned_host == @gethostbyaddr(ban_get_ip()) || is_admin_hostname($banned_host))) {
$text .= '<p style="color: blue;">'.sprintf(__('This Hostname \'%s\' Belongs To The Admin And Will Not Be Added To Ban List', 'wp-ban'), $banned_host).'</p>';
$banned_hosts[] = trim($banned_host);
if(!empty($banned_referers_post)) {
foreach($banned_referers_post as $banned_referer) {
if(is_admin_referer($banned_referer)) {
$text .= '<p style="color: blue;">'.sprintf(__('This Referer \'%s\' Belongs To This Site And Will Not Be Added To Ban List', 'wp-ban'), $banned_referer).'</p>';
$banned_referers[] = trim($banned_referer);
if(!empty($banned_user_agents_post)) {
foreach($banned_user_agents_post as $banned_user_agent) {
if(is_admin_user_agent($banned_user_agent)) {
$text .= '<p style="color: blue;">'.sprintf(__('This User Agent \'%s\' Is Used By The Current Admin And Will Not Be Added To Ban List', 'wp-ban'), $banned_user_agent).'</p>';
$banned_user_agents[] = trim($banned_user_agent);
if(!empty($banned_exclude_ips_post)) {
foreach($banned_exclude_ips_post as $banned_exclude_ip) {
$banned_exclude_ips[] = trim($banned_exclude_ip);
$update_ban_queries[] = update_option('banned_ips', $banned_ips);
$update_ban_queries[] = update_option('banned_ips_range', $banned_ips_range);
$update_ban_queries[] = update_option('banned_hosts', $banned_hosts);
$update_ban_queries[] = update_option('banned_referers', $banned_referers);
$update_ban_queries[] = update_option('banned_user_agents', $banned_user_agents);
$update_ban_queries[] = update_option('banned_exclude_ips', $banned_exclude_ips);
$update_ban_queries[] = update_option('banned_message', $banned_message);
$update_ban_text[] = __('Banned IPs', 'wp-ban');
$update_ban_text[] = __('Banned IP Range', 'wp-ban');
$update_ban_text[] = __('Banned Host Names', 'wp-ban');
$update_ban_text[] = __('Banned Referers', 'wp-ban');
$update_ban_text[] = __('Banned User Agents', 'wp-ban');
$update_ban_text[] = __('Banned Excluded IPs', 'wp-ban');
$update_ban_text[] = __('Banned Message', 'wp-ban');
$i=0;
foreach($update_ban_queries as $update_ban_query) {
if($update_ban_query) {
$text .= '<p style="color: green;">'.$update_ban_text[$i].' '.__('Updated', 'wp-ban').'</p>';
if(empty($text)) {
$text = '<p style="color: red;">'.__('No Ban Option Updated', 'wp-ban').'</p>';
default_template = "<!DOCTYPE html>\n<html>\n<head>\n<meta charset=\"utf-8\">\n<title>%SITE_NAME% - %SITE_URL%</title>\n</head>\n<body>\n<div id=\"wp-ban-container\">\n<p style=\"text-align: center; font-weight: bold;\"><?php _e('You Are Banned.', 'wp-ban'); ?></p>\n</div>\n</body>\n</html>";
<td valign="top" colspan="2" align="center">