use SilverStripe\Omnipay\Exception\InvalidStateException;
use SilverStripe\Omnipay\Model\Message;
$this->createMessage(Message\CreateCardRequest::class, $request);
$this->createMessage(Message\CreateCardError::class, $e);
$serviceResponse->isRedirect() ? Message\CreateCardRedirectResponse::class : Message\AwaitingCreateCardResponse::class,
$this->createMessage(Message\CreateCardError::class, $response);
} else {
$this->createMessage(Message\CompleteCreateCardRequest::class, $request);
$this->createMessage(Message\CompleteCreateCardError::class, $e);
if ($serviceResponse->isError()) {
$this->createMessage(Message\CompleteCreateCardError::class, $response);
return $serviceResponse;
}
if (!$serviceResponse->isAwaitingNotification()) {
$this->markCompleted('CardCreated', $serviceResponse, $response);
} else {
$this->createMessage(Message\CreateCardResponse::class, $gatewayMessage);
