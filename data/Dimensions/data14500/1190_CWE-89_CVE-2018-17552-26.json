{
    "cve_id": "CVE-2018-17552",
    "cve_description": "SQL Injection in login.php in Naviwebs Navigate CMS 2.8 allows remote attackers to bypass authentication via the navigate-user cookie.",
    "cve_publish_date": "2018-10-03",
    "cwe_id": "CWE-89",
    "cwe_name": "Improper Neutralization of Special Elements used in an SQL Command ('SQL Injection')",
    "cwe_description": "The product constructs all or part of an SQL command using externally-influenced input from an upstream component, but it does not neutralize or incorrectly neutralizes special elements that could modify the intended SQL command when it is sent to a downstream component. Without sufficient removal or quoting of SQL syntax in user-controllable inputs, the generated SQL query can cause those inputs to be interpreted as SQL instead of ordinary user data.",
    "commit_message": "* security fix: replace string filtering by parameterization in almost all queries",
    "type_of_change": "Modification",
    "filename_of_changes": "items.php",
    "code_language": "PHP",
    "number_of_lines_added_for_mitigation": "142",
    "number_of_lines_deleted_vulnerable_to_cve": "86",
    "vulnerable_lines": [
        "// Line_Reference 40:                     $tag = $_REQUEST['tag'];",
        "// Line_Reference 41:                     $lang = $_REQUEST['lang'];",
        "// Line_Reference 42: ",
        "// Line_Reference 50:                                     AND d.lang = '.protect($lang).'",
        "// Line_Reference 51:                                     AND d.website = '.$website->id.'",
        "// Line_Reference 54:                                  WHERE website = ' . $website->id . '",
        "// Line_Reference 57:                                    AND lang = ' . protect($lang) . '",
        "// Line_Reference 58:                                    AND FIND_IN_SET('.protect($tag).', text) > 0",
        "// Line_Reference 60:                         ORDER BY i.id DESC",
        "// Line_Reference 61:                     ');",
        "// Line_Reference 228:                             $category_text = '[ '.strtolower(t(100, 'Free')).' ]';",
        "// Line_Reference 468: \t\t\t$DB->query('SELECT id, date_created, autosave",
        "// Line_Reference 469: \t\t\t\t\t\t  FROM nv_webdictionary_history",
        "// Line_Reference 470: \t\t\t\t\t\t WHERE node_type = \"item\"",
        "// Line_Reference 471: \t\t\t\t\t\t   AND subtype = '.protect('section-'.$_REQUEST['section']).'",
        "// Line_Reference 472: \t\t\t\t\t\t   AND lang = '.protect($_GET['lang']).'",
        "// Line_Reference 473: \t\t\t\t\t\t   AND node_id = '.protect($_REQUEST['id']).'",
        "// Line_Reference 474: \t\t\t\t\t\t   AND website = '.$website->id.'",
        "// Line_Reference 475: \t\t\t\t      ORDER BY date_created DESC',",
        "// Line_Reference 476: \t\t\t\t\t\t'array');",
        "// Line_Reference 500: \t\t\t\t   AND lang = '.protect($_REQUEST['lang']).'",
        "// Line_Reference 501: \t\t\t\t   AND website = '.$website->id.'",
        "// Line_Reference 502: \t\t\t\t   AND text LIKE '.protect('%'.$_REQUEST['title'].'%').'",
        "// Line_Reference 505: \t\t\t\t'array'",
        "// Line_Reference 523: \t\t\t\t\t\t\t   AND website = '.$website->id.'",
        "// Line_Reference 524: \t\t\t\t\t\t\t   AND id = '.protect($_REQUEST['id']),",
        "// Line_Reference 532: \t\t\t\t$DB->query('SELECT text",
        "// Line_Reference 533: \t\t\t\t\t\t\t  FROM nv_webdictionary",
        "// Line_Reference 534: \t\t\t\t\t\t\t WHERE node_type = \"item\"",
        "// Line_Reference 535: \t\t\t\t\t\t\t   AND subtype = '.protect('section-'.$_REQUEST['section']).'",
        "// Line_Reference 536: \t\t\t\t\t\t\t   AND lang = '.protect($_REQUEST['lang']).'",
        "// Line_Reference 537: \t\t\t\t\t\t\t   AND website = '.$website->id.'",
        "// Line_Reference 538: \t\t\t\t\t\t\t   AND node_id = '.protect($_REQUEST['node_id']),",
        "// Line_Reference 539: \t\t\t\t\t\t\t'array');",
        "// Line_Reference 546: \t\t\t\t$DB->query('SELECT text",
        "// Line_Reference 547: \t\t\t\t\t\t\t  FROM nv_webdictionary",
        "// Line_Reference 548: \t\t\t\t\t\t\t WHERE node_type = \"property-item\"",
        "// Line_Reference 549: \t\t\t\t\t\t\t   AND subtype = '.protect('property-'.$_REQUEST['section'].'-'.$_REQUEST['lang']).'",
        "// Line_Reference 550: \t\t\t\t\t\t\t   AND lang = '.protect($_REQUEST['lang']).'",
        "// Line_Reference 551: \t\t\t\t\t\t\t   AND website = '.$website->id.'",
        "// Line_Reference 552: \t\t\t\t\t\t\t   AND node_id = '.protect($_REQUEST['node_id']),",
        "// Line_Reference 553: \t\t\t\t\t\t\t'array');",
        "// Line_Reference 554: ",
        "// Line_Reference 564: \t\t\t$DB->query('SELECT file",
        "// Line_Reference 565: \t\t\t\t\t\t  FROM nv_templates",
        "// Line_Reference 566: \t\t\t\t\t\t WHERE enabled = 1",
        "// Line_Reference 567: \t\t\t\t\t\t   AND id = '.protect($_REQUEST['id']).'",
        "// Line_Reference 568: \t\t\t\t\t\t   AND website = '.$website->id,",
        "// Line_Reference 569: \t\t\t\t\t\t'array');",
        "// Line_Reference 629: \t\t\t$id = $_REQUEST['id'];",
        "// Line_Reference 630: ",
        "// Line_Reference 631: \t\t\t$DB->query('SELECT type, object_id, lang",
        "// Line_Reference 632: \t \t\t\t\t\t  FROM nv_paths",
        "// Line_Reference 633: \t\t\t\t\t\t WHERE path = '.protect($path).'",
        "// Line_Reference 634: \t\t\t\t\t\t   AND website = '.$website->id);",
        "// Line_Reference 652: \t\t\t\t WHERE username LIKE '.protect('%'.$_REQUEST['username'].'%').'",
        "// Line_Reference 655: \t\t\t\t'array",
        "// Line_Reference 656: \t\t\t');",
        "// Line_Reference 683:                 $template_filter = ' AND nvi.template = '.protect($_REQUEST['template']).' ';",
        "// Line_Reference 686:                 $template_filter = ' AND nvi.association = '.protect($_REQUEST['association']).' ';",
        "// Line_Reference 689:                 $template_filter = ' AND nvi.embedding = '.protect($_REQUEST['embedding']).' ';",
        "// Line_Reference 690: ",
        "// Line_Reference 691:             $text = $_REQUEST['title'];",
        "// Line_Reference 692:             if(!empty($_REQUEST['term'])) // tagit request",
        "// Line_Reference 693:                 $text = $_REQUEST['term'];",
        "// Line_Reference 698: ",
        "// Line_Reference 706: \t\t\t\t   AND nvw.website = '.$website->id.'",
        "// Line_Reference 708: \t\t\t\t   AND ( nvw.text LIKE ' . protect('%' . $text . '%') . '",
        "// Line_Reference 709: \t\t\t\t        OR",
        "// Line_Reference 710: \t\t\t\t        ( nvi.id LIKE  ' . protect('%' . $text . '%') . '",
        "// Line_Reference 711: \t\t\t\t          AND",
        "// Line_Reference 712: \t\t\t\t          nvw.lang = '.protect($website->languages_published[0]).'",
        "// Line_Reference 713: \t\t\t\t        )",
        "// Line_Reference 714: \t\t\t\t       )",
        "// Line_Reference 720:             $DB->query($sql, 'array');",
        "// Line_Reference 731: \t\t\t\t\t\t'\twebsite = '.protect($website->id).' AND",
        "// Line_Reference 2095: \t\t\t$template_id = $DB->query_single('template', 'nv_structure', ' id = '.protect($item->category).' AND website = '.$website->id);",
        "// Line_Reference 2156: \t\t\t$DB->query('SELECT nvc.*, nvwu.username, nvwu.avatar",
        "// Line_Reference 2157: \t\t\t\t\t\t  FROM nv_comments nvc",
        "// Line_Reference 2158: \t\t\t\t\t\t LEFT OUTER JOIN nv_webusers nvwu",
        "// Line_Reference 2159: \t\t\t\t\t\t \t\t\t  ON nvwu.id = nvc.user",
        "// Line_Reference 2160: \t\t\t\t\t\t WHERE nvc.website = '.protect($website->id).'",
        "// Line_Reference 2161: \t\t\t\t\t\t   AND nvc.object_type = \"item\"",
        "// Line_Reference 2162: \t\t\t\t\t\t   AND nvc.object_id = '.protect($item->id).'",
        "// Line_Reference 2163: \t\t\t\t\t\tORDER BY nvc.date_created ASC",
        "// Line_Reference 2164: \t\t\t\t\t\tLIMIT 500');"
    ]
}
