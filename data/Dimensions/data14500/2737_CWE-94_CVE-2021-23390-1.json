{
    "cve_id": "CVE-2021-23390",
    "cve_description": "The package total4 before 0.0.43 are vulnerable to Arbitrary Code Execution via the U.set() and U.get() functions.",
    "cve_publish_date": "2021-07-12",
    "cwe_id": "CWE-94",
    "cwe_name": "Improper Control of Generation of Code ('Code Injection')",
    "cwe_description": "The product constructs all or part of a code segment using externally-influenced input from an upstream component, but it does not neutralize or incorrectly neutralizes special elements that could modify the syntax or behavior of the intended code segment.",
    "commit_message": "Removed useless methods.",
    "type_of_change": "Modification",
    "filename_of_changes": "utils.js",
    "code_language": "JavaScript",
    "number_of_lines_added_for_mitigation": "0",
    "number_of_lines_deleted_vulnerable_to_cve": "144",
    "vulnerable_lines": [
        "// Line_Reference 5206: exports.sync = function(fn, owner) {",
        "// Line_Reference 5207: \treturn function() {",
        "// Line_Reference 5208: ",
        "// Line_Reference 5209: \t\tvar args = [].slice.call(arguments);",
        "// Line_Reference 5210: \t\tvar params;",
        "// Line_Reference 5211: \t\tvar callback;",
        "// Line_Reference 5212: \t\tvar executed = false;",
        "// Line_Reference 5213: \t\tvar self = owner || this;",
        "// Line_Reference 5214: ",
        "// Line_Reference 5215: \t\targs.push(function() {",
        "// Line_Reference 5216: \t\t\tparams = arguments;",
        "// Line_Reference 5217: \t\t\tif (!executed && callback) {",
        "// Line_Reference 5218: \t\t\t\texecuted = true;",
        "// Line_Reference 5219: \t\t\t\tcallback.apply(self, params);",
        "// Line_Reference 5220: \t\t\t}",
        "// Line_Reference 5221: \t\t});",
        "// Line_Reference 5222: ",
        "// Line_Reference 5223: \t\tfn.apply(self, args);",
        "// Line_Reference 5224: ",
        "// Line_Reference 5225: \t\treturn function(cb) {",
        "// Line_Reference 5226: \t\t\tcallback = cb;",
        "// Line_Reference 5227: \t\t\tif (!executed && params) {",
        "// Line_Reference 5228: \t\t\t\texecuted = true;",
        "// Line_Reference 5229: \t\t\t\tcallback.apply(self, params);",
        "// Line_Reference 5230: \t\t\t}",
        "// Line_Reference 5231: \t\t};",
        "// Line_Reference 5232: \t};",
        "// Line_Reference 5233: };",
        "// Line_Reference 5234: ",
        "// Line_Reference 5235: exports.sync2 = function(fn, owner) {",
        "// Line_Reference 5236: \treturn (function() {",
        "// Line_Reference 5237: ",
        "// Line_Reference 5238: \t\tvar params;",
        "// Line_Reference 5239: \t\tvar callback;",
        "// Line_Reference 5240: \t\tvar executed = false;",
        "// Line_Reference 5241: \t\tvar self = owner || this;",
        "// Line_Reference 5242: \t\tvar args = [].slice.call(arguments);",
        "// Line_Reference 5243: ",
        "// Line_Reference 5244: \t\targs.push(function() {",
        "// Line_Reference 5245: \t\t\tparams = arguments;",
        "// Line_Reference 5246: \t\t\tif (!executed && callback) {",
        "// Line_Reference 5247: \t\t\t\texecuted = true;",
        "// Line_Reference 5248: \t\t\t\tcallback.apply(self, params);",
        "// Line_Reference 5249: \t\t\t}",
        "// Line_Reference 5250: \t\t});",
        "// Line_Reference 5251: ",
        "// Line_Reference 5252: \t\tfn.apply(self, args);",
        "// Line_Reference 5253: ",
        "// Line_Reference 5254: \t\treturn function(cb) {",
        "// Line_Reference 5255: \t\t\tcallback = cb;",
        "// Line_Reference 5256: \t\t\tif (!executed && params) {",
        "// Line_Reference 5257: \t\t\t\texecuted = true;",
        "// Line_Reference 5258: \t\t\t\tcallback.apply(self, params);",
        "// Line_Reference 5259: \t\t\t}",
        "// Line_Reference 5260: \t\t};",
        "// Line_Reference 5261: \t})();",
        "// Line_Reference 5262: };",
        "// Line_Reference 5263: ",
        "// Line_Reference 5478: exports.set = function(obj, path, value) {",
        "// Line_Reference 5479: \tvar cachekey = 'S+' + path;",
        "// Line_Reference 5480: ",
        "// Line_Reference 5481: \tif (F.temporary.other[cachekey])",
        "// Line_Reference 5482: \t\treturn F.temporary.other[cachekey](obj, value);",
        "// Line_Reference 5483: ",
        "// Line_Reference 5484: \tvar arr = parsepath(path);",
        "// Line_Reference 5485: \tvar builder = [];",
        "// Line_Reference 5486: ",
        "// Line_Reference 5487: \tfor (var i = 0; i < arr.length - 1; i++) {",
        "// Line_Reference 5488: \t\tvar type = arr[i + 1] ? (REGISARR.test(arr[i + 1]) ? '[]' : '{}') : '{}';",
        "// Line_Reference 5489: \t\tvar p = 'w' + (arr[i][0] === '[' ? '' : '.') + arr[i];",
        "// Line_Reference 5490: \t\tbuilder.push('if(typeof(' + p + ')!==\\'object\\'||' + p + '==null)' + p + '=' + type + ';');",
        "// Line_Reference 5491: \t}",
        "// Line_Reference 5492: ",
        "// Line_Reference 5493: \tvar v = arr[arr.length - 1];",
        "// Line_Reference 5494: \tvar ispush = v.lastIndexOf('[]') !== -1;",
        "// Line_Reference 5495: \tvar a = builder.join(';') + ';var v=typeof(a)===\\'function\\'?a(U.get(b)):a;w' + (v[0] === '[' ? '' : '.') + (ispush ? v.replace(REGREPLACEARR, '.push(v)') : (v + '=v')) + ';return v';",
        "// Line_Reference 5496: ",
        "// Line_Reference 5497: \tif ((/__proto__|constructor|prototype|eval/).test(a))",
        "// Line_Reference 5498: \t\tthrow new Error('Potential vulnerability');",
        "// Line_Reference 5499: ",
        "// Line_Reference 5500: \tvar fn = new Function('w', 'a', 'b', a);",
        "// Line_Reference 5501: \tF.temporary.other[cachekey] = fn;",
        "// Line_Reference 5502: \tfn(obj, value, path);",
        "// Line_Reference 5503: };",
        "// Line_Reference 5504: ",
        "// Line_Reference 5505: exports.get = function(obj, path) {",
        "// Line_Reference 5506: ",
        "// Line_Reference 5507: \tvar cachekey = 'G=' + path;",
        "// Line_Reference 5508: ",
        "// Line_Reference 5509: \tif (F.temporary.other[cachekey])",
        "// Line_Reference 5510: \t\treturn F.temporary.other[cachekey](obj);",
        "// Line_Reference 5511: ",
        "// Line_Reference 5512: \tvar arr = parsepath(path);",
        "// Line_Reference 5513: \tvar builder = [];",
        "// Line_Reference 5514: ",
        "// Line_Reference 5515: \tfor (var i = 0, length = arr.length - 1; i < length; i++)",
        "// Line_Reference 5516: \t\tbuilder.push('if(!w' + (!arr[i] || arr[i][0] === '[' ? '' : '.') + arr[i] + ')return');",
        "// Line_Reference 5517: ",
        "// Line_Reference 5518: \tvar v = arr[arr.length - 1];",
        "// Line_Reference 5519: \tvar fn = (new Function('w', builder.join(';') + ';return w' + (v[0] === '[' ? '' : '.') + v));",
        "// Line_Reference 5520: \tF.temporary.other[cachekey] = fn;",
        "// Line_Reference 5521: \treturn fn(obj);",
        "// Line_Reference 5522: };",
        "// Line_Reference 5523: ",
        "// Line_Reference 5524: function parsepath(path) {",
        "// Line_Reference 5525: ",
        "// Line_Reference 5526: \tvar arr = path.split('.');",
        "// Line_Reference 5527: \tvar builder = [];",
        "// Line_Reference 5528: \tvar all = [];",
        "// Line_Reference 5529: ",
        "// Line_Reference 5530: \tfor (var i = 0; i < arr.length; i++) {",
        "// Line_Reference 5531: \t\tvar p = arr[i];",
        "// Line_Reference 5532: \t\tvar index = p.indexOf('[');",
        "// Line_Reference 5533: \t\tif (index === -1) {",
        "// Line_Reference 5534: \t\t\tif (p.indexOf('-') === -1) {",
        "// Line_Reference 5535: \t\t\t\tall.push(p);",
        "// Line_Reference 5536: \t\t\t\tbuilder.push(all.join('.'));",
        "// Line_Reference 5537: \t\t\t} else {",
        "// Line_Reference 5538: \t\t\t\tvar a = all.splice(all.length - 1);",
        "// Line_Reference 5539: \t\t\t\tall.push(a + '[\\'' + p + '\\']');",
        "// Line_Reference 5540: \t\t\t\tbuilder.push(all.join('.'));",
        "// Line_Reference 5541: \t\t\t}",
        "// Line_Reference 5542: \t\t} else {",
        "// Line_Reference 5543: \t\t\tif (p.indexOf('-') === -1) {",
        "// Line_Reference 5544: \t\t\t\tall.push(p.substring(0, index));",
        "// Line_Reference 5545: \t\t\t\tbuilder.push(all.join('.'));",
        "// Line_Reference 5546: \t\t\t\tall.splice(all.length - 1);",
        "// Line_Reference 5547: \t\t\t\tall.push(p);",
        "// Line_Reference 5548: \t\t\t\tbuilder.push(all.join('.'));",
        "// Line_Reference 5549: \t\t\t} else {",
        "// Line_Reference 5550: \t\t\t\tall.push('[\\'' + p.substring(0, index) + '\\']');",
        "// Line_Reference 5551: \t\t\t\tbuilder.push(all.join(''));",
        "// Line_Reference 5552: \t\t\t\tall.push(p.substring(index));",
        "// Line_Reference 5553: \t\t\t\tbuilder.push(all.join(''));",
        "// Line_Reference 5554: \t\t\t}",
        "// Line_Reference 5555: \t\t}",
        "// Line_Reference 5556: \t}",
        "// Line_Reference 5557: ",
        "// Line_Reference 5558: \treturn builder;",
        "// Line_Reference 5559: }",
        "// Line_Reference 5560: ",
        "// Line_Reference 5561: global.sync = exports.sync;",
        "// Line_Reference 5562: global.sync2 = exports.sync2;",
        "// Line_Reference 5563: "
    ]
}
