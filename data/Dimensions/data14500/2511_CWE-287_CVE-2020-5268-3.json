{
    "cve_id": "CVE-2020-5268",
    "cve_description": "In Saml2 Authentication Services for ASP.NET versions before 1.0.2, and between 2.0.0 and 2.6.0, there is a vulnerability in how tokens are validated in some cases. Saml2 tokens are usually used as bearer tokens - a caller that presents a token is assumed to be the subject of the token. There is also support in the Saml2 protocol for issuing tokens that is tied to a subject through other means, e.g. holder-of-key where possession of a private key must be proved. The Sustainsys.Saml2 library incorrectly treats all incoming tokens as bearer tokens, even though they have another subject confirmation method specified. This could be used by an attacker that could get access to Saml2 tokens with another subject confirmation method than bearer. The attacker could then use such a token to create a log in session. This vulnerability is patched in versions 1.0.2 and 2.7.0.",
    "cve_publish_date": "2020-04-21",
    "cwe_id": "CWE-287",
    "cwe_name": "Improper Authentication",
    "cwe_description": "When an actor claims to have a given identity, the product does not prove or insufficiently proves that the claim is correct.",
    "commit_message": "Fix token replay detection\n- Fixes #1107\n- Fixes #711",
    "type_of_change": "Modification",
    "filename_of_changes": "Saml2PSecurityTokenHandler.cs",
    "code_language": "C#",
    "number_of_lines_added_for_mitigation": "21",
    "number_of_lines_deleted_vulnerable_to_cve": "17",
    "vulnerable_lines": [
        "// Line_Reference 31: \t\t// Overridden to fix the fact that the base class version uses NotBefore as the token replay expiry time",
        "// Line_Reference 32: \t\t// Due to the fact that we can't override the ValidateToken function (it's overridden in the base class!)",
        "// Line_Reference 33: \t\t// we have to parse the token again.",
        "// Line_Reference 34: \t\t// This can be removed when:",
        "// Line_Reference 35: \t\t// https://github.com/AzureAD/azure-activedirectory-identitymodel-extensions-for-dotnet/issues/898",
        "// Line_Reference 36: \t\t// is fixed.",
        "// Line_Reference 37: \t\tprotected override void ValidateTokenReplay(DateTime? expirationTime, string securityToken, TokenValidationParameters validationParameters)",
        "// Line_Reference 38: \t\t{",
        "// Line_Reference 39: \t\t\tvar saml2Token = ReadSaml2Token(securityToken);",
        "// Line_Reference 40: \t\t\tbase.ValidateTokenReplay(saml2Token.Assertion.Conditions.NotOnOrAfter,",
        "// Line_Reference 41: \t\t\t\tsecurityToken, validationParameters);",
        "// Line_Reference 42: \t\t}",
        "// Line_Reference 43: ",
        "// Line_Reference 87: \t\tprotected override Saml2SecurityToken ValidateSignature(string token, TokenValidationParameters validationParameters)",
        "// Line_Reference 89: \t\t\t// Just skip signature validation -- we do this elsewhere",
        "// Line_Reference 90: \t\t\treturn ReadSaml2Token(token);",
        "// Line_Reference 92:     }"
    ]
}
