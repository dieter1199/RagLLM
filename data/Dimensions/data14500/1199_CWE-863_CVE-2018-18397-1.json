{
    "cve_id": "CVE-2018-18397",
    "cve_description": "The userfaultfd implementation in the Linux kernel before 4.19.7 mishandles access control for certain UFFDIO_ ioctl calls, as demonstrated by allowing local users to write data into holes in a tmpfs file (if the user has read-only access to that file, and that file contains holes), related to fs/userfaultfd.c and mm/userfaultfd.c.",
    "cve_publish_date": "2018-12-12",
    "cwe_id": "CWE-863",
    "cwe_name": "Incorrect Authorization",
    "cwe_description": "The product performs an authorization check when an actor attempts to access a resource or perform an action, but it does not correctly perform the check. This allows attackers to bypass intended access restrictions.",
    "commit_message": "userfaultfd: shmem/hugetlbfs: only allow to register VM_MAYWRITE vmas\n\nAfter the VMA to register the uffd onto is found, check that it has\nVM_MAYWRITE set before allowing registration.  This way we inherit all\ncommon code checks before allowing to fill file holes in shmem and\nhugetlbfs with UFFDIO_COPY.\n\nThe userfaultfd memory model is not applicable for readonly files unless\nit's a MAP_PRIVATE.\n\nLink: http://lkml.kernel.org/r/20181126173452.26955-4-aarcange@redhat.com\nFixes: ff62a3421044 (\"hugetlb: implement memfd sealing\")\nSigned-off-by: Andrea Arcangeli <aarcange@redhat.com>\nReviewed-by: Mike Rapoport <rppt@linux.ibm.com>\nReviewed-by: Hugh Dickins <hughd@google.com>\nReported-by: Jann Horn <jannh@google.com>\nFixes: 4c27fe4c4c84 (\"userfaultfd: shmem: add shmem_mcopy_atomic_pte for userfaultfd support\")\nCc: <stable@vger.kernel.org>\nCc: \"Dr. David Alan Gilbert\" <dgilbert@redhat.com>\nCc: Mike Kravetz <mike.kravetz@oracle.com>\nCc: Peter Xu <peterx@redhat.com>\nCc: stable@vger.kernel.org\nSigned-off-by: Andrew Morton <akpm@linux-foundation.org>\nSigned-off-by: Linus Torvalds <torvalds@linux-foundation.org>",
    "type_of_change": "Modification",
    "filename_of_changes": "userfaultfd.c",
    "code_language": "C",
    "number_of_lines_added_for_mitigation": "6",
    "number_of_lines_deleted_vulnerable_to_cve": "9",
    "vulnerable_lines": [
        "// Line_Reference 208: \t\t * Only allow __mcopy_atomic_hugetlb on userfaultfd",
        "// Line_Reference 209: \t\t * registered ranges.",
        "// Line_Reference 462: \t * Be strict and only allow __mcopy_atomic on userfaultfd",
        "// Line_Reference 463: \t * registered ranges to prevent userland errors going",
        "// Line_Reference 464: \t * unnoticed. As far as the VM consistency is concerned, it",
        "// Line_Reference 465: \t * would be perfectly safe to remove this check, but there's",
        "// Line_Reference 466: \t * no useful usage for __mcopy_atomic ouside of userfaultfd",
        "// Line_Reference 467: \t * registered ranges. This is after all why these are ioctls",
        "// Line_Reference 468: \t * belonging to the userfaultfd and not syscalls."
    ]
}
